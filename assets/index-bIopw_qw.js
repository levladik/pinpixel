function BA(i,l){for(var f=0;f<l.length;f++){const _=l[f];if(typeof _!="string"&&!Array.isArray(_)){for(const b in _)if(b!=="default"&&!(b in i)){const z=Object.getOwnPropertyDescriptor(_,b);z&&Object.defineProperty(i,b,z.get?z:{enumerable:!0,get:()=>_[b]})}}}return Object.freeze(Object.defineProperty(i,Symbol.toStringTag,{value:"Module"}))}(function(){const l=document.createElement("link").relList;if(l&&l.supports&&l.supports("modulepreload"))return;for(const b of document.querySelectorAll('link[rel="modulepreload"]'))_(b);new MutationObserver(b=>{for(const z of b)if(z.type==="childList")for(const O of z.addedNodes)O.tagName==="LINK"&&O.rel==="modulepreload"&&_(O)}).observe(document,{childList:!0,subtree:!0});function f(b){const z={};return b.integrity&&(z.integrity=b.integrity),b.referrerPolicy&&(z.referrerPolicy=b.referrerPolicy),b.crossOrigin==="use-credentials"?z.credentials="include":b.crossOrigin==="anonymous"?z.credentials="omit":z.credentials="same-origin",z}function _(b){if(b.ep)return;b.ep=!0;const z=f(b);fetch(b.href,z)}})();function lm(i){return i&&i.__esModule&&Object.prototype.hasOwnProperty.call(i,"default")?i.default:i}var o1={exports:{}},c_={},s1={exports:{}},ji={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var EC;function Cz(){if(EC)return ji;EC=1;var i=Symbol.for("react.element"),l=Symbol.for("react.portal"),f=Symbol.for("react.fragment"),_=Symbol.for("react.strict_mode"),b=Symbol.for("react.profiler"),z=Symbol.for("react.provider"),O=Symbol.for("react.context"),r=Symbol.for("react.forward_ref"),H=Symbol.for("react.suspense"),Z=Symbol.for("react.memo"),K=Symbol.for("react.lazy"),te=Symbol.iterator;function le(je){return je===null||typeof je!="object"?null:(je=te&&je[te]||je["@@iterator"],typeof je=="function"?je:null)}var Te={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},pe=Object.assign,ge={};function fe(je,it,Mt){this.props=je,this.context=it,this.refs=ge,this.updater=Mt||Te}fe.prototype.isReactComponent={},fe.prototype.setState=function(je,it){if(typeof je!="object"&&typeof je!="function"&&je!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,je,it,"setState")},fe.prototype.forceUpdate=function(je){this.updater.enqueueForceUpdate(this,je,"forceUpdate")};function me(){}me.prototype=fe.prototype;function _e(je,it,Mt){this.props=je,this.context=it,this.refs=ge,this.updater=Mt||Te}var Ie=_e.prototype=new me;Ie.constructor=_e,pe(Ie,fe.prototype),Ie.isPureReactComponent=!0;var Ne=Array.isArray,nt=Object.prototype.hasOwnProperty,Le={current:null},Pe={key:!0,ref:!0,__self:!0,__source:!0};function rt(je,it,Mt){var Ot,sn={},hn=null,Tn=null;if(it!=null)for(Ot in it.ref!==void 0&&(Tn=it.ref),it.key!==void 0&&(hn=""+it.key),it)nt.call(it,Ot)&&!Pe.hasOwnProperty(Ot)&&(sn[Ot]=it[Ot]);var Ut=arguments.length-2;if(Ut===1)sn.children=Mt;else if(1<Ut){for(var bn=Array(Ut),Re=0;Re<Ut;Re++)bn[Re]=arguments[Re+2];sn.children=bn}if(je&&je.defaultProps)for(Ot in Ut=je.defaultProps,Ut)sn[Ot]===void 0&&(sn[Ot]=Ut[Ot]);return{$$typeof:i,type:je,key:hn,ref:Tn,props:sn,_owner:Le.current}}function at(je,it){return{$$typeof:i,type:je.type,key:it,ref:je.ref,props:je.props,_owner:je._owner}}function Qe(je){return typeof je=="object"&&je!==null&&je.$$typeof===i}function lt(je){var it={"=":"=0",":":"=2"};return"$"+je.replace(/[=:]/g,function(Mt){return it[Mt]})}var Ct=/\/+/g;function Rt(je,it){return typeof je=="object"&&je!==null&&je.key!=null?lt(""+je.key):it.toString(36)}function Nt(je,it,Mt,Ot,sn){var hn=typeof je;(hn==="undefined"||hn==="boolean")&&(je=null);var Tn=!1;if(je===null)Tn=!0;else switch(hn){case"string":case"number":Tn=!0;break;case"object":switch(je.$$typeof){case i:case l:Tn=!0}}if(Tn)return Tn=je,sn=sn(Tn),je=Ot===""?"."+Rt(Tn,0):Ot,Ne(sn)?(Mt="",je!=null&&(Mt=je.replace(Ct,"$&/")+"/"),Nt(sn,it,Mt,"",function(Re){return Re})):sn!=null&&(Qe(sn)&&(sn=at(sn,Mt+(!sn.key||Tn&&Tn.key===sn.key?"":(""+sn.key).replace(Ct,"$&/")+"/")+je)),it.push(sn)),1;if(Tn=0,Ot=Ot===""?".":Ot+":",Ne(je))for(var Ut=0;Ut<je.length;Ut++){hn=je[Ut];var bn=Ot+Rt(hn,Ut);Tn+=Nt(hn,it,Mt,bn,sn)}else if(bn=le(je),typeof bn=="function")for(je=bn.call(je),Ut=0;!(hn=je.next()).done;)hn=hn.value,bn=Ot+Rt(hn,Ut++),Tn+=Nt(hn,it,Mt,bn,sn);else if(hn==="object")throw it=String(je),Error("Objects are not valid as a React child (found: "+(it==="[object Object]"?"object with keys {"+Object.keys(je).join(", ")+"}":it)+"). If you meant to render a collection of children, use an array instead.");return Tn}function At(je,it,Mt){if(je==null)return je;var Ot=[],sn=0;return Nt(je,Ot,"","",function(hn){return it.call(Mt,hn,sn++)}),Ot}function xt(je){if(je._status===-1){var it=je._result;it=it(),it.then(function(Mt){(je._status===0||je._status===-1)&&(je._status=1,je._result=Mt)},function(Mt){(je._status===0||je._status===-1)&&(je._status=2,je._result=Mt)}),je._status===-1&&(je._status=0,je._result=it)}if(je._status===1)return je._result.default;throw je._result}var gt={current:null},ht={transition:null},vt={ReactCurrentDispatcher:gt,ReactCurrentBatchConfig:ht,ReactCurrentOwner:Le};function Ve(){throw Error("act(...) is not supported in production builds of React.")}return ji.Children={map:At,forEach:function(je,it,Mt){At(je,function(){it.apply(this,arguments)},Mt)},count:function(je){var it=0;return At(je,function(){it++}),it},toArray:function(je){return At(je,function(it){return it})||[]},only:function(je){if(!Qe(je))throw Error("React.Children.only expected to receive a single React element child.");return je}},ji.Component=fe,ji.Fragment=f,ji.Profiler=b,ji.PureComponent=_e,ji.StrictMode=_,ji.Suspense=H,ji.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=vt,ji.act=Ve,ji.cloneElement=function(je,it,Mt){if(je==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+je+".");var Ot=pe({},je.props),sn=je.key,hn=je.ref,Tn=je._owner;if(it!=null){if(it.ref!==void 0&&(hn=it.ref,Tn=Le.current),it.key!==void 0&&(sn=""+it.key),je.type&&je.type.defaultProps)var Ut=je.type.defaultProps;for(bn in it)nt.call(it,bn)&&!Pe.hasOwnProperty(bn)&&(Ot[bn]=it[bn]===void 0&&Ut!==void 0?Ut[bn]:it[bn])}var bn=arguments.length-2;if(bn===1)Ot.children=Mt;else if(1<bn){Ut=Array(bn);for(var Re=0;Re<bn;Re++)Ut[Re]=arguments[Re+2];Ot.children=Ut}return{$$typeof:i,type:je.type,key:sn,ref:hn,props:Ot,_owner:Tn}},ji.createContext=function(je){return je={$$typeof:O,_currentValue:je,_currentValue2:je,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},je.Provider={$$typeof:z,_context:je},je.Consumer=je},ji.createElement=rt,ji.createFactory=function(je){var it=rt.bind(null,je);return it.type=je,it},ji.createRef=function(){return{current:null}},ji.forwardRef=function(je){return{$$typeof:r,render:je}},ji.isValidElement=Qe,ji.lazy=function(je){return{$$typeof:K,_payload:{_status:-1,_result:je},_init:xt}},ji.memo=function(je,it){return{$$typeof:Z,type:je,compare:it===void 0?null:it}},ji.startTransition=function(je){var it=ht.transition;ht.transition={};try{je()}finally{ht.transition=it}},ji.unstable_act=Ve,ji.useCallback=function(je,it){return gt.current.useCallback(je,it)},ji.useContext=function(je){return gt.current.useContext(je)},ji.useDebugValue=function(){},ji.useDeferredValue=function(je){return gt.current.useDeferredValue(je)},ji.useEffect=function(je,it){return gt.current.useEffect(je,it)},ji.useId=function(){return gt.current.useId()},ji.useImperativeHandle=function(je,it,Mt){return gt.current.useImperativeHandle(je,it,Mt)},ji.useInsertionEffect=function(je,it){return gt.current.useInsertionEffect(je,it)},ji.useLayoutEffect=function(je,it){return gt.current.useLayoutEffect(je,it)},ji.useMemo=function(je,it){return gt.current.useMemo(je,it)},ji.useReducer=function(je,it,Mt){return gt.current.useReducer(je,it,Mt)},ji.useRef=function(je){return gt.current.useRef(je)},ji.useState=function(je){return gt.current.useState(je)},ji.useSyncExternalStore=function(je,it,Mt){return gt.current.useSyncExternalStore(je,it,Mt)},ji.useTransition=function(){return gt.current.useTransition()},ji.version="18.3.1",ji}var TC;function ES(){return TC||(TC=1,s1.exports=Cz()),s1.exports}/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var CC;function Mz(){if(CC)return c_;CC=1;var i=ES(),l=Symbol.for("react.element"),f=Symbol.for("react.fragment"),_=Object.prototype.hasOwnProperty,b=i.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,z={key:!0,ref:!0,__self:!0,__source:!0};function O(r,H,Z){var K,te={},le=null,Te=null;Z!==void 0&&(le=""+Z),H.key!==void 0&&(le=""+H.key),H.ref!==void 0&&(Te=H.ref);for(K in H)_.call(H,K)&&!z.hasOwnProperty(K)&&(te[K]=H[K]);if(r&&r.defaultProps)for(K in H=r.defaultProps,H)te[K]===void 0&&(te[K]=H[K]);return{$$typeof:l,type:r,key:le,ref:Te,props:te,_owner:b.current}}return c_.Fragment=f,c_.jsx=O,c_.jsxs=O,c_}var MC;function Az(){return MC||(MC=1,o1.exports=Mz()),o1.exports}var fi=Az(),se=ES();const Nn=lm(se),Ex=BA({__proto__:null,default:Nn},[se]);var lv={},a1={exports:{}},Dc={},l1={exports:{}},c1={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var AC;function Iz(){return AC||(AC=1,function(i){function l(ht,vt){var Ve=ht.length;ht.push(vt);e:for(;0<Ve;){var je=Ve-1>>>1,it=ht[je];if(0<b(it,vt))ht[je]=vt,ht[Ve]=it,Ve=je;else break e}}function f(ht){return ht.length===0?null:ht[0]}function _(ht){if(ht.length===0)return null;var vt=ht[0],Ve=ht.pop();if(Ve!==vt){ht[0]=Ve;e:for(var je=0,it=ht.length,Mt=it>>>1;je<Mt;){var Ot=2*(je+1)-1,sn=ht[Ot],hn=Ot+1,Tn=ht[hn];if(0>b(sn,Ve))hn<it&&0>b(Tn,sn)?(ht[je]=Tn,ht[hn]=Ve,je=hn):(ht[je]=sn,ht[Ot]=Ve,je=Ot);else if(hn<it&&0>b(Tn,Ve))ht[je]=Tn,ht[hn]=Ve,je=hn;else break e}}return vt}function b(ht,vt){var Ve=ht.sortIndex-vt.sortIndex;return Ve!==0?Ve:ht.id-vt.id}if(typeof performance=="object"&&typeof performance.now=="function"){var z=performance;i.unstable_now=function(){return z.now()}}else{var O=Date,r=O.now();i.unstable_now=function(){return O.now()-r}}var H=[],Z=[],K=1,te=null,le=3,Te=!1,pe=!1,ge=!1,fe=typeof setTimeout=="function"?setTimeout:null,me=typeof clearTimeout=="function"?clearTimeout:null,_e=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function Ie(ht){for(var vt=f(Z);vt!==null;){if(vt.callback===null)_(Z);else if(vt.startTime<=ht)_(Z),vt.sortIndex=vt.expirationTime,l(H,vt);else break;vt=f(Z)}}function Ne(ht){if(ge=!1,Ie(ht),!pe)if(f(H)!==null)pe=!0,xt(nt);else{var vt=f(Z);vt!==null&&gt(Ne,vt.startTime-ht)}}function nt(ht,vt){pe=!1,ge&&(ge=!1,me(rt),rt=-1),Te=!0;var Ve=le;try{for(Ie(vt),te=f(H);te!==null&&(!(te.expirationTime>vt)||ht&&!lt());){var je=te.callback;if(typeof je=="function"){te.callback=null,le=te.priorityLevel;var it=je(te.expirationTime<=vt);vt=i.unstable_now(),typeof it=="function"?te.callback=it:te===f(H)&&_(H),Ie(vt)}else _(H);te=f(H)}if(te!==null)var Mt=!0;else{var Ot=f(Z);Ot!==null&&gt(Ne,Ot.startTime-vt),Mt=!1}return Mt}finally{te=null,le=Ve,Te=!1}}var Le=!1,Pe=null,rt=-1,at=5,Qe=-1;function lt(){return!(i.unstable_now()-Qe<at)}function Ct(){if(Pe!==null){var ht=i.unstable_now();Qe=ht;var vt=!0;try{vt=Pe(!0,ht)}finally{vt?Rt():(Le=!1,Pe=null)}}else Le=!1}var Rt;if(typeof _e=="function")Rt=function(){_e(Ct)};else if(typeof MessageChannel<"u"){var Nt=new MessageChannel,At=Nt.port2;Nt.port1.onmessage=Ct,Rt=function(){At.postMessage(null)}}else Rt=function(){fe(Ct,0)};function xt(ht){Pe=ht,Le||(Le=!0,Rt())}function gt(ht,vt){rt=fe(function(){ht(i.unstable_now())},vt)}i.unstable_IdlePriority=5,i.unstable_ImmediatePriority=1,i.unstable_LowPriority=4,i.unstable_NormalPriority=3,i.unstable_Profiling=null,i.unstable_UserBlockingPriority=2,i.unstable_cancelCallback=function(ht){ht.callback=null},i.unstable_continueExecution=function(){pe||Te||(pe=!0,xt(nt))},i.unstable_forceFrameRate=function(ht){0>ht||125<ht?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):at=0<ht?Math.floor(1e3/ht):5},i.unstable_getCurrentPriorityLevel=function(){return le},i.unstable_getFirstCallbackNode=function(){return f(H)},i.unstable_next=function(ht){switch(le){case 1:case 2:case 3:var vt=3;break;default:vt=le}var Ve=le;le=vt;try{return ht()}finally{le=Ve}},i.unstable_pauseExecution=function(){},i.unstable_requestPaint=function(){},i.unstable_runWithPriority=function(ht,vt){switch(ht){case 1:case 2:case 3:case 4:case 5:break;default:ht=3}var Ve=le;le=ht;try{return vt()}finally{le=Ve}},i.unstable_scheduleCallback=function(ht,vt,Ve){var je=i.unstable_now();switch(typeof Ve=="object"&&Ve!==null?(Ve=Ve.delay,Ve=typeof Ve=="number"&&0<Ve?je+Ve:je):Ve=je,ht){case 1:var it=-1;break;case 2:it=250;break;case 5:it=1073741823;break;case 4:it=1e4;break;default:it=5e3}return it=Ve+it,ht={id:K++,callback:vt,priorityLevel:ht,startTime:Ve,expirationTime:it,sortIndex:-1},Ve>je?(ht.sortIndex=Ve,l(Z,ht),f(H)===null&&ht===f(Z)&&(ge?(me(rt),rt=-1):ge=!0,gt(Ne,Ve-je))):(ht.sortIndex=it,l(H,ht),pe||Te||(pe=!0,xt(nt))),ht},i.unstable_shouldYield=lt,i.unstable_wrapCallback=function(ht){var vt=le;return function(){var Ve=le;le=vt;try{return ht.apply(this,arguments)}finally{le=Ve}}}}(c1)),c1}var IC;function Pz(){return IC||(IC=1,l1.exports=Iz()),l1.exports}/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var PC;function Rz(){if(PC)return Dc;PC=1;var i=ES(),l=Pz();function f(m){for(var y="https://reactjs.org/docs/error-decoder.html?invariant="+m,R=1;R<arguments.length;R++)y+="&args[]="+encodeURIComponent(arguments[R]);return"Minified React error #"+m+"; visit "+y+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var _=new Set,b={};function z(m,y){O(m,y),O(m+"Capture",y)}function O(m,y){for(b[m]=y,m=0;m<y.length;m++)_.add(y[m])}var r=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),H=Object.prototype.hasOwnProperty,Z=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,K={},te={};function le(m){return H.call(te,m)?!0:H.call(K,m)?!1:Z.test(m)?te[m]=!0:(K[m]=!0,!1)}function Te(m,y,R,F){if(R!==null&&R.type===0)return!1;switch(typeof y){case"function":case"symbol":return!0;case"boolean":return F?!1:R!==null?!R.acceptsBooleans:(m=m.toLowerCase().slice(0,5),m!=="data-"&&m!=="aria-");default:return!1}}function pe(m,y,R,F){if(y===null||typeof y>"u"||Te(m,y,R,F))return!0;if(F)return!1;if(R!==null)switch(R.type){case 3:return!y;case 4:return y===!1;case 5:return isNaN(y);case 6:return isNaN(y)||1>y}return!1}function ge(m,y,R,F,Y,ee,Ce){this.acceptsBooleans=y===2||y===3||y===4,this.attributeName=F,this.attributeNamespace=Y,this.mustUseProperty=R,this.propertyName=m,this.type=y,this.sanitizeURL=ee,this.removeEmptyString=Ce}var fe={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(m){fe[m]=new ge(m,0,!1,m,null,!1,!1)}),[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(m){var y=m[0];fe[y]=new ge(y,1,!1,m[1],null,!1,!1)}),["contentEditable","draggable","spellCheck","value"].forEach(function(m){fe[m]=new ge(m,2,!1,m.toLowerCase(),null,!1,!1)}),["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(m){fe[m]=new ge(m,2,!1,m,null,!1,!1)}),"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(m){fe[m]=new ge(m,3,!1,m.toLowerCase(),null,!1,!1)}),["checked","multiple","muted","selected"].forEach(function(m){fe[m]=new ge(m,3,!0,m,null,!1,!1)}),["capture","download"].forEach(function(m){fe[m]=new ge(m,4,!1,m,null,!1,!1)}),["cols","rows","size","span"].forEach(function(m){fe[m]=new ge(m,6,!1,m,null,!1,!1)}),["rowSpan","start"].forEach(function(m){fe[m]=new ge(m,5,!1,m.toLowerCase(),null,!1,!1)});var me=/[\-:]([a-z])/g;function _e(m){return m[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(m){var y=m.replace(me,_e);fe[y]=new ge(y,1,!1,m,null,!1,!1)}),"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(m){var y=m.replace(me,_e);fe[y]=new ge(y,1,!1,m,"http://www.w3.org/1999/xlink",!1,!1)}),["xml:base","xml:lang","xml:space"].forEach(function(m){var y=m.replace(me,_e);fe[y]=new ge(y,1,!1,m,"http://www.w3.org/XML/1998/namespace",!1,!1)}),["tabIndex","crossOrigin"].forEach(function(m){fe[m]=new ge(m,1,!1,m.toLowerCase(),null,!1,!1)}),fe.xlinkHref=new ge("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1),["src","href","action","formAction"].forEach(function(m){fe[m]=new ge(m,1,!1,m.toLowerCase(),null,!0,!0)});function Ie(m,y,R,F){var Y=fe.hasOwnProperty(y)?fe[y]:null;(Y!==null?Y.type!==0:F||!(2<y.length)||y[0]!=="o"&&y[0]!=="O"||y[1]!=="n"&&y[1]!=="N")&&(pe(y,R,Y,F)&&(R=null),F||Y===null?le(y)&&(R===null?m.removeAttribute(y):m.setAttribute(y,""+R)):Y.mustUseProperty?m[Y.propertyName]=R===null?Y.type===3?!1:"":R:(y=Y.attributeName,F=Y.attributeNamespace,R===null?m.removeAttribute(y):(Y=Y.type,R=Y===3||Y===4&&R===!0?"":""+R,F?m.setAttributeNS(F,y,R):m.setAttribute(y,R))))}var Ne=i.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,nt=Symbol.for("react.element"),Le=Symbol.for("react.portal"),Pe=Symbol.for("react.fragment"),rt=Symbol.for("react.strict_mode"),at=Symbol.for("react.profiler"),Qe=Symbol.for("react.provider"),lt=Symbol.for("react.context"),Ct=Symbol.for("react.forward_ref"),Rt=Symbol.for("react.suspense"),Nt=Symbol.for("react.suspense_list"),At=Symbol.for("react.memo"),xt=Symbol.for("react.lazy"),gt=Symbol.for("react.offscreen"),ht=Symbol.iterator;function vt(m){return m===null||typeof m!="object"?null:(m=ht&&m[ht]||m["@@iterator"],typeof m=="function"?m:null)}var Ve=Object.assign,je;function it(m){if(je===void 0)try{throw Error()}catch(R){var y=R.stack.trim().match(/\n( *(at )?)/);je=y&&y[1]||""}return`
`+je+m}var Mt=!1;function Ot(m,y){if(!m||Mt)return"";Mt=!0;var R=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(y)if(y=function(){throw Error()},Object.defineProperty(y.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(y,[])}catch(en){var F=en}Reflect.construct(m,[],y)}else{try{y.call()}catch(en){F=en}m.call(y.prototype)}else{try{throw Error()}catch(en){F=en}m()}}catch(en){if(en&&F&&typeof en.stack=="string"){for(var Y=en.stack.split(`
`),ee=F.stack.split(`
`),Ce=Y.length-1,ut=ee.length-1;1<=Ce&&0<=ut&&Y[Ce]!==ee[ut];)ut--;for(;1<=Ce&&0<=ut;Ce--,ut--)if(Y[Ce]!==ee[ut]){if(Ce!==1||ut!==1)do if(Ce--,ut--,0>ut||Y[Ce]!==ee[ut]){var St=`
`+Y[Ce].replace(" at new "," at ");return m.displayName&&St.includes("<anonymous>")&&(St=St.replace("<anonymous>",m.displayName)),St}while(1<=Ce&&0<=ut);break}}}finally{Mt=!1,Error.prepareStackTrace=R}return(m=m?m.displayName||m.name:"")?it(m):""}function sn(m){switch(m.tag){case 5:return it(m.type);case 16:return it("Lazy");case 13:return it("Suspense");case 19:return it("SuspenseList");case 0:case 2:case 15:return m=Ot(m.type,!1),m;case 11:return m=Ot(m.type.render,!1),m;case 1:return m=Ot(m.type,!0),m;default:return""}}function hn(m){if(m==null)return null;if(typeof m=="function")return m.displayName||m.name||null;if(typeof m=="string")return m;switch(m){case Pe:return"Fragment";case Le:return"Portal";case at:return"Profiler";case rt:return"StrictMode";case Rt:return"Suspense";case Nt:return"SuspenseList"}if(typeof m=="object")switch(m.$$typeof){case lt:return(m.displayName||"Context")+".Consumer";case Qe:return(m._context.displayName||"Context")+".Provider";case Ct:var y=m.render;return m=m.displayName,m||(m=y.displayName||y.name||"",m=m!==""?"ForwardRef("+m+")":"ForwardRef"),m;case At:return y=m.displayName||null,y!==null?y:hn(m.type)||"Memo";case xt:y=m._payload,m=m._init;try{return hn(m(y))}catch{}}return null}function Tn(m){var y=m.type;switch(m.tag){case 24:return"Cache";case 9:return(y.displayName||"Context")+".Consumer";case 10:return(y._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return m=y.render,m=m.displayName||m.name||"",y.displayName||(m!==""?"ForwardRef("+m+")":"ForwardRef");case 7:return"Fragment";case 5:return y;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return hn(y);case 8:return y===rt?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof y=="function")return y.displayName||y.name||null;if(typeof y=="string")return y}return null}function Ut(m){switch(typeof m){case"boolean":case"number":case"string":case"undefined":return m;case"object":return m;default:return""}}function bn(m){var y=m.type;return(m=m.nodeName)&&m.toLowerCase()==="input"&&(y==="checkbox"||y==="radio")}function Re(m){var y=bn(m)?"checked":"value",R=Object.getOwnPropertyDescriptor(m.constructor.prototype,y),F=""+m[y];if(!m.hasOwnProperty(y)&&typeof R<"u"&&typeof R.get=="function"&&typeof R.set=="function"){var Y=R.get,ee=R.set;return Object.defineProperty(m,y,{configurable:!0,get:function(){return Y.call(this)},set:function(Ce){F=""+Ce,ee.call(this,Ce)}}),Object.defineProperty(m,y,{enumerable:R.enumerable}),{getValue:function(){return F},setValue:function(Ce){F=""+Ce},stopTracking:function(){m._valueTracker=null,delete m[y]}}}}function Hr(m){m._valueTracker||(m._valueTracker=Re(m))}function Nr(m){if(!m)return!1;var y=m._valueTracker;if(!y)return!0;var R=y.getValue(),F="";return m&&(F=bn(m)?m.checked?"true":"false":m.value),m=F,m!==R?(y.setValue(m),!0):!1}function Ar(m){if(m=m||(typeof document<"u"?document:void 0),typeof m>"u")return null;try{return m.activeElement||m.body}catch{return m.body}}function Ht(m,y){var R=y.checked;return Ve({},y,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:R??m._wrapperState.initialChecked})}function Wr(m,y){var R=y.defaultValue==null?"":y.defaultValue,F=y.checked!=null?y.checked:y.defaultChecked;R=Ut(y.value!=null?y.value:R),m._wrapperState={initialChecked:F,initialValue:R,controlled:y.type==="checkbox"||y.type==="radio"?y.checked!=null:y.value!=null}}function ar(m,y){y=y.checked,y!=null&&Ie(m,"checked",y,!1)}function pi(m,y){ar(m,y);var R=Ut(y.value),F=y.type;if(R!=null)F==="number"?(R===0&&m.value===""||m.value!=R)&&(m.value=""+R):m.value!==""+R&&(m.value=""+R);else if(F==="submit"||F==="reset"){m.removeAttribute("value");return}y.hasOwnProperty("value")?Gr(m,y.type,R):y.hasOwnProperty("defaultValue")&&Gr(m,y.type,Ut(y.defaultValue)),y.checked==null&&y.defaultChecked!=null&&(m.defaultChecked=!!y.defaultChecked)}function $n(m,y,R){if(y.hasOwnProperty("value")||y.hasOwnProperty("defaultValue")){var F=y.type;if(!(F!=="submit"&&F!=="reset"||y.value!==void 0&&y.value!==null))return;y=""+m._wrapperState.initialValue,R||y===m.value||(m.value=y),m.defaultValue=y}R=m.name,R!==""&&(m.name=""),m.defaultChecked=!!m._wrapperState.initialChecked,R!==""&&(m.name=R)}function Gr(m,y,R){(y!=="number"||Ar(m.ownerDocument)!==m)&&(R==null?m.defaultValue=""+m._wrapperState.initialValue:m.defaultValue!==""+R&&(m.defaultValue=""+R))}var gi=Array.isArray;function Pr(m,y,R,F){if(m=m.options,y){y={};for(var Y=0;Y<R.length;Y++)y["$"+R[Y]]=!0;for(R=0;R<m.length;R++)Y=y.hasOwnProperty("$"+m[R].value),m[R].selected!==Y&&(m[R].selected=Y),Y&&F&&(m[R].defaultSelected=!0)}else{for(R=""+Ut(R),y=null,Y=0;Y<m.length;Y++){if(m[Y].value===R){m[Y].selected=!0,F&&(m[Y].defaultSelected=!0);return}y!==null||m[Y].disabled||(y=m[Y])}y!==null&&(y.selected=!0)}}function ci(m,y){if(y.dangerouslySetInnerHTML!=null)throw Error(f(91));return Ve({},y,{value:void 0,defaultValue:void 0,children:""+m._wrapperState.initialValue})}function Un(m,y){var R=y.value;if(R==null){if(R=y.children,y=y.defaultValue,R!=null){if(y!=null)throw Error(f(92));if(gi(R)){if(1<R.length)throw Error(f(93));R=R[0]}y=R}y==null&&(y=""),R=y}m._wrapperState={initialValue:Ut(R)}}function yn(m,y){var R=Ut(y.value),F=Ut(y.defaultValue);R!=null&&(R=""+R,R!==m.value&&(m.value=R),y.defaultValue==null&&m.defaultValue!==R&&(m.defaultValue=R)),F!=null&&(m.defaultValue=""+F)}function Ir(m){var y=m.textContent;y===m._wrapperState.initialValue&&y!==""&&y!==null&&(m.value=y)}function ui(m){switch(m){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function _i(m,y){return m==null||m==="http://www.w3.org/1999/xhtml"?ui(y):m==="http://www.w3.org/2000/svg"&&y==="foreignObject"?"http://www.w3.org/1999/xhtml":m}var Lr,yi=function(m){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(y,R,F,Y){MSApp.execUnsafeLocalFunction(function(){return m(y,R,F,Y)})}:m}(function(m,y){if(m.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in m)m.innerHTML=y;else{for(Lr=Lr||document.createElement("div"),Lr.innerHTML="<svg>"+y.valueOf().toString()+"</svg>",y=Lr.firstChild;m.firstChild;)m.removeChild(m.firstChild);for(;y.firstChild;)m.appendChild(y.firstChild)}});function oi(m,y){if(y){var R=m.firstChild;if(R&&R===m.lastChild&&R.nodeType===3){R.nodeValue=y;return}}m.textContent=y}var qi={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},Ci=["Webkit","ms","Moz","O"];Object.keys(qi).forEach(function(m){Ci.forEach(function(y){y=y+m.charAt(0).toUpperCase()+m.substring(1),qi[y]=qi[m]})});function mr(m,y,R){return y==null||typeof y=="boolean"||y===""?"":R||typeof y!="number"||y===0||qi.hasOwnProperty(m)&&qi[m]?(""+y).trim():y+"px"}function dr(m,y){m=m.style;for(var R in y)if(y.hasOwnProperty(R)){var F=R.indexOf("--")===0,Y=mr(R,y[R],F);R==="float"&&(R="cssFloat"),F?m.setProperty(R,Y):m[R]=Y}}var wo=Ve({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function Zi(m,y){if(y){if(wo[m]&&(y.children!=null||y.dangerouslySetInnerHTML!=null))throw Error(f(137,m));if(y.dangerouslySetInnerHTML!=null){if(y.children!=null)throw Error(f(60));if(typeof y.dangerouslySetInnerHTML!="object"||!("__html"in y.dangerouslySetInnerHTML))throw Error(f(61))}if(y.style!=null&&typeof y.style!="object")throw Error(f(62))}}function ko(m,y){if(m.indexOf("-")===-1)return typeof y.is=="string";switch(m){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var nr=null;function ss(m){return m=m.target||m.srcElement||window,m.correspondingUseElement&&(m=m.correspondingUseElement),m.nodeType===3?m.parentNode:m}var Vs=null,io=null,as=null;function ls(m){if(m=ca(m)){if(typeof Vs!="function")throw Error(f(280));var y=m.stateNode;y&&(y=Wa(y),Vs(m.stateNode,m.type,y))}}function Ao(m){io?as?as.push(m):as=[m]:io=m}function Ts(){if(io){var m=io,y=as;if(as=io=null,ls(m),y)for(m=0;m<y.length;m++)ls(y[m])}}function oo(m,y){return m(y)}function bt(){}var oe=!1;function de(m,y,R){if(oe)return m(y,R);oe=!0;try{return oo(m,y,R)}finally{oe=!1,(io!==null||as!==null)&&(bt(),Ts())}}function Se(m,y){var R=m.stateNode;if(R===null)return null;var F=Wa(R);if(F===null)return null;R=F[y];e:switch(y){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(F=!F.disabled)||(m=m.type,F=!(m==="button"||m==="input"||m==="select"||m==="textarea")),m=!F;break e;default:m=!1}if(m)return null;if(R&&typeof R!="function")throw Error(f(231,y,typeof R));return R}var He=!1;if(r)try{var $e={};Object.defineProperty($e,"passive",{get:function(){He=!0}}),window.addEventListener("test",$e,$e),window.removeEventListener("test",$e,$e)}catch{He=!1}function et(m,y,R,F,Y,ee,Ce,ut,St){var en=Array.prototype.slice.call(arguments,3);try{y.apply(R,en)}catch(wn){this.onError(wn)}}var _t=!1,Ke=null,mt=!1,wt=null,Tt={onError:function(m){_t=!0,Ke=m}};function Jt(m,y,R,F,Y,ee,Ce,ut,St){_t=!1,Ke=null,et.apply(Tt,arguments)}function fn(m,y,R,F,Y,ee,Ce,ut,St){if(Jt.apply(this,arguments),_t){if(_t){var en=Ke;_t=!1,Ke=null}else throw Error(f(198));mt||(mt=!0,wt=en)}}function on(m){var y=m,R=m;if(m.alternate)for(;y.return;)y=y.return;else{m=y;do y=m,y.flags&4098&&(R=y.return),m=y.return;while(m)}return y.tag===3?R:null}function En(m){if(m.tag===13){var y=m.memoizedState;if(y===null&&(m=m.alternate,m!==null&&(y=m.memoizedState)),y!==null)return y.dehydrated}return null}function zn(m){if(on(m)!==m)throw Error(f(188))}function Rn(m){var y=m.alternate;if(!y){if(y=on(m),y===null)throw Error(f(188));return y!==m?null:m}for(var R=m,F=y;;){var Y=R.return;if(Y===null)break;var ee=Y.alternate;if(ee===null){if(F=Y.return,F!==null){R=F;continue}break}if(Y.child===ee.child){for(ee=Y.child;ee;){if(ee===R)return zn(Y),m;if(ee===F)return zn(Y),y;ee=ee.sibling}throw Error(f(188))}if(R.return!==F.return)R=Y,F=ee;else{for(var Ce=!1,ut=Y.child;ut;){if(ut===R){Ce=!0,R=Y,F=ee;break}if(ut===F){Ce=!0,F=Y,R=ee;break}ut=ut.sibling}if(!Ce){for(ut=ee.child;ut;){if(ut===R){Ce=!0,R=ee,F=Y;break}if(ut===F){Ce=!0,F=ee,R=Y;break}ut=ut.sibling}if(!Ce)throw Error(f(189))}}if(R.alternate!==F)throw Error(f(190))}if(R.tag!==3)throw Error(f(188));return R.stateNode.current===R?m:y}function In(m){return m=Rn(m),m!==null?kr(m):null}function kr(m){if(m.tag===5||m.tag===6)return m;for(m=m.child;m!==null;){var y=kr(m);if(y!==null)return y;m=m.sibling}return null}var lr=l.unstable_scheduleCallback,Hn=l.unstable_cancelCallback,Br=l.unstable_shouldYield,ti=l.unstable_requestPaint,zr=l.unstable_now,po=l.unstable_getCurrentPriorityLevel,so=l.unstable_ImmediatePriority,ao=l.unstable_UserBlockingPriority,zs=l.unstable_NormalPriority,cs=l.unstable_LowPriority,Al=l.unstable_IdlePriority,Xs=null,lo=null;function Il(m){if(lo&&typeof lo.onCommitFiberRoot=="function")try{lo.onCommitFiberRoot(Xs,m,void 0,(m.current.flags&128)===128)}catch{}}var zo=Math.clz32?Math.clz32:tl,$o=Math.log,Yo=Math.LN2;function tl(m){return m>>>=0,m===0?32:31-($o(m)/Yo|0)|0}var ya=64,co=4194304;function So(m){switch(m&-m){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return m&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return m&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return m}}function Cs(m,y){var R=m.pendingLanes;if(R===0)return 0;var F=0,Y=m.suspendedLanes,ee=m.pingedLanes,Ce=R&268435455;if(Ce!==0){var ut=Ce&~Y;ut!==0?F=So(ut):(ee&=Ce,ee!==0&&(F=So(ee)))}else Ce=R&~Y,Ce!==0?F=So(Ce):ee!==0&&(F=So(ee));if(F===0)return 0;if(y!==0&&y!==F&&!(y&Y)&&(Y=F&-F,ee=y&-y,Y>=ee||Y===16&&(ee&4194240)!==0))return y;if(F&4&&(F|=R&16),y=m.entangledLanes,y!==0)for(m=m.entanglements,y&=F;0<y;)R=31-zo(y),Y=1<<R,F|=m[R],y&=~Y;return F}function Ms(m,y){switch(m){case 1:case 2:case 4:return y+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return y+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function Vo(m,y){for(var R=m.suspendedLanes,F=m.pingedLanes,Y=m.expirationTimes,ee=m.pendingLanes;0<ee;){var Ce=31-zo(ee),ut=1<<Ce,St=Y[Ce];St===-1?(!(ut&R)||ut&F)&&(Y[Ce]=Ms(ut,y)):St<=y&&(m.expiredLanes|=ut),ee&=~ut}}function us(m){return m=m.pendingLanes&-1073741825,m!==0?m:m&1073741824?1073741824:0}function mo(){var m=ya;return ya<<=1,!(ya&4194240)&&(ya=64),m}function Io(m){for(var y=[],R=0;31>R;R++)y.push(m);return y}function Uo(m,y,R){m.pendingLanes|=y,y!==536870912&&(m.suspendedLanes=0,m.pingedLanes=0),m=m.eventTimes,y=31-zo(y),m[y]=R}function va(m,y){var R=m.pendingLanes&~y;m.pendingLanes=y,m.suspendedLanes=0,m.pingedLanes=0,m.expiredLanes&=y,m.mutableReadLanes&=y,m.entangledLanes&=y,y=m.entanglements;var F=m.eventTimes;for(m=m.expirationTimes;0<R;){var Y=31-zo(R),ee=1<<Y;y[Y]=0,F[Y]=-1,m[Y]=-1,R&=~ee}}function xa(m,y){var R=m.entangledLanes|=y;for(m=m.entanglements;R;){var F=31-zo(R),Y=1<<F;Y&y|m[F]&y&&(m[F]|=y),R&=~Y}}var hi=0;function As(m){return m&=-m,1<m?4<m?m&268435455?16:536870912:4:1}var nl,Oa,go,Ls,Ys,Da=!1,ir=[],hs=null,kn=null,Po=null,yr=new Map,ia=new Map,Eo=[],Fa="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function Kn(m,y){switch(m){case"focusin":case"focusout":hs=null;break;case"dragenter":case"dragleave":kn=null;break;case"mouseover":case"mouseout":Po=null;break;case"pointerover":case"pointerout":yr.delete(y.pointerId);break;case"gotpointercapture":case"lostpointercapture":ia.delete(y.pointerId)}}function qt(m,y,R,F,Y,ee){return m===null||m.nativeEvent!==ee?(m={blockedOn:y,domEventName:R,eventSystemFlags:F,nativeEvent:ee,targetContainers:[Y]},y!==null&&(y=ca(y),y!==null&&Oa(y)),m):(m.eventSystemFlags|=F,y=m.targetContainers,Y!==null&&y.indexOf(Y)===-1&&y.push(Y),m)}function Jn(m,y,R,F,Y){switch(y){case"focusin":return hs=qt(hs,m,y,R,F,Y),!0;case"dragenter":return kn=qt(kn,m,y,R,F,Y),!0;case"mouseover":return Po=qt(Po,m,y,R,F,Y),!0;case"pointerover":var ee=Y.pointerId;return yr.set(ee,qt(yr.get(ee)||null,m,y,R,F,Y)),!0;case"gotpointercapture":return ee=Y.pointerId,ia.set(ee,qt(ia.get(ee)||null,m,y,R,F,Y)),!0}return!1}function Xn(m){var y=Fl(m.target);if(y!==null){var R=on(y);if(R!==null){if(y=R.tag,y===13){if(y=En(R),y!==null){m.blockedOn=y,Ys(m.priority,function(){go(R)});return}}else if(y===3&&R.stateNode.current.memoizedState.isDehydrated){m.blockedOn=R.tag===3?R.stateNode.containerInfo:null;return}}}m.blockedOn=null}function ni(m){if(m.blockedOn!==null)return!1;for(var y=m.targetContainers;0<y.length;){var R=Kl(m.domEventName,m.eventSystemFlags,y[0],m.nativeEvent);if(R===null){R=m.nativeEvent;var F=new R.constructor(R.type,R);nr=F,R.target.dispatchEvent(F),nr=null}else return y=ca(R),y!==null&&Oa(y),m.blockedOn=R,!1;y.shift()}return!0}function ba(m,y,R){ni(m)&&R.delete(y)}function wr(){Da=!1,hs!==null&&ni(hs)&&(hs=null),kn!==null&&ni(kn)&&(kn=null),Po!==null&&ni(Po)&&(Po=null),yr.forEach(ba),ia.forEach(ba)}function rl(m,y){m.blockedOn===y&&(m.blockedOn=null,Da||(Da=!0,l.unstable_scheduleCallback(l.unstable_NormalPriority,wr)))}function ds(m){function y(Y){return rl(Y,m)}if(0<ir.length){rl(ir[0],m);for(var R=1;R<ir.length;R++){var F=ir[R];F.blockedOn===m&&(F.blockedOn=null)}}for(hs!==null&&rl(hs,m),kn!==null&&rl(kn,m),Po!==null&&rl(Po,m),yr.forEach(y),ia.forEach(y),R=0;R<Eo.length;R++)F=Eo[R],F.blockedOn===m&&(F.blockedOn=null);for(;0<Eo.length&&(R=Eo[0],R.blockedOn===null);)Xn(R),R.blockedOn===null&&Eo.shift()}var oa=Ne.ReactCurrentBatchConfig,Lo=!0;function wi(m,y,R,F){var Y=hi,ee=oa.transition;oa.transition=null;try{hi=1,il(m,y,R,F)}finally{hi=Y,oa.transition=ee}}function Pd(m,y,R,F){var Y=hi,ee=oa.transition;oa.transition=null;try{hi=4,il(m,y,R,F)}finally{hi=Y,oa.transition=ee}}function il(m,y,R,F){if(Lo){var Y=Kl(m,y,R,F);if(Y===null)Xc(m,y,F,Yl,R),Kn(m,F);else if(Jn(Y,m,y,R,F))F.stopPropagation();else if(Kn(m,F),y&4&&-1<Fa.indexOf(m)){for(;Y!==null;){var ee=ca(Y);if(ee!==null&&nl(ee),ee=Kl(m,y,R,F),ee===null&&Xc(m,y,F,Yl,R),ee===Y)break;Y=ee}Y!==null&&F.stopPropagation()}else Xc(m,y,F,null,R)}}var Yl=null;function Kl(m,y,R,F){if(Yl=null,m=ss(F),m=Fl(m),m!==null)if(y=on(m),y===null)m=null;else if(R=y.tag,R===13){if(m=En(y),m!==null)return m;m=null}else if(R===3){if(y.stateNode.current.memoizedState.isDehydrated)return y.tag===3?y.stateNode.containerInfo:null;m=null}else y!==m&&(m=null);return Yl=m,null}function Eu(m){switch(m){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(po()){case so:return 1;case ao:return 4;case zs:case cs:return 16;case Al:return 536870912;default:return 16}default:return 16}}var Os=null,fs=null,sa=null;function Oo(){if(sa)return sa;var m,y=fs,R=y.length,F,Y="value"in Os?Os.value:Os.textContent,ee=Y.length;for(m=0;m<R&&y[m]===Y[m];m++);var Ce=R-m;for(F=1;F<=Ce&&y[R-F]===Y[ee-F];F++);return sa=Y.slice(m,1<F?1-F:void 0)}function ol(m){var y=m.keyCode;return"charCode"in m?(m=m.charCode,m===0&&y===13&&(m=13)):m=y,m===10&&(m=13),32<=m||m===13?m:0}function sl(){return!0}function zi(){return!1}function To(m){function y(R,F,Y,ee,Ce){this._reactName=R,this._targetInst=Y,this.type=F,this.nativeEvent=ee,this.target=Ce,this.currentTarget=null;for(var ut in m)m.hasOwnProperty(ut)&&(R=m[ut],this[ut]=R?R(ee):ee[ut]);return this.isDefaultPrevented=(ee.defaultPrevented!=null?ee.defaultPrevented:ee.returnValue===!1)?sl:zi,this.isPropagationStopped=zi,this}return Ve(y.prototype,{preventDefault:function(){this.defaultPrevented=!0;var R=this.nativeEvent;R&&(R.preventDefault?R.preventDefault():typeof R.returnValue!="unknown"&&(R.returnValue=!1),this.isDefaultPrevented=sl)},stopPropagation:function(){var R=this.nativeEvent;R&&(R.stopPropagation?R.stopPropagation():typeof R.cancelBubble!="unknown"&&(R.cancelBubble=!0),this.isPropagationStopped=sl)},persist:function(){},isPersistent:sl}),y}var Is={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(m){return m.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},_o=To(Is),Jl=Ve({},Is,{view:0,detail:0}),wa=To(Jl),Ba,al,ll,Oh=Ve({},Jl,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:ja,button:0,buttons:0,relatedTarget:function(m){return m.relatedTarget===void 0?m.fromElement===m.srcElement?m.toElement:m.fromElement:m.relatedTarget},movementX:function(m){return"movementX"in m?m.movementX:(m!==ll&&(ll&&m.type==="mousemove"?(Ba=m.screenX-ll.screenX,al=m.screenY-ll.screenY):al=Ba=0,ll=m),Ba)},movementY:function(m){return"movementY"in m?m.movementY:al}}),Na=To(Oh),Rd=Ve({},Oh,{dataTransfer:0}),Ku=To(Rd),Ko=Ve({},Jl,{relatedTarget:0}),_c=To(Ko),Dh=Ve({},Is,{animationName:0,elapsedTime:0,pseudoElement:0}),kd=To(Dh),Ju=Ve({},Is,{clipboardData:function(m){return"clipboardData"in m?m.clipboardData:window.clipboardData}}),Sp=To(Ju),Ep=Ve({},Is,{data:0}),Tu=To(Ep),Cu={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},zd={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},cl={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function Uc(m){var y=this.nativeEvent;return y.getModifierState?y.getModifierState(m):(m=cl[m])?!!y[m]:!1}function ja(){return Uc}var Pl=Ve({},Jl,{key:function(m){if(m.key){var y=Cu[m.key]||m.key;if(y!=="Unidentified")return y}return m.type==="keypress"?(m=ol(m),m===13?"Enter":String.fromCharCode(m)):m.type==="keydown"||m.type==="keyup"?zd[m.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:ja,charCode:function(m){return m.type==="keypress"?ol(m):0},keyCode:function(m){return m.type==="keydown"||m.type==="keyup"?m.keyCode:0},which:function(m){return m.type==="keypress"?ol(m):m.type==="keydown"||m.type==="keyup"?m.keyCode:0}}),Fh=To(Pl),Tp=Ve({},Oh,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),Cf=To(Tp),Mf=Ve({},Jl,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:ja}),Mu=To(Mf),Sr=Ve({},Is,{propertyName:0,elapsedTime:0,pseudoElement:0}),Dn=To(Sr),Bh=Ve({},Oh,{deltaX:function(m){return"deltaX"in m?m.deltaX:"wheelDeltaX"in m?-m.wheelDeltaX:0},deltaY:function(m){return"deltaY"in m?m.deltaY:"wheelDeltaY"in m?-m.wheelDeltaY:"wheelDelta"in m?-m.wheelDelta:0},deltaZ:0,deltaMode:0}),or=To(Bh),aa=[9,13,27,32],$a=r&&"CompositionEvent"in window,Wn=null;r&&"documentMode"in document&&(Wn=document.documentMode);var Nh=r&&"TextEvent"in window&&!Wn,Qu=r&&(!$a||Wn&&8<Wn&&11>=Wn),Hc=" ",yc=!1;function Ql(m,y){switch(m){case"keyup":return aa.indexOf(y.keyCode)!==-1;case"keydown":return y.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function ps(m){return m=m.detail,typeof m=="object"&&"data"in m?m.data:null}var ms=!1;function eh(m,y){switch(m){case"compositionend":return ps(y);case"keypress":return y.which!==32?null:(yc=!0,Hc);case"textInput":return m=y.data,m===Hc&&yc?null:m;default:return null}}function pn(m,y){if(ms)return m==="compositionend"||!$a&&Ql(m,y)?(m=Oo(),sa=fs=Os=null,ms=!1,m):null;switch(m){case"paste":return null;case"keypress":if(!(y.ctrlKey||y.altKey||y.metaKey)||y.ctrlKey&&y.altKey){if(y.char&&1<y.char.length)return y.char;if(y.which)return String.fromCharCode(y.which)}return null;case"compositionend":return Qu&&y.locale!=="ko"?null:y.data;default:return null}}var jh={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function ul(m){var y=m&&m.nodeName&&m.nodeName.toLowerCase();return y==="input"?!!jh[m.type]:y==="textarea"}function Jo(m,y,R,F){Ao(F),y=ml(y,"onChange"),0<y.length&&(R=new _o("onChange","change",null,R,F),m.push({event:R,listeners:y}))}var Wc=null,hl=null;function Rl(m){Zc(m,0)}function dl(m){var y=ua(m);if(Nr(y))return m}function gs(m,y){if(m==="change")return y}var Gc=!1;if(r){var vc;if(r){var $h="oninput"in document;if(!$h){var Ld=document.createElement("div");Ld.setAttribute("oninput","return;"),$h=typeof Ld.oninput=="function"}vc=$h}else vc=!1;Gc=vc&&(!document.documentMode||9<document.documentMode)}function Vh(){Wc&&(Wc.detachEvent("onpropertychange",Od),hl=Wc=null)}function Od(m){if(m.propertyName==="value"&&dl(hl)){var y=[];Jo(y,hl,m,ss(m)),de(Rl,y)}}function Af(m,y,R){m==="focusin"?(Vh(),Wc=y,hl=R,Wc.attachEvent("onpropertychange",Od)):m==="focusout"&&Vh()}function If(m){if(m==="selectionchange"||m==="keyup"||m==="keydown")return dl(hl)}function ec(m,y){if(m==="click")return dl(y)}function Cp(m,y){if(m==="input"||m==="change")return dl(y)}function Pf(m,y){return m===y&&(m!==0||1/m===1/y)||m!==m&&y!==y}var la=typeof Object.is=="function"?Object.is:Pf;function xc(m,y){if(la(m,y))return!0;if(typeof m!="object"||m===null||typeof y!="object"||y===null)return!1;var R=Object.keys(m),F=Object.keys(y);if(R.length!==F.length)return!1;for(F=0;F<R.length;F++){var Y=R[F];if(!H.call(y,Y)||!la(m[Y],y[Y]))return!1}return!0}function Uh(m){for(;m&&m.firstChild;)m=m.firstChild;return m}function Va(m,y){var R=Uh(m);m=0;for(var F;R;){if(R.nodeType===3){if(F=m+R.textContent.length,m<=y&&F>=y)return{node:R,offset:y-m};m=F}e:{for(;R;){if(R.nextSibling){R=R.nextSibling;break e}R=R.parentNode}R=void 0}R=Uh(R)}}function Ua(m,y){return m&&y?m===y?!0:m&&m.nodeType===3?!1:y&&y.nodeType===3?Ua(m,y.parentNode):"contains"in m?m.contains(y):m.compareDocumentPosition?!!(m.compareDocumentPosition(y)&16):!1:!1}function fl(){for(var m=window,y=Ar();y instanceof m.HTMLIFrameElement;){try{var R=typeof y.contentWindow.location.href=="string"}catch{R=!1}if(R)m=y.contentWindow;else break;y=Ar(m.document)}return y}function Au(m){var y=m&&m.nodeName&&m.nodeName.toLowerCase();return y&&(y==="input"&&(m.type==="text"||m.type==="search"||m.type==="tel"||m.type==="url"||m.type==="password")||y==="textarea"||m.contentEditable==="true")}function Hh(m){var y=fl(),R=m.focusedElem,F=m.selectionRange;if(y!==R&&R&&R.ownerDocument&&Ua(R.ownerDocument.documentElement,R)){if(F!==null&&Au(R)){if(y=F.start,m=F.end,m===void 0&&(m=y),"selectionStart"in R)R.selectionStart=y,R.selectionEnd=Math.min(m,R.value.length);else if(m=(y=R.ownerDocument||document)&&y.defaultView||window,m.getSelection){m=m.getSelection();var Y=R.textContent.length,ee=Math.min(F.start,Y);F=F.end===void 0?ee:Math.min(F.end,Y),!m.extend&&ee>F&&(Y=F,F=ee,ee=Y),Y=Va(R,ee);var Ce=Va(R,F);Y&&Ce&&(m.rangeCount!==1||m.anchorNode!==Y.node||m.anchorOffset!==Y.offset||m.focusNode!==Ce.node||m.focusOffset!==Ce.offset)&&(y=y.createRange(),y.setStart(Y.node,Y.offset),m.removeAllRanges(),ee>F?(m.addRange(y),m.extend(Ce.node,Ce.offset)):(y.setEnd(Ce.node,Ce.offset),m.addRange(y)))}}for(y=[],m=R;m=m.parentNode;)m.nodeType===1&&y.push({element:m,left:m.scrollLeft,top:m.scrollTop});for(typeof R.focus=="function"&&R.focus(),R=0;R<y.length;R++)m=y[R],m.element.scrollLeft=m.left,m.element.scrollTop=m.top}}var Iu=r&&"documentMode"in document&&11>=document.documentMode,kl=null,pl=null,tc=null,th=!1;function bc(m,y,R){var F=R.window===R?R.document:R.nodeType===9?R:R.ownerDocument;th||kl==null||kl!==Ar(F)||(F=kl,"selectionStart"in F&&Au(F)?F={start:F.selectionStart,end:F.selectionEnd}:(F=(F.ownerDocument&&F.ownerDocument.defaultView||window).getSelection(),F={anchorNode:F.anchorNode,anchorOffset:F.anchorOffset,focusNode:F.focusNode,focusOffset:F.focusOffset}),tc&&xc(tc,F)||(tc=F,F=ml(pl,"onSelect"),0<F.length&&(y=new _o("onSelect","select",null,y,R),m.push({event:y,listeners:F}),y.target=kl)))}function nc(m,y){var R={};return R[m.toLowerCase()]=y.toLowerCase(),R["Webkit"+m]="webkit"+y,R["Moz"+m]="moz"+y,R}var Sa={animationend:nc("Animation","AnimationEnd"),animationiteration:nc("Animation","AnimationIteration"),animationstart:nc("Animation","AnimationStart"),transitionend:nc("Transition","TransitionEnd")},zl={},Ll={};r&&(Ll=document.createElement("div").style,"AnimationEvent"in window||(delete Sa.animationend.animation,delete Sa.animationiteration.animation,delete Sa.animationstart.animation),"TransitionEvent"in window||delete Sa.transitionend.transition);function wc(m){if(zl[m])return zl[m];if(!Sa[m])return m;var y=Sa[m],R;for(R in y)if(y.hasOwnProperty(R)&&R in Ll)return zl[m]=y[R];return m}var nh=wc("animationend"),Wh=wc("animationiteration"),rc=wc("animationstart"),gr=wc("transitionend"),qc=new Map,Dd="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function ic(m,y){qc.set(m,y),z(y,[m])}for(var rh=0;rh<Dd.length;rh++){var Sc=Dd[rh],Li=Sc.toLowerCase(),Mp=Sc[0].toUpperCase()+Sc.slice(1);ic(Li,"on"+Mp)}ic(nh,"onAnimationEnd"),ic(Wh,"onAnimationIteration"),ic(rc,"onAnimationStart"),ic("dblclick","onDoubleClick"),ic("focusin","onFocus"),ic("focusout","onBlur"),ic(gr,"onTransitionEnd"),O("onMouseEnter",["mouseout","mouseover"]),O("onMouseLeave",["mouseout","mouseover"]),O("onPointerEnter",["pointerout","pointerover"]),O("onPointerLeave",["pointerout","pointerover"]),z("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),z("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),z("onBeforeInput",["compositionend","keypress","textInput","paste"]),z("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),z("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),z("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var ih="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),Ap=new Set("cancel close invalid load scroll toggle".split(" ").concat(ih));function Pu(m,y,R){var F=m.type||"unknown-event";m.currentTarget=R,fn(F,y,void 0,m),m.currentTarget=null}function Zc(m,y){y=(y&4)!==0;for(var R=0;R<m.length;R++){var F=m[R],Y=F.event;F=F.listeners;e:{var ee=void 0;if(y)for(var Ce=F.length-1;0<=Ce;Ce--){var ut=F[Ce],St=ut.instance,en=ut.currentTarget;if(ut=ut.listener,St!==ee&&Y.isPropagationStopped())break e;Pu(Y,ut,en),ee=St}else for(Ce=0;Ce<F.length;Ce++){if(ut=F[Ce],St=ut.instance,en=ut.currentTarget,ut=ut.listener,St!==ee&&Y.isPropagationStopped())break e;Pu(Y,ut,en),ee=St}}}if(mt)throw m=wt,mt=!1,wt=null,m}function Qi(m,y){var R=y[Ac];R===void 0&&(R=y[Ac]=new Set);var F=m+"__bubble";R.has(F)||(Rf(y,m,2,!1),R.add(F))}function Ru(m,y,R){var F=0;y&&(F|=4),Rf(R,m,F,y)}var oc="_reactListening"+Math.random().toString(36).slice(2);function Ec(m){if(!m[oc]){m[oc]=!0,_.forEach(function(R){R!=="selectionchange"&&(Ap.has(R)||Ru(R,!1,m),Ru(R,!0,m))});var y=m.nodeType===9?m:m.ownerDocument;y===null||y[oc]||(y[oc]=!0,Ru("selectionchange",!1,y))}}function Rf(m,y,R,F){switch(Eu(y)){case 1:var Y=wi;break;case 4:Y=Pd;break;default:Y=il}R=Y.bind(null,y,R,m),Y=void 0,!He||y!=="touchstart"&&y!=="touchmove"&&y!=="wheel"||(Y=!0),F?Y!==void 0?m.addEventListener(y,R,{capture:!0,passive:Y}):m.addEventListener(y,R,!0):Y!==void 0?m.addEventListener(y,R,{passive:Y}):m.addEventListener(y,R,!1)}function Xc(m,y,R,F,Y){var ee=F;if(!(y&1)&&!(y&2)&&F!==null)e:for(;;){if(F===null)return;var Ce=F.tag;if(Ce===3||Ce===4){var ut=F.stateNode.containerInfo;if(ut===Y||ut.nodeType===8&&ut.parentNode===Y)break;if(Ce===4)for(Ce=F.return;Ce!==null;){var St=Ce.tag;if((St===3||St===4)&&(St=Ce.stateNode.containerInfo,St===Y||St.nodeType===8&&St.parentNode===Y))return;Ce=Ce.return}for(;ut!==null;){if(Ce=Fl(ut),Ce===null)return;if(St=Ce.tag,St===5||St===6){F=ee=Ce;continue e}ut=ut.parentNode}}F=F.return}de(function(){var en=ee,wn=ss(R),Mn=[];e:{var Sn=qc.get(m);if(Sn!==void 0){var rr=_o,fr=m;switch(m){case"keypress":if(ol(R)===0)break e;case"keydown":case"keyup":rr=Fh;break;case"focusin":fr="focus",rr=_c;break;case"focusout":fr="blur",rr=_c;break;case"beforeblur":case"afterblur":rr=_c;break;case"click":if(R.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":rr=Na;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":rr=Ku;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":rr=Mu;break;case nh:case Wh:case rc:rr=kd;break;case gr:rr=Dn;break;case"scroll":rr=wa;break;case"wheel":rr=or;break;case"copy":case"cut":case"paste":rr=Sp;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":rr=Cf}var _r=(y&4)!==0,xs=!_r&&m==="scroll",Wt=_r?Sn!==null?Sn+"Capture":null:Sn;_r=[];for(var Pt=en,Kt;Pt!==null;){Kt=Pt;var On=Kt.stateNode;if(Kt.tag===5&&On!==null&&(Kt=On,Wt!==null&&(On=Se(Pt,Wt),On!=null&&_r.push(sc(Pt,On,Kt)))),xs)break;Pt=Pt.return}0<_r.length&&(Sn=new rr(Sn,fr,null,R,wn),Mn.push({event:Sn,listeners:_r}))}}if(!(y&7)){e:{if(Sn=m==="mouseover"||m==="pointerover",rr=m==="mouseout"||m==="pointerout",Sn&&R!==nr&&(fr=R.relatedTarget||R.fromElement)&&(Fl(fr)||fr[Dl]))break e;if((rr||Sn)&&(Sn=wn.window===wn?wn:(Sn=wn.ownerDocument)?Sn.defaultView||Sn.parentWindow:window,rr?(fr=R.relatedTarget||R.toElement,rr=en,fr=fr?Fl(fr):null,fr!==null&&(xs=on(fr),fr!==xs||fr.tag!==5&&fr.tag!==6)&&(fr=null)):(rr=null,fr=en),rr!==fr)){if(_r=Na,On="onMouseLeave",Wt="onMouseEnter",Pt="mouse",(m==="pointerout"||m==="pointerover")&&(_r=Cf,On="onPointerLeave",Wt="onPointerEnter",Pt="pointer"),xs=rr==null?Sn:ua(rr),Kt=fr==null?Sn:ua(fr),Sn=new _r(On,Pt+"leave",rr,R,wn),Sn.target=xs,Sn.relatedTarget=Kt,On=null,Fl(wn)===en&&(_r=new _r(Wt,Pt+"enter",fr,R,wn),_r.target=Kt,_r.relatedTarget=xs,On=_r),xs=On,rr&&fr)t:{for(_r=rr,Wt=fr,Pt=0,Kt=_r;Kt;Kt=_s(Kt))Pt++;for(Kt=0,On=Wt;On;On=_s(On))Kt++;for(;0<Pt-Kt;)_r=_s(_r),Pt--;for(;0<Kt-Pt;)Wt=_s(Wt),Kt--;for(;Pt--;){if(_r===Wt||Wt!==null&&_r===Wt.alternate)break t;_r=_s(_r),Wt=_s(Wt)}_r=null}else _r=null;rr!==null&&Gh(Mn,Sn,rr,_r,!1),fr!==null&&xs!==null&&Gh(Mn,xs,fr,_r,!0)}}e:{if(Sn=en?ua(en):window,rr=Sn.nodeName&&Sn.nodeName.toLowerCase(),rr==="select"||rr==="input"&&Sn.type==="file")var br=gs;else if(ul(Sn))if(Gc)br=Cp;else{br=If;var Tr=Af}else(rr=Sn.nodeName)&&rr.toLowerCase()==="input"&&(Sn.type==="checkbox"||Sn.type==="radio")&&(br=ec);if(br&&(br=br(m,en))){Jo(Mn,br,R,wn);break e}Tr&&Tr(m,Sn,en),m==="focusout"&&(Tr=Sn._wrapperState)&&Tr.controlled&&Sn.type==="number"&&Gr(Sn,"number",Sn.value)}switch(Tr=en?ua(en):window,m){case"focusin":(ul(Tr)||Tr.contentEditable==="true")&&(kl=Tr,pl=en,tc=null);break;case"focusout":tc=pl=kl=null;break;case"mousedown":th=!0;break;case"contextmenu":case"mouseup":case"dragend":th=!1,bc(Mn,R,wn);break;case"selectionchange":if(Iu)break;case"keydown":case"keyup":bc(Mn,R,wn)}var Vr;if($a)e:{switch(m){case"compositionstart":var ai="onCompositionStart";break e;case"compositionend":ai="onCompositionEnd";break e;case"compositionupdate":ai="onCompositionUpdate";break e}ai=void 0}else ms?Ql(m,R)&&(ai="onCompositionEnd"):m==="keydown"&&R.keyCode===229&&(ai="onCompositionStart");ai&&(Qu&&R.locale!=="ko"&&(ms||ai!=="onCompositionStart"?ai==="onCompositionEnd"&&ms&&(Vr=Oo()):(Os=wn,fs="value"in Os?Os.value:Os.textContent,ms=!0)),Tr=ml(en,ai),0<Tr.length&&(ai=new Tu(ai,m,null,R,wn),Mn.push({event:ai,listeners:Tr}),Vr?ai.data=Vr:(Vr=ps(R),Vr!==null&&(ai.data=Vr)))),(Vr=Nh?eh(m,R):pn(m,R))&&(en=ml(en,"onBeforeInput"),0<en.length&&(wn=new Tu("onBeforeInput","beforeinput",null,R,wn),Mn.push({event:wn,listeners:en}),wn.data=Vr))}Zc(Mn,y)})}function sc(m,y,R){return{instance:m,listener:y,currentTarget:R}}function ml(m,y){for(var R=y+"Capture",F=[];m!==null;){var Y=m,ee=Y.stateNode;Y.tag===5&&ee!==null&&(Y=ee,ee=Se(m,R),ee!=null&&F.unshift(sc(m,ee,Y)),ee=Se(m,y),ee!=null&&F.push(sc(m,ee,Y))),m=m.return}return F}function _s(m){if(m===null)return null;do m=m.return;while(m&&m.tag!==5);return m||null}function Gh(m,y,R,F,Y){for(var ee=y._reactName,Ce=[];R!==null&&R!==F;){var ut=R,St=ut.alternate,en=ut.stateNode;if(St!==null&&St===F)break;ut.tag===5&&en!==null&&(ut=en,Y?(St=Se(R,ee),St!=null&&Ce.unshift(sc(R,St,ut))):Y||(St=Se(R,ee),St!=null&&Ce.push(sc(R,St,ut)))),R=R.return}Ce.length!==0&&m.push({event:y,listeners:Ce})}var Yc=/\r\n?/g,ku=/\u0000|\uFFFD/g;function qh(m){return(typeof m=="string"?m:""+m).replace(Yc,`
`).replace(ku,"")}function Kc(m,y,R){if(y=qh(y),qh(m)!==y&&R)throw Error(f(425))}function Jc(){}var Ol=null,Qc=null;function eu(m,y){return m==="textarea"||m==="noscript"||typeof y.children=="string"||typeof y.children=="number"||typeof y.dangerouslySetInnerHTML=="object"&&y.dangerouslySetInnerHTML!==null&&y.dangerouslySetInnerHTML.__html!=null}var Zh=typeof setTimeout=="function"?setTimeout:void 0,kf=typeof clearTimeout=="function"?clearTimeout:void 0,tu=typeof Promise=="function"?Promise:void 0,oh=typeof queueMicrotask=="function"?queueMicrotask:typeof tu<"u"?function(m){return tu.resolve(null).then(m).catch(nu)}:Zh;function nu(m){setTimeout(function(){throw m})}function Fd(m,y){var R=y,F=0;do{var Y=R.nextSibling;if(m.removeChild(R),Y&&Y.nodeType===8)if(R=Y.data,R==="/$"){if(F===0){m.removeChild(Y),ds(y);return}F--}else R!=="$"&&R!=="$?"&&R!=="$!"||F++;R=Y}while(R);ds(y)}function Tc(m){for(;m!=null;m=m.nextSibling){var y=m.nodeType;if(y===1||y===3)break;if(y===8){if(y=m.data,y==="$"||y==="$!"||y==="$?")break;if(y==="/$")return null}}return m}function zf(m){m=m.previousSibling;for(var y=0;m;){if(m.nodeType===8){var R=m.data;if(R==="$"||R==="$!"||R==="$?"){if(y===0)return m;y--}else R==="/$"&&y++}m=m.previousSibling}return null}var Cc=Math.random().toString(36).slice(2),Ha="__reactFiber$"+Cc,Mc="__reactProps$"+Cc,Dl="__reactContainer$"+Cc,Ac="__reactEvents$"+Cc,Bd="__reactListeners$"+Cc,Nd="__reactHandles$"+Cc;function Fl(m){var y=m[Ha];if(y)return y;for(var R=m.parentNode;R;){if(y=R[Dl]||R[Ha]){if(R=y.alternate,y.child!==null||R!==null&&R.child!==null)for(m=zf(m);m!==null;){if(R=m[Ha])return R;m=zf(m)}return y}m=R,R=m.parentNode}return null}function ca(m){return m=m[Ha]||m[Dl],!m||m.tag!==5&&m.tag!==6&&m.tag!==13&&m.tag!==3?null:m}function ua(m){if(m.tag===5||m.tag===6)return m.stateNode;throw Error(f(33))}function Wa(m){return m[Mc]||null}var gl=[],Ga=-1;function ha(m){return{current:m}}function eo(m){0>Ga||(m.current=gl[Ga],gl[Ga]=null,Ga--)}function to(m,y){Ga++,gl[Ga]=m.current,m.current=y}var Ea={},ys=ha(Ea),Qo=ha(!1),Ks=Ea;function Bl(m,y){var R=m.type.contextTypes;if(!R)return Ea;var F=m.stateNode;if(F&&F.__reactInternalMemoizedUnmaskedChildContext===y)return F.__reactInternalMemoizedMaskedChildContext;var Y={},ee;for(ee in R)Y[ee]=y[ee];return F&&(m=m.stateNode,m.__reactInternalMemoizedUnmaskedChildContext=y,m.__reactInternalMemoizedMaskedChildContext=Y),Y}function Js(m){return m=m.childContextTypes,m!=null}function sh(){eo(Qo),eo(ys)}function zu(m,y,R){if(ys.current!==Ea)throw Error(f(168));to(ys,y),to(Qo,R)}function Lf(m,y,R){var F=m.stateNode;if(y=y.childContextTypes,typeof F.getChildContext!="function")return R;F=F.getChildContext();for(var Y in F)if(!(Y in y))throw Error(f(108,Tn(m)||"Unknown",Y));return Ve({},R,F)}function ru(m){return m=(m=m.stateNode)&&m.__reactInternalMemoizedMergedChildContext||Ea,Ks=ys.current,to(ys,m),to(Qo,Qo.current),!0}function Xh(m,y,R){var F=m.stateNode;if(!F)throw Error(f(169));R?(m=Lf(m,y,Ks),F.__reactInternalMemoizedMergedChildContext=m,eo(Qo),eo(ys),to(ys,m)):eo(Qo),to(Qo,R)}var Ta=null,Ic=!1,_l=!1;function Lu(m){Ta===null?Ta=[m]:Ta.push(m)}function Yh(m){Ic=!0,Lu(m)}function yl(){if(!_l&&Ta!==null){_l=!0;var m=0,y=hi;try{var R=Ta;for(hi=1;m<R.length;m++){var F=R[m];do F=F(!0);while(F!==null)}Ta=null,Ic=!1}catch(Y){throw Ta!==null&&(Ta=Ta.slice(m+1)),lr(so,yl),Y}finally{hi=y,_l=!1}}return null}var Ca=[],xe=0,$=null,ae=0,De=[],qe=0,Dt=null,Qt=1,mn="";function An(m,y){Ca[xe++]=ae,Ca[xe++]=$,$=m,ae=y}function Xt(m,y,R){De[qe++]=Qt,De[qe++]=mn,De[qe++]=Dt,Dt=m;var F=Qt;m=mn;var Y=32-zo(F)-1;F&=~(1<<Y),R+=1;var ee=32-zo(y)+Y;if(30<ee){var Ce=Y-Y%5;ee=(F&(1<<Ce)-1).toString(32),F>>=Ce,Y-=Ce,Qt=1<<32-zo(y)+Y|R<<Y|F,mn=ee+m}else Qt=1<<ee|R<<Y|F,mn=m}function Qn(m){m.return!==null&&(An(m,1),Xt(m,1,0))}function qn(m){for(;m===$;)$=Ca[--xe],Ca[xe]=null,ae=Ca[--xe],Ca[xe]=null;for(;m===Dt;)Dt=De[--qe],De[qe]=null,mn=De[--qe],De[qe]=null,Qt=De[--qe],De[qe]=null}var Rr=null,cr=null,er=!1,vr=null;function Kr(m,y){var R=Lc(5,null,null,0);R.elementType="DELETED",R.stateNode=y,R.return=m,y=m.deletions,y===null?(m.deletions=[R],m.flags|=16):y.push(R)}function Xi(m,y){switch(m.tag){case 5:var R=m.type;return y=y.nodeType!==1||R.toLowerCase()!==y.nodeName.toLowerCase()?null:y,y!==null?(m.stateNode=y,Rr=m,cr=Tc(y.firstChild),!0):!1;case 6:return y=m.pendingProps===""||y.nodeType!==3?null:y,y!==null?(m.stateNode=y,Rr=m,cr=null,!0):!1;case 13:return y=y.nodeType!==8?null:y,y!==null?(R=Dt!==null?{id:Qt,overflow:mn}:null,m.memoizedState={dehydrated:y,treeContext:R,retryLane:1073741824},R=Lc(18,null,null,0),R.stateNode=y,R.return=m,m.child=R,Rr=m,cr=null,!0):!1;default:return!1}}function bi(m){return(m.mode&1)!==0&&(m.flags&128)===0}function di(m){if(er){var y=cr;if(y){var R=y;if(!Xi(m,y)){if(bi(m))throw Error(f(418));y=Tc(R.nextSibling);var F=Rr;y&&Xi(m,y)?Kr(F,R):(m.flags=m.flags&-4097|2,er=!1,Rr=m)}}else{if(bi(m))throw Error(f(418));m.flags=m.flags&-4097|2,er=!1,Rr=m}}}function Ii(m){for(m=m.return;m!==null&&m.tag!==5&&m.tag!==3&&m.tag!==13;)m=m.return;Rr=m}function Jr(m){if(m!==Rr)return!1;if(!er)return Ii(m),er=!0,!1;var y;if((y=m.tag!==3)&&!(y=m.tag!==5)&&(y=m.type,y=y!=="head"&&y!=="body"&&!eu(m.type,m.memoizedProps)),y&&(y=cr)){if(bi(m))throw jr(),Error(f(418));for(;y;)Kr(m,y),y=Tc(y.nextSibling)}if(Ii(m),m.tag===13){if(m=m.memoizedState,m=m!==null?m.dehydrated:null,!m)throw Error(f(317));e:{for(m=m.nextSibling,y=0;m;){if(m.nodeType===8){var R=m.data;if(R==="/$"){if(y===0){cr=Tc(m.nextSibling);break e}y--}else R!=="$"&&R!=="$!"&&R!=="$?"||y++}m=m.nextSibling}cr=null}}else cr=Rr?Tc(m.stateNode.nextSibling):null;return!0}function jr(){for(var m=cr;m;)m=Tc(m.nextSibling)}function ri(){cr=Rr=null,er=!1}function Fi(m){vr===null?vr=[m]:vr.push(m)}var Pi=Ne.ReactCurrentBatchConfig;function no(m,y,R){if(m=R.ref,m!==null&&typeof m!="function"&&typeof m!="object"){if(R._owner){if(R=R._owner,R){if(R.tag!==1)throw Error(f(309));var F=R.stateNode}if(!F)throw Error(f(147,m));var Y=F,ee=""+m;return y!==null&&y.ref!==null&&typeof y.ref=="function"&&y.ref._stringRef===ee?y.ref:(y=function(Ce){var ut=Y.refs;Ce===null?delete ut[ee]:ut[ee]=Ce},y._stringRef=ee,y)}if(typeof m!="string")throw Error(f(284));if(!R._owner)throw Error(f(290,m))}return m}function Ps(m,y){throw m=Object.prototype.toString.call(y),Error(f(31,m==="[object Object]"?"object with keys {"+Object.keys(y).join(", ")+"}":m))}function Ma(m){var y=m._init;return y(m._payload)}function Yi(m){function y(Wt,Pt){if(m){var Kt=Wt.deletions;Kt===null?(Wt.deletions=[Pt],Wt.flags|=16):Kt.push(Pt)}}function R(Wt,Pt){if(!m)return null;for(;Pt!==null;)y(Wt,Pt),Pt=Pt.sibling;return null}function F(Wt,Pt){for(Wt=new Map;Pt!==null;)Pt.key!==null?Wt.set(Pt.key,Pt):Wt.set(Pt.index,Pt),Pt=Pt.sibling;return Wt}function Y(Wt,Pt){return Wt=xh(Wt,Pt),Wt.index=0,Wt.sibling=null,Wt}function ee(Wt,Pt,Kt){return Wt.index=Kt,m?(Kt=Wt.alternate,Kt!==null?(Kt=Kt.index,Kt<Pt?(Wt.flags|=2,Pt):Kt):(Wt.flags|=2,Pt)):(Wt.flags|=1048576,Pt)}function Ce(Wt){return m&&Wt.alternate===null&&(Wt.flags|=2),Wt}function ut(Wt,Pt,Kt,On){return Pt===null||Pt.tag!==6?(Pt=xm(Kt,Wt.mode,On),Pt.return=Wt,Pt):(Pt=Y(Pt,Kt),Pt.return=Wt,Pt)}function St(Wt,Pt,Kt,On){var br=Kt.type;return br===Pe?wn(Wt,Pt,Kt.props.children,On,Kt.key):Pt!==null&&(Pt.elementType===br||typeof br=="object"&&br!==null&&br.$$typeof===xt&&Ma(br)===Pt.type)?(On=Y(Pt,Kt.props),On.ref=no(Wt,Pt,Kt),On.return=Wt,On):(On=Fp(Kt.type,Kt.key,Kt.props,null,Wt.mode,On),On.ref=no(Wt,Pt,Kt),On.return=Wt,On)}function en(Wt,Pt,Kt,On){return Pt===null||Pt.tag!==4||Pt.stateNode.containerInfo!==Kt.containerInfo||Pt.stateNode.implementation!==Kt.implementation?(Pt=bm(Kt,Wt.mode,On),Pt.return=Wt,Pt):(Pt=Y(Pt,Kt.children||[]),Pt.return=Wt,Pt)}function wn(Wt,Pt,Kt,On,br){return Pt===null||Pt.tag!==7?(Pt=fd(Kt,Wt.mode,On,br),Pt.return=Wt,Pt):(Pt=Y(Pt,Kt),Pt.return=Wt,Pt)}function Mn(Wt,Pt,Kt){if(typeof Pt=="string"&&Pt!==""||typeof Pt=="number")return Pt=xm(""+Pt,Wt.mode,Kt),Pt.return=Wt,Pt;if(typeof Pt=="object"&&Pt!==null){switch(Pt.$$typeof){case nt:return Kt=Fp(Pt.type,Pt.key,Pt.props,null,Wt.mode,Kt),Kt.ref=no(Wt,null,Pt),Kt.return=Wt,Kt;case Le:return Pt=bm(Pt,Wt.mode,Kt),Pt.return=Wt,Pt;case xt:var On=Pt._init;return Mn(Wt,On(Pt._payload),Kt)}if(gi(Pt)||vt(Pt))return Pt=fd(Pt,Wt.mode,Kt,null),Pt.return=Wt,Pt;Ps(Wt,Pt)}return null}function Sn(Wt,Pt,Kt,On){var br=Pt!==null?Pt.key:null;if(typeof Kt=="string"&&Kt!==""||typeof Kt=="number")return br!==null?null:ut(Wt,Pt,""+Kt,On);if(typeof Kt=="object"&&Kt!==null){switch(Kt.$$typeof){case nt:return Kt.key===br?St(Wt,Pt,Kt,On):null;case Le:return Kt.key===br?en(Wt,Pt,Kt,On):null;case xt:return br=Kt._init,Sn(Wt,Pt,br(Kt._payload),On)}if(gi(Kt)||vt(Kt))return br!==null?null:wn(Wt,Pt,Kt,On,null);Ps(Wt,Kt)}return null}function rr(Wt,Pt,Kt,On,br){if(typeof On=="string"&&On!==""||typeof On=="number")return Wt=Wt.get(Kt)||null,ut(Pt,Wt,""+On,br);if(typeof On=="object"&&On!==null){switch(On.$$typeof){case nt:return Wt=Wt.get(On.key===null?Kt:On.key)||null,St(Pt,Wt,On,br);case Le:return Wt=Wt.get(On.key===null?Kt:On.key)||null,en(Pt,Wt,On,br);case xt:var Tr=On._init;return rr(Wt,Pt,Kt,Tr(On._payload),br)}if(gi(On)||vt(On))return Wt=Wt.get(Kt)||null,wn(Pt,Wt,On,br,null);Ps(Pt,On)}return null}function fr(Wt,Pt,Kt,On){for(var br=null,Tr=null,Vr=Pt,ai=Pt=0,ga=null;Vr!==null&&ai<Kt.length;ai++){Vr.index>ai?(ga=Vr,Vr=null):ga=Vr.sibling;var ro=Sn(Wt,Vr,Kt[ai],On);if(ro===null){Vr===null&&(Vr=ga);break}m&&Vr&&ro.alternate===null&&y(Wt,Vr),Pt=ee(ro,Pt,ai),Tr===null?br=ro:Tr.sibling=ro,Tr=ro,Vr=ga}if(ai===Kt.length)return R(Wt,Vr),er&&An(Wt,ai),br;if(Vr===null){for(;ai<Kt.length;ai++)Vr=Mn(Wt,Kt[ai],On),Vr!==null&&(Pt=ee(Vr,Pt,ai),Tr===null?br=Vr:Tr.sibling=Vr,Tr=Vr);return er&&An(Wt,ai),br}for(Vr=F(Wt,Vr);ai<Kt.length;ai++)ga=rr(Vr,Wt,ai,Kt[ai],On),ga!==null&&(m&&ga.alternate!==null&&Vr.delete(ga.key===null?ai:ga.key),Pt=ee(ga,Pt,ai),Tr===null?br=ga:Tr.sibling=ga,Tr=ga);return m&&Vr.forEach(function(md){return y(Wt,md)}),er&&An(Wt,ai),br}function _r(Wt,Pt,Kt,On){var br=vt(Kt);if(typeof br!="function")throw Error(f(150));if(Kt=br.call(Kt),Kt==null)throw Error(f(151));for(var Tr=br=null,Vr=Pt,ai=Pt=0,ga=null,ro=Kt.next();Vr!==null&&!ro.done;ai++,ro=Kt.next()){Vr.index>ai?(ga=Vr,Vr=null):ga=Vr.sibling;var md=Sn(Wt,Vr,ro.value,On);if(md===null){Vr===null&&(Vr=ga);break}m&&Vr&&md.alternate===null&&y(Wt,Vr),Pt=ee(md,Pt,ai),Tr===null?br=md:Tr.sibling=md,Tr=md,Vr=ga}if(ro.done)return R(Wt,Vr),er&&An(Wt,ai),br;if(Vr===null){for(;!ro.done;ai++,ro=Kt.next())ro=Mn(Wt,ro.value,On),ro!==null&&(Pt=ee(ro,Pt,ai),Tr===null?br=ro:Tr.sibling=ro,Tr=ro);return er&&An(Wt,ai),br}for(Vr=F(Wt,Vr);!ro.done;ai++,ro=Kt.next())ro=rr(Vr,Wt,ai,ro.value,On),ro!==null&&(m&&ro.alternate!==null&&Vr.delete(ro.key===null?ai:ro.key),Pt=ee(ro,Pt,ai),Tr===null?br=ro:Tr.sibling=ro,Tr=ro);return m&&Vr.forEach(function(Yx){return y(Wt,Yx)}),er&&An(Wt,ai),br}function xs(Wt,Pt,Kt,On){if(typeof Kt=="object"&&Kt!==null&&Kt.type===Pe&&Kt.key===null&&(Kt=Kt.props.children),typeof Kt=="object"&&Kt!==null){switch(Kt.$$typeof){case nt:e:{for(var br=Kt.key,Tr=Pt;Tr!==null;){if(Tr.key===br){if(br=Kt.type,br===Pe){if(Tr.tag===7){R(Wt,Tr.sibling),Pt=Y(Tr,Kt.props.children),Pt.return=Wt,Wt=Pt;break e}}else if(Tr.elementType===br||typeof br=="object"&&br!==null&&br.$$typeof===xt&&Ma(br)===Tr.type){R(Wt,Tr.sibling),Pt=Y(Tr,Kt.props),Pt.ref=no(Wt,Tr,Kt),Pt.return=Wt,Wt=Pt;break e}R(Wt,Tr);break}else y(Wt,Tr);Tr=Tr.sibling}Kt.type===Pe?(Pt=fd(Kt.props.children,Wt.mode,On,Kt.key),Pt.return=Wt,Wt=Pt):(On=Fp(Kt.type,Kt.key,Kt.props,null,Wt.mode,On),On.ref=no(Wt,Pt,Kt),On.return=Wt,Wt=On)}return Ce(Wt);case Le:e:{for(Tr=Kt.key;Pt!==null;){if(Pt.key===Tr)if(Pt.tag===4&&Pt.stateNode.containerInfo===Kt.containerInfo&&Pt.stateNode.implementation===Kt.implementation){R(Wt,Pt.sibling),Pt=Y(Pt,Kt.children||[]),Pt.return=Wt,Wt=Pt;break e}else{R(Wt,Pt);break}else y(Wt,Pt);Pt=Pt.sibling}Pt=bm(Kt,Wt.mode,On),Pt.return=Wt,Wt=Pt}return Ce(Wt);case xt:return Tr=Kt._init,xs(Wt,Pt,Tr(Kt._payload),On)}if(gi(Kt))return fr(Wt,Pt,Kt,On);if(vt(Kt))return _r(Wt,Pt,Kt,On);Ps(Wt,Kt)}return typeof Kt=="string"&&Kt!==""||typeof Kt=="number"?(Kt=""+Kt,Pt!==null&&Pt.tag===6?(R(Wt,Pt.sibling),Pt=Y(Pt,Kt),Pt.return=Wt,Wt=Pt):(R(Wt,Pt),Pt=xm(Kt,Wt.mode,On),Pt.return=Wt,Wt=Pt),Ce(Wt)):R(Wt,Pt)}return xs}var qr=Yi(!0),Ds=Yi(!1),Hi=ha(null),vs=null,Us=null,ac=null;function es(){ac=Us=vs=null}function Ri(m){var y=Hi.current;eo(Hi),m._currentValue=y}function Do(m,y,R){for(;m!==null;){var F=m.alternate;if((m.childLanes&y)!==y?(m.childLanes|=y,F!==null&&(F.childLanes|=y)):F!==null&&(F.childLanes&y)!==y&&(F.childLanes|=y),m===R)break;m=m.return}}function Zt(m,y){vs=m,ac=Us=null,m=m.dependencies,m!==null&&m.firstContext!==null&&(m.lanes&y&&(ea=!0),m.firstContext=null)}function an(m){var y=m._currentValue;if(ac!==m)if(m={context:m,memoizedValue:y,next:null},Us===null){if(vs===null)throw Error(f(308));Us=m,vs.dependencies={lanes:0,firstContext:m}}else Us=Us.next=m;return y}var Qs=null;function $i(m){Qs===null?Qs=[m]:Qs.push(m)}function yt(m,y,R,F){var Y=y.interleaved;return Y===null?(R.next=R,$i(y)):(R.next=Y.next,Y.next=R),y.interleaved=R,Aa(m,F)}function Aa(m,y){m.lanes|=y;var R=m.alternate;for(R!==null&&(R.lanes|=y),R=m,m=m.return;m!==null;)m.childLanes|=y,R=m.alternate,R!==null&&(R.childLanes|=y),R=m,m=m.return;return R.tag===3?R.stateNode:null}var vl=!1;function ah(m){m.updateQueue={baseState:m.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function lh(m,y){m=m.updateQueue,y.updateQueue===m&&(y.updateQueue={baseState:m.baseState,firstBaseUpdate:m.firstBaseUpdate,lastBaseUpdate:m.lastBaseUpdate,shared:m.shared,effects:m.effects})}function Nl(m,y){return{eventTime:m,lane:y,tag:0,payload:null,callback:null,next:null}}function jl(m,y,R){var F=m.updateQueue;if(F===null)return null;if(F=F.shared,ft&2){var Y=F.pending;return Y===null?y.next=y:(y.next=Y.next,Y.next=y),F.pending=y,Aa(m,R)}return Y=F.interleaved,Y===null?(y.next=y,$i(F)):(y.next=Y.next,Y.next=y),F.interleaved=y,Aa(m,R)}function lc(m,y,R){if(y=y.updateQueue,y!==null&&(y=y.shared,(R&4194240)!==0)){var F=y.lanes;F&=m.pendingLanes,R|=F,y.lanes=R,xa(m,R)}}function jd(m,y){var R=m.updateQueue,F=m.alternate;if(F!==null&&(F=F.updateQueue,R===F)){var Y=null,ee=null;if(R=R.firstBaseUpdate,R!==null){do{var Ce={eventTime:R.eventTime,lane:R.lane,tag:R.tag,payload:R.payload,callback:R.callback,next:null};ee===null?Y=ee=Ce:ee=ee.next=Ce,R=R.next}while(R!==null);ee===null?Y=ee=y:ee=ee.next=y}else Y=ee=y;R={baseState:F.baseState,firstBaseUpdate:Y,lastBaseUpdate:ee,shared:F.shared,effects:F.effects},m.updateQueue=R;return}m=R.lastBaseUpdate,m===null?R.firstBaseUpdate=y:m.next=y,R.lastBaseUpdate=y}function $l(m,y,R,F){var Y=m.updateQueue;vl=!1;var ee=Y.firstBaseUpdate,Ce=Y.lastBaseUpdate,ut=Y.shared.pending;if(ut!==null){Y.shared.pending=null;var St=ut,en=St.next;St.next=null,Ce===null?ee=en:Ce.next=en,Ce=St;var wn=m.alternate;wn!==null&&(wn=wn.updateQueue,ut=wn.lastBaseUpdate,ut!==Ce&&(ut===null?wn.firstBaseUpdate=en:ut.next=en,wn.lastBaseUpdate=St))}if(ee!==null){var Mn=Y.baseState;Ce=0,wn=en=St=null,ut=ee;do{var Sn=ut.lane,rr=ut.eventTime;if((F&Sn)===Sn){wn!==null&&(wn=wn.next={eventTime:rr,lane:0,tag:ut.tag,payload:ut.payload,callback:ut.callback,next:null});e:{var fr=m,_r=ut;switch(Sn=y,rr=R,_r.tag){case 1:if(fr=_r.payload,typeof fr=="function"){Mn=fr.call(rr,Mn,Sn);break e}Mn=fr;break e;case 3:fr.flags=fr.flags&-65537|128;case 0:if(fr=_r.payload,Sn=typeof fr=="function"?fr.call(rr,Mn,Sn):fr,Sn==null)break e;Mn=Ve({},Mn,Sn);break e;case 2:vl=!0}}ut.callback!==null&&ut.lane!==0&&(m.flags|=64,Sn=Y.effects,Sn===null?Y.effects=[ut]:Sn.push(ut))}else rr={eventTime:rr,lane:Sn,tag:ut.tag,payload:ut.payload,callback:ut.callback,next:null},wn===null?(en=wn=rr,St=Mn):wn=wn.next=rr,Ce|=Sn;if(ut=ut.next,ut===null){if(ut=Y.shared.pending,ut===null)break;Sn=ut,ut=Sn.next,Sn.next=null,Y.lastBaseUpdate=Sn,Y.shared.pending=null}}while(!0);if(wn===null&&(St=Mn),Y.baseState=St,Y.firstBaseUpdate=en,Y.lastBaseUpdate=wn,y=Y.shared.interleaved,y!==null){Y=y;do Ce|=Y.lane,Y=Y.next;while(Y!==y)}else ee===null&&(Y.shared.lanes=0);Ft|=Ce,m.lanes=Ce,m.memoizedState=Mn}}function Kh(m,y,R){if(m=y.effects,y.effects=null,m!==null)for(y=0;y<m.length;y++){var F=m[y],Y=F.callback;if(Y!==null){if(F.callback=null,F=R,typeof Y!="function")throw Error(f(191,Y));Y.call(F)}}}var cc={},Ho=ha(cc),uc=ha(cc),iu=ha(cc);function Rs(m){if(m===cc)throw Error(f(174));return m}function hc(m,y){switch(to(iu,y),to(uc,m),to(Ho,cc),m=y.nodeType,m){case 9:case 11:y=(y=y.documentElement)?y.namespaceURI:_i(null,"");break;default:m=m===8?y.parentNode:y,y=m.namespaceURI||null,m=m.tagName,y=_i(y,m)}eo(Ho),to(Ho,y)}function Wo(){eo(Ho),eo(uc),eo(iu)}function Jh(m){Rs(iu.current);var y=Rs(Ho.current),R=_i(y,m.type);y!==R&&(to(uc,m),to(Ho,R))}function Qh(m){uc.current===m&&(eo(Ho),eo(uc))}var vi=ha(0);function ed(m){for(var y=m;y!==null;){if(y.tag===13){var R=y.memoizedState;if(R!==null&&(R=R.dehydrated,R===null||R.data==="$?"||R.data==="$!"))return y}else if(y.tag===19&&y.memoizedProps.revealOrder!==void 0){if(y.flags&128)return y}else if(y.child!==null){y.child.return=y,y=y.child;continue}if(y===m)break;for(;y.sibling===null;){if(y.return===null||y.return===m)return null;y=y.return}y.sibling.return=y.return,y=y.sibling}return null}var ou=[];function xi(){for(var m=0;m<ou.length;m++)ou[m]._workInProgressVersionPrimary=null;ou.length=0}var $r=Ne.ReactCurrentDispatcher,ch=Ne.ReactCurrentBatchConfig,Ia=0,yo=null,Fo=null,uo=null,td=!1,xl=!1,Vl=0,Ou=0;function Fs(){throw Error(f(321))}function nd(m,y){if(y===null)return!1;for(var R=0;R<y.length&&R<m.length;R++)if(!la(m[R],y[R]))return!1;return!0}function $d(m,y,R,F,Y,ee){if(Ia=ee,yo=y,y.memoizedState=null,y.updateQueue=null,y.lanes=0,$r.current=m===null||m.memoizedState===null?Pg:vo,m=R(F,Y),xl){ee=0;do{if(xl=!1,Vl=0,25<=ee)throw Error(f(301));ee+=1,uo=Fo=null,y.updateQueue=null,$r.current=pm,m=R(F,Y)}while(xl)}if($r.current=sd,y=Fo!==null&&Fo.next!==null,Ia=0,uo=Fo=yo=null,td=!1,y)throw Error(f(300));return m}function Vd(){var m=Vl!==0;return Vl=0,m}function Ul(){var m={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return uo===null?yo.memoizedState=uo=m:uo=uo.next=m,uo}function Bs(){if(Fo===null){var m=yo.alternate;m=m!==null?m.memoizedState:null}else m=Fo.next;var y=uo===null?yo.memoizedState:uo.next;if(y!==null)uo=y,Fo=m;else{if(m===null)throw Error(f(310));Fo=m,m={memoizedState:Fo.memoizedState,baseState:Fo.baseState,baseQueue:Fo.baseQueue,queue:Fo.queue,next:null},uo===null?yo.memoizedState=uo=m:uo=uo.next=m}return uo}function uh(m,y){return typeof y=="function"?y(m):y}function hh(m){var y=Bs(),R=y.queue;if(R===null)throw Error(f(311));R.lastRenderedReducer=m;var F=Fo,Y=F.baseQueue,ee=R.pending;if(ee!==null){if(Y!==null){var Ce=Y.next;Y.next=ee.next,ee.next=Ce}F.baseQueue=Y=ee,R.pending=null}if(Y!==null){ee=Y.next,F=F.baseState;var ut=Ce=null,St=null,en=ee;do{var wn=en.lane;if((Ia&wn)===wn)St!==null&&(St=St.next={lane:0,action:en.action,hasEagerState:en.hasEagerState,eagerState:en.eagerState,next:null}),F=en.hasEagerState?en.eagerState:m(F,en.action);else{var Mn={lane:wn,action:en.action,hasEagerState:en.hasEagerState,eagerState:en.eagerState,next:null};St===null?(ut=St=Mn,Ce=F):St=St.next=Mn,yo.lanes|=wn,Ft|=wn}en=en.next}while(en!==null&&en!==ee);St===null?Ce=F:St.next=ut,la(F,y.memoizedState)||(ea=!0),y.memoizedState=F,y.baseState=Ce,y.baseQueue=St,R.lastRenderedState=F}if(m=R.interleaved,m!==null){Y=m;do ee=Y.lane,yo.lanes|=ee,Ft|=ee,Y=Y.next;while(Y!==m)}else Y===null&&(R.lanes=0);return[y.memoizedState,R.dispatch]}function Ud(m){var y=Bs(),R=y.queue;if(R===null)throw Error(f(311));R.lastRenderedReducer=m;var F=R.dispatch,Y=R.pending,ee=y.memoizedState;if(Y!==null){R.pending=null;var Ce=Y=Y.next;do ee=m(ee,Ce.action),Ce=Ce.next;while(Ce!==Y);la(ee,y.memoizedState)||(ea=!0),y.memoizedState=ee,y.baseQueue===null&&(y.baseState=ee),R.lastRenderedState=ee}return[ee,F]}function Of(){}function Ns(m,y){var R=yo,F=Bs(),Y=y(),ee=!la(F.memoizedState,Y);if(ee&&(F.memoizedState=Y,ea=!0),F=F.queue,id(bl.bind(null,R,F,m),[m]),F.getSnapshot!==y||ee||uo!==null&&uo.memoizedState.tag&1){if(R.flags|=2048,dh(9,Wd.bind(null,R,F,Y,y),void 0,null),ct===null)throw Error(f(349));Ia&30||Hd(R,y,Y)}return Y}function Hd(m,y,R){m.flags|=16384,m={getSnapshot:y,value:R},y=yo.updateQueue,y===null?(y={lastEffect:null,stores:null},yo.updateQueue=y,y.stores=[m]):(R=y.stores,R===null?y.stores=[m]:R.push(m))}function Wd(m,y,R,F){y.value=R,y.getSnapshot=F,su(y)&&Df(m)}function bl(m,y,R){return R(function(){su(y)&&Df(m)})}function su(m){var y=m.getSnapshot;m=m.value;try{var R=y();return!la(m,R)}catch{return!0}}function Df(m){var y=Aa(m,1);y!==null&&Er(y,m,1,-1)}function Ff(m){var y=Ul();return typeof m=="function"&&(m=m()),y.memoizedState=y.baseState=m,m={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:uh,lastRenderedState:m},y.queue=m,m=m.dispatch=fm.bind(null,yo,m),[y.memoizedState,m]}function dh(m,y,R,F){return m={tag:m,create:y,destroy:R,deps:F,next:null},y=yo.updateQueue,y===null?(y={lastEffect:null,stores:null},yo.updateQueue=y,y.lastEffect=m.next=m):(R=y.lastEffect,R===null?y.lastEffect=m.next=m:(F=R.next,R.next=m,m.next=F,y.lastEffect=m)),m}function Pc(){return Bs().memoizedState}function fh(m,y,R,F){var Y=Ul();yo.flags|=m,Y.memoizedState=dh(1|y,R,void 0,F===void 0?null:F)}function rd(m,y,R,F){var Y=Bs();F=F===void 0?null:F;var ee=void 0;if(Fo!==null){var Ce=Fo.memoizedState;if(ee=Ce.destroy,F!==null&&nd(F,Ce.deps)){Y.memoizedState=dh(y,R,ee,F);return}}yo.flags|=m,Y.memoizedState=dh(1|y,R,ee,F)}function Gd(m,y){return fh(8390656,8,m,y)}function id(m,y){return rd(2048,8,m,y)}function qd(m,y){return rd(4,2,m,y)}function ph(m,y){return rd(4,4,m,y)}function Ip(m,y){if(typeof y=="function")return m=m(),y(m),function(){y(null)};if(y!=null)return m=m(),y.current=m,function(){y.current=null}}function Pp(m,y,R){return R=R!=null?R.concat([m]):null,rd(4,4,Ip.bind(null,y,m),R)}function Bf(){}function Rp(m,y){var R=Bs();y=y===void 0?null:y;var F=R.memoizedState;return F!==null&&y!==null&&nd(y,F[1])?F[0]:(R.memoizedState=[m,y],m)}function kp(m,y){var R=Bs();y=y===void 0?null:y;var F=R.memoizedState;return F!==null&&y!==null&&nd(y,F[1])?F[0]:(m=m(),R.memoizedState=[m,y],m)}function od(m,y,R){return Ia&21?(la(R,y)||(R=mo(),yo.lanes|=R,Ft|=R,m.baseState=!0),y):(m.baseState&&(m.baseState=!1,ea=!0),m.memoizedState=R)}function Zd(m,y){var R=hi;hi=R!==0&&4>R?R:4,m(!0);var F=ch.transition;ch.transition={};try{m(!1),y()}finally{hi=R,ch.transition=F}}function Pa(){return Bs().memoizedState}function Xd(m,y,R){var F=ur(m);if(R={lane:F,action:R,hasEagerState:!1,eagerState:null,next:null},zp(m))Lp(y,R);else if(R=yt(m,y,R,F),R!==null){var Y=Fr();Er(R,m,F,Y),Op(R,y,F)}}function fm(m,y,R){var F=ur(m),Y={lane:F,action:R,hasEagerState:!1,eagerState:null,next:null};if(zp(m))Lp(y,Y);else{var ee=m.alternate;if(m.lanes===0&&(ee===null||ee.lanes===0)&&(ee=y.lastRenderedReducer,ee!==null))try{var Ce=y.lastRenderedState,ut=ee(Ce,R);if(Y.hasEagerState=!0,Y.eagerState=ut,la(ut,Ce)){var St=y.interleaved;St===null?(Y.next=Y,$i(y)):(Y.next=St.next,St.next=Y),y.interleaved=Y;return}}catch{}finally{}R=yt(m,y,Y,F),R!==null&&(Y=Fr(),Er(R,m,F,Y),Op(R,y,F))}}function zp(m){var y=m.alternate;return m===yo||y!==null&&y===yo}function Lp(m,y){xl=td=!0;var R=m.pending;R===null?y.next=y:(y.next=R.next,R.next=y),m.pending=y}function Op(m,y,R){if(R&4194240){var F=y.lanes;F&=m.pendingLanes,R|=F,y.lanes=R,xa(m,R)}}var sd={readContext:an,useCallback:Fs,useContext:Fs,useEffect:Fs,useImperativeHandle:Fs,useInsertionEffect:Fs,useLayoutEffect:Fs,useMemo:Fs,useReducer:Fs,useRef:Fs,useState:Fs,useDebugValue:Fs,useDeferredValue:Fs,useTransition:Fs,useMutableSource:Fs,useSyncExternalStore:Fs,useId:Fs,unstable_isNewReconciler:!1},Pg={readContext:an,useCallback:function(m,y){return Ul().memoizedState=[m,y===void 0?null:y],m},useContext:an,useEffect:Gd,useImperativeHandle:function(m,y,R){return R=R!=null?R.concat([m]):null,fh(4194308,4,Ip.bind(null,y,m),R)},useLayoutEffect:function(m,y){return fh(4194308,4,m,y)},useInsertionEffect:function(m,y){return fh(4,2,m,y)},useMemo:function(m,y){var R=Ul();return y=y===void 0?null:y,m=m(),R.memoizedState=[m,y],m},useReducer:function(m,y,R){var F=Ul();return y=R!==void 0?R(y):y,F.memoizedState=F.baseState=y,m={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:m,lastRenderedState:y},F.queue=m,m=m.dispatch=Xd.bind(null,yo,m),[F.memoizedState,m]},useRef:function(m){var y=Ul();return m={current:m},y.memoizedState=m},useState:Ff,useDebugValue:Bf,useDeferredValue:function(m){return Ul().memoizedState=m},useTransition:function(){var m=Ff(!1),y=m[0];return m=Zd.bind(null,m[1]),Ul().memoizedState=m,[y,m]},useMutableSource:function(){},useSyncExternalStore:function(m,y,R){var F=yo,Y=Ul();if(er){if(R===void 0)throw Error(f(407));R=R()}else{if(R=y(),ct===null)throw Error(f(349));Ia&30||Hd(F,y,R)}Y.memoizedState=R;var ee={value:R,getSnapshot:y};return Y.queue=ee,Gd(bl.bind(null,F,ee,m),[m]),F.flags|=2048,dh(9,Wd.bind(null,F,ee,R,y),void 0,null),R},useId:function(){var m=Ul(),y=ct.identifierPrefix;if(er){var R=mn,F=Qt;R=(F&~(1<<32-zo(F)-1)).toString(32)+R,y=":"+y+"R"+R,R=Vl++,0<R&&(y+="H"+R.toString(32)),y+=":"}else R=Ou++,y=":"+y+"r"+R.toString(32)+":";return m.memoizedState=y},unstable_isNewReconciler:!1},vo={readContext:an,useCallback:Rp,useContext:an,useEffect:id,useImperativeHandle:Pp,useInsertionEffect:qd,useLayoutEffect:ph,useMemo:kp,useReducer:hh,useRef:Pc,useState:function(){return hh(uh)},useDebugValue:Bf,useDeferredValue:function(m){var y=Bs();return od(y,Fo.memoizedState,m)},useTransition:function(){var m=hh(uh)[0],y=Bs().memoizedState;return[m,y]},useMutableSource:Of,useSyncExternalStore:Ns,useId:Pa,unstable_isNewReconciler:!1},pm={readContext:an,useCallback:Rp,useContext:an,useEffect:id,useImperativeHandle:Pp,useInsertionEffect:qd,useLayoutEffect:ph,useMemo:kp,useReducer:Ud,useRef:Pc,useState:function(){return Ud(uh)},useDebugValue:Bf,useDeferredValue:function(m){var y=Bs();return Fo===null?y.memoizedState=m:od(y,Fo.memoizedState,m)},useTransition:function(){var m=Ud(uh)[0],y=Bs().memoizedState;return[m,y]},useMutableSource:Of,useSyncExternalStore:Ns,useId:Pa,unstable_isNewReconciler:!1};function dc(m,y){if(m&&m.defaultProps){y=Ve({},y),m=m.defaultProps;for(var R in m)y[R]===void 0&&(y[R]=m[R]);return y}return y}function Yd(m,y,R,F){y=m.memoizedState,R=R(F,y),R=R==null?y:Ve({},y,R),m.memoizedState=R,m.lanes===0&&(m.updateQueue.baseState=R)}var Du={isMounted:function(m){return(m=m._reactInternals)?on(m)===m:!1},enqueueSetState:function(m,y,R){m=m._reactInternals;var F=Fr(),Y=ur(m),ee=Nl(F,Y);ee.payload=y,R!=null&&(ee.callback=R),y=jl(m,ee,Y),y!==null&&(Er(y,m,Y,F),lc(y,m,Y))},enqueueReplaceState:function(m,y,R){m=m._reactInternals;var F=Fr(),Y=ur(m),ee=Nl(F,Y);ee.tag=1,ee.payload=y,R!=null&&(ee.callback=R),y=jl(m,ee,Y),y!==null&&(Er(y,m,Y,F),lc(y,m,Y))},enqueueForceUpdate:function(m,y){m=m._reactInternals;var R=Fr(),F=ur(m),Y=Nl(R,F);Y.tag=2,y!=null&&(Y.callback=y),y=jl(m,Y,F),y!==null&&(Er(y,m,F,R),lc(y,m,F))}};function Nf(m,y,R,F,Y,ee,Ce){return m=m.stateNode,typeof m.shouldComponentUpdate=="function"?m.shouldComponentUpdate(F,ee,Ce):y.prototype&&y.prototype.isPureReactComponent?!xc(R,F)||!xc(Y,ee):!0}function Kd(m,y,R){var F=!1,Y=Ea,ee=y.contextType;return typeof ee=="object"&&ee!==null?ee=an(ee):(Y=Js(y)?Ks:ys.current,F=y.contextTypes,ee=(F=F!=null)?Bl(m,Y):Ea),y=new y(R,ee),m.memoizedState=y.state!==null&&y.state!==void 0?y.state:null,y.updater=Du,m.stateNode=y,y._reactInternals=m,F&&(m=m.stateNode,m.__reactInternalMemoizedUnmaskedChildContext=Y,m.__reactInternalMemoizedMaskedChildContext=ee),y}function Jd(m,y,R,F){m=y.state,typeof y.componentWillReceiveProps=="function"&&y.componentWillReceiveProps(R,F),typeof y.UNSAFE_componentWillReceiveProps=="function"&&y.UNSAFE_componentWillReceiveProps(R,F),y.state!==m&&Du.enqueueReplaceState(y,y.state,null)}function wl(m,y,R,F){var Y=m.stateNode;Y.props=R,Y.state=m.memoizedState,Y.refs={},ah(m);var ee=y.contextType;typeof ee=="object"&&ee!==null?Y.context=an(ee):(ee=Js(y)?Ks:ys.current,Y.context=Bl(m,ee)),Y.state=m.memoizedState,ee=y.getDerivedStateFromProps,typeof ee=="function"&&(Yd(m,y,ee,R),Y.state=m.memoizedState),typeof y.getDerivedStateFromProps=="function"||typeof Y.getSnapshotBeforeUpdate=="function"||typeof Y.UNSAFE_componentWillMount!="function"&&typeof Y.componentWillMount!="function"||(y=Y.state,typeof Y.componentWillMount=="function"&&Y.componentWillMount(),typeof Y.UNSAFE_componentWillMount=="function"&&Y.UNSAFE_componentWillMount(),y!==Y.state&&Du.enqueueReplaceState(Y,Y.state,null),$l(m,R,Y,F),Y.state=m.memoizedState),typeof Y.componentDidMount=="function"&&(m.flags|=4194308)}function Hl(m,y){try{var R="",F=y;do R+=sn(F),F=F.return;while(F);var Y=R}catch(ee){Y=`
Error generating stack: `+ee.message+`
`+ee.stack}return{value:m,source:y,stack:Y,digest:null}}function xo(m,y,R){return{value:m,source:null,stack:R??null,digest:y??null}}function Wl(m,y){try{console.error(y.value)}catch(R){setTimeout(function(){throw R})}}var jf=typeof WeakMap=="function"?WeakMap:Map;function Qd(m,y,R){R=Nl(-1,R),R.tag=3,R.payload={element:null};var F=y.value;return R.callback=function(){xn||(xn=!0,tr=F),Wl(m,y)},R}function ef(m,y,R){R=Nl(-1,R),R.tag=3;var F=m.type.getDerivedStateFromError;if(typeof F=="function"){var Y=y.value;R.payload=function(){return F(Y)},R.callback=function(){Wl(m,y)}}var ee=m.stateNode;return ee!==null&&typeof ee.componentDidCatch=="function"&&(R.callback=function(){Wl(m,y),typeof F!="function"&&(Ln===null?Ln=new Set([this]):Ln.add(this));var Ce=y.stack;this.componentDidCatch(y.value,{componentStack:Ce!==null?Ce:""})}),R}function mm(m,y,R){var F=m.pingCache;if(F===null){F=m.pingCache=new jf;var Y=new Set;F.set(y,Y)}else Y=F.get(y),Y===void 0&&(Y=new Set,F.set(y,Y));Y.has(R)||(Y.add(R),m=vh.bind(null,m,y,R),y.then(m,m))}function ad(m){do{var y;if((y=m.tag===13)&&(y=m.memoizedState,y=y!==null?y.dehydrated!==null:!0),y)return m;m=m.return}while(m!==null);return null}function gm(m,y,R,F,Y){return m.mode&1?(m.flags|=65536,m.lanes=Y,m):(m===y?m.flags|=65536:(m.flags|=128,R.flags|=131072,R.flags&=-52805,R.tag===1&&(R.alternate===null?R.tag=17:(y=Nl(-1,1),y.tag=2,jl(R,y,1))),R.lanes|=1),m)}var Rg=Ne.ReactCurrentOwner,ea=!1;function ta(m,y,R,F){y.child=m===null?Ds(y,null,R,F):qr(y,m.child,R,F)}function mh(m,y,R,F,Y){R=R.render;var ee=y.ref;return Zt(y,Y),F=$d(m,y,R,F,ee,Y),R=Vd(),m!==null&&!ea?(y.updateQueue=m.updateQueue,y.flags&=-2053,m.lanes&=~Y,ka(m,y,Y)):(er&&R&&Qn(y),y.flags|=1,ta(m,y,F,Y),y.child)}function gh(m,y,R,F,Y){if(m===null){var ee=R.type;return typeof ee=="function"&&!zg(ee)&&ee.defaultProps===void 0&&R.compare===null&&R.defaultProps===void 0?(y.tag=15,y.type=ee,Rc(m,y,ee,F,Y)):(m=Fp(R.type,null,F,y,y.mode,Y),m.ref=y.ref,m.return=y,y.child=m)}if(ee=m.child,!(m.lanes&Y)){var Ce=ee.memoizedProps;if(R=R.compare,R=R!==null?R:xc,R(Ce,F)&&m.ref===y.ref)return ka(m,y,Y)}return y.flags|=1,m=xh(ee,F),m.ref=y.ref,m.return=y,y.child=m}function Rc(m,y,R,F,Y){if(m!==null){var ee=m.memoizedProps;if(xc(ee,F)&&m.ref===y.ref)if(ea=!1,y.pendingProps=F=ee,(m.lanes&Y)!==0)m.flags&131072&&(ea=!0);else return y.lanes=m.lanes,ka(m,y,Y)}return lu(m,y,R,F,Y)}function Gl(m,y,R){var F=y.pendingProps,Y=F.children,ee=m!==null?m.memoizedState:null;if(F.mode==="hidden")if(!(y.mode&1))y.memoizedState={baseLanes:0,cachePool:null,transitions:null},to(Gt,zt),zt|=R;else{if(!(R&1073741824))return m=ee!==null?ee.baseLanes|R:R,y.lanes=y.childLanes=1073741824,y.memoizedState={baseLanes:m,cachePool:null,transitions:null},y.updateQueue=null,to(Gt,zt),zt|=m,null;y.memoizedState={baseLanes:0,cachePool:null,transitions:null},F=ee!==null?ee.baseLanes:R,to(Gt,zt),zt|=F}else ee!==null?(F=ee.baseLanes|R,y.memoizedState=null):F=R,to(Gt,zt),zt|=F;return ta(m,y,Y,R),y.child}function au(m,y){var R=y.ref;(m===null&&R!==null||m!==null&&m.ref!==R)&&(y.flags|=512,y.flags|=2097152)}function lu(m,y,R,F,Y){var ee=Js(R)?Ks:ys.current;return ee=Bl(y,ee),Zt(y,Y),R=$d(m,y,R,F,ee,Y),F=Vd(),m!==null&&!ea?(y.updateQueue=m.updateQueue,y.flags&=-2053,m.lanes&=~Y,ka(m,y,Y)):(er&&F&&Qn(y),y.flags|=1,ta(m,y,R,Y),y.child)}function cu(m,y,R,F,Y){if(Js(R)){var ee=!0;ru(y)}else ee=!1;if(Zt(y,Y),y.stateNode===null)Ra(m,y),Kd(y,R,F),wl(y,R,F,Y),F=!0;else if(m===null){var Ce=y.stateNode,ut=y.memoizedProps;Ce.props=ut;var St=Ce.context,en=R.contextType;typeof en=="object"&&en!==null?en=an(en):(en=Js(R)?Ks:ys.current,en=Bl(y,en));var wn=R.getDerivedStateFromProps,Mn=typeof wn=="function"||typeof Ce.getSnapshotBeforeUpdate=="function";Mn||typeof Ce.UNSAFE_componentWillReceiveProps!="function"&&typeof Ce.componentWillReceiveProps!="function"||(ut!==F||St!==en)&&Jd(y,Ce,F,en),vl=!1;var Sn=y.memoizedState;Ce.state=Sn,$l(y,F,Ce,Y),St=y.memoizedState,ut!==F||Sn!==St||Qo.current||vl?(typeof wn=="function"&&(Yd(y,R,wn,F),St=y.memoizedState),(ut=vl||Nf(y,R,ut,F,Sn,St,en))?(Mn||typeof Ce.UNSAFE_componentWillMount!="function"&&typeof Ce.componentWillMount!="function"||(typeof Ce.componentWillMount=="function"&&Ce.componentWillMount(),typeof Ce.UNSAFE_componentWillMount=="function"&&Ce.UNSAFE_componentWillMount()),typeof Ce.componentDidMount=="function"&&(y.flags|=4194308)):(typeof Ce.componentDidMount=="function"&&(y.flags|=4194308),y.memoizedProps=F,y.memoizedState=St),Ce.props=F,Ce.state=St,Ce.context=en,F=ut):(typeof Ce.componentDidMount=="function"&&(y.flags|=4194308),F=!1)}else{Ce=y.stateNode,lh(m,y),ut=y.memoizedProps,en=y.type===y.elementType?ut:dc(y.type,ut),Ce.props=en,Mn=y.pendingProps,Sn=Ce.context,St=R.contextType,typeof St=="object"&&St!==null?St=an(St):(St=Js(R)?Ks:ys.current,St=Bl(y,St));var rr=R.getDerivedStateFromProps;(wn=typeof rr=="function"||typeof Ce.getSnapshotBeforeUpdate=="function")||typeof Ce.UNSAFE_componentWillReceiveProps!="function"&&typeof Ce.componentWillReceiveProps!="function"||(ut!==Mn||Sn!==St)&&Jd(y,Ce,F,St),vl=!1,Sn=y.memoizedState,Ce.state=Sn,$l(y,F,Ce,Y);var fr=y.memoizedState;ut!==Mn||Sn!==fr||Qo.current||vl?(typeof rr=="function"&&(Yd(y,R,rr,F),fr=y.memoizedState),(en=vl||Nf(y,R,en,F,Sn,fr,St)||!1)?(wn||typeof Ce.UNSAFE_componentWillUpdate!="function"&&typeof Ce.componentWillUpdate!="function"||(typeof Ce.componentWillUpdate=="function"&&Ce.componentWillUpdate(F,fr,St),typeof Ce.UNSAFE_componentWillUpdate=="function"&&Ce.UNSAFE_componentWillUpdate(F,fr,St)),typeof Ce.componentDidUpdate=="function"&&(y.flags|=4),typeof Ce.getSnapshotBeforeUpdate=="function"&&(y.flags|=1024)):(typeof Ce.componentDidUpdate!="function"||ut===m.memoizedProps&&Sn===m.memoizedState||(y.flags|=4),typeof Ce.getSnapshotBeforeUpdate!="function"||ut===m.memoizedProps&&Sn===m.memoizedState||(y.flags|=1024),y.memoizedProps=F,y.memoizedState=fr),Ce.props=F,Ce.state=fr,Ce.context=St,F=en):(typeof Ce.componentDidUpdate!="function"||ut===m.memoizedProps&&Sn===m.memoizedState||(y.flags|=4),typeof Ce.getSnapshotBeforeUpdate!="function"||ut===m.memoizedProps&&Sn===m.memoizedState||(y.flags|=1024),F=!1)}return ld(m,y,R,F,ee,Y)}function ld(m,y,R,F,Y,ee){au(m,y);var Ce=(y.flags&128)!==0;if(!F&&!Ce)return Y&&Xh(y,R,!1),ka(m,y,ee);F=y.stateNode,Rg.current=y;var ut=Ce&&typeof R.getDerivedStateFromError!="function"?null:F.render();return y.flags|=1,m!==null&&Ce?(y.child=qr(y,m.child,null,ee),y.child=qr(y,null,ut,ee)):ta(m,y,ut,ee),y.memoizedState=F.state,Y&&Xh(y,R,!0),y.child}function _m(m){var y=m.stateNode;y.pendingContext?zu(m,y.pendingContext,y.pendingContext!==y.context):y.context&&zu(m,y.context,!1),hc(m,y.containerInfo)}function ym(m,y,R,F,Y){return ri(),Fi(Y),y.flags|=256,ta(m,y,R,F),y.child}var cd={dehydrated:null,treeContext:null,retryLane:0};function $f(m){return{baseLanes:m,cachePool:null,transitions:null}}function Hs(m,y,R){var F=y.pendingProps,Y=vi.current,ee=!1,Ce=(y.flags&128)!==0,ut;if((ut=Ce)||(ut=m!==null&&m.memoizedState===null?!1:(Y&2)!==0),ut?(ee=!0,y.flags&=-129):(m===null||m.memoizedState!==null)&&(Y|=1),to(vi,Y&1),m===null)return di(y),m=y.memoizedState,m!==null&&(m=m.dehydrated,m!==null)?(y.mode&1?m.data==="$!"?y.lanes=8:y.lanes=1073741824:y.lanes=1,null):(Ce=F.children,m=F.fallback,ee?(F=y.mode,ee=y.child,Ce={mode:"hidden",children:Ce},!(F&1)&&ee!==null?(ee.childLanes=0,ee.pendingProps=Ce):ee=Bp(Ce,F,0,null),m=fd(m,F,R,null),ee.return=y,m.return=y,ee.sibling=m,y.child=ee,y.child.memoizedState=$f(R),y.memoizedState=cd,m):tf(y,Ce));if(Y=m.memoizedState,Y!==null&&(ut=Y.dehydrated,ut!==null))return vm(m,y,Ce,F,ut,Y,R);if(ee){ee=F.fallback,Ce=y.mode,Y=m.child,ut=Y.sibling;var St={mode:"hidden",children:F.children};return!(Ce&1)&&y.child!==Y?(F=y.child,F.childLanes=0,F.pendingProps=St,y.deletions=null):(F=xh(Y,St),F.subtreeFlags=Y.subtreeFlags&14680064),ut!==null?ee=xh(ut,ee):(ee=fd(ee,Ce,R,null),ee.flags|=2),ee.return=y,F.return=y,F.sibling=ee,y.child=F,F=ee,ee=y.child,Ce=m.child.memoizedState,Ce=Ce===null?$f(R):{baseLanes:Ce.baseLanes|R,cachePool:null,transitions:Ce.transitions},ee.memoizedState=Ce,ee.childLanes=m.childLanes&~R,y.memoizedState=cd,F}return ee=m.child,m=ee.sibling,F=xh(ee,{mode:"visible",children:F.children}),!(y.mode&1)&&(F.lanes=R),F.return=y,F.sibling=null,m!==null&&(R=y.deletions,R===null?(y.deletions=[m],y.flags|=16):R.push(m)),y.child=F,y.memoizedState=null,F}function tf(m,y){return y=Bp({mode:"visible",children:y},m.mode,0,null),y.return=m,m.child=y}function ud(m,y,R,F){return F!==null&&Fi(F),qr(y,m.child,null,R),m=tf(y,y.pendingProps.children),m.flags|=2,y.memoizedState=null,m}function vm(m,y,R,F,Y,ee,Ce){if(R)return y.flags&256?(y.flags&=-257,F=xo(Error(f(422))),ud(m,y,Ce,F)):y.memoizedState!==null?(y.child=m.child,y.flags|=128,null):(ee=F.fallback,Y=y.mode,F=Bp({mode:"visible",children:F.children},Y,0,null),ee=fd(ee,Y,Ce,null),ee.flags|=2,F.return=y,ee.return=y,F.sibling=ee,y.child=F,y.mode&1&&qr(y,m.child,null,Ce),y.child.memoizedState=$f(Ce),y.memoizedState=cd,ee);if(!(y.mode&1))return ud(m,y,Ce,null);if(Y.data==="$!"){if(F=Y.nextSibling&&Y.nextSibling.dataset,F)var ut=F.dgst;return F=ut,ee=Error(f(419)),F=xo(ee,F,void 0),ud(m,y,Ce,F)}if(ut=(Ce&m.childLanes)!==0,ea||ut){if(F=ct,F!==null){switch(Ce&-Ce){case 4:Y=2;break;case 16:Y=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:Y=32;break;case 536870912:Y=268435456;break;default:Y=0}Y=Y&(F.suspendedLanes|Ce)?0:Y,Y!==0&&Y!==ee.retryLane&&(ee.retryLane=Y,Aa(m,Y),Er(F,m,Y,-1))}return Go(),F=xo(Error(f(421))),ud(m,y,Ce,F)}return Y.data==="$?"?(y.flags|=128,y.child=m.child,y=Dp.bind(null,m),Y._reactRetry=y,null):(m=ee.treeContext,cr=Tc(Y.nextSibling),Rr=y,er=!0,vr=null,m!==null&&(De[qe++]=Qt,De[qe++]=mn,De[qe++]=Dt,Qt=m.id,mn=m.overflow,Dt=y),y=tf(y,F.children),y.flags|=4096,y)}function Fu(m,y,R){m.lanes|=y;var F=m.alternate;F!==null&&(F.lanes|=y),Do(m.return,y,R)}function nf(m,y,R,F,Y){var ee=m.memoizedState;ee===null?m.memoizedState={isBackwards:y,rendering:null,renderingStartTime:0,last:F,tail:R,tailMode:Y}:(ee.isBackwards=y,ee.rendering=null,ee.renderingStartTime=0,ee.last=F,ee.tail=R,ee.tailMode=Y)}function Sl(m,y,R){var F=y.pendingProps,Y=F.revealOrder,ee=F.tail;if(ta(m,y,F.children,R),F=vi.current,F&2)F=F&1|2,y.flags|=128;else{if(m!==null&&m.flags&128)e:for(m=y.child;m!==null;){if(m.tag===13)m.memoizedState!==null&&Fu(m,R,y);else if(m.tag===19)Fu(m,R,y);else if(m.child!==null){m.child.return=m,m=m.child;continue}if(m===y)break e;for(;m.sibling===null;){if(m.return===null||m.return===y)break e;m=m.return}m.sibling.return=m.return,m=m.sibling}F&=1}if(to(vi,F),!(y.mode&1))y.memoizedState=null;else switch(Y){case"forwards":for(R=y.child,Y=null;R!==null;)m=R.alternate,m!==null&&ed(m)===null&&(Y=R),R=R.sibling;R=Y,R===null?(Y=y.child,y.child=null):(Y=R.sibling,R.sibling=null),nf(y,!1,Y,R,ee);break;case"backwards":for(R=null,Y=y.child,y.child=null;Y!==null;){if(m=Y.alternate,m!==null&&ed(m)===null){y.child=Y;break}m=Y.sibling,Y.sibling=R,R=Y,Y=m}nf(y,!0,R,null,ee);break;case"together":nf(y,!1,null,null,void 0);break;default:y.memoizedState=null}return y.child}function Ra(m,y){!(y.mode&1)&&m!==null&&(m.alternate=null,y.alternate=null,y.flags|=2)}function ka(m,y,R){if(m!==null&&(y.dependencies=m.dependencies),Ft|=y.lanes,!(R&y.childLanes))return null;if(m!==null&&y.child!==m.child)throw Error(f(153));if(y.child!==null){for(m=y.child,R=xh(m,m.pendingProps),y.child=R,R.return=y;m.sibling!==null;)m=m.sibling,R=R.sibling=xh(m,m.pendingProps),R.return=y;R.sibling=null}return y.child}function _h(m,y,R){switch(y.tag){case 3:_m(y),ri();break;case 5:Jh(y);break;case 1:Js(y.type)&&ru(y);break;case 4:hc(y,y.stateNode.containerInfo);break;case 10:var F=y.type._context,Y=y.memoizedProps.value;to(Hi,F._currentValue),F._currentValue=Y;break;case 13:if(F=y.memoizedState,F!==null)return F.dehydrated!==null?(to(vi,vi.current&1),y.flags|=128,null):R&y.child.childLanes?Hs(m,y,R):(to(vi,vi.current&1),m=ka(m,y,R),m!==null?m.sibling:null);to(vi,vi.current&1);break;case 19:if(F=(R&y.childLanes)!==0,m.flags&128){if(F)return Sl(m,y,R);y.flags|=128}if(Y=y.memoizedState,Y!==null&&(Y.rendering=null,Y.tail=null,Y.lastEffect=null),to(vi,vi.current),F)break;return null;case 22:case 23:return y.lanes=0,Gl(m,y,R)}return ka(m,y,R)}var yh,rf,Qr,uu;yh=function(m,y){for(var R=y.child;R!==null;){if(R.tag===5||R.tag===6)m.appendChild(R.stateNode);else if(R.tag!==4&&R.child!==null){R.child.return=R,R=R.child;continue}if(R===y)break;for(;R.sibling===null;){if(R.return===null||R.return===y)return;R=R.return}R.sibling.return=R.return,R=R.sibling}},rf=function(){},Qr=function(m,y,R,F){var Y=m.memoizedProps;if(Y!==F){m=y.stateNode,Rs(Ho.current);var ee=null;switch(R){case"input":Y=Ht(m,Y),F=Ht(m,F),ee=[];break;case"select":Y=Ve({},Y,{value:void 0}),F=Ve({},F,{value:void 0}),ee=[];break;case"textarea":Y=ci(m,Y),F=ci(m,F),ee=[];break;default:typeof Y.onClick!="function"&&typeof F.onClick=="function"&&(m.onclick=Jc)}Zi(R,F);var Ce;R=null;for(en in Y)if(!F.hasOwnProperty(en)&&Y.hasOwnProperty(en)&&Y[en]!=null)if(en==="style"){var ut=Y[en];for(Ce in ut)ut.hasOwnProperty(Ce)&&(R||(R={}),R[Ce]="")}else en!=="dangerouslySetInnerHTML"&&en!=="children"&&en!=="suppressContentEditableWarning"&&en!=="suppressHydrationWarning"&&en!=="autoFocus"&&(b.hasOwnProperty(en)?ee||(ee=[]):(ee=ee||[]).push(en,null));for(en in F){var St=F[en];if(ut=Y!=null?Y[en]:void 0,F.hasOwnProperty(en)&&St!==ut&&(St!=null||ut!=null))if(en==="style")if(ut){for(Ce in ut)!ut.hasOwnProperty(Ce)||St&&St.hasOwnProperty(Ce)||(R||(R={}),R[Ce]="");for(Ce in St)St.hasOwnProperty(Ce)&&ut[Ce]!==St[Ce]&&(R||(R={}),R[Ce]=St[Ce])}else R||(ee||(ee=[]),ee.push(en,R)),R=St;else en==="dangerouslySetInnerHTML"?(St=St?St.__html:void 0,ut=ut?ut.__html:void 0,St!=null&&ut!==St&&(ee=ee||[]).push(en,St)):en==="children"?typeof St!="string"&&typeof St!="number"||(ee=ee||[]).push(en,""+St):en!=="suppressContentEditableWarning"&&en!=="suppressHydrationWarning"&&(b.hasOwnProperty(en)?(St!=null&&en==="onScroll"&&Qi("scroll",m),ee||ut===St||(ee=[])):(ee=ee||[]).push(en,St))}R&&(ee=ee||[]).push("style",R);var en=ee;(y.updateQueue=en)&&(y.flags|=4)}},uu=function(m,y,R,F){R!==F&&(y.flags|=4)};function hd(m,y){if(!er)switch(m.tailMode){case"hidden":y=m.tail;for(var R=null;y!==null;)y.alternate!==null&&(R=y),y=y.sibling;R===null?m.tail=null:R.sibling=null;break;case"collapsed":R=m.tail;for(var F=null;R!==null;)R.alternate!==null&&(F=R),R=R.sibling;F===null?y||m.tail===null?m.tail=null:m.tail.sibling=null:F.sibling=null}}function Ws(m){var y=m.alternate!==null&&m.alternate.child===m.child,R=0,F=0;if(y)for(var Y=m.child;Y!==null;)R|=Y.lanes|Y.childLanes,F|=Y.subtreeFlags&14680064,F|=Y.flags&14680064,Y.return=m,Y=Y.sibling;else for(Y=m.child;Y!==null;)R|=Y.lanes|Y.childLanes,F|=Y.subtreeFlags,F|=Y.flags,Y.return=m,Y=Y.sibling;return m.subtreeFlags|=F,m.childLanes=R,y}function of(m,y,R){var F=y.pendingProps;switch(qn(y),y.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Ws(y),null;case 1:return Js(y.type)&&sh(),Ws(y),null;case 3:return F=y.stateNode,Wo(),eo(Qo),eo(ys),xi(),F.pendingContext&&(F.context=F.pendingContext,F.pendingContext=null),(m===null||m.child===null)&&(Jr(y)?y.flags|=4:m===null||m.memoizedState.isDehydrated&&!(y.flags&256)||(y.flags|=1024,vr!==null&&(ts(vr),vr=null))),rf(m,y),Ws(y),null;case 5:Qh(y);var Y=Rs(iu.current);if(R=y.type,m!==null&&y.stateNode!=null)Qr(m,y,R,F,Y),m.ref!==y.ref&&(y.flags|=512,y.flags|=2097152);else{if(!F){if(y.stateNode===null)throw Error(f(166));return Ws(y),null}if(m=Rs(Ho.current),Jr(y)){F=y.stateNode,R=y.type;var ee=y.memoizedProps;switch(F[Ha]=y,F[Mc]=ee,m=(y.mode&1)!==0,R){case"dialog":Qi("cancel",F),Qi("close",F);break;case"iframe":case"object":case"embed":Qi("load",F);break;case"video":case"audio":for(Y=0;Y<ih.length;Y++)Qi(ih[Y],F);break;case"source":Qi("error",F);break;case"img":case"image":case"link":Qi("error",F),Qi("load",F);break;case"details":Qi("toggle",F);break;case"input":Wr(F,ee),Qi("invalid",F);break;case"select":F._wrapperState={wasMultiple:!!ee.multiple},Qi("invalid",F);break;case"textarea":Un(F,ee),Qi("invalid",F)}Zi(R,ee),Y=null;for(var Ce in ee)if(ee.hasOwnProperty(Ce)){var ut=ee[Ce];Ce==="children"?typeof ut=="string"?F.textContent!==ut&&(ee.suppressHydrationWarning!==!0&&Kc(F.textContent,ut,m),Y=["children",ut]):typeof ut=="number"&&F.textContent!==""+ut&&(ee.suppressHydrationWarning!==!0&&Kc(F.textContent,ut,m),Y=["children",""+ut]):b.hasOwnProperty(Ce)&&ut!=null&&Ce==="onScroll"&&Qi("scroll",F)}switch(R){case"input":Hr(F),$n(F,ee,!0);break;case"textarea":Hr(F),Ir(F);break;case"select":case"option":break;default:typeof ee.onClick=="function"&&(F.onclick=Jc)}F=Y,y.updateQueue=F,F!==null&&(y.flags|=4)}else{Ce=Y.nodeType===9?Y:Y.ownerDocument,m==="http://www.w3.org/1999/xhtml"&&(m=ui(R)),m==="http://www.w3.org/1999/xhtml"?R==="script"?(m=Ce.createElement("div"),m.innerHTML="<script><\/script>",m=m.removeChild(m.firstChild)):typeof F.is=="string"?m=Ce.createElement(R,{is:F.is}):(m=Ce.createElement(R),R==="select"&&(Ce=m,F.multiple?Ce.multiple=!0:F.size&&(Ce.size=F.size))):m=Ce.createElementNS(m,R),m[Ha]=y,m[Mc]=F,yh(m,y,!1,!1),y.stateNode=m;e:{switch(Ce=ko(R,F),R){case"dialog":Qi("cancel",m),Qi("close",m),Y=F;break;case"iframe":case"object":case"embed":Qi("load",m),Y=F;break;case"video":case"audio":for(Y=0;Y<ih.length;Y++)Qi(ih[Y],m);Y=F;break;case"source":Qi("error",m),Y=F;break;case"img":case"image":case"link":Qi("error",m),Qi("load",m),Y=F;break;case"details":Qi("toggle",m),Y=F;break;case"input":Wr(m,F),Y=Ht(m,F),Qi("invalid",m);break;case"option":Y=F;break;case"select":m._wrapperState={wasMultiple:!!F.multiple},Y=Ve({},F,{value:void 0}),Qi("invalid",m);break;case"textarea":Un(m,F),Y=ci(m,F),Qi("invalid",m);break;default:Y=F}Zi(R,Y),ut=Y;for(ee in ut)if(ut.hasOwnProperty(ee)){var St=ut[ee];ee==="style"?dr(m,St):ee==="dangerouslySetInnerHTML"?(St=St?St.__html:void 0,St!=null&&yi(m,St)):ee==="children"?typeof St=="string"?(R!=="textarea"||St!=="")&&oi(m,St):typeof St=="number"&&oi(m,""+St):ee!=="suppressContentEditableWarning"&&ee!=="suppressHydrationWarning"&&ee!=="autoFocus"&&(b.hasOwnProperty(ee)?St!=null&&ee==="onScroll"&&Qi("scroll",m):St!=null&&Ie(m,ee,St,Ce))}switch(R){case"input":Hr(m),$n(m,F,!1);break;case"textarea":Hr(m),Ir(m);break;case"option":F.value!=null&&m.setAttribute("value",""+Ut(F.value));break;case"select":m.multiple=!!F.multiple,ee=F.value,ee!=null?Pr(m,!!F.multiple,ee,!1):F.defaultValue!=null&&Pr(m,!!F.multiple,F.defaultValue,!0);break;default:typeof Y.onClick=="function"&&(m.onclick=Jc)}switch(R){case"button":case"input":case"select":case"textarea":F=!!F.autoFocus;break e;case"img":F=!0;break e;default:F=!1}}F&&(y.flags|=4)}y.ref!==null&&(y.flags|=512,y.flags|=2097152)}return Ws(y),null;case 6:if(m&&y.stateNode!=null)uu(m,y,m.memoizedProps,F);else{if(typeof F!="string"&&y.stateNode===null)throw Error(f(166));if(R=Rs(iu.current),Rs(Ho.current),Jr(y)){if(F=y.stateNode,R=y.memoizedProps,F[Ha]=y,(ee=F.nodeValue!==R)&&(m=Rr,m!==null))switch(m.tag){case 3:Kc(F.nodeValue,R,(m.mode&1)!==0);break;case 5:m.memoizedProps.suppressHydrationWarning!==!0&&Kc(F.nodeValue,R,(m.mode&1)!==0)}ee&&(y.flags|=4)}else F=(R.nodeType===9?R:R.ownerDocument).createTextNode(F),F[Ha]=y,y.stateNode=F}return Ws(y),null;case 13:if(eo(vi),F=y.memoizedState,m===null||m.memoizedState!==null&&m.memoizedState.dehydrated!==null){if(er&&cr!==null&&y.mode&1&&!(y.flags&128))jr(),ri(),y.flags|=98560,ee=!1;else if(ee=Jr(y),F!==null&&F.dehydrated!==null){if(m===null){if(!ee)throw Error(f(318));if(ee=y.memoizedState,ee=ee!==null?ee.dehydrated:null,!ee)throw Error(f(317));ee[Ha]=y}else ri(),!(y.flags&128)&&(y.memoizedState=null),y.flags|=4;Ws(y),ee=!1}else vr!==null&&(ts(vr),vr=null),ee=!0;if(!ee)return y.flags&65536?y:null}return y.flags&128?(y.lanes=R,y):(F=F!==null,F!==(m!==null&&m.memoizedState!==null)&&F&&(y.child.flags|=8192,y.mode&1&&(m===null||vi.current&1?Yt===0&&(Yt=3):Go())),y.updateQueue!==null&&(y.flags|=4),Ws(y),null);case 4:return Wo(),rf(m,y),m===null&&Ec(y.stateNode.containerInfo),Ws(y),null;case 10:return Ri(y.type._context),Ws(y),null;case 17:return Js(y.type)&&sh(),Ws(y),null;case 19:if(eo(vi),ee=y.memoizedState,ee===null)return Ws(y),null;if(F=(y.flags&128)!==0,Ce=ee.rendering,Ce===null)if(F)hd(ee,!1);else{if(Yt!==0||m!==null&&m.flags&128)for(m=y.child;m!==null;){if(Ce=ed(m),Ce!==null){for(y.flags|=128,hd(ee,!1),F=Ce.updateQueue,F!==null&&(y.updateQueue=F,y.flags|=4),y.subtreeFlags=0,F=R,R=y.child;R!==null;)ee=R,m=F,ee.flags&=14680066,Ce=ee.alternate,Ce===null?(ee.childLanes=0,ee.lanes=m,ee.child=null,ee.subtreeFlags=0,ee.memoizedProps=null,ee.memoizedState=null,ee.updateQueue=null,ee.dependencies=null,ee.stateNode=null):(ee.childLanes=Ce.childLanes,ee.lanes=Ce.lanes,ee.child=Ce.child,ee.subtreeFlags=0,ee.deletions=null,ee.memoizedProps=Ce.memoizedProps,ee.memoizedState=Ce.memoizedState,ee.updateQueue=Ce.updateQueue,ee.type=Ce.type,m=Ce.dependencies,ee.dependencies=m===null?null:{lanes:m.lanes,firstContext:m.firstContext}),R=R.sibling;return to(vi,vi.current&1|2),y.child}m=m.sibling}ee.tail!==null&&zr()>gn&&(y.flags|=128,F=!0,hd(ee,!1),y.lanes=4194304)}else{if(!F)if(m=ed(Ce),m!==null){if(y.flags|=128,F=!0,R=m.updateQueue,R!==null&&(y.updateQueue=R,y.flags|=4),hd(ee,!0),ee.tail===null&&ee.tailMode==="hidden"&&!Ce.alternate&&!er)return Ws(y),null}else 2*zr()-ee.renderingStartTime>gn&&R!==1073741824&&(y.flags|=128,F=!0,hd(ee,!1),y.lanes=4194304);ee.isBackwards?(Ce.sibling=y.child,y.child=Ce):(R=ee.last,R!==null?R.sibling=Ce:y.child=Ce,ee.last=Ce)}return ee.tail!==null?(y=ee.tail,ee.rendering=y,ee.tail=y.sibling,ee.renderingStartTime=zr(),y.sibling=null,R=vi.current,to(vi,F?R&1|2:R&1),y):(Ws(y),null);case 22:case 23:return ki(),F=y.memoizedState!==null,m!==null&&m.memoizedState!==null!==F&&(y.flags|=8192),F&&y.mode&1?zt&1073741824&&(Ws(y),y.subtreeFlags&6&&(y.flags|=8192)):Ws(y),null;case 24:return null;case 25:return null}throw Error(f(156,y.tag))}function Bu(m,y){switch(qn(y),y.tag){case 1:return Js(y.type)&&sh(),m=y.flags,m&65536?(y.flags=m&-65537|128,y):null;case 3:return Wo(),eo(Qo),eo(ys),xi(),m=y.flags,m&65536&&!(m&128)?(y.flags=m&-65537|128,y):null;case 5:return Qh(y),null;case 13:if(eo(vi),m=y.memoizedState,m!==null&&m.dehydrated!==null){if(y.alternate===null)throw Error(f(340));ri()}return m=y.flags,m&65536?(y.flags=m&-65537|128,y):null;case 19:return eo(vi),null;case 4:return Wo(),null;case 10:return Ri(y.type._context),null;case 22:case 23:return ki(),null;case 24:return null;default:return null}}var ql=!1,Ki=!1,qa=typeof WeakSet=="function"?WeakSet:Set,jn=null;function Nu(m,y){var R=m.ref;if(R!==null)if(typeof R=="function")try{R(null)}catch(F){Wi(m,y,F)}else R.current=null}function da(m,y,R){try{R()}catch(F){Wi(m,y,F)}}var u=!1;function t(m,y){if(Ol=Lo,m=fl(),Au(m)){if("selectionStart"in m)var R={start:m.selectionStart,end:m.selectionEnd};else e:{R=(R=m.ownerDocument)&&R.defaultView||window;var F=R.getSelection&&R.getSelection();if(F&&F.rangeCount!==0){R=F.anchorNode;var Y=F.anchorOffset,ee=F.focusNode;F=F.focusOffset;try{R.nodeType,ee.nodeType}catch{R=null;break e}var Ce=0,ut=-1,St=-1,en=0,wn=0,Mn=m,Sn=null;t:for(;;){for(var rr;Mn!==R||Y!==0&&Mn.nodeType!==3||(ut=Ce+Y),Mn!==ee||F!==0&&Mn.nodeType!==3||(St=Ce+F),Mn.nodeType===3&&(Ce+=Mn.nodeValue.length),(rr=Mn.firstChild)!==null;)Sn=Mn,Mn=rr;for(;;){if(Mn===m)break t;if(Sn===R&&++en===Y&&(ut=Ce),Sn===ee&&++wn===F&&(St=Ce),(rr=Mn.nextSibling)!==null)break;Mn=Sn,Sn=Mn.parentNode}Mn=rr}R=ut===-1||St===-1?null:{start:ut,end:St}}else R=null}R=R||{start:0,end:0}}else R=null;for(Qc={focusedElem:m,selectionRange:R},Lo=!1,jn=y;jn!==null;)if(y=jn,m=y.child,(y.subtreeFlags&1028)!==0&&m!==null)m.return=y,jn=m;else for(;jn!==null;){y=jn;try{var fr=y.alternate;if(y.flags&1024)switch(y.tag){case 0:case 11:case 15:break;case 1:if(fr!==null){var _r=fr.memoizedProps,xs=fr.memoizedState,Wt=y.stateNode,Pt=Wt.getSnapshotBeforeUpdate(y.elementType===y.type?_r:dc(y.type,_r),xs);Wt.__reactInternalSnapshotBeforeUpdate=Pt}break;case 3:var Kt=y.stateNode.containerInfo;Kt.nodeType===1?Kt.textContent="":Kt.nodeType===9&&Kt.documentElement&&Kt.removeChild(Kt.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(f(163))}}catch(On){Wi(y,y.return,On)}if(m=y.sibling,m!==null){m.return=y.return,jn=m;break}jn=y.return}return fr=u,u=!1,fr}function o(m,y,R){var F=y.updateQueue;if(F=F!==null?F.lastEffect:null,F!==null){var Y=F=F.next;do{if((Y.tag&m)===m){var ee=Y.destroy;Y.destroy=void 0,ee!==void 0&&da(y,R,ee)}Y=Y.next}while(Y!==F)}}function h(m,y){if(y=y.updateQueue,y=y!==null?y.lastEffect:null,y!==null){var R=y=y.next;do{if((R.tag&m)===m){var F=R.create;R.destroy=F()}R=R.next}while(R!==y)}}function g(m){var y=m.ref;if(y!==null){var R=m.stateNode;switch(m.tag){case 5:m=R;break;default:m=R}typeof y=="function"?y(m):y.current=m}}function v(m){var y=m.alternate;y!==null&&(m.alternate=null,v(y)),m.child=null,m.deletions=null,m.sibling=null,m.tag===5&&(y=m.stateNode,y!==null&&(delete y[Ha],delete y[Mc],delete y[Ac],delete y[Bd],delete y[Nd])),m.stateNode=null,m.return=null,m.dependencies=null,m.memoizedProps=null,m.memoizedState=null,m.pendingProps=null,m.stateNode=null,m.updateQueue=null}function S(m){return m.tag===5||m.tag===3||m.tag===4}function I(m){e:for(;;){for(;m.sibling===null;){if(m.return===null||S(m.return))return null;m=m.return}for(m.sibling.return=m.return,m=m.sibling;m.tag!==5&&m.tag!==6&&m.tag!==18;){if(m.flags&2||m.child===null||m.tag===4)continue e;m.child.return=m,m=m.child}if(!(m.flags&2))return m.stateNode}}function L(m,y,R){var F=m.tag;if(F===5||F===6)m=m.stateNode,y?R.nodeType===8?R.parentNode.insertBefore(m,y):R.insertBefore(m,y):(R.nodeType===8?(y=R.parentNode,y.insertBefore(m,R)):(y=R,y.appendChild(m)),R=R._reactRootContainer,R!=null||y.onclick!==null||(y.onclick=Jc));else if(F!==4&&(m=m.child,m!==null))for(L(m,y,R),m=m.sibling;m!==null;)L(m,y,R),m=m.sibling}function D(m,y,R){var F=m.tag;if(F===5||F===6)m=m.stateNode,y?R.insertBefore(m,y):R.appendChild(m);else if(F!==4&&(m=m.child,m!==null))for(D(m,y,R),m=m.sibling;m!==null;)D(m,y,R),m=m.sibling}var B=null,V=!1;function U(m,y,R){for(R=R.child;R!==null;)G(m,y,R),R=R.sibling}function G(m,y,R){if(lo&&typeof lo.onCommitFiberUnmount=="function")try{lo.onCommitFiberUnmount(Xs,R)}catch{}switch(R.tag){case 5:Ki||Nu(R,y);case 6:var F=B,Y=V;B=null,U(m,y,R),B=F,V=Y,B!==null&&(V?(m=B,R=R.stateNode,m.nodeType===8?m.parentNode.removeChild(R):m.removeChild(R)):B.removeChild(R.stateNode));break;case 18:B!==null&&(V?(m=B,R=R.stateNode,m.nodeType===8?Fd(m.parentNode,R):m.nodeType===1&&Fd(m,R),ds(m)):Fd(B,R.stateNode));break;case 4:F=B,Y=V,B=R.stateNode.containerInfo,V=!0,U(m,y,R),B=F,V=Y;break;case 0:case 11:case 14:case 15:if(!Ki&&(F=R.updateQueue,F!==null&&(F=F.lastEffect,F!==null))){Y=F=F.next;do{var ee=Y,Ce=ee.destroy;ee=ee.tag,Ce!==void 0&&(ee&2||ee&4)&&da(R,y,Ce),Y=Y.next}while(Y!==F)}U(m,y,R);break;case 1:if(!Ki&&(Nu(R,y),F=R.stateNode,typeof F.componentWillUnmount=="function"))try{F.props=R.memoizedProps,F.state=R.memoizedState,F.componentWillUnmount()}catch(ut){Wi(R,y,ut)}U(m,y,R);break;case 21:U(m,y,R);break;case 22:R.mode&1?(Ki=(F=Ki)||R.memoizedState!==null,U(m,y,R),Ki=F):U(m,y,R);break;default:U(m,y,R)}}function re(m){var y=m.updateQueue;if(y!==null){m.updateQueue=null;var R=m.stateNode;R===null&&(R=m.stateNode=new qa),y.forEach(function(F){var Y=Vf.bind(null,m,F);R.has(F)||(R.add(F),F.then(Y,Y))})}}function Q(m,y){var R=y.deletions;if(R!==null)for(var F=0;F<R.length;F++){var Y=R[F];try{var ee=m,Ce=y,ut=Ce;e:for(;ut!==null;){switch(ut.tag){case 5:B=ut.stateNode,V=!1;break e;case 3:B=ut.stateNode.containerInfo,V=!0;break e;case 4:B=ut.stateNode.containerInfo,V=!0;break e}ut=ut.return}if(B===null)throw Error(f(160));G(ee,Ce,Y),B=null,V=!1;var St=Y.alternate;St!==null&&(St.return=null),Y.return=null}catch(en){Wi(Y,y,en)}}if(y.subtreeFlags&12854)for(y=y.child;y!==null;)ue(y,m),y=y.sibling}function ue(m,y){var R=m.alternate,F=m.flags;switch(m.tag){case 0:case 11:case 14:case 15:if(Q(y,m),ce(m),F&4){try{o(3,m,m.return),h(3,m)}catch(_r){Wi(m,m.return,_r)}try{o(5,m,m.return)}catch(_r){Wi(m,m.return,_r)}}break;case 1:Q(y,m),ce(m),F&512&&R!==null&&Nu(R,R.return);break;case 5:if(Q(y,m),ce(m),F&512&&R!==null&&Nu(R,R.return),m.flags&32){var Y=m.stateNode;try{oi(Y,"")}catch(_r){Wi(m,m.return,_r)}}if(F&4&&(Y=m.stateNode,Y!=null)){var ee=m.memoizedProps,Ce=R!==null?R.memoizedProps:ee,ut=m.type,St=m.updateQueue;if(m.updateQueue=null,St!==null)try{ut==="input"&&ee.type==="radio"&&ee.name!=null&&ar(Y,ee),ko(ut,Ce);var en=ko(ut,ee);for(Ce=0;Ce<St.length;Ce+=2){var wn=St[Ce],Mn=St[Ce+1];wn==="style"?dr(Y,Mn):wn==="dangerouslySetInnerHTML"?yi(Y,Mn):wn==="children"?oi(Y,Mn):Ie(Y,wn,Mn,en)}switch(ut){case"input":pi(Y,ee);break;case"textarea":yn(Y,ee);break;case"select":var Sn=Y._wrapperState.wasMultiple;Y._wrapperState.wasMultiple=!!ee.multiple;var rr=ee.value;rr!=null?Pr(Y,!!ee.multiple,rr,!1):Sn!==!!ee.multiple&&(ee.defaultValue!=null?Pr(Y,!!ee.multiple,ee.defaultValue,!0):Pr(Y,!!ee.multiple,ee.multiple?[]:"",!1))}Y[Mc]=ee}catch(_r){Wi(m,m.return,_r)}}break;case 6:if(Q(y,m),ce(m),F&4){if(m.stateNode===null)throw Error(f(162));Y=m.stateNode,ee=m.memoizedProps;try{Y.nodeValue=ee}catch(_r){Wi(m,m.return,_r)}}break;case 3:if(Q(y,m),ce(m),F&4&&R!==null&&R.memoizedState.isDehydrated)try{ds(y.containerInfo)}catch(_r){Wi(m,m.return,_r)}break;case 4:Q(y,m),ce(m);break;case 13:Q(y,m),ce(m),Y=m.child,Y.flags&8192&&(ee=Y.memoizedState!==null,Y.stateNode.isHidden=ee,!ee||Y.alternate!==null&&Y.alternate.memoizedState!==null||(_n=zr())),F&4&&re(m);break;case 22:if(wn=R!==null&&R.memoizedState!==null,m.mode&1?(Ki=(en=Ki)||wn,Q(y,m),Ki=en):Q(y,m),ce(m),F&8192){if(en=m.memoizedState!==null,(m.stateNode.isHidden=en)&&!wn&&m.mode&1)for(jn=m,wn=m.child;wn!==null;){for(Mn=jn=wn;jn!==null;){switch(Sn=jn,rr=Sn.child,Sn.tag){case 0:case 11:case 14:case 15:o(4,Sn,Sn.return);break;case 1:Nu(Sn,Sn.return);var fr=Sn.stateNode;if(typeof fr.componentWillUnmount=="function"){F=Sn,R=Sn.return;try{y=F,fr.props=y.memoizedProps,fr.state=y.memoizedState,fr.componentWillUnmount()}catch(_r){Wi(F,R,_r)}}break;case 5:Nu(Sn,Sn.return);break;case 22:if(Sn.memoizedState!==null){Fe(Mn);continue}}rr!==null?(rr.return=Sn,jn=rr):Fe(Mn)}wn=wn.sibling}e:for(wn=null,Mn=m;;){if(Mn.tag===5){if(wn===null){wn=Mn;try{Y=Mn.stateNode,en?(ee=Y.style,typeof ee.setProperty=="function"?ee.setProperty("display","none","important"):ee.display="none"):(ut=Mn.stateNode,St=Mn.memoizedProps.style,Ce=St!=null&&St.hasOwnProperty("display")?St.display:null,ut.style.display=mr("display",Ce))}catch(_r){Wi(m,m.return,_r)}}}else if(Mn.tag===6){if(wn===null)try{Mn.stateNode.nodeValue=en?"":Mn.memoizedProps}catch(_r){Wi(m,m.return,_r)}}else if((Mn.tag!==22&&Mn.tag!==23||Mn.memoizedState===null||Mn===m)&&Mn.child!==null){Mn.child.return=Mn,Mn=Mn.child;continue}if(Mn===m)break e;for(;Mn.sibling===null;){if(Mn.return===null||Mn.return===m)break e;wn===Mn&&(wn=null),Mn=Mn.return}wn===Mn&&(wn=null),Mn.sibling.return=Mn.return,Mn=Mn.sibling}}break;case 19:Q(y,m),ce(m),F&4&&re(m);break;case 21:break;default:Q(y,m),ce(m)}}function ce(m){var y=m.flags;if(y&2){try{e:{for(var R=m.return;R!==null;){if(S(R)){var F=R;break e}R=R.return}throw Error(f(160))}switch(F.tag){case 5:var Y=F.stateNode;F.flags&32&&(oi(Y,""),F.flags&=-33);var ee=I(m);D(m,ee,Y);break;case 3:case 4:var Ce=F.stateNode.containerInfo,ut=I(m);L(m,ut,Ce);break;default:throw Error(f(161))}}catch(St){Wi(m,m.return,St)}m.flags&=-3}y&4096&&(m.flags&=-4097)}function ye(m,y,R){jn=m,Ae(m)}function Ae(m,y,R){for(var F=(m.mode&1)!==0;jn!==null;){var Y=jn,ee=Y.child;if(Y.tag===22&&F){var Ce=Y.memoizedState!==null||ql;if(!Ce){var ut=Y.alternate,St=ut!==null&&ut.memoizedState!==null||Ki;ut=ql;var en=Ki;if(ql=Ce,(Ki=St)&&!en)for(jn=Y;jn!==null;)Ce=jn,St=Ce.child,Ce.tag===22&&Ce.memoizedState!==null?ze(Y):St!==null?(St.return=Ce,jn=St):ze(Y);for(;ee!==null;)jn=ee,Ae(ee),ee=ee.sibling;jn=Y,ql=ut,Ki=en}Ee(m)}else Y.subtreeFlags&8772&&ee!==null?(ee.return=Y,jn=ee):Ee(m)}}function Ee(m){for(;jn!==null;){var y=jn;if(y.flags&8772){var R=y.alternate;try{if(y.flags&8772)switch(y.tag){case 0:case 11:case 15:Ki||h(5,y);break;case 1:var F=y.stateNode;if(y.flags&4&&!Ki)if(R===null)F.componentDidMount();else{var Y=y.elementType===y.type?R.memoizedProps:dc(y.type,R.memoizedProps);F.componentDidUpdate(Y,R.memoizedState,F.__reactInternalSnapshotBeforeUpdate)}var ee=y.updateQueue;ee!==null&&Kh(y,ee,F);break;case 3:var Ce=y.updateQueue;if(Ce!==null){if(R=null,y.child!==null)switch(y.child.tag){case 5:R=y.child.stateNode;break;case 1:R=y.child.stateNode}Kh(y,Ce,R)}break;case 5:var ut=y.stateNode;if(R===null&&y.flags&4){R=ut;var St=y.memoizedProps;switch(y.type){case"button":case"input":case"select":case"textarea":St.autoFocus&&R.focus();break;case"img":St.src&&(R.src=St.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(y.memoizedState===null){var en=y.alternate;if(en!==null){var wn=en.memoizedState;if(wn!==null){var Mn=wn.dehydrated;Mn!==null&&ds(Mn)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(f(163))}Ki||y.flags&512&&g(y)}catch(Sn){Wi(y,y.return,Sn)}}if(y===m){jn=null;break}if(R=y.sibling,R!==null){R.return=y.return,jn=R;break}jn=y.return}}function Fe(m){for(;jn!==null;){var y=jn;if(y===m){jn=null;break}var R=y.sibling;if(R!==null){R.return=y.return,jn=R;break}jn=y.return}}function ze(m){for(;jn!==null;){var y=jn;try{switch(y.tag){case 0:case 11:case 15:var R=y.return;try{h(4,y)}catch(St){Wi(y,R,St)}break;case 1:var F=y.stateNode;if(typeof F.componentDidMount=="function"){var Y=y.return;try{F.componentDidMount()}catch(St){Wi(y,Y,St)}}var ee=y.return;try{g(y)}catch(St){Wi(y,ee,St)}break;case 5:var Ce=y.return;try{g(y)}catch(St){Wi(y,Ce,St)}}}catch(St){Wi(y,y.return,St)}if(y===m){jn=null;break}var ut=y.sibling;if(ut!==null){ut.return=y.return,jn=ut;break}jn=y.return}}var Oe=Math.ceil,ke=Ne.ReactCurrentDispatcher,Ge=Ne.ReactCurrentOwner,Ze=Ne.ReactCurrentBatchConfig,ft=0,ct=null,We=null,tt=0,zt=0,Gt=ha(0),Yt=0,dt=null,Ft=0,Et=0,rn=0,Vt=null,kt=null,_n=0,gn=1/0,ln=null,xn=!1,tr=null,Ln=null,Fn=!1,Yn=null,Dr=0,pr=0,Oi=null,Si=-1,si=0;function Fr(){return ft&6?zr():Si!==-1?Si:Si=zr()}function ur(m){return m.mode&1?ft&2&&tt!==0?tt&-tt:Pi.transition!==null?(si===0&&(si=mo()),si):(m=hi,m!==0||(m=window.event,m=m===void 0?16:Eu(m.type)),m):1}function Er(m,y,R,F){if(50<pr)throw pr=0,Oi=null,Error(f(185));Uo(m,R,F),(!(ft&2)||m!==ct)&&(m===ct&&(!(ft&2)&&(Et|=R),Yt===4&&Bo(m,tt)),Bn(m,F),R===1&&ft===0&&!(y.mode&1)&&(gn=zr()+500,Ic&&yl()))}function Bn(m,y){var R=m.callbackNode;Vo(m,y);var F=Cs(m,m===ct?tt:0);if(F===0)R!==null&&Hn(R),m.callbackNode=null,m.callbackPriority=0;else if(y=F&-F,m.callbackPriority!==y){if(R!=null&&Hn(R),y===1)m.tag===0?Yh(ns.bind(null,m)):Lu(ns.bind(null,m)),oh(function(){!(ft&6)&&yl()}),R=null;else{switch(As(F)){case 1:R=so;break;case 4:R=ao;break;case 16:R=zs;break;case 536870912:R=Al;break;default:R=zs}R=_y(R,ii.bind(null,m))}m.callbackPriority=y,m.callbackNode=R}}function ii(m,y){if(Si=-1,si=0,ft&6)throw Error(f(327));var R=m.callbackNode;if(qs()&&m.callbackNode!==R)return null;var F=Cs(m,m===ct?tt:0);if(F===0)return null;if(F&30||F&m.expiredLanes||y)y=Ei(m,F);else{y=F;var Y=ft;ft|=2;var ee=ho();(ct!==m||tt!==y)&&(ln=null,gn=zr()+500,mi(m,y));do try{El();break}catch(ut){Yr(m,ut)}while(!0);es(),ke.current=ee,ft=Y,We!==null?y=0:(ct=null,tt=0,y=Yt)}if(y!==0){if(y===2&&(Y=us(m),Y!==0&&(F=Y,y=Ji(m,Y))),y===1)throw R=dt,mi(m,0),Bo(m,F),Bn(m,zr()),R;if(y===6)Bo(m,F);else{if(Y=m.current.alternate,!(F&30)&&!Za(Y)&&(y=Ei(m,F),y===2&&(ee=us(m),ee!==0&&(F=ee,y=Ji(m,ee))),y===1))throw R=dt,mi(m,0),Bo(m,F),Bn(m,zr()),R;switch(m.finishedWork=Y,m.finishedLanes=F,y){case 0:case 1:throw Error(f(345));case 2:pa(m,kt,ln);break;case 3:if(Bo(m,F),(F&130023424)===F&&(y=_n+500-zr(),10<y)){if(Cs(m,0)!==0)break;if(Y=m.suspendedLanes,(Y&F)!==F){Fr(),m.pingedLanes|=m.suspendedLanes&Y;break}m.timeoutHandle=Zh(pa.bind(null,m,kt,ln),y);break}pa(m,kt,ln);break;case 4:if(Bo(m,F),(F&4194240)===F)break;for(y=m.eventTimes,Y=-1;0<F;){var Ce=31-zo(F);ee=1<<Ce,Ce=y[Ce],Ce>Y&&(Y=Ce),F&=~ee}if(F=Y,F=zr()-F,F=(120>F?120:480>F?480:1080>F?1080:1920>F?1920:3e3>F?3e3:4320>F?4320:1960*Oe(F/1960))-F,10<F){m.timeoutHandle=Zh(pa.bind(null,m,kt,ln),F);break}pa(m,kt,ln);break;case 5:pa(m,kt,ln);break;default:throw Error(f(329))}}}return Bn(m,zr()),m.callbackNode===R?ii.bind(null,m):null}function Ji(m,y){var R=Vt;return m.current.memoizedState.isDehydrated&&(mi(m,y).flags|=256),m=Ei(m,y),m!==2&&(y=kt,kt=R,y!==null&&ts(y)),m}function ts(m){kt===null?kt=m:kt.push.apply(kt,m)}function Za(m){for(var y=m;;){if(y.flags&16384){var R=y.updateQueue;if(R!==null&&(R=R.stores,R!==null))for(var F=0;F<R.length;F++){var Y=R[F],ee=Y.getSnapshot;Y=Y.value;try{if(!la(ee(),Y))return!1}catch{return!1}}}if(R=y.child,y.subtreeFlags&16384&&R!==null)R.return=y,y=R;else{if(y===m)break;for(;y.sibling===null;){if(y.return===null||y.return===m)return!0;y=y.return}y.sibling.return=y.return,y=y.sibling}}return!0}function Bo(m,y){for(y&=~rn,y&=~Et,m.suspendedLanes|=y,m.pingedLanes&=~y,m=m.expirationTimes;0<y;){var R=31-zo(y),F=1<<R;m[R]=-1,y&=~F}}function ns(m){if(ft&6)throw Error(f(327));qs();var y=Cs(m,0);if(!(y&1))return Bn(m,zr()),null;var R=Ei(m,y);if(m.tag!==0&&R===2){var F=us(m);F!==0&&(y=F,R=Ji(m,F))}if(R===1)throw R=dt,mi(m,0),Bo(m,y),Bn(m,zr()),R;if(R===6)throw Error(f(345));return m.finishedWork=m.current.alternate,m.finishedLanes=y,pa(m,kt,ln),Bn(m,zr()),null}function Co(m,y){var R=ft;ft|=1;try{return m(y)}finally{ft=R,ft===0&&(gn=zr()+500,Ic&&yl())}}function Vi(m){Yn!==null&&Yn.tag===0&&!(ft&6)&&qs();var y=ft;ft|=1;var R=Ze.transition,F=hi;try{if(Ze.transition=null,hi=1,m)return m()}finally{hi=F,Ze.transition=R,ft=y,!(ft&6)&&yl()}}function ki(){zt=Gt.current,eo(Gt)}function mi(m,y){m.finishedWork=null,m.finishedLanes=0;var R=m.timeoutHandle;if(R!==-1&&(m.timeoutHandle=-1,kf(R)),We!==null)for(R=We.return;R!==null;){var F=R;switch(qn(F),F.tag){case 1:F=F.type.childContextTypes,F!=null&&sh();break;case 3:Wo(),eo(Qo),eo(ys),xi();break;case 5:Qh(F);break;case 4:Wo();break;case 13:eo(vi);break;case 19:eo(vi);break;case 10:Ri(F.type._context);break;case 22:case 23:ki()}R=R.return}if(ct=m,We=m=xh(m.current,null),tt=zt=y,Yt=0,dt=null,rn=Et=Ft=0,kt=Vt=null,Qs!==null){for(y=0;y<Qs.length;y++)if(R=Qs[y],F=R.interleaved,F!==null){R.interleaved=null;var Y=F.next,ee=R.pending;if(ee!==null){var Ce=ee.next;ee.next=Y,F.next=Ce}R.pending=F}Qs=null}return m}function Yr(m,y){do{var R=We;try{if(es(),$r.current=sd,td){for(var F=yo.memoizedState;F!==null;){var Y=F.queue;Y!==null&&(Y.pending=null),F=F.next}td=!1}if(Ia=0,uo=Fo=yo=null,xl=!1,Vl=0,Ge.current=null,R===null||R.return===null){Yt=1,dt=y,We=null;break}e:{var ee=m,Ce=R.return,ut=R,St=y;if(y=tt,ut.flags|=32768,St!==null&&typeof St=="object"&&typeof St.then=="function"){var en=St,wn=ut,Mn=wn.tag;if(!(wn.mode&1)&&(Mn===0||Mn===11||Mn===15)){var Sn=wn.alternate;Sn?(wn.updateQueue=Sn.updateQueue,wn.memoizedState=Sn.memoizedState,wn.lanes=Sn.lanes):(wn.updateQueue=null,wn.memoizedState=null)}var rr=ad(Ce);if(rr!==null){rr.flags&=-257,gm(rr,Ce,ut,ee,y),rr.mode&1&&mm(ee,en,y),y=rr,St=en;var fr=y.updateQueue;if(fr===null){var _r=new Set;_r.add(St),y.updateQueue=_r}else fr.add(St);break e}else{if(!(y&1)){mm(ee,en,y),Go();break e}St=Error(f(426))}}else if(er&&ut.mode&1){var xs=ad(Ce);if(xs!==null){!(xs.flags&65536)&&(xs.flags|=256),gm(xs,Ce,ut,ee,y),Fi(Hl(St,ut));break e}}ee=St=Hl(St,ut),Yt!==4&&(Yt=2),Vt===null?Vt=[ee]:Vt.push(ee),ee=Ce;do{switch(ee.tag){case 3:ee.flags|=65536,y&=-y,ee.lanes|=y;var Wt=Qd(ee,St,y);jd(ee,Wt);break e;case 1:ut=St;var Pt=ee.type,Kt=ee.stateNode;if(!(ee.flags&128)&&(typeof Pt.getDerivedStateFromError=="function"||Kt!==null&&typeof Kt.componentDidCatch=="function"&&(Ln===null||!Ln.has(Kt)))){ee.flags|=65536,y&=-y,ee.lanes|=y;var On=ef(ee,ut,y);jd(ee,On);break e}}ee=ee.return}while(ee!==null)}kc(R)}catch(br){y=br,We===R&&R!==null&&(We=R=R.return);continue}break}while(!0)}function ho(){var m=ke.current;return ke.current=sd,m===null?sd:m}function Go(){(Yt===0||Yt===3||Yt===2)&&(Yt=4),ct===null||!(Ft&268435455)&&!(Et&268435455)||Bo(ct,tt)}function Ei(m,y){var R=ft;ft|=2;var F=ho();(ct!==m||tt!==y)&&(ln=null,mi(m,y));do try{Gs();break}catch(Y){Yr(m,Y)}while(!0);if(es(),ft=R,ke.current=F,We!==null)throw Error(f(261));return ct=null,tt=0,Yt}function Gs(){for(;We!==null;)fa(We)}function El(){for(;We!==null&&!Br();)fa(We)}function fa(m){var y=kg(m.alternate,m,zt);m.memoizedProps=m.pendingProps,y===null?kc(m):We=y,Ge.current=null}function kc(m){var y=m;do{var R=y.alternate;if(m=y.return,y.flags&32768){if(R=Bu(R,y),R!==null){R.flags&=32767,We=R;return}if(m!==null)m.flags|=32768,m.subtreeFlags=0,m.deletions=null;else{Yt=6,We=null;return}}else if(R=of(R,y,zt),R!==null){We=R;return}if(y=y.sibling,y!==null){We=y;return}We=y=m}while(y!==null);Yt===0&&(Yt=5)}function pa(m,y,R){var F=hi,Y=Ze.transition;try{Ze.transition=null,hi=1,na(m,y,R,F)}finally{Ze.transition=Y,hi=F}return null}function na(m,y,R,F){do qs();while(Yn!==null);if(ft&6)throw Error(f(327));R=m.finishedWork;var Y=m.finishedLanes;if(R===null)return null;if(m.finishedWork=null,m.finishedLanes=0,R===m.current)throw Error(f(177));m.callbackNode=null,m.callbackPriority=0;var ee=R.lanes|R.childLanes;if(va(m,ee),m===ct&&(We=ct=null,tt=0),!(R.subtreeFlags&2064)&&!(R.flags&2064)||Fn||(Fn=!0,_y(zs,function(){return qs(),null})),ee=(R.flags&15990)!==0,R.subtreeFlags&15990||ee){ee=Ze.transition,Ze.transition=null;var Ce=hi;hi=1;var ut=ft;ft|=4,Ge.current=null,t(m,R),ue(R,m),Hh(Qc),Lo=!!Ol,Qc=Ol=null,m.current=R,ye(R),ti(),ft=ut,hi=Ce,Ze.transition=ee}else m.current=R;if(Fn&&(Fn=!1,Yn=m,Dr=Y),ee=m.pendingLanes,ee===0&&(Ln=null),Il(R.stateNode),Bn(m,zr()),y!==null)for(F=m.onRecoverableError,R=0;R<y.length;R++)Y=y[R],F(Y.value,{componentStack:Y.stack,digest:Y.digest});if(xn)throw xn=!1,m=tr,tr=null,m;return Dr&1&&m.tag!==0&&qs(),ee=m.pendingLanes,ee&1?m===Oi?pr++:(pr=0,Oi=m):pr=0,yl(),null}function qs(){if(Yn!==null){var m=As(Dr),y=Ze.transition,R=hi;try{if(Ze.transition=null,hi=16>m?16:m,Yn===null)var F=!1;else{if(m=Yn,Yn=null,Dr=0,ft&6)throw Error(f(331));var Y=ft;for(ft|=4,jn=m.current;jn!==null;){var ee=jn,Ce=ee.child;if(jn.flags&16){var ut=ee.deletions;if(ut!==null){for(var St=0;St<ut.length;St++){var en=ut[St];for(jn=en;jn!==null;){var wn=jn;switch(wn.tag){case 0:case 11:case 15:o(8,wn,ee)}var Mn=wn.child;if(Mn!==null)Mn.return=wn,jn=Mn;else for(;jn!==null;){wn=jn;var Sn=wn.sibling,rr=wn.return;if(v(wn),wn===en){jn=null;break}if(Sn!==null){Sn.return=rr,jn=Sn;break}jn=rr}}}var fr=ee.alternate;if(fr!==null){var _r=fr.child;if(_r!==null){fr.child=null;do{var xs=_r.sibling;_r.sibling=null,_r=xs}while(_r!==null)}}jn=ee}}if(ee.subtreeFlags&2064&&Ce!==null)Ce.return=ee,jn=Ce;else e:for(;jn!==null;){if(ee=jn,ee.flags&2048)switch(ee.tag){case 0:case 11:case 15:o(9,ee,ee.return)}var Wt=ee.sibling;if(Wt!==null){Wt.return=ee.return,jn=Wt;break e}jn=ee.return}}var Pt=m.current;for(jn=Pt;jn!==null;){Ce=jn;var Kt=Ce.child;if(Ce.subtreeFlags&2064&&Kt!==null)Kt.return=Ce,jn=Kt;else e:for(Ce=Pt;jn!==null;){if(ut=jn,ut.flags&2048)try{switch(ut.tag){case 0:case 11:case 15:h(9,ut)}}catch(br){Wi(ut,ut.return,br)}if(ut===Ce){jn=null;break e}var On=ut.sibling;if(On!==null){On.return=ut.return,jn=On;break e}jn=ut.return}}if(ft=Y,yl(),lo&&typeof lo.onPostCommitFiberRoot=="function")try{lo.onPostCommitFiberRoot(Xs,m)}catch{}F=!0}return F}finally{hi=R,Ze.transition=y}}return!1}function zc(m,y,R){y=Hl(R,y),y=Qd(m,y,1),m=jl(m,y,1),y=Fr(),m!==null&&(Uo(m,1,y),Bn(m,y))}function Wi(m,y,R){if(m.tag===3)zc(m,m,R);else for(;y!==null;){if(y.tag===3){zc(y,m,R);break}else if(y.tag===1){var F=y.stateNode;if(typeof y.type.getDerivedStateFromError=="function"||typeof F.componentDidCatch=="function"&&(Ln===null||!Ln.has(F))){m=Hl(R,m),m=ef(y,m,1),y=jl(y,m,1),m=Fr(),y!==null&&(Uo(y,1,m),Bn(y,m));break}}y=y.return}}function vh(m,y,R){var F=m.pingCache;F!==null&&F.delete(y),y=Fr(),m.pingedLanes|=m.suspendedLanes&R,ct===m&&(tt&R)===R&&(Yt===4||Yt===3&&(tt&130023424)===tt&&500>zr()-_n?mi(m,0):rn|=R),Bn(m,y)}function dd(m,y){y===0&&(m.mode&1?(y=co,co<<=1,!(co&130023424)&&(co=4194304)):y=1);var R=Fr();m=Aa(m,y),m!==null&&(Uo(m,y,R),Bn(m,R))}function Dp(m){var y=m.memoizedState,R=0;y!==null&&(R=y.retryLane),dd(m,R)}function Vf(m,y){var R=0;switch(m.tag){case 13:var F=m.stateNode,Y=m.memoizedState;Y!==null&&(R=Y.retryLane);break;case 19:F=m.stateNode;break;default:throw Error(f(314))}F!==null&&F.delete(y),dd(m,R)}var kg;kg=function(m,y,R){if(m!==null)if(m.memoizedProps!==y.pendingProps||Qo.current)ea=!0;else{if(!(m.lanes&R)&&!(y.flags&128))return ea=!1,_h(m,y,R);ea=!!(m.flags&131072)}else ea=!1,er&&y.flags&1048576&&Xt(y,ae,y.index);switch(y.lanes=0,y.tag){case 2:var F=y.type;Ra(m,y),m=y.pendingProps;var Y=Bl(y,ys.current);Zt(y,R),Y=$d(null,y,F,m,Y,R);var ee=Vd();return y.flags|=1,typeof Y=="object"&&Y!==null&&typeof Y.render=="function"&&Y.$$typeof===void 0?(y.tag=1,y.memoizedState=null,y.updateQueue=null,Js(F)?(ee=!0,ru(y)):ee=!1,y.memoizedState=Y.state!==null&&Y.state!==void 0?Y.state:null,ah(y),Y.updater=Du,y.stateNode=Y,Y._reactInternals=y,wl(y,F,m,R),y=ld(null,y,F,!0,ee,R)):(y.tag=0,er&&ee&&Qn(y),ta(null,y,Y,R),y=y.child),y;case 16:F=y.elementType;e:{switch(Ra(m,y),m=y.pendingProps,Y=F._init,F=Y(F._payload),y.type=F,Y=y.tag=vy(F),m=dc(F,m),Y){case 0:y=lu(null,y,F,m,R);break e;case 1:y=cu(null,y,F,m,R);break e;case 11:y=mh(null,y,F,m,R);break e;case 14:y=gh(null,y,F,dc(F.type,m),R);break e}throw Error(f(306,F,""))}return y;case 0:return F=y.type,Y=y.pendingProps,Y=y.elementType===F?Y:dc(F,Y),lu(m,y,F,Y,R);case 1:return F=y.type,Y=y.pendingProps,Y=y.elementType===F?Y:dc(F,Y),cu(m,y,F,Y,R);case 3:e:{if(_m(y),m===null)throw Error(f(387));F=y.pendingProps,ee=y.memoizedState,Y=ee.element,lh(m,y),$l(y,F,null,R);var Ce=y.memoizedState;if(F=Ce.element,ee.isDehydrated)if(ee={element:F,isDehydrated:!1,cache:Ce.cache,pendingSuspenseBoundaries:Ce.pendingSuspenseBoundaries,transitions:Ce.transitions},y.updateQueue.baseState=ee,y.memoizedState=ee,y.flags&256){Y=Hl(Error(f(423)),y),y=ym(m,y,F,R,Y);break e}else if(F!==Y){Y=Hl(Error(f(424)),y),y=ym(m,y,F,R,Y);break e}else for(cr=Tc(y.stateNode.containerInfo.firstChild),Rr=y,er=!0,vr=null,R=Ds(y,null,F,R),y.child=R;R;)R.flags=R.flags&-3|4096,R=R.sibling;else{if(ri(),F===Y){y=ka(m,y,R);break e}ta(m,y,F,R)}y=y.child}return y;case 5:return Jh(y),m===null&&di(y),F=y.type,Y=y.pendingProps,ee=m!==null?m.memoizedProps:null,Ce=Y.children,eu(F,Y)?Ce=null:ee!==null&&eu(F,ee)&&(y.flags|=32),au(m,y),ta(m,y,Ce,R),y.child;case 6:return m===null&&di(y),null;case 13:return Hs(m,y,R);case 4:return hc(y,y.stateNode.containerInfo),F=y.pendingProps,m===null?y.child=qr(y,null,F,R):ta(m,y,F,R),y.child;case 11:return F=y.type,Y=y.pendingProps,Y=y.elementType===F?Y:dc(F,Y),mh(m,y,F,Y,R);case 7:return ta(m,y,y.pendingProps,R),y.child;case 8:return ta(m,y,y.pendingProps.children,R),y.child;case 12:return ta(m,y,y.pendingProps.children,R),y.child;case 10:e:{if(F=y.type._context,Y=y.pendingProps,ee=y.memoizedProps,Ce=Y.value,to(Hi,F._currentValue),F._currentValue=Ce,ee!==null)if(la(ee.value,Ce)){if(ee.children===Y.children&&!Qo.current){y=ka(m,y,R);break e}}else for(ee=y.child,ee!==null&&(ee.return=y);ee!==null;){var ut=ee.dependencies;if(ut!==null){Ce=ee.child;for(var St=ut.firstContext;St!==null;){if(St.context===F){if(ee.tag===1){St=Nl(-1,R&-R),St.tag=2;var en=ee.updateQueue;if(en!==null){en=en.shared;var wn=en.pending;wn===null?St.next=St:(St.next=wn.next,wn.next=St),en.pending=St}}ee.lanes|=R,St=ee.alternate,St!==null&&(St.lanes|=R),Do(ee.return,R,y),ut.lanes|=R;break}St=St.next}}else if(ee.tag===10)Ce=ee.type===y.type?null:ee.child;else if(ee.tag===18){if(Ce=ee.return,Ce===null)throw Error(f(341));Ce.lanes|=R,ut=Ce.alternate,ut!==null&&(ut.lanes|=R),Do(Ce,R,y),Ce=ee.sibling}else Ce=ee.child;if(Ce!==null)Ce.return=ee;else for(Ce=ee;Ce!==null;){if(Ce===y){Ce=null;break}if(ee=Ce.sibling,ee!==null){ee.return=Ce.return,Ce=ee;break}Ce=Ce.return}ee=Ce}ta(m,y,Y.children,R),y=y.child}return y;case 9:return Y=y.type,F=y.pendingProps.children,Zt(y,R),Y=an(Y),F=F(Y),y.flags|=1,ta(m,y,F,R),y.child;case 14:return F=y.type,Y=dc(F,y.pendingProps),Y=dc(F.type,Y),gh(m,y,F,Y,R);case 15:return Rc(m,y,y.type,y.pendingProps,R);case 17:return F=y.type,Y=y.pendingProps,Y=y.elementType===F?Y:dc(F,Y),Ra(m,y),y.tag=1,Js(F)?(m=!0,ru(y)):m=!1,Zt(y,R),Kd(y,F,Y),wl(y,F,Y,R),ld(null,y,F,!0,m,R);case 19:return Sl(m,y,R);case 22:return Gl(m,y,R)}throw Error(f(156,y.tag))};function _y(m,y){return lr(m,y)}function yy(m,y,R,F){this.tag=m,this.key=R,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=y,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=F,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Lc(m,y,R,F){return new yy(m,y,R,F)}function zg(m){return m=m.prototype,!(!m||!m.isReactComponent)}function vy(m){if(typeof m=="function")return zg(m)?1:0;if(m!=null){if(m=m.$$typeof,m===Ct)return 11;if(m===At)return 14}return 2}function xh(m,y){var R=m.alternate;return R===null?(R=Lc(m.tag,y,m.key,m.mode),R.elementType=m.elementType,R.type=m.type,R.stateNode=m.stateNode,R.alternate=m,m.alternate=R):(R.pendingProps=y,R.type=m.type,R.flags=0,R.subtreeFlags=0,R.deletions=null),R.flags=m.flags&14680064,R.childLanes=m.childLanes,R.lanes=m.lanes,R.child=m.child,R.memoizedProps=m.memoizedProps,R.memoizedState=m.memoizedState,R.updateQueue=m.updateQueue,y=m.dependencies,R.dependencies=y===null?null:{lanes:y.lanes,firstContext:y.firstContext},R.sibling=m.sibling,R.index=m.index,R.ref=m.ref,R}function Fp(m,y,R,F,Y,ee){var Ce=2;if(F=m,typeof m=="function")zg(m)&&(Ce=1);else if(typeof m=="string")Ce=5;else e:switch(m){case Pe:return fd(R.children,Y,ee,y);case rt:Ce=8,Y|=8;break;case at:return m=Lc(12,R,y,Y|2),m.elementType=at,m.lanes=ee,m;case Rt:return m=Lc(13,R,y,Y),m.elementType=Rt,m.lanes=ee,m;case Nt:return m=Lc(19,R,y,Y),m.elementType=Nt,m.lanes=ee,m;case gt:return Bp(R,Y,ee,y);default:if(typeof m=="object"&&m!==null)switch(m.$$typeof){case Qe:Ce=10;break e;case lt:Ce=9;break e;case Ct:Ce=11;break e;case At:Ce=14;break e;case xt:Ce=16,F=null;break e}throw Error(f(130,m==null?m:typeof m,""))}return y=Lc(Ce,R,y,Y),y.elementType=m,y.type=F,y.lanes=ee,y}function fd(m,y,R,F){return m=Lc(7,m,F,y),m.lanes=R,m}function Bp(m,y,R,F){return m=Lc(22,m,F,y),m.elementType=gt,m.lanes=R,m.stateNode={isHidden:!1},m}function xm(m,y,R){return m=Lc(6,m,null,y),m.lanes=R,m}function bm(m,y,R){return y=Lc(4,m.children!==null?m.children:[],m.key,y),y.lanes=R,y.stateNode={containerInfo:m.containerInfo,pendingChildren:null,implementation:m.implementation},y}function Lg(m,y,R,F,Y){this.tag=y,this.containerInfo=m,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=Io(0),this.expirationTimes=Io(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Io(0),this.identifierPrefix=F,this.onRecoverableError=Y,this.mutableSourceEagerHydrationData=null}function ju(m,y,R,F,Y,ee,Ce,ut,St){return m=new Lg(m,y,R,ut,St),y===1?(y=1,ee===!0&&(y|=8)):y=0,ee=Lc(3,null,null,y),m.current=ee,ee.stateNode=m,ee.memoizedState={element:F,isDehydrated:R,cache:null,transitions:null,pendingSuspenseBoundaries:null},ah(ee),m}function ma(m,y,R){var F=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:Le,key:F==null?null:""+F,children:m,containerInfo:y,implementation:R}}function Og(m){if(!m)return Ea;m=m._reactInternals;e:{if(on(m)!==m||m.tag!==1)throw Error(f(170));var y=m;do{switch(y.tag){case 3:y=y.stateNode.context;break e;case 1:if(Js(y.type)){y=y.stateNode.__reactInternalMemoizedMergedChildContext;break e}}y=y.return}while(y!==null);throw Error(f(171))}if(m.tag===1){var R=m.type;if(Js(R))return Lf(m,R,y)}return y}function Uf(m,y,R,F,Y,ee,Ce,ut,St){return m=ju(R,F,!0,m,Y,ee,Ce,ut,St),m.context=Og(null),R=m.current,F=Fr(),Y=ur(R),ee=Nl(F,Y),ee.callback=y??null,jl(R,ee,Y),m.current.lanes=Y,Uo(m,Y,F),Bn(m,F),m}function wm(m,y,R,F){var Y=y.current,ee=Fr(),Ce=ur(Y);return R=Og(R),y.context===null?y.context=R:y.pendingContext=R,y=Nl(ee,Ce),y.payload={element:m},F=F===void 0?null:F,F!==null&&(y.callback=F),m=jl(Y,y,Ce),m!==null&&(Er(m,Y,Ce,ee),lc(m,Y,Ce)),Ce}function Sm(m){if(m=m.current,!m.child)return null;switch(m.child.tag){case 5:return m.child.stateNode;default:return m.child.stateNode}}function Hf(m,y){if(m=m.memoizedState,m!==null&&m.dehydrated!==null){var R=m.retryLane;m.retryLane=R!==0&&R<y?R:y}}function Em(m,y){Hf(m,y),(m=m.alternate)&&Hf(m,y)}var pd=typeof reportError=="function"?reportError:function(m){console.error(m)};function sf(m){this._internalRoot=m}Tm.prototype.render=sf.prototype.render=function(m){var y=this._internalRoot;if(y===null)throw Error(f(409));wm(m,y,null,null)},Tm.prototype.unmount=sf.prototype.unmount=function(){var m=this._internalRoot;if(m!==null){this._internalRoot=null;var y=m.containerInfo;Vi(function(){wm(null,m,null,null)}),y[Dl]=null}};function Tm(m){this._internalRoot=m}Tm.prototype.unstable_scheduleHydration=function(m){if(m){var y=Ls();m={blockedOn:null,target:m,priority:y};for(var R=0;R<Eo.length&&y!==0&&y<Eo[R].priority;R++);Eo.splice(R,0,m),R===0&&Xn(m)}};function Dg(m){return!(!m||m.nodeType!==1&&m.nodeType!==9&&m.nodeType!==11)}function Cm(m){return!(!m||m.nodeType!==1&&m.nodeType!==9&&m.nodeType!==11&&(m.nodeType!==8||m.nodeValue!==" react-mount-point-unstable "))}function xy(){}function qx(m,y,R,F,Y){if(Y){if(typeof F=="function"){var ee=F;F=function(){var en=Sm(Ce);ee.call(en)}}var Ce=Uf(y,F,m,0,null,!1,!1,"",xy);return m._reactRootContainer=Ce,m[Dl]=Ce.current,Ec(m.nodeType===8?m.parentNode:m),Vi(),Ce}for(;Y=m.lastChild;)m.removeChild(Y);if(typeof F=="function"){var ut=F;F=function(){var en=Sm(St);ut.call(en)}}var St=ju(m,0,!1,null,null,!1,!1,"",xy);return m._reactRootContainer=St,m[Dl]=St.current,Ec(m.nodeType===8?m.parentNode:m),Vi(function(){wm(y,St,R,F)}),St}function Mm(m,y,R,F,Y){var ee=R._reactRootContainer;if(ee){var Ce=ee;if(typeof Y=="function"){var ut=Y;Y=function(){var St=Sm(Ce);ut.call(St)}}wm(y,Ce,m,Y)}else Ce=qx(R,y,m,Y,F);return Sm(Ce)}nl=function(m){switch(m.tag){case 3:var y=m.stateNode;if(y.current.memoizedState.isDehydrated){var R=So(y.pendingLanes);R!==0&&(xa(y,R|1),Bn(y,zr()),!(ft&6)&&(gn=zr()+500,yl()))}break;case 13:Vi(function(){var F=Aa(m,1);if(F!==null){var Y=Fr();Er(F,m,1,Y)}}),Em(m,1)}},Oa=function(m){if(m.tag===13){var y=Aa(m,134217728);if(y!==null){var R=Fr();Er(y,m,134217728,R)}Em(m,134217728)}},go=function(m){if(m.tag===13){var y=ur(m),R=Aa(m,y);if(R!==null){var F=Fr();Er(R,m,y,F)}Em(m,y)}},Ls=function(){return hi},Ys=function(m,y){var R=hi;try{return hi=m,y()}finally{hi=R}},Vs=function(m,y,R){switch(y){case"input":if(pi(m,R),y=R.name,R.type==="radio"&&y!=null){for(R=m;R.parentNode;)R=R.parentNode;for(R=R.querySelectorAll("input[name="+JSON.stringify(""+y)+'][type="radio"]'),y=0;y<R.length;y++){var F=R[y];if(F!==m&&F.form===m.form){var Y=Wa(F);if(!Y)throw Error(f(90));Nr(F),pi(F,Y)}}}break;case"textarea":yn(m,R);break;case"select":y=R.value,y!=null&&Pr(m,!!R.multiple,y,!1)}},oo=Co,bt=Vi;var Zx={usingClientEntryPoint:!1,Events:[ca,ua,Wa,Ao,Ts,Co]},af={findFiberByHostInstance:Fl,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},Xx={bundleType:af.bundleType,version:af.version,rendererPackageName:af.rendererPackageName,rendererConfig:af.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:Ne.ReactCurrentDispatcher,findHostInstanceByFiber:function(m){return m=In(m),m===null?null:m.stateNode},findFiberByHostInstance:af.findFiberByHostInstance,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var bh=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!bh.isDisabled&&bh.supportsFiber)try{Xs=bh.inject(Xx),lo=bh}catch{}}return Dc.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=Zx,Dc.createPortal=function(m,y){var R=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!Dg(y))throw Error(f(200));return ma(m,y,null,R)},Dc.createRoot=function(m,y){if(!Dg(m))throw Error(f(299));var R=!1,F="",Y=pd;return y!=null&&(y.unstable_strictMode===!0&&(R=!0),y.identifierPrefix!==void 0&&(F=y.identifierPrefix),y.onRecoverableError!==void 0&&(Y=y.onRecoverableError)),y=ju(m,1,!1,null,null,R,!1,F,Y),m[Dl]=y.current,Ec(m.nodeType===8?m.parentNode:m),new sf(y)},Dc.findDOMNode=function(m){if(m==null)return null;if(m.nodeType===1)return m;var y=m._reactInternals;if(y===void 0)throw typeof m.render=="function"?Error(f(188)):(m=Object.keys(m).join(","),Error(f(268,m)));return m=In(y),m=m===null?null:m.stateNode,m},Dc.flushSync=function(m){return Vi(m)},Dc.hydrate=function(m,y,R){if(!Cm(y))throw Error(f(200));return Mm(null,m,y,!0,R)},Dc.hydrateRoot=function(m,y,R){if(!Dg(m))throw Error(f(405));var F=R!=null&&R.hydratedSources||null,Y=!1,ee="",Ce=pd;if(R!=null&&(R.unstable_strictMode===!0&&(Y=!0),R.identifierPrefix!==void 0&&(ee=R.identifierPrefix),R.onRecoverableError!==void 0&&(Ce=R.onRecoverableError)),y=Uf(y,null,m,1,R??null,Y,!1,ee,Ce),m[Dl]=y.current,Ec(m),F)for(m=0;m<F.length;m++)R=F[m],Y=R._getVersion,Y=Y(R._source),y.mutableSourceEagerHydrationData==null?y.mutableSourceEagerHydrationData=[R,Y]:y.mutableSourceEagerHydrationData.push(R,Y);return new Tm(y)},Dc.render=function(m,y,R){if(!Cm(y))throw Error(f(200));return Mm(null,m,y,!1,R)},Dc.unmountComponentAtNode=function(m){if(!Cm(m))throw Error(f(40));return m._reactRootContainer?(Vi(function(){Mm(null,null,m,!1,function(){m._reactRootContainer=null,m[Dl]=null})}),!0):!1},Dc.unstable_batchedUpdates=Co,Dc.unstable_renderSubtreeIntoContainer=function(m,y,R,F){if(!Cm(R))throw Error(f(200));if(m==null||m._reactInternals===void 0)throw Error(f(38));return Mm(m,y,R,!1,F)},Dc.version="18.3.1-next-f1338f8080-20240426",Dc}var RC;function NA(){if(RC)return a1.exports;RC=1;function i(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(i)}catch(l){console.error(l)}}return i(),a1.exports=Rz(),a1.exports}var kC;function kz(){if(kC)return lv;kC=1;var i=NA();return lv.createRoot=i.createRoot,lv.hydrateRoot=i.hydrateRoot,lv}var zz=kz(),bv={exports:{}};/*!
  * Bootstrap v5.3.3 (https://getbootstrap.com/)
  * Copyright 2011-2024 The Bootstrap Authors (https://github.com/twbs/bootstrap/graphs/contributors)
  * Licensed under MIT (https://github.com/twbs/bootstrap/blob/main/LICENSE)
  */var Lz=bv.exports,zC;function Oz(){return zC||(zC=1,function(i,l){(function(f,_){i.exports=_()})(Lz,function(){const f=new Map,_={set(xe,$,ae){f.has(xe)||f.set(xe,new Map);const De=f.get(xe);De.has($)||De.size===0?De.set($,ae):console.error(`Bootstrap doesn't allow more than one instance per element. Bound instance: ${Array.from(De.keys())[0]}.`)},get:(xe,$)=>f.has(xe)&&f.get(xe).get($)||null,remove(xe,$){if(!f.has(xe))return;const ae=f.get(xe);ae.delete($),ae.size===0&&f.delete(xe)}},b="transitionend",z=xe=>(xe&&window.CSS&&window.CSS.escape&&(xe=xe.replace(/#([^\s"#']+)/g,($,ae)=>`#${CSS.escape(ae)}`)),xe),O=xe=>{xe.dispatchEvent(new Event(b))},r=xe=>!(!xe||typeof xe!="object")&&(xe.jquery!==void 0&&(xe=xe[0]),xe.nodeType!==void 0),H=xe=>r(xe)?xe.jquery?xe[0]:xe:typeof xe=="string"&&xe.length>0?document.querySelector(z(xe)):null,Z=xe=>{if(!r(xe)||xe.getClientRects().length===0)return!1;const $=getComputedStyle(xe).getPropertyValue("visibility")==="visible",ae=xe.closest("details:not([open])");if(!ae)return $;if(ae!==xe){const De=xe.closest("summary");if(De&&De.parentNode!==ae||De===null)return!1}return $},K=xe=>!xe||xe.nodeType!==Node.ELEMENT_NODE||!!xe.classList.contains("disabled")||(xe.disabled!==void 0?xe.disabled:xe.hasAttribute("disabled")&&xe.getAttribute("disabled")!=="false"),te=xe=>{if(!document.documentElement.attachShadow)return null;if(typeof xe.getRootNode=="function"){const $=xe.getRootNode();return $ instanceof ShadowRoot?$:null}return xe instanceof ShadowRoot?xe:xe.parentNode?te(xe.parentNode):null},le=()=>{},Te=xe=>{xe.offsetHeight},pe=()=>window.jQuery&&!document.body.hasAttribute("data-bs-no-jquery")?window.jQuery:null,ge=[],fe=()=>document.documentElement.dir==="rtl",me=xe=>{var $;$=()=>{const ae=pe();if(ae){const De=xe.NAME,qe=ae.fn[De];ae.fn[De]=xe.jQueryInterface,ae.fn[De].Constructor=xe,ae.fn[De].noConflict=()=>(ae.fn[De]=qe,xe.jQueryInterface)}},document.readyState==="loading"?(ge.length||document.addEventListener("DOMContentLoaded",()=>{for(const ae of ge)ae()}),ge.push($)):$()},_e=(xe,$=[],ae=xe)=>typeof xe=="function"?xe(...$):ae,Ie=(xe,$,ae=!0)=>{if(!ae)return void _e(xe);const De=(Qt=>{if(!Qt)return 0;let{transitionDuration:mn,transitionDelay:An}=window.getComputedStyle(Qt);const Xt=Number.parseFloat(mn),Qn=Number.parseFloat(An);return Xt||Qn?(mn=mn.split(",")[0],An=An.split(",")[0],1e3*(Number.parseFloat(mn)+Number.parseFloat(An))):0})($)+5;let qe=!1;const Dt=({target:Qt})=>{Qt===$&&(qe=!0,$.removeEventListener(b,Dt),_e(xe))};$.addEventListener(b,Dt),setTimeout(()=>{qe||O($)},De)},Ne=(xe,$,ae,De)=>{const qe=xe.length;let Dt=xe.indexOf($);return Dt===-1?!ae&&De?xe[qe-1]:xe[0]:(Dt+=ae?1:-1,De&&(Dt=(Dt+qe)%qe),xe[Math.max(0,Math.min(Dt,qe-1))])},nt=/[^.]*(?=\..*)\.|.*/,Le=/\..*/,Pe=/::\d+$/,rt={};let at=1;const Qe={mouseenter:"mouseover",mouseleave:"mouseout"},lt=new Set(["click","dblclick","mouseup","mousedown","contextmenu","mousewheel","DOMMouseScroll","mouseover","mouseout","mousemove","selectstart","selectend","keydown","keypress","keyup","orientationchange","touchstart","touchmove","touchend","touchcancel","pointerdown","pointermove","pointerup","pointerleave","pointercancel","gesturestart","gesturechange","gestureend","focus","blur","change","reset","select","submit","focusin","focusout","load","unload","beforeunload","resize","move","DOMContentLoaded","readystatechange","error","abort","scroll"]);function Ct(xe,$){return $&&`${$}::${at++}`||xe.uidEvent||at++}function Rt(xe){const $=Ct(xe);return xe.uidEvent=$,rt[$]=rt[$]||{},rt[$]}function Nt(xe,$,ae=null){return Object.values(xe).find(De=>De.callable===$&&De.delegationSelector===ae)}function At(xe,$,ae){const De=typeof $=="string",qe=De?ae:$||ae;let Dt=vt(xe);return lt.has(Dt)||(Dt=xe),[De,qe,Dt]}function xt(xe,$,ae,De,qe){if(typeof $!="string"||!xe)return;let[Dt,Qt,mn]=At($,ae,De);$ in Qe&&(Qt=(er=>function(vr){if(!vr.relatedTarget||vr.relatedTarget!==vr.delegateTarget&&!vr.delegateTarget.contains(vr.relatedTarget))return er.call(this,vr)})(Qt));const An=Rt(xe),Xt=An[mn]||(An[mn]={}),Qn=Nt(Xt,Qt,Dt?ae:null);if(Qn)return void(Qn.oneOff=Qn.oneOff&&qe);const qn=Ct(Qt,$.replace(nt,"")),Rr=Dt?function(cr,er,vr){return function Kr(Xi){const bi=cr.querySelectorAll(er);for(let{target:di}=Xi;di&&di!==this;di=di.parentNode)for(const Ii of bi)if(Ii===di)return je(Xi,{delegateTarget:di}),Kr.oneOff&&Ve.off(cr,Xi.type,er,vr),vr.apply(di,[Xi])}}(xe,ae,Qt):function(cr,er){return function vr(Kr){return je(Kr,{delegateTarget:cr}),vr.oneOff&&Ve.off(cr,Kr.type,er),er.apply(cr,[Kr])}}(xe,Qt);Rr.delegationSelector=Dt?ae:null,Rr.callable=Qt,Rr.oneOff=qe,Rr.uidEvent=qn,Xt[qn]=Rr,xe.addEventListener(mn,Rr,Dt)}function gt(xe,$,ae,De,qe){const Dt=Nt($[ae],De,qe);Dt&&(xe.removeEventListener(ae,Dt,!!qe),delete $[ae][Dt.uidEvent])}function ht(xe,$,ae,De){const qe=$[ae]||{};for(const[Dt,Qt]of Object.entries(qe))Dt.includes(De)&&gt(xe,$,ae,Qt.callable,Qt.delegationSelector)}function vt(xe){return xe=xe.replace(Le,""),Qe[xe]||xe}const Ve={on(xe,$,ae,De){xt(xe,$,ae,De,!1)},one(xe,$,ae,De){xt(xe,$,ae,De,!0)},off(xe,$,ae,De){if(typeof $!="string"||!xe)return;const[qe,Dt,Qt]=At($,ae,De),mn=Qt!==$,An=Rt(xe),Xt=An[Qt]||{},Qn=$.startsWith(".");if(Dt===void 0){if(Qn)for(const qn of Object.keys(An))ht(xe,An,qn,$.slice(1));for(const[qn,Rr]of Object.entries(Xt)){const cr=qn.replace(Pe,"");mn&&!$.includes(cr)||gt(xe,An,Qt,Rr.callable,Rr.delegationSelector)}}else{if(!Object.keys(Xt).length)return;gt(xe,An,Qt,Dt,qe?ae:null)}},trigger(xe,$,ae){if(typeof $!="string"||!xe)return null;const De=pe();let qe=null,Dt=!0,Qt=!0,mn=!1;$!==vt($)&&De&&(qe=De.Event($,ae),De(xe).trigger(qe),Dt=!qe.isPropagationStopped(),Qt=!qe.isImmediatePropagationStopped(),mn=qe.isDefaultPrevented());const An=je(new Event($,{bubbles:Dt,cancelable:!0}),ae);return mn&&An.preventDefault(),Qt&&xe.dispatchEvent(An),An.defaultPrevented&&qe&&qe.preventDefault(),An}};function je(xe,$={}){for(const[ae,De]of Object.entries($))try{xe[ae]=De}catch{Object.defineProperty(xe,ae,{configurable:!0,get:()=>De})}return xe}function it(xe){if(xe==="true")return!0;if(xe==="false")return!1;if(xe===Number(xe).toString())return Number(xe);if(xe===""||xe==="null")return null;if(typeof xe!="string")return xe;try{return JSON.parse(decodeURIComponent(xe))}catch{return xe}}function Mt(xe){return xe.replace(/[A-Z]/g,$=>`-${$.toLowerCase()}`)}const Ot={setDataAttribute(xe,$,ae){xe.setAttribute(`data-bs-${Mt($)}`,ae)},removeDataAttribute(xe,$){xe.removeAttribute(`data-bs-${Mt($)}`)},getDataAttributes(xe){if(!xe)return{};const $={},ae=Object.keys(xe.dataset).filter(De=>De.startsWith("bs")&&!De.startsWith("bsConfig"));for(const De of ae){let qe=De.replace(/^bs/,"");qe=qe.charAt(0).toLowerCase()+qe.slice(1,qe.length),$[qe]=it(xe.dataset[De])}return $},getDataAttribute:(xe,$)=>it(xe.getAttribute(`data-bs-${Mt($)}`))};class sn{static get Default(){return{}}static get DefaultType(){return{}}static get NAME(){throw new Error('You have to implement the static method "NAME", for each component!')}_getConfig($){return $=this._mergeConfigObj($),$=this._configAfterMerge($),this._typeCheckConfig($),$}_configAfterMerge($){return $}_mergeConfigObj($,ae){const De=r(ae)?Ot.getDataAttribute(ae,"config"):{};return{...this.constructor.Default,...typeof De=="object"?De:{},...r(ae)?Ot.getDataAttributes(ae):{},...typeof $=="object"?$:{}}}_typeCheckConfig($,ae=this.constructor.DefaultType){for(const[qe,Dt]of Object.entries(ae)){const Qt=$[qe],mn=r(Qt)?"element":(De=Qt)==null?`${De}`:Object.prototype.toString.call(De).match(/\s([a-z]+)/i)[1].toLowerCase();if(!new RegExp(Dt).test(mn))throw new TypeError(`${this.constructor.NAME.toUpperCase()}: Option "${qe}" provided type "${mn}" but expected type "${Dt}".`)}var De}}class hn extends sn{constructor($,ae){super(),($=H($))&&(this._element=$,this._config=this._getConfig(ae),_.set(this._element,this.constructor.DATA_KEY,this))}dispose(){_.remove(this._element,this.constructor.DATA_KEY),Ve.off(this._element,this.constructor.EVENT_KEY);for(const $ of Object.getOwnPropertyNames(this))this[$]=null}_queueCallback($,ae,De=!0){Ie($,ae,De)}_getConfig($){return $=this._mergeConfigObj($,this._element),$=this._configAfterMerge($),this._typeCheckConfig($),$}static getInstance($){return _.get(H($),this.DATA_KEY)}static getOrCreateInstance($,ae={}){return this.getInstance($)||new this($,typeof ae=="object"?ae:null)}static get VERSION(){return"5.3.3"}static get DATA_KEY(){return`bs.${this.NAME}`}static get EVENT_KEY(){return`.${this.DATA_KEY}`}static eventName($){return`${$}${this.EVENT_KEY}`}}const Tn=xe=>{let $=xe.getAttribute("data-bs-target");if(!$||$==="#"){let ae=xe.getAttribute("href");if(!ae||!ae.includes("#")&&!ae.startsWith("."))return null;ae.includes("#")&&!ae.startsWith("#")&&(ae=`#${ae.split("#")[1]}`),$=ae&&ae!=="#"?ae.trim():null}return $?$.split(",").map(ae=>z(ae)).join(","):null},Ut={find:(xe,$=document.documentElement)=>[].concat(...Element.prototype.querySelectorAll.call($,xe)),findOne:(xe,$=document.documentElement)=>Element.prototype.querySelector.call($,xe),children:(xe,$)=>[].concat(...xe.children).filter(ae=>ae.matches($)),parents(xe,$){const ae=[];let De=xe.parentNode.closest($);for(;De;)ae.push(De),De=De.parentNode.closest($);return ae},prev(xe,$){let ae=xe.previousElementSibling;for(;ae;){if(ae.matches($))return[ae];ae=ae.previousElementSibling}return[]},next(xe,$){let ae=xe.nextElementSibling;for(;ae;){if(ae.matches($))return[ae];ae=ae.nextElementSibling}return[]},focusableChildren(xe){const $=["a","button","input","textarea","select","details","[tabindex]",'[contenteditable="true"]'].map(ae=>`${ae}:not([tabindex^="-"])`).join(",");return this.find($,xe).filter(ae=>!K(ae)&&Z(ae))},getSelectorFromElement(xe){const $=Tn(xe);return $&&Ut.findOne($)?$:null},getElementFromSelector(xe){const $=Tn(xe);return $?Ut.findOne($):null},getMultipleElementsFromSelector(xe){const $=Tn(xe);return $?Ut.find($):[]}},bn=(xe,$="hide")=>{const ae=`click.dismiss${xe.EVENT_KEY}`,De=xe.NAME;Ve.on(document,ae,`[data-bs-dismiss="${De}"]`,function(qe){if(["A","AREA"].includes(this.tagName)&&qe.preventDefault(),K(this))return;const Dt=Ut.getElementFromSelector(this)||this.closest(`.${De}`);xe.getOrCreateInstance(Dt)[$]()})},Re=".bs.alert",Hr=`close${Re}`,Nr=`closed${Re}`;class Ar extends hn{static get NAME(){return"alert"}close(){if(Ve.trigger(this._element,Hr).defaultPrevented)return;this._element.classList.remove("show");const $=this._element.classList.contains("fade");this._queueCallback(()=>this._destroyElement(),this._element,$)}_destroyElement(){this._element.remove(),Ve.trigger(this._element,Nr),this.dispose()}static jQueryInterface($){return this.each(function(){const ae=Ar.getOrCreateInstance(this);if(typeof $=="string"){if(ae[$]===void 0||$.startsWith("_")||$==="constructor")throw new TypeError(`No method named "${$}"`);ae[$](this)}})}}bn(Ar,"close"),me(Ar);const Ht='[data-bs-toggle="button"]';class Wr extends hn{static get NAME(){return"button"}toggle(){this._element.setAttribute("aria-pressed",this._element.classList.toggle("active"))}static jQueryInterface($){return this.each(function(){const ae=Wr.getOrCreateInstance(this);$==="toggle"&&ae[$]()})}}Ve.on(document,"click.bs.button.data-api",Ht,xe=>{xe.preventDefault();const $=xe.target.closest(Ht);Wr.getOrCreateInstance($).toggle()}),me(Wr);const ar=".bs.swipe",pi=`touchstart${ar}`,$n=`touchmove${ar}`,Gr=`touchend${ar}`,gi=`pointerdown${ar}`,Pr=`pointerup${ar}`,ci={endCallback:null,leftCallback:null,rightCallback:null},Un={endCallback:"(function|null)",leftCallback:"(function|null)",rightCallback:"(function|null)"};class yn extends sn{constructor($,ae){super(),this._element=$,$&&yn.isSupported()&&(this._config=this._getConfig(ae),this._deltaX=0,this._supportPointerEvents=!!window.PointerEvent,this._initEvents())}static get Default(){return ci}static get DefaultType(){return Un}static get NAME(){return"swipe"}dispose(){Ve.off(this._element,ar)}_start($){this._supportPointerEvents?this._eventIsPointerPenTouch($)&&(this._deltaX=$.clientX):this._deltaX=$.touches[0].clientX}_end($){this._eventIsPointerPenTouch($)&&(this._deltaX=$.clientX-this._deltaX),this._handleSwipe(),_e(this._config.endCallback)}_move($){this._deltaX=$.touches&&$.touches.length>1?0:$.touches[0].clientX-this._deltaX}_handleSwipe(){const $=Math.abs(this._deltaX);if($<=40)return;const ae=$/this._deltaX;this._deltaX=0,ae&&_e(ae>0?this._config.rightCallback:this._config.leftCallback)}_initEvents(){this._supportPointerEvents?(Ve.on(this._element,gi,$=>this._start($)),Ve.on(this._element,Pr,$=>this._end($)),this._element.classList.add("pointer-event")):(Ve.on(this._element,pi,$=>this._start($)),Ve.on(this._element,$n,$=>this._move($)),Ve.on(this._element,Gr,$=>this._end($)))}_eventIsPointerPenTouch($){return this._supportPointerEvents&&($.pointerType==="pen"||$.pointerType==="touch")}static isSupported(){return"ontouchstart"in document.documentElement||navigator.maxTouchPoints>0}}const Ir=".bs.carousel",ui=".data-api",_i="next",Lr="prev",yi="left",oi="right",qi=`slide${Ir}`,Ci=`slid${Ir}`,mr=`keydown${Ir}`,dr=`mouseenter${Ir}`,wo=`mouseleave${Ir}`,Zi=`dragstart${Ir}`,ko=`load${Ir}${ui}`,nr=`click${Ir}${ui}`,ss="carousel",Vs="active",io=".active",as=".carousel-item",ls=io+as,Ao={ArrowLeft:oi,ArrowRight:yi},Ts={interval:5e3,keyboard:!0,pause:"hover",ride:!1,touch:!0,wrap:!0},oo={interval:"(number|boolean)",keyboard:"boolean",pause:"(string|boolean)",ride:"(boolean|string)",touch:"boolean",wrap:"boolean"};class bt extends hn{constructor($,ae){super($,ae),this._interval=null,this._activeElement=null,this._isSliding=!1,this.touchTimeout=null,this._swipeHelper=null,this._indicatorsElement=Ut.findOne(".carousel-indicators",this._element),this._addEventListeners(),this._config.ride===ss&&this.cycle()}static get Default(){return Ts}static get DefaultType(){return oo}static get NAME(){return"carousel"}next(){this._slide(_i)}nextWhenVisible(){!document.hidden&&Z(this._element)&&this.next()}prev(){this._slide(Lr)}pause(){this._isSliding&&O(this._element),this._clearInterval()}cycle(){this._clearInterval(),this._updateInterval(),this._interval=setInterval(()=>this.nextWhenVisible(),this._config.interval)}_maybeEnableCycle(){this._config.ride&&(this._isSliding?Ve.one(this._element,Ci,()=>this.cycle()):this.cycle())}to($){const ae=this._getItems();if($>ae.length-1||$<0)return;if(this._isSliding)return void Ve.one(this._element,Ci,()=>this.to($));const De=this._getItemIndex(this._getActive());if(De===$)return;const qe=$>De?_i:Lr;this._slide(qe,ae[$])}dispose(){this._swipeHelper&&this._swipeHelper.dispose(),super.dispose()}_configAfterMerge($){return $.defaultInterval=$.interval,$}_addEventListeners(){this._config.keyboard&&Ve.on(this._element,mr,$=>this._keydown($)),this._config.pause==="hover"&&(Ve.on(this._element,dr,()=>this.pause()),Ve.on(this._element,wo,()=>this._maybeEnableCycle())),this._config.touch&&yn.isSupported()&&this._addTouchEventListeners()}_addTouchEventListeners(){for(const ae of Ut.find(".carousel-item img",this._element))Ve.on(ae,Zi,De=>De.preventDefault());const $={leftCallback:()=>this._slide(this._directionToOrder(yi)),rightCallback:()=>this._slide(this._directionToOrder(oi)),endCallback:()=>{this._config.pause==="hover"&&(this.pause(),this.touchTimeout&&clearTimeout(this.touchTimeout),this.touchTimeout=setTimeout(()=>this._maybeEnableCycle(),500+this._config.interval))}};this._swipeHelper=new yn(this._element,$)}_keydown($){if(/input|textarea/i.test($.target.tagName))return;const ae=Ao[$.key];ae&&($.preventDefault(),this._slide(this._directionToOrder(ae)))}_getItemIndex($){return this._getItems().indexOf($)}_setActiveIndicatorElement($){if(!this._indicatorsElement)return;const ae=Ut.findOne(io,this._indicatorsElement);ae.classList.remove(Vs),ae.removeAttribute("aria-current");const De=Ut.findOne(`[data-bs-slide-to="${$}"]`,this._indicatorsElement);De&&(De.classList.add(Vs),De.setAttribute("aria-current","true"))}_updateInterval(){const $=this._activeElement||this._getActive();if(!$)return;const ae=Number.parseInt($.getAttribute("data-bs-interval"),10);this._config.interval=ae||this._config.defaultInterval}_slide($,ae=null){if(this._isSliding)return;const De=this._getActive(),qe=$===_i,Dt=ae||Ne(this._getItems(),De,qe,this._config.wrap);if(Dt===De)return;const Qt=this._getItemIndex(Dt),mn=qn=>Ve.trigger(this._element,qn,{relatedTarget:Dt,direction:this._orderToDirection($),from:this._getItemIndex(De),to:Qt});if(mn(qi).defaultPrevented||!De||!Dt)return;const An=!!this._interval;this.pause(),this._isSliding=!0,this._setActiveIndicatorElement(Qt),this._activeElement=Dt;const Xt=qe?"carousel-item-start":"carousel-item-end",Qn=qe?"carousel-item-next":"carousel-item-prev";Dt.classList.add(Qn),Te(Dt),De.classList.add(Xt),Dt.classList.add(Xt),this._queueCallback(()=>{Dt.classList.remove(Xt,Qn),Dt.classList.add(Vs),De.classList.remove(Vs,Qn,Xt),this._isSliding=!1,mn(Ci)},De,this._isAnimated()),An&&this.cycle()}_isAnimated(){return this._element.classList.contains("slide")}_getActive(){return Ut.findOne(ls,this._element)}_getItems(){return Ut.find(as,this._element)}_clearInterval(){this._interval&&(clearInterval(this._interval),this._interval=null)}_directionToOrder($){return fe()?$===yi?Lr:_i:$===yi?_i:Lr}_orderToDirection($){return fe()?$===Lr?yi:oi:$===Lr?oi:yi}static jQueryInterface($){return this.each(function(){const ae=bt.getOrCreateInstance(this,$);if(typeof $!="number"){if(typeof $=="string"){if(ae[$]===void 0||$.startsWith("_")||$==="constructor")throw new TypeError(`No method named "${$}"`);ae[$]()}}else ae.to($)})}}Ve.on(document,nr,"[data-bs-slide], [data-bs-slide-to]",function(xe){const $=Ut.getElementFromSelector(this);if(!$||!$.classList.contains(ss))return;xe.preventDefault();const ae=bt.getOrCreateInstance($),De=this.getAttribute("data-bs-slide-to");return De?(ae.to(De),void ae._maybeEnableCycle()):Ot.getDataAttribute(this,"slide")==="next"?(ae.next(),void ae._maybeEnableCycle()):(ae.prev(),void ae._maybeEnableCycle())}),Ve.on(window,ko,()=>{const xe=Ut.find('[data-bs-ride="carousel"]');for(const $ of xe)bt.getOrCreateInstance($)}),me(bt);const oe=".bs.collapse",de=`show${oe}`,Se=`shown${oe}`,He=`hide${oe}`,$e=`hidden${oe}`,et=`click${oe}.data-api`,_t="show",Ke="collapse",mt="collapsing",wt=`:scope .${Ke} .${Ke}`,Tt='[data-bs-toggle="collapse"]',Jt={parent:null,toggle:!0},fn={parent:"(null|element)",toggle:"boolean"};class on extends hn{constructor($,ae){super($,ae),this._isTransitioning=!1,this._triggerArray=[];const De=Ut.find(Tt);for(const qe of De){const Dt=Ut.getSelectorFromElement(qe),Qt=Ut.find(Dt).filter(mn=>mn===this._element);Dt!==null&&Qt.length&&this._triggerArray.push(qe)}this._initializeChildren(),this._config.parent||this._addAriaAndCollapsedClass(this._triggerArray,this._isShown()),this._config.toggle&&this.toggle()}static get Default(){return Jt}static get DefaultType(){return fn}static get NAME(){return"collapse"}toggle(){this._isShown()?this.hide():this.show()}show(){if(this._isTransitioning||this._isShown())return;let $=[];if(this._config.parent&&($=this._getFirstLevelChildren(".collapse.show, .collapse.collapsing").filter(qe=>qe!==this._element).map(qe=>on.getOrCreateInstance(qe,{toggle:!1}))),$.length&&$[0]._isTransitioning||Ve.trigger(this._element,de).defaultPrevented)return;for(const qe of $)qe.hide();const ae=this._getDimension();this._element.classList.remove(Ke),this._element.classList.add(mt),this._element.style[ae]=0,this._addAriaAndCollapsedClass(this._triggerArray,!0),this._isTransitioning=!0;const De=`scroll${ae[0].toUpperCase()+ae.slice(1)}`;this._queueCallback(()=>{this._isTransitioning=!1,this._element.classList.remove(mt),this._element.classList.add(Ke,_t),this._element.style[ae]="",Ve.trigger(this._element,Se)},this._element,!0),this._element.style[ae]=`${this._element[De]}px`}hide(){if(this._isTransitioning||!this._isShown()||Ve.trigger(this._element,He).defaultPrevented)return;const $=this._getDimension();this._element.style[$]=`${this._element.getBoundingClientRect()[$]}px`,Te(this._element),this._element.classList.add(mt),this._element.classList.remove(Ke,_t);for(const ae of this._triggerArray){const De=Ut.getElementFromSelector(ae);De&&!this._isShown(De)&&this._addAriaAndCollapsedClass([ae],!1)}this._isTransitioning=!0,this._element.style[$]="",this._queueCallback(()=>{this._isTransitioning=!1,this._element.classList.remove(mt),this._element.classList.add(Ke),Ve.trigger(this._element,$e)},this._element,!0)}_isShown($=this._element){return $.classList.contains(_t)}_configAfterMerge($){return $.toggle=!!$.toggle,$.parent=H($.parent),$}_getDimension(){return this._element.classList.contains("collapse-horizontal")?"width":"height"}_initializeChildren(){if(!this._config.parent)return;const $=this._getFirstLevelChildren(Tt);for(const ae of $){const De=Ut.getElementFromSelector(ae);De&&this._addAriaAndCollapsedClass([ae],this._isShown(De))}}_getFirstLevelChildren($){const ae=Ut.find(wt,this._config.parent);return Ut.find($,this._config.parent).filter(De=>!ae.includes(De))}_addAriaAndCollapsedClass($,ae){if($.length)for(const De of $)De.classList.toggle("collapsed",!ae),De.setAttribute("aria-expanded",ae)}static jQueryInterface($){const ae={};return typeof $=="string"&&/show|hide/.test($)&&(ae.toggle=!1),this.each(function(){const De=on.getOrCreateInstance(this,ae);if(typeof $=="string"){if(De[$]===void 0)throw new TypeError(`No method named "${$}"`);De[$]()}})}}Ve.on(document,et,Tt,function(xe){(xe.target.tagName==="A"||xe.delegateTarget&&xe.delegateTarget.tagName==="A")&&xe.preventDefault();for(const $ of Ut.getMultipleElementsFromSelector(this))on.getOrCreateInstance($,{toggle:!1}).toggle()}),me(on);var En="top",zn="bottom",Rn="right",In="left",kr="auto",lr=[En,zn,Rn,In],Hn="start",Br="end",ti="clippingParents",zr="viewport",po="popper",so="reference",ao=lr.reduce(function(xe,$){return xe.concat([$+"-"+Hn,$+"-"+Br])},[]),zs=[].concat(lr,[kr]).reduce(function(xe,$){return xe.concat([$,$+"-"+Hn,$+"-"+Br])},[]),cs="beforeRead",Al="read",Xs="afterRead",lo="beforeMain",Il="main",zo="afterMain",$o="beforeWrite",Yo="write",tl="afterWrite",ya=[cs,Al,Xs,lo,Il,zo,$o,Yo,tl];function co(xe){return xe?(xe.nodeName||"").toLowerCase():null}function So(xe){if(xe==null)return window;if(xe.toString()!=="[object Window]"){var $=xe.ownerDocument;return $&&$.defaultView||window}return xe}function Cs(xe){return xe instanceof So(xe).Element||xe instanceof Element}function Ms(xe){return xe instanceof So(xe).HTMLElement||xe instanceof HTMLElement}function Vo(xe){return typeof ShadowRoot<"u"&&(xe instanceof So(xe).ShadowRoot||xe instanceof ShadowRoot)}const us={name:"applyStyles",enabled:!0,phase:"write",fn:function(xe){var $=xe.state;Object.keys($.elements).forEach(function(ae){var De=$.styles[ae]||{},qe=$.attributes[ae]||{},Dt=$.elements[ae];Ms(Dt)&&co(Dt)&&(Object.assign(Dt.style,De),Object.keys(qe).forEach(function(Qt){var mn=qe[Qt];mn===!1?Dt.removeAttribute(Qt):Dt.setAttribute(Qt,mn===!0?"":mn)}))})},effect:function(xe){var $=xe.state,ae={popper:{position:$.options.strategy,left:"0",top:"0",margin:"0"},arrow:{position:"absolute"},reference:{}};return Object.assign($.elements.popper.style,ae.popper),$.styles=ae,$.elements.arrow&&Object.assign($.elements.arrow.style,ae.arrow),function(){Object.keys($.elements).forEach(function(De){var qe=$.elements[De],Dt=$.attributes[De]||{},Qt=Object.keys($.styles.hasOwnProperty(De)?$.styles[De]:ae[De]).reduce(function(mn,An){return mn[An]="",mn},{});Ms(qe)&&co(qe)&&(Object.assign(qe.style,Qt),Object.keys(Dt).forEach(function(mn){qe.removeAttribute(mn)}))})}},requires:["computeStyles"]};function mo(xe){return xe.split("-")[0]}var Io=Math.max,Uo=Math.min,va=Math.round;function xa(){var xe=navigator.userAgentData;return xe!=null&&xe.brands&&Array.isArray(xe.brands)?xe.brands.map(function($){return $.brand+"/"+$.version}).join(" "):navigator.userAgent}function hi(){return!/^((?!chrome|android).)*safari/i.test(xa())}function As(xe,$,ae){$===void 0&&($=!1),ae===void 0&&(ae=!1);var De=xe.getBoundingClientRect(),qe=1,Dt=1;$&&Ms(xe)&&(qe=xe.offsetWidth>0&&va(De.width)/xe.offsetWidth||1,Dt=xe.offsetHeight>0&&va(De.height)/xe.offsetHeight||1);var Qt=(Cs(xe)?So(xe):window).visualViewport,mn=!hi()&&ae,An=(De.left+(mn&&Qt?Qt.offsetLeft:0))/qe,Xt=(De.top+(mn&&Qt?Qt.offsetTop:0))/Dt,Qn=De.width/qe,qn=De.height/Dt;return{width:Qn,height:qn,top:Xt,right:An+Qn,bottom:Xt+qn,left:An,x:An,y:Xt}}function nl(xe){var $=As(xe),ae=xe.offsetWidth,De=xe.offsetHeight;return Math.abs($.width-ae)<=1&&(ae=$.width),Math.abs($.height-De)<=1&&(De=$.height),{x:xe.offsetLeft,y:xe.offsetTop,width:ae,height:De}}function Oa(xe,$){var ae=$.getRootNode&&$.getRootNode();if(xe.contains($))return!0;if(ae&&Vo(ae)){var De=$;do{if(De&&xe.isSameNode(De))return!0;De=De.parentNode||De.host}while(De)}return!1}function go(xe){return So(xe).getComputedStyle(xe)}function Ls(xe){return["table","td","th"].indexOf(co(xe))>=0}function Ys(xe){return((Cs(xe)?xe.ownerDocument:xe.document)||window.document).documentElement}function Da(xe){return co(xe)==="html"?xe:xe.assignedSlot||xe.parentNode||(Vo(xe)?xe.host:null)||Ys(xe)}function ir(xe){return Ms(xe)&&go(xe).position!=="fixed"?xe.offsetParent:null}function hs(xe){for(var $=So(xe),ae=ir(xe);ae&&Ls(ae)&&go(ae).position==="static";)ae=ir(ae);return ae&&(co(ae)==="html"||co(ae)==="body"&&go(ae).position==="static")?$:ae||function(De){var qe=/firefox/i.test(xa());if(/Trident/i.test(xa())&&Ms(De)&&go(De).position==="fixed")return null;var Dt=Da(De);for(Vo(Dt)&&(Dt=Dt.host);Ms(Dt)&&["html","body"].indexOf(co(Dt))<0;){var Qt=go(Dt);if(Qt.transform!=="none"||Qt.perspective!=="none"||Qt.contain==="paint"||["transform","perspective"].indexOf(Qt.willChange)!==-1||qe&&Qt.willChange==="filter"||qe&&Qt.filter&&Qt.filter!=="none")return Dt;Dt=Dt.parentNode}return null}(xe)||$}function kn(xe){return["top","bottom"].indexOf(xe)>=0?"x":"y"}function Po(xe,$,ae){return Io(xe,Uo($,ae))}function yr(xe){return Object.assign({},{top:0,right:0,bottom:0,left:0},xe)}function ia(xe,$){return $.reduce(function(ae,De){return ae[De]=xe,ae},{})}const Eo={name:"arrow",enabled:!0,phase:"main",fn:function(xe){var $,ae=xe.state,De=xe.name,qe=xe.options,Dt=ae.elements.arrow,Qt=ae.modifiersData.popperOffsets,mn=mo(ae.placement),An=kn(mn),Xt=[In,Rn].indexOf(mn)>=0?"height":"width";if(Dt&&Qt){var Qn=function(Fi,Pi){return yr(typeof(Fi=typeof Fi=="function"?Fi(Object.assign({},Pi.rects,{placement:Pi.placement})):Fi)!="number"?Fi:ia(Fi,lr))}(qe.padding,ae),qn=nl(Dt),Rr=An==="y"?En:In,cr=An==="y"?zn:Rn,er=ae.rects.reference[Xt]+ae.rects.reference[An]-Qt[An]-ae.rects.popper[Xt],vr=Qt[An]-ae.rects.reference[An],Kr=hs(Dt),Xi=Kr?An==="y"?Kr.clientHeight||0:Kr.clientWidth||0:0,bi=er/2-vr/2,di=Qn[Rr],Ii=Xi-qn[Xt]-Qn[cr],Jr=Xi/2-qn[Xt]/2+bi,jr=Po(di,Jr,Ii),ri=An;ae.modifiersData[De]=(($={})[ri]=jr,$.centerOffset=jr-Jr,$)}},effect:function(xe){var $=xe.state,ae=xe.options.element,De=ae===void 0?"[data-popper-arrow]":ae;De!=null&&(typeof De!="string"||(De=$.elements.popper.querySelector(De)))&&Oa($.elements.popper,De)&&($.elements.arrow=De)},requires:["popperOffsets"],requiresIfExists:["preventOverflow"]};function Fa(xe){return xe.split("-")[1]}var Kn={top:"auto",right:"auto",bottom:"auto",left:"auto"};function qt(xe){var $,ae=xe.popper,De=xe.popperRect,qe=xe.placement,Dt=xe.variation,Qt=xe.offsets,mn=xe.position,An=xe.gpuAcceleration,Xt=xe.adaptive,Qn=xe.roundOffsets,qn=xe.isFixed,Rr=Qt.x,cr=Rr===void 0?0:Rr,er=Qt.y,vr=er===void 0?0:er,Kr=typeof Qn=="function"?Qn({x:cr,y:vr}):{x:cr,y:vr};cr=Kr.x,vr=Kr.y;var Xi=Qt.hasOwnProperty("x"),bi=Qt.hasOwnProperty("y"),di=In,Ii=En,Jr=window;if(Xt){var jr=hs(ae),ri="clientHeight",Fi="clientWidth";jr===So(ae)&&go(jr=Ys(ae)).position!=="static"&&mn==="absolute"&&(ri="scrollHeight",Fi="scrollWidth"),(qe===En||(qe===In||qe===Rn)&&Dt===Br)&&(Ii=zn,vr-=(qn&&jr===Jr&&Jr.visualViewport?Jr.visualViewport.height:jr[ri])-De.height,vr*=An?1:-1),qe!==In&&(qe!==En&&qe!==zn||Dt!==Br)||(di=Rn,cr-=(qn&&jr===Jr&&Jr.visualViewport?Jr.visualViewport.width:jr[Fi])-De.width,cr*=An?1:-1)}var Pi,no=Object.assign({position:mn},Xt&&Kn),Ps=Qn===!0?function(Ma,Yi){var qr=Ma.x,Ds=Ma.y,Hi=Yi.devicePixelRatio||1;return{x:va(qr*Hi)/Hi||0,y:va(Ds*Hi)/Hi||0}}({x:cr,y:vr},So(ae)):{x:cr,y:vr};return cr=Ps.x,vr=Ps.y,An?Object.assign({},no,((Pi={})[Ii]=bi?"0":"",Pi[di]=Xi?"0":"",Pi.transform=(Jr.devicePixelRatio||1)<=1?"translate("+cr+"px, "+vr+"px)":"translate3d("+cr+"px, "+vr+"px, 0)",Pi)):Object.assign({},no,(($={})[Ii]=bi?vr+"px":"",$[di]=Xi?cr+"px":"",$.transform="",$))}const Jn={name:"computeStyles",enabled:!0,phase:"beforeWrite",fn:function(xe){var $=xe.state,ae=xe.options,De=ae.gpuAcceleration,qe=De===void 0||De,Dt=ae.adaptive,Qt=Dt===void 0||Dt,mn=ae.roundOffsets,An=mn===void 0||mn,Xt={placement:mo($.placement),variation:Fa($.placement),popper:$.elements.popper,popperRect:$.rects.popper,gpuAcceleration:qe,isFixed:$.options.strategy==="fixed"};$.modifiersData.popperOffsets!=null&&($.styles.popper=Object.assign({},$.styles.popper,qt(Object.assign({},Xt,{offsets:$.modifiersData.popperOffsets,position:$.options.strategy,adaptive:Qt,roundOffsets:An})))),$.modifiersData.arrow!=null&&($.styles.arrow=Object.assign({},$.styles.arrow,qt(Object.assign({},Xt,{offsets:$.modifiersData.arrow,position:"absolute",adaptive:!1,roundOffsets:An})))),$.attributes.popper=Object.assign({},$.attributes.popper,{"data-popper-placement":$.placement})},data:{}};var Xn={passive:!0};const ni={name:"eventListeners",enabled:!0,phase:"write",fn:function(){},effect:function(xe){var $=xe.state,ae=xe.instance,De=xe.options,qe=De.scroll,Dt=qe===void 0||qe,Qt=De.resize,mn=Qt===void 0||Qt,An=So($.elements.popper),Xt=[].concat($.scrollParents.reference,$.scrollParents.popper);return Dt&&Xt.forEach(function(Qn){Qn.addEventListener("scroll",ae.update,Xn)}),mn&&An.addEventListener("resize",ae.update,Xn),function(){Dt&&Xt.forEach(function(Qn){Qn.removeEventListener("scroll",ae.update,Xn)}),mn&&An.removeEventListener("resize",ae.update,Xn)}},data:{}};var ba={left:"right",right:"left",bottom:"top",top:"bottom"};function wr(xe){return xe.replace(/left|right|bottom|top/g,function($){return ba[$]})}var rl={start:"end",end:"start"};function ds(xe){return xe.replace(/start|end/g,function($){return rl[$]})}function oa(xe){var $=So(xe);return{scrollLeft:$.pageXOffset,scrollTop:$.pageYOffset}}function Lo(xe){return As(Ys(xe)).left+oa(xe).scrollLeft}function wi(xe){var $=go(xe),ae=$.overflow,De=$.overflowX,qe=$.overflowY;return/auto|scroll|overlay|hidden/.test(ae+qe+De)}function Pd(xe){return["html","body","#document"].indexOf(co(xe))>=0?xe.ownerDocument.body:Ms(xe)&&wi(xe)?xe:Pd(Da(xe))}function il(xe,$){var ae;$===void 0&&($=[]);var De=Pd(xe),qe=De===((ae=xe.ownerDocument)==null?void 0:ae.body),Dt=So(De),Qt=qe?[Dt].concat(Dt.visualViewport||[],wi(De)?De:[]):De,mn=$.concat(Qt);return qe?mn:mn.concat(il(Da(Qt)))}function Yl(xe){return Object.assign({},xe,{left:xe.x,top:xe.y,right:xe.x+xe.width,bottom:xe.y+xe.height})}function Kl(xe,$,ae){return $===zr?Yl(function(De,qe){var Dt=So(De),Qt=Ys(De),mn=Dt.visualViewport,An=Qt.clientWidth,Xt=Qt.clientHeight,Qn=0,qn=0;if(mn){An=mn.width,Xt=mn.height;var Rr=hi();(Rr||!Rr&&qe==="fixed")&&(Qn=mn.offsetLeft,qn=mn.offsetTop)}return{width:An,height:Xt,x:Qn+Lo(De),y:qn}}(xe,ae)):Cs($)?function(De,qe){var Dt=As(De,!1,qe==="fixed");return Dt.top=Dt.top+De.clientTop,Dt.left=Dt.left+De.clientLeft,Dt.bottom=Dt.top+De.clientHeight,Dt.right=Dt.left+De.clientWidth,Dt.width=De.clientWidth,Dt.height=De.clientHeight,Dt.x=Dt.left,Dt.y=Dt.top,Dt}($,ae):Yl(function(De){var qe,Dt=Ys(De),Qt=oa(De),mn=(qe=De.ownerDocument)==null?void 0:qe.body,An=Io(Dt.scrollWidth,Dt.clientWidth,mn?mn.scrollWidth:0,mn?mn.clientWidth:0),Xt=Io(Dt.scrollHeight,Dt.clientHeight,mn?mn.scrollHeight:0,mn?mn.clientHeight:0),Qn=-Qt.scrollLeft+Lo(De),qn=-Qt.scrollTop;return go(mn||Dt).direction==="rtl"&&(Qn+=Io(Dt.clientWidth,mn?mn.clientWidth:0)-An),{width:An,height:Xt,x:Qn,y:qn}}(Ys(xe)))}function Eu(xe){var $,ae=xe.reference,De=xe.element,qe=xe.placement,Dt=qe?mo(qe):null,Qt=qe?Fa(qe):null,mn=ae.x+ae.width/2-De.width/2,An=ae.y+ae.height/2-De.height/2;switch(Dt){case En:$={x:mn,y:ae.y-De.height};break;case zn:$={x:mn,y:ae.y+ae.height};break;case Rn:$={x:ae.x+ae.width,y:An};break;case In:$={x:ae.x-De.width,y:An};break;default:$={x:ae.x,y:ae.y}}var Xt=Dt?kn(Dt):null;if(Xt!=null){var Qn=Xt==="y"?"height":"width";switch(Qt){case Hn:$[Xt]=$[Xt]-(ae[Qn]/2-De[Qn]/2);break;case Br:$[Xt]=$[Xt]+(ae[Qn]/2-De[Qn]/2)}}return $}function Os(xe,$){$===void 0&&($={});var ae=$,De=ae.placement,qe=De===void 0?xe.placement:De,Dt=ae.strategy,Qt=Dt===void 0?xe.strategy:Dt,mn=ae.boundary,An=mn===void 0?ti:mn,Xt=ae.rootBoundary,Qn=Xt===void 0?zr:Xt,qn=ae.elementContext,Rr=qn===void 0?po:qn,cr=ae.altBoundary,er=cr!==void 0&&cr,vr=ae.padding,Kr=vr===void 0?0:vr,Xi=yr(typeof Kr!="number"?Kr:ia(Kr,lr)),bi=Rr===po?so:po,di=xe.rects.popper,Ii=xe.elements[er?bi:Rr],Jr=function(Yi,qr,Ds,Hi){var vs=qr==="clippingParents"?function(Ri){var Do=il(Da(Ri)),Zt=["absolute","fixed"].indexOf(go(Ri).position)>=0&&Ms(Ri)?hs(Ri):Ri;return Cs(Zt)?Do.filter(function(an){return Cs(an)&&Oa(an,Zt)&&co(an)!=="body"}):[]}(Yi):[].concat(qr),Us=[].concat(vs,[Ds]),ac=Us[0],es=Us.reduce(function(Ri,Do){var Zt=Kl(Yi,Do,Hi);return Ri.top=Io(Zt.top,Ri.top),Ri.right=Uo(Zt.right,Ri.right),Ri.bottom=Uo(Zt.bottom,Ri.bottom),Ri.left=Io(Zt.left,Ri.left),Ri},Kl(Yi,ac,Hi));return es.width=es.right-es.left,es.height=es.bottom-es.top,es.x=es.left,es.y=es.top,es}(Cs(Ii)?Ii:Ii.contextElement||Ys(xe.elements.popper),An,Qn,Qt),jr=As(xe.elements.reference),ri=Eu({reference:jr,element:di,strategy:"absolute",placement:qe}),Fi=Yl(Object.assign({},di,ri)),Pi=Rr===po?Fi:jr,no={top:Jr.top-Pi.top+Xi.top,bottom:Pi.bottom-Jr.bottom+Xi.bottom,left:Jr.left-Pi.left+Xi.left,right:Pi.right-Jr.right+Xi.right},Ps=xe.modifiersData.offset;if(Rr===po&&Ps){var Ma=Ps[qe];Object.keys(no).forEach(function(Yi){var qr=[Rn,zn].indexOf(Yi)>=0?1:-1,Ds=[En,zn].indexOf(Yi)>=0?"y":"x";no[Yi]+=Ma[Ds]*qr})}return no}function fs(xe,$){$===void 0&&($={});var ae=$,De=ae.placement,qe=ae.boundary,Dt=ae.rootBoundary,Qt=ae.padding,mn=ae.flipVariations,An=ae.allowedAutoPlacements,Xt=An===void 0?zs:An,Qn=Fa(De),qn=Qn?mn?ao:ao.filter(function(er){return Fa(er)===Qn}):lr,Rr=qn.filter(function(er){return Xt.indexOf(er)>=0});Rr.length===0&&(Rr=qn);var cr=Rr.reduce(function(er,vr){return er[vr]=Os(xe,{placement:vr,boundary:qe,rootBoundary:Dt,padding:Qt})[mo(vr)],er},{});return Object.keys(cr).sort(function(er,vr){return cr[er]-cr[vr]})}const sa={name:"flip",enabled:!0,phase:"main",fn:function(xe){var $=xe.state,ae=xe.options,De=xe.name;if(!$.modifiersData[De]._skip){for(var qe=ae.mainAxis,Dt=qe===void 0||qe,Qt=ae.altAxis,mn=Qt===void 0||Qt,An=ae.fallbackPlacements,Xt=ae.padding,Qn=ae.boundary,qn=ae.rootBoundary,Rr=ae.altBoundary,cr=ae.flipVariations,er=cr===void 0||cr,vr=ae.allowedAutoPlacements,Kr=$.options.placement,Xi=mo(Kr),bi=An||(Xi!==Kr&&er?function(Ri){if(mo(Ri)===kr)return[];var Do=wr(Ri);return[ds(Ri),Do,ds(Do)]}(Kr):[wr(Kr)]),di=[Kr].concat(bi).reduce(function(Ri,Do){return Ri.concat(mo(Do)===kr?fs($,{placement:Do,boundary:Qn,rootBoundary:qn,padding:Xt,flipVariations:er,allowedAutoPlacements:vr}):Do)},[]),Ii=$.rects.reference,Jr=$.rects.popper,jr=new Map,ri=!0,Fi=di[0],Pi=0;Pi<di.length;Pi++){var no=di[Pi],Ps=mo(no),Ma=Fa(no)===Hn,Yi=[En,zn].indexOf(Ps)>=0,qr=Yi?"width":"height",Ds=Os($,{placement:no,boundary:Qn,rootBoundary:qn,altBoundary:Rr,padding:Xt}),Hi=Yi?Ma?Rn:In:Ma?zn:En;Ii[qr]>Jr[qr]&&(Hi=wr(Hi));var vs=wr(Hi),Us=[];if(Dt&&Us.push(Ds[Ps]<=0),mn&&Us.push(Ds[Hi]<=0,Ds[vs]<=0),Us.every(function(Ri){return Ri})){Fi=no,ri=!1;break}jr.set(no,Us)}if(ri)for(var ac=function(Ri){var Do=di.find(function(Zt){var an=jr.get(Zt);if(an)return an.slice(0,Ri).every(function(Qs){return Qs})});if(Do)return Fi=Do,"break"},es=er?3:1;es>0&&ac(es)!=="break";es--);$.placement!==Fi&&($.modifiersData[De]._skip=!0,$.placement=Fi,$.reset=!0)}},requiresIfExists:["offset"],data:{_skip:!1}};function Oo(xe,$,ae){return ae===void 0&&(ae={x:0,y:0}),{top:xe.top-$.height-ae.y,right:xe.right-$.width+ae.x,bottom:xe.bottom-$.height+ae.y,left:xe.left-$.width-ae.x}}function ol(xe){return[En,Rn,zn,In].some(function($){return xe[$]>=0})}const sl={name:"hide",enabled:!0,phase:"main",requiresIfExists:["preventOverflow"],fn:function(xe){var $=xe.state,ae=xe.name,De=$.rects.reference,qe=$.rects.popper,Dt=$.modifiersData.preventOverflow,Qt=Os($,{elementContext:"reference"}),mn=Os($,{altBoundary:!0}),An=Oo(Qt,De),Xt=Oo(mn,qe,Dt),Qn=ol(An),qn=ol(Xt);$.modifiersData[ae]={referenceClippingOffsets:An,popperEscapeOffsets:Xt,isReferenceHidden:Qn,hasPopperEscaped:qn},$.attributes.popper=Object.assign({},$.attributes.popper,{"data-popper-reference-hidden":Qn,"data-popper-escaped":qn})}},zi={name:"offset",enabled:!0,phase:"main",requires:["popperOffsets"],fn:function(xe){var $=xe.state,ae=xe.options,De=xe.name,qe=ae.offset,Dt=qe===void 0?[0,0]:qe,Qt=zs.reduce(function(Qn,qn){return Qn[qn]=function(Rr,cr,er){var vr=mo(Rr),Kr=[In,En].indexOf(vr)>=0?-1:1,Xi=typeof er=="function"?er(Object.assign({},cr,{placement:Rr})):er,bi=Xi[0],di=Xi[1];return bi=bi||0,di=(di||0)*Kr,[In,Rn].indexOf(vr)>=0?{x:di,y:bi}:{x:bi,y:di}}(qn,$.rects,Dt),Qn},{}),mn=Qt[$.placement],An=mn.x,Xt=mn.y;$.modifiersData.popperOffsets!=null&&($.modifiersData.popperOffsets.x+=An,$.modifiersData.popperOffsets.y+=Xt),$.modifiersData[De]=Qt}},To={name:"popperOffsets",enabled:!0,phase:"read",fn:function(xe){var $=xe.state,ae=xe.name;$.modifiersData[ae]=Eu({reference:$.rects.reference,element:$.rects.popper,strategy:"absolute",placement:$.placement})},data:{}},Is={name:"preventOverflow",enabled:!0,phase:"main",fn:function(xe){var $=xe.state,ae=xe.options,De=xe.name,qe=ae.mainAxis,Dt=qe===void 0||qe,Qt=ae.altAxis,mn=Qt!==void 0&&Qt,An=ae.boundary,Xt=ae.rootBoundary,Qn=ae.altBoundary,qn=ae.padding,Rr=ae.tether,cr=Rr===void 0||Rr,er=ae.tetherOffset,vr=er===void 0?0:er,Kr=Os($,{boundary:An,rootBoundary:Xt,padding:qn,altBoundary:Qn}),Xi=mo($.placement),bi=Fa($.placement),di=!bi,Ii=kn(Xi),Jr=Ii==="x"?"y":"x",jr=$.modifiersData.popperOffsets,ri=$.rects.reference,Fi=$.rects.popper,Pi=typeof vr=="function"?vr(Object.assign({},$.rects,{placement:$.placement})):vr,no=typeof Pi=="number"?{mainAxis:Pi,altAxis:Pi}:Object.assign({mainAxis:0,altAxis:0},Pi),Ps=$.modifiersData.offset?$.modifiersData.offset[$.placement]:null,Ma={x:0,y:0};if(jr){if(Dt){var Yi,qr=Ii==="y"?En:In,Ds=Ii==="y"?zn:Rn,Hi=Ii==="y"?"height":"width",vs=jr[Ii],Us=vs+Kr[qr],ac=vs-Kr[Ds],es=cr?-Fi[Hi]/2:0,Ri=bi===Hn?ri[Hi]:Fi[Hi],Do=bi===Hn?-Fi[Hi]:-ri[Hi],Zt=$.elements.arrow,an=cr&&Zt?nl(Zt):{width:0,height:0},Qs=$.modifiersData["arrow#persistent"]?$.modifiersData["arrow#persistent"].padding:{top:0,right:0,bottom:0,left:0},$i=Qs[qr],yt=Qs[Ds],Aa=Po(0,ri[Hi],an[Hi]),vl=di?ri[Hi]/2-es-Aa-$i-no.mainAxis:Ri-Aa-$i-no.mainAxis,ah=di?-ri[Hi]/2+es+Aa+yt+no.mainAxis:Do+Aa+yt+no.mainAxis,lh=$.elements.arrow&&hs($.elements.arrow),Nl=lh?Ii==="y"?lh.clientTop||0:lh.clientLeft||0:0,jl=(Yi=Ps==null?void 0:Ps[Ii])!=null?Yi:0,lc=vs+ah-jl,jd=Po(cr?Uo(Us,vs+vl-jl-Nl):Us,vs,cr?Io(ac,lc):ac);jr[Ii]=jd,Ma[Ii]=jd-vs}if(mn){var $l,Kh=Ii==="x"?En:In,cc=Ii==="x"?zn:Rn,Ho=jr[Jr],uc=Jr==="y"?"height":"width",iu=Ho+Kr[Kh],Rs=Ho-Kr[cc],hc=[En,In].indexOf(Xi)!==-1,Wo=($l=Ps==null?void 0:Ps[Jr])!=null?$l:0,Jh=hc?iu:Ho-ri[uc]-Fi[uc]-Wo+no.altAxis,Qh=hc?Ho+ri[uc]+Fi[uc]-Wo-no.altAxis:Rs,vi=cr&&hc?function(ed,ou,xi){var $r=Po(ed,ou,xi);return $r>xi?xi:$r}(Jh,Ho,Qh):Po(cr?Jh:iu,Ho,cr?Qh:Rs);jr[Jr]=vi,Ma[Jr]=vi-Ho}$.modifiersData[De]=Ma}},requiresIfExists:["offset"]};function _o(xe,$,ae){ae===void 0&&(ae=!1);var De,qe,Dt=Ms($),Qt=Ms($)&&function(qn){var Rr=qn.getBoundingClientRect(),cr=va(Rr.width)/qn.offsetWidth||1,er=va(Rr.height)/qn.offsetHeight||1;return cr!==1||er!==1}($),mn=Ys($),An=As(xe,Qt,ae),Xt={scrollLeft:0,scrollTop:0},Qn={x:0,y:0};return(Dt||!Dt&&!ae)&&((co($)!=="body"||wi(mn))&&(Xt=(De=$)!==So(De)&&Ms(De)?{scrollLeft:(qe=De).scrollLeft,scrollTop:qe.scrollTop}:oa(De)),Ms($)?((Qn=As($,!0)).x+=$.clientLeft,Qn.y+=$.clientTop):mn&&(Qn.x=Lo(mn))),{x:An.left+Xt.scrollLeft-Qn.x,y:An.top+Xt.scrollTop-Qn.y,width:An.width,height:An.height}}function Jl(xe){var $=new Map,ae=new Set,De=[];function qe(Dt){ae.add(Dt.name),[].concat(Dt.requires||[],Dt.requiresIfExists||[]).forEach(function(Qt){if(!ae.has(Qt)){var mn=$.get(Qt);mn&&qe(mn)}}),De.push(Dt)}return xe.forEach(function(Dt){$.set(Dt.name,Dt)}),xe.forEach(function(Dt){ae.has(Dt.name)||qe(Dt)}),De}var wa={placement:"bottom",modifiers:[],strategy:"absolute"};function Ba(){for(var xe=arguments.length,$=new Array(xe),ae=0;ae<xe;ae++)$[ae]=arguments[ae];return!$.some(function(De){return!(De&&typeof De.getBoundingClientRect=="function")})}function al(xe){xe===void 0&&(xe={});var $=xe,ae=$.defaultModifiers,De=ae===void 0?[]:ae,qe=$.defaultOptions,Dt=qe===void 0?wa:qe;return function(Qt,mn,An){An===void 0&&(An=Dt);var Xt,Qn,qn={placement:"bottom",orderedModifiers:[],options:Object.assign({},wa,Dt),modifiersData:{},elements:{reference:Qt,popper:mn},attributes:{},styles:{}},Rr=[],cr=!1,er={state:qn,setOptions:function(Kr){var Xi=typeof Kr=="function"?Kr(qn.options):Kr;vr(),qn.options=Object.assign({},Dt,qn.options,Xi),qn.scrollParents={reference:Cs(Qt)?il(Qt):Qt.contextElement?il(Qt.contextElement):[],popper:il(mn)};var bi,di,Ii=function(Jr){var jr=Jl(Jr);return ya.reduce(function(ri,Fi){return ri.concat(jr.filter(function(Pi){return Pi.phase===Fi}))},[])}((bi=[].concat(De,qn.options.modifiers),di=bi.reduce(function(Jr,jr){var ri=Jr[jr.name];return Jr[jr.name]=ri?Object.assign({},ri,jr,{options:Object.assign({},ri.options,jr.options),data:Object.assign({},ri.data,jr.data)}):jr,Jr},{}),Object.keys(di).map(function(Jr){return di[Jr]})));return qn.orderedModifiers=Ii.filter(function(Jr){return Jr.enabled}),qn.orderedModifiers.forEach(function(Jr){var jr=Jr.name,ri=Jr.options,Fi=ri===void 0?{}:ri,Pi=Jr.effect;if(typeof Pi=="function"){var no=Pi({state:qn,name:jr,instance:er,options:Fi});Rr.push(no||function(){})}}),er.update()},forceUpdate:function(){if(!cr){var Kr=qn.elements,Xi=Kr.reference,bi=Kr.popper;if(Ba(Xi,bi)){qn.rects={reference:_o(Xi,hs(bi),qn.options.strategy==="fixed"),popper:nl(bi)},qn.reset=!1,qn.placement=qn.options.placement,qn.orderedModifiers.forEach(function(Pi){return qn.modifiersData[Pi.name]=Object.assign({},Pi.data)});for(var di=0;di<qn.orderedModifiers.length;di++)if(qn.reset!==!0){var Ii=qn.orderedModifiers[di],Jr=Ii.fn,jr=Ii.options,ri=jr===void 0?{}:jr,Fi=Ii.name;typeof Jr=="function"&&(qn=Jr({state:qn,options:ri,name:Fi,instance:er})||qn)}else qn.reset=!1,di=-1}}},update:(Xt=function(){return new Promise(function(Kr){er.forceUpdate(),Kr(qn)})},function(){return Qn||(Qn=new Promise(function(Kr){Promise.resolve().then(function(){Qn=void 0,Kr(Xt())})})),Qn}),destroy:function(){vr(),cr=!0}};if(!Ba(Qt,mn))return er;function vr(){Rr.forEach(function(Kr){return Kr()}),Rr=[]}return er.setOptions(An).then(function(Kr){!cr&&An.onFirstUpdate&&An.onFirstUpdate(Kr)}),er}}var ll=al(),Oh=al({defaultModifiers:[ni,To,Jn,us]}),Na=al({defaultModifiers:[ni,To,Jn,us,zi,sa,Is,Eo,sl]});const Rd=Object.freeze(Object.defineProperty({__proto__:null,afterMain:zo,afterRead:Xs,afterWrite:tl,applyStyles:us,arrow:Eo,auto:kr,basePlacements:lr,beforeMain:lo,beforeRead:cs,beforeWrite:$o,bottom:zn,clippingParents:ti,computeStyles:Jn,createPopper:Na,createPopperBase:ll,createPopperLite:Oh,detectOverflow:Os,end:Br,eventListeners:ni,flip:sa,hide:sl,left:In,main:Il,modifierPhases:ya,offset:zi,placements:zs,popper:po,popperGenerator:al,popperOffsets:To,preventOverflow:Is,read:Al,reference:so,right:Rn,start:Hn,top:En,variationPlacements:ao,viewport:zr,write:Yo},Symbol.toStringTag,{value:"Module"})),Ku="dropdown",Ko=".bs.dropdown",_c=".data-api",Dh="ArrowUp",kd="ArrowDown",Ju=`hide${Ko}`,Sp=`hidden${Ko}`,Ep=`show${Ko}`,Tu=`shown${Ko}`,Cu=`click${Ko}${_c}`,zd=`keydown${Ko}${_c}`,cl=`keyup${Ko}${_c}`,Uc="show",ja='[data-bs-toggle="dropdown"]:not(.disabled):not(:disabled)',Pl=`${ja}.${Uc}`,Fh=".dropdown-menu",Tp=fe()?"top-end":"top-start",Cf=fe()?"top-start":"top-end",Mf=fe()?"bottom-end":"bottom-start",Mu=fe()?"bottom-start":"bottom-end",Sr=fe()?"left-start":"right-start",Dn=fe()?"right-start":"left-start",Bh={autoClose:!0,boundary:"clippingParents",display:"dynamic",offset:[0,2],popperConfig:null,reference:"toggle"},or={autoClose:"(boolean|string)",boundary:"(string|element)",display:"string",offset:"(array|string|function)",popperConfig:"(null|object|function)",reference:"(string|element|object)"};class aa extends hn{constructor($,ae){super($,ae),this._popper=null,this._parent=this._element.parentNode,this._menu=Ut.next(this._element,Fh)[0]||Ut.prev(this._element,Fh)[0]||Ut.findOne(Fh,this._parent),this._inNavbar=this._detectNavbar()}static get Default(){return Bh}static get DefaultType(){return or}static get NAME(){return Ku}toggle(){return this._isShown()?this.hide():this.show()}show(){if(K(this._element)||this._isShown())return;const $={relatedTarget:this._element};if(!Ve.trigger(this._element,Ep,$).defaultPrevented){if(this._createPopper(),"ontouchstart"in document.documentElement&&!this._parent.closest(".navbar-nav"))for(const ae of[].concat(...document.body.children))Ve.on(ae,"mouseover",le);this._element.focus(),this._element.setAttribute("aria-expanded",!0),this._menu.classList.add(Uc),this._element.classList.add(Uc),Ve.trigger(this._element,Tu,$)}}hide(){if(K(this._element)||!this._isShown())return;const $={relatedTarget:this._element};this._completeHide($)}dispose(){this._popper&&this._popper.destroy(),super.dispose()}update(){this._inNavbar=this._detectNavbar(),this._popper&&this._popper.update()}_completeHide($){if(!Ve.trigger(this._element,Ju,$).defaultPrevented){if("ontouchstart"in document.documentElement)for(const ae of[].concat(...document.body.children))Ve.off(ae,"mouseover",le);this._popper&&this._popper.destroy(),this._menu.classList.remove(Uc),this._element.classList.remove(Uc),this._element.setAttribute("aria-expanded","false"),Ot.removeDataAttribute(this._menu,"popper"),Ve.trigger(this._element,Sp,$)}}_getConfig($){if(typeof($=super._getConfig($)).reference=="object"&&!r($.reference)&&typeof $.reference.getBoundingClientRect!="function")throw new TypeError(`${Ku.toUpperCase()}: Option "reference" provided type "object" without a required "getBoundingClientRect" method.`);return $}_createPopper(){if(Rd===void 0)throw new TypeError("Bootstrap's dropdowns require Popper (https://popper.js.org)");let $=this._element;this._config.reference==="parent"?$=this._parent:r(this._config.reference)?$=H(this._config.reference):typeof this._config.reference=="object"&&($=this._config.reference);const ae=this._getPopperConfig();this._popper=Na($,this._menu,ae)}_isShown(){return this._menu.classList.contains(Uc)}_getPlacement(){const $=this._parent;if($.classList.contains("dropend"))return Sr;if($.classList.contains("dropstart"))return Dn;if($.classList.contains("dropup-center"))return"top";if($.classList.contains("dropdown-center"))return"bottom";const ae=getComputedStyle(this._menu).getPropertyValue("--bs-position").trim()==="end";return $.classList.contains("dropup")?ae?Cf:Tp:ae?Mu:Mf}_detectNavbar(){return this._element.closest(".navbar")!==null}_getOffset(){const{offset:$}=this._config;return typeof $=="string"?$.split(",").map(ae=>Number.parseInt(ae,10)):typeof $=="function"?ae=>$(ae,this._element):$}_getPopperConfig(){const $={placement:this._getPlacement(),modifiers:[{name:"preventOverflow",options:{boundary:this._config.boundary}},{name:"offset",options:{offset:this._getOffset()}}]};return(this._inNavbar||this._config.display==="static")&&(Ot.setDataAttribute(this._menu,"popper","static"),$.modifiers=[{name:"applyStyles",enabled:!1}]),{...$,..._e(this._config.popperConfig,[$])}}_selectMenuItem({key:$,target:ae}){const De=Ut.find(".dropdown-menu .dropdown-item:not(.disabled):not(:disabled)",this._menu).filter(qe=>Z(qe));De.length&&Ne(De,ae,$===kd,!De.includes(ae)).focus()}static jQueryInterface($){return this.each(function(){const ae=aa.getOrCreateInstance(this,$);if(typeof $=="string"){if(ae[$]===void 0)throw new TypeError(`No method named "${$}"`);ae[$]()}})}static clearMenus($){if($.button===2||$.type==="keyup"&&$.key!=="Tab")return;const ae=Ut.find(Pl);for(const De of ae){const qe=aa.getInstance(De);if(!qe||qe._config.autoClose===!1)continue;const Dt=$.composedPath(),Qt=Dt.includes(qe._menu);if(Dt.includes(qe._element)||qe._config.autoClose==="inside"&&!Qt||qe._config.autoClose==="outside"&&Qt||qe._menu.contains($.target)&&($.type==="keyup"&&$.key==="Tab"||/input|select|option|textarea|form/i.test($.target.tagName)))continue;const mn={relatedTarget:qe._element};$.type==="click"&&(mn.clickEvent=$),qe._completeHide(mn)}}static dataApiKeydownHandler($){const ae=/input|textarea/i.test($.target.tagName),De=$.key==="Escape",qe=[Dh,kd].includes($.key);if(!qe&&!De||ae&&!De)return;$.preventDefault();const Dt=this.matches(ja)?this:Ut.prev(this,ja)[0]||Ut.next(this,ja)[0]||Ut.findOne(ja,$.delegateTarget.parentNode),Qt=aa.getOrCreateInstance(Dt);if(qe)return $.stopPropagation(),Qt.show(),void Qt._selectMenuItem($);Qt._isShown()&&($.stopPropagation(),Qt.hide(),Dt.focus())}}Ve.on(document,zd,ja,aa.dataApiKeydownHandler),Ve.on(document,zd,Fh,aa.dataApiKeydownHandler),Ve.on(document,Cu,aa.clearMenus),Ve.on(document,cl,aa.clearMenus),Ve.on(document,Cu,ja,function(xe){xe.preventDefault(),aa.getOrCreateInstance(this).toggle()}),me(aa);const $a="backdrop",Wn="show",Nh=`mousedown.bs.${$a}`,Qu={className:"modal-backdrop",clickCallback:null,isAnimated:!1,isVisible:!0,rootElement:"body"},Hc={className:"string",clickCallback:"(function|null)",isAnimated:"boolean",isVisible:"boolean",rootElement:"(element|string)"};class yc extends sn{constructor($){super(),this._config=this._getConfig($),this._isAppended=!1,this._element=null}static get Default(){return Qu}static get DefaultType(){return Hc}static get NAME(){return $a}show($){if(!this._config.isVisible)return void _e($);this._append();const ae=this._getElement();this._config.isAnimated&&Te(ae),ae.classList.add(Wn),this._emulateAnimation(()=>{_e($)})}hide($){this._config.isVisible?(this._getElement().classList.remove(Wn),this._emulateAnimation(()=>{this.dispose(),_e($)})):_e($)}dispose(){this._isAppended&&(Ve.off(this._element,Nh),this._element.remove(),this._isAppended=!1)}_getElement(){if(!this._element){const $=document.createElement("div");$.className=this._config.className,this._config.isAnimated&&$.classList.add("fade"),this._element=$}return this._element}_configAfterMerge($){return $.rootElement=H($.rootElement),$}_append(){if(this._isAppended)return;const $=this._getElement();this._config.rootElement.append($),Ve.on($,Nh,()=>{_e(this._config.clickCallback)}),this._isAppended=!0}_emulateAnimation($){Ie($,this._getElement(),this._config.isAnimated)}}const Ql=".bs.focustrap",ps=`focusin${Ql}`,ms=`keydown.tab${Ql}`,eh="backward",pn={autofocus:!0,trapElement:null},jh={autofocus:"boolean",trapElement:"element"};class ul extends sn{constructor($){super(),this._config=this._getConfig($),this._isActive=!1,this._lastTabNavDirection=null}static get Default(){return pn}static get DefaultType(){return jh}static get NAME(){return"focustrap"}activate(){this._isActive||(this._config.autofocus&&this._config.trapElement.focus(),Ve.off(document,Ql),Ve.on(document,ps,$=>this._handleFocusin($)),Ve.on(document,ms,$=>this._handleKeydown($)),this._isActive=!0)}deactivate(){this._isActive&&(this._isActive=!1,Ve.off(document,Ql))}_handleFocusin($){const{trapElement:ae}=this._config;if($.target===document||$.target===ae||ae.contains($.target))return;const De=Ut.focusableChildren(ae);De.length===0?ae.focus():this._lastTabNavDirection===eh?De[De.length-1].focus():De[0].focus()}_handleKeydown($){$.key==="Tab"&&(this._lastTabNavDirection=$.shiftKey?eh:"forward")}}const Jo=".fixed-top, .fixed-bottom, .is-fixed, .sticky-top",Wc=".sticky-top",hl="padding-right",Rl="margin-right";class dl{constructor(){this._element=document.body}getWidth(){const $=document.documentElement.clientWidth;return Math.abs(window.innerWidth-$)}hide(){const $=this.getWidth();this._disableOverFlow(),this._setElementAttributes(this._element,hl,ae=>ae+$),this._setElementAttributes(Jo,hl,ae=>ae+$),this._setElementAttributes(Wc,Rl,ae=>ae-$)}reset(){this._resetElementAttributes(this._element,"overflow"),this._resetElementAttributes(this._element,hl),this._resetElementAttributes(Jo,hl),this._resetElementAttributes(Wc,Rl)}isOverflowing(){return this.getWidth()>0}_disableOverFlow(){this._saveInitialAttribute(this._element,"overflow"),this._element.style.overflow="hidden"}_setElementAttributes($,ae,De){const qe=this.getWidth();this._applyManipulationCallback($,Dt=>{if(Dt!==this._element&&window.innerWidth>Dt.clientWidth+qe)return;this._saveInitialAttribute(Dt,ae);const Qt=window.getComputedStyle(Dt).getPropertyValue(ae);Dt.style.setProperty(ae,`${De(Number.parseFloat(Qt))}px`)})}_saveInitialAttribute($,ae){const De=$.style.getPropertyValue(ae);De&&Ot.setDataAttribute($,ae,De)}_resetElementAttributes($,ae){this._applyManipulationCallback($,De=>{const qe=Ot.getDataAttribute(De,ae);qe!==null?(Ot.removeDataAttribute(De,ae),De.style.setProperty(ae,qe)):De.style.removeProperty(ae)})}_applyManipulationCallback($,ae){if(r($))ae($);else for(const De of Ut.find($,this._element))ae(De)}}const gs=".bs.modal",Gc=`hide${gs}`,vc=`hidePrevented${gs}`,$h=`hidden${gs}`,Ld=`show${gs}`,Vh=`shown${gs}`,Od=`resize${gs}`,Af=`click.dismiss${gs}`,If=`mousedown.dismiss${gs}`,ec=`keydown.dismiss${gs}`,Cp=`click${gs}.data-api`,Pf="modal-open",la="show",xc="modal-static",Uh={backdrop:!0,focus:!0,keyboard:!0},Va={backdrop:"(boolean|string)",focus:"boolean",keyboard:"boolean"};class Ua extends hn{constructor($,ae){super($,ae),this._dialog=Ut.findOne(".modal-dialog",this._element),this._backdrop=this._initializeBackDrop(),this._focustrap=this._initializeFocusTrap(),this._isShown=!1,this._isTransitioning=!1,this._scrollBar=new dl,this._addEventListeners()}static get Default(){return Uh}static get DefaultType(){return Va}static get NAME(){return"modal"}toggle($){return this._isShown?this.hide():this.show($)}show($){this._isShown||this._isTransitioning||Ve.trigger(this._element,Ld,{relatedTarget:$}).defaultPrevented||(this._isShown=!0,this._isTransitioning=!0,this._scrollBar.hide(),document.body.classList.add(Pf),this._adjustDialog(),this._backdrop.show(()=>this._showElement($)))}hide(){this._isShown&&!this._isTransitioning&&(Ve.trigger(this._element,Gc).defaultPrevented||(this._isShown=!1,this._isTransitioning=!0,this._focustrap.deactivate(),this._element.classList.remove(la),this._queueCallback(()=>this._hideModal(),this._element,this._isAnimated())))}dispose(){Ve.off(window,gs),Ve.off(this._dialog,gs),this._backdrop.dispose(),this._focustrap.deactivate(),super.dispose()}handleUpdate(){this._adjustDialog()}_initializeBackDrop(){return new yc({isVisible:!!this._config.backdrop,isAnimated:this._isAnimated()})}_initializeFocusTrap(){return new ul({trapElement:this._element})}_showElement($){document.body.contains(this._element)||document.body.append(this._element),this._element.style.display="block",this._element.removeAttribute("aria-hidden"),this._element.setAttribute("aria-modal",!0),this._element.setAttribute("role","dialog"),this._element.scrollTop=0;const ae=Ut.findOne(".modal-body",this._dialog);ae&&(ae.scrollTop=0),Te(this._element),this._element.classList.add(la),this._queueCallback(()=>{this._config.focus&&this._focustrap.activate(),this._isTransitioning=!1,Ve.trigger(this._element,Vh,{relatedTarget:$})},this._dialog,this._isAnimated())}_addEventListeners(){Ve.on(this._element,ec,$=>{$.key==="Escape"&&(this._config.keyboard?this.hide():this._triggerBackdropTransition())}),Ve.on(window,Od,()=>{this._isShown&&!this._isTransitioning&&this._adjustDialog()}),Ve.on(this._element,If,$=>{Ve.one(this._element,Af,ae=>{this._element===$.target&&this._element===ae.target&&(this._config.backdrop!=="static"?this._config.backdrop&&this.hide():this._triggerBackdropTransition())})})}_hideModal(){this._element.style.display="none",this._element.setAttribute("aria-hidden",!0),this._element.removeAttribute("aria-modal"),this._element.removeAttribute("role"),this._isTransitioning=!1,this._backdrop.hide(()=>{document.body.classList.remove(Pf),this._resetAdjustments(),this._scrollBar.reset(),Ve.trigger(this._element,$h)})}_isAnimated(){return this._element.classList.contains("fade")}_triggerBackdropTransition(){if(Ve.trigger(this._element,vc).defaultPrevented)return;const $=this._element.scrollHeight>document.documentElement.clientHeight,ae=this._element.style.overflowY;ae==="hidden"||this._element.classList.contains(xc)||($||(this._element.style.overflowY="hidden"),this._element.classList.add(xc),this._queueCallback(()=>{this._element.classList.remove(xc),this._queueCallback(()=>{this._element.style.overflowY=ae},this._dialog)},this._dialog),this._element.focus())}_adjustDialog(){const $=this._element.scrollHeight>document.documentElement.clientHeight,ae=this._scrollBar.getWidth(),De=ae>0;if(De&&!$){const qe=fe()?"paddingLeft":"paddingRight";this._element.style[qe]=`${ae}px`}if(!De&&$){const qe=fe()?"paddingRight":"paddingLeft";this._element.style[qe]=`${ae}px`}}_resetAdjustments(){this._element.style.paddingLeft="",this._element.style.paddingRight=""}static jQueryInterface($,ae){return this.each(function(){const De=Ua.getOrCreateInstance(this,$);if(typeof $=="string"){if(De[$]===void 0)throw new TypeError(`No method named "${$}"`);De[$](ae)}})}}Ve.on(document,Cp,'[data-bs-toggle="modal"]',function(xe){const $=Ut.getElementFromSelector(this);["A","AREA"].includes(this.tagName)&&xe.preventDefault(),Ve.one($,Ld,De=>{De.defaultPrevented||Ve.one($,$h,()=>{Z(this)&&this.focus()})});const ae=Ut.findOne(".modal.show");ae&&Ua.getInstance(ae).hide(),Ua.getOrCreateInstance($).toggle(this)}),bn(Ua),me(Ua);const fl=".bs.offcanvas",Au=".data-api",Hh=`load${fl}${Au}`,Iu="show",kl="showing",pl="hiding",tc=".offcanvas.show",th=`show${fl}`,bc=`shown${fl}`,nc=`hide${fl}`,Sa=`hidePrevented${fl}`,zl=`hidden${fl}`,Ll=`resize${fl}`,wc=`click${fl}${Au}`,nh=`keydown.dismiss${fl}`,Wh={backdrop:!0,keyboard:!0,scroll:!1},rc={backdrop:"(boolean|string)",keyboard:"boolean",scroll:"boolean"};class gr extends hn{constructor($,ae){super($,ae),this._isShown=!1,this._backdrop=this._initializeBackDrop(),this._focustrap=this._initializeFocusTrap(),this._addEventListeners()}static get Default(){return Wh}static get DefaultType(){return rc}static get NAME(){return"offcanvas"}toggle($){return this._isShown?this.hide():this.show($)}show($){this._isShown||Ve.trigger(this._element,th,{relatedTarget:$}).defaultPrevented||(this._isShown=!0,this._backdrop.show(),this._config.scroll||new dl().hide(),this._element.setAttribute("aria-modal",!0),this._element.setAttribute("role","dialog"),this._element.classList.add(kl),this._queueCallback(()=>{this._config.scroll&&!this._config.backdrop||this._focustrap.activate(),this._element.classList.add(Iu),this._element.classList.remove(kl),Ve.trigger(this._element,bc,{relatedTarget:$})},this._element,!0))}hide(){this._isShown&&(Ve.trigger(this._element,nc).defaultPrevented||(this._focustrap.deactivate(),this._element.blur(),this._isShown=!1,this._element.classList.add(pl),this._backdrop.hide(),this._queueCallback(()=>{this._element.classList.remove(Iu,pl),this._element.removeAttribute("aria-modal"),this._element.removeAttribute("role"),this._config.scroll||new dl().reset(),Ve.trigger(this._element,zl)},this._element,!0)))}dispose(){this._backdrop.dispose(),this._focustrap.deactivate(),super.dispose()}_initializeBackDrop(){const $=!!this._config.backdrop;return new yc({className:"offcanvas-backdrop",isVisible:$,isAnimated:!0,rootElement:this._element.parentNode,clickCallback:$?()=>{this._config.backdrop!=="static"?this.hide():Ve.trigger(this._element,Sa)}:null})}_initializeFocusTrap(){return new ul({trapElement:this._element})}_addEventListeners(){Ve.on(this._element,nh,$=>{$.key==="Escape"&&(this._config.keyboard?this.hide():Ve.trigger(this._element,Sa))})}static jQueryInterface($){return this.each(function(){const ae=gr.getOrCreateInstance(this,$);if(typeof $=="string"){if(ae[$]===void 0||$.startsWith("_")||$==="constructor")throw new TypeError(`No method named "${$}"`);ae[$](this)}})}}Ve.on(document,wc,'[data-bs-toggle="offcanvas"]',function(xe){const $=Ut.getElementFromSelector(this);if(["A","AREA"].includes(this.tagName)&&xe.preventDefault(),K(this))return;Ve.one($,zl,()=>{Z(this)&&this.focus()});const ae=Ut.findOne(tc);ae&&ae!==$&&gr.getInstance(ae).hide(),gr.getOrCreateInstance($).toggle(this)}),Ve.on(window,Hh,()=>{for(const xe of Ut.find(tc))gr.getOrCreateInstance(xe).show()}),Ve.on(window,Ll,()=>{for(const xe of Ut.find("[aria-modal][class*=show][class*=offcanvas-]"))getComputedStyle(xe).position!=="fixed"&&gr.getOrCreateInstance(xe).hide()}),bn(gr),me(gr);const qc={"*":["class","dir","id","lang","role",/^aria-[\w-]*$/i],a:["target","href","title","rel"],area:[],b:[],br:[],col:[],code:[],dd:[],div:[],dl:[],dt:[],em:[],hr:[],h1:[],h2:[],h3:[],h4:[],h5:[],h6:[],i:[],img:["src","srcset","alt","title","width","height"],li:[],ol:[],p:[],pre:[],s:[],small:[],span:[],sub:[],sup:[],strong:[],u:[],ul:[]},Dd=new Set(["background","cite","href","itemtype","longdesc","poster","src","xlink:href"]),ic=/^(?!javascript:)(?:[a-z0-9+.-]+:|[^&:/?#]*(?:[/?#]|$))/i,rh=(xe,$)=>{const ae=xe.nodeName.toLowerCase();return $.includes(ae)?!Dd.has(ae)||!!ic.test(xe.nodeValue):$.filter(De=>De instanceof RegExp).some(De=>De.test(ae))},Sc={allowList:qc,content:{},extraClass:"",html:!1,sanitize:!0,sanitizeFn:null,template:"<div></div>"},Li={allowList:"object",content:"object",extraClass:"(string|function)",html:"boolean",sanitize:"boolean",sanitizeFn:"(null|function)",template:"string"},Mp={entry:"(string|element|function|null)",selector:"(string|element)"};class ih extends sn{constructor($){super(),this._config=this._getConfig($)}static get Default(){return Sc}static get DefaultType(){return Li}static get NAME(){return"TemplateFactory"}getContent(){return Object.values(this._config.content).map($=>this._resolvePossibleFunction($)).filter(Boolean)}hasContent(){return this.getContent().length>0}changeContent($){return this._checkContent($),this._config.content={...this._config.content,...$},this}toHtml(){const $=document.createElement("div");$.innerHTML=this._maybeSanitize(this._config.template);for(const[qe,Dt]of Object.entries(this._config.content))this._setContent($,Dt,qe);const ae=$.children[0],De=this._resolvePossibleFunction(this._config.extraClass);return De&&ae.classList.add(...De.split(" ")),ae}_typeCheckConfig($){super._typeCheckConfig($),this._checkContent($.content)}_checkContent($){for(const[ae,De]of Object.entries($))super._typeCheckConfig({selector:ae,entry:De},Mp)}_setContent($,ae,De){const qe=Ut.findOne(De,$);qe&&((ae=this._resolvePossibleFunction(ae))?r(ae)?this._putElementInTemplate(H(ae),qe):this._config.html?qe.innerHTML=this._maybeSanitize(ae):qe.textContent=ae:qe.remove())}_maybeSanitize($){return this._config.sanitize?function(ae,De,qe){if(!ae.length)return ae;if(qe&&typeof qe=="function")return qe(ae);const Dt=new window.DOMParser().parseFromString(ae,"text/html"),Qt=[].concat(...Dt.body.querySelectorAll("*"));for(const mn of Qt){const An=mn.nodeName.toLowerCase();if(!Object.keys(De).includes(An)){mn.remove();continue}const Xt=[].concat(...mn.attributes),Qn=[].concat(De["*"]||[],De[An]||[]);for(const qn of Xt)rh(qn,Qn)||mn.removeAttribute(qn.nodeName)}return Dt.body.innerHTML}($,this._config.allowList,this._config.sanitizeFn):$}_resolvePossibleFunction($){return _e($,[this])}_putElementInTemplate($,ae){if(this._config.html)return ae.innerHTML="",void ae.append($);ae.textContent=$.textContent}}const Ap=new Set(["sanitize","allowList","sanitizeFn"]),Pu="fade",Zc="show",Qi=".modal",Ru="hide.bs.modal",oc="hover",Ec="focus",Rf={AUTO:"auto",TOP:"top",RIGHT:fe()?"left":"right",BOTTOM:"bottom",LEFT:fe()?"right":"left"},Xc={allowList:qc,animation:!0,boundary:"clippingParents",container:!1,customClass:"",delay:0,fallbackPlacements:["top","right","bottom","left"],html:!1,offset:[0,6],placement:"top",popperConfig:null,sanitize:!0,sanitizeFn:null,selector:!1,template:'<div class="tooltip" role="tooltip"><div class="tooltip-arrow"></div><div class="tooltip-inner"></div></div>',title:"",trigger:"hover focus"},sc={allowList:"object",animation:"boolean",boundary:"(string|element)",container:"(string|element|boolean)",customClass:"(string|function)",delay:"(number|object)",fallbackPlacements:"array",html:"boolean",offset:"(array|string|function)",placement:"(string|function)",popperConfig:"(null|object|function)",sanitize:"boolean",sanitizeFn:"(null|function)",selector:"(string|boolean)",template:"string",title:"(string|element|function)",trigger:"string"};class ml extends hn{constructor($,ae){if(Rd===void 0)throw new TypeError("Bootstrap's tooltips require Popper (https://popper.js.org)");super($,ae),this._isEnabled=!0,this._timeout=0,this._isHovered=null,this._activeTrigger={},this._popper=null,this._templateFactory=null,this._newContent=null,this.tip=null,this._setListeners(),this._config.selector||this._fixTitle()}static get Default(){return Xc}static get DefaultType(){return sc}static get NAME(){return"tooltip"}enable(){this._isEnabled=!0}disable(){this._isEnabled=!1}toggleEnabled(){this._isEnabled=!this._isEnabled}toggle(){this._isEnabled&&(this._activeTrigger.click=!this._activeTrigger.click,this._isShown()?this._leave():this._enter())}dispose(){clearTimeout(this._timeout),Ve.off(this._element.closest(Qi),Ru,this._hideModalHandler),this._element.getAttribute("data-bs-original-title")&&this._element.setAttribute("title",this._element.getAttribute("data-bs-original-title")),this._disposePopper(),super.dispose()}show(){if(this._element.style.display==="none")throw new Error("Please use show on visible elements");if(!this._isWithContent()||!this._isEnabled)return;const $=Ve.trigger(this._element,this.constructor.eventName("show")),ae=(te(this._element)||this._element.ownerDocument.documentElement).contains(this._element);if($.defaultPrevented||!ae)return;this._disposePopper();const De=this._getTipElement();this._element.setAttribute("aria-describedby",De.getAttribute("id"));const{container:qe}=this._config;if(this._element.ownerDocument.documentElement.contains(this.tip)||(qe.append(De),Ve.trigger(this._element,this.constructor.eventName("inserted"))),this._popper=this._createPopper(De),De.classList.add(Zc),"ontouchstart"in document.documentElement)for(const Dt of[].concat(...document.body.children))Ve.on(Dt,"mouseover",le);this._queueCallback(()=>{Ve.trigger(this._element,this.constructor.eventName("shown")),this._isHovered===!1&&this._leave(),this._isHovered=!1},this.tip,this._isAnimated())}hide(){if(this._isShown()&&!Ve.trigger(this._element,this.constructor.eventName("hide")).defaultPrevented){if(this._getTipElement().classList.remove(Zc),"ontouchstart"in document.documentElement)for(const $ of[].concat(...document.body.children))Ve.off($,"mouseover",le);this._activeTrigger.click=!1,this._activeTrigger[Ec]=!1,this._activeTrigger[oc]=!1,this._isHovered=null,this._queueCallback(()=>{this._isWithActiveTrigger()||(this._isHovered||this._disposePopper(),this._element.removeAttribute("aria-describedby"),Ve.trigger(this._element,this.constructor.eventName("hidden")))},this.tip,this._isAnimated())}}update(){this._popper&&this._popper.update()}_isWithContent(){return!!this._getTitle()}_getTipElement(){return this.tip||(this.tip=this._createTipElement(this._newContent||this._getContentForTemplate())),this.tip}_createTipElement($){const ae=this._getTemplateFactory($).toHtml();if(!ae)return null;ae.classList.remove(Pu,Zc),ae.classList.add(`bs-${this.constructor.NAME}-auto`);const De=(qe=>{do qe+=Math.floor(1e6*Math.random());while(document.getElementById(qe));return qe})(this.constructor.NAME).toString();return ae.setAttribute("id",De),this._isAnimated()&&ae.classList.add(Pu),ae}setContent($){this._newContent=$,this._isShown()&&(this._disposePopper(),this.show())}_getTemplateFactory($){return this._templateFactory?this._templateFactory.changeContent($):this._templateFactory=new ih({...this._config,content:$,extraClass:this._resolvePossibleFunction(this._config.customClass)}),this._templateFactory}_getContentForTemplate(){return{".tooltip-inner":this._getTitle()}}_getTitle(){return this._resolvePossibleFunction(this._config.title)||this._element.getAttribute("data-bs-original-title")}_initializeOnDelegatedTarget($){return this.constructor.getOrCreateInstance($.delegateTarget,this._getDelegateConfig())}_isAnimated(){return this._config.animation||this.tip&&this.tip.classList.contains(Pu)}_isShown(){return this.tip&&this.tip.classList.contains(Zc)}_createPopper($){const ae=_e(this._config.placement,[this,$,this._element]),De=Rf[ae.toUpperCase()];return Na(this._element,$,this._getPopperConfig(De))}_getOffset(){const{offset:$}=this._config;return typeof $=="string"?$.split(",").map(ae=>Number.parseInt(ae,10)):typeof $=="function"?ae=>$(ae,this._element):$}_resolvePossibleFunction($){return _e($,[this._element])}_getPopperConfig($){const ae={placement:$,modifiers:[{name:"flip",options:{fallbackPlacements:this._config.fallbackPlacements}},{name:"offset",options:{offset:this._getOffset()}},{name:"preventOverflow",options:{boundary:this._config.boundary}},{name:"arrow",options:{element:`.${this.constructor.NAME}-arrow`}},{name:"preSetPlacement",enabled:!0,phase:"beforeMain",fn:De=>{this._getTipElement().setAttribute("data-popper-placement",De.state.placement)}}]};return{...ae,..._e(this._config.popperConfig,[ae])}}_setListeners(){const $=this._config.trigger.split(" ");for(const ae of $)if(ae==="click")Ve.on(this._element,this.constructor.eventName("click"),this._config.selector,De=>{this._initializeOnDelegatedTarget(De).toggle()});else if(ae!=="manual"){const De=ae===oc?this.constructor.eventName("mouseenter"):this.constructor.eventName("focusin"),qe=ae===oc?this.constructor.eventName("mouseleave"):this.constructor.eventName("focusout");Ve.on(this._element,De,this._config.selector,Dt=>{const Qt=this._initializeOnDelegatedTarget(Dt);Qt._activeTrigger[Dt.type==="focusin"?Ec:oc]=!0,Qt._enter()}),Ve.on(this._element,qe,this._config.selector,Dt=>{const Qt=this._initializeOnDelegatedTarget(Dt);Qt._activeTrigger[Dt.type==="focusout"?Ec:oc]=Qt._element.contains(Dt.relatedTarget),Qt._leave()})}this._hideModalHandler=()=>{this._element&&this.hide()},Ve.on(this._element.closest(Qi),Ru,this._hideModalHandler)}_fixTitle(){const $=this._element.getAttribute("title");$&&(this._element.getAttribute("aria-label")||this._element.textContent.trim()||this._element.setAttribute("aria-label",$),this._element.setAttribute("data-bs-original-title",$),this._element.removeAttribute("title"))}_enter(){this._isShown()||this._isHovered?this._isHovered=!0:(this._isHovered=!0,this._setTimeout(()=>{this._isHovered&&this.show()},this._config.delay.show))}_leave(){this._isWithActiveTrigger()||(this._isHovered=!1,this._setTimeout(()=>{this._isHovered||this.hide()},this._config.delay.hide))}_setTimeout($,ae){clearTimeout(this._timeout),this._timeout=setTimeout($,ae)}_isWithActiveTrigger(){return Object.values(this._activeTrigger).includes(!0)}_getConfig($){const ae=Ot.getDataAttributes(this._element);for(const De of Object.keys(ae))Ap.has(De)&&delete ae[De];return $={...ae,...typeof $=="object"&&$?$:{}},$=this._mergeConfigObj($),$=this._configAfterMerge($),this._typeCheckConfig($),$}_configAfterMerge($){return $.container=$.container===!1?document.body:H($.container),typeof $.delay=="number"&&($.delay={show:$.delay,hide:$.delay}),typeof $.title=="number"&&($.title=$.title.toString()),typeof $.content=="number"&&($.content=$.content.toString()),$}_getDelegateConfig(){const $={};for(const[ae,De]of Object.entries(this._config))this.constructor.Default[ae]!==De&&($[ae]=De);return $.selector=!1,$.trigger="manual",$}_disposePopper(){this._popper&&(this._popper.destroy(),this._popper=null),this.tip&&(this.tip.remove(),this.tip=null)}static jQueryInterface($){return this.each(function(){const ae=ml.getOrCreateInstance(this,$);if(typeof $=="string"){if(ae[$]===void 0)throw new TypeError(`No method named "${$}"`);ae[$]()}})}}me(ml);const _s={...ml.Default,content:"",offset:[0,8],placement:"right",template:'<div class="popover" role="tooltip"><div class="popover-arrow"></div><h3 class="popover-header"></h3><div class="popover-body"></div></div>',trigger:"click"},Gh={...ml.DefaultType,content:"(null|string|element|function)"};class Yc extends ml{static get Default(){return _s}static get DefaultType(){return Gh}static get NAME(){return"popover"}_isWithContent(){return this._getTitle()||this._getContent()}_getContentForTemplate(){return{".popover-header":this._getTitle(),".popover-body":this._getContent()}}_getContent(){return this._resolvePossibleFunction(this._config.content)}static jQueryInterface($){return this.each(function(){const ae=Yc.getOrCreateInstance(this,$);if(typeof $=="string"){if(ae[$]===void 0)throw new TypeError(`No method named "${$}"`);ae[$]()}})}}me(Yc);const ku=".bs.scrollspy",qh=`activate${ku}`,Kc=`click${ku}`,Jc=`load${ku}.data-api`,Ol="active",Qc="[href]",eu=".nav-link",Zh=`${eu}, .nav-item > ${eu}, .list-group-item`,kf={offset:null,rootMargin:"0px 0px -25%",smoothScroll:!1,target:null,threshold:[.1,.5,1]},tu={offset:"(number|null)",rootMargin:"string",smoothScroll:"boolean",target:"element",threshold:"array"};class oh extends hn{constructor($,ae){super($,ae),this._targetLinks=new Map,this._observableSections=new Map,this._rootElement=getComputedStyle(this._element).overflowY==="visible"?null:this._element,this._activeTarget=null,this._observer=null,this._previousScrollData={visibleEntryTop:0,parentScrollTop:0},this.refresh()}static get Default(){return kf}static get DefaultType(){return tu}static get NAME(){return"scrollspy"}refresh(){this._initializeTargetsAndObservables(),this._maybeEnableSmoothScroll(),this._observer?this._observer.disconnect():this._observer=this._getNewObserver();for(const $ of this._observableSections.values())this._observer.observe($)}dispose(){this._observer.disconnect(),super.dispose()}_configAfterMerge($){return $.target=H($.target)||document.body,$.rootMargin=$.offset?`${$.offset}px 0px -30%`:$.rootMargin,typeof $.threshold=="string"&&($.threshold=$.threshold.split(",").map(ae=>Number.parseFloat(ae))),$}_maybeEnableSmoothScroll(){this._config.smoothScroll&&(Ve.off(this._config.target,Kc),Ve.on(this._config.target,Kc,Qc,$=>{const ae=this._observableSections.get($.target.hash);if(ae){$.preventDefault();const De=this._rootElement||window,qe=ae.offsetTop-this._element.offsetTop;if(De.scrollTo)return void De.scrollTo({top:qe,behavior:"smooth"});De.scrollTop=qe}}))}_getNewObserver(){const $={root:this._rootElement,threshold:this._config.threshold,rootMargin:this._config.rootMargin};return new IntersectionObserver(ae=>this._observerCallback(ae),$)}_observerCallback($){const ae=Qt=>this._targetLinks.get(`#${Qt.target.id}`),De=Qt=>{this._previousScrollData.visibleEntryTop=Qt.target.offsetTop,this._process(ae(Qt))},qe=(this._rootElement||document.documentElement).scrollTop,Dt=qe>=this._previousScrollData.parentScrollTop;this._previousScrollData.parentScrollTop=qe;for(const Qt of $){if(!Qt.isIntersecting){this._activeTarget=null,this._clearActiveClass(ae(Qt));continue}const mn=Qt.target.offsetTop>=this._previousScrollData.visibleEntryTop;if(Dt&&mn){if(De(Qt),!qe)return}else Dt||mn||De(Qt)}}_initializeTargetsAndObservables(){this._targetLinks=new Map,this._observableSections=new Map;const $=Ut.find(Qc,this._config.target);for(const ae of $){if(!ae.hash||K(ae))continue;const De=Ut.findOne(decodeURI(ae.hash),this._element);Z(De)&&(this._targetLinks.set(decodeURI(ae.hash),ae),this._observableSections.set(ae.hash,De))}}_process($){this._activeTarget!==$&&(this._clearActiveClass(this._config.target),this._activeTarget=$,$.classList.add(Ol),this._activateParents($),Ve.trigger(this._element,qh,{relatedTarget:$}))}_activateParents($){if($.classList.contains("dropdown-item"))Ut.findOne(".dropdown-toggle",$.closest(".dropdown")).classList.add(Ol);else for(const ae of Ut.parents($,".nav, .list-group"))for(const De of Ut.prev(ae,Zh))De.classList.add(Ol)}_clearActiveClass($){$.classList.remove(Ol);const ae=Ut.find(`${Qc}.${Ol}`,$);for(const De of ae)De.classList.remove(Ol)}static jQueryInterface($){return this.each(function(){const ae=oh.getOrCreateInstance(this,$);if(typeof $=="string"){if(ae[$]===void 0||$.startsWith("_")||$==="constructor")throw new TypeError(`No method named "${$}"`);ae[$]()}})}}Ve.on(window,Jc,()=>{for(const xe of Ut.find('[data-bs-spy="scroll"]'))oh.getOrCreateInstance(xe)}),me(oh);const nu=".bs.tab",Fd=`hide${nu}`,Tc=`hidden${nu}`,zf=`show${nu}`,Cc=`shown${nu}`,Ha=`click${nu}`,Mc=`keydown${nu}`,Dl=`load${nu}`,Ac="ArrowLeft",Bd="ArrowRight",Nd="ArrowUp",Fl="ArrowDown",ca="Home",ua="End",Wa="active",gl="fade",Ga="show",ha=".dropdown-toggle",eo=`:not(${ha})`,to='[data-bs-toggle="tab"], [data-bs-toggle="pill"], [data-bs-toggle="list"]',Ea=`.nav-link${eo}, .list-group-item${eo}, [role="tab"]${eo}, ${to}`,ys=`.${Wa}[data-bs-toggle="tab"], .${Wa}[data-bs-toggle="pill"], .${Wa}[data-bs-toggle="list"]`;class Qo extends hn{constructor($){super($),this._parent=this._element.closest('.list-group, .nav, [role="tablist"]'),this._parent&&(this._setInitialAttributes(this._parent,this._getChildren()),Ve.on(this._element,Mc,ae=>this._keydown(ae)))}static get NAME(){return"tab"}show(){const $=this._element;if(this._elemIsActive($))return;const ae=this._getActiveElem(),De=ae?Ve.trigger(ae,Fd,{relatedTarget:$}):null;Ve.trigger($,zf,{relatedTarget:ae}).defaultPrevented||De&&De.defaultPrevented||(this._deactivate(ae,$),this._activate($,ae))}_activate($,ae){$&&($.classList.add(Wa),this._activate(Ut.getElementFromSelector($)),this._queueCallback(()=>{$.getAttribute("role")==="tab"?($.removeAttribute("tabindex"),$.setAttribute("aria-selected",!0),this._toggleDropDown($,!0),Ve.trigger($,Cc,{relatedTarget:ae})):$.classList.add(Ga)},$,$.classList.contains(gl)))}_deactivate($,ae){$&&($.classList.remove(Wa),$.blur(),this._deactivate(Ut.getElementFromSelector($)),this._queueCallback(()=>{$.getAttribute("role")==="tab"?($.setAttribute("aria-selected",!1),$.setAttribute("tabindex","-1"),this._toggleDropDown($,!1),Ve.trigger($,Tc,{relatedTarget:ae})):$.classList.remove(Ga)},$,$.classList.contains(gl)))}_keydown($){if(![Ac,Bd,Nd,Fl,ca,ua].includes($.key))return;$.stopPropagation(),$.preventDefault();const ae=this._getChildren().filter(qe=>!K(qe));let De;if([ca,ua].includes($.key))De=ae[$.key===ca?0:ae.length-1];else{const qe=[Bd,Fl].includes($.key);De=Ne(ae,$.target,qe,!0)}De&&(De.focus({preventScroll:!0}),Qo.getOrCreateInstance(De).show())}_getChildren(){return Ut.find(Ea,this._parent)}_getActiveElem(){return this._getChildren().find($=>this._elemIsActive($))||null}_setInitialAttributes($,ae){this._setAttributeIfNotExists($,"role","tablist");for(const De of ae)this._setInitialAttributesOnChild(De)}_setInitialAttributesOnChild($){$=this._getInnerElement($);const ae=this._elemIsActive($),De=this._getOuterElement($);$.setAttribute("aria-selected",ae),De!==$&&this._setAttributeIfNotExists(De,"role","presentation"),ae||$.setAttribute("tabindex","-1"),this._setAttributeIfNotExists($,"role","tab"),this._setInitialAttributesOnTargetPanel($)}_setInitialAttributesOnTargetPanel($){const ae=Ut.getElementFromSelector($);ae&&(this._setAttributeIfNotExists(ae,"role","tabpanel"),$.id&&this._setAttributeIfNotExists(ae,"aria-labelledby",`${$.id}`))}_toggleDropDown($,ae){const De=this._getOuterElement($);if(!De.classList.contains("dropdown"))return;const qe=(Dt,Qt)=>{const mn=Ut.findOne(Dt,De);mn&&mn.classList.toggle(Qt,ae)};qe(ha,Wa),qe(".dropdown-menu",Ga),De.setAttribute("aria-expanded",ae)}_setAttributeIfNotExists($,ae,De){$.hasAttribute(ae)||$.setAttribute(ae,De)}_elemIsActive($){return $.classList.contains(Wa)}_getInnerElement($){return $.matches(Ea)?$:Ut.findOne(Ea,$)}_getOuterElement($){return $.closest(".nav-item, .list-group-item")||$}static jQueryInterface($){return this.each(function(){const ae=Qo.getOrCreateInstance(this);if(typeof $=="string"){if(ae[$]===void 0||$.startsWith("_")||$==="constructor")throw new TypeError(`No method named "${$}"`);ae[$]()}})}}Ve.on(document,Ha,to,function(xe){["A","AREA"].includes(this.tagName)&&xe.preventDefault(),K(this)||Qo.getOrCreateInstance(this).show()}),Ve.on(window,Dl,()=>{for(const xe of Ut.find(ys))Qo.getOrCreateInstance(xe)}),me(Qo);const Ks=".bs.toast",Bl=`mouseover${Ks}`,Js=`mouseout${Ks}`,sh=`focusin${Ks}`,zu=`focusout${Ks}`,Lf=`hide${Ks}`,ru=`hidden${Ks}`,Xh=`show${Ks}`,Ta=`shown${Ks}`,Ic="hide",_l="show",Lu="showing",Yh={animation:"boolean",autohide:"boolean",delay:"number"},yl={animation:!0,autohide:!0,delay:5e3};class Ca extends hn{constructor($,ae){super($,ae),this._timeout=null,this._hasMouseInteraction=!1,this._hasKeyboardInteraction=!1,this._setListeners()}static get Default(){return yl}static get DefaultType(){return Yh}static get NAME(){return"toast"}show(){Ve.trigger(this._element,Xh).defaultPrevented||(this._clearTimeout(),this._config.animation&&this._element.classList.add("fade"),this._element.classList.remove(Ic),Te(this._element),this._element.classList.add(_l,Lu),this._queueCallback(()=>{this._element.classList.remove(Lu),Ve.trigger(this._element,Ta),this._maybeScheduleHide()},this._element,this._config.animation))}hide(){this.isShown()&&(Ve.trigger(this._element,Lf).defaultPrevented||(this._element.classList.add(Lu),this._queueCallback(()=>{this._element.classList.add(Ic),this._element.classList.remove(Lu,_l),Ve.trigger(this._element,ru)},this._element,this._config.animation)))}dispose(){this._clearTimeout(),this.isShown()&&this._element.classList.remove(_l),super.dispose()}isShown(){return this._element.classList.contains(_l)}_maybeScheduleHide(){this._config.autohide&&(this._hasMouseInteraction||this._hasKeyboardInteraction||(this._timeout=setTimeout(()=>{this.hide()},this._config.delay)))}_onInteraction($,ae){switch($.type){case"mouseover":case"mouseout":this._hasMouseInteraction=ae;break;case"focusin":case"focusout":this._hasKeyboardInteraction=ae}if(ae)return void this._clearTimeout();const De=$.relatedTarget;this._element===De||this._element.contains(De)||this._maybeScheduleHide()}_setListeners(){Ve.on(this._element,Bl,$=>this._onInteraction($,!0)),Ve.on(this._element,Js,$=>this._onInteraction($,!1)),Ve.on(this._element,sh,$=>this._onInteraction($,!0)),Ve.on(this._element,zu,$=>this._onInteraction($,!1))}_clearTimeout(){clearTimeout(this._timeout),this._timeout=null}static jQueryInterface($){return this.each(function(){const ae=Ca.getOrCreateInstance(this,$);if(typeof $=="string"){if(ae[$]===void 0)throw new TypeError(`No method named "${$}"`);ae[$](this)}})}}return bn(Ca),me(Ca),{Alert:Ar,Button:Wr,Carousel:bt,Collapse:on,Dropdown:aa,Modal:Ua,Offcanvas:gr,Popover:Yc,ScrollSpy:oh,Tab:Qo,Toast:Ca,Tooltip:ml}})}(bv)),bv.exports}Oz();const LC=i=>{let l;const f=new Set,_=(Z,K)=>{const te=typeof Z=="function"?Z(l):Z;if(!Object.is(te,l)){const le=l;l=K??(typeof te!="object"||te===null)?te:Object.assign({},l,te),f.forEach(Te=>Te(l,le))}},b=()=>l,r={setState:_,getState:b,getInitialState:()=>H,subscribe:Z=>(f.add(Z),()=>f.delete(Z))},H=l=i(_,b,r);return r},Dz=i=>i?LC(i):LC,Fz=i=>i;function Bz(i,l=Fz){const f=Nn.useSyncExternalStore(i.subscribe,()=>l(i.getState()),()=>l(i.getInitialState()));return Nn.useDebugValue(f),f}const OC=i=>{const l=Dz(i),f=_=>Bz(l,_);return Object.assign(f,l),f},jA=i=>i?OC(i):OC,oy=jA(i=>({posterSize:"30*40",setPosterSize:(l,f)=>{i({posterSize:l}),f&&f()},isLabels:!0,setIsLabels:l=>i({isLabels:l}),city:"Berlin",setCity:l=>i({city:l}),country:"Germany",setCountry:l=>i({country:l}),coordinates:[13.38886,52.517037],setCoordinates:l=>i({coordinates:l})}));var u1={exports:{}};/*!
	Copyright (c) 2018 Jed Watson.
	Licensed under the MIT License (MIT), see
	http://jedwatson.github.io/classnames
*/var DC;function Nz(){return DC||(DC=1,function(i){(function(){var l={}.hasOwnProperty;function f(){for(var z="",O=0;O<arguments.length;O++){var r=arguments[O];r&&(z=b(z,_(r)))}return z}function _(z){if(typeof z=="string"||typeof z=="number")return z;if(typeof z!="object")return"";if(Array.isArray(z))return f.apply(null,z);if(z.toString!==Object.prototype.toString&&!z.toString.toString().includes("[native code]"))return z.toString();var O="";for(var r in z)l.call(z,r)&&z[r]&&(O=b(O,r));return O}function b(z,O){return O?z?z+" "+O:z+O:z}i.exports?(f.default=f,i.exports=f):window.classNames=f})()}(u1)),u1.exports}var jz=Nz();const sr=lm(jz);function $s(){return $s=Object.assign?Object.assign.bind():function(i){for(var l=1;l<arguments.length;l++){var f=arguments[l];for(var _ in f)({}).hasOwnProperty.call(f,_)&&(i[_]=f[_])}return i},$s.apply(null,arguments)}function li(i){"@babel/helpers - typeof";return li=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(l){return typeof l}:function(l){return l&&typeof Symbol=="function"&&l.constructor===Symbol&&l!==Symbol.prototype?"symbol":typeof l},li(i)}var $z=Symbol.for("react.element"),Vz=Symbol.for("react.transitional.element"),Uz=Symbol.for("react.fragment");function $A(i){return i&&li(i)==="object"&&(i.$$typeof===$z||i.$$typeof===Vz)&&i.type===Uz}function G_(i){var l=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},f=[];return Nn.Children.forEach(i,function(_){_==null&&!l.keepEmpty||(Array.isArray(_)?f=f.concat(G_(_)):$A(_)&&_.props?f=f.concat(G_(_.props.children,l)):f.push(_))}),f}var U1={},Hz=function(l){};function Wz(i,l){}function Gz(i,l){}function qz(){U1={}}function VA(i,l,f){!l&&!U1[f]&&(i(!1,f),U1[f]=!0)}function xu(i,l){VA(Wz,i,l)}function Zz(i,l){VA(Gz,i,l)}xu.preMessage=Hz;xu.resetWarned=qz;xu.noteOnce=Zz;function Xz(i,l){if(li(i)!="object"||!i)return i;var f=i[Symbol.toPrimitive];if(f!==void 0){var _=f.call(i,l||"default");if(li(_)!="object")return _;throw new TypeError("@@toPrimitive must return a primitive value.")}return(l==="string"?String:Number)(i)}function UA(i){var l=Xz(i,"string");return li(l)=="symbol"?l:l+""}function jt(i,l,f){return(l=UA(l))in i?Object.defineProperty(i,l,{value:f,enumerable:!0,configurable:!0,writable:!0}):i[l]=f,i}function FC(i,l){var f=Object.keys(i);if(Object.getOwnPropertySymbols){var _=Object.getOwnPropertySymbols(i);l&&(_=_.filter(function(b){return Object.getOwnPropertyDescriptor(i,b).enumerable})),f.push.apply(f,_)}return f}function nn(i){for(var l=1;l<arguments.length;l++){var f=arguments[l]!=null?arguments[l]:{};l%2?FC(Object(f),!0).forEach(function(_){jt(i,_,f[_])}):Object.getOwnPropertyDescriptors?Object.defineProperties(i,Object.getOwnPropertyDescriptors(f)):FC(Object(f)).forEach(function(_){Object.defineProperty(i,_,Object.getOwnPropertyDescriptor(f,_))})}return i}var TS=NA();const H1=lm(TS),Yz=BA({__proto__:null,default:H1},[TS]);function q_(i){return i instanceof HTMLElement||i instanceof SVGElement}function Kz(i){return i&&li(i)==="object"&&q_(i.nativeElement)?i.nativeElement:q_(i)?i:null}function wv(i){var l=Kz(i);if(l)return l;if(i instanceof Nn.Component){var f;return(f=H1.findDOMNode)===null||f===void 0?void 0:f.call(H1,i)}return null}var h1={exports:{}},Mo={};/**
 * @license React
 * react-is.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var BC;function Jz(){if(BC)return Mo;BC=1;var i=Symbol.for("react.element"),l=Symbol.for("react.portal"),f=Symbol.for("react.fragment"),_=Symbol.for("react.strict_mode"),b=Symbol.for("react.profiler"),z=Symbol.for("react.provider"),O=Symbol.for("react.context"),r=Symbol.for("react.server_context"),H=Symbol.for("react.forward_ref"),Z=Symbol.for("react.suspense"),K=Symbol.for("react.suspense_list"),te=Symbol.for("react.memo"),le=Symbol.for("react.lazy"),Te=Symbol.for("react.offscreen"),pe;pe=Symbol.for("react.module.reference");function ge(fe){if(typeof fe=="object"&&fe!==null){var me=fe.$$typeof;switch(me){case i:switch(fe=fe.type,fe){case f:case b:case _:case Z:case K:return fe;default:switch(fe=fe&&fe.$$typeof,fe){case r:case O:case H:case le:case te:case z:return fe;default:return me}}case l:return me}}}return Mo.ContextConsumer=O,Mo.ContextProvider=z,Mo.Element=i,Mo.ForwardRef=H,Mo.Fragment=f,Mo.Lazy=le,Mo.Memo=te,Mo.Portal=l,Mo.Profiler=b,Mo.StrictMode=_,Mo.Suspense=Z,Mo.SuspenseList=K,Mo.isAsyncMode=function(){return!1},Mo.isConcurrentMode=function(){return!1},Mo.isContextConsumer=function(fe){return ge(fe)===O},Mo.isContextProvider=function(fe){return ge(fe)===z},Mo.isElement=function(fe){return typeof fe=="object"&&fe!==null&&fe.$$typeof===i},Mo.isForwardRef=function(fe){return ge(fe)===H},Mo.isFragment=function(fe){return ge(fe)===f},Mo.isLazy=function(fe){return ge(fe)===le},Mo.isMemo=function(fe){return ge(fe)===te},Mo.isPortal=function(fe){return ge(fe)===l},Mo.isProfiler=function(fe){return ge(fe)===b},Mo.isStrictMode=function(fe){return ge(fe)===_},Mo.isSuspense=function(fe){return ge(fe)===Z},Mo.isSuspenseList=function(fe){return ge(fe)===K},Mo.isValidElementType=function(fe){return typeof fe=="string"||typeof fe=="function"||fe===f||fe===b||fe===_||fe===Z||fe===K||fe===Te||typeof fe=="object"&&fe!==null&&(fe.$$typeof===le||fe.$$typeof===te||fe.$$typeof===z||fe.$$typeof===O||fe.$$typeof===H||fe.$$typeof===pe||fe.getModuleId!==void 0)},Mo.typeOf=ge,Mo}var NC;function Qz(){return NC||(NC=1,h1.exports=Jz()),h1.exports}var d1=Qz();function CS(i,l,f){var _=se.useRef({});return(!("value"in _.current)||f(_.current.condition,l))&&(_.current.value=i(),_.current.condition=l),_.current.value}var MS=function(l,f){typeof l=="function"?l(f):li(l)==="object"&&l&&"current"in l&&(l.current=f)},bf=function(){for(var l=arguments.length,f=new Array(l),_=0;_<l;_++)f[_]=arguments[_];var b=f.filter(Boolean);return b.length<=1?b[0]:function(z){f.forEach(function(O){MS(O,z)})}},Tx=function(){for(var l=arguments.length,f=new Array(l),_=0;_<l;_++)f[_]=arguments[_];return CS(function(){return bf.apply(void 0,f)},f,function(b,z){return b.length!==z.length||b.every(function(O,r){return O!==z[r]})})},sy=function(l){var f,_;if(!l)return!1;if(HA(l)&&l.props.propertyIsEnumerable("ref"))return!0;var b=d1.isMemo(l)?l.type.type:l.type;return!(typeof b=="function"&&!((f=b.prototype)!==null&&f!==void 0&&f.render)&&b.$$typeof!==d1.ForwardRef||typeof l=="function"&&!((_=l.prototype)!==null&&_!==void 0&&_.render)&&l.$$typeof!==d1.ForwardRef)};function HA(i){return se.isValidElement(i)&&!$A(i)}var Cx=function(l){if(l&&HA(l)){var f=l;return f.props.propertyIsEnumerable("ref")?f.props.ref:f.ref}return null},W1=se.createContext(null);function eL(i){var l=i.children,f=i.onBatchResize,_=se.useRef(0),b=se.useRef([]),z=se.useContext(W1),O=se.useCallback(function(r,H,Z){_.current+=1;var K=_.current;b.current.push({size:r,element:H,data:Z}),Promise.resolve().then(function(){K===_.current&&(f==null||f(b.current),b.current=[])}),z==null||z(r,H,Z)},[f,z]);return se.createElement(W1.Provider,{value:O},l)}var WA=function(){if(typeof Map<"u")return Map;function i(l,f){var _=-1;return l.some(function(b,z){return b[0]===f?(_=z,!0):!1}),_}return function(){function l(){this.__entries__=[]}return Object.defineProperty(l.prototype,"size",{get:function(){return this.__entries__.length},enumerable:!0,configurable:!0}),l.prototype.get=function(f){var _=i(this.__entries__,f),b=this.__entries__[_];return b&&b[1]},l.prototype.set=function(f,_){var b=i(this.__entries__,f);~b?this.__entries__[b][1]=_:this.__entries__.push([f,_])},l.prototype.delete=function(f){var _=this.__entries__,b=i(_,f);~b&&_.splice(b,1)},l.prototype.has=function(f){return!!~i(this.__entries__,f)},l.prototype.clear=function(){this.__entries__.splice(0)},l.prototype.forEach=function(f,_){_===void 0&&(_=null);for(var b=0,z=this.__entries__;b<z.length;b++){var O=z[b];f.call(_,O[1],O[0])}},l}()}(),G1=typeof window<"u"&&typeof document<"u"&&window.document===document,ox=function(){return typeof global<"u"&&global.Math===Math?global:typeof self<"u"&&self.Math===Math?self:typeof window<"u"&&window.Math===Math?window:Function("return this")()}(),tL=function(){return typeof requestAnimationFrame=="function"?requestAnimationFrame.bind(ox):function(i){return setTimeout(function(){return i(Date.now())},1e3/60)}}(),nL=2;function rL(i,l){var f=!1,_=!1,b=0;function z(){f&&(f=!1,i()),_&&r()}function O(){tL(z)}function r(){var H=Date.now();if(f){if(H-b<nL)return;_=!0}else f=!0,_=!1,setTimeout(O,l);b=H}return r}var iL=20,oL=["top","right","bottom","left","width","height","size","weight"],sL=typeof MutationObserver<"u",aL=function(){function i(){this.connected_=!1,this.mutationEventsAdded_=!1,this.mutationsObserver_=null,this.observers_=[],this.onTransitionEnd_=this.onTransitionEnd_.bind(this),this.refresh=rL(this.refresh.bind(this),iL)}return i.prototype.addObserver=function(l){~this.observers_.indexOf(l)||this.observers_.push(l),this.connected_||this.connect_()},i.prototype.removeObserver=function(l){var f=this.observers_,_=f.indexOf(l);~_&&f.splice(_,1),!f.length&&this.connected_&&this.disconnect_()},i.prototype.refresh=function(){var l=this.updateObservers_();l&&this.refresh()},i.prototype.updateObservers_=function(){var l=this.observers_.filter(function(f){return f.gatherActive(),f.hasActive()});return l.forEach(function(f){return f.broadcastActive()}),l.length>0},i.prototype.connect_=function(){!G1||this.connected_||(document.addEventListener("transitionend",this.onTransitionEnd_),window.addEventListener("resize",this.refresh),sL?(this.mutationsObserver_=new MutationObserver(this.refresh),this.mutationsObserver_.observe(document,{attributes:!0,childList:!0,characterData:!0,subtree:!0})):(document.addEventListener("DOMSubtreeModified",this.refresh),this.mutationEventsAdded_=!0),this.connected_=!0)},i.prototype.disconnect_=function(){!G1||!this.connected_||(document.removeEventListener("transitionend",this.onTransitionEnd_),window.removeEventListener("resize",this.refresh),this.mutationsObserver_&&this.mutationsObserver_.disconnect(),this.mutationEventsAdded_&&document.removeEventListener("DOMSubtreeModified",this.refresh),this.mutationsObserver_=null,this.mutationEventsAdded_=!1,this.connected_=!1)},i.prototype.onTransitionEnd_=function(l){var f=l.propertyName,_=f===void 0?"":f,b=oL.some(function(z){return!!~_.indexOf(z)});b&&this.refresh()},i.getInstance=function(){return this.instance_||(this.instance_=new i),this.instance_},i.instance_=null,i}(),GA=function(i,l){for(var f=0,_=Object.keys(l);f<_.length;f++){var b=_[f];Object.defineProperty(i,b,{value:l[b],enumerable:!1,writable:!1,configurable:!0})}return i},vg=function(i){var l=i&&i.ownerDocument&&i.ownerDocument.defaultView;return l||ox},qA=Mx(0,0,0,0);function sx(i){return parseFloat(i)||0}function jC(i){for(var l=[],f=1;f<arguments.length;f++)l[f-1]=arguments[f];return l.reduce(function(_,b){var z=i["border-"+b+"-width"];return _+sx(z)},0)}function lL(i){for(var l=["top","right","bottom","left"],f={},_=0,b=l;_<b.length;_++){var z=b[_],O=i["padding-"+z];f[z]=sx(O)}return f}function cL(i){var l=i.getBBox();return Mx(0,0,l.width,l.height)}function uL(i){var l=i.clientWidth,f=i.clientHeight;if(!l&&!f)return qA;var _=vg(i).getComputedStyle(i),b=lL(_),z=b.left+b.right,O=b.top+b.bottom,r=sx(_.width),H=sx(_.height);if(_.boxSizing==="border-box"&&(Math.round(r+z)!==l&&(r-=jC(_,"left","right")+z),Math.round(H+O)!==f&&(H-=jC(_,"top","bottom")+O)),!dL(i)){var Z=Math.round(r+z)-l,K=Math.round(H+O)-f;Math.abs(Z)!==1&&(r-=Z),Math.abs(K)!==1&&(H-=K)}return Mx(b.left,b.top,r,H)}var hL=function(){return typeof SVGGraphicsElement<"u"?function(i){return i instanceof vg(i).SVGGraphicsElement}:function(i){return i instanceof vg(i).SVGElement&&typeof i.getBBox=="function"}}();function dL(i){return i===vg(i).document.documentElement}function fL(i){return G1?hL(i)?cL(i):uL(i):qA}function pL(i){var l=i.x,f=i.y,_=i.width,b=i.height,z=typeof DOMRectReadOnly<"u"?DOMRectReadOnly:Object,O=Object.create(z.prototype);return GA(O,{x:l,y:f,width:_,height:b,top:f,right:l+_,bottom:b+f,left:l}),O}function Mx(i,l,f,_){return{x:i,y:l,width:f,height:_}}var mL=function(){function i(l){this.broadcastWidth=0,this.broadcastHeight=0,this.contentRect_=Mx(0,0,0,0),this.target=l}return i.prototype.isActive=function(){var l=fL(this.target);return this.contentRect_=l,l.width!==this.broadcastWidth||l.height!==this.broadcastHeight},i.prototype.broadcastRect=function(){var l=this.contentRect_;return this.broadcastWidth=l.width,this.broadcastHeight=l.height,l},i}(),gL=function(){function i(l,f){var _=pL(f);GA(this,{target:l,contentRect:_})}return i}(),_L=function(){function i(l,f,_){if(this.activeObservations_=[],this.observations_=new WA,typeof l!="function")throw new TypeError("The callback provided as parameter 1 is not a function.");this.callback_=l,this.controller_=f,this.callbackCtx_=_}return i.prototype.observe=function(l){if(!arguments.length)throw new TypeError("1 argument required, but only 0 present.");if(!(typeof Element>"u"||!(Element instanceof Object))){if(!(l instanceof vg(l).Element))throw new TypeError('parameter 1 is not of type "Element".');var f=this.observations_;f.has(l)||(f.set(l,new mL(l)),this.controller_.addObserver(this),this.controller_.refresh())}},i.prototype.unobserve=function(l){if(!arguments.length)throw new TypeError("1 argument required, but only 0 present.");if(!(typeof Element>"u"||!(Element instanceof Object))){if(!(l instanceof vg(l).Element))throw new TypeError('parameter 1 is not of type "Element".');var f=this.observations_;f.has(l)&&(f.delete(l),f.size||this.controller_.removeObserver(this))}},i.prototype.disconnect=function(){this.clearActive(),this.observations_.clear(),this.controller_.removeObserver(this)},i.prototype.gatherActive=function(){var l=this;this.clearActive(),this.observations_.forEach(function(f){f.isActive()&&l.activeObservations_.push(f)})},i.prototype.broadcastActive=function(){if(this.hasActive()){var l=this.callbackCtx_,f=this.activeObservations_.map(function(_){return new gL(_.target,_.broadcastRect())});this.callback_.call(l,f,l),this.clearActive()}},i.prototype.clearActive=function(){this.activeObservations_.splice(0)},i.prototype.hasActive=function(){return this.activeObservations_.length>0},i}(),ZA=typeof WeakMap<"u"?new WeakMap:new WA,XA=function(){function i(l){if(!(this instanceof i))throw new TypeError("Cannot call a class as a function.");if(!arguments.length)throw new TypeError("1 argument required, but only 0 present.");var f=aL.getInstance(),_=new _L(l,f,this);ZA.set(this,_)}return i}();["observe","unobserve","disconnect"].forEach(function(i){XA.prototype[i]=function(){var l;return(l=ZA.get(this))[i].apply(l,arguments)}});var yL=function(){return typeof ox.ResizeObserver<"u"?ox.ResizeObserver:XA}(),up=new Map;function vL(i){i.forEach(function(l){var f,_=l.target;(f=up.get(_))===null||f===void 0||f.forEach(function(b){return b(_)})})}var YA=new yL(vL);function xL(i,l){up.has(i)||(up.set(i,new Set),YA.observe(i)),up.get(i).add(l)}function bL(i,l){up.has(i)&&(up.get(i).delete(l),up.get(i).size||(YA.unobserve(i),up.delete(i)))}function Qa(i,l){if(!(i instanceof l))throw new TypeError("Cannot call a class as a function")}function $C(i,l){for(var f=0;f<l.length;f++){var _=l[f];_.enumerable=_.enumerable||!1,_.configurable=!0,"value"in _&&(_.writable=!0),Object.defineProperty(i,UA(_.key),_)}}function el(i,l,f){return l&&$C(i.prototype,l),f&&$C(i,f),Object.defineProperty(i,"prototype",{writable:!1}),i}function Z_(i,l){return Z_=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(f,_){return f.__proto__=_,f},Z_(i,l)}function yp(i,l){if(typeof l!="function"&&l!==null)throw new TypeError("Super expression must either be null or a function");i.prototype=Object.create(l&&l.prototype,{constructor:{value:i,writable:!0,configurable:!0}}),Object.defineProperty(i,"prototype",{writable:!1}),l&&Z_(i,l)}function X_(i){return X_=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(l){return l.__proto__||Object.getPrototypeOf(l)},X_(i)}function AS(){try{var i=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(AS=function(){return!!i})()}function Di(i){if(i===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return i}function wL(i,l){if(l&&(li(l)=="object"||typeof l=="function"))return l;if(l!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return Di(i)}function vp(i){var l=AS();return function(){var f,_=X_(i);if(l){var b=X_(this).constructor;f=Reflect.construct(_,arguments,b)}else f=_.apply(this,arguments);return wL(this,f)}}var SL=function(i){yp(f,i);var l=vp(f);function f(){return Qa(this,f),l.apply(this,arguments)}return el(f,[{key:"render",value:function(){return this.props.children}}]),f}(se.Component);function EL(i,l){var f=i.children,_=i.disabled,b=se.useRef(null),z=se.useRef(null),O=se.useContext(W1),r=typeof f=="function",H=r?f(b):f,Z=se.useRef({width:-1,height:-1,offsetWidth:-1,offsetHeight:-1}),K=!r&&se.isValidElement(H)&&sy(H),te=K?Cx(H):null,le=Tx(te,b),Te=function(){var me;return wv(b.current)||(b.current&&li(b.current)==="object"?wv((me=b.current)===null||me===void 0?void 0:me.nativeElement):null)||wv(z.current)};se.useImperativeHandle(l,function(){return Te()});var pe=se.useRef(i);pe.current=i;var ge=se.useCallback(function(fe){var me=pe.current,_e=me.onResize,Ie=me.data,Ne=fe.getBoundingClientRect(),nt=Ne.width,Le=Ne.height,Pe=fe.offsetWidth,rt=fe.offsetHeight,at=Math.floor(nt),Qe=Math.floor(Le);if(Z.current.width!==at||Z.current.height!==Qe||Z.current.offsetWidth!==Pe||Z.current.offsetHeight!==rt){var lt={width:at,height:Qe,offsetWidth:Pe,offsetHeight:rt};Z.current=lt;var Ct=Pe===Math.round(nt)?nt:Pe,Rt=rt===Math.round(Le)?Le:rt,Nt=nn(nn({},lt),{},{offsetWidth:Ct,offsetHeight:Rt});O==null||O(Nt,fe,Ie),_e&&Promise.resolve().then(function(){_e(Nt,fe)})}},[]);return se.useEffect(function(){var fe=Te();return fe&&!_&&xL(fe,ge),function(){return bL(fe,ge)}},[b.current,_]),se.createElement(SL,{ref:z},K?se.cloneElement(H,{ref:le}):H)}var TL=se.forwardRef(EL),CL="rc-observer-key";function ML(i,l){var f=i.children,_=typeof f=="function"?[f]:G_(f);return _.map(function(b,z){var O=(b==null?void 0:b.key)||"".concat(CL,"-").concat(z);return se.createElement(TL,$s({},i,{key:O,ref:z===0?l:void 0}),b)})}var ay=se.forwardRef(ML);ay.Collection=eL;function IS(i,l){var f=Object.assign({},i);return Array.isArray(l)&&l.forEach(function(_){delete f[_]}),f}function q1(i,l){(l==null||l>i.length)&&(l=i.length);for(var f=0,_=Array(l);f<l;f++)_[f]=i[f];return _}function AL(i){if(Array.isArray(i))return q1(i)}function KA(i){if(typeof Symbol<"u"&&i[Symbol.iterator]!=null||i["@@iterator"]!=null)return Array.from(i)}function PS(i,l){if(i){if(typeof i=="string")return q1(i,l);var f={}.toString.call(i).slice(8,-1);return f==="Object"&&i.constructor&&(f=i.constructor.name),f==="Map"||f==="Set"?Array.from(i):f==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(f)?q1(i,l):void 0}}function IL(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Xr(i){return AL(i)||KA(i)||PS(i)||IL()}var JA=function(l){return+setTimeout(l,16)},QA=function(l){return clearTimeout(l)};typeof window<"u"&&"requestAnimationFrame"in window&&(JA=function(l){return window.requestAnimationFrame(l)},QA=function(l){return window.cancelAnimationFrame(l)});var VC=0,RS=new Map;function eI(i){RS.delete(i)}var qu=function(l){var f=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;VC+=1;var _=VC;function b(z){if(z===0)eI(_),l();else{var O=JA(function(){b(z-1)});RS.set(_,O)}}return b(f),_};qu.cancel=function(i){var l=RS.get(i);return eI(i),QA(l)};function tI(i){if(Array.isArray(i))return i}function PL(i,l){var f=i==null?null:typeof Symbol<"u"&&i[Symbol.iterator]||i["@@iterator"];if(f!=null){var _,b,z,O,r=[],H=!0,Z=!1;try{if(z=(f=f.call(i)).next,l===0){if(Object(f)!==f)return;H=!1}else for(;!(H=(_=z.call(f)).done)&&(r.push(_.value),r.length!==l);H=!0);}catch(K){Z=!0,b=K}finally{try{if(!H&&f.return!=null&&(O=f.return(),Object(O)!==O))return}finally{if(Z)throw b}}return r}}function nI(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Gn(i,l){return tI(i)||PL(i,l)||PS(i,l)||nI()}function Y_(i){for(var l=0,f,_=0,b=i.length;b>=4;++_,b-=4)f=i.charCodeAt(_)&255|(i.charCodeAt(++_)&255)<<8|(i.charCodeAt(++_)&255)<<16|(i.charCodeAt(++_)&255)<<24,f=(f&65535)*1540483477+((f>>>16)*59797<<16),f^=f>>>24,l=(f&65535)*1540483477+((f>>>16)*59797<<16)^(l&65535)*1540483477+((l>>>16)*59797<<16);switch(b){case 3:l^=(i.charCodeAt(_+2)&255)<<16;case 2:l^=(i.charCodeAt(_+1)&255)<<8;case 1:l^=i.charCodeAt(_)&255,l=(l&65535)*1540483477+((l>>>16)*59797<<16)}return l^=l>>>13,l=(l&65535)*1540483477+((l>>>16)*59797<<16),((l^l>>>15)>>>0).toString(36)}function wu(){return!!(typeof window<"u"&&window.document&&window.document.createElement)}function RL(i,l){if(!i)return!1;if(i.contains)return i.contains(l);for(var f=l;f;){if(f===i)return!0;f=f.parentNode}return!1}var UC="data-rc-order",HC="data-rc-priority",kL="rc-util-key",Z1=new Map;function rI(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},l=i.mark;return l?l.startsWith("data-")?l:"data-".concat(l):kL}function Ax(i){if(i.attachTo)return i.attachTo;var l=document.querySelector("head");return l||document.body}function zL(i){return i==="queue"?"prependQueue":i?"prepend":"append"}function kS(i){return Array.from((Z1.get(i)||i).children).filter(function(l){return l.tagName==="STYLE"})}function iI(i){var l=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!wu())return null;var f=l.csp,_=l.prepend,b=l.priority,z=b===void 0?0:b,O=zL(_),r=O==="prependQueue",H=document.createElement("style");H.setAttribute(UC,O),r&&z&&H.setAttribute(HC,"".concat(z)),f!=null&&f.nonce&&(H.nonce=f==null?void 0:f.nonce),H.innerHTML=i;var Z=Ax(l),K=Z.firstChild;if(_){if(r){var te=(l.styles||kS(Z)).filter(function(le){if(!["prepend","prependQueue"].includes(le.getAttribute(UC)))return!1;var Te=Number(le.getAttribute(HC)||0);return z>=Te});if(te.length)return Z.insertBefore(H,te[te.length-1].nextSibling),H}Z.insertBefore(H,K)}else Z.appendChild(H);return H}function oI(i){var l=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},f=Ax(l);return(l.styles||kS(f)).find(function(_){return _.getAttribute(rI(l))===i})}function K_(i){var l=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},f=oI(i,l);if(f){var _=Ax(l);_.removeChild(f)}}function LL(i,l){var f=Z1.get(i);if(!f||!RL(document,f)){var _=iI("",l),b=_.parentNode;Z1.set(i,b),i.removeChild(_)}}function gf(i,l){var f=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},_=Ax(f),b=kS(_),z=nn(nn({},f),{},{styles:b});LL(_,z);var O=oI(l,z);if(O){var r,H;if((r=z.csp)!==null&&r!==void 0&&r.nonce&&O.nonce!==((H=z.csp)===null||H===void 0?void 0:H.nonce)){var Z;O.nonce=(Z=z.csp)===null||Z===void 0?void 0:Z.nonce}return O.innerHTML!==i&&(O.innerHTML=i),O}var K=iI(i,z);return K.setAttribute(rI(z),l),K}function OL(i,l){if(i==null)return{};var f={};for(var _ in i)if({}.hasOwnProperty.call(i,_)){if(l.includes(_))continue;f[_]=i[_]}return f}function Ja(i,l){if(i==null)return{};var f,_,b=OL(i,l);if(Object.getOwnPropertySymbols){var z=Object.getOwnPropertySymbols(i);for(_=0;_<z.length;_++)f=z[_],l.includes(f)||{}.propertyIsEnumerable.call(i,f)&&(b[f]=i[f])}return b}function X1(i,l){var f=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1,_=new Set;function b(z,O){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1,H=_.has(z);if(xu(!H,"Warning: There may be circular references"),H)return!1;if(z===O)return!0;if(f&&r>1)return!1;_.add(z);var Z=r+1;if(Array.isArray(z)){if(!Array.isArray(O)||z.length!==O.length)return!1;for(var K=0;K<z.length;K++)if(!b(z[K],O[K],Z))return!1;return!0}if(z&&O&&li(z)==="object"&&li(O)==="object"){var te=Object.keys(z);return te.length!==Object.keys(O).length?!1:te.every(function(le){return b(z[le],O[le],Z)})}return!1}return b(i,l)}var DL="%";function Y1(i){return i.join(DL)}var FL=function(){function i(l){Qa(this,i),jt(this,"instanceId",void 0),jt(this,"cache",new Map),this.instanceId=l}return el(i,[{key:"get",value:function(f){return this.opGet(Y1(f))}},{key:"opGet",value:function(f){return this.cache.get(f)||null}},{key:"update",value:function(f,_){return this.opUpdate(Y1(f),_)}},{key:"opUpdate",value:function(f,_){var b=this.cache.get(f),z=_(b);z===null?this.cache.delete(f):this.cache.set(f,z)}}]),i}(),xg="data-token-hash",kh="data-css-hash",hp="__cssinjs_instance__";function BL(){var i=Math.random().toString(12).slice(2);if(typeof document<"u"&&document.head&&document.body){var l=document.body.querySelectorAll("style[".concat(kh,"]"))||[],f=document.head.firstChild;Array.from(l).forEach(function(b){b[hp]=b[hp]||i,b[hp]===i&&document.head.insertBefore(b,f)});var _={};Array.from(document.querySelectorAll("style[".concat(kh,"]"))).forEach(function(b){var z=b.getAttribute(kh);if(_[z]){if(b[hp]===i){var O;(O=b.parentNode)===null||O===void 0||O.removeChild(b)}}else _[z]=!0})}return new FL(i)}var Ix=se.createContext({hashPriority:"low",cache:BL(),defaultCache:!0});function NL(i,l){if(i.length!==l.length)return!1;for(var f=0;f<i.length;f++)if(i[f]!==l[f])return!1;return!0}var zS=function(){function i(){Qa(this,i),jt(this,"cache",void 0),jt(this,"keys",void 0),jt(this,"cacheCallTimes",void 0),this.cache=new Map,this.keys=[],this.cacheCallTimes=0}return el(i,[{key:"size",value:function(){return this.keys.length}},{key:"internalGet",value:function(f){var _,b,z=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1,O={map:this.cache};return f.forEach(function(r){if(!O)O=void 0;else{var H;O=(H=O)===null||H===void 0||(H=H.map)===null||H===void 0?void 0:H.get(r)}}),(_=O)!==null&&_!==void 0&&_.value&&z&&(O.value[1]=this.cacheCallTimes++),(b=O)===null||b===void 0?void 0:b.value}},{key:"get",value:function(f){var _;return(_=this.internalGet(f,!0))===null||_===void 0?void 0:_[0]}},{key:"has",value:function(f){return!!this.internalGet(f)}},{key:"set",value:function(f,_){var b=this;if(!this.has(f)){if(this.size()+1>i.MAX_CACHE_SIZE+i.MAX_CACHE_OFFSET){var z=this.keys.reduce(function(Z,K){var te=Gn(Z,2),le=te[1];return b.internalGet(K)[1]<le?[K,b.internalGet(K)[1]]:Z},[this.keys[0],this.cacheCallTimes]),O=Gn(z,1),r=O[0];this.delete(r)}this.keys.push(f)}var H=this.cache;f.forEach(function(Z,K){if(K===f.length-1)H.set(Z,{value:[_,b.cacheCallTimes++]});else{var te=H.get(Z);te?te.map||(te.map=new Map):H.set(Z,{map:new Map}),H=H.get(Z).map}})}},{key:"deleteByPath",value:function(f,_){var b=f.get(_[0]);if(_.length===1){var z;return b.map?f.set(_[0],{map:b.map}):f.delete(_[0]),(z=b.value)===null||z===void 0?void 0:z[0]}var O=this.deleteByPath(b.map,_.slice(1));return(!b.map||b.map.size===0)&&!b.value&&f.delete(_[0]),O}},{key:"delete",value:function(f){if(this.has(f))return this.keys=this.keys.filter(function(_){return!NL(_,f)}),this.deleteByPath(this.cache,f)}}]),i}();jt(zS,"MAX_CACHE_SIZE",20);jt(zS,"MAX_CACHE_OFFSET",5);var WC=0,sI=function(){function i(l){Qa(this,i),jt(this,"derivatives",void 0),jt(this,"id",void 0),this.derivatives=Array.isArray(l)?l:[l],this.id=WC,l.length===0&&(l.length>0,void 0),WC+=1}return el(i,[{key:"getDerivativeToken",value:function(f){return this.derivatives.reduce(function(_,b){return b(f,_)},void 0)}}]),i}(),f1=new zS;function K1(i){var l=Array.isArray(i)?i:[i];return f1.has(l)||f1.set(l,new sI(l)),f1.get(l)}var jL=new WeakMap,p1={};function $L(i,l){for(var f=jL,_=0;_<l.length;_+=1){var b=l[_];f.has(b)||f.set(b,new WeakMap),f=f.get(b)}return f.has(p1)||f.set(p1,i()),f.get(p1)}var GC=new WeakMap;function j_(i){var l=GC.get(i)||"";return l||(Object.keys(i).forEach(function(f){var _=i[f];l+=f,_ instanceof sI?l+=_.id:_&&li(_)==="object"?l+=j_(_):l+=_}),l=Y_(l),GC.set(i,l)),l}function qC(i,l){return Y_("".concat(l,"_").concat(j_(i)))}var J1=wu();function Ur(i){return typeof i=="number"?"".concat(i,"px"):i}function ax(i,l,f){var _,b=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{},z=arguments.length>4&&arguments[4]!==void 0?arguments[4]:!1;if(z)return i;var O=nn(nn({},b),{},(_={},jt(_,xg,l),jt(_,kh,f),_)),r=Object.keys(O).map(function(H){var Z=O[H];return Z?"".concat(H,'="').concat(Z,'"'):null}).filter(function(H){return H}).join(" ");return"<style ".concat(r,">").concat(i,"</style>")}var Sv=function(l){var f=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"";return"--".concat(f?"".concat(f,"-"):"").concat(l).replace(/([a-z0-9])([A-Z])/g,"$1-$2").replace(/([A-Z]+)([A-Z][a-z0-9]+)/g,"$1-$2").replace(/([a-z])([A-Z0-9])/g,"$1-$2").toLowerCase()},VL=function(l,f,_){return Object.keys(l).length?".".concat(f).concat(_!=null&&_.scope?".".concat(_.scope):"","{").concat(Object.entries(l).map(function(b){var z=Gn(b,2),O=z[0],r=z[1];return"".concat(O,":").concat(r,";")}).join(""),"}"):""},aI=function(l,f,_){var b={},z={};return Object.entries(l).forEach(function(O){var r,H,Z=Gn(O,2),K=Z[0],te=Z[1];if(_!=null&&(r=_.preserve)!==null&&r!==void 0&&r[K])z[K]=te;else if((typeof te=="string"||typeof te=="number")&&!(_!=null&&(H=_.ignore)!==null&&H!==void 0&&H[K])){var le,Te=Sv(K,_==null?void 0:_.prefix);b[Te]=typeof te=="number"&&!(_!=null&&(le=_.unitless)!==null&&le!==void 0&&le[K])?"".concat(te,"px"):String(te),z[K]="var(".concat(Te,")")}}),[z,VL(b,f,{scope:_==null?void 0:_.scope})]},ZC=wu()?se.useLayoutEffect:se.useEffect,Ka=function(l,f){var _=se.useRef(!0);ZC(function(){return l(_.current)},f),ZC(function(){return _.current=!1,function(){_.current=!0}},[])},XC=function(l,f){Ka(function(_){if(!_)return l()},f)},UL=nn({},Ex),YC=UL.useInsertionEffect,HL=function(l,f,_){se.useMemo(l,_),Ka(function(){return f(!0)},_)},WL=YC?function(i,l,f){return YC(function(){return i(),l()},f)}:HL,GL=nn({},Ex),qL=GL.useInsertionEffect,ZL=function(l){var f=[],_=!1;function b(z){_||f.push(z)}return se.useEffect(function(){return _=!1,function(){_=!0,f.length&&f.forEach(function(z){return z()})}},l),b},XL=function(){return function(l){l()}},YL=typeof qL<"u"?ZL:XL;function LS(i,l,f,_,b){var z=se.useContext(Ix),O=z.cache,r=[i].concat(Xr(l)),H=Y1(r),Z=YL([H]),K=function(pe){O.opUpdate(H,function(ge){var fe=ge||[void 0,void 0],me=Gn(fe,2),_e=me[0],Ie=_e===void 0?0:_e,Ne=me[1],nt=Ne,Le=nt||f(),Pe=[Ie,Le];return pe?pe(Pe):Pe})};se.useMemo(function(){K()},[H]);var te=O.opGet(H),le=te[1];return WL(function(){b==null||b(le)},function(Te){return K(function(pe){var ge=Gn(pe,2),fe=ge[0],me=ge[1];return Te&&fe===0&&(b==null||b(le)),[fe+1,me]}),function(){O.opUpdate(H,function(pe){var ge=pe||[],fe=Gn(ge,2),me=fe[0],_e=me===void 0?0:me,Ie=fe[1],Ne=_e-1;return Ne===0?(Z(function(){(Te||!O.opGet(H))&&(_==null||_(Ie,!1))}),null):[_e-1,Ie]})}},[H]),le}var KL={},JL="css",em=new Map;function QL(i){em.set(i,(em.get(i)||0)+1)}function eO(i,l){if(typeof document<"u"){var f=document.querySelectorAll("style[".concat(xg,'="').concat(i,'"]'));f.forEach(function(_){if(_[hp]===l){var b;(b=_.parentNode)===null||b===void 0||b.removeChild(_)}})}}var tO=0;function nO(i,l){em.set(i,(em.get(i)||0)-1);var f=Array.from(em.keys()),_=f.filter(function(b){var z=em.get(b)||0;return z<=0});f.length-_.length>tO&&_.forEach(function(b){eO(b,l),em.delete(b)})}var rO=function(l,f,_,b){var z=_.getDerivativeToken(l),O=nn(nn({},z),f);return b&&(O=b(O)),O},lI="token";function iO(i,l){var f=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},_=se.useContext(Ix),b=_.cache.instanceId,z=_.container,O=f.salt,r=O===void 0?"":O,H=f.override,Z=H===void 0?KL:H,K=f.formatToken,te=f.getComputedToken,le=f.cssVar,Te=$L(function(){return Object.assign.apply(Object,[{}].concat(Xr(l)))},l),pe=j_(Te),ge=j_(Z),fe=le?j_(le):"",me=LS(lI,[r,i.id,pe,ge,fe],function(){var _e,Ie=te?te(Te,Z,i):rO(Te,Z,i,K),Ne=nn({},Ie),nt="";if(le){var Le=aI(Ie,le.key,{prefix:le.prefix,ignore:le.ignore,unitless:le.unitless,preserve:le.preserve}),Pe=Gn(Le,2);Ie=Pe[0],nt=Pe[1]}var rt=qC(Ie,r);Ie._tokenKey=rt,Ne._tokenKey=qC(Ne,r);var at=(_e=le==null?void 0:le.key)!==null&&_e!==void 0?_e:rt;Ie._themeKey=at,QL(at);var Qe="".concat(JL,"-").concat(Y_(rt));return Ie._hashId=Qe,[Ie,Qe,Ne,nt,(le==null?void 0:le.key)||""]},function(_e){nO(_e[0]._themeKey,b)},function(_e){var Ie=Gn(_e,4),Ne=Ie[0],nt=Ie[3];if(le&&nt){var Le=gf(nt,Y_("css-variables-".concat(Ne._themeKey)),{mark:kh,prepend:"queue",attachTo:z,priority:-999});Le[hp]=b,Le.setAttribute(xg,Ne._themeKey)}});return me}var oO=function(l,f,_){var b=Gn(l,5),z=b[2],O=b[3],r=b[4],H=_||{},Z=H.plain;if(!O)return null;var K=z._tokenKey,te=-999,le={"data-rc-order":"prependQueue","data-rc-priority":"".concat(te)},Te=ax(O,r,K,le,Z);return[te,K,Te]},sO={animationIterationCount:1,borderImageOutset:1,borderImageSlice:1,borderImageWidth:1,boxFlex:1,boxFlexGroup:1,boxOrdinalGroup:1,columnCount:1,columns:1,flex:1,flexGrow:1,flexPositive:1,flexShrink:1,flexNegative:1,flexOrder:1,gridRow:1,gridRowEnd:1,gridRowSpan:1,gridRowStart:1,gridColumn:1,gridColumnEnd:1,gridColumnSpan:1,gridColumnStart:1,msGridRow:1,msGridRowSpan:1,msGridColumn:1,msGridColumnSpan:1,fontWeight:1,lineHeight:1,opacity:1,order:1,orphans:1,tabSize:1,widows:1,zIndex:1,zoom:1,WebkitLineClamp:1,fillOpacity:1,floodOpacity:1,stopOpacity:1,strokeDasharray:1,strokeDashoffset:1,strokeMiterlimit:1,strokeOpacity:1,strokeWidth:1},cI="comm",uI="rule",hI="decl",aO="@import",lO="@keyframes",cO="@layer",dI=Math.abs,OS=String.fromCharCode;function fI(i){return i.trim()}function Ev(i,l,f){return i.replace(l,f)}function uO(i,l,f){return i.indexOf(l,f)}function J_(i,l){return i.charCodeAt(l)|0}function bg(i,l,f){return i.slice(l,f)}function Td(i){return i.length}function hO(i){return i.length}function cv(i,l){return l.push(i),i}var Px=1,wg=1,pI=0,Zu=0,_a=0,Ag="";function DS(i,l,f,_,b,z,O,r){return{value:i,root:l,parent:f,type:_,props:b,children:z,line:Px,column:wg,length:O,return:"",siblings:r}}function dO(){return _a}function fO(){return _a=Zu>0?J_(Ag,--Zu):0,wg--,_a===10&&(wg=1,Px--),_a}function zh(){return _a=Zu<pI?J_(Ag,Zu++):0,wg++,_a===10&&(wg=1,Px++),_a}function dp(){return J_(Ag,Zu)}function Tv(){return Zu}function Rx(i,l){return bg(Ag,i,l)}function Q_(i){switch(i){case 0:case 9:case 10:case 13:case 32:return 5;case 33:case 43:case 44:case 47:case 62:case 64:case 126:case 59:case 123:case 125:return 4;case 58:return 3;case 34:case 39:case 40:case 91:return 2;case 41:case 93:return 1}return 0}function pO(i){return Px=wg=1,pI=Td(Ag=i),Zu=0,[]}function mO(i){return Ag="",i}function m1(i){return fI(Rx(Zu-1,Q1(i===91?i+2:i===40?i+1:i)))}function gO(i){for(;(_a=dp())&&_a<33;)zh();return Q_(i)>2||Q_(_a)>3?"":" "}function _O(i,l){for(;--l&&zh()&&!(_a<48||_a>102||_a>57&&_a<65||_a>70&&_a<97););return Rx(i,Tv()+(l<6&&dp()==32&&zh()==32))}function Q1(i){for(;zh();)switch(_a){case i:return Zu;case 34:case 39:i!==34&&i!==39&&Q1(_a);break;case 40:i===41&&Q1(i);break;case 92:zh();break}return Zu}function yO(i,l){for(;zh()&&i+_a!==57;)if(i+_a===84&&dp()===47)break;return"/*"+Rx(l,Zu-1)+"*"+OS(i===47?i:zh())}function vO(i){for(;!Q_(dp());)zh();return Rx(i,Zu)}function xO(i){return mO(Cv("",null,null,null,[""],i=pO(i),0,[0],i))}function Cv(i,l,f,_,b,z,O,r,H){for(var Z=0,K=0,te=O,le=0,Te=0,pe=0,ge=1,fe=1,me=1,_e=0,Ie="",Ne=b,nt=z,Le=_,Pe=Ie;fe;)switch(pe=_e,_e=zh()){case 40:if(pe!=108&&J_(Pe,te-1)==58){uO(Pe+=Ev(m1(_e),"&","&\f"),"&\f",dI(Z?r[Z-1]:0))!=-1&&(me=-1);break}case 34:case 39:case 91:Pe+=m1(_e);break;case 9:case 10:case 13:case 32:Pe+=gO(pe);break;case 92:Pe+=_O(Tv()-1,7);continue;case 47:switch(dp()){case 42:case 47:cv(bO(yO(zh(),Tv()),l,f,H),H),(Q_(pe||1)==5||Q_(dp()||1)==5)&&Td(Pe)&&bg(Pe,-1,void 0)!==" "&&(Pe+=" ");break;default:Pe+="/"}break;case 123*ge:r[Z++]=Td(Pe)*me;case 125*ge:case 59:case 0:switch(_e){case 0:case 125:fe=0;case 59+K:me==-1&&(Pe=Ev(Pe,/\f/g,"")),Te>0&&(Td(Pe)-te||ge===0&&pe===47)&&cv(Te>32?JC(Pe+";",_,f,te-1,H):JC(Ev(Pe," ","")+";",_,f,te-2,H),H);break;case 59:Pe+=";";default:if(cv(Le=KC(Pe,l,f,Z,K,b,r,Ie,Ne=[],nt=[],te,z),z),_e===123)if(K===0)Cv(Pe,l,Le,Le,Ne,z,te,r,nt);else switch(le===99&&J_(Pe,3)===110?100:le){case 100:case 108:case 109:case 115:Cv(i,Le,Le,_&&cv(KC(i,Le,Le,0,0,b,r,Ie,b,Ne=[],te,nt),nt),b,nt,te,r,_?Ne:nt);break;default:Cv(Pe,Le,Le,Le,[""],nt,0,r,nt)}}Z=K=Te=0,ge=me=1,Ie=Pe="",te=O;break;case 58:te=1+Td(Pe),Te=pe;default:if(ge<1){if(_e==123)--ge;else if(_e==125&&ge++==0&&fO()==125)continue}switch(Pe+=OS(_e),_e*ge){case 38:me=K>0?1:(Pe+="\f",-1);break;case 44:r[Z++]=(Td(Pe)-1)*me,me=1;break;case 64:dp()===45&&(Pe+=m1(zh())),le=dp(),K=te=Td(Ie=Pe+=vO(Tv())),_e++;break;case 45:pe===45&&Td(Pe)==2&&(ge=0)}}return z}function KC(i,l,f,_,b,z,O,r,H,Z,K,te){for(var le=b-1,Te=b===0?z:[""],pe=hO(Te),ge=0,fe=0,me=0;ge<_;++ge)for(var _e=0,Ie=bg(i,le+1,le=dI(fe=O[ge])),Ne=i;_e<pe;++_e)(Ne=fI(fe>0?Te[_e]+" "+Ie:Ev(Ie,/&\f/g,Te[_e])))&&(H[me++]=Ne);return DS(i,l,f,b===0?uI:r,H,Z,K,te)}function bO(i,l,f,_){return DS(i,l,f,cI,OS(dO()),bg(i,2,-2),0,_)}function JC(i,l,f,_,b){return DS(i,l,f,hI,bg(i,0,_),bg(i,_+1,-1),_,b)}function ew(i,l){for(var f="",_=0;_<i.length;_++)f+=l(i[_],_,i,l)||"";return f}function wO(i,l,f,_){switch(i.type){case cO:if(i.children.length)break;case aO:case hI:return i.return=i.return||i.value;case cI:return"";case lO:return i.return=i.value+"{"+ew(i.children,_)+"}";case uI:if(!Td(i.value=i.props.join(",")))return""}return Td(f=ew(i.children,_))?i.return=i.value+"{"+f+"}":""}var QC="data-ant-cssinjs-cache-path",mI="_FILE_STYLE__",nm,gI=!0;function SO(){if(!nm&&(nm={},wu())){var i=document.createElement("div");i.className=QC,i.style.position="fixed",i.style.visibility="hidden",i.style.top="-9999px",document.body.appendChild(i);var l=getComputedStyle(i).content||"";l=l.replace(/^"/,"").replace(/"$/,""),l.split(";").forEach(function(b){var z=b.split(":"),O=Gn(z,2),r=O[0],H=O[1];nm[r]=H});var f=document.querySelector("style[".concat(QC,"]"));if(f){var _;gI=!1,(_=f.parentNode)===null||_===void 0||_.removeChild(f)}document.body.removeChild(i)}}function EO(i){return SO(),!!nm[i]}function TO(i){var l=nm[i],f=null;if(l&&wu())if(gI)f=mI;else{var _=document.querySelector("style[".concat(kh,'="').concat(nm[i],'"]'));_?f=_.innerHTML:delete nm[i]}return[f,l]}var CO="_skip_check_",_I="_multi_value_";function Mv(i){var l=ew(xO(i),wO);return l.replace(/\{%%%\:[^;];}/g,";")}function MO(i){return li(i)==="object"&&i&&(CO in i||_I in i)}function eM(i,l,f){if(!l)return i;var _=".".concat(l),b=f==="low"?":where(".concat(_,")"):_,z=i.split(",").map(function(O){var r,H=O.trim().split(/\s+/),Z=H[0]||"",K=((r=Z.match(/^\w+/))===null||r===void 0?void 0:r[0])||"";return Z="".concat(K).concat(b).concat(Z.slice(K.length)),[Z].concat(Xr(H.slice(1))).join(" ")});return z.join(",")}var AO=function i(l){var f=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},_=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{root:!0,parentSelectors:[]},b=_.root,z=_.injectHash,O=_.parentSelectors,r=f.hashId,H=f.layer;f.path;var Z=f.hashPriority,K=f.transformers,te=K===void 0?[]:K;f.linters;var le="",Te={};function pe(me){var _e=me.getName(r);if(!Te[_e]){var Ie=i(me.style,f,{root:!1,parentSelectors:O}),Ne=Gn(Ie,1),nt=Ne[0];Te[_e]="@keyframes ".concat(me.getName(r)).concat(nt)}}function ge(me){var _e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[];return me.forEach(function(Ie){Array.isArray(Ie)?ge(Ie,_e):Ie&&_e.push(Ie)}),_e}var fe=ge(Array.isArray(l)?l:[l]);return fe.forEach(function(me){var _e=typeof me=="string"&&!b?{}:me;if(typeof _e=="string")le+="".concat(_e,`
`);else if(_e._keyframe)pe(_e);else{var Ie=te.reduce(function(Ne,nt){var Le;return(nt==null||(Le=nt.visit)===null||Le===void 0?void 0:Le.call(nt,Ne))||Ne},_e);Object.keys(Ie).forEach(function(Ne){var nt=Ie[Ne];if(li(nt)==="object"&&nt&&(Ne!=="animationName"||!nt._keyframe)&&!MO(nt)){var Le=!1,Pe=Ne.trim(),rt=!1;(b||z)&&r?Pe.startsWith("@")?Le=!0:Pe==="&"?Pe=eM("",r,Z):Pe=eM(Ne,r,Z):b&&!r&&(Pe==="&"||Pe==="")&&(Pe="",rt=!0);var at=i(nt,f,{root:rt,injectHash:Le,parentSelectors:[].concat(Xr(O),[Pe])}),Qe=Gn(at,2),lt=Qe[0],Ct=Qe[1];Te=nn(nn({},Te),Ct),le+="".concat(Pe).concat(lt)}else{let At=function(xt,gt){var ht=xt.replace(/[A-Z]/g,function(Ve){return"-".concat(Ve.toLowerCase())}),vt=gt;!sO[xt]&&typeof vt=="number"&&vt!==0&&(vt="".concat(vt,"px")),xt==="animationName"&&gt!==null&&gt!==void 0&&gt._keyframe&&(pe(gt),vt=gt.getName(r)),le+="".concat(ht,":").concat(vt,";")};var Rt,Nt=(Rt=nt==null?void 0:nt.value)!==null&&Rt!==void 0?Rt:nt;li(nt)==="object"&&nt!==null&&nt!==void 0&&nt[_I]&&Array.isArray(Nt)?Nt.forEach(function(xt){At(Ne,xt)}):At(Ne,Nt)}})}}),b?H&&(le&&(le="@layer ".concat(H.name," {").concat(le,"}")),H.dependencies&&(Te["@layer ".concat(H.name)]=H.dependencies.map(function(me){return"@layer ".concat(me,", ").concat(H.name,";")}).join(`
`))):le="{".concat(le,"}"),[le,Te]};function yI(i,l){return Y_("".concat(i.join("%")).concat(l))}function IO(){return null}var vI="style";function tw(i,l){var f=i.token,_=i.path,b=i.hashId,z=i.layer,O=i.nonce,r=i.clientOnly,H=i.order,Z=H===void 0?0:H,K=se.useContext(Ix),te=K.autoClear;K.mock;var le=K.defaultCache,Te=K.hashPriority,pe=K.container,ge=K.ssrInline,fe=K.transformers,me=K.linters,_e=K.cache,Ie=K.layer,Ne=f._tokenKey,nt=[Ne];Ie&&nt.push("layer"),nt.push.apply(nt,Xr(_));var Le=J1,Pe=LS(vI,nt,function(){var Ct=nt.join("|");if(EO(Ct)){var Rt=TO(Ct),Nt=Gn(Rt,2),At=Nt[0],xt=Nt[1];if(At)return[At,Ne,xt,{},r,Z]}var gt=l(),ht=AO(gt,{hashId:b,hashPriority:Te,layer:Ie?z:void 0,path:_.join("-"),transformers:fe,linters:me}),vt=Gn(ht,2),Ve=vt[0],je=vt[1],it=Mv(Ve),Mt=yI(nt,it);return[it,Ne,Mt,je,r,Z]},function(Ct,Rt){var Nt=Gn(Ct,3),At=Nt[2];(Rt||te)&&J1&&K_(At,{mark:kh})},function(Ct){var Rt=Gn(Ct,4),Nt=Rt[0];Rt[1];var At=Rt[2],xt=Rt[3];if(Le&&Nt!==mI){var gt={mark:kh,prepend:Ie?!1:"queue",attachTo:pe,priority:Z},ht=typeof O=="function"?O():O;ht&&(gt.csp={nonce:ht});var vt=[],Ve=[];Object.keys(xt).forEach(function(it){it.startsWith("@layer")?vt.push(it):Ve.push(it)}),vt.forEach(function(it){gf(Mv(xt[it]),"_layer-".concat(it),nn(nn({},gt),{},{prepend:!0}))});var je=gf(Nt,At,gt);je[hp]=_e.instanceId,je.setAttribute(xg,Ne),Ve.forEach(function(it){gf(Mv(xt[it]),"_effect-".concat(it),gt)})}}),rt=Gn(Pe,3),at=rt[0],Qe=rt[1],lt=rt[2];return function(Ct){var Rt;if(!ge||Le||!le)Rt=se.createElement(IO,null);else{var Nt;Rt=se.createElement("style",$s({},(Nt={},jt(Nt,xg,Qe),jt(Nt,kh,lt),Nt),{dangerouslySetInnerHTML:{__html:at}}))}return se.createElement(se.Fragment,null,Rt,Ct)}}var PO=function(l,f,_){var b=Gn(l,6),z=b[0],O=b[1],r=b[2],H=b[3],Z=b[4],K=b[5],te=_||{},le=te.plain;if(Z)return null;var Te=z,pe={"data-rc-order":"prependQueue","data-rc-priority":"".concat(K)};return Te=ax(z,O,r,pe,le),H&&Object.keys(H).forEach(function(ge){if(!f[ge]){f[ge]=!0;var fe=Mv(H[ge]),me=ax(fe,O,"_effect-".concat(ge),pe,le);ge.startsWith("@layer")?Te=me+Te:Te+=me}}),[K,r,Te]},xI="cssVar",RO=function(l,f){var _=l.key,b=l.prefix,z=l.unitless,O=l.ignore,r=l.token,H=l.scope,Z=H===void 0?"":H,K=se.useContext(Ix),te=K.cache.instanceId,le=K.container,Te=r._tokenKey,pe=[].concat(Xr(l.path),[_,Z,Te]),ge=LS(xI,pe,function(){var fe=f(),me=aI(fe,_,{prefix:b,unitless:z,ignore:O,scope:Z}),_e=Gn(me,2),Ie=_e[0],Ne=_e[1],nt=yI(pe,Ne);return[Ie,Ne,nt,_]},function(fe){var me=Gn(fe,3),_e=me[2];J1&&K_(_e,{mark:kh})},function(fe){var me=Gn(fe,3),_e=me[1],Ie=me[2];if(_e){var Ne=gf(_e,Ie,{mark:kh,prepend:"queue",attachTo:le,priority:-999});Ne[hp]=te,Ne.setAttribute(xg,_)}});return ge},kO=function(l,f,_){var b=Gn(l,4),z=b[1],O=b[2],r=b[3],H=_||{},Z=H.plain;if(!z)return null;var K=-999,te={"data-rc-order":"prependQueue","data-rc-priority":"".concat(K)},le=ax(z,r,O,te,Z);return[K,O,le]},u_;u_={},jt(u_,vI,PO),jt(u_,lI,oO),jt(u_,xI,kO);var Yu=function(){function i(l,f){Qa(this,i),jt(this,"name",void 0),jt(this,"style",void 0),jt(this,"_keyframe",!0),this.name=l,this.style=f}return el(i,[{key:"getName",value:function(){var f=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"";return f?"".concat(f,"-").concat(this.name):this.name}}]),i}();function Hm(i){return i.notSplit=!0,i}Hm(["borderTop","borderBottom"]),Hm(["borderTop"]),Hm(["borderBottom"]),Hm(["borderLeft","borderRight"]),Hm(["borderLeft"]),Hm(["borderRight"]);var FS=se.createContext({});function zO(i){return tI(i)||KA(i)||PS(i)||nI()}function Cd(i,l){for(var f=i,_=0;_<l.length;_+=1){if(f==null)return;f=f[l[_]]}return f}function bI(i,l,f,_){if(!l.length)return f;var b=zO(l),z=b[0],O=b.slice(1),r;return!i&&typeof z=="number"?r=[]:Array.isArray(i)?r=Xr(i):r=nn({},i),_&&f===void 0&&O.length===1?delete r[z][O[0]]:r[z]=bI(r[z],O,f,_),r}function Ih(i,l,f){var _=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1;return l.length&&_&&f===void 0&&!Cd(i,l.slice(0,-1))?i:bI(i,l,f,_)}function LO(i){return li(i)==="object"&&i!==null&&Object.getPrototypeOf(i)===Object.prototype}function tM(i){return Array.isArray(i)?[]:{}}var OO=typeof Reflect>"u"?Object.keys:Reflect.ownKeys;function pg(){for(var i=arguments.length,l=new Array(i),f=0;f<i;f++)l[f]=arguments[f];var _=tM(l[0]);return l.forEach(function(b){function z(O,r){var H=new Set(r),Z=Cd(b,O),K=Array.isArray(Z);if(K||LO(Z)){if(!H.has(Z)){H.add(Z);var te=Cd(_,O);K?_=Ih(_,O,[]):(!te||li(te)!=="object")&&(_=Ih(_,O,tM(Z))),OO(Z).forEach(function(le){z([].concat(Xr(O),[le]),H)})}}else _=Ih(_,O,Z)}z([])}),_}function DO(){}const FO=se.createContext({}),wI=()=>{const i=()=>{};return i.deprecated=DO,i},BO=se.createContext(void 0);var NO={items_per_page:"/ page",jump_to:"Go to",jump_to_confirm:"confirm",page:"Page",prev_page:"Previous Page",next_page:"Next Page",prev_5:"Previous 5 Pages",next_5:"Next 5 Pages",prev_3:"Previous 3 Pages",next_3:"Next 3 Pages",page_size:"Page Size"},jO={yearFormat:"YYYY",dayFormat:"D",cellMeridiemFormat:"A",monthBeforeYear:!0},$O=nn(nn({},jO),{},{locale:"en_US",today:"Today",now:"Now",backToToday:"Back to today",ok:"OK",clear:"Clear",month:"Month",year:"Year",timeSelect:"select time",dateSelect:"select date",weekSelect:"Choose a week",monthSelect:"Choose a month",yearSelect:"Choose a year",decadeSelect:"Choose a decade",dateFormat:"M/D/YYYY",dateTimeFormat:"M/D/YYYY HH:mm:ss",previousMonth:"Previous month (PageUp)",nextMonth:"Next month (PageDown)",previousYear:"Last year (Control + left)",nextYear:"Next year (Control + right)",previousDecade:"Last decade",nextDecade:"Next decade",previousCentury:"Last century",nextCentury:"Next century"});const SI={placeholder:"Select time",rangePlaceholder:["Start time","End time"]},nM={lang:Object.assign({placeholder:"Select date",yearPlaceholder:"Select year",quarterPlaceholder:"Select quarter",monthPlaceholder:"Select month",weekPlaceholder:"Select week",rangePlaceholder:["Start date","End date"],rangeYearPlaceholder:["Start year","End year"],rangeQuarterPlaceholder:["Start quarter","End quarter"],rangeMonthPlaceholder:["Start month","End month"],rangeWeekPlaceholder:["Start week","End week"]},$O),timePickerLocale:Object.assign({},SI)},pu="${label} is not a valid ${type}",kx={locale:"en",Pagination:NO,DatePicker:nM,TimePicker:SI,Calendar:nM,global:{placeholder:"Please select"},Table:{filterTitle:"Filter menu",filterConfirm:"OK",filterReset:"Reset",filterEmptyText:"No filters",filterCheckall:"Select all items",filterSearchPlaceholder:"Search in filters",emptyText:"No data",selectAll:"Select current page",selectInvert:"Invert current page",selectNone:"Clear all data",selectionAll:"Select all data",sortTitle:"Sort",expand:"Expand row",collapse:"Collapse row",triggerDesc:"Click to sort descending",triggerAsc:"Click to sort ascending",cancelSort:"Click to cancel sorting"},Tour:{Next:"Next",Previous:"Previous",Finish:"Finish"},Modal:{okText:"OK",cancelText:"Cancel",justOkText:"OK"},Popconfirm:{okText:"OK",cancelText:"Cancel"},Transfer:{titles:["",""],searchPlaceholder:"Search here",itemUnit:"item",itemsUnit:"items",remove:"Remove",selectCurrent:"Select current page",removeCurrent:"Remove current page",selectAll:"Select all data",deselectAll:"Deselect all data",removeAll:"Remove all data",selectInvert:"Invert current page"},Upload:{uploading:"Uploading...",removeFile:"Remove file",uploadError:"Upload error",previewFile:"Preview file",downloadFile:"Download file"},Empty:{description:"No data"},Icon:{icon:"icon"},Text:{edit:"Edit",copy:"Copy",copied:"Copied",expand:"Expand",collapse:"Collapse"},Form:{optional:"(optional)",defaultValidateMessages:{default:"Field validation error for ${label}",required:"Please enter ${label}",enum:"${label} must be one of [${enum}]",whitespace:"${label} cannot be a blank character",date:{format:"${label} date format is invalid",parse:"${label} cannot be converted to a date",invalid:"${label} is an invalid date"},types:{string:pu,method:pu,array:pu,object:pu,number:pu,date:pu,boolean:pu,integer:pu,float:pu,regexp:pu,email:pu,url:pu,hex:pu},string:{len:"${label} must be ${len} characters",min:"${label} must be at least ${min} characters",max:"${label} must be up to ${max} characters",range:"${label} must be between ${min}-${max} characters"},number:{len:"${label} must be equal to ${len}",min:"${label} must be minimum ${min}",max:"${label} must be maximum ${max}",range:"${label} must be between ${min}-${max}"},array:{len:"Must be ${len} ${label}",min:"At least ${min} ${label}",max:"At most ${max} ${label}",range:"The amount of ${label} must be between ${min}-${max}"},pattern:{mismatch:"${label} does not match the pattern ${pattern}"}}},Image:{preview:"Preview"},QRCode:{expired:"QR code expired",refresh:"Refresh",scanned:"Scanned"},ColorPicker:{presetEmpty:"Empty",transparent:"Transparent",singleColor:"Single",gradientColor:"Gradient"}};Object.assign({},kx.Modal);let Av=[];const rM=()=>Av.reduce((i,l)=>Object.assign(Object.assign({},i),l),kx.Modal);function VO(i){if(i){const l=Object.assign({},i);return Av.push(l),rM(),()=>{Av=Av.filter(f=>f!==l),rM()}}Object.assign({},kx.Modal)}const EI=se.createContext(void 0),UO="internalMark",HO=i=>{const{locale:l={},children:f,_ANT_MARK__:_}=i;se.useEffect(()=>VO(l==null?void 0:l.Modal),[l]);const b=se.useMemo(()=>Object.assign(Object.assign({},l),{exist:!0}),[l]);return se.createElement(EI.Provider,{value:b},f)},Xa=Math.round;function g1(i,l){const f=i.replace(/^[^(]*\((.*)/,"$1").replace(/\).*/,"").match(/\d*\.?\d+%?/g)||[],_=f.map(b=>parseFloat(b));for(let b=0;b<3;b+=1)_[b]=l(_[b]||0,f[b]||"",b);return f[3]?_[3]=f[3].includes("%")?_[3]/100:_[3]:_[3]=1,_}const iM=(i,l,f)=>f===0?i:i/100;function h_(i,l){const f=l||255;return i>f?f:i<0?0:i}class ks{constructor(l){jt(this,"isValid",!0),jt(this,"r",0),jt(this,"g",0),jt(this,"b",0),jt(this,"a",1),jt(this,"_h",void 0),jt(this,"_s",void 0),jt(this,"_l",void 0),jt(this,"_v",void 0),jt(this,"_max",void 0),jt(this,"_min",void 0),jt(this,"_brightness",void 0);function f(b){return b[0]in l&&b[1]in l&&b[2]in l}if(l)if(typeof l=="string"){let z=function(O){return b.startsWith(O)};var _=z;const b=l.trim();/^#?[A-F\d]{3,8}$/i.test(b)?this.fromHexString(b):z("rgb")?this.fromRgbString(b):z("hsl")?this.fromHslString(b):(z("hsv")||z("hsb"))&&this.fromHsvString(b)}else if(l instanceof ks)this.r=l.r,this.g=l.g,this.b=l.b,this.a=l.a,this._h=l._h,this._s=l._s,this._l=l._l,this._v=l._v;else if(f("rgb"))this.r=h_(l.r),this.g=h_(l.g),this.b=h_(l.b),this.a=typeof l.a=="number"?h_(l.a,1):1;else if(f("hsl"))this.fromHsl(l);else if(f("hsv"))this.fromHsv(l);else throw new Error("@ant-design/fast-color: unsupported input "+JSON.stringify(l))}setR(l){return this._sc("r",l)}setG(l){return this._sc("g",l)}setB(l){return this._sc("b",l)}setA(l){return this._sc("a",l,1)}setHue(l){const f=this.toHsv();return f.h=l,this._c(f)}getLuminance(){function l(z){const O=z/255;return O<=.03928?O/12.92:Math.pow((O+.055)/1.055,2.4)}const f=l(this.r),_=l(this.g),b=l(this.b);return .2126*f+.7152*_+.0722*b}getHue(){if(typeof this._h>"u"){const l=this.getMax()-this.getMin();l===0?this._h=0:this._h=Xa(60*(this.r===this.getMax()?(this.g-this.b)/l+(this.g<this.b?6:0):this.g===this.getMax()?(this.b-this.r)/l+2:(this.r-this.g)/l+4))}return this._h}getSaturation(){if(typeof this._s>"u"){const l=this.getMax()-this.getMin();l===0?this._s=0:this._s=l/this.getMax()}return this._s}getLightness(){return typeof this._l>"u"&&(this._l=(this.getMax()+this.getMin())/510),this._l}getValue(){return typeof this._v>"u"&&(this._v=this.getMax()/255),this._v}getBrightness(){return typeof this._brightness>"u"&&(this._brightness=(this.r*299+this.g*587+this.b*114)/1e3),this._brightness}darken(l=10){const f=this.getHue(),_=this.getSaturation();let b=this.getLightness()-l/100;return b<0&&(b=0),this._c({h:f,s:_,l:b,a:this.a})}lighten(l=10){const f=this.getHue(),_=this.getSaturation();let b=this.getLightness()+l/100;return b>1&&(b=1),this._c({h:f,s:_,l:b,a:this.a})}mix(l,f=50){const _=this._c(l),b=f/100,z=r=>(_[r]-this[r])*b+this[r],O={r:Xa(z("r")),g:Xa(z("g")),b:Xa(z("b")),a:Xa(z("a")*100)/100};return this._c(O)}tint(l=10){return this.mix({r:255,g:255,b:255,a:1},l)}shade(l=10){return this.mix({r:0,g:0,b:0,a:1},l)}onBackground(l){const f=this._c(l),_=this.a+f.a*(1-this.a),b=z=>Xa((this[z]*this.a+f[z]*f.a*(1-this.a))/_);return this._c({r:b("r"),g:b("g"),b:b("b"),a:_})}isDark(){return this.getBrightness()<128}isLight(){return this.getBrightness()>=128}equals(l){return this.r===l.r&&this.g===l.g&&this.b===l.b&&this.a===l.a}clone(){return this._c(this)}toHexString(){let l="#";const f=(this.r||0).toString(16);l+=f.length===2?f:"0"+f;const _=(this.g||0).toString(16);l+=_.length===2?_:"0"+_;const b=(this.b||0).toString(16);if(l+=b.length===2?b:"0"+b,typeof this.a=="number"&&this.a>=0&&this.a<1){const z=Xa(this.a*255).toString(16);l+=z.length===2?z:"0"+z}return l}toHsl(){return{h:this.getHue(),s:this.getSaturation(),l:this.getLightness(),a:this.a}}toHslString(){const l=this.getHue(),f=Xa(this.getSaturation()*100),_=Xa(this.getLightness()*100);return this.a!==1?`hsla(${l},${f}%,${_}%,${this.a})`:`hsl(${l},${f}%,${_}%)`}toHsv(){return{h:this.getHue(),s:this.getSaturation(),v:this.getValue(),a:this.a}}toRgb(){return{r:this.r,g:this.g,b:this.b,a:this.a}}toRgbString(){return this.a!==1?`rgba(${this.r},${this.g},${this.b},${this.a})`:`rgb(${this.r},${this.g},${this.b})`}toString(){return this.toRgbString()}_sc(l,f,_){const b=this.clone();return b[l]=h_(f,_),b}_c(l){return new this.constructor(l)}getMax(){return typeof this._max>"u"&&(this._max=Math.max(this.r,this.g,this.b)),this._max}getMin(){return typeof this._min>"u"&&(this._min=Math.min(this.r,this.g,this.b)),this._min}fromHexString(l){const f=l.replace("#","");function _(b,z){return parseInt(f[b]+f[z||b],16)}f.length<6?(this.r=_(0),this.g=_(1),this.b=_(2),this.a=f[3]?_(3)/255:1):(this.r=_(0,1),this.g=_(2,3),this.b=_(4,5),this.a=f[6]?_(6,7)/255:1)}fromHsl({h:l,s:f,l:_,a:b}){if(this._h=l%360,this._s=f,this._l=_,this.a=typeof b=="number"?b:1,f<=0){const le=Xa(_*255);this.r=le,this.g=le,this.b=le}let z=0,O=0,r=0;const H=l/60,Z=(1-Math.abs(2*_-1))*f,K=Z*(1-Math.abs(H%2-1));H>=0&&H<1?(z=Z,O=K):H>=1&&H<2?(z=K,O=Z):H>=2&&H<3?(O=Z,r=K):H>=3&&H<4?(O=K,r=Z):H>=4&&H<5?(z=K,r=Z):H>=5&&H<6&&(z=Z,r=K);const te=_-Z/2;this.r=Xa((z+te)*255),this.g=Xa((O+te)*255),this.b=Xa((r+te)*255)}fromHsv({h:l,s:f,v:_,a:b}){this._h=l%360,this._s=f,this._v=_,this.a=typeof b=="number"?b:1;const z=Xa(_*255);if(this.r=z,this.g=z,this.b=z,f<=0)return;const O=l/60,r=Math.floor(O),H=O-r,Z=Xa(_*(1-f)*255),K=Xa(_*(1-f*H)*255),te=Xa(_*(1-f*(1-H))*255);switch(r){case 0:this.g=te,this.b=Z;break;case 1:this.r=K,this.b=Z;break;case 2:this.r=Z,this.b=te;break;case 3:this.r=Z,this.g=K;break;case 4:this.r=te,this.g=Z;break;case 5:default:this.g=Z,this.b=K;break}}fromHsvString(l){const f=g1(l,iM);this.fromHsv({h:f[0],s:f[1],v:f[2],a:f[3]})}fromHslString(l){const f=g1(l,iM);this.fromHsl({h:f[0],s:f[1],l:f[2],a:f[3]})}fromRgbString(l){const f=g1(l,(_,b)=>b.includes("%")?Xa(_/100*255):_);this.r=f[0],this.g=f[1],this.b=f[2],this.a=f[3]}}var uv=2,oM=.16,WO=.05,GO=.05,qO=.15,TI=5,CI=4,ZO=[{index:7,amount:15},{index:6,amount:25},{index:5,amount:30},{index:5,amount:45},{index:5,amount:65},{index:5,amount:85},{index:4,amount:90},{index:3,amount:95},{index:2,amount:97},{index:1,amount:98}];function sM(i,l,f){var _;return Math.round(i.h)>=60&&Math.round(i.h)<=240?_=f?Math.round(i.h)-uv*l:Math.round(i.h)+uv*l:_=f?Math.round(i.h)+uv*l:Math.round(i.h)-uv*l,_<0?_+=360:_>=360&&(_-=360),_}function aM(i,l,f){if(i.h===0&&i.s===0)return i.s;var _;return f?_=i.s-oM*l:l===CI?_=i.s+oM:_=i.s+WO*l,_>1&&(_=1),f&&l===TI&&_>.1&&(_=.1),_<.06&&(_=.06),Math.round(_*100)/100}function lM(i,l,f){var _;return f?_=i.v+GO*l:_=i.v-qO*l,_=Math.max(0,Math.min(1,_)),Math.round(_*100)/100}function ey(i){for(var l=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},f=[],_=new ks(i),b=_.toHsv(),z=TI;z>0;z-=1){var O=new ks({h:sM(b,z,!0),s:aM(b,z,!0),v:lM(b,z,!0)});f.push(O)}f.push(_);for(var r=1;r<=CI;r+=1){var H=new ks({h:sM(b,r),s:aM(b,r),v:lM(b,r)});f.push(H)}return l.theme==="dark"?ZO.map(function(Z){var K=Z.index,te=Z.amount;return new ks(l.backgroundColor||"#141414").mix(f[K],te).toHexString()}):f.map(function(Z){return Z.toHexString()})}var _1={red:"#F5222D",volcano:"#FA541C",orange:"#FA8C16",gold:"#FAAD14",yellow:"#FADB14",lime:"#A0D911",green:"#52C41A",cyan:"#13C2C2",blue:"#1677FF",geekblue:"#2F54EB",purple:"#722ED1",magenta:"#EB2F96",grey:"#666666"},nw=["#fff1f0","#ffccc7","#ffa39e","#ff7875","#ff4d4f","#f5222d","#cf1322","#a8071a","#820014","#5c0011"];nw.primary=nw[5];var rw=["#fff2e8","#ffd8bf","#ffbb96","#ff9c6e","#ff7a45","#fa541c","#d4380d","#ad2102","#871400","#610b00"];rw.primary=rw[5];var iw=["#fff7e6","#ffe7ba","#ffd591","#ffc069","#ffa940","#fa8c16","#d46b08","#ad4e00","#873800","#612500"];iw.primary=iw[5];var ow=["#fffbe6","#fff1b8","#ffe58f","#ffd666","#ffc53d","#faad14","#d48806","#ad6800","#874d00","#613400"];ow.primary=ow[5];var sw=["#feffe6","#ffffb8","#fffb8f","#fff566","#ffec3d","#fadb14","#d4b106","#ad8b00","#876800","#614700"];sw.primary=sw[5];var aw=["#fcffe6","#f4ffb8","#eaff8f","#d3f261","#bae637","#a0d911","#7cb305","#5b8c00","#3f6600","#254000"];aw.primary=aw[5];var lw=["#f6ffed","#d9f7be","#b7eb8f","#95de64","#73d13d","#52c41a","#389e0d","#237804","#135200","#092b00"];lw.primary=lw[5];var cw=["#e6fffb","#b5f5ec","#87e8de","#5cdbd3","#36cfc9","#13c2c2","#08979c","#006d75","#00474f","#002329"];cw.primary=cw[5];var lx=["#e6f4ff","#bae0ff","#91caff","#69b1ff","#4096ff","#1677ff","#0958d9","#003eb3","#002c8c","#001d66"];lx.primary=lx[5];var uw=["#f0f5ff","#d6e4ff","#adc6ff","#85a5ff","#597ef7","#2f54eb","#1d39c4","#10239e","#061178","#030852"];uw.primary=uw[5];var hw=["#f9f0ff","#efdbff","#d3adf7","#b37feb","#9254de","#722ed1","#531dab","#391085","#22075e","#120338"];hw.primary=hw[5];var dw=["#fff0f6","#ffd6e7","#ffadd2","#ff85c0","#f759ab","#eb2f96","#c41d7f","#9e1068","#780650","#520339"];dw.primary=dw[5];var fw=["#a6a6a6","#999999","#8c8c8c","#808080","#737373","#666666","#404040","#1a1a1a","#000000","#000000"];fw.primary=fw[5];var y1={red:nw,volcano:rw,orange:iw,gold:ow,yellow:sw,lime:aw,green:lw,cyan:cw,blue:lx,geekblue:uw,purple:hw,magenta:dw,grey:fw};const MI={blue:"#1677FF",purple:"#722ED1",cyan:"#13C2C2",green:"#52C41A",magenta:"#EB2F96",pink:"#EB2F96",red:"#F5222D",orange:"#FA8C16",yellow:"#FADB14",volcano:"#FA541C",geekblue:"#2F54EB",gold:"#FAAD14",lime:"#A0D911"},ty=Object.assign(Object.assign({},MI),{colorPrimary:"#1677ff",colorSuccess:"#52c41a",colorWarning:"#faad14",colorError:"#ff4d4f",colorInfo:"#1677ff",colorLink:"",colorTextBase:"",colorBgBase:"",fontFamily:`-apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial,
'Noto Sans', sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol',
'Noto Color Emoji'`,fontFamilyCode:"'SFMono-Regular', Consolas, 'Liberation Mono', Menlo, Courier, monospace",fontSize:14,lineWidth:1,lineType:"solid",motionUnit:.1,motionBase:0,motionEaseOutCirc:"cubic-bezier(0.08, 0.82, 0.17, 1)",motionEaseInOutCirc:"cubic-bezier(0.78, 0.14, 0.15, 0.86)",motionEaseOut:"cubic-bezier(0.215, 0.61, 0.355, 1)",motionEaseInOut:"cubic-bezier(0.645, 0.045, 0.355, 1)",motionEaseOutBack:"cubic-bezier(0.12, 0.4, 0.29, 1.46)",motionEaseInBack:"cubic-bezier(0.71, -0.46, 0.88, 0.6)",motionEaseInQuint:"cubic-bezier(0.755, 0.05, 0.855, 0.06)",motionEaseOutQuint:"cubic-bezier(0.23, 1, 0.32, 1)",borderRadius:6,sizeUnit:4,sizeStep:4,sizePopupArrow:16,controlHeight:32,zIndexBase:0,zIndexPopupBase:1e3,opacityImage:1,wireframe:!1,motion:!0});function XO(i,l){let{generateColorPalettes:f,generateNeutralColorPalettes:_}=l;const{colorSuccess:b,colorWarning:z,colorError:O,colorInfo:r,colorPrimary:H,colorBgBase:Z,colorTextBase:K}=i,te=f(H),le=f(b),Te=f(z),pe=f(O),ge=f(r),fe=_(Z,K),me=i.colorLink||i.colorInfo,_e=f(me),Ie=new ks(pe[1]).mix(new ks(pe[3]),50).toHexString();return Object.assign(Object.assign({},fe),{colorPrimaryBg:te[1],colorPrimaryBgHover:te[2],colorPrimaryBorder:te[3],colorPrimaryBorderHover:te[4],colorPrimaryHover:te[5],colorPrimary:te[6],colorPrimaryActive:te[7],colorPrimaryTextHover:te[8],colorPrimaryText:te[9],colorPrimaryTextActive:te[10],colorSuccessBg:le[1],colorSuccessBgHover:le[2],colorSuccessBorder:le[3],colorSuccessBorderHover:le[4],colorSuccessHover:le[4],colorSuccess:le[6],colorSuccessActive:le[7],colorSuccessTextHover:le[8],colorSuccessText:le[9],colorSuccessTextActive:le[10],colorErrorBg:pe[1],colorErrorBgHover:pe[2],colorErrorBgFilledHover:Ie,colorErrorBgActive:pe[3],colorErrorBorder:pe[3],colorErrorBorderHover:pe[4],colorErrorHover:pe[5],colorError:pe[6],colorErrorActive:pe[7],colorErrorTextHover:pe[8],colorErrorText:pe[9],colorErrorTextActive:pe[10],colorWarningBg:Te[1],colorWarningBgHover:Te[2],colorWarningBorder:Te[3],colorWarningBorderHover:Te[4],colorWarningHover:Te[4],colorWarning:Te[6],colorWarningActive:Te[7],colorWarningTextHover:Te[8],colorWarningText:Te[9],colorWarningTextActive:Te[10],colorInfoBg:ge[1],colorInfoBgHover:ge[2],colorInfoBorder:ge[3],colorInfoBorderHover:ge[4],colorInfoHover:ge[4],colorInfo:ge[6],colorInfoActive:ge[7],colorInfoTextHover:ge[8],colorInfoText:ge[9],colorInfoTextActive:ge[10],colorLinkHover:_e[4],colorLink:_e[6],colorLinkActive:_e[7],colorBgMask:new ks("#000").setA(.45).toRgbString(),colorWhite:"#fff"})}const YO=i=>{let l=i,f=i,_=i,b=i;return i<6&&i>=5?l=i+1:i<16&&i>=6?l=i+2:i>=16&&(l=16),i<7&&i>=5?f=4:i<8&&i>=7?f=5:i<14&&i>=8?f=6:i<16&&i>=14?f=7:i>=16&&(f=8),i<6&&i>=2?_=1:i>=6&&(_=2),i>4&&i<8?b=4:i>=8&&(b=6),{borderRadius:i,borderRadiusXS:_,borderRadiusSM:f,borderRadiusLG:l,borderRadiusOuter:b}};function KO(i){const{motionUnit:l,motionBase:f,borderRadius:_,lineWidth:b}=i;return Object.assign({motionDurationFast:`${(f+l).toFixed(1)}s`,motionDurationMid:`${(f+l*2).toFixed(1)}s`,motionDurationSlow:`${(f+l*3).toFixed(1)}s`,lineWidthBold:b+1},YO(_))}const JO=i=>{const{controlHeight:l}=i;return{controlHeightSM:l*.75,controlHeightXS:l*.5,controlHeightLG:l*1.25}};function Iv(i){return(i+8)/i}function QO(i){const l=new Array(10).fill(null).map((f,_)=>{const b=_-1,z=i*Math.pow(Math.E,b/5),O=_>1?Math.floor(z):Math.ceil(z);return Math.floor(O/2)*2});return l[1]=i,l.map(f=>({size:f,lineHeight:Iv(f)}))}const eD=i=>{const l=QO(i),f=l.map(K=>K.size),_=l.map(K=>K.lineHeight),b=f[1],z=f[0],O=f[2],r=_[1],H=_[0],Z=_[2];return{fontSizeSM:z,fontSize:b,fontSizeLG:O,fontSizeXL:f[3],fontSizeHeading1:f[6],fontSizeHeading2:f[5],fontSizeHeading3:f[4],fontSizeHeading4:f[3],fontSizeHeading5:f[2],lineHeight:r,lineHeightLG:Z,lineHeightSM:H,fontHeight:Math.round(r*b),fontHeightLG:Math.round(Z*O),fontHeightSM:Math.round(H*z),lineHeightHeading1:_[6],lineHeightHeading2:_[5],lineHeightHeading3:_[4],lineHeightHeading4:_[3],lineHeightHeading5:_[2]}};function tD(i){const{sizeUnit:l,sizeStep:f}=i;return{sizeXXL:l*(f+8),sizeXL:l*(f+4),sizeLG:l*(f+2),sizeMD:l*(f+1),sizeMS:l*f,size:l*f,sizeSM:l*(f-1),sizeXS:l*(f-2),sizeXXS:l*(f-3)}}const Vu=(i,l)=>new ks(i).setA(l).toRgbString(),d_=(i,l)=>new ks(i).darken(l).toHexString(),nD=i=>{const l=ey(i);return{1:l[0],2:l[1],3:l[2],4:l[3],5:l[4],6:l[5],7:l[6],8:l[4],9:l[5],10:l[6]}},rD=(i,l)=>{const f=i||"#fff",_=l||"#000";return{colorBgBase:f,colorTextBase:_,colorText:Vu(_,.88),colorTextSecondary:Vu(_,.65),colorTextTertiary:Vu(_,.45),colorTextQuaternary:Vu(_,.25),colorFill:Vu(_,.15),colorFillSecondary:Vu(_,.06),colorFillTertiary:Vu(_,.04),colorFillQuaternary:Vu(_,.02),colorBgSolid:Vu(_,1),colorBgSolidHover:Vu(_,.75),colorBgSolidActive:Vu(_,.95),colorBgLayout:d_(f,4),colorBgContainer:d_(f,0),colorBgElevated:d_(f,0),colorBgSpotlight:Vu(_,.85),colorBgBlur:"transparent",colorBorder:d_(f,15),colorBorderSecondary:d_(f,6)}};function iD(i){_1.pink=_1.magenta,y1.pink=y1.magenta;const l=Object.keys(MI).map(f=>{const _=i[f]===_1[f]?y1[f]:ey(i[f]);return new Array(10).fill(1).reduce((b,z,O)=>(b[`${f}-${O+1}`]=_[O],b[`${f}${O+1}`]=_[O],b),{})}).reduce((f,_)=>(f=Object.assign(Object.assign({},f),_),f),{});return Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},i),l),XO(i,{generateColorPalettes:nD,generateNeutralColorPalettes:rD})),eD(i.fontSize)),tD(i)),JO(i)),KO(i))}const AI=K1(iD),pw={token:ty,override:{override:ty},hashed:!0},II=Nn.createContext(pw),cx="ant",BS="anticon",oD=["outlined","borderless","filled"],sD=(i,l)=>l||(i?`${cx}-${i}`:cx),Xo=se.createContext({getPrefixCls:sD,iconPrefixCls:BS}),aD=`-ant-${Date.now()}-${Math.random()}`;function lD(i,l){const f={},_=(O,r)=>{let H=O.clone();return H=(r==null?void 0:r(H))||H,H.toRgbString()},b=(O,r)=>{const H=new ks(O),Z=ey(H.toRgbString());f[`${r}-color`]=_(H),f[`${r}-color-disabled`]=Z[1],f[`${r}-color-hover`]=Z[4],f[`${r}-color-active`]=Z[6],f[`${r}-color-outline`]=H.clone().setA(.2).toRgbString(),f[`${r}-color-deprecated-bg`]=Z[0],f[`${r}-color-deprecated-border`]=Z[2]};if(l.primaryColor){b(l.primaryColor,"primary");const O=new ks(l.primaryColor),r=ey(O.toRgbString());r.forEach((Z,K)=>{f[`primary-${K+1}`]=Z}),f["primary-color-deprecated-l-35"]=_(O,Z=>Z.lighten(35)),f["primary-color-deprecated-l-20"]=_(O,Z=>Z.lighten(20)),f["primary-color-deprecated-t-20"]=_(O,Z=>Z.tint(20)),f["primary-color-deprecated-t-50"]=_(O,Z=>Z.tint(50)),f["primary-color-deprecated-f-12"]=_(O,Z=>Z.setA(Z.a*.12));const H=new ks(r[0]);f["primary-color-active-deprecated-f-30"]=_(H,Z=>Z.setA(Z.a*.3)),f["primary-color-active-deprecated-d-02"]=_(H,Z=>Z.darken(2))}return l.successColor&&b(l.successColor,"success"),l.warningColor&&b(l.warningColor,"warning"),l.errorColor&&b(l.errorColor,"error"),l.infoColor&&b(l.infoColor,"info"),`
  :root {
    ${Object.keys(f).map(O=>`--${i}-${O}: ${f[O]};`).join(`
`)}
  }
  `.trim()}function cD(i,l){const f=lD(i,l);wu()&&gf(f,`${aD}-dynamic-theme`)}const vf=se.createContext(!1),uD=i=>{let{children:l,disabled:f}=i;const _=se.useContext(vf);return se.createElement(vf.Provider,{value:f??_},l)},Sg=se.createContext(void 0),hD=i=>{let{children:l,size:f}=i;const _=se.useContext(Sg);return se.createElement(Sg.Provider,{value:f||_},l)};function dD(){const i=se.useContext(vf),l=se.useContext(Sg);return{componentDisabled:i,componentSize:l}}var PI=el(function i(){Qa(this,i)}),RI="CALC_UNIT",fD=new RegExp(RI,"g");function v1(i){return typeof i=="number"?"".concat(i).concat(RI):i}var pD=function(i){yp(f,i);var l=vp(f);function f(_,b){var z;Qa(this,f),z=l.call(this),jt(Di(z),"result",""),jt(Di(z),"unitlessCssVar",void 0),jt(Di(z),"lowPriority",void 0);var O=li(_);return z.unitlessCssVar=b,_ instanceof f?z.result="(".concat(_.result,")"):O==="number"?z.result=v1(_):O==="string"&&(z.result=_),z}return el(f,[{key:"add",value:function(b){return b instanceof f?this.result="".concat(this.result," + ").concat(b.getResult()):(typeof b=="number"||typeof b=="string")&&(this.result="".concat(this.result," + ").concat(v1(b))),this.lowPriority=!0,this}},{key:"sub",value:function(b){return b instanceof f?this.result="".concat(this.result," - ").concat(b.getResult()):(typeof b=="number"||typeof b=="string")&&(this.result="".concat(this.result," - ").concat(v1(b))),this.lowPriority=!0,this}},{key:"mul",value:function(b){return this.lowPriority&&(this.result="(".concat(this.result,")")),b instanceof f?this.result="".concat(this.result," * ").concat(b.getResult(!0)):(typeof b=="number"||typeof b=="string")&&(this.result="".concat(this.result," * ").concat(b)),this.lowPriority=!1,this}},{key:"div",value:function(b){return this.lowPriority&&(this.result="(".concat(this.result,")")),b instanceof f?this.result="".concat(this.result," / ").concat(b.getResult(!0)):(typeof b=="number"||typeof b=="string")&&(this.result="".concat(this.result," / ").concat(b)),this.lowPriority=!1,this}},{key:"getResult",value:function(b){return this.lowPriority||b?"(".concat(this.result,")"):this.result}},{key:"equal",value:function(b){var z=this,O=b||{},r=O.unit,H=!0;return typeof r=="boolean"?H=r:Array.from(this.unitlessCssVar).some(function(Z){return z.result.includes(Z)})&&(H=!1),this.result=this.result.replace(fD,H?"px":""),typeof this.lowPriority<"u"?"calc(".concat(this.result,")"):this.result}}]),f}(PI),mD=function(i){yp(f,i);var l=vp(f);function f(_){var b;return Qa(this,f),b=l.call(this),jt(Di(b),"result",0),_ instanceof f?b.result=_.result:typeof _=="number"&&(b.result=_),b}return el(f,[{key:"add",value:function(b){return b instanceof f?this.result+=b.result:typeof b=="number"&&(this.result+=b),this}},{key:"sub",value:function(b){return b instanceof f?this.result-=b.result:typeof b=="number"&&(this.result-=b),this}},{key:"mul",value:function(b){return b instanceof f?this.result*=b.result:typeof b=="number"&&(this.result*=b),this}},{key:"div",value:function(b){return b instanceof f?this.result/=b.result:typeof b=="number"&&(this.result/=b),this}},{key:"equal",value:function(){return this.result}}]),f}(PI),gD=function(l,f){var _=l==="css"?pD:mD;return function(b){return new _(b,f)}},cM=function(l,f){return"".concat([f,l.replace(/([A-Z]+)([A-Z][a-z]+)/g,"$1-$2").replace(/([a-z])([A-Z])/g,"$1-$2")].filter(Boolean).join("-"))};function mc(i){var l=se.useRef();l.current=i;var f=se.useCallback(function(){for(var _,b=arguments.length,z=new Array(b),O=0;O<b;O++)z[O]=arguments[O];return(_=l.current)===null||_===void 0?void 0:_.call.apply(_,[l].concat(z))},[]);return f}function ny(i){var l=se.useRef(!1),f=se.useState(i),_=Gn(f,2),b=_[0],z=_[1];se.useEffect(function(){return l.current=!1,function(){l.current=!0}},[]);function O(r,H){H&&l.current||z(r)}return[b,O]}function x1(i){return i!==void 0}function wf(i,l){var f=l||{},_=f.defaultValue,b=f.value,z=f.onChange,O=f.postState,r=ny(function(){return x1(b)?b:x1(_)?typeof _=="function"?_():_:typeof i=="function"?i():i}),H=Gn(r,2),Z=H[0],K=H[1],te=b!==void 0?b:Z,le=O?O(te):te,Te=mc(z),pe=ny([te]),ge=Gn(pe,2),fe=ge[0],me=ge[1];XC(function(){var Ie=fe[0];Z!==Ie&&Te(Z,Ie)},[fe]),XC(function(){x1(b)||K(b)},[b]);var _e=mc(function(Ie,Ne){K(Ie,Ne),me([te],Ne)});return[le,_e]}function uM(i,l,f,_){var b=nn({},l[i]);if(_!=null&&_.deprecatedTokens){var z=_.deprecatedTokens;z.forEach(function(r){var H=Gn(r,2),Z=H[0],K=H[1];if(b!=null&&b[Z]||b!=null&&b[K]){var te;(te=b[K])!==null&&te!==void 0||(b[K]=b==null?void 0:b[Z])}})}var O=nn(nn({},f),b);return Object.keys(O).forEach(function(r){O[r]===l[r]&&delete O[r]}),O}var kI=typeof CSSINJS_STATISTIC<"u",mw=!0;function Ml(){for(var i=arguments.length,l=new Array(i),f=0;f<i;f++)l[f]=arguments[f];if(!kI)return Object.assign.apply(Object,[{}].concat(l));mw=!1;var _={};return l.forEach(function(b){if(li(b)==="object"){var z=Object.keys(b);z.forEach(function(O){Object.defineProperty(_,O,{configurable:!0,enumerable:!0,get:function(){return b[O]}})})}}),mw=!0,_}var hM={};function _D(){}var yD=function(l){var f,_=l,b=_D;return kI&&typeof Proxy<"u"&&(f=new Set,_=new Proxy(l,{get:function(O,r){if(mw){var H;(H=f)===null||H===void 0||H.add(r)}return O[r]}}),b=function(O,r){var H;hM[O]={global:Array.from(f),component:nn(nn({},(H=hM[O])===null||H===void 0?void 0:H.component),r)}}),{token:_,keys:f,flush:b}};function dM(i,l,f){if(typeof f=="function"){var _;return f(Ml(l,(_=l[i])!==null&&_!==void 0?_:{}))}return f??{}}function vD(i){return i==="js"?{max:Math.max,min:Math.min}:{max:function(){for(var f=arguments.length,_=new Array(f),b=0;b<f;b++)_[b]=arguments[b];return"max(".concat(_.map(function(z){return Ur(z)}).join(","),")")},min:function(){for(var f=arguments.length,_=new Array(f),b=0;b<f;b++)_[b]=arguments[b];return"min(".concat(_.map(function(z){return Ur(z)}).join(","),")")}}}var xD=1e3*60*10,bD=function(){function i(){Qa(this,i),jt(this,"map",new Map),jt(this,"objectIDMap",new WeakMap),jt(this,"nextID",0),jt(this,"lastAccessBeat",new Map),jt(this,"accessBeat",0)}return el(i,[{key:"set",value:function(f,_){this.clear();var b=this.getCompositeKey(f);this.map.set(b,_),this.lastAccessBeat.set(b,Date.now())}},{key:"get",value:function(f){var _=this.getCompositeKey(f),b=this.map.get(_);return this.lastAccessBeat.set(_,Date.now()),this.accessBeat+=1,b}},{key:"getCompositeKey",value:function(f){var _=this,b=f.map(function(z){return z&&li(z)==="object"?"obj_".concat(_.getObjectID(z)):"".concat(li(z),"_").concat(z)});return b.join("|")}},{key:"getObjectID",value:function(f){if(this.objectIDMap.has(f))return this.objectIDMap.get(f);var _=this.nextID;return this.objectIDMap.set(f,_),this.nextID+=1,_}},{key:"clear",value:function(){var f=this;if(this.accessBeat>1e4){var _=Date.now();this.lastAccessBeat.forEach(function(b,z){_-b>xD&&(f.map.delete(z),f.lastAccessBeat.delete(z))}),this.accessBeat=0}}}]),i}(),fM=new bD;function wD(i,l){return Nn.useMemo(function(){var f=fM.get(l);if(f)return f;var _=i();return fM.set(l,_),_},l)}var SD=function(){return{}};function ED(i){var l=i.useCSP,f=l===void 0?SD:l,_=i.useToken,b=i.usePrefix,z=i.getResetStyles,O=i.getCommonStyle,r=i.getCompUnitless;function H(le,Te,pe,ge){var fe=Array.isArray(le)?le[0]:le;function me(rt){return"".concat(String(fe)).concat(rt.slice(0,1).toUpperCase()).concat(rt.slice(1))}var _e=(ge==null?void 0:ge.unitless)||{},Ie=typeof r=="function"?r(le):{},Ne=nn(nn({},Ie),{},jt({},me("zIndexPopup"),!0));Object.keys(_e).forEach(function(rt){Ne[me(rt)]=_e[rt]});var nt=nn(nn({},ge),{},{unitless:Ne,prefixToken:me}),Le=K(le,Te,pe,nt),Pe=Z(fe,pe,nt);return function(rt){var at=arguments.length>1&&arguments[1]!==void 0?arguments[1]:rt,Qe=Le(rt,at),lt=Gn(Qe,2),Ct=lt[1],Rt=Pe(at),Nt=Gn(Rt,2),At=Nt[0],xt=Nt[1];return[At,Ct,xt]}}function Z(le,Te,pe){var ge=pe.unitless,fe=pe.injectStyle,me=fe===void 0?!0:fe,_e=pe.prefixToken,Ie=pe.ignore,Ne=function(Pe){var rt=Pe.rootCls,at=Pe.cssVar,Qe=at===void 0?{}:at,lt=_(),Ct=lt.realToken;return RO({path:[le],prefix:Qe.prefix,key:Qe.key,unitless:ge,ignore:Ie,token:Ct,scope:rt},function(){var Rt=dM(le,Ct,Te),Nt=uM(le,Ct,Rt,{deprecatedTokens:pe==null?void 0:pe.deprecatedTokens});return Object.keys(Rt).forEach(function(At){Nt[_e(At)]=Nt[At],delete Nt[At]}),Nt}),null},nt=function(Pe){var rt=_(),at=rt.cssVar;return[function(Qe){return me&&at?Nn.createElement(Nn.Fragment,null,Nn.createElement(Ne,{rootCls:Pe,cssVar:at,component:le}),Qe):Qe},at==null?void 0:at.key]};return nt}function K(le,Te,pe){var ge=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{},fe=Array.isArray(le)?le:[le,le],me=Gn(fe,1),_e=me[0],Ie=fe.join("-"),Ne=i.layer||{name:"antd"};return function(nt){var Le=arguments.length>1&&arguments[1]!==void 0?arguments[1]:nt,Pe=_(),rt=Pe.theme,at=Pe.realToken,Qe=Pe.hashId,lt=Pe.token,Ct=Pe.cssVar,Rt=b(),Nt=Rt.rootPrefixCls,At=Rt.iconPrefixCls,xt=f(),gt=Ct?"css":"js",ht=wD(function(){var Ot=new Set;return Ct&&Object.keys(ge.unitless||{}).forEach(function(sn){Ot.add(Sv(sn,Ct.prefix)),Ot.add(Sv(sn,cM(_e,Ct.prefix)))}),gD(gt,Ot)},[gt,_e,Ct==null?void 0:Ct.prefix]),vt=vD(gt),Ve=vt.max,je=vt.min,it={theme:rt,token:lt,hashId:Qe,nonce:function(){return xt.nonce},clientOnly:ge.clientOnly,layer:Ne,order:ge.order||-999};typeof z=="function"&&tw(nn(nn({},it),{},{clientOnly:!1,path:["Shared",Nt]}),function(){return z(lt,{prefix:{rootPrefixCls:Nt,iconPrefixCls:At},csp:xt})});var Mt=tw(nn(nn({},it),{},{path:[Ie,nt,At]}),function(){if(ge.injectStyle===!1)return[];var Ot=yD(lt),sn=Ot.token,hn=Ot.flush,Tn=dM(_e,at,pe),Ut=".".concat(nt),bn=uM(_e,at,Tn,{deprecatedTokens:ge.deprecatedTokens});Ct&&Tn&&li(Tn)==="object"&&Object.keys(Tn).forEach(function(Ar){Tn[Ar]="var(".concat(Sv(Ar,cM(_e,Ct.prefix)),")")});var Re=Ml(sn,{componentCls:Ut,prefixCls:nt,iconCls:".".concat(At),antCls:".".concat(Nt),calc:ht,max:Ve,min:je},Ct?Tn:bn),Hr=Te(Re,{hashId:Qe,prefixCls:nt,rootPrefixCls:Nt,iconPrefixCls:At});hn(_e,bn);var Nr=typeof O=="function"?O(Re,nt,Le,ge.resetFont):null;return[ge.resetStyle===!1?null:Nr,Hr]});return[Mt,Qe]}}function te(le,Te,pe){var ge=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{},fe=K(le,Te,pe,nn({resetStyle:!1,order:-998},ge)),me=function(Ie){var Ne=Ie.prefixCls,nt=Ie.rootCls,Le=nt===void 0?Ne:nt;return fe(Ne,Le),null};return me}return{genStyleHooks:H,genSubStyleComponent:te,genComponentStyleHook:K}}const im=["blue","purple","cyan","green","magenta","pink","red","orange","yellow","volcano","geekblue","lime","gold"],TD="5.23.0";function b1(i){return i>=0&&i<=255}function hv(i,l){const{r:f,g:_,b,a:z}=new ks(i).toRgb();if(z<1)return i;const{r:O,g:r,b:H}=new ks(l).toRgb();for(let Z=.01;Z<=1;Z+=.01){const K=Math.round((f-O*(1-Z))/Z),te=Math.round((_-r*(1-Z))/Z),le=Math.round((b-H*(1-Z))/Z);if(b1(K)&&b1(te)&&b1(le))return new ks({r:K,g:te,b:le,a:Math.round(Z*100)/100}).toRgbString()}return new ks({r:f,g:_,b,a:1}).toRgbString()}var CD=function(i,l){var f={};for(var _ in i)Object.prototype.hasOwnProperty.call(i,_)&&l.indexOf(_)<0&&(f[_]=i[_]);if(i!=null&&typeof Object.getOwnPropertySymbols=="function")for(var b=0,_=Object.getOwnPropertySymbols(i);b<_.length;b++)l.indexOf(_[b])<0&&Object.prototype.propertyIsEnumerable.call(i,_[b])&&(f[_[b]]=i[_[b]]);return f};function zI(i){const{override:l}=i,f=CD(i,["override"]),_=Object.assign({},l);Object.keys(ty).forEach(le=>{delete _[le]});const b=Object.assign(Object.assign({},f),_),z=480,O=576,r=768,H=992,Z=1200,K=1600;if(b.motion===!1){const le="0s";b.motionDurationFast=le,b.motionDurationMid=le,b.motionDurationSlow=le}return Object.assign(Object.assign(Object.assign({},b),{colorFillContent:b.colorFillSecondary,colorFillContentHover:b.colorFill,colorFillAlter:b.colorFillQuaternary,colorBgContainerDisabled:b.colorFillTertiary,colorBorderBg:b.colorBgContainer,colorSplit:hv(b.colorBorderSecondary,b.colorBgContainer),colorTextPlaceholder:b.colorTextQuaternary,colorTextDisabled:b.colorTextQuaternary,colorTextHeading:b.colorText,colorTextLabel:b.colorTextSecondary,colorTextDescription:b.colorTextTertiary,colorTextLightSolid:b.colorWhite,colorHighlight:b.colorError,colorBgTextHover:b.colorFillSecondary,colorBgTextActive:b.colorFill,colorIcon:b.colorTextTertiary,colorIconHover:b.colorText,colorErrorOutline:hv(b.colorErrorBg,b.colorBgContainer),colorWarningOutline:hv(b.colorWarningBg,b.colorBgContainer),fontSizeIcon:b.fontSizeSM,lineWidthFocus:b.lineWidth*3,lineWidth:b.lineWidth,controlOutlineWidth:b.lineWidth*2,controlInteractiveSize:b.controlHeight/2,controlItemBgHover:b.colorFillTertiary,controlItemBgActive:b.colorPrimaryBg,controlItemBgActiveHover:b.colorPrimaryBgHover,controlItemBgActiveDisabled:b.colorFill,controlTmpOutline:b.colorFillQuaternary,controlOutline:hv(b.colorPrimaryBg,b.colorBgContainer),lineType:b.lineType,borderRadius:b.borderRadius,borderRadiusXS:b.borderRadiusXS,borderRadiusSM:b.borderRadiusSM,borderRadiusLG:b.borderRadiusLG,fontWeightStrong:600,opacityLoading:.65,linkDecoration:"none",linkHoverDecoration:"none",linkFocusDecoration:"none",controlPaddingHorizontal:12,controlPaddingHorizontalSM:8,paddingXXS:b.sizeXXS,paddingXS:b.sizeXS,paddingSM:b.sizeSM,padding:b.size,paddingMD:b.sizeMD,paddingLG:b.sizeLG,paddingXL:b.sizeXL,paddingContentHorizontalLG:b.sizeLG,paddingContentVerticalLG:b.sizeMS,paddingContentHorizontal:b.sizeMS,paddingContentVertical:b.sizeSM,paddingContentHorizontalSM:b.size,paddingContentVerticalSM:b.sizeXS,marginXXS:b.sizeXXS,marginXS:b.sizeXS,marginSM:b.sizeSM,margin:b.size,marginMD:b.sizeMD,marginLG:b.sizeLG,marginXL:b.sizeXL,marginXXL:b.sizeXXL,boxShadow:`
      0 6px 16px 0 rgba(0, 0, 0, 0.08),
      0 3px 6px -4px rgba(0, 0, 0, 0.12),
      0 9px 28px 8px rgba(0, 0, 0, 0.05)
    `,boxShadowSecondary:`
      0 6px 16px 0 rgba(0, 0, 0, 0.08),
      0 3px 6px -4px rgba(0, 0, 0, 0.12),
      0 9px 28px 8px rgba(0, 0, 0, 0.05)
    `,boxShadowTertiary:`
      0 1px 2px 0 rgba(0, 0, 0, 0.03),
      0 1px 6px -1px rgba(0, 0, 0, 0.02),
      0 2px 4px 0 rgba(0, 0, 0, 0.02)
    `,screenXS:z,screenXSMin:z,screenXSMax:O-1,screenSM:O,screenSMMin:O,screenSMMax:r-1,screenMD:r,screenMDMin:r,screenMDMax:H-1,screenLG:H,screenLGMin:H,screenLGMax:Z-1,screenXL:Z,screenXLMin:Z,screenXLMax:K-1,screenXXL:K,screenXXLMin:K,boxShadowPopoverArrow:"2px 2px 5px rgba(0, 0, 0, 0.05)",boxShadowCard:`
      0 1px 2px -2px ${new ks("rgba(0, 0, 0, 0.16)").toRgbString()},
      0 3px 6px 0 ${new ks("rgba(0, 0, 0, 0.12)").toRgbString()},
      0 5px 12px 4px ${new ks("rgba(0, 0, 0, 0.09)").toRgbString()}
    `,boxShadowDrawerRight:`
      -6px 0 16px 0 rgba(0, 0, 0, 0.08),
      -3px 0 6px -4px rgba(0, 0, 0, 0.12),
      -9px 0 28px 8px rgba(0, 0, 0, 0.05)
    `,boxShadowDrawerLeft:`
      6px 0 16px 0 rgba(0, 0, 0, 0.08),
      3px 0 6px -4px rgba(0, 0, 0, 0.12),
      9px 0 28px 8px rgba(0, 0, 0, 0.05)
    `,boxShadowDrawerUp:`
      0 6px 16px 0 rgba(0, 0, 0, 0.08),
      0 3px 6px -4px rgba(0, 0, 0, 0.12),
      0 9px 28px 8px rgba(0, 0, 0, 0.05)
    `,boxShadowDrawerDown:`
      0 -6px 16px 0 rgba(0, 0, 0, 0.08),
      0 -3px 6px -4px rgba(0, 0, 0, 0.12),
      0 -9px 28px 8px rgba(0, 0, 0, 0.05)
    `,boxShadowTabsOverflowLeft:"inset 10px 0 8px -8px rgba(0, 0, 0, 0.08)",boxShadowTabsOverflowRight:"inset -10px 0 8px -8px rgba(0, 0, 0, 0.08)",boxShadowTabsOverflowTop:"inset 0 10px 8px -8px rgba(0, 0, 0, 0.08)",boxShadowTabsOverflowBottom:"inset 0 -10px 8px -8px rgba(0, 0, 0, 0.08)"}),_)}var pM=function(i,l){var f={};for(var _ in i)Object.prototype.hasOwnProperty.call(i,_)&&l.indexOf(_)<0&&(f[_]=i[_]);if(i!=null&&typeof Object.getOwnPropertySymbols=="function")for(var b=0,_=Object.getOwnPropertySymbols(i);b<_.length;b++)l.indexOf(_[b])<0&&Object.prototype.propertyIsEnumerable.call(i,_[b])&&(f[_[b]]=i[_[b]]);return f};const LI={lineHeight:!0,lineHeightSM:!0,lineHeightLG:!0,lineHeightHeading1:!0,lineHeightHeading2:!0,lineHeightHeading3:!0,lineHeightHeading4:!0,lineHeightHeading5:!0,opacityLoading:!0,fontWeightStrong:!0,zIndexPopupBase:!0,zIndexBase:!0,opacityImage:!0},MD={size:!0,sizeSM:!0,sizeLG:!0,sizeMD:!0,sizeXS:!0,sizeXXS:!0,sizeMS:!0,sizeXL:!0,sizeXXL:!0,sizeUnit:!0,sizeStep:!0,motionBase:!0,motionUnit:!0},AD={screenXS:!0,screenXSMin:!0,screenXSMax:!0,screenSM:!0,screenSMMin:!0,screenSMMax:!0,screenMD:!0,screenMDMin:!0,screenMDMax:!0,screenLG:!0,screenLGMin:!0,screenLGMax:!0,screenXL:!0,screenXLMin:!0,screenXLMax:!0,screenXXL:!0,screenXXLMin:!0},OI=(i,l,f)=>{const _=f.getDerivativeToken(i),{override:b}=l,z=pM(l,["override"]);let O=Object.assign(Object.assign({},_),{override:b});return O=zI(O),z&&Object.entries(z).forEach(r=>{let[H,Z]=r;const{theme:K}=Z,te=pM(Z,["theme"]);let le=te;K&&(le=OI(Object.assign(Object.assign({},O),te),{override:te},K)),O[H]=le}),O};function Sf(){const{token:i,hashed:l,theme:f,override:_,cssVar:b}=Nn.useContext(II),z=`${TD}-${l||""}`,O=f||AI,[r,H,Z]=iO(O,[ty,i],{salt:z,override:_,getComputedToken:OI,formatToken:zI,cssVar:b&&{prefix:b.prefix,key:b.key,unitless:LI,ignore:MD,preserve:AD}});return[O,Z,l?H:"",r,b]}const Ad=function(i){let l=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;return{boxSizing:"border-box",margin:0,padding:0,color:i.colorText,fontSize:i.fontSize,lineHeight:i.lineHeight,listStyle:"none",fontFamily:l?"inherit":i.fontFamily}},DI=()=>({display:"inline-flex",alignItems:"center",color:"inherit",fontStyle:"normal",lineHeight:0,textAlign:"center",textTransform:"none",verticalAlign:"-0.125em",textRendering:"optimizeLegibility","-webkit-font-smoothing":"antialiased","-moz-osx-font-smoothing":"grayscale","> *":{lineHeight:1},svg:{display:"inline-block"}}),ID=()=>({"&::before":{display:"table",content:'""'},"&::after":{display:"table",clear:"both",content:'""'}}),PD=i=>({a:{color:i.colorLink,textDecoration:i.linkDecoration,backgroundColor:"transparent",outline:"none",cursor:"pointer",transition:`color ${i.motionDurationSlow}`,"-webkit-text-decoration-skip":"objects","&:hover":{color:i.colorLinkHover},"&:active":{color:i.colorLinkActive},"&:active, &:hover":{textDecoration:i.linkHoverDecoration,outline:0},"&:focus":{textDecoration:i.linkFocusDecoration,outline:0},"&[disabled]":{color:i.colorTextDisabled,cursor:"not-allowed"}}}),RD=(i,l,f,_)=>{const b=`[class^="${l}"], [class*=" ${l}"]`,z=f?`.${f}`:b,O={boxSizing:"border-box","&::before, &::after":{boxSizing:"border-box"}};let r={};return _!==!1&&(r={fontFamily:i.fontFamily,fontSize:i.fontSize}),{[z]:Object.assign(Object.assign(Object.assign({},r),O),{[b]:O})}},NS=(i,l)=>({outline:`${Ur(i.lineWidthFocus)} solid ${i.colorPrimaryBorder}`,outlineOffset:l??1,transition:"outline-offset 0s, outline 0s"}),FI=(i,l)=>({"&:focus-visible":Object.assign({},NS(i,l))}),BI=i=>({[`.${i}`]:Object.assign(Object.assign({},DI()),{[`.${i} .${i}-icon`]:{display:"block"}})}),{genStyleHooks:Ef,genComponentStyleHook:kD,genSubStyleComponent:zD}=ED({usePrefix:()=>{const{getPrefixCls:i,iconPrefixCls:l}=se.useContext(Xo);return{rootPrefixCls:i(),iconPrefixCls:l}},useToken:()=>{const[i,l,f,_,b]=Sf();return{theme:i,realToken:l,hashId:f,token:_,cssVar:b}},useCSP:()=>{const{csp:i}=se.useContext(Xo);return i??{}},getResetStyles:(i,l)=>{var f;return[{"&":PD(i)},BI((f=l==null?void 0:l.prefix.iconPrefixCls)!==null&&f!==void 0?f:BS)]},getCommonStyle:RD,getCompUnitless:()=>LI});function LD(i,l){return im.reduce((f,_)=>{const b=i[`${_}1`],z=i[`${_}3`],O=i[`${_}6`],r=i[`${_}7`];return Object.assign(Object.assign({},f),l(_,{lightColor:b,lightBorderColor:z,darkColor:O,textColor:r}))},{})}const OD=(i,l)=>{const[f,_]=Sf();return tw({theme:f,token:_,hashId:"",path:["ant-design-icons",i],nonce:()=>l==null?void 0:l.nonce,layer:{name:"antd"}},()=>[BI(i)])},DD=Object.assign({},Ex),{useId:mM}=DD,FD=()=>"",BD=typeof mM>"u"?FD:mM;function ND(i,l,f){var _;wI();const b=i||{},z=b.inherit===!1||!l?Object.assign(Object.assign({},pw),{hashed:(_=l==null?void 0:l.hashed)!==null&&_!==void 0?_:pw.hashed,cssVar:l==null?void 0:l.cssVar}):l,O=BD();return CS(()=>{var r,H;if(!i)return l;const Z=Object.assign({},z.components);Object.keys(i.components||{}).forEach(le=>{Z[le]=Object.assign(Object.assign({},Z[le]),i.components[le])});const K=`css-var-${O.replace(/:/g,"")}`,te=((r=b.cssVar)!==null&&r!==void 0?r:z.cssVar)&&Object.assign(Object.assign(Object.assign({prefix:f==null?void 0:f.prefixCls},typeof z.cssVar=="object"?z.cssVar:{}),typeof b.cssVar=="object"?b.cssVar:{}),{key:typeof b.cssVar=="object"&&((H=b.cssVar)===null||H===void 0?void 0:H.key)||K});return Object.assign(Object.assign(Object.assign({},z),b),{token:Object.assign(Object.assign({},z.token),b.token),components:Z,cssVar:te})},[b,z],(r,H)=>r.some((Z,K)=>{const te=H[K];return!X1(Z,te,!0)}))}var jD=["children"],NI=se.createContext({});function $D(i){var l=i.children,f=Ja(i,jD);return se.createElement(NI.Provider,{value:f},l)}var VD=function(i){yp(f,i);var l=vp(f);function f(){return Qa(this,f),l.apply(this,arguments)}return el(f,[{key:"render",value:function(){return this.props.children}}]),f}(se.Component);function UD(i){var l=se.useReducer(function(r){return r+1},0),f=Gn(l,2),_=f[1],b=se.useRef(i),z=mc(function(){return b.current}),O=mc(function(r){b.current=typeof r=="function"?r(b.current):r,_()});return[z,O]}var np="none",dv="appear",fv="enter",pv="leave",gM="none",Ph="prepare",mg="start",gg="active",jS="end",jI="prepared";function _M(i,l){var f={};return f[i.toLowerCase()]=l.toLowerCase(),f["Webkit".concat(i)]="webkit".concat(l),f["Moz".concat(i)]="moz".concat(l),f["ms".concat(i)]="MS".concat(l),f["O".concat(i)]="o".concat(l.toLowerCase()),f}function HD(i,l){var f={animationend:_M("Animation","AnimationEnd"),transitionend:_M("Transition","TransitionEnd")};return i&&("AnimationEvent"in l||delete f.animationend.animation,"TransitionEvent"in l||delete f.transitionend.transition),f}var WD=HD(wu(),typeof window<"u"?window:{}),$I={};if(wu()){var GD=document.createElement("div");$I=GD.style}var mv={};function VI(i){if(mv[i])return mv[i];var l=WD[i];if(l)for(var f=Object.keys(l),_=f.length,b=0;b<_;b+=1){var z=f[b];if(Object.prototype.hasOwnProperty.call(l,z)&&z in $I)return mv[i]=l[z],mv[i]}return""}var UI=VI("animationend"),HI=VI("transitionend"),WI=!!(UI&&HI),yM=UI||"animationend",vM=HI||"transitionend";function xM(i,l){if(!i)return null;if(li(i)==="object"){var f=l.replace(/-\w/g,function(_){return _[1].toUpperCase()});return i[f]}return"".concat(i,"-").concat(l)}const qD=function(i){var l=se.useRef();function f(b){b&&(b.removeEventListener(vM,i),b.removeEventListener(yM,i))}function _(b){l.current&&l.current!==b&&f(l.current),b&&b!==l.current&&(b.addEventListener(vM,i),b.addEventListener(yM,i),l.current=b)}return se.useEffect(function(){return function(){f(l.current)}},[]),[_,f]};var GI=wu()?se.useLayoutEffect:se.useEffect;const ZD=function(){var i=se.useRef(null);function l(){qu.cancel(i.current)}function f(_){var b=arguments.length>1&&arguments[1]!==void 0?arguments[1]:2;l();var z=qu(function(){b<=1?_({isCanceled:function(){return z!==i.current}}):f(_,b-1)});i.current=z}return se.useEffect(function(){return function(){l()}},[]),[f,l]};var XD=[Ph,mg,gg,jS],YD=[Ph,jI],qI=!1,KD=!0;function ZI(i){return i===gg||i===jS}const JD=function(i,l,f){var _=ny(gM),b=Gn(_,2),z=b[0],O=b[1],r=ZD(),H=Gn(r,2),Z=H[0],K=H[1];function te(){O(Ph,!0)}var le=l?YD:XD;return GI(function(){if(z!==gM&&z!==jS){var Te=le.indexOf(z),pe=le[Te+1],ge=f(z);ge===qI?O(pe,!0):pe&&Z(function(fe){function me(){fe.isCanceled()||O(pe,!0)}ge===!0?me():Promise.resolve(ge).then(me)})}},[i,z]),se.useEffect(function(){return function(){K()}},[]),[te,z]};function QD(i,l,f,_){var b=_.motionEnter,z=b===void 0?!0:b,O=_.motionAppear,r=O===void 0?!0:O,H=_.motionLeave,Z=H===void 0?!0:H,K=_.motionDeadline,te=_.motionLeaveImmediately,le=_.onAppearPrepare,Te=_.onEnterPrepare,pe=_.onLeavePrepare,ge=_.onAppearStart,fe=_.onEnterStart,me=_.onLeaveStart,_e=_.onAppearActive,Ie=_.onEnterActive,Ne=_.onLeaveActive,nt=_.onAppearEnd,Le=_.onEnterEnd,Pe=_.onLeaveEnd,rt=_.onVisibleChanged,at=ny(),Qe=Gn(at,2),lt=Qe[0],Ct=Qe[1],Rt=UD(np),Nt=Gn(Rt,2),At=Nt[0],xt=Nt[1],gt=ny(null),ht=Gn(gt,2),vt=ht[0],Ve=ht[1],je=At(),it=se.useRef(!1),Mt=se.useRef(null);function Ot(){return f()}var sn=se.useRef(!1);function hn(){xt(np),Ve(null,!0)}var Tn=mc(function(Pr){var ci=At();if(ci!==np){var Un=Ot();if(!(Pr&&!Pr.deadline&&Pr.target!==Un)){var yn=sn.current,Ir;ci===dv&&yn?Ir=nt==null?void 0:nt(Un,Pr):ci===fv&&yn?Ir=Le==null?void 0:Le(Un,Pr):ci===pv&&yn&&(Ir=Pe==null?void 0:Pe(Un,Pr)),yn&&Ir!==!1&&hn()}}}),Ut=qD(Tn),bn=Gn(Ut,1),Re=bn[0],Hr=function(ci){switch(ci){case dv:return jt(jt(jt({},Ph,le),mg,ge),gg,_e);case fv:return jt(jt(jt({},Ph,Te),mg,fe),gg,Ie);case pv:return jt(jt(jt({},Ph,pe),mg,me),gg,Ne);default:return{}}},Nr=se.useMemo(function(){return Hr(je)},[je]),Ar=JD(je,!i,function(Pr){if(Pr===Ph){var ci=Nr[Ph];return ci?ci(Ot()):qI}if(ar in Nr){var Un;Ve(((Un=Nr[ar])===null||Un===void 0?void 0:Un.call(Nr,Ot(),null))||null)}return ar===gg&&je!==np&&(Re(Ot()),K>0&&(clearTimeout(Mt.current),Mt.current=setTimeout(function(){Tn({deadline:!0})},K))),ar===jI&&hn(),KD}),Ht=Gn(Ar,2),Wr=Ht[0],ar=Ht[1],pi=ZI(ar);sn.current=pi;var $n=se.useRef(null);GI(function(){if(!(it.current&&$n.current===l)){Ct(l);var Pr=it.current;it.current=!0;var ci;!Pr&&l&&r&&(ci=dv),Pr&&l&&z&&(ci=fv),(Pr&&!l&&Z||!Pr&&te&&!l&&Z)&&(ci=pv);var Un=Hr(ci);ci&&(i||Un[Ph])?(xt(ci),Wr()):xt(np),$n.current=l}},[l]),se.useEffect(function(){(je===dv&&!r||je===fv&&!z||je===pv&&!Z)&&xt(np)},[r,z,Z]),se.useEffect(function(){return function(){it.current=!1,clearTimeout(Mt.current)}},[]);var Gr=se.useRef(!1);se.useEffect(function(){lt&&(Gr.current=!0),lt!==void 0&&je===np&&((Gr.current||lt)&&(rt==null||rt(lt)),Gr.current=!0)},[lt,je]);var gi=vt;return Nr[Ph]&&ar===mg&&(gi=nn({transition:"none"},gi)),[je,ar,gi,lt??l]}function eF(i){var l=i;li(i)==="object"&&(l=i.transitionSupport);function f(b,z){return!!(b.motionName&&l&&z!==!1)}var _=se.forwardRef(function(b,z){var O=b.visible,r=O===void 0?!0:O,H=b.removeOnLeave,Z=H===void 0?!0:H,K=b.forceRender,te=b.children,le=b.motionName,Te=b.leavedClassName,pe=b.eventProps,ge=se.useContext(NI),fe=ge.motion,me=f(b,fe),_e=se.useRef(),Ie=se.useRef();function Ne(){try{return _e.current instanceof HTMLElement?_e.current:wv(Ie.current)}catch{return null}}var nt=QD(me,r,Ne,b),Le=Gn(nt,4),Pe=Le[0],rt=Le[1],at=Le[2],Qe=Le[3],lt=se.useRef(Qe);Qe&&(lt.current=!0);var Ct=se.useCallback(function(ht){_e.current=ht,MS(z,ht)},[z]),Rt,Nt=nn(nn({},pe),{},{visible:r});if(!te)Rt=null;else if(Pe===np)Qe?Rt=te(nn({},Nt),Ct):!Z&&lt.current&&Te?Rt=te(nn(nn({},Nt),{},{className:Te}),Ct):K||!Z&&!Te?Rt=te(nn(nn({},Nt),{},{style:{display:"none"}}),Ct):Rt=null;else{var At;rt===Ph?At="prepare":ZI(rt)?At="active":rt===mg&&(At="start");var xt=xM(le,"".concat(Pe,"-").concat(At));Rt=te(nn(nn({},Nt),{},{className:sr(xM(le,Pe),jt(jt({},xt,xt&&At),le,typeof le=="string")),style:at}),Ct)}if(se.isValidElement(Rt)&&sy(Rt)){var gt=Cx(Rt);gt||(Rt=se.cloneElement(Rt,{ref:Ct}))}return se.createElement(VD,{ref:Ie},Rt)});return _.displayName="CSSMotion",_}const ly=eF(WI);var gw="add",_w="keep",yw="remove",w1="removed";function tF(i){var l;return i&&li(i)==="object"&&"key"in i?l=i:l={key:i},nn(nn({},l),{},{key:String(l.key)})}function vw(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[];return i.map(tF)}function nF(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[],l=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[],f=[],_=0,b=l.length,z=vw(i),O=vw(l);z.forEach(function(Z){for(var K=!1,te=_;te<b;te+=1){var le=O[te];if(le.key===Z.key){_<te&&(f=f.concat(O.slice(_,te).map(function(Te){return nn(nn({},Te),{},{status:gw})})),_=te),f.push(nn(nn({},le),{},{status:_w})),_+=1,K=!0;break}}K||f.push(nn(nn({},Z),{},{status:yw}))}),_<b&&(f=f.concat(O.slice(_).map(function(Z){return nn(nn({},Z),{},{status:gw})})));var r={};f.forEach(function(Z){var K=Z.key;r[K]=(r[K]||0)+1});var H=Object.keys(r).filter(function(Z){return r[Z]>1});return H.forEach(function(Z){f=f.filter(function(K){var te=K.key,le=K.status;return te!==Z||le!==yw}),f.forEach(function(K){K.key===Z&&(K.status=_w)})}),f}var rF=["component","children","onVisibleChanged","onAllRemoved"],iF=["status"],oF=["eventProps","visible","children","motionName","motionAppear","motionEnter","motionLeave","motionLeaveImmediately","motionDeadline","removeOnLeave","leavedClassName","onAppearPrepare","onAppearStart","onAppearActive","onAppearEnd","onEnterStart","onEnterActive","onEnterEnd","onLeaveStart","onLeaveActive","onLeaveEnd"];function sF(i){var l=arguments.length>1&&arguments[1]!==void 0?arguments[1]:ly,f=function(_){yp(z,_);var b=vp(z);function z(){var O;Qa(this,z);for(var r=arguments.length,H=new Array(r),Z=0;Z<r;Z++)H[Z]=arguments[Z];return O=b.call.apply(b,[this].concat(H)),jt(Di(O),"state",{keyEntities:[]}),jt(Di(O),"removeKey",function(K){O.setState(function(te){var le=te.keyEntities.map(function(Te){return Te.key!==K?Te:nn(nn({},Te),{},{status:w1})});return{keyEntities:le}},function(){var te=O.state.keyEntities,le=te.filter(function(Te){var pe=Te.status;return pe!==w1}).length;le===0&&O.props.onAllRemoved&&O.props.onAllRemoved()})}),O}return el(z,[{key:"render",value:function(){var r=this,H=this.state.keyEntities,Z=this.props,K=Z.component,te=Z.children,le=Z.onVisibleChanged;Z.onAllRemoved;var Te=Ja(Z,rF),pe=K||se.Fragment,ge={};return oF.forEach(function(fe){ge[fe]=Te[fe],delete Te[fe]}),delete Te.keys,se.createElement(pe,Te,H.map(function(fe,me){var _e=fe.status,Ie=Ja(fe,iF),Ne=_e===gw||_e===_w;return se.createElement(l,$s({},ge,{key:Ie.key,visible:Ne,eventProps:Ie,onVisibleChanged:function(Le){le==null||le(Le,{key:Ie.key}),Le||r.removeKey(Ie.key)}}),function(nt,Le){return te(nn(nn({},nt),{},{index:me}),Le)})}))}}],[{key:"getDerivedStateFromProps",value:function(r,H){var Z=r.keys,K=H.keyEntities,te=vw(Z),le=nF(K,te);return{keyEntities:le.filter(function(Te){var pe=K.find(function(ge){var fe=ge.key;return Te.key===fe});return!(pe&&pe.status===w1&&Te.status===yw)})}}}]),z}(se.Component);return jt(f,"defaultProps",{component:"div"}),f}sF(WI);function aF(i){const{children:l}=i,[,f]=Sf(),{motion:_}=f,b=se.useRef(!1);return b.current=b.current||_===!1,b.current?se.createElement($D,{motion:_},l):l}const lF=()=>null;var cF=function(i,l){var f={};for(var _ in i)Object.prototype.hasOwnProperty.call(i,_)&&l.indexOf(_)<0&&(f[_]=i[_]);if(i!=null&&typeof Object.getOwnPropertySymbols=="function")for(var b=0,_=Object.getOwnPropertySymbols(i);b<_.length;b++)l.indexOf(_[b])<0&&Object.prototype.propertyIsEnumerable.call(i,_[b])&&(f[_[b]]=i[_[b]]);return f};const uF=["getTargetContainer","getPopupContainer","renderEmpty","input","pagination","form","select","button"];let XI;function hF(){return XI||cx}function dF(i){return Object.keys(i).some(l=>l.endsWith("Color"))}const fF=i=>{const{prefixCls:l,iconPrefixCls:f,theme:_,holderRender:b}=i;l!==void 0&&(XI=l),_&&dF(_)&&cD(hF(),_)},pF=i=>{const{children:l,csp:f,autoInsertSpaceInButton:_,alert:b,anchor:z,form:O,locale:r,componentSize:H,direction:Z,space:K,splitter:te,virtual:le,dropdownMatchSelectWidth:Te,popupMatchSelectWidth:pe,popupOverflow:ge,legacyLocale:fe,parentContext:me,iconPrefixCls:_e,theme:Ie,componentDisabled:Ne,segmented:nt,statistic:Le,spin:Pe,calendar:rt,carousel:at,cascader:Qe,collapse:lt,typography:Ct,checkbox:Rt,descriptions:Nt,divider:At,drawer:xt,skeleton:gt,steps:ht,image:vt,layout:Ve,list:je,mentions:it,modal:Mt,progress:Ot,result:sn,slider:hn,breadcrumb:Tn,menu:Ut,pagination:bn,input:Re,textArea:Hr,empty:Nr,badge:Ar,radio:Ht,rate:Wr,switch:ar,transfer:pi,avatar:$n,message:Gr,tag:gi,table:Pr,card:ci,tabs:Un,timeline:yn,timePicker:Ir,upload:ui,notification:_i,tree:Lr,colorPicker:yi,datePicker:oi,rangePicker:qi,flex:Ci,wave:mr,dropdown:dr,warning:wo,tour:Zi,tooltip:ko,popover:nr,popconfirm:ss,floatButtonGroup:Vs,variant:io,inputNumber:as,treeSelect:ls}=i,Ao=se.useCallback((Ke,mt)=>{const{prefixCls:wt}=i;if(mt)return mt;const Tt=wt||me.getPrefixCls("");return Ke?`${Tt}-${Ke}`:Tt},[me.getPrefixCls,i.prefixCls]),Ts=_e||me.iconPrefixCls||BS,oo=f||me.csp;OD(Ts,oo);const bt=ND(Ie,me.theme,{prefixCls:Ao("")}),oe={csp:oo,autoInsertSpaceInButton:_,alert:b,anchor:z,locale:r||fe,direction:Z,space:K,splitter:te,virtual:le,popupMatchSelectWidth:pe??Te,popupOverflow:ge,getPrefixCls:Ao,iconPrefixCls:Ts,theme:bt,segmented:nt,statistic:Le,spin:Pe,calendar:rt,carousel:at,cascader:Qe,collapse:lt,typography:Ct,checkbox:Rt,descriptions:Nt,divider:At,drawer:xt,skeleton:gt,steps:ht,image:vt,input:Re,textArea:Hr,layout:Ve,list:je,mentions:it,modal:Mt,progress:Ot,result:sn,slider:hn,breadcrumb:Tn,menu:Ut,pagination:bn,empty:Nr,badge:Ar,radio:Ht,rate:Wr,switch:ar,transfer:pi,avatar:$n,message:Gr,tag:gi,table:Pr,card:ci,tabs:Un,timeline:yn,timePicker:Ir,upload:ui,notification:_i,tree:Lr,colorPicker:yi,datePicker:oi,rangePicker:qi,flex:Ci,wave:mr,dropdown:dr,warning:wo,tour:Zi,tooltip:ko,popover:nr,popconfirm:ss,floatButtonGroup:Vs,variant:io,inputNumber:as,treeSelect:ls},de=Object.assign({},me);Object.keys(oe).forEach(Ke=>{oe[Ke]!==void 0&&(de[Ke]=oe[Ke])}),uF.forEach(Ke=>{const mt=i[Ke];mt&&(de[Ke]=mt)}),typeof _<"u"&&(de.button=Object.assign({autoInsertSpace:_},de.button));const Se=CS(()=>de,de,(Ke,mt)=>{const wt=Object.keys(Ke),Tt=Object.keys(mt);return wt.length!==Tt.length||wt.some(Jt=>Ke[Jt]!==mt[Jt])}),He=se.useMemo(()=>({prefixCls:Ts,csp:oo}),[Ts,oo]);let $e=se.createElement(se.Fragment,null,se.createElement(lF,{dropdownMatchSelectWidth:Te}),l);const et=se.useMemo(()=>{var Ke,mt,wt,Tt;return pg(((Ke=kx.Form)===null||Ke===void 0?void 0:Ke.defaultValidateMessages)||{},((wt=(mt=Se.locale)===null||mt===void 0?void 0:mt.Form)===null||wt===void 0?void 0:wt.defaultValidateMessages)||{},((Tt=Se.form)===null||Tt===void 0?void 0:Tt.validateMessages)||{},(O==null?void 0:O.validateMessages)||{})},[Se,O==null?void 0:O.validateMessages]);Object.keys(et).length>0&&($e=se.createElement(BO.Provider,{value:et},$e)),r&&($e=se.createElement(HO,{locale:r,_ANT_MARK__:UO},$e)),$e=se.createElement(FS.Provider,{value:He},$e),H&&($e=se.createElement(hD,{size:H},$e)),$e=se.createElement(aF,null,$e);const _t=se.useMemo(()=>{const Ke=bt||{},{algorithm:mt,token:wt,components:Tt,cssVar:Jt}=Ke,fn=cF(Ke,["algorithm","token","components","cssVar"]),on=mt&&(!Array.isArray(mt)||mt.length>0)?K1(mt):AI,En={};Object.entries(Tt||{}).forEach(Rn=>{let[In,kr]=Rn;const lr=Object.assign({},kr);"algorithm"in lr&&(lr.algorithm===!0?lr.theme=on:(Array.isArray(lr.algorithm)||typeof lr.algorithm=="function")&&(lr.theme=K1(lr.algorithm)),delete lr.algorithm),En[In]=lr});const zn=Object.assign(Object.assign({},ty),wt);return Object.assign(Object.assign({},fn),{theme:on,token:zn,components:En,override:Object.assign({override:zn},En),cssVar:Jt})},[bt]);return Ie&&($e=se.createElement(II.Provider,{value:_t},$e)),Se.warning&&($e=se.createElement(FO.Provider,{value:Se.warning},$e)),Ne!==void 0&&($e=se.createElement(uD,{disabled:Ne},$e)),se.createElement(Xo.Provider,{value:Se},$e)},cy=i=>{const l=se.useContext(Xo),f=se.useContext(EI);return se.createElement(pF,Object.assign({parentContext:l,legacyLocale:f},i))};cy.ConfigContext=Xo;cy.SizeContext=Sg;cy.config=fF;cy.useConfig=dD;Object.defineProperty(cy,"SizeContext",{get:()=>Sg});function YI(i){var l;return i==null||(l=i.getRootNode)===null||l===void 0?void 0:l.call(i)}function mF(i){return YI(i)instanceof ShadowRoot}function ux(i){return mF(i)?YI(i):null}function gF(i){return i.replace(/-(.)/g,function(l,f){return f.toUpperCase()})}function _F(i,l){xu(i,"[@ant-design/icons] ".concat(l))}function bM(i){return li(i)==="object"&&typeof i.name=="string"&&typeof i.theme=="string"&&(li(i.icon)==="object"||typeof i.icon=="function")}function wM(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return Object.keys(i).reduce(function(l,f){var _=i[f];switch(f){case"class":l.className=_,delete l.class;break;default:delete l[f],l[gF(f)]=_}return l},{})}function xw(i,l,f){return f?Nn.createElement(i.tag,nn(nn({key:l},wM(i.attrs)),f),(i.children||[]).map(function(_,b){return xw(_,"".concat(l,"-").concat(i.tag,"-").concat(b))})):Nn.createElement(i.tag,nn({key:l},wM(i.attrs)),(i.children||[]).map(function(_,b){return xw(_,"".concat(l,"-").concat(i.tag,"-").concat(b))}))}function KI(i){return ey(i)[0]}function JI(i){return i?Array.isArray(i)?i:[i]:[]}var yF=`
.anticon {
  display: inline-flex;
  align-items: center;
  color: inherit;
  font-style: normal;
  line-height: 0;
  text-align: center;
  text-transform: none;
  vertical-align: -0.125em;
  text-rendering: optimizeLegibility;
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

.anticon > * {
  line-height: 1;
}

.anticon svg {
  display: inline-block;
}

.anticon::before {
  display: none;
}

.anticon .anticon-icon {
  display: block;
}

.anticon[tabindex] {
  cursor: pointer;
}

.anticon-spin::before,
.anticon-spin {
  display: inline-block;
  -webkit-animation: loadingCircle 1s infinite linear;
  animation: loadingCircle 1s infinite linear;
}

@-webkit-keyframes loadingCircle {
  100% {
    -webkit-transform: rotate(360deg);
    transform: rotate(360deg);
  }
}

@keyframes loadingCircle {
  100% {
    -webkit-transform: rotate(360deg);
    transform: rotate(360deg);
  }
}
`,vF=function(l){var f=se.useContext(FS),_=f.csp,b=f.prefixCls,z=yF;b&&(z=z.replace(/anticon/g,b)),se.useEffect(function(){var O=l.current,r=ux(O);gf(z,"@ant-design-icons",{prepend:!0,csp:_,attachTo:r})},[])},xF=["icon","className","onClick","style","primaryColor","secondaryColor"],$_={primaryColor:"#333",secondaryColor:"#E6E6E6",calculated:!1};function bF(i){var l=i.primaryColor,f=i.secondaryColor;$_.primaryColor=l,$_.secondaryColor=f||KI(l),$_.calculated=!!f}function wF(){return nn({},$_)}var Ig=function(l){var f=l.icon,_=l.className,b=l.onClick,z=l.style,O=l.primaryColor,r=l.secondaryColor,H=Ja(l,xF),Z=se.useRef(),K=$_;if(O&&(K={primaryColor:O,secondaryColor:r||KI(O)}),vF(Z),_F(bM(f),"icon should be icon definiton, but got ".concat(f)),!bM(f))return null;var te=f;return te&&typeof te.icon=="function"&&(te=nn(nn({},te),{},{icon:te.icon(K.primaryColor,K.secondaryColor)})),xw(te.icon,"svg-".concat(te.name),nn(nn({className:_,onClick:b,style:z,"data-icon":te.name,width:"1em",height:"1em",fill:"currentColor","aria-hidden":"true"},H),{},{ref:Z}))};Ig.displayName="IconReact";Ig.getTwoToneColors=wF;Ig.setTwoToneColors=bF;function QI(i){var l=JI(i),f=Gn(l,2),_=f[0],b=f[1];return Ig.setTwoToneColors({primaryColor:_,secondaryColor:b})}function SF(){var i=Ig.getTwoToneColors();return i.calculated?[i.primaryColor,i.secondaryColor]:i.primaryColor}var EF=["className","icon","spin","rotate","tabIndex","onClick","twoToneColor"];QI(lx.primary);var xp=se.forwardRef(function(i,l){var f=i.className,_=i.icon,b=i.spin,z=i.rotate,O=i.tabIndex,r=i.onClick,H=i.twoToneColor,Z=Ja(i,EF),K=se.useContext(FS),te=K.prefixCls,le=te===void 0?"anticon":te,Te=K.rootClassName,pe=sr(Te,le,jt(jt({},"".concat(le,"-").concat(_.name),!!_.name),"".concat(le,"-spin"),!!b||_.name==="loading"),f),ge=O;ge===void 0&&r&&(ge=-1);var fe=z?{msTransform:"rotate(".concat(z,"deg)"),transform:"rotate(".concat(z,"deg)")}:void 0,me=JI(H),_e=Gn(me,2),Ie=_e[0],Ne=_e[1];return se.createElement("span",$s({role:"img","aria-label":_.name},Z,{ref:l,tabIndex:ge,onClick:r,className:pe}),se.createElement(Ig,{icon:_,primaryColor:Ie,secondaryColor:Ne,style:fe}))});xp.displayName="AntdIcon";xp.getTwoToneColor=SF;xp.setTwoToneColor=QI;var TF={icon:{tag:"svg",attrs:{"fill-rule":"evenodd",viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M512 64c247.4 0 448 200.6 448 448S759.4 960 512 960 64 759.4 64 512 264.6 64 512 64zm127.98 274.82h-.04l-.08.06L512 466.75 384.14 338.88c-.04-.05-.06-.06-.08-.06a.12.12 0 00-.07 0c-.03 0-.05.01-.09.05l-45.02 45.02a.2.2 0 00-.05.09.12.12 0 000 .07v.02a.27.27 0 00.06.06L466.75 512 338.88 639.86c-.05.04-.06.06-.06.08a.12.12 0 000 .07c0 .03.01.05.05.09l45.02 45.02a.2.2 0 00.09.05.12.12 0 00.07 0c.02 0 .04-.01.08-.05L512 557.25l127.86 127.87c.04.04.06.05.08.05a.12.12 0 00.07 0c.03 0 .05-.01.09-.05l45.02-45.02a.2.2 0 00.05-.09.12.12 0 000-.07v-.02a.27.27 0 00-.05-.06L557.25 512l127.87-127.86c.04-.04.05-.06.05-.08a.12.12 0 000-.07c0-.03-.01-.05-.05-.09l-45.02-45.02a.2.2 0 00-.09-.05.12.12 0 00-.07 0z"}}]},name:"close-circle",theme:"filled"},CF=function(l,f){return se.createElement(xp,$s({},l,{ref:f,icon:TF}))},MF=se.forwardRef(CF),AF=`accept acceptCharset accessKey action allowFullScreen allowTransparency
    alt async autoComplete autoFocus autoPlay capture cellPadding cellSpacing challenge
    charSet checked classID className colSpan cols content contentEditable contextMenu
    controls coords crossOrigin data dateTime default defer dir disabled download draggable
    encType form formAction formEncType formMethod formNoValidate formTarget frameBorder
    headers height hidden high href hrefLang htmlFor httpEquiv icon id inputMode integrity
    is keyParams keyType kind label lang list loop low manifest marginHeight marginWidth max maxLength media
    mediaGroup method min minLength multiple muted name noValidate nonce open
    optimum pattern placeholder poster preload radioGroup readOnly rel required
    reversed role rowSpan rows sandbox scope scoped scrolling seamless selected
    shape size sizes span spellCheck src srcDoc srcLang srcSet start step style
    summary tabIndex target title type useMap value width wmode wrap`,IF=`onCopy onCut onPaste onCompositionEnd onCompositionStart onCompositionUpdate onKeyDown
    onKeyPress onKeyUp onFocus onBlur onChange onInput onSubmit onClick onContextMenu onDoubleClick
    onDrag onDragEnd onDragEnter onDragExit onDragLeave onDragOver onDragStart onDrop onMouseDown
    onMouseEnter onMouseLeave onMouseMove onMouseOut onMouseOver onMouseUp onSelect onTouchCancel
    onTouchEnd onTouchMove onTouchStart onScroll onWheel onAbort onCanPlay onCanPlayThrough
    onDurationChange onEmptied onEncrypted onEnded onError onLoadedData onLoadedMetadata
    onLoadStart onPause onPlay onPlaying onProgress onRateChange onSeeked onSeeking onStalled onSuspend onTimeUpdate onVolumeChange onWaiting onLoad onError`,PF="".concat(AF," ").concat(IF).split(/[\s\n]+/),RF="aria-",kF="data-";function SM(i,l){return i.indexOf(l)===0}function eP(i){var l=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1,f;l===!1?f={aria:!0,data:!0,attr:!0}:l===!0?f={aria:!0}:f=nn({},l);var _={};return Object.keys(i).forEach(function(b){(f.aria&&(b==="role"||SM(b,RF))||f.data&&SM(b,kF)||f.attr&&PF.includes(b))&&(_[b]=i[b])}),_}function tP(i){return i&&Nn.isValidElement(i)&&i.type===Nn.Fragment}const zF=(i,l,f)=>Nn.isValidElement(i)?Nn.cloneElement(i,typeof f=="function"?f(i.props||{}):f):l;function om(i,l){return zF(i,i,l)}const cm=i=>{const[,,,,l]=Sf();return l?`${i}-css-var`:""};var ei={MAC_ENTER:3,BACKSPACE:8,TAB:9,NUM_CENTER:12,ENTER:13,SHIFT:16,CTRL:17,ALT:18,PAUSE:19,CAPS_LOCK:20,ESC:27,SPACE:32,PAGE_UP:33,PAGE_DOWN:34,END:35,HOME:36,LEFT:37,UP:38,RIGHT:39,DOWN:40,PRINT_SCREEN:44,INSERT:45,DELETE:46,ZERO:48,ONE:49,TWO:50,THREE:51,FOUR:52,FIVE:53,SIX:54,SEVEN:55,EIGHT:56,NINE:57,QUESTION_MARK:63,A:65,B:66,C:67,D:68,E:69,F:70,G:71,H:72,I:73,J:74,K:75,L:76,M:77,N:78,O:79,P:80,Q:81,R:82,S:83,T:84,U:85,V:86,W:87,X:88,Y:89,Z:90,META:91,WIN_KEY_RIGHT:92,CONTEXT_MENU:93,NUM_ZERO:96,NUM_ONE:97,NUM_TWO:98,NUM_THREE:99,NUM_FOUR:100,NUM_FIVE:101,NUM_SIX:102,NUM_SEVEN:103,NUM_EIGHT:104,NUM_NINE:105,NUM_MULTIPLY:106,NUM_PLUS:107,NUM_MINUS:109,NUM_PERIOD:110,NUM_DIVISION:111,F1:112,F2:113,F3:114,F4:115,F5:116,F6:117,F7:118,F8:119,F9:120,F10:121,F11:122,F12:123,NUMLOCK:144,SEMICOLON:186,DASH:189,EQUALS:187,COMMA:188,PERIOD:190,SLASH:191,APOSTROPHE:192,SINGLE_QUOTE:222,OPEN_SQUARE_BRACKET:219,BACKSLASH:220,CLOSE_SQUARE_BRACKET:221,WIN_KEY:224,MAC_FF_META:224,WIN_IME:229,isTextModifyingKeyEvent:function(l){var f=l.keyCode;if(l.altKey&&!l.ctrlKey||l.metaKey||f>=ei.F1&&f<=ei.F12)return!1;switch(f){case ei.ALT:case ei.CAPS_LOCK:case ei.CONTEXT_MENU:case ei.CTRL:case ei.DOWN:case ei.END:case ei.ESC:case ei.HOME:case ei.INSERT:case ei.LEFT:case ei.MAC_FF_META:case ei.META:case ei.NUMLOCK:case ei.NUM_CENTER:case ei.PAGE_DOWN:case ei.PAGE_UP:case ei.PAUSE:case ei.PRINT_SCREEN:case ei.RIGHT:case ei.SHIFT:case ei.UP:case ei.WIN_KEY:case ei.WIN_KEY_RIGHT:return!1;default:return!0}},isCharacterKey:function(l){if(l>=ei.ZERO&&l<=ei.NINE||l>=ei.NUM_ZERO&&l<=ei.NUM_MULTIPLY||l>=ei.A&&l<=ei.Z||window.navigator.userAgent.indexOf("WebKit")!==-1&&l===0)return!0;switch(l){case ei.SPACE:case ei.QUESTION_MARK:case ei.NUM_PLUS:case ei.NUM_MINUS:case ei.NUM_PERIOD:case ei.NUM_DIVISION:case ei.SEMICOLON:case ei.DASH:case ei.EQUALS:case ei.COMMA:case ei.PERIOD:case ei.SLASH:case ei.APOSTROPHE:case ei.SINGLE_QUOTE:case ei.OPEN_SQUARE_BRACKET:case ei.BACKSLASH:case ei.CLOSE_SQUARE_BRACKET:return!0;default:return!1}}},LF={icon:{tag:"svg",attrs:{viewBox:"0 0 1024 1024",focusable:"false"},children:[{tag:"path",attrs:{d:"M988 548c-19.9 0-36-16.1-36-36 0-59.4-11.6-117-34.6-171.3a440.45 440.45 0 00-94.3-139.9 437.71 437.71 0 00-139.9-94.3C629 83.6 571.4 72 512 72c-19.9 0-36-16.1-36-36s16.1-36 36-36c69.1 0 136.2 13.5 199.3 40.3C772.3 66 827 103 874 150c47 47 83.9 101.8 109.7 162.7 26.7 63.1 40.2 130.2 40.2 199.3.1 19.9-16 36-35.9 36z"}}]},name:"loading",theme:"outlined"},OF=function(l,f){return se.createElement(xp,$s({},l,{ref:f,icon:LF}))},nP=se.forwardRef(OF);const rP=Nn.createContext(void 0),qp=100,iP={Modal:qp,Drawer:qp,Popover:qp,Popconfirm:qp,Tooltip:qp,Tour:qp,FloatButton:qp},DF={SelectLike:50,Dropdown:50,DatePicker:50,Menu:50,ImagePreview:1};function FF(i){return i in iP}const BF=(i,l)=>{const[,f]=Sf(),_=Nn.useContext(rP),b=FF(i);let z;if(l!==void 0)z=[l,l];else{let O=_??0;b?O+=(_?0:f.zIndexPopupBase)+iP[i]:O+=DF[i],z=[_===void 0?l:O,O]}return z};function gc(){gc=function(){return l};var i,l={},f=Object.prototype,_=f.hasOwnProperty,b=Object.defineProperty||function(xt,gt,ht){xt[gt]=ht.value},z=typeof Symbol=="function"?Symbol:{},O=z.iterator||"@@iterator",r=z.asyncIterator||"@@asyncIterator",H=z.toStringTag||"@@toStringTag";function Z(xt,gt,ht){return Object.defineProperty(xt,gt,{value:ht,enumerable:!0,configurable:!0,writable:!0}),xt[gt]}try{Z({},"")}catch{Z=function(ht,vt,Ve){return ht[vt]=Ve}}function K(xt,gt,ht,vt){var Ve=gt&&gt.prototype instanceof me?gt:me,je=Object.create(Ve.prototype),it=new Nt(vt||[]);return b(je,"_invoke",{value:Qe(xt,ht,it)}),je}function te(xt,gt,ht){try{return{type:"normal",arg:xt.call(gt,ht)}}catch(vt){return{type:"throw",arg:vt}}}l.wrap=K;var le="suspendedStart",Te="suspendedYield",pe="executing",ge="completed",fe={};function me(){}function _e(){}function Ie(){}var Ne={};Z(Ne,O,function(){return this});var nt=Object.getPrototypeOf,Le=nt&&nt(nt(At([])));Le&&Le!==f&&_.call(Le,O)&&(Ne=Le);var Pe=Ie.prototype=me.prototype=Object.create(Ne);function rt(xt){["next","throw","return"].forEach(function(gt){Z(xt,gt,function(ht){return this._invoke(gt,ht)})})}function at(xt,gt){function ht(Ve,je,it,Mt){var Ot=te(xt[Ve],xt,je);if(Ot.type!=="throw"){var sn=Ot.arg,hn=sn.value;return hn&&li(hn)=="object"&&_.call(hn,"__await")?gt.resolve(hn.__await).then(function(Tn){ht("next",Tn,it,Mt)},function(Tn){ht("throw",Tn,it,Mt)}):gt.resolve(hn).then(function(Tn){sn.value=Tn,it(sn)},function(Tn){return ht("throw",Tn,it,Mt)})}Mt(Ot.arg)}var vt;b(this,"_invoke",{value:function(je,it){function Mt(){return new gt(function(Ot,sn){ht(je,it,Ot,sn)})}return vt=vt?vt.then(Mt,Mt):Mt()}})}function Qe(xt,gt,ht){var vt=le;return function(Ve,je){if(vt===pe)throw Error("Generator is already running");if(vt===ge){if(Ve==="throw")throw je;return{value:i,done:!0}}for(ht.method=Ve,ht.arg=je;;){var it=ht.delegate;if(it){var Mt=lt(it,ht);if(Mt){if(Mt===fe)continue;return Mt}}if(ht.method==="next")ht.sent=ht._sent=ht.arg;else if(ht.method==="throw"){if(vt===le)throw vt=ge,ht.arg;ht.dispatchException(ht.arg)}else ht.method==="return"&&ht.abrupt("return",ht.arg);vt=pe;var Ot=te(xt,gt,ht);if(Ot.type==="normal"){if(vt=ht.done?ge:Te,Ot.arg===fe)continue;return{value:Ot.arg,done:ht.done}}Ot.type==="throw"&&(vt=ge,ht.method="throw",ht.arg=Ot.arg)}}}function lt(xt,gt){var ht=gt.method,vt=xt.iterator[ht];if(vt===i)return gt.delegate=null,ht==="throw"&&xt.iterator.return&&(gt.method="return",gt.arg=i,lt(xt,gt),gt.method==="throw")||ht!=="return"&&(gt.method="throw",gt.arg=new TypeError("The iterator does not provide a '"+ht+"' method")),fe;var Ve=te(vt,xt.iterator,gt.arg);if(Ve.type==="throw")return gt.method="throw",gt.arg=Ve.arg,gt.delegate=null,fe;var je=Ve.arg;return je?je.done?(gt[xt.resultName]=je.value,gt.next=xt.nextLoc,gt.method!=="return"&&(gt.method="next",gt.arg=i),gt.delegate=null,fe):je:(gt.method="throw",gt.arg=new TypeError("iterator result is not an object"),gt.delegate=null,fe)}function Ct(xt){var gt={tryLoc:xt[0]};1 in xt&&(gt.catchLoc=xt[1]),2 in xt&&(gt.finallyLoc=xt[2],gt.afterLoc=xt[3]),this.tryEntries.push(gt)}function Rt(xt){var gt=xt.completion||{};gt.type="normal",delete gt.arg,xt.completion=gt}function Nt(xt){this.tryEntries=[{tryLoc:"root"}],xt.forEach(Ct,this),this.reset(!0)}function At(xt){if(xt||xt===""){var gt=xt[O];if(gt)return gt.call(xt);if(typeof xt.next=="function")return xt;if(!isNaN(xt.length)){var ht=-1,vt=function Ve(){for(;++ht<xt.length;)if(_.call(xt,ht))return Ve.value=xt[ht],Ve.done=!1,Ve;return Ve.value=i,Ve.done=!0,Ve};return vt.next=vt}}throw new TypeError(li(xt)+" is not iterable")}return _e.prototype=Ie,b(Pe,"constructor",{value:Ie,configurable:!0}),b(Ie,"constructor",{value:_e,configurable:!0}),_e.displayName=Z(Ie,H,"GeneratorFunction"),l.isGeneratorFunction=function(xt){var gt=typeof xt=="function"&&xt.constructor;return!!gt&&(gt===_e||(gt.displayName||gt.name)==="GeneratorFunction")},l.mark=function(xt){return Object.setPrototypeOf?Object.setPrototypeOf(xt,Ie):(xt.__proto__=Ie,Z(xt,H,"GeneratorFunction")),xt.prototype=Object.create(Pe),xt},l.awrap=function(xt){return{__await:xt}},rt(at.prototype),Z(at.prototype,r,function(){return this}),l.AsyncIterator=at,l.async=function(xt,gt,ht,vt,Ve){Ve===void 0&&(Ve=Promise);var je=new at(K(xt,gt,ht,vt),Ve);return l.isGeneratorFunction(gt)?je:je.next().then(function(it){return it.done?it.value:je.next()})},rt(Pe),Z(Pe,H,"Generator"),Z(Pe,O,function(){return this}),Z(Pe,"toString",function(){return"[object Generator]"}),l.keys=function(xt){var gt=Object(xt),ht=[];for(var vt in gt)ht.push(vt);return ht.reverse(),function Ve(){for(;ht.length;){var je=ht.pop();if(je in gt)return Ve.value=je,Ve.done=!1,Ve}return Ve.done=!0,Ve}},l.values=At,Nt.prototype={constructor:Nt,reset:function(gt){if(this.prev=0,this.next=0,this.sent=this._sent=i,this.done=!1,this.delegate=null,this.method="next",this.arg=i,this.tryEntries.forEach(Rt),!gt)for(var ht in this)ht.charAt(0)==="t"&&_.call(this,ht)&&!isNaN(+ht.slice(1))&&(this[ht]=i)},stop:function(){this.done=!0;var gt=this.tryEntries[0].completion;if(gt.type==="throw")throw gt.arg;return this.rval},dispatchException:function(gt){if(this.done)throw gt;var ht=this;function vt(sn,hn){return it.type="throw",it.arg=gt,ht.next=sn,hn&&(ht.method="next",ht.arg=i),!!hn}for(var Ve=this.tryEntries.length-1;Ve>=0;--Ve){var je=this.tryEntries[Ve],it=je.completion;if(je.tryLoc==="root")return vt("end");if(je.tryLoc<=this.prev){var Mt=_.call(je,"catchLoc"),Ot=_.call(je,"finallyLoc");if(Mt&&Ot){if(this.prev<je.catchLoc)return vt(je.catchLoc,!0);if(this.prev<je.finallyLoc)return vt(je.finallyLoc)}else if(Mt){if(this.prev<je.catchLoc)return vt(je.catchLoc,!0)}else{if(!Ot)throw Error("try statement without catch or finally");if(this.prev<je.finallyLoc)return vt(je.finallyLoc)}}}},abrupt:function(gt,ht){for(var vt=this.tryEntries.length-1;vt>=0;--vt){var Ve=this.tryEntries[vt];if(Ve.tryLoc<=this.prev&&_.call(Ve,"finallyLoc")&&this.prev<Ve.finallyLoc){var je=Ve;break}}je&&(gt==="break"||gt==="continue")&&je.tryLoc<=ht&&ht<=je.finallyLoc&&(je=null);var it=je?je.completion:{};return it.type=gt,it.arg=ht,je?(this.method="next",this.next=je.finallyLoc,fe):this.complete(it)},complete:function(gt,ht){if(gt.type==="throw")throw gt.arg;return gt.type==="break"||gt.type==="continue"?this.next=gt.arg:gt.type==="return"?(this.rval=this.arg=gt.arg,this.method="return",this.next="end"):gt.type==="normal"&&ht&&(this.next=ht),fe},finish:function(gt){for(var ht=this.tryEntries.length-1;ht>=0;--ht){var vt=this.tryEntries[ht];if(vt.finallyLoc===gt)return this.complete(vt.completion,vt.afterLoc),Rt(vt),fe}},catch:function(gt){for(var ht=this.tryEntries.length-1;ht>=0;--ht){var vt=this.tryEntries[ht];if(vt.tryLoc===gt){var Ve=vt.completion;if(Ve.type==="throw"){var je=Ve.arg;Rt(vt)}return je}}throw Error("illegal catch attempt")},delegateYield:function(gt,ht,vt){return this.delegate={iterator:At(gt),resultName:ht,nextLoc:vt},this.method==="next"&&(this.arg=i),fe}},l}function EM(i,l,f,_,b,z,O){try{var r=i[z](O),H=r.value}catch(Z){return void f(Z)}r.done?l(H):Promise.resolve(H).then(_,b)}function um(i){return function(){var l=this,f=arguments;return new Promise(function(_,b){var z=i.apply(l,f);function O(H){EM(z,_,b,O,r,"next",H)}function r(H){EM(z,_,b,O,r,"throw",H)}O(void 0)})}}var uy=nn({},Yz),NF=uy.version,S1=uy.render,jF=uy.unmountComponentAtNode,zx;try{var $F=Number((NF||"").split(".")[0]);$F>=18&&(zx=uy.createRoot)}catch{}function TM(i){var l=uy.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED;l&&li(l)==="object"&&(l.usingClientEntryPoint=i)}var hx="__rc_react_root__";function VF(i,l){TM(!0);var f=l[hx]||zx(l);TM(!1),f.render(i),l[hx]=f}function UF(i,l){S1==null||S1(i,l)}function HF(i,l){if(zx){VF(i,l);return}UF(i,l)}function WF(i){return bw.apply(this,arguments)}function bw(){return bw=um(gc().mark(function i(l){return gc().wrap(function(_){for(;;)switch(_.prev=_.next){case 0:return _.abrupt("return",Promise.resolve().then(function(){var b;(b=l[hx])===null||b===void 0||b.unmount(),delete l[hx]}));case 1:case"end":return _.stop()}},i)})),bw.apply(this,arguments)}function GF(i){jF(i)}function qF(i){return ww.apply(this,arguments)}function ww(){return ww=um(gc().mark(function i(l){return gc().wrap(function(_){for(;;)switch(_.prev=_.next){case 0:if(zx===void 0){_.next=2;break}return _.abrupt("return",WF(l));case 2:GF(l);case 3:case"end":return _.stop()}},i)})),ww.apply(this,arguments)}const ZF=(i,l)=>(HF(i,l),()=>qF(l));let XF=ZF;function YF(){return XF}const oP=(i,l,f)=>f!==void 0?f:`${i}-${l}`,sP=function(i){if(!i)return!1;if(i instanceof Element){if(i.offsetParent)return!0;if(i.getBBox){var l=i.getBBox(),f=l.width,_=l.height;if(f||_)return!0}if(i.getBoundingClientRect){var b=i.getBoundingClientRect(),z=b.width,O=b.height;if(z||O)return!0}}return!1},KF=i=>{const{componentCls:l,colorPrimary:f}=i;return{[l]:{position:"absolute",background:"transparent",pointerEvents:"none",boxSizing:"border-box",color:`var(--wave-color, ${f})`,boxShadow:"0 0 0 0 currentcolor",opacity:.2,"&.wave-motion-appear":{transition:[`box-shadow 0.4s ${i.motionEaseOutCirc}`,`opacity 2s ${i.motionEaseOutCirc}`].join(","),"&-active":{boxShadow:"0 0 0 6px currentcolor",opacity:0},"&.wave-quick":{transition:[`box-shadow ${i.motionDurationSlow} ${i.motionEaseInOut}`,`opacity ${i.motionDurationSlow} ${i.motionEaseInOut}`].join(",")}}}}},JF=kD("Wave",i=>[KF(i)]),$S=`${cx}-wave-target`;function E1(i){return i&&i!=="#fff"&&i!=="#ffffff"&&i!=="rgb(255, 255, 255)"&&i!=="rgba(255, 255, 255, 1)"&&!/rgba\((?:\d*, ){3}0\)/.test(i)&&i!=="transparent"}function QF(i){const{borderTopColor:l,borderColor:f,backgroundColor:_}=getComputedStyle(i);return E1(l)?l:E1(f)?f:E1(_)?_:null}function T1(i){return Number.isNaN(i)?0:i}const e4=i=>{const{className:l,target:f,component:_,registerUnmount:b}=i,z=se.useRef(null),O=se.useRef(null);se.useEffect(()=>{O.current=b()},[]);const[r,H]=se.useState(null),[Z,K]=se.useState([]),[te,le]=se.useState(0),[Te,pe]=se.useState(0),[ge,fe]=se.useState(0),[me,_e]=se.useState(0),[Ie,Ne]=se.useState(!1),nt={left:te,top:Te,width:ge,height:me,borderRadius:Z.map(rt=>`${rt}px`).join(" ")};r&&(nt["--wave-color"]=r);function Le(){const rt=getComputedStyle(f);H(QF(f));const at=rt.position==="static",{borderLeftWidth:Qe,borderTopWidth:lt}=rt;le(at?f.offsetLeft:T1(-parseFloat(Qe))),pe(at?f.offsetTop:T1(-parseFloat(lt))),fe(f.offsetWidth),_e(f.offsetHeight);const{borderTopLeftRadius:Ct,borderTopRightRadius:Rt,borderBottomLeftRadius:Nt,borderBottomRightRadius:At}=rt;K([Ct,Rt,At,Nt].map(xt=>T1(parseFloat(xt))))}if(se.useEffect(()=>{if(f){const rt=qu(()=>{Le(),Ne(!0)});let at;return typeof ResizeObserver<"u"&&(at=new ResizeObserver(Le),at.observe(f)),()=>{qu.cancel(rt),at==null||at.disconnect()}}},[]),!Ie)return null;const Pe=(_==="Checkbox"||_==="Radio")&&(f==null?void 0:f.classList.contains($S));return se.createElement(ly,{visible:!0,motionAppear:!0,motionName:"wave-motion",motionDeadline:5e3,onAppearEnd:(rt,at)=>{var Qe,lt;if(at.deadline||at.propertyName==="opacity"){const Ct=(Qe=z.current)===null||Qe===void 0?void 0:Qe.parentElement;(lt=O.current)===null||lt===void 0||lt.call(O).then(()=>{Ct==null||Ct.remove()})}return!1}},(rt,at)=>{let{className:Qe}=rt;return se.createElement("div",{ref:bf(z,at),className:sr(l,Qe,{"wave-quick":Pe}),style:nt})})},t4=(i,l)=>{var f;const{component:_}=l;if(_==="Checkbox"&&!(!((f=i.querySelector("input"))===null||f===void 0)&&f.checked))return;const b=document.createElement("div");b.style.position="absolute",b.style.left="0px",b.style.top="0px",i==null||i.insertBefore(b,i==null?void 0:i.firstChild);const z=YF();let O=null;function r(){return O}O=z(se.createElement(e4,Object.assign({},l,{target:i,registerUnmount:r})),b)},n4=(i,l,f)=>{const{wave:_}=se.useContext(Xo),[,b,z]=Sf(),O=mc(Z=>{const K=i.current;if(_!=null&&_.disabled||!K)return;const te=K.querySelector(`.${$S}`)||K,{showEffect:le}=_||{};(le||t4)(te,{className:l,token:b,component:f,event:Z,hashId:z})}),r=se.useRef(null);return Z=>{qu.cancel(r.current),r.current=qu(()=>{O(Z)})}},VS=i=>{const{children:l,disabled:f,component:_}=i,{getPrefixCls:b}=se.useContext(Xo),z=se.useRef(null),O=b("wave"),[,r]=JF(O),H=n4(z,sr(O,r),_);if(Nn.useEffect(()=>{const K=z.current;if(!K||K.nodeType!==1||f)return;const te=le=>{!sP(le.target)||!K.getAttribute||K.getAttribute("disabled")||K.disabled||K.className.includes("disabled")||K.className.includes("-leave")||H(le)};return K.addEventListener("click",te,!0),()=>{K.removeEventListener("click",te,!0)}},[f]),!Nn.isValidElement(l))return l??null;const Z=sy(l)?bf(Cx(l),z):z;return om(l,{ref:Z})},bp=i=>{const l=Nn.useContext(Sg);return Nn.useMemo(()=>i?typeof i=="string"?i??l:i instanceof Function?i(l):l:l,[i,l])},aP=se.createContext(null),US=(i,l)=>{const f=se.useContext(aP),_=se.useMemo(()=>{if(!f)return"";const{compactDirection:b,isFirstItem:z,isLastItem:O}=f,r=b==="vertical"?"-vertical-":"-";return sr(`${i}-compact${r}item`,{[`${i}-compact${r}first-item`]:z,[`${i}-compact${r}last-item`]:O,[`${i}-compact${r}item-rtl`]:l==="rtl"})},[i,l,f]);return{compactSize:f==null?void 0:f.compactSize,compactDirection:f==null?void 0:f.compactDirection,compactItemClassnames:_}},r4=i=>{let{children:l}=i;return se.createElement(aP.Provider,{value:null},l)};var i4=function(i,l){var f={};for(var _ in i)Object.prototype.hasOwnProperty.call(i,_)&&l.indexOf(_)<0&&(f[_]=i[_]);if(i!=null&&typeof Object.getOwnPropertySymbols=="function")for(var b=0,_=Object.getOwnPropertySymbols(i);b<_.length;b++)l.indexOf(_[b])<0&&Object.prototype.propertyIsEnumerable.call(i,_[b])&&(f[_[b]]=i[_[b]]);return f};const lP=se.createContext(void 0),o4=i=>{const{getPrefixCls:l,direction:f}=se.useContext(Xo),{prefixCls:_,size:b,className:z}=i,O=i4(i,["prefixCls","size","className"]),r=l("btn-group",_),[,,H]=Sf();let Z="";switch(b){case"large":Z="lg";break;case"small":Z="sm";break}const K=sr(r,{[`${r}-${Z}`]:Z,[`${r}-rtl`]:f==="rtl"},z,H);return se.createElement(lP.Provider,{value:b},se.createElement("div",Object.assign({},O,{className:K})))},CM=/^[\u4E00-\u9FA5]{2}$/,Sw=CM.test.bind(CM);function MM(i){return typeof i=="string"}function C1(i){return i==="text"||i==="link"}function s4(i,l){if(i==null)return;const f=l?" ":"";return typeof i!="string"&&typeof i!="number"&&MM(i.type)&&Sw(i.props.children)?om(i,{children:i.props.children.split("").join(f)}):MM(i)?Sw(i)?Nn.createElement("span",null,i.split("").join(f)):Nn.createElement("span",null,i):tP(i)?Nn.createElement("span",null,i):i}function a4(i,l){let f=!1;const _=[];return Nn.Children.forEach(i,b=>{const z=typeof b,O=z==="string"||z==="number";if(f&&O){const r=_.length-1,H=_[r];_[r]=`${H}${b}`}else _.push(b);f=O}),Nn.Children.map(_,b=>s4(b,l))}["default","primary","danger"].concat(Xr(im));const Ew=se.forwardRef((i,l)=>{const{className:f,style:_,children:b,prefixCls:z}=i,O=sr(`${z}-icon`,f);return Nn.createElement("span",{ref:l,className:O,style:_},b)}),AM=se.forwardRef((i,l)=>{const{prefixCls:f,className:_,style:b,iconClassName:z}=i,O=sr(`${f}-loading-icon`,_);return Nn.createElement(Ew,{prefixCls:f,className:O,style:b,ref:l},Nn.createElement(nP,{className:z}))}),M1=()=>({width:0,opacity:0,transform:"scale(0)"}),A1=i=>({width:i.scrollWidth,opacity:1,transform:"scale(1)"}),l4=i=>{const{prefixCls:l,loading:f,existIcon:_,className:b,style:z,mount:O}=i,r=!!f;return _?Nn.createElement(AM,{prefixCls:l,className:b,style:z}):Nn.createElement(ly,{visible:r,motionName:`${l}-loading-icon-motion`,motionAppear:!O,motionEnter:!O,motionLeave:!O,removeOnLeave:!0,onAppearStart:M1,onAppearActive:A1,onEnterStart:M1,onEnterActive:A1,onLeaveStart:A1,onLeaveActive:M1},(H,Z)=>{let{className:K,style:te}=H;const le=Object.assign(Object.assign({},z),te);return Nn.createElement(AM,{prefixCls:l,className:sr(b,K),style:le,ref:Z})})},IM=(i,l)=>({[`> span, > ${i}`]:{"&:not(:last-child)":{[`&, & > ${i}`]:{"&:not(:disabled)":{borderInlineEndColor:l}}},"&:not(:first-child)":{[`&, & > ${i}`]:{"&:not(:disabled)":{borderInlineStartColor:l}}}}}),c4=i=>{const{componentCls:l,fontSize:f,lineWidth:_,groupBorderColor:b,colorErrorHover:z}=i;return{[`${l}-group`]:[{position:"relative",display:"inline-flex",[`> span, > ${l}`]:{"&:not(:last-child)":{[`&, & > ${l}`]:{borderStartEndRadius:0,borderEndEndRadius:0}},"&:not(:first-child)":{marginInlineStart:i.calc(_).mul(-1).equal(),[`&, & > ${l}`]:{borderStartStartRadius:0,borderEndStartRadius:0}}},[l]:{position:"relative",zIndex:1,"&:hover, &:focus, &:active":{zIndex:2},"&[disabled]":{zIndex:0}},[`${l}-icon-only`]:{fontSize:f}},IM(`${l}-primary`,b),IM(`${l}-danger`,z)]}};var u4=["b"],h4=["v"],I1=function(l){return Math.round(Number(l||0))},d4=function(l){if(l instanceof ks)return l;if(l&&li(l)==="object"&&"h"in l&&"b"in l){var f=l,_=f.b,b=Ja(f,u4);return nn(nn({},b),{},{v:_})}return typeof l=="string"&&/hsb/.test(l)?l.replace(/hsb/,"hsv"):l},ry=function(i){yp(f,i);var l=vp(f);function f(_){return Qa(this,f),l.call(this,d4(_))}return el(f,[{key:"toHsbString",value:function(){var b=this.toHsb(),z=I1(b.s*100),O=I1(b.b*100),r=I1(b.h),H=b.a,Z="hsb(".concat(r,", ").concat(z,"%, ").concat(O,"%)"),K="hsba(".concat(r,", ").concat(z,"%, ").concat(O,"%, ").concat(H.toFixed(H===0?0:2),")");return H===1?Z:K}},{key:"toHsb",value:function(){var b=this.toHsv(),z=b.v,O=Ja(b,h4);return nn(nn({},O),{},{b:z,a:this.a})}}]),f}(ks),f4=function(l){return l instanceof ry?l:new ry(l)};f4("#1677ff");const p4=(i,l)=>(i==null?void 0:i.replace(/[^\w/]/g,"").slice(0,l?8:6))||"",m4=(i,l)=>i?p4(i,l):"";let g4=function(){function i(l){Qa(this,i);var f;if(this.cleared=!1,l instanceof i){this.metaColor=l.metaColor.clone(),this.colors=(f=l.colors)===null||f===void 0?void 0:f.map(b=>({color:new i(b.color),percent:b.percent})),this.cleared=l.cleared;return}const _=Array.isArray(l);_&&l.length?(this.colors=l.map(b=>{let{color:z,percent:O}=b;return{color:new i(z),percent:O}}),this.metaColor=new ry(this.colors[0].color.metaColor)):this.metaColor=new ry(_?"":l),(!l||_&&!this.colors)&&(this.metaColor=this.metaColor.setA(0),this.cleared=!0)}return el(i,[{key:"toHsb",value:function(){return this.metaColor.toHsb()}},{key:"toHsbString",value:function(){return this.metaColor.toHsbString()}},{key:"toHex",value:function(){return m4(this.toHexString(),this.metaColor.a<1)}},{key:"toHexString",value:function(){return this.metaColor.toHexString()}},{key:"toRgb",value:function(){return this.metaColor.toRgb()}},{key:"toRgbString",value:function(){return this.metaColor.toRgbString()}},{key:"isGradient",value:function(){return!!this.colors&&!this.cleared}},{key:"getColors",value:function(){return this.colors||[{color:this,percent:0}]}},{key:"toCssString",value:function(){const{colors:f}=this;return f?`linear-gradient(90deg, ${f.map(b=>`${b.color.toRgbString()} ${b.percent}%`).join(", ")})`:this.metaColor.toRgbString()}},{key:"equals",value:function(f){return!f||this.isGradient()!==f.isGradient()?!1:this.isGradient()?this.colors.length===f.colors.length&&this.colors.every((_,b)=>{const z=f.colors[b];return _.percent===z.percent&&_.color.equals(z.color)}):this.toHexString()===f.toHexString()}}])}();const _4=i=>({animationDuration:i,animationFillMode:"both"}),y4=i=>({animationDuration:i,animationFillMode:"both"}),v4=function(i,l,f,_){const z=(arguments.length>4&&arguments[4]!==void 0?arguments[4]:!1)?"&":"";return{[`
      ${z}${i}-enter,
      ${z}${i}-appear
    `]:Object.assign(Object.assign({},_4(_)),{animationPlayState:"paused"}),[`${z}${i}-leave`]:Object.assign(Object.assign({},y4(_)),{animationPlayState:"paused"}),[`
      ${z}${i}-enter${i}-enter-active,
      ${z}${i}-appear${i}-appear-active
    `]:{animationName:l,animationPlayState:"running"},[`${z}${i}-leave${i}-leave-active`]:{animationName:f,animationPlayState:"running",pointerEvents:"none"}}},x4=new Yu("antZoomIn",{"0%":{transform:"scale(0.2)",opacity:0},"100%":{transform:"scale(1)",opacity:1}}),b4=new Yu("antZoomOut",{"0%":{transform:"scale(1)"},"100%":{transform:"scale(0.2)",opacity:0}}),PM=new Yu("antZoomBigIn",{"0%":{transform:"scale(0.8)",opacity:0},"100%":{transform:"scale(1)",opacity:1}}),RM=new Yu("antZoomBigOut",{"0%":{transform:"scale(1)"},"100%":{transform:"scale(0.8)",opacity:0}}),w4=new Yu("antZoomUpIn",{"0%":{transform:"scale(0.8)",transformOrigin:"50% 0%",opacity:0},"100%":{transform:"scale(1)",transformOrigin:"50% 0%"}}),S4=new Yu("antZoomUpOut",{"0%":{transform:"scale(1)",transformOrigin:"50% 0%"},"100%":{transform:"scale(0.8)",transformOrigin:"50% 0%",opacity:0}}),E4=new Yu("antZoomLeftIn",{"0%":{transform:"scale(0.8)",transformOrigin:"0% 50%",opacity:0},"100%":{transform:"scale(1)",transformOrigin:"0% 50%"}}),T4=new Yu("antZoomLeftOut",{"0%":{transform:"scale(1)",transformOrigin:"0% 50%"},"100%":{transform:"scale(0.8)",transformOrigin:"0% 50%",opacity:0}}),C4=new Yu("antZoomRightIn",{"0%":{transform:"scale(0.8)",transformOrigin:"100% 50%",opacity:0},"100%":{transform:"scale(1)",transformOrigin:"100% 50%"}}),M4=new Yu("antZoomRightOut",{"0%":{transform:"scale(1)",transformOrigin:"100% 50%"},"100%":{transform:"scale(0.8)",transformOrigin:"100% 50%",opacity:0}}),A4=new Yu("antZoomDownIn",{"0%":{transform:"scale(0.8)",transformOrigin:"50% 100%",opacity:0},"100%":{transform:"scale(1)",transformOrigin:"50% 100%"}}),I4=new Yu("antZoomDownOut",{"0%":{transform:"scale(1)",transformOrigin:"50% 100%"},"100%":{transform:"scale(0.8)",transformOrigin:"50% 100%",opacity:0}}),P4={zoom:{inKeyframes:x4,outKeyframes:b4},"zoom-big":{inKeyframes:PM,outKeyframes:RM},"zoom-big-fast":{inKeyframes:PM,outKeyframes:RM},"zoom-left":{inKeyframes:E4,outKeyframes:T4},"zoom-right":{inKeyframes:C4,outKeyframes:M4},"zoom-up":{inKeyframes:w4,outKeyframes:S4},"zoom-down":{inKeyframes:A4,outKeyframes:I4}},cP=(i,l)=>{const{antCls:f}=i,_=`${f}-${l}`,{inKeyframes:b,outKeyframes:z}=P4[l];return[v4(_,b,z,l==="zoom-big-fast"?i.motionDurationFast:i.motionDurationMid),{[`
        ${_}-enter,
        ${_}-appear
      `]:{transform:"scale(0)",opacity:0,animationTimingFunction:i.motionEaseOutCirc,"&-prepare":{transform:"none"}},[`${_}-leave`]:{animationTimingFunction:i.motionEaseInOutCirc}}]},R4=(i,l)=>{const{r:f,g:_,b,a:z}=i.toRgb(),O=new ry(i.toRgbString()).onBackground(l).toHsv();return z<=.5?O.v>.5:f*.299+_*.587+b*.114>192},uP=i=>{const{paddingInline:l,onlyIconSize:f}=i;return Ml(i,{buttonPaddingHorizontal:l,buttonPaddingVertical:0,buttonIconOnlyFontSize:f})},hP=i=>{var l,f,_,b,z,O;const r=(l=i.contentFontSize)!==null&&l!==void 0?l:i.fontSize,H=(f=i.contentFontSizeSM)!==null&&f!==void 0?f:i.fontSize,Z=(_=i.contentFontSizeLG)!==null&&_!==void 0?_:i.fontSizeLG,K=(b=i.contentLineHeight)!==null&&b!==void 0?b:Iv(r),te=(z=i.contentLineHeightSM)!==null&&z!==void 0?z:Iv(H),le=(O=i.contentLineHeightLG)!==null&&O!==void 0?O:Iv(Z),Te=R4(new g4(i.colorBgSolid),"#fff")?"#000":"#fff";return{fontWeight:400,defaultShadow:`0 ${i.controlOutlineWidth}px 0 ${i.controlTmpOutline}`,primaryShadow:`0 ${i.controlOutlineWidth}px 0 ${i.controlOutline}`,dangerShadow:`0 ${i.controlOutlineWidth}px 0 ${i.colorErrorOutline}`,primaryColor:i.colorTextLightSolid,dangerColor:i.colorTextLightSolid,borderColorDisabled:i.colorBorder,defaultGhostColor:i.colorBgContainer,ghostBg:"transparent",defaultGhostBorderColor:i.colorBgContainer,paddingInline:i.paddingContentHorizontal-i.lineWidth,paddingInlineLG:i.paddingContentHorizontal-i.lineWidth,paddingInlineSM:8-i.lineWidth,onlyIconSize:i.fontSizeLG,onlyIconSizeSM:i.fontSizeLG-2,onlyIconSizeLG:i.fontSizeLG+2,groupBorderColor:i.colorPrimaryHover,linkHoverBg:"transparent",textTextColor:i.colorText,textTextHoverColor:i.colorText,textTextActiveColor:i.colorText,textHoverBg:i.colorFillTertiary,defaultColor:i.colorText,defaultBg:i.colorBgContainer,defaultBorderColor:i.colorBorder,defaultBorderColorDisabled:i.colorBorder,defaultHoverBg:i.colorBgContainer,defaultHoverColor:i.colorPrimaryHover,defaultHoverBorderColor:i.colorPrimaryHover,defaultActiveBg:i.colorBgContainer,defaultActiveColor:i.colorPrimaryActive,defaultActiveBorderColor:i.colorPrimaryActive,solidTextColor:Te,contentFontSize:r,contentFontSizeSM:H,contentFontSizeLG:Z,contentLineHeight:K,contentLineHeightSM:te,contentLineHeightLG:le,paddingBlock:Math.max((i.controlHeight-r*K)/2-i.lineWidth,0),paddingBlockSM:Math.max((i.controlHeightSM-H*te)/2-i.lineWidth,0),paddingBlockLG:Math.max((i.controlHeightLG-Z*le)/2-i.lineWidth,0)}},k4=i=>{const{componentCls:l,iconCls:f,fontWeight:_,opacityLoading:b,motionDurationSlow:z,motionEaseInOut:O,marginXS:r,calc:H}=i;return{[l]:{outline:"none",position:"relative",display:"inline-flex",gap:i.marginXS,alignItems:"center",justifyContent:"center",fontWeight:_,whiteSpace:"nowrap",textAlign:"center",backgroundImage:"none",background:"transparent",border:`${Ur(i.lineWidth)} ${i.lineType} transparent`,cursor:"pointer",transition:`all ${i.motionDurationMid} ${i.motionEaseInOut}`,userSelect:"none",touchAction:"manipulation",color:i.colorText,"&:disabled > *":{pointerEvents:"none"},[`${l}-icon > svg`]:DI(),"> a":{color:"currentColor"},"&:not(:disabled)":FI(i),[`&${l}-two-chinese-chars::first-letter`]:{letterSpacing:"0.34em"},[`&${l}-two-chinese-chars > *:not(${f})`]:{marginInlineEnd:"-0.34em",letterSpacing:"0.34em"},[`&${l}-icon-only`]:{paddingInline:0,[`&${l}-compact-item`]:{flex:"none"},[`&${l}-round`]:{width:"auto"}},[`&${l}-loading`]:{opacity:b,cursor:"default"},[`${l}-loading-icon`]:{transition:["width","opacity","margin"].map(Z=>`${Z} ${z} ${O}`).join(",")},[`&:not(${l}-icon-end)`]:{[`${l}-loading-icon-motion`]:{"&-appear-start, &-enter-start":{marginInlineEnd:H(r).mul(-1).equal()},"&-appear-active, &-enter-active":{marginInlineEnd:0},"&-leave-start":{marginInlineEnd:0},"&-leave-active":{marginInlineEnd:H(r).mul(-1).equal()}}},"&-icon-end":{flexDirection:"row-reverse",[`${l}-loading-icon-motion`]:{"&-appear-start, &-enter-start":{marginInlineStart:H(r).mul(-1).equal()},"&-appear-active, &-enter-active":{marginInlineStart:0},"&-leave-start":{marginInlineStart:0},"&-leave-active":{marginInlineStart:H(r).mul(-1).equal()}}}}}},dP=(i,l,f)=>({[`&:not(:disabled):not(${i}-disabled)`]:{"&:hover":l,"&:active":f}}),z4=i=>({minWidth:i.controlHeight,paddingInlineStart:0,paddingInlineEnd:0,borderRadius:"50%"}),L4=i=>({borderRadius:i.controlHeight,paddingInlineStart:i.calc(i.controlHeight).div(2).equal(),paddingInlineEnd:i.calc(i.controlHeight).div(2).equal()}),O4=i=>({cursor:"not-allowed",borderColor:i.borderColorDisabled,color:i.colorTextDisabled,background:i.colorBgContainerDisabled,boxShadow:"none"}),HS=(i,l,f,_,b,z,O,r)=>({[`&${i}-background-ghost`]:Object.assign(Object.assign({color:f||void 0,background:l,borderColor:_||void 0,boxShadow:"none"},dP(i,Object.assign({background:l},O),Object.assign({background:l},r))),{"&:disabled":{cursor:"not-allowed",color:b||void 0,borderColor:z||void 0}})}),D4=i=>({[`&:disabled, &${i.componentCls}-disabled`]:Object.assign({},O4(i))}),F4=i=>({[`&:disabled, &${i.componentCls}-disabled`]:{cursor:"not-allowed",color:i.colorTextDisabled}}),Lx=(i,l,f,_)=>{const z=_&&["link","text"].includes(_)?F4:D4;return Object.assign(Object.assign({},z(i)),dP(i.componentCls,l,f))},Ox=(i,l,f,_,b)=>({[`&${i.componentCls}-variant-solid`]:Object.assign({color:l,background:f},Lx(i,_,b))}),Dx=(i,l,f,_,b)=>({[`&${i.componentCls}-variant-outlined, &${i.componentCls}-variant-dashed`]:Object.assign({borderColor:l,background:f},Lx(i,_,b))}),Fx=i=>({[`&${i.componentCls}-variant-dashed`]:{borderStyle:"dashed"}}),Bx=(i,l,f,_)=>({[`&${i.componentCls}-variant-filled`]:Object.assign({boxShadow:"none",background:l},Lx(i,f,_))}),gp=(i,l,f,_,b)=>({[`&${i.componentCls}-variant-${f}`]:Object.assign({color:l,boxShadow:"none"},Lx(i,_,b,f))}),B4=i=>{const{componentCls:l}=i;return im.reduce((f,_)=>{const b=i[`${_}6`],z=i[`${_}1`],O=i[`${_}5`],r=i[`${_}2`],H=i[`${_}3`],Z=i[`${_}7`],K=`0 ${i.controlOutlineWidth} 0 ${i[`${_}1`]}`;return Object.assign(Object.assign({},f),{[`&${l}-color-${_}`]:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({color:b,boxShadow:K},Ox(i,i.colorTextLightSolid,b,{background:O},{background:Z})),Dx(i,b,i.colorBgContainer,{color:O,borderColor:O,background:i.colorBgContainer},{color:Z,borderColor:Z,background:i.colorBgContainer})),Fx(i)),Bx(i,z,{background:r},{background:H})),gp(i,b,"link",{color:O},{color:Z})),gp(i,b,"text",{color:O,background:z},{color:Z,background:H}))})},{})},N4=i=>Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({color:i.defaultColor,boxShadow:i.defaultShadow},Ox(i,i.solidTextColor,i.colorBgSolid,{color:i.solidTextColor,background:i.colorBgSolidHover},{color:i.solidTextColor,background:i.colorBgSolidActive})),Fx(i)),Bx(i,i.colorFillTertiary,{background:i.colorFillSecondary},{background:i.colorFill})),gp(i,i.textTextColor,"link",{color:i.colorLinkHover,background:i.linkHoverBg},{color:i.colorLinkActive})),HS(i.componentCls,i.ghostBg,i.defaultGhostColor,i.defaultGhostBorderColor,i.colorTextDisabled,i.colorBorder)),j4=i=>Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({color:i.colorPrimary,boxShadow:i.primaryShadow},Dx(i,i.colorPrimary,i.colorBgContainer,{color:i.colorPrimaryTextHover,borderColor:i.colorPrimaryHover,background:i.colorBgContainer},{color:i.colorPrimaryTextActive,borderColor:i.colorPrimaryActive,background:i.colorBgContainer})),Fx(i)),Bx(i,i.colorPrimaryBg,{background:i.colorPrimaryBgHover},{background:i.colorPrimaryBorder})),gp(i,i.colorLink,"text",{color:i.colorPrimaryTextHover,background:i.colorPrimaryBg},{color:i.colorPrimaryTextActive,background:i.colorPrimaryBorder})),HS(i.componentCls,i.ghostBg,i.colorPrimary,i.colorPrimary,i.colorTextDisabled,i.colorBorder,{color:i.colorPrimaryHover,borderColor:i.colorPrimaryHover},{color:i.colorPrimaryActive,borderColor:i.colorPrimaryActive})),$4=i=>Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({color:i.colorError,boxShadow:i.dangerShadow},Ox(i,i.dangerColor,i.colorError,{background:i.colorErrorHover},{background:i.colorErrorActive})),Dx(i,i.colorError,i.colorBgContainer,{color:i.colorErrorHover,borderColor:i.colorErrorBorderHover},{color:i.colorErrorActive,borderColor:i.colorErrorActive})),Fx(i)),Bx(i,i.colorErrorBg,{background:i.colorErrorBgFilledHover},{background:i.colorErrorBgActive})),gp(i,i.colorError,"text",{color:i.colorErrorHover,background:i.colorErrorBg},{color:i.colorErrorHover,background:i.colorErrorBgActive})),gp(i,i.colorError,"link",{color:i.colorErrorHover},{color:i.colorErrorActive})),HS(i.componentCls,i.ghostBg,i.colorError,i.colorError,i.colorTextDisabled,i.colorBorder,{color:i.colorErrorHover,borderColor:i.colorErrorHover},{color:i.colorErrorActive,borderColor:i.colorErrorActive})),V4=i=>{const{componentCls:l}=i;return Object.assign({[`${l}-color-default`]:N4(i),[`${l}-color-primary`]:j4(i),[`${l}-color-dangerous`]:$4(i)},B4(i))},U4=i=>Object.assign(Object.assign(Object.assign(Object.assign({},Dx(i,i.defaultBorderColor,i.defaultBg,{color:i.defaultHoverColor,borderColor:i.defaultHoverBorderColor,background:i.defaultHoverBg},{color:i.defaultActiveColor,borderColor:i.defaultActiveBorderColor,background:i.defaultActiveBg})),gp(i,i.textTextColor,"text",{color:i.textTextHoverColor,background:i.textHoverBg},{color:i.textTextActiveColor,background:i.colorBgTextActive})),Ox(i,i.primaryColor,i.colorPrimary,{background:i.colorPrimaryHover,color:i.primaryColor},{background:i.colorPrimaryActive,color:i.primaryColor})),gp(i,i.colorLink,"link",{color:i.colorLinkHover,background:i.linkHoverBg},{color:i.colorLinkActive})),WS=function(i){let l=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"";const{componentCls:f,controlHeight:_,fontSize:b,borderRadius:z,buttonPaddingHorizontal:O,iconCls:r,buttonPaddingVertical:H,buttonIconOnlyFontSize:Z}=i;return[{[l]:{fontSize:b,height:_,padding:`${Ur(H)} ${Ur(O)}`,borderRadius:z,[`&${f}-icon-only`]:{width:_,[r]:{fontSize:Z,verticalAlign:"calc(-0.125em - 1px)"}}}},{[`${f}${f}-circle${l}`]:z4(i)},{[`${f}${f}-round${l}`]:L4(i)}]},H4=i=>{const l=Ml(i,{fontSize:i.contentFontSize});return WS(l,i.componentCls)},W4=i=>{const l=Ml(i,{controlHeight:i.controlHeightSM,fontSize:i.contentFontSizeSM,padding:i.paddingXS,buttonPaddingHorizontal:i.paddingInlineSM,buttonPaddingVertical:0,borderRadius:i.borderRadiusSM,buttonIconOnlyFontSize:i.onlyIconSizeSM});return WS(l,`${i.componentCls}-sm`)},G4=i=>{const l=Ml(i,{controlHeight:i.controlHeightLG,fontSize:i.contentFontSizeLG,buttonPaddingHorizontal:i.paddingInlineLG,buttonPaddingVertical:0,borderRadius:i.borderRadiusLG,buttonIconOnlyFontSize:i.onlyIconSizeLG});return WS(l,`${i.componentCls}-lg`)},q4=i=>{const{componentCls:l}=i;return{[l]:{[`&${l}-block`]:{width:"100%"}}}},Z4=Ef("Button",i=>{const l=uP(i);return[k4(l),H4(l),W4(l),G4(l),q4(l),V4(l),U4(l),c4(l)]},hP,{unitless:{fontWeight:!0,contentLineHeight:!0,contentLineHeightSM:!0,contentLineHeightLG:!0}});function X4(i,l,f){const{focusElCls:_,focus:b,borderElCls:z}=f,O=z?"> *":"",r=["hover",b?"focus":null,"active"].filter(Boolean).map(H=>`&:${H} ${O}`).join(",");return{[`&-item:not(${l}-last-item)`]:{marginInlineEnd:i.calc(i.lineWidth).mul(-1).equal()},"&-item":Object.assign(Object.assign({[r]:{zIndex:2}},_?{[`&${_}`]:{zIndex:2}}:{}),{[`&[disabled] ${O}`]:{zIndex:0}})}}function Y4(i,l,f){const{borderElCls:_}=f,b=_?`> ${_}`:"";return{[`&-item:not(${l}-first-item):not(${l}-last-item) ${b}`]:{borderRadius:0},[`&-item:not(${l}-last-item)${l}-first-item`]:{[`& ${b}, &${i}-sm ${b}, &${i}-lg ${b}`]:{borderStartEndRadius:0,borderEndEndRadius:0}},[`&-item:not(${l}-first-item)${l}-last-item`]:{[`& ${b}, &${i}-sm ${b}, &${i}-lg ${b}`]:{borderStartStartRadius:0,borderEndStartRadius:0}}}}function fP(i){let l=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{focus:!0};const{componentCls:f}=i,_=`${f}-compact`;return{[_]:Object.assign(Object.assign({},X4(i,_,l)),Y4(f,_,l))}}function K4(i,l){return{[`&-item:not(${l}-last-item)`]:{marginBottom:i.calc(i.lineWidth).mul(-1).equal()},"&-item":{"&:hover,&:focus,&:active":{zIndex:2},"&[disabled]":{zIndex:0}}}}function J4(i,l){return{[`&-item:not(${l}-first-item):not(${l}-last-item)`]:{borderRadius:0},[`&-item${l}-first-item:not(${l}-last-item)`]:{[`&, &${i}-sm, &${i}-lg`]:{borderEndEndRadius:0,borderEndStartRadius:0}},[`&-item${l}-last-item:not(${l}-first-item)`]:{[`&, &${i}-sm, &${i}-lg`]:{borderStartStartRadius:0,borderStartEndRadius:0}}}}function Q4(i){const l=`${i.componentCls}-compact-vertical`;return{[l]:Object.assign(Object.assign({},K4(i,l)),J4(i.componentCls,l))}}const eB=i=>{const{componentCls:l,colorPrimaryHover:f,lineWidth:_,calc:b}=i,z=b(_).mul(-1).equal(),O=r=>({[`${l}-compact${r?"-vertical":""}-item${l}-primary:not([disabled])`]:{"& + &::before":{position:"absolute",top:r?z:0,insetInlineStart:r?0:z,backgroundColor:f,content:'""',width:r?"100%":_,height:r?_:"100%"}}});return Object.assign(Object.assign({},O()),O(!0))},tB=zD(["Button","compact"],i=>{const l=uP(i);return[fP(l),Q4(l),eB(l)]},hP);var nB=function(i,l){var f={};for(var _ in i)Object.prototype.hasOwnProperty.call(i,_)&&l.indexOf(_)<0&&(f[_]=i[_]);if(i!=null&&typeof Object.getOwnPropertySymbols=="function")for(var b=0,_=Object.getOwnPropertySymbols(i);b<_.length;b++)l.indexOf(_[b])<0&&Object.prototype.propertyIsEnumerable.call(i,_[b])&&(f[_[b]]=i[_[b]]);return f};function rB(i){if(typeof i=="object"&&i){let l=i==null?void 0:i.delay;return l=!Number.isNaN(l)&&typeof l=="number"?l:0,{loading:l<=0,delay:l}}return{loading:!!i,delay:0}}const iB={default:["default","outlined"],primary:["primary","solid"],dashed:["default","dashed"],link:["primary","link"],text:["default","text"]},oB=Nn.forwardRef((i,l)=>{var f,_,b,z;const{loading:O=!1,prefixCls:r,color:H,variant:Z,type:K,danger:te=!1,shape:le="default",size:Te,styles:pe,disabled:ge,className:fe,rootClassName:me,children:_e,icon:Ie,iconPosition:Ne="start",ghost:nt=!1,block:Le=!1,htmlType:Pe="button",classNames:rt,style:at={},autoInsertSpace:Qe,autoFocus:lt}=i,Ct=nB(i,["loading","prefixCls","color","variant","type","danger","shape","size","styles","disabled","className","rootClassName","children","icon","iconPosition","ghost","block","htmlType","classNames","style","autoInsertSpace","autoFocus"]),Rt=K||"default",[Nt,At]=se.useMemo(()=>{if(H&&Z)return[H,Z];const mr=iB[Rt]||[];return te?["danger",mr[1]]:mr},[K,H,Z,te]),gt=Nt==="danger"?"dangerous":Nt,{getPrefixCls:ht,direction:vt,button:Ve}=se.useContext(Xo),je=(f=Qe??(Ve==null?void 0:Ve.autoInsertSpace))!==null&&f!==void 0?f:!0,it=ht("btn",r),[Mt,Ot,sn]=Z4(it),hn=se.useContext(vf),Tn=ge??hn,Ut=se.useContext(lP),bn=se.useMemo(()=>rB(O),[O]),[Re,Hr]=se.useState(bn.loading),[Nr,Ar]=se.useState(!1),Ht=se.useRef(null),Wr=Tx(l,Ht),ar=se.Children.count(_e)===1&&!Ie&&!C1(At),pi=se.useRef(!0);Nn.useEffect(()=>(pi.current=!1,()=>{pi.current=!0}),[]),se.useEffect(()=>{let mr=null;bn.delay>0?mr=setTimeout(()=>{mr=null,Hr(!0)},bn.delay):Hr(bn.loading);function dr(){mr&&(clearTimeout(mr),mr=null)}return dr},[bn]),se.useEffect(()=>{if(!Ht.current||!je)return;const mr=Ht.current.textContent||"";ar&&Sw(mr)?Nr||Ar(!0):Nr&&Ar(!1)}),se.useEffect(()=>{lt&&Ht.current&&Ht.current.focus()},[]);const $n=Nn.useCallback(mr=>{var dr;if(Re||Tn){mr.preventDefault();return}(dr=i.onClick)===null||dr===void 0||dr.call(i,mr)},[i.onClick,Re,Tn]),{compactSize:Gr,compactItemClassnames:gi}=US(it,vt),Pr={large:"lg",small:"sm",middle:void 0},ci=bp(mr=>{var dr,wo;return(wo=(dr=Te??Gr)!==null&&dr!==void 0?dr:Ut)!==null&&wo!==void 0?wo:mr}),Un=ci&&(_=Pr[ci])!==null&&_!==void 0?_:"",yn=Re?"loading":Ie,Ir=IS(Ct,["navigate"]),ui=sr(it,Ot,sn,{[`${it}-${le}`]:le!=="default"&&le,[`${it}-${Rt}`]:Rt,[`${it}-dangerous`]:te,[`${it}-color-${gt}`]:gt,[`${it}-variant-${At}`]:At,[`${it}-${Un}`]:Un,[`${it}-icon-only`]:!_e&&_e!==0&&!!yn,[`${it}-background-ghost`]:nt&&!C1(At),[`${it}-loading`]:Re,[`${it}-two-chinese-chars`]:Nr&&je&&!Re,[`${it}-block`]:Le,[`${it}-rtl`]:vt==="rtl",[`${it}-icon-end`]:Ne==="end"},gi,fe,me,Ve==null?void 0:Ve.className),_i=Object.assign(Object.assign({},Ve==null?void 0:Ve.style),at),Lr=sr(rt==null?void 0:rt.icon,(b=Ve==null?void 0:Ve.classNames)===null||b===void 0?void 0:b.icon),yi=Object.assign(Object.assign({},(pe==null?void 0:pe.icon)||{}),((z=Ve==null?void 0:Ve.styles)===null||z===void 0?void 0:z.icon)||{}),oi=Ie&&!Re?Nn.createElement(Ew,{prefixCls:it,className:Lr,style:yi},Ie):typeof O=="object"&&O.icon?Nn.createElement(Ew,{prefixCls:it,className:Lr,style:yi},O.icon):Nn.createElement(l4,{existIcon:!!Ie,prefixCls:it,loading:Re,mount:pi.current}),qi=_e||_e===0?a4(_e,ar&&je):null;if(Ir.href!==void 0)return Mt(Nn.createElement("a",Object.assign({},Ir,{className:sr(ui,{[`${it}-disabled`]:Tn}),href:Tn?void 0:Ir.href,style:_i,onClick:$n,ref:Wr,tabIndex:Tn?-1:0}),oi,qi));let Ci=Nn.createElement("button",Object.assign({},Ct,{type:Pe,className:ui,style:_i,onClick:$n,disabled:Tn,ref:Wr}),oi,qi,gi&&Nn.createElement(tB,{prefixCls:it}));return C1(At)||(Ci=Nn.createElement(VS,{component:"Button",disabled:Re},Ci)),Mt(Ci)}),GS=oB;GS.Group=o4;GS.__ANT_BUTTON=!0;var pP=se.createContext(null),kM=[];function sB(i,l){var f=se.useState(function(){if(!wu())return null;var pe=document.createElement("div");return pe}),_=Gn(f,1),b=_[0],z=se.useRef(!1),O=se.useContext(pP),r=se.useState(kM),H=Gn(r,2),Z=H[0],K=H[1],te=O||(z.current?void 0:function(pe){K(function(ge){var fe=[pe].concat(Xr(ge));return fe})});function le(){b.parentElement||document.body.appendChild(b),z.current=!0}function Te(){var pe;(pe=b.parentElement)===null||pe===void 0||pe.removeChild(b),z.current=!1}return Ka(function(){return i?O?O(le):le():Te(),Te},[i]),Ka(function(){Z.length&&(Z.forEach(function(pe){return pe()}),K(kM))},[Z]),[b,te]}function aB(i){var l="rc-scrollbar-measure-".concat(Math.random().toString(36).substring(7)),f=document.createElement("div");f.id=l;var _=f.style;_.position="absolute",_.left="0",_.top="0",_.width="100px",_.height="100px",_.overflow="scroll";var b,z;if(i){var O=getComputedStyle(i);_.scrollbarColor=O.scrollbarColor,_.scrollbarWidth=O.scrollbarWidth;var r=getComputedStyle(i,"::-webkit-scrollbar"),H=parseInt(r.width,10),Z=parseInt(r.height,10);try{var K=H?"width: ".concat(r.width,";"):"",te=Z?"height: ".concat(r.height,";"):"";gf(`
#`.concat(l,`::-webkit-scrollbar {
`).concat(K,`
`).concat(te,`
}`),l)}catch(pe){console.error(pe),b=H,z=Z}}document.body.appendChild(f);var le=i&&b&&!isNaN(b)?b:f.offsetWidth-f.clientWidth,Te=i&&z&&!isNaN(z)?z:f.offsetHeight-f.clientHeight;return document.body.removeChild(f),K_(l),{width:le,height:Te}}function lB(i){return typeof document>"u"||!i||!(i instanceof Element)?{width:0,height:0}:aB(i)}function cB(){return document.body.scrollHeight>(window.innerHeight||document.documentElement.clientHeight)&&window.innerWidth>document.body.offsetWidth}var uB="rc-util-locker-".concat(Date.now()),zM=0;function hB(i){var l=!!i,f=se.useState(function(){return zM+=1,"".concat(uB,"_").concat(zM)}),_=Gn(f,1),b=_[0];Ka(function(){if(l){var z=lB(document.body).width,O=cB();gf(`
html body {
  overflow-y: hidden;
  `.concat(O?"width: calc(100% - ".concat(z,"px);"):"",`
}`),b)}else K_(b);return function(){K_(b)}},[l,b])}var dB=!1;function fB(i){return dB}var LM=function(l){return l===!1?!1:!wu()||!l?null:typeof l=="string"?document.querySelector(l):typeof l=="function"?l():l},mP=se.forwardRef(function(i,l){var f=i.open,_=i.autoLock,b=i.getContainer;i.debug;var z=i.autoDestroy,O=z===void 0?!0:z,r=i.children,H=se.useState(f),Z=Gn(H,2),K=Z[0],te=Z[1],le=K||f;se.useEffect(function(){(O||f)&&te(f)},[f,O]);var Te=se.useState(function(){return LM(b)}),pe=Gn(Te,2),ge=pe[0],fe=pe[1];se.useEffect(function(){var lt=LM(b);fe(lt??null)});var me=sB(le&&!ge),_e=Gn(me,2),Ie=_e[0],Ne=_e[1],nt=ge??Ie;hB(_&&f&&wu()&&(nt===Ie||nt===document.body));var Le=null;if(r&&sy(r)&&l){var Pe=r;Le=Pe.ref}var rt=Tx(Le,l);if(!le||!wu()||ge===void 0)return null;var at=nt===!1||fB(),Qe=r;return l&&(Qe=se.cloneElement(r,{ref:rt})),se.createElement(pP.Provider,{value:Ne},at?Qe:TS.createPortal(Qe,nt))});function pB(){var i=nn({},Ex);return i.useId}var OM=0,DM=pB();const gP=DM?function(l){var f=DM();return l||f}:function(l){var f=se.useState("ssr-id"),_=Gn(f,2),b=_[0],z=_[1];return se.useEffect(function(){var O=OM;OM+=1,z("rc_unique_".concat(O))},[]),l||b};var tm="RC_FORM_INTERNAL_HOOKS",No=function(){xu(!1,"Can not find FormContext. Please make sure you wrap Field under Form.")},Eg=se.createContext({getFieldValue:No,getFieldsValue:No,getFieldError:No,getFieldWarning:No,getFieldsError:No,isFieldsTouched:No,isFieldTouched:No,isFieldValidating:No,isFieldsValidating:No,resetFields:No,setFields:No,setFieldValue:No,setFieldsValue:No,validateFields:No,submit:No,getInternalHooks:function(){return No(),{dispatch:No,initEntityValue:No,registerField:No,useSubscribe:No,setInitialValues:No,destroyForm:No,setCallbacks:No,registerWatch:No,getFields:No,setValidateMessages:No,setPreserve:No,getInitialValue:No}}}),dx=se.createContext(null);function Tw(i){return i==null?[]:Array.isArray(i)?i:[i]}function mB(i){return i&&!!i._init}function Cw(){return{default:"Validation error on field %s",required:"%s is required",enum:"%s must be one of %s",whitespace:"%s cannot be empty",date:{format:"%s date %s is invalid for format %s",parse:"%s date could not be parsed, %s is invalid ",invalid:"%s date %s is invalid"},types:{string:"%s is not a %s",method:"%s is not a %s (function)",array:"%s is not an %s",object:"%s is not an %s",number:"%s is not a %s",date:"%s is not a %s",boolean:"%s is not a %s",integer:"%s is not an %s",float:"%s is not a %s",regexp:"%s is not a valid %s",email:"%s is not a valid %s",url:"%s is not a valid %s",hex:"%s is not a valid %s"},string:{len:"%s must be exactly %s characters",min:"%s must be at least %s characters",max:"%s cannot be longer than %s characters",range:"%s must be between %s and %s characters"},number:{len:"%s must equal %s",min:"%s cannot be less than %s",max:"%s cannot be greater than %s",range:"%s must be between %s and %s"},array:{len:"%s must be exactly %s in length",min:"%s cannot be less than %s in length",max:"%s cannot be greater than %s in length",range:"%s must be between %s and %s in length"},pattern:{mismatch:"%s value %s does not match pattern %s"},clone:function(){var l=JSON.parse(JSON.stringify(this));return l.clone=this.clone,l}}}var Mw=Cw();function gB(i){try{return Function.toString.call(i).indexOf("[native code]")!==-1}catch{return typeof i=="function"}}function _B(i,l,f){if(AS())return Reflect.construct.apply(null,arguments);var _=[null];_.push.apply(_,l);var b=new(i.bind.apply(i,_));return f&&Z_(b,f.prototype),b}function Aw(i){var l=typeof Map=="function"?new Map:void 0;return Aw=function(_){if(_===null||!gB(_))return _;if(typeof _!="function")throw new TypeError("Super expression must either be null or a function");if(l!==void 0){if(l.has(_))return l.get(_);l.set(_,b)}function b(){return _B(_,arguments,X_(this).constructor)}return b.prototype=Object.create(_.prototype,{constructor:{value:b,enumerable:!1,writable:!0,configurable:!0}}),Z_(b,_)},Aw(i)}var yB=/%[sdj%]/g,vB=function(){};function Iw(i){if(!i||!i.length)return null;var l={};return i.forEach(function(f){var _=f.field;l[_]=l[_]||[],l[_].push(f)}),l}function yu(i){for(var l=arguments.length,f=new Array(l>1?l-1:0),_=1;_<l;_++)f[_-1]=arguments[_];var b=0,z=f.length;if(typeof i=="function")return i.apply(null,f);if(typeof i=="string"){var O=i.replace(yB,function(r){if(r==="%%")return"%";if(b>=z)return r;switch(r){case"%s":return String(f[b++]);case"%d":return Number(f[b++]);case"%j":try{return JSON.stringify(f[b++])}catch{return"[Circular]"}break;default:return r}});return O}return i}function xB(i){return i==="string"||i==="url"||i==="hex"||i==="email"||i==="date"||i==="pattern"}function La(i,l){return!!(i==null||l==="array"&&Array.isArray(i)&&!i.length||xB(l)&&typeof i=="string"&&!i)}function bB(i,l,f){var _=[],b=0,z=i.length;function O(r){_.push.apply(_,Xr(r||[])),b++,b===z&&f(_)}i.forEach(function(r){l(r,O)})}function FM(i,l,f){var _=0,b=i.length;function z(O){if(O&&O.length){f(O);return}var r=_;_=_+1,r<b?l(i[r],z):f([])}z([])}function wB(i){var l=[];return Object.keys(i).forEach(function(f){l.push.apply(l,Xr(i[f]||[]))}),l}var BM=function(i){yp(f,i);var l=vp(f);function f(_,b){var z;return Qa(this,f),z=l.call(this,"Async Validation Error"),jt(Di(z),"errors",void 0),jt(Di(z),"fields",void 0),z.errors=_,z.fields=b,z}return el(f)}(Aw(Error));function SB(i,l,f,_,b){if(l.first){var z=new Promise(function(le,Te){var pe=function(me){return _(me),me.length?Te(new BM(me,Iw(me))):le(b)},ge=wB(i);FM(ge,f,pe)});return z.catch(function(le){return le}),z}var O=l.firstFields===!0?Object.keys(i):l.firstFields||[],r=Object.keys(i),H=r.length,Z=0,K=[],te=new Promise(function(le,Te){var pe=function(fe){if(K.push.apply(K,fe),Z++,Z===H)return _(K),K.length?Te(new BM(K,Iw(K))):le(b)};r.length||(_(K),le(b)),r.forEach(function(ge){var fe=i[ge];O.indexOf(ge)!==-1?FM(fe,f,pe):bB(fe,f,pe)})});return te.catch(function(le){return le}),te}function EB(i){return!!(i&&i.message!==void 0)}function TB(i,l){for(var f=i,_=0;_<l.length;_++){if(f==null)return f;f=f[l[_]]}return f}function NM(i,l){return function(f){var _;return i.fullFields?_=TB(l,i.fullFields):_=l[f.field||i.fullField],EB(f)?(f.field=f.field||i.fullField,f.fieldValue=_,f):{message:typeof f=="function"?f():f,fieldValue:_,field:f.field||i.fullField}}}function jM(i,l){if(l){for(var f in l)if(l.hasOwnProperty(f)){var _=l[f];li(_)==="object"&&li(i[f])==="object"?i[f]=nn(nn({},i[f]),_):i[f]=_}}return i}var Wm="enum",CB=function(l,f,_,b,z){l[Wm]=Array.isArray(l[Wm])?l[Wm]:[],l[Wm].indexOf(f)===-1&&b.push(yu(z.messages[Wm],l.fullField,l[Wm].join(", ")))},MB=function(l,f,_,b,z){if(l.pattern){if(l.pattern instanceof RegExp)l.pattern.lastIndex=0,l.pattern.test(f)||b.push(yu(z.messages.pattern.mismatch,l.fullField,f,l.pattern));else if(typeof l.pattern=="string"){var O=new RegExp(l.pattern);O.test(f)||b.push(yu(z.messages.pattern.mismatch,l.fullField,f,l.pattern))}}},AB=function(l,f,_,b,z){var O=typeof l.len=="number",r=typeof l.min=="number",H=typeof l.max=="number",Z=/[\uD800-\uDBFF][\uDC00-\uDFFF]/g,K=f,te=null,le=typeof f=="number",Te=typeof f=="string",pe=Array.isArray(f);if(le?te="number":Te?te="string":pe&&(te="array"),!te)return!1;pe&&(K=f.length),Te&&(K=f.replace(Z,"_").length),O?K!==l.len&&b.push(yu(z.messages[te].len,l.fullField,l.len)):r&&!H&&K<l.min?b.push(yu(z.messages[te].min,l.fullField,l.min)):H&&!r&&K>l.max?b.push(yu(z.messages[te].max,l.fullField,l.max)):r&&H&&(K<l.min||K>l.max)&&b.push(yu(z.messages[te].range,l.fullField,l.min,l.max))},_P=function(l,f,_,b,z,O){l.required&&(!_.hasOwnProperty(l.field)||La(f,O||l.type))&&b.push(yu(z.messages.required,l.fullField))},gv;const IB=function(){if(gv)return gv;var i="[a-fA-F\\d:]",l=function(Le){return Le&&Le.includeBoundaries?"(?:(?<=\\s|^)(?=".concat(i,")|(?<=").concat(i,")(?=\\s|$))"):""},f="(?:25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]\\d|\\d)(?:\\.(?:25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]\\d|\\d)){3}",_="[a-fA-F\\d]{1,4}",b=["(?:".concat(_,":){7}(?:").concat(_,"|:)"),"(?:".concat(_,":){6}(?:").concat(f,"|:").concat(_,"|:)"),"(?:".concat(_,":){5}(?::").concat(f,"|(?::").concat(_,"){1,2}|:)"),"(?:".concat(_,":){4}(?:(?::").concat(_,"){0,1}:").concat(f,"|(?::").concat(_,"){1,3}|:)"),"(?:".concat(_,":){3}(?:(?::").concat(_,"){0,2}:").concat(f,"|(?::").concat(_,"){1,4}|:)"),"(?:".concat(_,":){2}(?:(?::").concat(_,"){0,3}:").concat(f,"|(?::").concat(_,"){1,5}|:)"),"(?:".concat(_,":){1}(?:(?::").concat(_,"){0,4}:").concat(f,"|(?::").concat(_,"){1,6}|:)"),"(?::(?:(?::".concat(_,"){0,5}:").concat(f,"|(?::").concat(_,"){1,7}|:))")],z="(?:%[0-9a-zA-Z]{1,})?",O="(?:".concat(b.join("|"),")").concat(z),r=new RegExp("(?:^".concat(f,"$)|(?:^").concat(O,"$)")),H=new RegExp("^".concat(f,"$")),Z=new RegExp("^".concat(O,"$")),K=function(Le){return Le&&Le.exact?r:new RegExp("(?:".concat(l(Le)).concat(f).concat(l(Le),")|(?:").concat(l(Le)).concat(O).concat(l(Le),")"),"g")};K.v4=function(nt){return nt&&nt.exact?H:new RegExp("".concat(l(nt)).concat(f).concat(l(nt)),"g")},K.v6=function(nt){return nt&&nt.exact?Z:new RegExp("".concat(l(nt)).concat(O).concat(l(nt)),"g")};var te="(?:(?:[a-z]+:)?//)",le="(?:\\S+(?::\\S*)?@)?",Te=K.v4().source,pe=K.v6().source,ge="(?:(?:[a-z\\u00a1-\\uffff0-9][-_]*)*[a-z\\u00a1-\\uffff0-9]+)",fe="(?:\\.(?:[a-z\\u00a1-\\uffff0-9]-*)*[a-z\\u00a1-\\uffff0-9]+)*",me="(?:\\.(?:[a-z\\u00a1-\\uffff]{2,}))",_e="(?::\\d{2,5})?",Ie='(?:[/?#][^\\s"]*)?',Ne="(?:".concat(te,"|www\\.)").concat(le,"(?:localhost|").concat(Te,"|").concat(pe,"|").concat(ge).concat(fe).concat(me,")").concat(_e).concat(Ie);return gv=new RegExp("(?:^".concat(Ne,"$)"),"i"),gv};var $M={email:/^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]+\.)+[a-zA-Z\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]{2,}))$/,hex:/^#?([a-f0-9]{6}|[a-f0-9]{3})$/i},m_={integer:function(l){return m_.number(l)&&parseInt(l,10)===l},float:function(l){return m_.number(l)&&!m_.integer(l)},array:function(l){return Array.isArray(l)},regexp:function(l){if(l instanceof RegExp)return!0;try{return!!new RegExp(l)}catch{return!1}},date:function(l){return typeof l.getTime=="function"&&typeof l.getMonth=="function"&&typeof l.getYear=="function"&&!isNaN(l.getTime())},number:function(l){return isNaN(l)?!1:typeof l=="number"},object:function(l){return li(l)==="object"&&!m_.array(l)},method:function(l){return typeof l=="function"},email:function(l){return typeof l=="string"&&l.length<=320&&!!l.match($M.email)},url:function(l){return typeof l=="string"&&l.length<=2048&&!!l.match(IB())},hex:function(l){return typeof l=="string"&&!!l.match($M.hex)}},PB=function(l,f,_,b,z){if(l.required&&f===void 0){_P(l,f,_,b,z);return}var O=["integer","float","array","regexp","object","method","email","number","date","url","hex"],r=l.type;O.indexOf(r)>-1?m_[r](f)||b.push(yu(z.messages.types[r],l.fullField,l.type)):r&&li(f)!==l.type&&b.push(yu(z.messages.types[r],l.fullField,l.type))},RB=function(l,f,_,b,z){(/^\s+$/.test(f)||f==="")&&b.push(yu(z.messages.whitespace,l.fullField))};const Gi={required:_P,whitespace:RB,type:PB,range:AB,enum:CB,pattern:MB};var kB=function(l,f,_,b,z){var O=[],r=l.required||!l.required&&b.hasOwnProperty(l.field);if(r){if(La(f)&&!l.required)return _();Gi.required(l,f,b,O,z)}_(O)},zB=function(l,f,_,b,z){var O=[],r=l.required||!l.required&&b.hasOwnProperty(l.field);if(r){if(f==null&&!l.required)return _();Gi.required(l,f,b,O,z,"array"),f!=null&&(Gi.type(l,f,b,O,z),Gi.range(l,f,b,O,z))}_(O)},LB=function(l,f,_,b,z){var O=[],r=l.required||!l.required&&b.hasOwnProperty(l.field);if(r){if(La(f)&&!l.required)return _();Gi.required(l,f,b,O,z),f!==void 0&&Gi.type(l,f,b,O,z)}_(O)},OB=function(l,f,_,b,z){var O=[],r=l.required||!l.required&&b.hasOwnProperty(l.field);if(r){if(La(f,"date")&&!l.required)return _();if(Gi.required(l,f,b,O,z),!La(f,"date")){var H;f instanceof Date?H=f:H=new Date(f),Gi.type(l,H,b,O,z),H&&Gi.range(l,H.getTime(),b,O,z)}}_(O)},DB="enum",FB=function(l,f,_,b,z){var O=[],r=l.required||!l.required&&b.hasOwnProperty(l.field);if(r){if(La(f)&&!l.required)return _();Gi.required(l,f,b,O,z),f!==void 0&&Gi[DB](l,f,b,O,z)}_(O)},BB=function(l,f,_,b,z){var O=[],r=l.required||!l.required&&b.hasOwnProperty(l.field);if(r){if(La(f)&&!l.required)return _();Gi.required(l,f,b,O,z),f!==void 0&&(Gi.type(l,f,b,O,z),Gi.range(l,f,b,O,z))}_(O)},NB=function(l,f,_,b,z){var O=[],r=l.required||!l.required&&b.hasOwnProperty(l.field);if(r){if(La(f)&&!l.required)return _();Gi.required(l,f,b,O,z),f!==void 0&&(Gi.type(l,f,b,O,z),Gi.range(l,f,b,O,z))}_(O)},jB=function(l,f,_,b,z){var O=[],r=l.required||!l.required&&b.hasOwnProperty(l.field);if(r){if(La(f)&&!l.required)return _();Gi.required(l,f,b,O,z),f!==void 0&&Gi.type(l,f,b,O,z)}_(O)},$B=function(l,f,_,b,z){var O=[],r=l.required||!l.required&&b.hasOwnProperty(l.field);if(r){if(f===""&&(f=void 0),La(f)&&!l.required)return _();Gi.required(l,f,b,O,z),f!==void 0&&(Gi.type(l,f,b,O,z),Gi.range(l,f,b,O,z))}_(O)},VB=function(l,f,_,b,z){var O=[],r=l.required||!l.required&&b.hasOwnProperty(l.field);if(r){if(La(f)&&!l.required)return _();Gi.required(l,f,b,O,z),f!==void 0&&Gi.type(l,f,b,O,z)}_(O)},UB=function(l,f,_,b,z){var O=[],r=l.required||!l.required&&b.hasOwnProperty(l.field);if(r){if(La(f,"string")&&!l.required)return _();Gi.required(l,f,b,O,z),La(f,"string")||Gi.pattern(l,f,b,O,z)}_(O)},HB=function(l,f,_,b,z){var O=[],r=l.required||!l.required&&b.hasOwnProperty(l.field);if(r){if(La(f)&&!l.required)return _();Gi.required(l,f,b,O,z),La(f)||Gi.type(l,f,b,O,z)}_(O)},WB=function(l,f,_,b,z){var O=[],r=Array.isArray(f)?"array":li(f);Gi.required(l,f,b,O,z,r),_(O)},GB=function(l,f,_,b,z){var O=[],r=l.required||!l.required&&b.hasOwnProperty(l.field);if(r){if(La(f,"string")&&!l.required)return _();Gi.required(l,f,b,O,z,"string"),La(f,"string")||(Gi.type(l,f,b,O,z),Gi.range(l,f,b,O,z),Gi.pattern(l,f,b,O,z),l.whitespace===!0&&Gi.whitespace(l,f,b,O,z))}_(O)},P1=function(l,f,_,b,z){var O=l.type,r=[],H=l.required||!l.required&&b.hasOwnProperty(l.field);if(H){if(La(f,O)&&!l.required)return _();Gi.required(l,f,b,r,z,O),La(f,O)||Gi.type(l,f,b,r,z)}_(r)};const V_={string:GB,method:jB,number:$B,boolean:LB,regexp:HB,integer:NB,float:BB,array:zB,object:VB,enum:FB,pattern:UB,date:OB,url:P1,hex:P1,email:P1,required:WB,any:kB};var hy=function(){function i(l){Qa(this,i),jt(this,"rules",null),jt(this,"_messages",Mw),this.define(l)}return el(i,[{key:"define",value:function(f){var _=this;if(!f)throw new Error("Cannot configure a schema with no rules");if(li(f)!=="object"||Array.isArray(f))throw new Error("Rules must be an object");this.rules={},Object.keys(f).forEach(function(b){var z=f[b];_.rules[b]=Array.isArray(z)?z:[z]})}},{key:"messages",value:function(f){return f&&(this._messages=jM(Cw(),f)),this._messages}},{key:"validate",value:function(f){var _=this,b=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},z=arguments.length>2&&arguments[2]!==void 0?arguments[2]:function(){},O=f,r=b,H=z;if(typeof r=="function"&&(H=r,r={}),!this.rules||Object.keys(this.rules).length===0)return H&&H(null,O),Promise.resolve(O);function Z(pe){var ge=[],fe={};function me(Ie){if(Array.isArray(Ie)){var Ne;ge=(Ne=ge).concat.apply(Ne,Xr(Ie))}else ge.push(Ie)}for(var _e=0;_e<pe.length;_e++)me(pe[_e]);ge.length?(fe=Iw(ge),H(ge,fe)):H(null,O)}if(r.messages){var K=this.messages();K===Mw&&(K=Cw()),jM(K,r.messages),r.messages=K}else r.messages=this.messages();var te={},le=r.keys||Object.keys(this.rules);le.forEach(function(pe){var ge=_.rules[pe],fe=O[pe];ge.forEach(function(me){var _e=me;typeof _e.transform=="function"&&(O===f&&(O=nn({},O)),fe=O[pe]=_e.transform(fe),fe!=null&&(_e.type=_e.type||(Array.isArray(fe)?"array":li(fe)))),typeof _e=="function"?_e={validator:_e}:_e=nn({},_e),_e.validator=_.getValidationMethod(_e),_e.validator&&(_e.field=pe,_e.fullField=_e.fullField||pe,_e.type=_.getType(_e),te[pe]=te[pe]||[],te[pe].push({rule:_e,value:fe,source:O,field:pe}))})});var Te={};return SB(te,r,function(pe,ge){var fe=pe.rule,me=(fe.type==="object"||fe.type==="array")&&(li(fe.fields)==="object"||li(fe.defaultField)==="object");me=me&&(fe.required||!fe.required&&pe.value),fe.field=pe.field;function _e(Pe,rt){return nn(nn({},rt),{},{fullField:"".concat(fe.fullField,".").concat(Pe),fullFields:fe.fullFields?[].concat(Xr(fe.fullFields),[Pe]):[Pe]})}function Ie(){var Pe=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[],rt=Array.isArray(Pe)?Pe:[Pe];!r.suppressWarning&&rt.length&&i.warning("async-validator:",rt),rt.length&&fe.message!==void 0&&(rt=[].concat(fe.message));var at=rt.map(NM(fe,O));if(r.first&&at.length)return Te[fe.field]=1,ge(at);if(!me)ge(at);else{if(fe.required&&!pe.value)return fe.message!==void 0?at=[].concat(fe.message).map(NM(fe,O)):r.error&&(at=[r.error(fe,yu(r.messages.required,fe.field))]),ge(at);var Qe={};fe.defaultField&&Object.keys(pe.value).map(function(Rt){Qe[Rt]=fe.defaultField}),Qe=nn(nn({},Qe),pe.rule.fields);var lt={};Object.keys(Qe).forEach(function(Rt){var Nt=Qe[Rt],At=Array.isArray(Nt)?Nt:[Nt];lt[Rt]=At.map(_e.bind(null,Rt))});var Ct=new i(lt);Ct.messages(r.messages),pe.rule.options&&(pe.rule.options.messages=r.messages,pe.rule.options.error=r.error),Ct.validate(pe.value,pe.rule.options||r,function(Rt){var Nt=[];at&&at.length&&Nt.push.apply(Nt,Xr(at)),Rt&&Rt.length&&Nt.push.apply(Nt,Xr(Rt)),ge(Nt.length?Nt:null)})}}var Ne;if(fe.asyncValidator)Ne=fe.asyncValidator(fe,pe.value,Ie,pe.source,r);else if(fe.validator){try{Ne=fe.validator(fe,pe.value,Ie,pe.source,r)}catch(Pe){var nt,Le;(nt=(Le=console).error)===null||nt===void 0||nt.call(Le,Pe),r.suppressValidatorError||setTimeout(function(){throw Pe},0),Ie(Pe.message)}Ne===!0?Ie():Ne===!1?Ie(typeof fe.message=="function"?fe.message(fe.fullField||fe.field):fe.message||"".concat(fe.fullField||fe.field," fails")):Ne instanceof Array?Ie(Ne):Ne instanceof Error&&Ie(Ne.message)}Ne&&Ne.then&&Ne.then(function(){return Ie()},function(Pe){return Ie(Pe)})},function(pe){Z(pe)},O)}},{key:"getType",value:function(f){if(f.type===void 0&&f.pattern instanceof RegExp&&(f.type="pattern"),typeof f.validator!="function"&&f.type&&!V_.hasOwnProperty(f.type))throw new Error(yu("Unknown rule type %s",f.type));return f.type||"string"}},{key:"getValidationMethod",value:function(f){if(typeof f.validator=="function")return f.validator;var _=Object.keys(f),b=_.indexOf("message");return b!==-1&&_.splice(b,1),_.length===1&&_[0]==="required"?V_.required:V_[this.getType(f)]||void 0}}]),i}();jt(hy,"register",function(l,f){if(typeof f!="function")throw new Error("Cannot register a validator by type, validator is not a function");V_[l]=f});jt(hy,"warning",vB);jt(hy,"messages",Mw);jt(hy,"validators",V_);var mu="'${name}' is not a valid ${type}",yP={default:"Validation error on field '${name}'",required:"'${name}' is required",enum:"'${name}' must be one of [${enum}]",whitespace:"'${name}' cannot be empty",date:{format:"'${name}' is invalid for format date",parse:"'${name}' could not be parsed as date",invalid:"'${name}' is invalid date"},types:{string:mu,method:mu,array:mu,object:mu,number:mu,date:mu,boolean:mu,integer:mu,float:mu,regexp:mu,email:mu,url:mu,hex:mu},string:{len:"'${name}' must be exactly ${len} characters",min:"'${name}' must be at least ${min} characters",max:"'${name}' cannot be longer than ${max} characters",range:"'${name}' must be between ${min} and ${max} characters"},number:{len:"'${name}' must equal ${len}",min:"'${name}' cannot be less than ${min}",max:"'${name}' cannot be greater than ${max}",range:"'${name}' must be between ${min} and ${max}"},array:{len:"'${name}' must be exactly ${len} in length",min:"'${name}' cannot be less than ${min} in length",max:"'${name}' cannot be greater than ${max} in length",range:"'${name}' must be between ${min} and ${max} in length"},pattern:{mismatch:"'${name}' does not match pattern ${pattern}"}},VM=hy;function qB(i,l){return i.replace(/\\?\$\{\w+\}/g,function(f){if(f.startsWith("\\"))return f.slice(1);var _=f.slice(2,-1);return l[_]})}var UM="CODE_LOGIC_ERROR";function Pw(i,l,f,_,b){return Rw.apply(this,arguments)}function Rw(){return Rw=um(gc().mark(function i(l,f,_,b,z){var O,r,H,Z,K,te,le,Te,pe;return gc().wrap(function(fe){for(;;)switch(fe.prev=fe.next){case 0:return O=nn({},_),delete O.ruleIndex,VM.warning=function(){},O.validator&&(r=O.validator,O.validator=function(){try{return r.apply(void 0,arguments)}catch(me){return console.error(me),Promise.reject(UM)}}),H=null,O&&O.type==="array"&&O.defaultField&&(H=O.defaultField,delete O.defaultField),Z=new VM(jt({},l,[O])),K=pg(yP,b.validateMessages),Z.messages(K),te=[],fe.prev=10,fe.next=13,Promise.resolve(Z.validate(jt({},l,f),nn({},b)));case 13:fe.next=18;break;case 15:fe.prev=15,fe.t0=fe.catch(10),fe.t0.errors&&(te=fe.t0.errors.map(function(me,_e){var Ie=me.message,Ne=Ie===UM?K.default:Ie;return se.isValidElement(Ne)?se.cloneElement(Ne,{key:"error_".concat(_e)}):Ne}));case 18:if(!(!te.length&&H)){fe.next=23;break}return fe.next=21,Promise.all(f.map(function(me,_e){return Pw("".concat(l,".").concat(_e),me,H,b,z)}));case 21:return le=fe.sent,fe.abrupt("return",le.reduce(function(me,_e){return[].concat(Xr(me),Xr(_e))},[]));case 23:return Te=nn(nn({},_),{},{name:l,enum:(_.enum||[]).join(", ")},z),pe=te.map(function(me){return typeof me=="string"?qB(me,Te):me}),fe.abrupt("return",pe);case 26:case"end":return fe.stop()}},i,null,[[10,15]])})),Rw.apply(this,arguments)}function ZB(i,l,f,_,b,z){var O=i.join("."),r=f.map(function(K,te){var le=K.validator,Te=nn(nn({},K),{},{ruleIndex:te});return le&&(Te.validator=function(pe,ge,fe){var me=!1,_e=function(){for(var nt=arguments.length,Le=new Array(nt),Pe=0;Pe<nt;Pe++)Le[Pe]=arguments[Pe];Promise.resolve().then(function(){xu(!me,"Your validator function has already return a promise. `callback` will be ignored."),me||fe.apply(void 0,Le)})},Ie=le(pe,ge,_e);me=Ie&&typeof Ie.then=="function"&&typeof Ie.catch=="function",xu(me,"`callback` is deprecated. Please return a promise instead."),me&&Ie.then(function(){fe()}).catch(function(Ne){fe(Ne||" ")})}),Te}).sort(function(K,te){var le=K.warningOnly,Te=K.ruleIndex,pe=te.warningOnly,ge=te.ruleIndex;return!!le==!!pe?Te-ge:le?1:-1}),H;if(b===!0)H=new Promise(function(){var K=um(gc().mark(function te(le,Te){var pe,ge,fe;return gc().wrap(function(_e){for(;;)switch(_e.prev=_e.next){case 0:pe=0;case 1:if(!(pe<r.length)){_e.next=12;break}return ge=r[pe],_e.next=5,Pw(O,l,ge,_,z);case 5:if(fe=_e.sent,!fe.length){_e.next=9;break}return Te([{errors:fe,rule:ge}]),_e.abrupt("return");case 9:pe+=1,_e.next=1;break;case 12:le([]);case 13:case"end":return _e.stop()}},te)}));return function(te,le){return K.apply(this,arguments)}}());else{var Z=r.map(function(K){return Pw(O,l,K,_,z).then(function(te){return{errors:te,rule:K}})});H=(b?YB(Z):XB(Z)).then(function(K){return Promise.reject(K)})}return H.catch(function(K){return K}),H}function XB(i){return kw.apply(this,arguments)}function kw(){return kw=um(gc().mark(function i(l){return gc().wrap(function(_){for(;;)switch(_.prev=_.next){case 0:return _.abrupt("return",Promise.all(l).then(function(b){var z,O=(z=[]).concat.apply(z,Xr(b));return O}));case 1:case"end":return _.stop()}},i)})),kw.apply(this,arguments)}function YB(i){return zw.apply(this,arguments)}function zw(){return zw=um(gc().mark(function i(l){var f;return gc().wrap(function(b){for(;;)switch(b.prev=b.next){case 0:return f=0,b.abrupt("return",new Promise(function(z){l.forEach(function(O){O.then(function(r){r.errors.length&&z([r]),f+=1,f===l.length&&z([])})})}));case 2:case"end":return b.stop()}},i)})),zw.apply(this,arguments)}function ra(i){return Tw(i)}function HM(i,l){var f={};return l.forEach(function(_){var b=Cd(i,_);f=Ih(f,_,b)}),f}function yg(i,l){var f=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1;return i&&i.some(function(_){return vP(l,_,f)})}function vP(i,l){var f=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1;return!i||!l||!f&&i.length!==l.length?!1:l.every(function(_,b){return i[b]===_})}function KB(i,l){if(i===l)return!0;if(!i&&l||!l||!i||!l||li(i)!=="object"||li(l)!=="object")return!1;var f=Object.keys(i),_=Object.keys(l),b=new Set([].concat(f,_));return Xr(b).every(function(z){var O=i[z],r=l[z];return typeof O=="function"&&typeof r=="function"?!0:O===r})}function JB(i){var l=arguments.length<=1?void 0:arguments[1];return l&&l.target&&li(l.target)==="object"&&i in l.target?l.target[i]:l}function WM(i,l,f){var _=i.length;if(l<0||l>=_||f<0||f>=_)return i;var b=i[l],z=l-f;return z>0?[].concat(Xr(i.slice(0,f)),[b],Xr(i.slice(f,l)),Xr(i.slice(l+1,_))):z<0?[].concat(Xr(i.slice(0,l)),Xr(i.slice(l+1,f+1)),[b],Xr(i.slice(f+1,_))):i}var QB=["name"],Uu=[];function R1(i,l,f,_,b,z){return typeof i=="function"?i(l,f,"source"in z?{source:z.source}:{}):_!==b}var qS=function(i){yp(f,i);var l=vp(f);function f(_){var b;if(Qa(this,f),b=l.call(this,_),jt(Di(b),"state",{resetCount:0}),jt(Di(b),"cancelRegisterFunc",null),jt(Di(b),"mounted",!1),jt(Di(b),"touched",!1),jt(Di(b),"dirty",!1),jt(Di(b),"validatePromise",void 0),jt(Di(b),"prevValidating",void 0),jt(Di(b),"errors",Uu),jt(Di(b),"warnings",Uu),jt(Di(b),"cancelRegister",function(){var H=b.props,Z=H.preserve,K=H.isListField,te=H.name;b.cancelRegisterFunc&&b.cancelRegisterFunc(K,Z,ra(te)),b.cancelRegisterFunc=null}),jt(Di(b),"getNamePath",function(){var H=b.props,Z=H.name,K=H.fieldContext,te=K.prefixName,le=te===void 0?[]:te;return Z!==void 0?[].concat(Xr(le),Xr(Z)):[]}),jt(Di(b),"getRules",function(){var H=b.props,Z=H.rules,K=Z===void 0?[]:Z,te=H.fieldContext;return K.map(function(le){return typeof le=="function"?le(te):le})}),jt(Di(b),"refresh",function(){b.mounted&&b.setState(function(H){var Z=H.resetCount;return{resetCount:Z+1}})}),jt(Di(b),"metaCache",null),jt(Di(b),"triggerMetaEvent",function(H){var Z=b.props.onMetaChange;if(Z){var K=nn(nn({},b.getMeta()),{},{destroy:H});X1(b.metaCache,K)||Z(K),b.metaCache=K}else b.metaCache=null}),jt(Di(b),"onStoreChange",function(H,Z,K){var te=b.props,le=te.shouldUpdate,Te=te.dependencies,pe=Te===void 0?[]:Te,ge=te.onReset,fe=K.store,me=b.getNamePath(),_e=b.getValue(H),Ie=b.getValue(fe),Ne=Z&&yg(Z,me);switch(K.type==="valueUpdate"&&K.source==="external"&&!X1(_e,Ie)&&(b.touched=!0,b.dirty=!0,b.validatePromise=null,b.errors=Uu,b.warnings=Uu,b.triggerMetaEvent()),K.type){case"reset":if(!Z||Ne){b.touched=!1,b.dirty=!1,b.validatePromise=void 0,b.errors=Uu,b.warnings=Uu,b.triggerMetaEvent(),ge==null||ge(),b.refresh();return}break;case"remove":{if(le&&R1(le,H,fe,_e,Ie,K)){b.reRender();return}break}case"setField":{var nt=K.data;if(Ne){"touched"in nt&&(b.touched=nt.touched),"validating"in nt&&!("originRCField"in nt)&&(b.validatePromise=nt.validating?Promise.resolve([]):null),"errors"in nt&&(b.errors=nt.errors||Uu),"warnings"in nt&&(b.warnings=nt.warnings||Uu),b.dirty=!0,b.triggerMetaEvent(),b.reRender();return}else if("value"in nt&&yg(Z,me,!0)){b.reRender();return}if(le&&!me.length&&R1(le,H,fe,_e,Ie,K)){b.reRender();return}break}case"dependenciesUpdate":{var Le=pe.map(ra);if(Le.some(function(Pe){return yg(K.relatedFields,Pe)})){b.reRender();return}break}default:if(Ne||(!pe.length||me.length||le)&&R1(le,H,fe,_e,Ie,K)){b.reRender();return}break}le===!0&&b.reRender()}),jt(Di(b),"validateRules",function(H){var Z=b.getNamePath(),K=b.getValue(),te=H||{},le=te.triggerName,Te=te.validateOnly,pe=Te===void 0?!1:Te,ge=Promise.resolve().then(um(gc().mark(function fe(){var me,_e,Ie,Ne,nt,Le,Pe;return gc().wrap(function(at){for(;;)switch(at.prev=at.next){case 0:if(b.mounted){at.next=2;break}return at.abrupt("return",[]);case 2:if(me=b.props,_e=me.validateFirst,Ie=_e===void 0?!1:_e,Ne=me.messageVariables,nt=me.validateDebounce,Le=b.getRules(),le&&(Le=Le.filter(function(Qe){return Qe}).filter(function(Qe){var lt=Qe.validateTrigger;if(!lt)return!0;var Ct=Tw(lt);return Ct.includes(le)})),!(nt&&le)){at.next=10;break}return at.next=8,new Promise(function(Qe){setTimeout(Qe,nt)});case 8:if(b.validatePromise===ge){at.next=10;break}return at.abrupt("return",[]);case 10:return Pe=ZB(Z,K,Le,H,Ie,Ne),Pe.catch(function(Qe){return Qe}).then(function(){var Qe=arguments.length>0&&arguments[0]!==void 0?arguments[0]:Uu;if(b.validatePromise===ge){var lt;b.validatePromise=null;var Ct=[],Rt=[];(lt=Qe.forEach)===null||lt===void 0||lt.call(Qe,function(Nt){var At=Nt.rule.warningOnly,xt=Nt.errors,gt=xt===void 0?Uu:xt;At?Rt.push.apply(Rt,Xr(gt)):Ct.push.apply(Ct,Xr(gt))}),b.errors=Ct,b.warnings=Rt,b.triggerMetaEvent(),b.reRender()}}),at.abrupt("return",Pe);case 13:case"end":return at.stop()}},fe)})));return pe||(b.validatePromise=ge,b.dirty=!0,b.errors=Uu,b.warnings=Uu,b.triggerMetaEvent(),b.reRender()),ge}),jt(Di(b),"isFieldValidating",function(){return!!b.validatePromise}),jt(Di(b),"isFieldTouched",function(){return b.touched}),jt(Di(b),"isFieldDirty",function(){if(b.dirty||b.props.initialValue!==void 0)return!0;var H=b.props.fieldContext,Z=H.getInternalHooks(tm),K=Z.getInitialValue;return K(b.getNamePath())!==void 0}),jt(Di(b),"getErrors",function(){return b.errors}),jt(Di(b),"getWarnings",function(){return b.warnings}),jt(Di(b),"isListField",function(){return b.props.isListField}),jt(Di(b),"isList",function(){return b.props.isList}),jt(Di(b),"isPreserve",function(){return b.props.preserve}),jt(Di(b),"getMeta",function(){b.prevValidating=b.isFieldValidating();var H={touched:b.isFieldTouched(),validating:b.prevValidating,errors:b.errors,warnings:b.warnings,name:b.getNamePath(),validated:b.validatePromise===null};return H}),jt(Di(b),"getOnlyChild",function(H){if(typeof H=="function"){var Z=b.getMeta();return nn(nn({},b.getOnlyChild(H(b.getControlled(),Z,b.props.fieldContext))),{},{isFunction:!0})}var K=G_(H);return K.length!==1||!se.isValidElement(K[0])?{child:K,isFunction:!1}:{child:K[0],isFunction:!1}}),jt(Di(b),"getValue",function(H){var Z=b.props.fieldContext.getFieldsValue,K=b.getNamePath();return Cd(H||Z(!0),K)}),jt(Di(b),"getControlled",function(){var H=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},Z=b.props,K=Z.name,te=Z.trigger,le=Z.validateTrigger,Te=Z.getValueFromEvent,pe=Z.normalize,ge=Z.valuePropName,fe=Z.getValueProps,me=Z.fieldContext,_e=le!==void 0?le:me.validateTrigger,Ie=b.getNamePath(),Ne=me.getInternalHooks,nt=me.getFieldsValue,Le=Ne(tm),Pe=Le.dispatch,rt=b.getValue(),at=fe||function(Nt){return jt({},ge,Nt)},Qe=H[te],lt=K!==void 0?at(rt):{},Ct=nn(nn({},H),lt);Ct[te]=function(){b.touched=!0,b.dirty=!0,b.triggerMetaEvent();for(var Nt,At=arguments.length,xt=new Array(At),gt=0;gt<At;gt++)xt[gt]=arguments[gt];Te?Nt=Te.apply(void 0,xt):Nt=JB.apply(void 0,[ge].concat(xt)),pe&&(Nt=pe(Nt,rt,nt(!0))),Nt!==rt&&Pe({type:"updateValue",namePath:Ie,value:Nt}),Qe&&Qe.apply(void 0,xt)};var Rt=Tw(_e||[]);return Rt.forEach(function(Nt){var At=Ct[Nt];Ct[Nt]=function(){At&&At.apply(void 0,arguments);var xt=b.props.rules;xt&&xt.length&&Pe({type:"validateField",namePath:Ie,triggerName:Nt})}}),Ct}),_.fieldContext){var z=_.fieldContext.getInternalHooks,O=z(tm),r=O.initEntityValue;r(Di(b))}return b}return el(f,[{key:"componentDidMount",value:function(){var b=this.props,z=b.shouldUpdate,O=b.fieldContext;if(this.mounted=!0,O){var r=O.getInternalHooks,H=r(tm),Z=H.registerField;this.cancelRegisterFunc=Z(this)}z===!0&&this.reRender()}},{key:"componentWillUnmount",value:function(){this.cancelRegister(),this.triggerMetaEvent(!0),this.mounted=!1}},{key:"reRender",value:function(){this.mounted&&this.forceUpdate()}},{key:"render",value:function(){var b=this.state.resetCount,z=this.props.children,O=this.getOnlyChild(z),r=O.child,H=O.isFunction,Z;return H?Z=r:se.isValidElement(r)?Z=se.cloneElement(r,this.getControlled(r.props)):(xu(!r,"`children` of Field is not validate ReactElement."),Z=r),se.createElement(se.Fragment,{key:b},Z)}}]),f}(se.Component);jt(qS,"contextType",Eg);jt(qS,"defaultProps",{trigger:"onChange",valuePropName:"value"});function xP(i){var l,f=i.name,_=Ja(i,QB),b=se.useContext(Eg),z=se.useContext(dx),O=f!==void 0?ra(f):void 0,r=(l=_.isListField)!==null&&l!==void 0?l:!!z,H="keep";return r||(H="_".concat((O||[]).join("_"))),se.createElement(qS,$s({key:H,name:O,isListField:r},_,{fieldContext:b}))}function e5(i){var l=i.name,f=i.initialValue,_=i.children,b=i.rules,z=i.validateTrigger,O=i.isListField,r=se.useContext(Eg),H=se.useContext(dx),Z=se.useRef({keys:[],id:0}),K=Z.current,te=se.useMemo(function(){var ge=ra(r.prefixName)||[];return[].concat(Xr(ge),Xr(ra(l)))},[r.prefixName,l]),le=se.useMemo(function(){return nn(nn({},r),{},{prefixName:te})},[r,te]),Te=se.useMemo(function(){return{getKey:function(fe){var me=te.length,_e=fe[me];return[K.keys[_e],fe.slice(me+1)]}}},[te]);if(typeof _!="function")return xu(!1,"Form.List only accepts function as children."),null;var pe=function(fe,me,_e){var Ie=_e.source;return Ie==="internal"?!1:fe!==me};return se.createElement(dx.Provider,{value:Te},se.createElement(Eg.Provider,{value:le},se.createElement(xP,{name:[],shouldUpdate:pe,rules:b,validateTrigger:z,initialValue:f,isList:!0,isListField:O??!!H},function(ge,fe){var me=ge.value,_e=me===void 0?[]:me,Ie=ge.onChange,Ne=r.getFieldValue,nt=function(){var at=Ne(te||[]);return at||[]},Le={add:function(at,Qe){var lt=nt();Qe>=0&&Qe<=lt.length?(K.keys=[].concat(Xr(K.keys.slice(0,Qe)),[K.id],Xr(K.keys.slice(Qe))),Ie([].concat(Xr(lt.slice(0,Qe)),[at],Xr(lt.slice(Qe))))):(K.keys=[].concat(Xr(K.keys),[K.id]),Ie([].concat(Xr(lt),[at]))),K.id+=1},remove:function(at){var Qe=nt(),lt=new Set(Array.isArray(at)?at:[at]);lt.size<=0||(K.keys=K.keys.filter(function(Ct,Rt){return!lt.has(Rt)}),Ie(Qe.filter(function(Ct,Rt){return!lt.has(Rt)})))},move:function(at,Qe){if(at!==Qe){var lt=nt();at<0||at>=lt.length||Qe<0||Qe>=lt.length||(K.keys=WM(K.keys,at,Qe),Ie(WM(lt,at,Qe)))}}},Pe=_e||[];return Array.isArray(Pe)||(Pe=[]),_(Pe.map(function(rt,at){var Qe=K.keys[at];return Qe===void 0&&(K.keys[at]=K.id,Qe=K.keys[at],K.id+=1),{name:at,key:Qe,isListField:!0}}),Le,fe)})))}function t5(i){var l=!1,f=i.length,_=[];return i.length?new Promise(function(b,z){i.forEach(function(O,r){O.catch(function(H){return l=!0,H}).then(function(H){f-=1,_[r]=H,!(f>0)&&(l&&z(_),b(_))})})}):Promise.resolve([])}var bP="__@field_split__";function k1(i){return i.map(function(l){return"".concat(li(l),":").concat(l)}).join(bP)}var Gm=function(){function i(){Qa(this,i),jt(this,"kvs",new Map)}return el(i,[{key:"set",value:function(f,_){this.kvs.set(k1(f),_)}},{key:"get",value:function(f){return this.kvs.get(k1(f))}},{key:"update",value:function(f,_){var b=this.get(f),z=_(b);z?this.set(f,z):this.delete(f)}},{key:"delete",value:function(f){this.kvs.delete(k1(f))}},{key:"map",value:function(f){return Xr(this.kvs.entries()).map(function(_){var b=Gn(_,2),z=b[0],O=b[1],r=z.split(bP);return f({key:r.map(function(H){var Z=H.match(/^([^:]*):(.*)$/),K=Gn(Z,3),te=K[1],le=K[2];return te==="number"?Number(le):le}),value:O})})}},{key:"toJSON",value:function(){var f={};return this.map(function(_){var b=_.key,z=_.value;return f[b.join(".")]=z,null}),f}}]),i}(),n5=["name"],r5=el(function i(l){var f=this;Qa(this,i),jt(this,"formHooked",!1),jt(this,"forceRootUpdate",void 0),jt(this,"subscribable",!0),jt(this,"store",{}),jt(this,"fieldEntities",[]),jt(this,"initialValues",{}),jt(this,"callbacks",{}),jt(this,"validateMessages",null),jt(this,"preserve",null),jt(this,"lastValidatePromise",null),jt(this,"getForm",function(){return{getFieldValue:f.getFieldValue,getFieldsValue:f.getFieldsValue,getFieldError:f.getFieldError,getFieldWarning:f.getFieldWarning,getFieldsError:f.getFieldsError,isFieldsTouched:f.isFieldsTouched,isFieldTouched:f.isFieldTouched,isFieldValidating:f.isFieldValidating,isFieldsValidating:f.isFieldsValidating,resetFields:f.resetFields,setFields:f.setFields,setFieldValue:f.setFieldValue,setFieldsValue:f.setFieldsValue,validateFields:f.validateFields,submit:f.submit,_init:!0,getInternalHooks:f.getInternalHooks}}),jt(this,"getInternalHooks",function(_){return _===tm?(f.formHooked=!0,{dispatch:f.dispatch,initEntityValue:f.initEntityValue,registerField:f.registerField,useSubscribe:f.useSubscribe,setInitialValues:f.setInitialValues,destroyForm:f.destroyForm,setCallbacks:f.setCallbacks,setValidateMessages:f.setValidateMessages,getFields:f.getFields,setPreserve:f.setPreserve,getInitialValue:f.getInitialValue,registerWatch:f.registerWatch}):(xu(!1,"`getInternalHooks` is internal usage. Should not call directly."),null)}),jt(this,"useSubscribe",function(_){f.subscribable=_}),jt(this,"prevWithoutPreserves",null),jt(this,"setInitialValues",function(_,b){if(f.initialValues=_||{},b){var z,O=pg(_,f.store);(z=f.prevWithoutPreserves)===null||z===void 0||z.map(function(r){var H=r.key;O=Ih(O,H,Cd(_,H))}),f.prevWithoutPreserves=null,f.updateStore(O)}}),jt(this,"destroyForm",function(_){if(_)f.updateStore({});else{var b=new Gm;f.getFieldEntities(!0).forEach(function(z){f.isMergedPreserve(z.isPreserve())||b.set(z.getNamePath(),!0)}),f.prevWithoutPreserves=b}}),jt(this,"getInitialValue",function(_){var b=Cd(f.initialValues,_);return _.length?pg(b):b}),jt(this,"setCallbacks",function(_){f.callbacks=_}),jt(this,"setValidateMessages",function(_){f.validateMessages=_}),jt(this,"setPreserve",function(_){f.preserve=_}),jt(this,"watchList",[]),jt(this,"registerWatch",function(_){return f.watchList.push(_),function(){f.watchList=f.watchList.filter(function(b){return b!==_})}}),jt(this,"notifyWatch",function(){var _=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[];if(f.watchList.length){var b=f.getFieldsValue(),z=f.getFieldsValue(!0);f.watchList.forEach(function(O){O(b,z,_)})}}),jt(this,"timeoutId",null),jt(this,"warningUnhooked",function(){}),jt(this,"updateStore",function(_){f.store=_}),jt(this,"getFieldEntities",function(){var _=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1;return _?f.fieldEntities.filter(function(b){return b.getNamePath().length}):f.fieldEntities}),jt(this,"getFieldsMap",function(){var _=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1,b=new Gm;return f.getFieldEntities(_).forEach(function(z){var O=z.getNamePath();b.set(O,z)}),b}),jt(this,"getFieldEntitiesForNamePathList",function(_){if(!_)return f.getFieldEntities(!0);var b=f.getFieldsMap(!0);return _.map(function(z){var O=ra(z);return b.get(O)||{INVALIDATE_NAME_PATH:ra(z)}})}),jt(this,"getFieldsValue",function(_,b){f.warningUnhooked();var z,O,r;if(_===!0||Array.isArray(_)?(z=_,O=b):_&&li(_)==="object"&&(r=_.strict,O=_.filter),z===!0&&!O)return f.store;var H=f.getFieldEntitiesForNamePathList(Array.isArray(z)?z:null),Z=[];return H.forEach(function(K){var te,le,Te="INVALIDATE_NAME_PATH"in K?K.INVALIDATE_NAME_PATH:K.getNamePath();if(r){var pe,ge;if((pe=(ge=K).isList)!==null&&pe!==void 0&&pe.call(ge))return}else if(!z&&(te=(le=K).isListField)!==null&&te!==void 0&&te.call(le))return;if(!O)Z.push(Te);else{var fe="getMeta"in K?K.getMeta():null;O(fe)&&Z.push(Te)}}),HM(f.store,Z.map(ra))}),jt(this,"getFieldValue",function(_){f.warningUnhooked();var b=ra(_);return Cd(f.store,b)}),jt(this,"getFieldsError",function(_){f.warningUnhooked();var b=f.getFieldEntitiesForNamePathList(_);return b.map(function(z,O){return z&&!("INVALIDATE_NAME_PATH"in z)?{name:z.getNamePath(),errors:z.getErrors(),warnings:z.getWarnings()}:{name:ra(_[O]),errors:[],warnings:[]}})}),jt(this,"getFieldError",function(_){f.warningUnhooked();var b=ra(_),z=f.getFieldsError([b])[0];return z.errors}),jt(this,"getFieldWarning",function(_){f.warningUnhooked();var b=ra(_),z=f.getFieldsError([b])[0];return z.warnings}),jt(this,"isFieldsTouched",function(){f.warningUnhooked();for(var _=arguments.length,b=new Array(_),z=0;z<_;z++)b[z]=arguments[z];var O=b[0],r=b[1],H,Z=!1;b.length===0?H=null:b.length===1?Array.isArray(O)?(H=O.map(ra),Z=!1):(H=null,Z=O):(H=O.map(ra),Z=r);var K=f.getFieldEntities(!0),te=function(fe){return fe.isFieldTouched()};if(!H)return Z?K.every(function(ge){return te(ge)||ge.isList()}):K.some(te);var le=new Gm;H.forEach(function(ge){le.set(ge,[])}),K.forEach(function(ge){var fe=ge.getNamePath();H.forEach(function(me){me.every(function(_e,Ie){return fe[Ie]===_e})&&le.update(me,function(_e){return[].concat(Xr(_e),[ge])})})});var Te=function(fe){return fe.some(te)},pe=le.map(function(ge){var fe=ge.value;return fe});return Z?pe.every(Te):pe.some(Te)}),jt(this,"isFieldTouched",function(_){return f.warningUnhooked(),f.isFieldsTouched([_])}),jt(this,"isFieldsValidating",function(_){f.warningUnhooked();var b=f.getFieldEntities();if(!_)return b.some(function(O){return O.isFieldValidating()});var z=_.map(ra);return b.some(function(O){var r=O.getNamePath();return yg(z,r)&&O.isFieldValidating()})}),jt(this,"isFieldValidating",function(_){return f.warningUnhooked(),f.isFieldsValidating([_])}),jt(this,"resetWithFieldInitialValue",function(){var _=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},b=new Gm,z=f.getFieldEntities(!0);z.forEach(function(H){var Z=H.props.initialValue,K=H.getNamePath();if(Z!==void 0){var te=b.get(K)||new Set;te.add({entity:H,value:Z}),b.set(K,te)}});var O=function(Z){Z.forEach(function(K){var te=K.props.initialValue;if(te!==void 0){var le=K.getNamePath(),Te=f.getInitialValue(le);if(Te!==void 0)xu(!1,"Form already set 'initialValues' with path '".concat(le.join("."),"'. Field can not overwrite it."));else{var pe=b.get(le);if(pe&&pe.size>1)xu(!1,"Multiple Field with path '".concat(le.join("."),"' set 'initialValue'. Can not decide which one to pick."));else if(pe){var ge=f.getFieldValue(le),fe=K.isListField();!fe&&(!_.skipExist||ge===void 0)&&f.updateStore(Ih(f.store,le,Xr(pe)[0].value))}}}})},r;_.entities?r=_.entities:_.namePathList?(r=[],_.namePathList.forEach(function(H){var Z=b.get(H);if(Z){var K;(K=r).push.apply(K,Xr(Xr(Z).map(function(te){return te.entity})))}})):r=z,O(r)}),jt(this,"resetFields",function(_){f.warningUnhooked();var b=f.store;if(!_){f.updateStore(pg(f.initialValues)),f.resetWithFieldInitialValue(),f.notifyObservers(b,null,{type:"reset"}),f.notifyWatch();return}var z=_.map(ra);z.forEach(function(O){var r=f.getInitialValue(O);f.updateStore(Ih(f.store,O,r))}),f.resetWithFieldInitialValue({namePathList:z}),f.notifyObservers(b,z,{type:"reset"}),f.notifyWatch(z)}),jt(this,"setFields",function(_){f.warningUnhooked();var b=f.store,z=[];_.forEach(function(O){var r=O.name,H=Ja(O,n5),Z=ra(r);z.push(Z),"value"in H&&f.updateStore(Ih(f.store,Z,H.value)),f.notifyObservers(b,[Z],{type:"setField",data:O})}),f.notifyWatch(z)}),jt(this,"getFields",function(){var _=f.getFieldEntities(!0),b=_.map(function(z){var O=z.getNamePath(),r=z.getMeta(),H=nn(nn({},r),{},{name:O,value:f.getFieldValue(O)});return Object.defineProperty(H,"originRCField",{value:!0}),H});return b}),jt(this,"initEntityValue",function(_){var b=_.props.initialValue;if(b!==void 0){var z=_.getNamePath(),O=Cd(f.store,z);O===void 0&&f.updateStore(Ih(f.store,z,b))}}),jt(this,"isMergedPreserve",function(_){var b=_!==void 0?_:f.preserve;return b??!0}),jt(this,"registerField",function(_){f.fieldEntities.push(_);var b=_.getNamePath();if(f.notifyWatch([b]),_.props.initialValue!==void 0){var z=f.store;f.resetWithFieldInitialValue({entities:[_],skipExist:!0}),f.notifyObservers(z,[_.getNamePath()],{type:"valueUpdate",source:"internal"})}return function(O,r){var H=arguments.length>2&&arguments[2]!==void 0?arguments[2]:[];if(f.fieldEntities=f.fieldEntities.filter(function(te){return te!==_}),!f.isMergedPreserve(r)&&(!O||H.length>1)){var Z=O?void 0:f.getInitialValue(b);if(b.length&&f.getFieldValue(b)!==Z&&f.fieldEntities.every(function(te){return!vP(te.getNamePath(),b)})){var K=f.store;f.updateStore(Ih(K,b,Z,!0)),f.notifyObservers(K,[b],{type:"remove"}),f.triggerDependenciesUpdate(K,b)}}f.notifyWatch([b])}}),jt(this,"dispatch",function(_){switch(_.type){case"updateValue":{var b=_.namePath,z=_.value;f.updateValue(b,z);break}case"validateField":{var O=_.namePath,r=_.triggerName;f.validateFields([O],{triggerName:r});break}}}),jt(this,"notifyObservers",function(_,b,z){if(f.subscribable){var O=nn(nn({},z),{},{store:f.getFieldsValue(!0)});f.getFieldEntities().forEach(function(r){var H=r.onStoreChange;H(_,b,O)})}else f.forceRootUpdate()}),jt(this,"triggerDependenciesUpdate",function(_,b){var z=f.getDependencyChildrenFields(b);return z.length&&f.validateFields(z),f.notifyObservers(_,z,{type:"dependenciesUpdate",relatedFields:[b].concat(Xr(z))}),z}),jt(this,"updateValue",function(_,b){var z=ra(_),O=f.store;f.updateStore(Ih(f.store,z,b)),f.notifyObservers(O,[z],{type:"valueUpdate",source:"internal"}),f.notifyWatch([z]);var r=f.triggerDependenciesUpdate(O,z),H=f.callbacks.onValuesChange;if(H){var Z=HM(f.store,[z]);H(Z,f.getFieldsValue())}f.triggerOnFieldsChange([z].concat(Xr(r)))}),jt(this,"setFieldsValue",function(_){f.warningUnhooked();var b=f.store;if(_){var z=pg(f.store,_);f.updateStore(z)}f.notifyObservers(b,null,{type:"valueUpdate",source:"external"}),f.notifyWatch()}),jt(this,"setFieldValue",function(_,b){f.setFields([{name:_,value:b,errors:[],warnings:[]}])}),jt(this,"getDependencyChildrenFields",function(_){var b=new Set,z=[],O=new Gm;f.getFieldEntities().forEach(function(H){var Z=H.props.dependencies;(Z||[]).forEach(function(K){var te=ra(K);O.update(te,function(){var le=arguments.length>0&&arguments[0]!==void 0?arguments[0]:new Set;return le.add(H),le})})});var r=function H(Z){var K=O.get(Z)||new Set;K.forEach(function(te){if(!b.has(te)){b.add(te);var le=te.getNamePath();te.isFieldDirty()&&le.length&&(z.push(le),H(le))}})};return r(_),z}),jt(this,"triggerOnFieldsChange",function(_,b){var z=f.callbacks.onFieldsChange;if(z){var O=f.getFields();if(b){var r=new Gm;b.forEach(function(Z){var K=Z.name,te=Z.errors;r.set(K,te)}),O.forEach(function(Z){Z.errors=r.get(Z.name)||Z.errors})}var H=O.filter(function(Z){var K=Z.name;return yg(_,K)});H.length&&z(H,O)}}),jt(this,"validateFields",function(_,b){f.warningUnhooked();var z,O;Array.isArray(_)||typeof _=="string"||typeof b=="string"?(z=_,O=b):O=_;var r=!!z,H=r?z.map(ra):[],Z=[],K=String(Date.now()),te=new Set,le=O||{},Te=le.recursive,pe=le.dirty;f.getFieldEntities(!0).forEach(function(_e){if(r||H.push(_e.getNamePath()),!(!_e.props.rules||!_e.props.rules.length)&&!(pe&&!_e.isFieldDirty())){var Ie=_e.getNamePath();if(te.add(Ie.join(K)),!r||yg(H,Ie,Te)){var Ne=_e.validateRules(nn({validateMessages:nn(nn({},yP),f.validateMessages)},O));Z.push(Ne.then(function(){return{name:Ie,errors:[],warnings:[]}}).catch(function(nt){var Le,Pe=[],rt=[];return(Le=nt.forEach)===null||Le===void 0||Le.call(nt,function(at){var Qe=at.rule.warningOnly,lt=at.errors;Qe?rt.push.apply(rt,Xr(lt)):Pe.push.apply(Pe,Xr(lt))}),Pe.length?Promise.reject({name:Ie,errors:Pe,warnings:rt}):{name:Ie,errors:Pe,warnings:rt}}))}}});var ge=t5(Z);f.lastValidatePromise=ge,ge.catch(function(_e){return _e}).then(function(_e){var Ie=_e.map(function(Ne){var nt=Ne.name;return nt});f.notifyObservers(f.store,Ie,{type:"validateFinish"}),f.triggerOnFieldsChange(Ie,_e)});var fe=ge.then(function(){return f.lastValidatePromise===ge?Promise.resolve(f.getFieldsValue(H)):Promise.reject([])}).catch(function(_e){var Ie=_e.filter(function(Ne){return Ne&&Ne.errors.length});return Promise.reject({values:f.getFieldsValue(H),errorFields:Ie,outOfDate:f.lastValidatePromise!==ge})});fe.catch(function(_e){return _e});var me=H.filter(function(_e){return te.has(_e.join(K))});return f.triggerOnFieldsChange(me),fe}),jt(this,"submit",function(){f.warningUnhooked(),f.validateFields().then(function(_){var b=f.callbacks.onFinish;if(b)try{b(_)}catch(z){console.error(z)}}).catch(function(_){var b=f.callbacks.onFinishFailed;b&&b(_)})}),this.forceRootUpdate=l});function wP(i){var l=se.useRef(),f=se.useState({}),_=Gn(f,2),b=_[1];if(!l.current)if(i)l.current=i;else{var z=function(){b({})},O=new r5(z);l.current=O.getForm()}return[l.current]}var Lw=se.createContext({triggerFormChange:function(){},triggerFormFinish:function(){},registerForm:function(){},unregisterForm:function(){}}),i5=function(l){var f=l.validateMessages,_=l.onFormChange,b=l.onFormFinish,z=l.children,O=se.useContext(Lw),r=se.useRef({});return se.createElement(Lw.Provider,{value:nn(nn({},O),{},{validateMessages:nn(nn({},O.validateMessages),f),triggerFormChange:function(Z,K){_&&_(Z,{changedFields:K,forms:r.current}),O.triggerFormChange(Z,K)},triggerFormFinish:function(Z,K){b&&b(Z,{values:K,forms:r.current}),O.triggerFormFinish(Z,K)},registerForm:function(Z,K){Z&&(r.current=nn(nn({},r.current),{},jt({},Z,K))),O.registerForm(Z,K)},unregisterForm:function(Z){var K=nn({},r.current);delete K[Z],r.current=K,O.unregisterForm(Z)}})},z)},o5=["name","initialValues","fields","form","preserve","children","component","validateMessages","validateTrigger","onValuesChange","onFieldsChange","onFinish","onFinishFailed","clearOnDestroy"],s5=function(l,f){var _=l.name,b=l.initialValues,z=l.fields,O=l.form,r=l.preserve,H=l.children,Z=l.component,K=Z===void 0?"form":Z,te=l.validateMessages,le=l.validateTrigger,Te=le===void 0?"onChange":le,pe=l.onValuesChange,ge=l.onFieldsChange,fe=l.onFinish,me=l.onFinishFailed,_e=l.clearOnDestroy,Ie=Ja(l,o5),Ne=se.useRef(null),nt=se.useContext(Lw),Le=wP(O),Pe=Gn(Le,1),rt=Pe[0],at=rt.getInternalHooks(tm),Qe=at.useSubscribe,lt=at.setInitialValues,Ct=at.setCallbacks,Rt=at.setValidateMessages,Nt=at.setPreserve,At=at.destroyForm;se.useImperativeHandle(f,function(){return nn(nn({},rt),{},{nativeElement:Ne.current})}),se.useEffect(function(){return nt.registerForm(_,rt),function(){nt.unregisterForm(_)}},[nt,rt,_]),Rt(nn(nn({},nt.validateMessages),te)),Ct({onValuesChange:pe,onFieldsChange:function(Ot){if(nt.triggerFormChange(_,Ot),ge){for(var sn=arguments.length,hn=new Array(sn>1?sn-1:0),Tn=1;Tn<sn;Tn++)hn[Tn-1]=arguments[Tn];ge.apply(void 0,[Ot].concat(hn))}},onFinish:function(Ot){nt.triggerFormFinish(_,Ot),fe&&fe(Ot)},onFinishFailed:me}),Nt(r);var xt=se.useRef(null);lt(b,!xt.current),xt.current||(xt.current=!0),se.useEffect(function(){return function(){return At(_e)}},[]);var gt,ht=typeof H=="function";if(ht){var vt=rt.getFieldsValue(!0);gt=H(vt,rt)}else gt=H;Qe(!ht);var Ve=se.useRef();se.useEffect(function(){KB(Ve.current||[],z||[])||rt.setFields(z||[]),Ve.current=z},[z,rt]);var je=se.useMemo(function(){return nn(nn({},rt),{},{validateTrigger:Te})},[rt,Te]),it=se.createElement(dx.Provider,{value:null},se.createElement(Eg.Provider,{value:je},gt));return K===!1?it:se.createElement(K,$s({},Ie,{ref:Ne,onSubmit:function(Ot){Ot.preventDefault(),Ot.stopPropagation(),rt.submit()},onReset:function(Ot){var sn;Ot.preventDefault(),rt.resetFields(),(sn=Ie.onReset)===null||sn===void 0||sn.call(Ie,Ot)}}),it)};function GM(i){try{return JSON.stringify(i)}catch{return Math.random()}}function a5(){for(var i=arguments.length,l=new Array(i),f=0;f<i;f++)l[f]=arguments[f];var _=l[0],b=l[1],z=b===void 0?{}:b,O=mB(z)?{form:z}:z,r=O.form,H=se.useState(),Z=Gn(H,2),K=Z[0],te=Z[1],le=se.useMemo(function(){return GM(K)},[K]),Te=se.useRef(le);Te.current=le;var pe=se.useContext(Eg),ge=r||pe,fe=ge&&ge._init,me=ra(_),_e=se.useRef(me);return _e.current=me,se.useEffect(function(){if(fe){var Ie=ge.getFieldsValue,Ne=ge.getInternalHooks,nt=Ne(tm),Le=nt.registerWatch,Pe=function(lt,Ct){var Rt=O.preserve?Ct:lt;return typeof _=="function"?_(Rt):Cd(Rt,_e.current)},rt=Le(function(Qe,lt){var Ct=Pe(Qe,lt),Rt=GM(Ct);Te.current!==Rt&&(Te.current=Rt,te(Ct))}),at=Pe(Ie(),Ie(!0));return K!==at&&te(at),rt}},[fe]),K}var l5=se.forwardRef(s5),dy=l5;dy.FormProvider=i5;dy.Field=xP;dy.List=e5;dy.useForm=wP;dy.useWatch=a5;const xf=se.createContext({}),c5=i=>{let{children:l,status:f,override:_}=i;const b=se.useContext(xf),z=se.useMemo(()=>{const O=Object.assign({},b);return _&&delete O.isFormItemInput,f&&(delete O.status,delete O.hasFeedback,delete O.feedbackIcon),O},[f,_,b]);return se.createElement(xf.Provider,{value:z},l)},u5=se.createContext(void 0),Ow=i=>{const{space:l,form:f,children:_}=i;if(_==null)return null;let b=_;return f&&(b=Nn.createElement(c5,{override:!0,status:!0},b)),l&&(b=Nn.createElement(r4,null,b)),b},h5=function(){if(typeof navigator>"u"||typeof window>"u")return!1;var i=navigator.userAgent||navigator.vendor||window.opera;return/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino|android|ipad|playbook|silk/i.test(i)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw-(n|u)|c55\/|capi|ccwa|cdm-|cell|chtm|cldc|cmd-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc-s|devi|dica|dmob|do(c|p)o|ds(12|-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(-|_)|g1 u|g560|gene|gf-5|g-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd-(m|p|t)|hei-|hi(pt|ta)|hp( i|ip)|hs-c|ht(c(-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i-(20|go|ma)|i230|iac( |-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|-[a-w])|libw|lynx|m1-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|-([1-8]|c))|phil|pire|pl(ay|uc)|pn-2|po(ck|rt|se)|prox|psio|pt-g|qa-a|qc(07|12|21|32|60|-[2-7]|i-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h-|oo|p-)|sdk\/|se(c(-|0|1)|47|mc|nd|ri)|sgh-|shar|sie(-|m)|sk-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h-|v-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl-|tdg-|tel(i|m)|tim-|t-mo|to(pl|sh)|ts(70|m-|m3|m5)|tx-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas-|your|zeto|zte-/i.test(i==null?void 0:i.substr(0,4))};function d5(i){var l=i.prefixCls,f=i.align,_=i.arrow,b=i.arrowPos,z=_||{},O=z.className,r=z.content,H=b.x,Z=H===void 0?0:H,K=b.y,te=K===void 0?0:K,le=se.useRef();if(!f||!f.points)return null;var Te={position:"absolute"};if(f.autoArrow!==!1){var pe=f.points[0],ge=f.points[1],fe=pe[0],me=pe[1],_e=ge[0],Ie=ge[1];fe===_e||!["t","b"].includes(fe)?Te.top=te:fe==="t"?Te.top=0:Te.bottom=0,me===Ie||!["l","r"].includes(me)?Te.left=Z:me==="l"?Te.left=0:Te.right=0}return se.createElement("div",{ref:le,className:sr("".concat(l,"-arrow"),O),style:Te},r)}function f5(i){var l=i.prefixCls,f=i.open,_=i.zIndex,b=i.mask,z=i.motion;return b?se.createElement(ly,$s({},z,{motionAppear:!0,visible:f,removeOnLeave:!0}),function(O){var r=O.className;return se.createElement("div",{style:{zIndex:_},className:sr("".concat(l,"-mask"),r)})}):null}var p5=se.memo(function(i){var l=i.children;return l},function(i,l){return l.cache}),m5=se.forwardRef(function(i,l){var f=i.popup,_=i.className,b=i.prefixCls,z=i.style,O=i.target,r=i.onVisibleChanged,H=i.open,Z=i.keepDom,K=i.fresh,te=i.onClick,le=i.mask,Te=i.arrow,pe=i.arrowPos,ge=i.align,fe=i.motion,me=i.maskMotion,_e=i.forceRender,Ie=i.getPopupContainer,Ne=i.autoDestroy,nt=i.portal,Le=i.zIndex,Pe=i.onMouseEnter,rt=i.onMouseLeave,at=i.onPointerEnter,Qe=i.onPointerDownCapture,lt=i.ready,Ct=i.offsetX,Rt=i.offsetY,Nt=i.offsetR,At=i.offsetB,xt=i.onAlign,gt=i.onPrepare,ht=i.stretch,vt=i.targetWidth,Ve=i.targetHeight,je=typeof f=="function"?f():f,it=H||Z,Mt=(Ie==null?void 0:Ie.length)>0,Ot=se.useState(!Ie||!Mt),sn=Gn(Ot,2),hn=sn[0],Tn=sn[1];if(Ka(function(){!hn&&Mt&&O&&Tn(!0)},[hn,Mt,O]),!hn)return null;var Ut="auto",bn={left:"-1000vw",top:"-1000vh",right:Ut,bottom:Ut};if(lt||!H){var Re,Hr=ge.points,Nr=ge.dynamicInset||((Re=ge._experimental)===null||Re===void 0?void 0:Re.dynamicInset),Ar=Nr&&Hr[0][1]==="r",Ht=Nr&&Hr[0][0]==="b";Ar?(bn.right=Nt,bn.left=Ut):(bn.left=Ct,bn.right=Ut),Ht?(bn.bottom=At,bn.top=Ut):(bn.top=Rt,bn.bottom=Ut)}var Wr={};return ht&&(ht.includes("height")&&Ve?Wr.height=Ve:ht.includes("minHeight")&&Ve&&(Wr.minHeight=Ve),ht.includes("width")&&vt?Wr.width=vt:ht.includes("minWidth")&&vt&&(Wr.minWidth=vt)),H||(Wr.pointerEvents="none"),se.createElement(nt,{open:_e||it,getContainer:Ie&&function(){return Ie(O)},autoDestroy:Ne},se.createElement(f5,{prefixCls:b,open:H,zIndex:Le,mask:le,motion:me}),se.createElement(ay,{onResize:xt,disabled:!H},function(ar){return se.createElement(ly,$s({motionAppear:!0,motionEnter:!0,motionLeave:!0,removeOnLeave:!1,forceRender:_e,leavedClassName:"".concat(b,"-hidden")},fe,{onAppearPrepare:gt,onEnterPrepare:gt,visible:H,onVisibleChanged:function($n){var Gr;fe==null||(Gr=fe.onVisibleChanged)===null||Gr===void 0||Gr.call(fe,$n),r($n)}}),function(pi,$n){var Gr=pi.className,gi=pi.style,Pr=sr(b,Gr,_);return se.createElement("div",{ref:bf(ar,l,$n),className:Pr,style:nn(nn(nn(nn({"--arrow-x":"".concat(pe.x||0,"px"),"--arrow-y":"".concat(pe.y||0,"px")},bn),Wr),gi),{},{boxSizing:"border-box",zIndex:Le},z),onMouseEnter:Pe,onMouseLeave:rt,onPointerEnter:at,onClick:te,onPointerDownCapture:Qe},Te&&se.createElement(d5,{prefixCls:b,arrow:Te,arrowPos:pe,align:ge}),se.createElement(p5,{cache:!H&&!K},je))})}))}),g5=se.forwardRef(function(i,l){var f=i.children,_=i.getTriggerDOMNode,b=sy(f),z=se.useCallback(function(r){MS(l,_?_(r):r)},[_]),O=Tx(z,Cx(f));return b?se.cloneElement(f,{ref:O}):f}),qM=se.createContext(null);function ZM(i){return i?Array.isArray(i)?i:[i]:[]}function _5(i,l,f,_){return se.useMemo(function(){var b=ZM(f??l),z=ZM(_??l),O=new Set(b),r=new Set(z);return i&&(O.has("hover")&&(O.delete("hover"),O.add("click")),r.has("hover")&&(r.delete("hover"),r.add("click"))),[O,r]},[i,l,f,_])}function y5(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[],l=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[],f=arguments.length>2?arguments[2]:void 0;return f?i[0]===l[0]:i[0]===l[0]&&i[1]===l[1]}function v5(i,l,f,_){for(var b=f.points,z=Object.keys(i),O=0;O<z.length;O+=1){var r,H=z[O];if(y5((r=i[H])===null||r===void 0?void 0:r.points,b,_))return"".concat(l,"-placement-").concat(H)}return""}function XM(i,l,f,_){return l||(f?{motionName:"".concat(i,"-").concat(f)}:_?{motionName:_}:null)}function fy(i){return i.ownerDocument.defaultView}function Dw(i){for(var l=[],f=i==null?void 0:i.parentElement,_=["hidden","scroll","clip","auto"];f;){var b=fy(f).getComputedStyle(f),z=b.overflowX,O=b.overflowY,r=b.overflow;[z,O,r].some(function(H){return _.includes(H)})&&l.push(f),f=f.parentElement}return l}function iy(i){var l=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;return Number.isNaN(i)?l:i}function f_(i){return iy(parseFloat(i),0)}function YM(i,l){var f=nn({},i);return(l||[]).forEach(function(_){if(!(_ instanceof HTMLBodyElement||_ instanceof HTMLHtmlElement)){var b=fy(_).getComputedStyle(_),z=b.overflow,O=b.overflowClipMargin,r=b.borderTopWidth,H=b.borderBottomWidth,Z=b.borderLeftWidth,K=b.borderRightWidth,te=_.getBoundingClientRect(),le=_.offsetHeight,Te=_.clientHeight,pe=_.offsetWidth,ge=_.clientWidth,fe=f_(r),me=f_(H),_e=f_(Z),Ie=f_(K),Ne=iy(Math.round(te.width/pe*1e3)/1e3),nt=iy(Math.round(te.height/le*1e3)/1e3),Le=(pe-ge-_e-Ie)*Ne,Pe=(le-Te-fe-me)*nt,rt=fe*nt,at=me*nt,Qe=_e*Ne,lt=Ie*Ne,Ct=0,Rt=0;if(z==="clip"){var Nt=f_(O);Ct=Nt*Ne,Rt=Nt*nt}var At=te.x+Qe-Ct,xt=te.y+rt-Rt,gt=At+te.width+2*Ct-Qe-lt-Le,ht=xt+te.height+2*Rt-rt-at-Pe;f.left=Math.max(f.left,At),f.top=Math.max(f.top,xt),f.right=Math.min(f.right,gt),f.bottom=Math.min(f.bottom,ht)}}),f}function KM(i){var l=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,f="".concat(l),_=f.match(/^(.*)\%$/);return _?i*(parseFloat(_[1])/100):parseFloat(f)}function JM(i,l){var f=l||[],_=Gn(f,2),b=_[0],z=_[1];return[KM(i.width,b),KM(i.height,z)]}function QM(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"";return[i[0],i[1]]}function qm(i,l){var f=l[0],_=l[1],b,z;return f==="t"?z=i.y:f==="b"?z=i.y+i.height:z=i.y+i.height/2,_==="l"?b=i.x:_==="r"?b=i.x+i.width:b=i.x+i.width/2,{x:b,y:z}}function tp(i,l){var f={t:"b",b:"t",l:"r",r:"l"};return i.map(function(_,b){return b===l?f[_]||"c":_}).join("")}function x5(i,l,f,_,b,z,O){var r=se.useState({ready:!1,offsetX:0,offsetY:0,offsetR:0,offsetB:0,arrowX:0,arrowY:0,scaleX:1,scaleY:1,align:b[_]||{}}),H=Gn(r,2),Z=H[0],K=H[1],te=se.useRef(0),le=se.useMemo(function(){return l?Dw(l):[]},[l]),Te=se.useRef({}),pe=function(){Te.current={}};i||pe();var ge=mc(function(){if(l&&f&&i){let ir=function(kn,Po){var yr=arguments.length>2&&arguments[2]!==void 0?arguments[2]:yn,ia=Ot.x+kn,Eo=Ot.y+Po,Fa=ia+Ar,Kn=Eo+Nr,qt=Math.max(ia,yr.left),Jn=Math.max(Eo,yr.top),Xn=Math.min(Fa,yr.right),ni=Math.min(Kn,yr.bottom);return Math.max(0,(Xn-qt)*(ni-Jn))},hs=function(){En=Ot.y+de,zn=En+Nr,Rn=Ot.x+oe,In=Rn+Ar};var Ys=ir,Da=hs,_e,Ie,Ne,nt,Le=l,Pe=Le.ownerDocument,rt=fy(Le),at=rt.getComputedStyle(Le),Qe=at.width,lt=at.height,Ct=at.position,Rt=Le.style.left,Nt=Le.style.top,At=Le.style.right,xt=Le.style.bottom,gt=Le.style.overflow,ht=nn(nn({},b[_]),z),vt=Pe.createElement("div");(_e=Le.parentElement)===null||_e===void 0||_e.appendChild(vt),vt.style.left="".concat(Le.offsetLeft,"px"),vt.style.top="".concat(Le.offsetTop,"px"),vt.style.position=Ct,vt.style.height="".concat(Le.offsetHeight,"px"),vt.style.width="".concat(Le.offsetWidth,"px"),Le.style.left="0",Le.style.top="0",Le.style.right="auto",Le.style.bottom="auto",Le.style.overflow="hidden";var Ve;if(Array.isArray(f))Ve={x:f[0],y:f[1],width:0,height:0};else{var je,it,Mt=f.getBoundingClientRect();Mt.x=(je=Mt.x)!==null&&je!==void 0?je:Mt.left,Mt.y=(it=Mt.y)!==null&&it!==void 0?it:Mt.top,Ve={x:Mt.x,y:Mt.y,width:Mt.width,height:Mt.height}}var Ot=Le.getBoundingClientRect();Ot.x=(Ie=Ot.x)!==null&&Ie!==void 0?Ie:Ot.left,Ot.y=(Ne=Ot.y)!==null&&Ne!==void 0?Ne:Ot.top;var sn=Pe.documentElement,hn=sn.clientWidth,Tn=sn.clientHeight,Ut=sn.scrollWidth,bn=sn.scrollHeight,Re=sn.scrollTop,Hr=sn.scrollLeft,Nr=Ot.height,Ar=Ot.width,Ht=Ve.height,Wr=Ve.width,ar={left:0,top:0,right:hn,bottom:Tn},pi={left:-Hr,top:-Re,right:Ut-Hr,bottom:bn-Re},$n=ht.htmlRegion,Gr="visible",gi="visibleFirst";$n!=="scroll"&&$n!==gi&&($n=Gr);var Pr=$n===gi,ci=YM(pi,le),Un=YM(ar,le),yn=$n===Gr?Un:ci,Ir=Pr?Un:yn;Le.style.left="auto",Le.style.top="auto",Le.style.right="0",Le.style.bottom="0";var ui=Le.getBoundingClientRect();Le.style.left=Rt,Le.style.top=Nt,Le.style.right=At,Le.style.bottom=xt,Le.style.overflow=gt,(nt=Le.parentElement)===null||nt===void 0||nt.removeChild(vt);var _i=iy(Math.round(Ar/parseFloat(Qe)*1e3)/1e3),Lr=iy(Math.round(Nr/parseFloat(lt)*1e3)/1e3);if(_i===0||Lr===0||q_(f)&&!sP(f))return;var yi=ht.offset,oi=ht.targetOffset,qi=JM(Ot,yi),Ci=Gn(qi,2),mr=Ci[0],dr=Ci[1],wo=JM(Ve,oi),Zi=Gn(wo,2),ko=Zi[0],nr=Zi[1];Ve.x-=ko,Ve.y-=nr;var ss=ht.points||[],Vs=Gn(ss,2),io=Vs[0],as=Vs[1],ls=QM(as),Ao=QM(io),Ts=qm(Ve,ls),oo=qm(Ot,Ao),bt=nn({},ht),oe=Ts.x-oo.x+mr,de=Ts.y-oo.y+dr,Se=ir(oe,de),He=ir(oe,de,Un),$e=qm(Ve,["t","l"]),et=qm(Ot,["t","l"]),_t=qm(Ve,["b","r"]),Ke=qm(Ot,["b","r"]),mt=ht.overflow||{},wt=mt.adjustX,Tt=mt.adjustY,Jt=mt.shiftX,fn=mt.shiftY,on=function(Po){return typeof Po=="boolean"?Po:Po>=0},En,zn,Rn,In;hs();var kr=on(Tt),lr=Ao[0]===ls[0];if(kr&&Ao[0]==="t"&&(zn>Ir.bottom||Te.current.bt)){var Hn=de;lr?Hn-=Nr-Ht:Hn=$e.y-Ke.y-dr;var Br=ir(oe,Hn),ti=ir(oe,Hn,Un);Br>Se||Br===Se&&(!Pr||ti>=He)?(Te.current.bt=!0,de=Hn,dr=-dr,bt.points=[tp(Ao,0),tp(ls,0)]):Te.current.bt=!1}if(kr&&Ao[0]==="b"&&(En<Ir.top||Te.current.tb)){var zr=de;lr?zr+=Nr-Ht:zr=_t.y-et.y-dr;var po=ir(oe,zr),so=ir(oe,zr,Un);po>Se||po===Se&&(!Pr||so>=He)?(Te.current.tb=!0,de=zr,dr=-dr,bt.points=[tp(Ao,0),tp(ls,0)]):Te.current.tb=!1}var ao=on(wt),zs=Ao[1]===ls[1];if(ao&&Ao[1]==="l"&&(In>Ir.right||Te.current.rl)){var cs=oe;zs?cs-=Ar-Wr:cs=$e.x-Ke.x-mr;var Al=ir(cs,de),Xs=ir(cs,de,Un);Al>Se||Al===Se&&(!Pr||Xs>=He)?(Te.current.rl=!0,oe=cs,mr=-mr,bt.points=[tp(Ao,1),tp(ls,1)]):Te.current.rl=!1}if(ao&&Ao[1]==="r"&&(Rn<Ir.left||Te.current.lr)){var lo=oe;zs?lo+=Ar-Wr:lo=_t.x-et.x-mr;var Il=ir(lo,de),zo=ir(lo,de,Un);Il>Se||Il===Se&&(!Pr||zo>=He)?(Te.current.lr=!0,oe=lo,mr=-mr,bt.points=[tp(Ao,1),tp(ls,1)]):Te.current.lr=!1}hs();var $o=Jt===!0?0:Jt;typeof $o=="number"&&(Rn<Un.left&&(oe-=Rn-Un.left-mr,Ve.x+Wr<Un.left+$o&&(oe+=Ve.x-Un.left+Wr-$o)),In>Un.right&&(oe-=In-Un.right-mr,Ve.x>Un.right-$o&&(oe+=Ve.x-Un.right+$o)));var Yo=fn===!0?0:fn;typeof Yo=="number"&&(En<Un.top&&(de-=En-Un.top-dr,Ve.y+Ht<Un.top+Yo&&(de+=Ve.y-Un.top+Ht-Yo)),zn>Un.bottom&&(de-=zn-Un.bottom-dr,Ve.y>Un.bottom-Yo&&(de+=Ve.y-Un.bottom+Yo)));var tl=Ot.x+oe,ya=tl+Ar,co=Ot.y+de,So=co+Nr,Cs=Ve.x,Ms=Cs+Wr,Vo=Ve.y,us=Vo+Ht,mo=Math.max(tl,Cs),Io=Math.min(ya,Ms),Uo=(mo+Io)/2,va=Uo-tl,xa=Math.max(co,Vo),hi=Math.min(So,us),As=(xa+hi)/2,nl=As-co;O==null||O(l,bt);var Oa=ui.right-Ot.x-(oe+Ot.width),go=ui.bottom-Ot.y-(de+Ot.height);_i===1&&(oe=Math.round(oe),Oa=Math.round(Oa)),Lr===1&&(de=Math.round(de),go=Math.round(go));var Ls={ready:!0,offsetX:oe/_i,offsetY:de/Lr,offsetR:Oa/_i,offsetB:go/Lr,arrowX:va/_i,arrowY:nl/Lr,scaleX:_i,scaleY:Lr,align:bt};K(Ls)}}),fe=function(){te.current+=1;var Ie=te.current;Promise.resolve().then(function(){te.current===Ie&&ge()})},me=function(){K(function(Ie){return nn(nn({},Ie),{},{ready:!1})})};return Ka(me,[_]),Ka(function(){i||me()},[i]),[Z.ready,Z.offsetX,Z.offsetY,Z.offsetR,Z.offsetB,Z.arrowX,Z.arrowY,Z.scaleX,Z.scaleY,Z.align,fe]}function b5(i,l,f,_,b){Ka(function(){if(i&&l&&f){let le=function(){_(),b()};var te=le,z=l,O=f,r=Dw(z),H=Dw(O),Z=fy(O),K=new Set([Z].concat(Xr(r),Xr(H)));return K.forEach(function(Te){Te.addEventListener("scroll",le,{passive:!0})}),Z.addEventListener("resize",le,{passive:!0}),_(),function(){K.forEach(function(Te){Te.removeEventListener("scroll",le),Z.removeEventListener("resize",le)})}}},[i,l,f])}function w5(i,l,f,_,b,z,O,r){var H=se.useRef(i);H.current=i;var Z=se.useRef(!1);se.useEffect(function(){if(l&&_&&(!b||z)){var te=function(){Z.current=!1},le=function(fe){var me;H.current&&!O(((me=fe.composedPath)===null||me===void 0||(me=me.call(fe))===null||me===void 0?void 0:me[0])||fe.target)&&!Z.current&&r(!1)},Te=fy(_);Te.addEventListener("pointerdown",te,!0),Te.addEventListener("mousedown",le,!0),Te.addEventListener("contextmenu",le,!0);var pe=ux(f);return pe&&(pe.addEventListener("mousedown",le,!0),pe.addEventListener("contextmenu",le,!0)),function(){Te.removeEventListener("pointerdown",te,!0),Te.removeEventListener("mousedown",le,!0),Te.removeEventListener("contextmenu",le,!0),pe&&(pe.removeEventListener("mousedown",le,!0),pe.removeEventListener("contextmenu",le,!0))}}},[l,f,_,b,z]);function K(){Z.current=!0}return K}var S5=["prefixCls","children","action","showAction","hideAction","popupVisible","defaultPopupVisible","onPopupVisibleChange","afterPopupVisibleChange","mouseEnterDelay","mouseLeaveDelay","focusDelay","blurDelay","mask","maskClosable","getPopupContainer","forceRender","autoDestroy","destroyPopupOnHide","popup","popupClassName","popupStyle","popupPlacement","builtinPlacements","popupAlign","zIndex","stretch","getPopupClassNameFromAlign","fresh","alignPoint","onPopupClick","onPopupAlign","arrow","popupMotion","maskMotion","popupTransitionName","popupAnimation","maskTransitionName","maskAnimation","className","getTriggerDOMNode"];function E5(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:mP,l=se.forwardRef(function(f,_){var b=f.prefixCls,z=b===void 0?"rc-trigger-popup":b,O=f.children,r=f.action,H=r===void 0?"hover":r,Z=f.showAction,K=f.hideAction,te=f.popupVisible,le=f.defaultPopupVisible,Te=f.onPopupVisibleChange,pe=f.afterPopupVisibleChange,ge=f.mouseEnterDelay,fe=f.mouseLeaveDelay,me=fe===void 0?.1:fe,_e=f.focusDelay,Ie=f.blurDelay,Ne=f.mask,nt=f.maskClosable,Le=nt===void 0?!0:nt,Pe=f.getPopupContainer,rt=f.forceRender,at=f.autoDestroy,Qe=f.destroyPopupOnHide,lt=f.popup,Ct=f.popupClassName,Rt=f.popupStyle,Nt=f.popupPlacement,At=f.builtinPlacements,xt=At===void 0?{}:At,gt=f.popupAlign,ht=f.zIndex,vt=f.stretch,Ve=f.getPopupClassNameFromAlign,je=f.fresh,it=f.alignPoint,Mt=f.onPopupClick,Ot=f.onPopupAlign,sn=f.arrow,hn=f.popupMotion,Tn=f.maskMotion,Ut=f.popupTransitionName,bn=f.popupAnimation,Re=f.maskTransitionName,Hr=f.maskAnimation,Nr=f.className,Ar=f.getTriggerDOMNode,Ht=Ja(f,S5),Wr=at||Qe||!1,ar=se.useState(!1),pi=Gn(ar,2),$n=pi[0],Gr=pi[1];Ka(function(){Gr(h5())},[]);var gi=se.useRef({}),Pr=se.useContext(qM),ci=se.useMemo(function(){return{registerSubPopup:function(qt,Jn){gi.current[qt]=Jn,Pr==null||Pr.registerSubPopup(qt,Jn)}}},[Pr]),Un=gP(),yn=se.useState(null),Ir=Gn(yn,2),ui=Ir[0],_i=Ir[1],Lr=se.useRef(null),yi=mc(function(Kn){Lr.current=Kn,q_(Kn)&&ui!==Kn&&_i(Kn),Pr==null||Pr.registerSubPopup(Un,Kn)}),oi=se.useState(null),qi=Gn(oi,2),Ci=qi[0],mr=qi[1],dr=se.useRef(null),wo=mc(function(Kn){q_(Kn)&&Ci!==Kn&&(mr(Kn),dr.current=Kn)}),Zi=se.Children.only(O),ko=(Zi==null?void 0:Zi.props)||{},nr={},ss=mc(function(Kn){var qt,Jn,Xn=Ci;return(Xn==null?void 0:Xn.contains(Kn))||((qt=ux(Xn))===null||qt===void 0?void 0:qt.host)===Kn||Kn===Xn||(ui==null?void 0:ui.contains(Kn))||((Jn=ux(ui))===null||Jn===void 0?void 0:Jn.host)===Kn||Kn===ui||Object.values(gi.current).some(function(ni){return(ni==null?void 0:ni.contains(Kn))||Kn===ni})}),Vs=XM(z,hn,bn,Ut),io=XM(z,Tn,Hr,Re),as=se.useState(le||!1),ls=Gn(as,2),Ao=ls[0],Ts=ls[1],oo=te??Ao,bt=mc(function(Kn){te===void 0&&Ts(Kn)});Ka(function(){Ts(te||!1)},[te]);var oe=se.useRef(oo);oe.current=oo;var de=se.useRef([]);de.current=[];var Se=mc(function(Kn){var qt;bt(Kn),((qt=de.current[de.current.length-1])!==null&&qt!==void 0?qt:oo)!==Kn&&(de.current.push(Kn),Te==null||Te(Kn))}),He=se.useRef(),$e=function(){clearTimeout(He.current)},et=function(qt){var Jn=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;$e(),Jn===0?Se(qt):He.current=setTimeout(function(){Se(qt)},Jn*1e3)};se.useEffect(function(){return $e},[]);var _t=se.useState(!1),Ke=Gn(_t,2),mt=Ke[0],wt=Ke[1];Ka(function(Kn){(!Kn||oo)&&wt(!0)},[oo]);var Tt=se.useState(null),Jt=Gn(Tt,2),fn=Jt[0],on=Jt[1],En=se.useState(null),zn=Gn(En,2),Rn=zn[0],In=zn[1],kr=function(qt){In([qt.clientX,qt.clientY])},lr=x5(oo,ui,it&&Rn!==null?Rn:Ci,Nt,xt,gt,Ot),Hn=Gn(lr,11),Br=Hn[0],ti=Hn[1],zr=Hn[2],po=Hn[3],so=Hn[4],ao=Hn[5],zs=Hn[6],cs=Hn[7],Al=Hn[8],Xs=Hn[9],lo=Hn[10],Il=_5($n,H,Z,K),zo=Gn(Il,2),$o=zo[0],Yo=zo[1],tl=$o.has("click"),ya=Yo.has("click")||Yo.has("contextMenu"),co=mc(function(){mt||lo()}),So=function(){oe.current&&it&&ya&&et(!1)};b5(oo,Ci,ui,co,So),Ka(function(){co()},[Rn,Nt]),Ka(function(){oo&&!(xt!=null&&xt[Nt])&&co()},[JSON.stringify(gt)]);var Cs=se.useMemo(function(){var Kn=v5(xt,z,Xs,it);return sr(Kn,Ve==null?void 0:Ve(Xs))},[Xs,Ve,xt,z,it]);se.useImperativeHandle(_,function(){return{nativeElement:dr.current,popupElement:Lr.current,forceAlign:co}});var Ms=se.useState(0),Vo=Gn(Ms,2),us=Vo[0],mo=Vo[1],Io=se.useState(0),Uo=Gn(Io,2),va=Uo[0],xa=Uo[1],hi=function(){if(vt&&Ci){var qt=Ci.getBoundingClientRect();mo(qt.width),xa(qt.height)}},As=function(){hi(),co()},nl=function(qt){wt(!1),lo(),pe==null||pe(qt)},Oa=function(){return new Promise(function(qt){hi(),on(function(){return qt})})};Ka(function(){fn&&(lo(),fn(),on(null))},[fn]);function go(Kn,qt,Jn,Xn){nr[Kn]=function(ni){var ba;Xn==null||Xn(ni),et(qt,Jn);for(var wr=arguments.length,rl=new Array(wr>1?wr-1:0),ds=1;ds<wr;ds++)rl[ds-1]=arguments[ds];(ba=ko[Kn])===null||ba===void 0||ba.call.apply(ba,[ko,ni].concat(rl))}}(tl||ya)&&(nr.onClick=function(Kn){var qt;oe.current&&ya?et(!1):!oe.current&&tl&&(kr(Kn),et(!0));for(var Jn=arguments.length,Xn=new Array(Jn>1?Jn-1:0),ni=1;ni<Jn;ni++)Xn[ni-1]=arguments[ni];(qt=ko.onClick)===null||qt===void 0||qt.call.apply(qt,[ko,Kn].concat(Xn))});var Ls=w5(oo,ya,Ci,ui,Ne,Le,ss,et),Ys=$o.has("hover"),Da=Yo.has("hover"),ir,hs;Ys&&(go("onMouseEnter",!0,ge,function(Kn){kr(Kn)}),go("onPointerEnter",!0,ge,function(Kn){kr(Kn)}),ir=function(qt){(oo||mt)&&ui!==null&&ui!==void 0&&ui.contains(qt.target)&&et(!0,ge)},it&&(nr.onMouseMove=function(Kn){var qt;(qt=ko.onMouseMove)===null||qt===void 0||qt.call(ko,Kn)})),Da&&(go("onMouseLeave",!1,me),go("onPointerLeave",!1,me),hs=function(){et(!1,me)}),$o.has("focus")&&go("onFocus",!0,_e),Yo.has("focus")&&go("onBlur",!1,Ie),$o.has("contextMenu")&&(nr.onContextMenu=function(Kn){var qt;oe.current&&Yo.has("contextMenu")?et(!1):(kr(Kn),et(!0)),Kn.preventDefault();for(var Jn=arguments.length,Xn=new Array(Jn>1?Jn-1:0),ni=1;ni<Jn;ni++)Xn[ni-1]=arguments[ni];(qt=ko.onContextMenu)===null||qt===void 0||qt.call.apply(qt,[ko,Kn].concat(Xn))}),Nr&&(nr.className=sr(ko.className,Nr));var kn=nn(nn({},ko),nr),Po={},yr=["onContextMenu","onClick","onMouseDown","onTouchStart","onMouseEnter","onMouseLeave","onFocus","onBlur"];yr.forEach(function(Kn){Ht[Kn]&&(Po[Kn]=function(){for(var qt,Jn=arguments.length,Xn=new Array(Jn),ni=0;ni<Jn;ni++)Xn[ni]=arguments[ni];(qt=kn[Kn])===null||qt===void 0||qt.call.apply(qt,[kn].concat(Xn)),Ht[Kn].apply(Ht,Xn)})});var ia=se.cloneElement(Zi,nn(nn({},kn),Po)),Eo={x:ao,y:zs},Fa=sn?nn({},sn!==!0?sn:{}):null;return se.createElement(se.Fragment,null,se.createElement(ay,{disabled:!oo,ref:wo,onResize:As},se.createElement(g5,{getTriggerDOMNode:Ar},ia)),se.createElement(qM.Provider,{value:ci},se.createElement(m5,{portal:i,ref:yi,prefixCls:z,popup:lt,className:sr(Ct,Cs),style:Rt,target:Ci,onMouseEnter:ir,onMouseLeave:hs,onPointerEnter:ir,zIndex:ht,open:oo,keepDom:mt,fresh:je,onClick:Mt,onPointerDownCapture:Ls,mask:Ne,motion:Vs,maskMotion:io,onVisibleChanged:nl,onPrepare:Oa,forceRender:rt,autoDestroy:Wr,getPopupContainer:Pe,align:Xs,arrow:Fa,arrowPos:Eo,ready:Br,offsetX:ti,offsetY:zr,offsetR:po,offsetB:so,onAlign:co,stretch:vt,targetWidth:us/cs,targetHeight:va/Al})))});return l}const T5=E5(mP);function Fw(i,l,f){return sr({[`${i}-status-success`]:l==="success",[`${i}-status-warning`]:l==="warning",[`${i}-status-error`]:l==="error",[`${i}-status-validating`]:l==="validating",[`${i}-has-feedback`]:f})}const ZS=(i,l)=>l||i,SP=function(i,l){let f=arguments.length>2&&arguments[2]!==void 0?arguments[2]:void 0;var _,b;const{variant:z,[i]:O}=se.useContext(Xo),r=se.useContext(u5),H=O==null?void 0:O.variant;let Z;typeof l<"u"?Z=l:f===!1?Z="borderless":Z=(b=(_=r??H)!==null&&_!==void 0?_:z)!==null&&b!==void 0?b:"outlined";const K=oD.includes(Z);return[Z,K]};var C5={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M909.6 854.5L649.9 594.8C690.2 542.7 712 479 712 412c0-80.2-31.3-155.4-87.9-212.1-56.6-56.7-132-87.9-212.1-87.9s-155.5 31.3-212.1 87.9C143.2 256.5 112 331.8 112 412c0 80.1 31.3 155.5 87.9 212.1C256.5 680.8 331.8 712 412 712c67 0 130.6-21.8 182.7-62l259.7 259.6a8.2 8.2 0 0011.6 0l43.6-43.5a8.2 8.2 0 000-11.6zM570.4 570.4C528 612.7 471.8 636 412 636s-116-23.3-158.4-65.6C211.3 528 188 471.8 188 412s23.3-116.1 65.6-158.4C296 211.3 352.2 188 412 188s116.1 23.2 158.4 65.6S636 352.2 636 412s-23.3 116.1-65.6 158.4z"}}]},name:"search",theme:"outlined"},M5=function(l,f){return se.createElement(xp,$s({},l,{ref:f,icon:C5}))},A5=se.forwardRef(M5);const EP=["xxl","xl","lg","md","sm","xs"],I5=i=>({xs:`(max-width: ${i.screenXSMax}px)`,sm:`(min-width: ${i.screenSM}px)`,md:`(min-width: ${i.screenMD}px)`,lg:`(min-width: ${i.screenLG}px)`,xl:`(min-width: ${i.screenXL}px)`,xxl:`(min-width: ${i.screenXXL}px)`}),P5=i=>{const l=i,f=[].concat(EP).reverse();return f.forEach((_,b)=>{const z=_.toUpperCase(),O=`screen${z}Min`,r=`screen${z}`;if(!(l[O]<=l[r]))throw new Error(`${O}<=${r} fails : !(${l[O]}<=${l[r]})`);if(b<f.length-1){const H=`screen${z}Max`;if(!(l[r]<=l[H]))throw new Error(`${r}<=${H} fails : !(${l[r]}<=${l[H]})`);const K=`screen${f[b+1].toUpperCase()}Min`;if(!(l[H]<=l[K]))throw new Error(`${H}<=${K} fails : !(${l[H]}<=${l[K]})`)}}),i};function R5(){const[,i]=Sf(),l=I5(P5(i));return Nn.useMemo(()=>{const f=new Map;let _=-1,b={};return{matchHandlers:{},dispatch(z){return b=z,f.forEach(O=>O(b)),f.size>=1},subscribe(z){return f.size||this.register(),_+=1,f.set(_,z),z(b),_},unsubscribe(z){f.delete(z),f.size||this.unregister()},unregister(){Object.keys(l).forEach(z=>{const O=l[z],r=this.matchHandlers[O];r==null||r.mql.removeListener(r==null?void 0:r.listener)}),f.clear()},register(){Object.keys(l).forEach(z=>{const O=l[z],r=Z=>{let{matches:K}=Z;this.dispatch(Object.assign(Object.assign({},b),{[z]:K}))},H=window.matchMedia(O);H.addListener(r),this.matchHandlers[O]={mql:H,listener:r},r(H)})},responsiveMap:l}},[i])}function k5(){const[,i]=se.useReducer(l=>l+1,0);return i}function z5(){let i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;const l=se.useRef({}),f=k5(),_=R5();return Ka(()=>{const b=_.subscribe(z=>{l.current=z,i&&f()});return()=>_.unsubscribe(b)},[]),l.current}const Bw=se.createContext({}),L5=i=>{const{antCls:l,componentCls:f,iconCls:_,avatarBg:b,avatarColor:z,containerSize:O,containerSizeLG:r,containerSizeSM:H,textFontSize:Z,textFontSizeLG:K,textFontSizeSM:te,borderRadius:le,borderRadiusLG:Te,borderRadiusSM:pe,lineWidth:ge,lineType:fe}=i,me=(_e,Ie,Ne)=>({width:_e,height:_e,borderRadius:"50%",[`&${f}-square`]:{borderRadius:Ne},[`&${f}-icon`]:{fontSize:Ie,[`> ${_}`]:{margin:0}}});return{[f]:Object.assign(Object.assign(Object.assign(Object.assign({},Ad(i)),{position:"relative",display:"inline-flex",justifyContent:"center",alignItems:"center",overflow:"hidden",color:z,whiteSpace:"nowrap",textAlign:"center",verticalAlign:"middle",background:b,border:`${Ur(ge)} ${fe} transparent`,"&-image":{background:"transparent"},[`${l}-image-img`]:{display:"block"}}),me(O,Z,le)),{"&-lg":Object.assign({},me(r,K,Te)),"&-sm":Object.assign({},me(H,te,pe)),"> img":{display:"block",width:"100%",height:"100%",objectFit:"cover"}})}},O5=i=>{const{componentCls:l,groupBorderColor:f,groupOverlapping:_,groupSpace:b}=i;return{[`${l}-group`]:{display:"inline-flex",[l]:{borderColor:f},"> *:not(:first-child)":{marginInlineStart:_}},[`${l}-group-popover`]:{[`${l} + ${l}`]:{marginInlineStart:b}}}},D5=i=>{const{controlHeight:l,controlHeightLG:f,controlHeightSM:_,fontSize:b,fontSizeLG:z,fontSizeXL:O,fontSizeHeading3:r,marginXS:H,marginXXS:Z,colorBorderBg:K}=i;return{containerSize:l,containerSizeLG:f,containerSizeSM:_,textFontSize:Math.round((z+O)/2),textFontSizeLG:r,textFontSizeSM:b,groupSpace:Z,groupOverlapping:-H,groupBorderColor:K}},TP=Ef("Avatar",i=>{const{colorTextLightSolid:l,colorTextPlaceholder:f}=i,_=Ml(i,{avatarBg:f,avatarColor:l});return[L5(_),O5(_)]},D5);var F5=function(i,l){var f={};for(var _ in i)Object.prototype.hasOwnProperty.call(i,_)&&l.indexOf(_)<0&&(f[_]=i[_]);if(i!=null&&typeof Object.getOwnPropertySymbols=="function")for(var b=0,_=Object.getOwnPropertySymbols(i);b<_.length;b++)l.indexOf(_[b])<0&&Object.prototype.propertyIsEnumerable.call(i,_[b])&&(f[_[b]]=i[_[b]]);return f};const B5=(i,l)=>{const[f,_]=se.useState(1),[b,z]=se.useState(!1),[O,r]=se.useState(!0),H=se.useRef(null),Z=se.useRef(null),K=bf(l,H),{getPrefixCls:te,avatar:le}=se.useContext(Xo),Te=se.useContext(Bw),pe=()=>{if(!Z.current||!H.current)return;const Ut=Z.current.offsetWidth,bn=H.current.offsetWidth;if(Ut!==0&&bn!==0){const{gap:Re=4}=i;Re*2<bn&&_(bn-Re*2<Ut?(bn-Re*2)/Ut:1)}};se.useEffect(()=>{z(!0)},[]),se.useEffect(()=>{r(!0),_(1)},[i.src]),se.useEffect(pe,[i.gap]);const ge=()=>{const{onError:Ut}=i;(Ut==null?void 0:Ut())!==!1&&r(!1)},{prefixCls:fe,shape:me,size:_e,src:Ie,srcSet:Ne,icon:nt,className:Le,rootClassName:Pe,alt:rt,draggable:at,children:Qe,crossOrigin:lt}=i,Ct=F5(i,["prefixCls","shape","size","src","srcSet","icon","className","rootClassName","alt","draggable","children","crossOrigin"]),Rt=bp(Ut=>{var bn,Re;return(Re=(bn=_e??(Te==null?void 0:Te.size))!==null&&bn!==void 0?bn:Ut)!==null&&Re!==void 0?Re:"default"}),Nt=Object.keys(typeof Rt=="object"?Rt||{}:{}).some(Ut=>["xs","sm","md","lg","xl","xxl"].includes(Ut)),At=z5(Nt),xt=se.useMemo(()=>{if(typeof Rt!="object")return{};const Ut=EP.find(Re=>At[Re]),bn=Rt[Ut];return bn?{width:bn,height:bn,fontSize:bn&&(nt||Qe)?bn/2:18}:{}},[At,Rt]),gt=te("avatar",fe),ht=cm(gt),[vt,Ve,je]=TP(gt,ht),it=sr({[`${gt}-lg`]:Rt==="large",[`${gt}-sm`]:Rt==="small"}),Mt=se.isValidElement(Ie),Ot=me||(Te==null?void 0:Te.shape)||"circle",sn=sr(gt,it,le==null?void 0:le.className,`${gt}-${Ot}`,{[`${gt}-image`]:Mt||Ie&&O,[`${gt}-icon`]:!!nt},je,ht,Le,Pe,Ve),hn=typeof Rt=="number"?{width:Rt,height:Rt,fontSize:nt?Rt/2:18}:{};let Tn;if(typeof Ie=="string"&&O)Tn=se.createElement("img",{src:Ie,draggable:at,srcSet:Ne,onError:ge,alt:rt,crossOrigin:lt});else if(Mt)Tn=Ie;else if(nt)Tn=nt;else if(b||f!==1){const Ut=`scale(${f})`,bn={msTransform:Ut,WebkitTransform:Ut,transform:Ut};Tn=se.createElement(ay,{onResize:pe},se.createElement("span",{className:`${gt}-string`,ref:Z,style:Object.assign({},bn)},Qe))}else Tn=se.createElement("span",{className:`${gt}-string`,style:{opacity:0},ref:Z},Qe);return delete Ct.onError,delete Ct.gap,vt(se.createElement("span",Object.assign({},Ct,{style:Object.assign(Object.assign(Object.assign(Object.assign({},hn),xt),le==null?void 0:le.style),Ct.style),className:sn,ref:K}),Tn))},CP=se.forwardRef(B5),fx=i=>i?typeof i=="function"?i():i:null;function XS(i){var l=i.children,f=i.prefixCls,_=i.id,b=i.overlayInnerStyle,z=i.bodyClassName,O=i.className,r=i.style;return se.createElement("div",{className:sr("".concat(f,"-content"),O),style:r},se.createElement("div",{className:sr("".concat(f,"-inner"),z),id:_,role:"tooltip",style:b},typeof l=="function"?l():l))}var Zm={shiftX:64,adjustY:1},Xm={adjustX:1,shiftY:!0},Hu=[0,0],N5={left:{points:["cr","cl"],overflow:Xm,offset:[-4,0],targetOffset:Hu},right:{points:["cl","cr"],overflow:Xm,offset:[4,0],targetOffset:Hu},top:{points:["bc","tc"],overflow:Zm,offset:[0,-4],targetOffset:Hu},bottom:{points:["tc","bc"],overflow:Zm,offset:[0,4],targetOffset:Hu},topLeft:{points:["bl","tl"],overflow:Zm,offset:[0,-4],targetOffset:Hu},leftTop:{points:["tr","tl"],overflow:Xm,offset:[-4,0],targetOffset:Hu},topRight:{points:["br","tr"],overflow:Zm,offset:[0,-4],targetOffset:Hu},rightTop:{points:["tl","tr"],overflow:Xm,offset:[4,0],targetOffset:Hu},bottomRight:{points:["tr","br"],overflow:Zm,offset:[0,4],targetOffset:Hu},rightBottom:{points:["bl","br"],overflow:Xm,offset:[4,0],targetOffset:Hu},bottomLeft:{points:["tl","bl"],overflow:Zm,offset:[0,4],targetOffset:Hu},leftBottom:{points:["br","bl"],overflow:Xm,offset:[-4,0],targetOffset:Hu}},j5=["overlayClassName","trigger","mouseEnterDelay","mouseLeaveDelay","overlayStyle","prefixCls","children","onVisibleChange","afterVisibleChange","transitionName","animation","motion","placement","align","destroyTooltipOnHide","defaultVisible","getTooltipContainer","overlayInnerStyle","arrowContent","overlay","id","showArrow","classNames","styles"],$5=function(l,f){var _=l.overlayClassName,b=l.trigger,z=b===void 0?["hover"]:b,O=l.mouseEnterDelay,r=O===void 0?0:O,H=l.mouseLeaveDelay,Z=H===void 0?.1:H,K=l.overlayStyle,te=l.prefixCls,le=te===void 0?"rc-tooltip":te,Te=l.children,pe=l.onVisibleChange,ge=l.afterVisibleChange,fe=l.transitionName,me=l.animation,_e=l.motion,Ie=l.placement,Ne=Ie===void 0?"right":Ie,nt=l.align,Le=nt===void 0?{}:nt,Pe=l.destroyTooltipOnHide,rt=Pe===void 0?!1:Pe,at=l.defaultVisible,Qe=l.getTooltipContainer,lt=l.overlayInnerStyle;l.arrowContent;var Ct=l.overlay,Rt=l.id,Nt=l.showArrow,At=Nt===void 0?!0:Nt,xt=l.classNames,gt=l.styles,ht=Ja(l,j5),vt=se.useRef(null);se.useImperativeHandle(f,function(){return vt.current});var Ve=nn({},ht);"visible"in l&&(Ve.popupVisible=l.visible);var je=function(){return se.createElement(XS,{key:"content",prefixCls:le,id:Rt,bodyClassName:xt==null?void 0:xt.body,overlayInnerStyle:nn(nn({},lt),gt==null?void 0:gt.body)},Ct)};return se.createElement(T5,$s({popupClassName:sr(_,xt==null?void 0:xt.root),prefixCls:le,popup:je,action:z,builtinPlacements:N5,popupPlacement:Ne,ref:vt,popupAlign:Le,getPopupContainer:Qe,onPopupVisibleChange:pe,afterPopupVisibleChange:ge,popupTransitionName:fe,popupAnimation:me,popupMotion:_e,defaultPopupVisible:at,autoDestroy:rt,mouseLeaveDelay:Z,popupStyle:nn(nn({},K),gt==null?void 0:gt.root),mouseEnterDelay:r,arrow:At},Ve),Te)};const V5=se.forwardRef($5);function MP(i){const{sizePopupArrow:l,borderRadiusXS:f,borderRadiusOuter:_}=i,b=l/2,z=0,O=b,r=_*1/Math.sqrt(2),H=b-_*(1-1/Math.sqrt(2)),Z=b-f*(1/Math.sqrt(2)),K=_*(Math.sqrt(2)-1)+f*(1/Math.sqrt(2)),te=2*b-Z,le=K,Te=2*b-r,pe=H,ge=2*b-z,fe=O,me=b*Math.sqrt(2)+_*(Math.sqrt(2)-2),_e=_*(Math.sqrt(2)-1),Ie=`polygon(${_e}px 100%, 50% ${_e}px, ${2*b-_e}px 100%, ${_e}px 100%)`,Ne=`path('M ${z} ${O} A ${_} ${_} 0 0 0 ${r} ${H} L ${Z} ${K} A ${f} ${f} 0 0 1 ${te} ${le} L ${Te} ${pe} A ${_} ${_} 0 0 0 ${ge} ${fe} Z')`;return{arrowShadowWidth:me,arrowPath:Ne,arrowPolygon:Ie}}const U5=(i,l,f)=>{const{sizePopupArrow:_,arrowPolygon:b,arrowPath:z,arrowShadowWidth:O,borderRadiusXS:r,calc:H}=i;return{pointerEvents:"none",width:_,height:_,overflow:"hidden","&::before":{position:"absolute",bottom:0,insetInlineStart:0,width:_,height:H(_).div(2).equal(),background:l,clipPath:{_multi_value_:!0,value:[b,z]},content:'""'},"&::after":{content:'""',position:"absolute",width:O,height:O,bottom:0,insetInline:0,margin:"auto",borderRadius:{_skip_check_:!0,value:`0 0 ${Ur(r)} 0`},transform:"translateY(50%) rotate(-135deg)",boxShadow:f,zIndex:0,background:"transparent"}}},AP=8;function YS(i){const{contentRadius:l,limitVerticalRadius:f}=i,_=l>12?l+2:12;return{arrowOffsetHorizontal:_,arrowOffsetVertical:f?AP:_}}function _v(i,l){return i?l:{}}function IP(i,l,f){const{componentCls:_,boxShadowPopoverArrow:b,arrowOffsetVertical:z,arrowOffsetHorizontal:O}=i,{arrowDistance:r=0,arrowPlacement:H={left:!0,right:!0,top:!0,bottom:!0}}={};return{[_]:Object.assign(Object.assign(Object.assign(Object.assign({[`${_}-arrow`]:[Object.assign(Object.assign({position:"absolute",zIndex:1,display:"block"},U5(i,l,b)),{"&:before":{background:l}})]},_v(!!H.top,{[[`&-placement-top > ${_}-arrow`,`&-placement-topLeft > ${_}-arrow`,`&-placement-topRight > ${_}-arrow`].join(",")]:{bottom:r,transform:"translateY(100%) rotate(180deg)"},[`&-placement-top > ${_}-arrow`]:{left:{_skip_check_:!0,value:"50%"},transform:"translateX(-50%) translateY(100%) rotate(180deg)"},"&-placement-topLeft":{"--arrow-offset-horizontal":O,[`> ${_}-arrow`]:{left:{_skip_check_:!0,value:O}}},"&-placement-topRight":{"--arrow-offset-horizontal":`calc(100% - ${Ur(O)})`,[`> ${_}-arrow`]:{right:{_skip_check_:!0,value:O}}}})),_v(!!H.bottom,{[[`&-placement-bottom > ${_}-arrow`,`&-placement-bottomLeft > ${_}-arrow`,`&-placement-bottomRight > ${_}-arrow`].join(",")]:{top:r,transform:"translateY(-100%)"},[`&-placement-bottom > ${_}-arrow`]:{left:{_skip_check_:!0,value:"50%"},transform:"translateX(-50%) translateY(-100%)"},"&-placement-bottomLeft":{"--arrow-offset-horizontal":O,[`> ${_}-arrow`]:{left:{_skip_check_:!0,value:O}}},"&-placement-bottomRight":{"--arrow-offset-horizontal":`calc(100% - ${Ur(O)})`,[`> ${_}-arrow`]:{right:{_skip_check_:!0,value:O}}}})),_v(!!H.left,{[[`&-placement-left > ${_}-arrow`,`&-placement-leftTop > ${_}-arrow`,`&-placement-leftBottom > ${_}-arrow`].join(",")]:{right:{_skip_check_:!0,value:r},transform:"translateX(100%) rotate(90deg)"},[`&-placement-left > ${_}-arrow`]:{top:{_skip_check_:!0,value:"50%"},transform:"translateY(-50%) translateX(100%) rotate(90deg)"},[`&-placement-leftTop > ${_}-arrow`]:{top:z},[`&-placement-leftBottom > ${_}-arrow`]:{bottom:z}})),_v(!!H.right,{[[`&-placement-right > ${_}-arrow`,`&-placement-rightTop > ${_}-arrow`,`&-placement-rightBottom > ${_}-arrow`].join(",")]:{left:{_skip_check_:!0,value:r},transform:"translateX(-100%) rotate(-90deg)"},[`&-placement-right > ${_}-arrow`]:{top:{_skip_check_:!0,value:"50%"},transform:"translateY(-50%) translateX(-100%) rotate(-90deg)"},[`&-placement-rightTop > ${_}-arrow`]:{top:z},[`&-placement-rightBottom > ${_}-arrow`]:{bottom:z}}))}}function H5(i,l,f,_){if(_===!1)return{adjustX:!1,adjustY:!1};const b=_&&typeof _=="object"?_:{},z={};switch(i){case"top":case"bottom":z.shiftX=l.arrowOffsetHorizontal*2+f,z.shiftY=!0,z.adjustY=!0;break;case"left":case"right":z.shiftY=l.arrowOffsetVertical*2+f,z.shiftX=!0,z.adjustX=!0;break}const O=Object.assign(Object.assign({},z),b);return O.shiftX||(O.adjustX=!0),O.shiftY||(O.adjustY=!0),O}const eA={left:{points:["cr","cl"]},right:{points:["cl","cr"]},top:{points:["bc","tc"]},bottom:{points:["tc","bc"]},topLeft:{points:["bl","tl"]},leftTop:{points:["tr","tl"]},topRight:{points:["br","tr"]},rightTop:{points:["tl","tr"]},bottomRight:{points:["tr","br"]},rightBottom:{points:["bl","br"]},bottomLeft:{points:["tl","bl"]},leftBottom:{points:["br","bl"]}},W5={topLeft:{points:["bl","tc"]},leftTop:{points:["tr","cl"]},topRight:{points:["br","tc"]},rightTop:{points:["tl","cr"]},bottomRight:{points:["tr","bc"]},rightBottom:{points:["bl","cr"]},bottomLeft:{points:["tl","bc"]},leftBottom:{points:["br","cl"]}},G5=new Set(["topLeft","topRight","bottomLeft","bottomRight","leftTop","leftBottom","rightTop","rightBottom"]);function q5(i){const{arrowWidth:l,autoAdjustOverflow:f,arrowPointAtCenter:_,offset:b,borderRadius:z,visibleFirst:O}=i,r=l/2,H={};return Object.keys(eA).forEach(Z=>{const K=_&&W5[Z]||eA[Z],te=Object.assign(Object.assign({},K),{offset:[0,0],dynamicInset:!0});switch(H[Z]=te,G5.has(Z)&&(te.autoArrow=!1),Z){case"top":case"topLeft":case"topRight":te.offset[1]=-r-b;break;case"bottom":case"bottomLeft":case"bottomRight":te.offset[1]=r+b;break;case"left":case"leftTop":case"leftBottom":te.offset[0]=-r-b;break;case"right":case"rightTop":case"rightBottom":te.offset[0]=r+b;break}const le=YS({contentRadius:z,limitVerticalRadius:!0});if(_)switch(Z){case"topLeft":case"bottomLeft":te.offset[0]=-le.arrowOffsetHorizontal-r;break;case"topRight":case"bottomRight":te.offset[0]=le.arrowOffsetHorizontal+r;break;case"leftTop":case"rightTop":te.offset[1]=-le.arrowOffsetHorizontal*2+r;break;case"leftBottom":case"rightBottom":te.offset[1]=le.arrowOffsetHorizontal*2-r;break}te.overflow=H5(Z,le,l,f),O&&(te.htmlRegion="visibleFirst")}),H}const Z5=i=>{const{calc:l,componentCls:f,tooltipMaxWidth:_,tooltipColor:b,tooltipBg:z,tooltipBorderRadius:O,zIndexPopup:r,controlHeight:H,boxShadowSecondary:Z,paddingSM:K,paddingXS:te,arrowOffsetHorizontal:le,sizePopupArrow:Te}=i,pe=l(O).add(Te).add(le).equal(),ge=l(O).mul(2).add(Te).equal();return[{[f]:Object.assign(Object.assign(Object.assign(Object.assign({},Ad(i)),{position:"absolute",zIndex:r,display:"block",width:"max-content",maxWidth:_,visibility:"visible","--valid-offset-x":"var(--arrow-offset-horizontal, var(--arrow-x))",transformOrigin:["var(--valid-offset-x, 50%)","var(--arrow-y, 50%)"].join(" "),"&-hidden":{display:"none"},"--antd-arrow-background-color":z,[`${f}-inner`]:{minWidth:ge,minHeight:H,padding:`${Ur(i.calc(K).div(2).equal())} ${Ur(te)}`,color:b,textAlign:"start",textDecoration:"none",wordWrap:"break-word",backgroundColor:z,borderRadius:O,boxShadow:Z,boxSizing:"border-box"},[["&-placement-topLeft","&-placement-topRight","&-placement-bottomLeft","&-placement-bottomRight"].join(",")]:{minWidth:pe},[["&-placement-left","&-placement-leftTop","&-placement-leftBottom","&-placement-right","&-placement-rightTop","&-placement-rightBottom"].join(",")]:{[`${f}-inner`]:{borderRadius:i.min(O,AP)}},[`${f}-content`]:{position:"relative"}}),LD(i,(fe,me)=>{let{darkColor:_e}=me;return{[`&${f}-${fe}`]:{[`${f}-inner`]:{backgroundColor:_e},[`${f}-arrow`]:{"--antd-arrow-background-color":_e}}}})),{"&-rtl":{direction:"rtl"}})},IP(i,"var(--antd-arrow-background-color)"),{[`${f}-pure`]:{position:"relative",maxWidth:"none",margin:i.sizePopupArrow}}]},X5=i=>Object.assign(Object.assign({zIndexPopup:i.zIndexPopupBase+70},YS({contentRadius:i.borderRadius,limitVerticalRadius:!0})),MP(Ml(i,{borderRadiusOuter:Math.min(i.borderRadiusOuter,4)}))),PP=function(i){let l=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;return Ef("Tooltip",_=>{const{borderRadius:b,colorTextLightSolid:z,colorBgSpotlight:O}=_,r=Ml(_,{tooltipMaxWidth:250,tooltipColor:z,tooltipBorderRadius:b,tooltipBg:O});return[Z5(r),cP(_,"zoom-big-fast")]},X5,{resetStyle:!1,injectStyle:l})(i)},Y5=im.map(i=>`${i}-inverse`);function K5(i){return(arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0)?[].concat(Xr(Y5),Xr(im)).includes(i):im.includes(i)}function RP(i,l){const f=K5(l),_=sr({[`${i}-${l}`]:l&&f}),b={},z={};return l&&!f&&(b.background=l,z["--antd-arrow-background-color"]=l),{className:_,overlayStyle:b,arrowStyle:z}}const J5=i=>{const{prefixCls:l,className:f,placement:_="top",title:b,color:z,overlayInnerStyle:O}=i,{getPrefixCls:r}=se.useContext(Xo),H=r("tooltip",l),[Z,K,te]=PP(H),le=RP(H,z),Te=le.arrowStyle,pe=Object.assign(Object.assign({},O),le.overlayStyle),ge=sr(K,te,H,`${H}-pure`,`${H}-placement-${_}`,f,le.className);return Z(se.createElement("div",{className:ge,style:Te},se.createElement("div",{className:`${H}-arrow`}),se.createElement(XS,Object.assign({},i,{className:K,prefixCls:H,overlayInnerStyle:pe}),b)))};var Q5=function(i,l){var f={};for(var _ in i)Object.prototype.hasOwnProperty.call(i,_)&&l.indexOf(_)<0&&(f[_]=i[_]);if(i!=null&&typeof Object.getOwnPropertySymbols=="function")for(var b=0,_=Object.getOwnPropertySymbols(i);b<_.length;b++)l.indexOf(_[b])<0&&Object.prototype.propertyIsEnumerable.call(i,_[b])&&(f[_[b]]=i[_[b]]);return f};const eN=se.forwardRef((i,l)=>{var f,_,b,z,O,r;const{prefixCls:H,openClassName:Z,getTooltipContainer:K,color:te,overlayInnerStyle:le,children:Te,afterOpenChange:pe,afterVisibleChange:ge,destroyTooltipOnHide:fe,arrow:me=!0,title:_e,overlay:Ie,builtinPlacements:Ne,arrowPointAtCenter:nt=!1,autoAdjustOverflow:Le=!0}=i,Pe=!!me,[,rt]=Sf(),{getPopupContainer:at,getPrefixCls:Qe,direction:lt,tooltip:Ct}=se.useContext(Xo),Rt=wI(),Nt=se.useRef(null),At=()=>{var oi;(oi=Nt.current)===null||oi===void 0||oi.forceAlign()};se.useImperativeHandle(l,()=>{var oi;return{forceAlign:At,forcePopupAlign:()=>{Rt.deprecated(!1,"forcePopupAlign","forceAlign"),At()},nativeElement:(oi=Nt.current)===null||oi===void 0?void 0:oi.nativeElement}});const[xt,gt]=wf(!1,{value:(f=i.open)!==null&&f!==void 0?f:i.visible,defaultValue:(_=i.defaultOpen)!==null&&_!==void 0?_:i.defaultVisible}),ht=!_e&&!Ie&&_e!==0,vt=oi=>{var qi,Ci;gt(ht?!1:oi),ht||((qi=i.onOpenChange)===null||qi===void 0||qi.call(i,oi),(Ci=i.onVisibleChange)===null||Ci===void 0||Ci.call(i,oi))},Ve=se.useMemo(()=>{var oi,qi;let Ci=nt;return typeof me=="object"&&(Ci=(qi=(oi=me.pointAtCenter)!==null&&oi!==void 0?oi:me.arrowPointAtCenter)!==null&&qi!==void 0?qi:nt),Ne||q5({arrowPointAtCenter:Ci,autoAdjustOverflow:Le,arrowWidth:Pe?rt.sizePopupArrow:0,borderRadius:rt.borderRadius,offset:rt.marginXXS,visibleFirst:!0})},[nt,me,Ne,rt]),je=se.useMemo(()=>_e===0?_e:Ie||_e||"",[Ie,_e]),it=se.createElement(Ow,{space:!0},typeof je=="function"?je():je),{getPopupContainer:Mt,placement:Ot="top",mouseEnterDelay:sn=.1,mouseLeaveDelay:hn=.1,overlayStyle:Tn,rootClassName:Ut,overlayClassName:bn,styles:Re,classNames:Hr}=i,Nr=Q5(i,["getPopupContainer","placement","mouseEnterDelay","mouseLeaveDelay","overlayStyle","rootClassName","overlayClassName","styles","classNames"]),Ar=Qe("tooltip",H),Ht=Qe(),Wr=i["data-popover-inject"];let ar=xt;!("open"in i)&&!("visible"in i)&&ht&&(ar=!1);const pi=se.isValidElement(Te)&&!tP(Te)?Te:se.createElement("span",null,Te),$n=pi.props,Gr=!$n.className||typeof $n.className=="string"?sr($n.className,Z||`${Ar}-open`):$n.className,[gi,Pr,ci]=PP(Ar,!Wr),Un=RP(Ar,te),yn=Un.arrowStyle,Ir=sr(bn,{[`${Ar}-rtl`]:lt==="rtl"},Un.className,Ut,Pr,ci,Ct==null?void 0:Ct.className,(b=Ct==null?void 0:Ct.classNames)===null||b===void 0?void 0:b.root,Hr==null?void 0:Hr.root),ui=sr((z=Ct==null?void 0:Ct.classNames)===null||z===void 0?void 0:z.body,Hr==null?void 0:Hr.body),[_i,Lr]=BF("Tooltip",Nr.zIndex),yi=se.createElement(V5,Object.assign({},Nr,{zIndex:_i,showArrow:Pe,placement:Ot,mouseEnterDelay:sn,mouseLeaveDelay:hn,prefixCls:Ar,classNames:{root:Ir,body:ui},styles:{root:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},yn),(O=Ct==null?void 0:Ct.styles)===null||O===void 0?void 0:O.root),Ct==null?void 0:Ct.style),Tn),Re==null?void 0:Re.root),body:Object.assign(Object.assign(Object.assign(Object.assign({},(r=Ct==null?void 0:Ct.styles)===null||r===void 0?void 0:r.body),le),Re==null?void 0:Re.body),Un.overlayStyle)},getTooltipContainer:Mt||K||at,ref:Nt,builtinPlacements:Ve,overlay:it,visible:ar,onVisibleChange:vt,afterVisibleChange:pe??ge,arrowContent:se.createElement("span",{className:`${Ar}-arrow-content`}),motion:{motionName:oP(Ht,"zoom-big-fast",i.transitionName),motionDeadline:1e3},destroyTooltipOnHide:!!fe}),ar?om(pi,{className:Gr}):pi);return gi(se.createElement(rP.Provider,{value:Lr},yi))}),kP=eN;kP._InternalPanelDoNotUseOrYouWillBeFired=J5;const tN=i=>{const{componentCls:l,popoverColor:f,titleMinWidth:_,fontWeightStrong:b,innerPadding:z,boxShadowSecondary:O,colorTextHeading:r,borderRadiusLG:H,zIndexPopup:Z,titleMarginBottom:K,colorBgElevated:te,popoverBg:le,titleBorderBottom:Te,innerContentPadding:pe,titlePadding:ge}=i;return[{[l]:Object.assign(Object.assign({},Ad(i)),{position:"absolute",top:0,left:{_skip_check_:!0,value:0},zIndex:Z,fontWeight:"normal",whiteSpace:"normal",textAlign:"start",cursor:"auto",userSelect:"text","--valid-offset-x":"var(--arrow-offset-horizontal, var(--arrow-x))",transformOrigin:["var(--valid-offset-x, 50%)","var(--arrow-y, 50%)"].join(" "),"--antd-arrow-background-color":te,width:"max-content",maxWidth:"100vw","&-rtl":{direction:"rtl"},"&-hidden":{display:"none"},[`${l}-content`]:{position:"relative"},[`${l}-inner`]:{backgroundColor:le,backgroundClip:"padding-box",borderRadius:H,boxShadow:O,padding:z},[`${l}-title`]:{minWidth:_,marginBottom:K,color:r,fontWeight:b,borderBottom:Te,padding:ge},[`${l}-inner-content`]:{color:f,padding:pe}})},IP(i,"var(--antd-arrow-background-color)"),{[`${l}-pure`]:{position:"relative",maxWidth:"none",margin:i.sizePopupArrow,display:"inline-block",[`${l}-content`]:{display:"inline-block"}}}]},nN=i=>{const{componentCls:l}=i;return{[l]:im.map(f=>{const _=i[`${f}6`];return{[`&${l}-${f}`]:{"--antd-arrow-background-color":_,[`${l}-inner`]:{backgroundColor:_},[`${l}-arrow`]:{background:"transparent"}}}})}},rN=i=>{const{lineWidth:l,controlHeight:f,fontHeight:_,padding:b,wireframe:z,zIndexPopupBase:O,borderRadiusLG:r,marginXS:H,lineType:Z,colorSplit:K,paddingSM:te}=i,le=f-_,Te=le/2,pe=le/2-l,ge=b;return Object.assign(Object.assign(Object.assign({titleMinWidth:177,zIndexPopup:O+30},MP(i)),YS({contentRadius:r,limitVerticalRadius:!0})),{innerPadding:z?0:12,titleMarginBottom:z?0:H,titlePadding:z?`${Te}px ${ge}px ${pe}px`:0,titleBorderBottom:z?`${l}px ${Z} ${K}`:"none",innerContentPadding:z?`${te}px ${ge}px`:0})},zP=Ef("Popover",i=>{const{colorBgElevated:l,colorText:f}=i,_=Ml(i,{popoverBg:l,popoverColor:f});return[tN(_),nN(_),cP(_,"zoom-big")]},rN,{resetStyle:!1,deprecatedTokens:[["width","titleMinWidth"],["minWidth","titleMinWidth"]]});var iN=function(i,l){var f={};for(var _ in i)Object.prototype.hasOwnProperty.call(i,_)&&l.indexOf(_)<0&&(f[_]=i[_]);if(i!=null&&typeof Object.getOwnPropertySymbols=="function")for(var b=0,_=Object.getOwnPropertySymbols(i);b<_.length;b++)l.indexOf(_[b])<0&&Object.prototype.propertyIsEnumerable.call(i,_[b])&&(f[_[b]]=i[_[b]]);return f};const LP=i=>{let{title:l,content:f,prefixCls:_}=i;return!l&&!f?null:se.createElement(se.Fragment,null,l&&se.createElement("div",{className:`${_}-title`},l),f&&se.createElement("div",{className:`${_}-inner-content`},f))},oN=i=>{const{hashId:l,prefixCls:f,className:_,style:b,placement:z="top",title:O,content:r,children:H}=i,Z=fx(O),K=fx(r),te=sr(l,f,`${f}-pure`,`${f}-placement-${z}`,_);return se.createElement("div",{className:te,style:b},se.createElement("div",{className:`${f}-arrow`}),se.createElement(XS,Object.assign({},i,{className:l,prefixCls:f}),H||se.createElement(LP,{prefixCls:f,title:Z,content:K})))},sN=i=>{const{prefixCls:l,className:f}=i,_=iN(i,["prefixCls","className"]),{getPrefixCls:b}=se.useContext(Xo),z=b("popover",l),[O,r,H]=zP(z);return O(se.createElement(oN,Object.assign({},_,{prefixCls:z,hashId:r,className:sr(f,H)})))};var aN=function(i,l){var f={};for(var _ in i)Object.prototype.hasOwnProperty.call(i,_)&&l.indexOf(_)<0&&(f[_]=i[_]);if(i!=null&&typeof Object.getOwnPropertySymbols=="function")for(var b=0,_=Object.getOwnPropertySymbols(i);b<_.length;b++)l.indexOf(_[b])<0&&Object.prototype.propertyIsEnumerable.call(i,_[b])&&(f[_[b]]=i[_[b]]);return f};const lN=se.forwardRef((i,l)=>{var f,_,b,z,O,r;const{prefixCls:H,title:Z,content:K,overlayClassName:te,placement:le="top",trigger:Te="hover",children:pe,mouseEnterDelay:ge=.1,mouseLeaveDelay:fe=.1,onOpenChange:me,overlayStyle:_e={},styles:Ie,classNames:Ne}=i,nt=aN(i,["prefixCls","title","content","overlayClassName","placement","trigger","children","mouseEnterDelay","mouseLeaveDelay","onOpenChange","overlayStyle","styles","classNames"]),{popover:Le,getPrefixCls:Pe}=se.useContext(Xo),rt=Pe("popover",H),[at,Qe,lt]=zP(rt),Ct=Pe(),Rt=sr(te,Qe,lt,(f=Le==null?void 0:Le.classNames)===null||f===void 0?void 0:f.root,Ne==null?void 0:Ne.root),Nt=sr((_=Le==null?void 0:Le.classNames)===null||_===void 0?void 0:_.body,Ne==null?void 0:Ne.body),[At,xt]=wf(!1,{value:(b=i.open)!==null&&b!==void 0?b:i.visible,defaultValue:(z=i.defaultOpen)!==null&&z!==void 0?z:i.defaultVisible}),gt=(it,Mt)=>{xt(it,!0),me==null||me(it,Mt)},ht=it=>{it.keyCode===ei.ESC&&gt(!1,it)},vt=it=>{gt(it)},Ve=fx(Z),je=fx(K);return at(se.createElement(kP,Object.assign({placement:le,trigger:Te,mouseEnterDelay:ge,mouseLeaveDelay:fe},nt,{prefixCls:rt,classNames:{root:Rt,body:Nt},styles:{root:Object.assign(Object.assign(Object.assign(Object.assign({},(O=Le==null?void 0:Le.styles)===null||O===void 0?void 0:O.root),Le==null?void 0:Le.style),_e),Ie==null?void 0:Ie.root),body:Object.assign(Object.assign({},(r=Le==null?void 0:Le.styles)===null||r===void 0?void 0:r.body),Ie==null?void 0:Ie.body)},ref:l,open:At,onOpenChange:vt,overlay:Ve||je?se.createElement(LP,{prefixCls:rt,title:Ve,content:je}):null,transitionName:oP(Ct,"zoom-big",nt.transitionName),"data-popover-inject":!0}),om(pe,{onKeyDown:it=>{var Mt,Ot;se.isValidElement(pe)&&((Ot=pe==null?void 0:(Mt=pe.props).onKeyDown)===null||Ot===void 0||Ot.call(Mt,it)),ht(it)}})))}),OP=lN;OP._InternalPanelDoNotUseOrYouWillBeFired=sN;const tA=i=>{const{size:l,shape:f}=se.useContext(Bw),_=se.useMemo(()=>({size:i.size||l,shape:i.shape||f}),[i.size,i.shape,l,f]);return se.createElement(Bw.Provider,{value:_},i.children)},cN=i=>{var l,f,_,b;const{getPrefixCls:z,direction:O}=se.useContext(Xo),{prefixCls:r,className:H,rootClassName:Z,style:K,maxCount:te,maxStyle:le,size:Te,shape:pe,maxPopoverPlacement:ge,maxPopoverTrigger:fe,children:me,max:_e}=i,Ie=z("avatar",r),Ne=`${Ie}-group`,nt=cm(Ie),[Le,Pe,rt]=TP(Ie,nt),at=sr(Ne,{[`${Ne}-rtl`]:O==="rtl"},rt,nt,H,Z,Pe),Qe=G_(me).map((Rt,Nt)=>om(Rt,{key:`avatar-key-${Nt}`})),lt=(_e==null?void 0:_e.count)||te,Ct=Qe.length;if(lt&&lt<Ct){const Rt=Qe.slice(0,lt),Nt=Qe.slice(lt,Ct),At=(_e==null?void 0:_e.style)||le,xt=((l=_e==null?void 0:_e.popover)===null||l===void 0?void 0:l.trigger)||fe||"hover",gt=((f=_e==null?void 0:_e.popover)===null||f===void 0?void 0:f.placement)||ge||"top",ht=Object.assign(Object.assign({content:Nt},_e==null?void 0:_e.popover),{classNames:{root:sr(`${Ne}-popover`,(b=(_=_e==null?void 0:_e.popover)===null||_===void 0?void 0:_.classNames)===null||b===void 0?void 0:b.root)},placement:gt,trigger:xt});return Rt.push(se.createElement(OP,Object.assign({key:"avatar-popover-key",destroyTooltipOnHide:!0},ht),se.createElement(CP,{style:At},`+${Ct-lt}`))),Le(se.createElement(tA,{shape:pe,size:Te},se.createElement("div",{className:at,style:K},Rt)))}return Le(se.createElement(tA,{shape:pe,size:Te},se.createElement("div",{className:at,style:K},Qe)))},DP=CP;DP.Group=cN;const FP=se.createContext(null),uN=FP.Provider,BP=se.createContext(null),hN=BP.Provider;var dN=["prefixCls","className","style","checked","disabled","defaultChecked","type","title","onChange"],fN=se.forwardRef(function(i,l){var f=i.prefixCls,_=f===void 0?"rc-checkbox":f,b=i.className,z=i.style,O=i.checked,r=i.disabled,H=i.defaultChecked,Z=H===void 0?!1:H,K=i.type,te=K===void 0?"checkbox":K,le=i.title,Te=i.onChange,pe=Ja(i,dN),ge=se.useRef(null),fe=se.useRef(null),me=wf(Z,{value:O}),_e=Gn(me,2),Ie=_e[0],Ne=_e[1];se.useImperativeHandle(l,function(){return{focus:function(rt){var at;(at=ge.current)===null||at===void 0||at.focus(rt)},blur:function(){var rt;(rt=ge.current)===null||rt===void 0||rt.blur()},input:ge.current,nativeElement:fe.current}});var nt=sr(_,b,jt(jt({},"".concat(_,"-checked"),Ie),"".concat(_,"-disabled"),r)),Le=function(rt){r||("checked"in i||Ne(rt.target.checked),Te==null||Te({target:nn(nn({},i),{},{type:te,checked:rt.target.checked}),stopPropagation:function(){rt.stopPropagation()},preventDefault:function(){rt.preventDefault()},nativeEvent:rt.nativeEvent}))};return se.createElement("span",{className:nt,title:le,style:z,ref:fe},se.createElement("input",$s({},pe,{className:"".concat(_,"-input"),ref:ge,onChange:Le,disabled:r,checked:!!Ie,type:te})),se.createElement("span",{className:"".concat(_,"-inner")}))});function pN(i){const l=Nn.useRef(null),f=()=>{qu.cancel(l.current),l.current=null};return[()=>{f(),l.current=qu(()=>{l.current=null})},z=>{l.current&&(z.stopPropagation(),f()),i==null||i(z)}]}const mN=i=>{const{componentCls:l,antCls:f}=i,_=`${l}-group`;return{[_]:Object.assign(Object.assign({},Ad(i)),{display:"inline-block",fontSize:0,[`&${_}-rtl`]:{direction:"rtl"},[`&${_}-block`]:{display:"flex"},[`${f}-badge ${f}-badge-count`]:{zIndex:1},[`> ${f}-badge:not(:first-child) > ${f}-button-wrapper`]:{borderInlineStart:"none"}})}},gN=i=>{const{componentCls:l,wrapperMarginInlineEnd:f,colorPrimary:_,radioSize:b,motionDurationSlow:z,motionDurationMid:O,motionEaseInOutCirc:r,colorBgContainer:H,colorBorder:Z,lineWidth:K,colorBgContainerDisabled:te,colorTextDisabled:le,paddingXS:Te,dotColorDisabled:pe,lineType:ge,radioColor:fe,radioBgColor:me,calc:_e}=i,Ie=`${l}-inner`,nt=_e(b).sub(_e(4).mul(2)),Le=_e(1).mul(b).equal({unit:!0});return{[`${l}-wrapper`]:Object.assign(Object.assign({},Ad(i)),{display:"inline-flex",alignItems:"baseline",marginInlineStart:0,marginInlineEnd:f,cursor:"pointer",[`&${l}-wrapper-rtl`]:{direction:"rtl"},"&-disabled":{cursor:"not-allowed",color:i.colorTextDisabled},"&::after":{display:"inline-block",width:0,overflow:"hidden",content:'"\\a0"'},"&-block":{flex:1,justifyContent:"center"},[`${l}-checked::after`]:{position:"absolute",insetBlockStart:0,insetInlineStart:0,width:"100%",height:"100%",border:`${Ur(K)} ${ge} ${_}`,borderRadius:"50%",visibility:"hidden",opacity:0,content:'""'},[l]:Object.assign(Object.assign({},Ad(i)),{position:"relative",display:"inline-block",outline:"none",cursor:"pointer",alignSelf:"center",borderRadius:"50%"}),[`${l}-wrapper:hover &,
        &:hover ${Ie}`]:{borderColor:_},[`${l}-input:focus-visible + ${Ie}`]:Object.assign({},NS(i)),[`${l}:hover::after, ${l}-wrapper:hover &::after`]:{visibility:"visible"},[`${l}-inner`]:{"&::after":{boxSizing:"border-box",position:"absolute",insetBlockStart:"50%",insetInlineStart:"50%",display:"block",width:Le,height:Le,marginBlockStart:_e(1).mul(b).div(-2).equal({unit:!0}),marginInlineStart:_e(1).mul(b).div(-2).equal({unit:!0}),backgroundColor:fe,borderBlockStart:0,borderInlineStart:0,borderRadius:Le,transform:"scale(0)",opacity:0,transition:`all ${z} ${r}`,content:'""'},boxSizing:"border-box",position:"relative",insetBlockStart:0,insetInlineStart:0,display:"block",width:Le,height:Le,backgroundColor:H,borderColor:Z,borderStyle:"solid",borderWidth:K,borderRadius:"50%",transition:`all ${O}`},[`${l}-input`]:{position:"absolute",inset:0,zIndex:1,cursor:"pointer",opacity:0},[`${l}-checked`]:{[Ie]:{borderColor:_,backgroundColor:me,"&::after":{transform:`scale(${i.calc(i.dotSize).div(b).equal()})`,opacity:1,transition:`all ${z} ${r}`}}},[`${l}-disabled`]:{cursor:"not-allowed",[Ie]:{backgroundColor:te,borderColor:Z,cursor:"not-allowed","&::after":{backgroundColor:pe}},[`${l}-input`]:{cursor:"not-allowed"},[`${l}-disabled + span`]:{color:le,cursor:"not-allowed"},[`&${l}-checked`]:{[Ie]:{"&::after":{transform:`scale(${_e(nt).div(b).equal()})`}}}},[`span${l} + *`]:{paddingInlineStart:Te,paddingInlineEnd:Te}})}},_N=i=>{const{buttonColor:l,controlHeight:f,componentCls:_,lineWidth:b,lineType:z,colorBorder:O,motionDurationSlow:r,motionDurationMid:H,buttonPaddingInline:Z,fontSize:K,buttonBg:te,fontSizeLG:le,controlHeightLG:Te,controlHeightSM:pe,paddingXS:ge,borderRadius:fe,borderRadiusSM:me,borderRadiusLG:_e,buttonCheckedBg:Ie,buttonSolidCheckedColor:Ne,colorTextDisabled:nt,colorBgContainerDisabled:Le,buttonCheckedBgDisabled:Pe,buttonCheckedColorDisabled:rt,colorPrimary:at,colorPrimaryHover:Qe,colorPrimaryActive:lt,buttonSolidCheckedBg:Ct,buttonSolidCheckedHoverBg:Rt,buttonSolidCheckedActiveBg:Nt,calc:At}=i;return{[`${_}-button-wrapper`]:{position:"relative",display:"inline-block",height:f,margin:0,paddingInline:Z,paddingBlock:0,color:l,fontSize:K,lineHeight:Ur(At(f).sub(At(b).mul(2)).equal()),background:te,border:`${Ur(b)} ${z} ${O}`,borderBlockStartWidth:At(b).add(.02).equal(),borderInlineStartWidth:0,borderInlineEndWidth:b,cursor:"pointer",transition:[`color ${H}`,`background ${H}`,`box-shadow ${H}`].join(","),a:{color:l},[`> ${_}-button`]:{position:"absolute",insetBlockStart:0,insetInlineStart:0,zIndex:-1,width:"100%",height:"100%"},"&:not(:first-child)":{"&::before":{position:"absolute",insetBlockStart:At(b).mul(-1).equal(),insetInlineStart:At(b).mul(-1).equal(),display:"block",boxSizing:"content-box",width:1,height:"100%",paddingBlock:b,paddingInline:0,backgroundColor:O,transition:`background-color ${r}`,content:'""'}},"&:first-child":{borderInlineStart:`${Ur(b)} ${z} ${O}`,borderStartStartRadius:fe,borderEndStartRadius:fe},"&:last-child":{borderStartEndRadius:fe,borderEndEndRadius:fe},"&:first-child:last-child":{borderRadius:fe},[`${_}-group-large &`]:{height:Te,fontSize:le,lineHeight:Ur(At(Te).sub(At(b).mul(2)).equal()),"&:first-child":{borderStartStartRadius:_e,borderEndStartRadius:_e},"&:last-child":{borderStartEndRadius:_e,borderEndEndRadius:_e}},[`${_}-group-small &`]:{height:pe,paddingInline:At(ge).sub(b).equal(),paddingBlock:0,lineHeight:Ur(At(pe).sub(At(b).mul(2)).equal()),"&:first-child":{borderStartStartRadius:me,borderEndStartRadius:me},"&:last-child":{borderStartEndRadius:me,borderEndEndRadius:me}},"&:hover":{position:"relative",color:at},"&:has(:focus-visible)":Object.assign({},NS(i)),[`${_}-inner, input[type='checkbox'], input[type='radio']`]:{width:0,height:0,opacity:0,pointerEvents:"none"},[`&-checked:not(${_}-button-wrapper-disabled)`]:{zIndex:1,color:at,background:Ie,borderColor:at,"&::before":{backgroundColor:at},"&:first-child":{borderColor:at},"&:hover":{color:Qe,borderColor:Qe,"&::before":{backgroundColor:Qe}},"&:active":{color:lt,borderColor:lt,"&::before":{backgroundColor:lt}}},[`${_}-group-solid &-checked:not(${_}-button-wrapper-disabled)`]:{color:Ne,background:Ct,borderColor:Ct,"&:hover":{color:Ne,background:Rt,borderColor:Rt},"&:active":{color:Ne,background:Nt,borderColor:Nt}},"&-disabled":{color:nt,backgroundColor:Le,borderColor:O,cursor:"not-allowed","&:first-child, &:hover":{color:nt,backgroundColor:Le,borderColor:O}},[`&-disabled${_}-button-wrapper-checked`]:{color:rt,backgroundColor:Pe,borderColor:O,boxShadow:"none"},"&-block":{flex:1,textAlign:"center"}}}},yN=i=>{const{wireframe:l,padding:f,marginXS:_,lineWidth:b,fontSizeLG:z,colorText:O,colorBgContainer:r,colorTextDisabled:H,controlItemBgActiveDisabled:Z,colorTextLightSolid:K,colorPrimary:te,colorPrimaryHover:le,colorPrimaryActive:Te,colorWhite:pe}=i,ge=4,fe=z,me=l?fe-ge*2:fe-(ge+b)*2;return{radioSize:fe,dotSize:me,dotColorDisabled:H,buttonSolidCheckedColor:K,buttonSolidCheckedBg:te,buttonSolidCheckedHoverBg:le,buttonSolidCheckedActiveBg:Te,buttonBg:r,buttonCheckedBg:r,buttonColor:O,buttonCheckedBgDisabled:Z,buttonCheckedColorDisabled:H,buttonPaddingInline:f-b,wrapperMarginInlineEnd:_,radioColor:l?te:pe,radioBgColor:l?r:te}},NP=Ef("Radio",i=>{const{controlOutline:l,controlOutlineWidth:f}=i,_=`0 0 0 ${Ur(f)} ${l}`,z=Ml(i,{radioFocusShadow:_,radioButtonFocusShadow:_});return[mN(z),gN(z),_N(z)]},yN,{unitless:{radioSize:!0,dotSize:!0}});var vN=function(i,l){var f={};for(var _ in i)Object.prototype.hasOwnProperty.call(i,_)&&l.indexOf(_)<0&&(f[_]=i[_]);if(i!=null&&typeof Object.getOwnPropertySymbols=="function")for(var b=0,_=Object.getOwnPropertySymbols(i);b<_.length;b++)l.indexOf(_[b])<0&&Object.prototype.propertyIsEnumerable.call(i,_[b])&&(f[_[b]]=i[_[b]]);return f};const xN=(i,l)=>{var f,_;const b=se.useContext(FP),z=se.useContext(BP),{getPrefixCls:O,direction:r,radio:H}=se.useContext(Xo),Z=se.useRef(null),K=bf(l,Z),{isFormItemInput:te}=se.useContext(xf),le=xt=>{var gt,ht;(gt=i.onChange)===null||gt===void 0||gt.call(i,xt),(ht=b==null?void 0:b.onChange)===null||ht===void 0||ht.call(b,xt)},{prefixCls:Te,className:pe,rootClassName:ge,children:fe,style:me,title:_e}=i,Ie=vN(i,["prefixCls","className","rootClassName","children","style","title"]),Ne=O("radio",Te),nt=((b==null?void 0:b.optionType)||z)==="button",Le=nt?`${Ne}-button`:Ne,Pe=cm(Ne),[rt,at,Qe]=NP(Ne,Pe),lt=Object.assign({},Ie),Ct=se.useContext(vf);b&&(lt.name=b.name,lt.onChange=le,lt.checked=i.value===b.value,lt.disabled=(f=lt.disabled)!==null&&f!==void 0?f:b.disabled),lt.disabled=(_=lt.disabled)!==null&&_!==void 0?_:Ct;const Rt=sr(`${Le}-wrapper`,{[`${Le}-wrapper-checked`]:lt.checked,[`${Le}-wrapper-disabled`]:lt.disabled,[`${Le}-wrapper-rtl`]:r==="rtl",[`${Le}-wrapper-in-form-item`]:te,[`${Le}-wrapper-block`]:!!(b!=null&&b.block)},H==null?void 0:H.className,pe,ge,at,Qe,Pe),[Nt,At]=pN(lt.onClick);return rt(se.createElement(VS,{component:"Radio",disabled:lt.disabled},se.createElement("label",{className:Rt,style:Object.assign(Object.assign({},H==null?void 0:H.style),me),onMouseEnter:i.onMouseEnter,onMouseLeave:i.onMouseLeave,title:_e,onClick:Nt},se.createElement(fN,Object.assign({},lt,{className:sr(lt.className,{[$S]:!nt}),type:"radio",prefixCls:Le,ref:K,onClick:At})),fe!==void 0?se.createElement("span",null,fe):null)))},px=se.forwardRef(xN),bN=se.forwardRef((i,l)=>{const{getPrefixCls:f,direction:_}=se.useContext(Xo),b=gP(),{prefixCls:z,className:O,rootClassName:r,options:H,buttonStyle:Z="outline",disabled:K,children:te,size:le,style:Te,id:pe,optionType:ge,name:fe=b,defaultValue:me,value:_e,block:Ie=!1,onChange:Ne,onMouseEnter:nt,onMouseLeave:Le,onFocus:Pe,onBlur:rt}=i,[at,Qe]=wf(me,{value:_e}),lt=se.useCallback(it=>{const Mt=at,Ot=it.target.value;"value"in i||Qe(Ot),Ot!==Mt&&(Ne==null||Ne(it))},[at,Qe,Ne]),Ct=f("radio",z),Rt=`${Ct}-group`,Nt=cm(Ct),[At,xt,gt]=NP(Ct,Nt);let ht=te;H&&H.length>0&&(ht=H.map(it=>typeof it=="string"||typeof it=="number"?se.createElement(px,{key:it.toString(),prefixCls:Ct,disabled:K,value:it,checked:at===it},it):se.createElement(px,{key:`radio-group-value-options-${it.value}`,prefixCls:Ct,disabled:it.disabled||K,value:it.value,checked:at===it.value,title:it.title,style:it.style,id:it.id,required:it.required},it.label)));const vt=bp(le),Ve=sr(Rt,`${Rt}-${Z}`,{[`${Rt}-${vt}`]:vt,[`${Rt}-rtl`]:_==="rtl",[`${Rt}-block`]:Ie},O,r,xt,gt,Nt),je=se.useMemo(()=>({onChange:lt,value:at,disabled:K,name:fe,optionType:ge,block:Ie}),[lt,at,K,fe,ge,Ie]);return At(se.createElement("div",Object.assign({},eP(i,{aria:!0,data:!0}),{className:Ve,style:Te,onMouseEnter:nt,onMouseLeave:Le,onFocus:Pe,onBlur:rt,id:pe,ref:l}),se.createElement(uN,{value:je},ht)))}),wN=se.memo(bN);var SN=function(i,l){var f={};for(var _ in i)Object.prototype.hasOwnProperty.call(i,_)&&l.indexOf(_)<0&&(f[_]=i[_]);if(i!=null&&typeof Object.getOwnPropertySymbols=="function")for(var b=0,_=Object.getOwnPropertySymbols(i);b<_.length;b++)l.indexOf(_[b])<0&&Object.prototype.propertyIsEnumerable.call(i,_[b])&&(f[_[b]]=i[_[b]]);return f};const EN=(i,l)=>{const{getPrefixCls:f}=se.useContext(Xo),{prefixCls:_}=i,b=SN(i,["prefixCls"]),z=f("radio",_);return se.createElement(hN,{value:"button"},se.createElement(px,Object.assign({prefixCls:z},b,{type:"radio",ref:l})))},TN=se.forwardRef(EN),cp=px;cp.Button=TN;cp.Group=wN;cp.__ANT_RADIO=!0;function jP(i){return Ml(i,{inputAffixPadding:i.paddingXXS})}const $P=i=>{const{controlHeight:l,fontSize:f,lineHeight:_,lineWidth:b,controlHeightSM:z,controlHeightLG:O,fontSizeLG:r,lineHeightLG:H,paddingSM:Z,controlPaddingHorizontalSM:K,controlPaddingHorizontal:te,colorFillAlter:le,colorPrimaryHover:Te,colorPrimary:pe,controlOutlineWidth:ge,controlOutline:fe,colorErrorOutline:me,colorWarningOutline:_e,colorBgContainer:Ie}=i;return{paddingBlock:Math.max(Math.round((l-f*_)/2*10)/10-b,0),paddingBlockSM:Math.max(Math.round((z-f*_)/2*10)/10-b,0),paddingBlockLG:Math.ceil((O-r*H)/2*10)/10-b,paddingInline:Z-b,paddingInlineSM:K-b,paddingInlineLG:te-b,addonBg:le,activeBorderColor:pe,hoverBorderColor:Te,activeShadow:`0 0 0 ${ge}px ${fe}`,errorActiveShadow:`0 0 0 ${ge}px ${me}`,warningActiveShadow:`0 0 0 ${ge}px ${_e}`,hoverBg:Ie,activeBg:Ie,inputFontSize:f,inputFontSizeLG:r,inputFontSizeSM:f}},CN=i=>({borderColor:i.hoverBorderColor,backgroundColor:i.hoverBg}),KS=i=>({color:i.colorTextDisabled,backgroundColor:i.colorBgContainerDisabled,borderColor:i.colorBorder,boxShadow:"none",cursor:"not-allowed",opacity:1,"input[disabled], textarea[disabled]":{cursor:"not-allowed"},"&:hover:not([disabled])":Object.assign({},CN(Ml(i,{hoverBorderColor:i.colorBorder,hoverBg:i.colorBgContainerDisabled})))}),VP=(i,l)=>({background:i.colorBgContainer,borderWidth:i.lineWidth,borderStyle:i.lineType,borderColor:l.borderColor,"&:hover":{borderColor:l.hoverBorderColor,backgroundColor:i.hoverBg},"&:focus, &:focus-within":{borderColor:l.activeBorderColor,boxShadow:l.activeShadow,outline:0,backgroundColor:i.activeBg}}),nA=(i,l)=>({[`&${i.componentCls}-status-${l.status}:not(${i.componentCls}-disabled)`]:Object.assign(Object.assign({},VP(i,l)),{[`${i.componentCls}-prefix, ${i.componentCls}-suffix`]:{color:l.affixColor}}),[`&${i.componentCls}-status-${l.status}${i.componentCls}-disabled`]:{borderColor:l.borderColor}}),MN=(i,l)=>({"&-outlined":Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},VP(i,{borderColor:i.colorBorder,hoverBorderColor:i.hoverBorderColor,activeBorderColor:i.activeBorderColor,activeShadow:i.activeShadow})),{[`&${i.componentCls}-disabled, &[disabled]`]:Object.assign({},KS(i))}),nA(i,{status:"error",borderColor:i.colorError,hoverBorderColor:i.colorErrorBorderHover,activeBorderColor:i.colorError,activeShadow:i.errorActiveShadow,affixColor:i.colorError})),nA(i,{status:"warning",borderColor:i.colorWarning,hoverBorderColor:i.colorWarningBorderHover,activeBorderColor:i.colorWarning,activeShadow:i.warningActiveShadow,affixColor:i.colorWarning})),l)}),rA=(i,l)=>({[`&${i.componentCls}-group-wrapper-status-${l.status}`]:{[`${i.componentCls}-group-addon`]:{borderColor:l.addonBorderColor,color:l.addonColor}}}),AN=i=>({"&-outlined":Object.assign(Object.assign(Object.assign({[`${i.componentCls}-group`]:{"&-addon":{background:i.addonBg,border:`${Ur(i.lineWidth)} ${i.lineType} ${i.colorBorder}`},"&-addon:first-child":{borderInlineEnd:0},"&-addon:last-child":{borderInlineStart:0}}},rA(i,{status:"error",addonBorderColor:i.colorError,addonColor:i.colorErrorText})),rA(i,{status:"warning",addonBorderColor:i.colorWarning,addonColor:i.colorWarningText})),{[`&${i.componentCls}-group-wrapper-disabled`]:{[`${i.componentCls}-group-addon`]:Object.assign({},KS(i))}})}),IN=(i,l)=>{const{componentCls:f}=i;return{"&-borderless":Object.assign({background:"transparent",border:"none","&:focus, &:focus-within":{outline:"none"},[`&${f}-disabled, &[disabled]`]:{color:i.colorTextDisabled,cursor:"not-allowed"},[`&${f}-status-error`]:{"&, & input, & textarea":{color:i.colorError}},[`&${f}-status-warning`]:{"&, & input, & textarea":{color:i.colorWarning}}},l)}},UP=(i,l)=>({background:l.bg,borderWidth:i.lineWidth,borderStyle:i.lineType,borderColor:"transparent","input&, & input, textarea&, & textarea":{color:l==null?void 0:l.inputColor},"&:hover":{background:l.hoverBg},"&:focus, &:focus-within":{outline:0,borderColor:l.activeBorderColor,backgroundColor:i.activeBg}}),iA=(i,l)=>({[`&${i.componentCls}-status-${l.status}:not(${i.componentCls}-disabled)`]:Object.assign(Object.assign({},UP(i,l)),{[`${i.componentCls}-prefix, ${i.componentCls}-suffix`]:{color:l.affixColor}})}),PN=(i,l)=>({"&-filled":Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},UP(i,{bg:i.colorFillTertiary,hoverBg:i.colorFillSecondary,activeBorderColor:i.activeBorderColor})),{[`&${i.componentCls}-disabled, &[disabled]`]:Object.assign({},KS(i))}),iA(i,{status:"error",bg:i.colorErrorBg,hoverBg:i.colorErrorBgHover,activeBorderColor:i.colorError,inputColor:i.colorErrorText,affixColor:i.colorError})),iA(i,{status:"warning",bg:i.colorWarningBg,hoverBg:i.colorWarningBgHover,activeBorderColor:i.colorWarning,inputColor:i.colorWarningText,affixColor:i.colorWarning})),l)}),oA=(i,l)=>({[`&${i.componentCls}-group-wrapper-status-${l.status}`]:{[`${i.componentCls}-group-addon`]:{background:l.addonBg,color:l.addonColor}}}),RN=i=>({"&-filled":Object.assign(Object.assign(Object.assign({[`${i.componentCls}-group`]:{"&-addon":{background:i.colorFillTertiary},[`${i.componentCls}-filled:not(:focus):not(:focus-within)`]:{"&:not(:first-child)":{borderInlineStart:`${Ur(i.lineWidth)} ${i.lineType} ${i.colorSplit}`},"&:not(:last-child)":{borderInlineEnd:`${Ur(i.lineWidth)} ${i.lineType} ${i.colorSplit}`}}}},oA(i,{status:"error",addonBg:i.colorErrorBg,addonColor:i.colorErrorText})),oA(i,{status:"warning",addonBg:i.colorWarningBg,addonColor:i.colorWarningText})),{[`&${i.componentCls}-group-wrapper-disabled`]:{[`${i.componentCls}-group`]:{"&-addon":{background:i.colorFillTertiary,color:i.colorTextDisabled},"&-addon:first-child":{borderInlineStart:`${Ur(i.lineWidth)} ${i.lineType} ${i.colorBorder}`,borderTop:`${Ur(i.lineWidth)} ${i.lineType} ${i.colorBorder}`,borderBottom:`${Ur(i.lineWidth)} ${i.lineType} ${i.colorBorder}`},"&-addon:last-child":{borderInlineEnd:`${Ur(i.lineWidth)} ${i.lineType} ${i.colorBorder}`,borderTop:`${Ur(i.lineWidth)} ${i.lineType} ${i.colorBorder}`,borderBottom:`${Ur(i.lineWidth)} ${i.lineType} ${i.colorBorder}`}}}})}),kN=i=>({"&::-moz-placeholder":{opacity:1},"&::placeholder":{color:i,userSelect:"none"},"&:placeholder-shown":{textOverflow:"ellipsis"}}),HP=i=>{const{paddingBlockLG:l,lineHeightLG:f,borderRadiusLG:_,paddingInlineLG:b}=i;return{padding:`${Ur(l)} ${Ur(b)}`,fontSize:i.inputFontSizeLG,lineHeight:f,borderRadius:_}},WP=i=>({padding:`${Ur(i.paddingBlockSM)} ${Ur(i.paddingInlineSM)}`,fontSize:i.inputFontSizeSM,borderRadius:i.borderRadiusSM}),GP=i=>Object.assign(Object.assign({position:"relative",display:"inline-block",width:"100%",minWidth:0,padding:`${Ur(i.paddingBlock)} ${Ur(i.paddingInline)}`,color:i.colorText,fontSize:i.inputFontSize,lineHeight:i.lineHeight,borderRadius:i.borderRadius,transition:`all ${i.motionDurationMid}`},kN(i.colorTextPlaceholder)),{"textarea&":{maxWidth:"100%",height:"auto",minHeight:i.controlHeight,lineHeight:i.lineHeight,verticalAlign:"bottom",transition:`all ${i.motionDurationSlow}, height 0s`,resize:"vertical"},"&-lg":Object.assign({},HP(i)),"&-sm":Object.assign({},WP(i)),"&-rtl, &-textarea-rtl":{direction:"rtl"}}),zN=i=>{const{componentCls:l,antCls:f}=i;return{position:"relative",display:"table",width:"100%",borderCollapse:"separate",borderSpacing:0,"&[class*='col-']":{paddingInlineEnd:i.paddingXS,"&:last-child":{paddingInlineEnd:0}},[`&-lg ${l}, &-lg > ${l}-group-addon`]:Object.assign({},HP(i)),[`&-sm ${l}, &-sm > ${l}-group-addon`]:Object.assign({},WP(i)),[`&-lg ${f}-select-single ${f}-select-selector`]:{height:i.controlHeightLG},[`&-sm ${f}-select-single ${f}-select-selector`]:{height:i.controlHeightSM},[`> ${l}`]:{display:"table-cell","&:not(:first-child):not(:last-child)":{borderRadius:0}},[`${l}-group`]:{"&-addon, &-wrap":{display:"table-cell",width:1,whiteSpace:"nowrap",verticalAlign:"middle","&:not(:first-child):not(:last-child)":{borderRadius:0}},"&-wrap > *":{display:"block !important"},"&-addon":{position:"relative",padding:`0 ${Ur(i.paddingInline)}`,color:i.colorText,fontWeight:"normal",fontSize:i.inputFontSize,textAlign:"center",borderRadius:i.borderRadius,transition:`all ${i.motionDurationSlow}`,lineHeight:1,[`${f}-select`]:{margin:`${Ur(i.calc(i.paddingBlock).add(1).mul(-1).equal())} ${Ur(i.calc(i.paddingInline).mul(-1).equal())}`,[`&${f}-select-single:not(${f}-select-customize-input):not(${f}-pagination-size-changer)`]:{[`${f}-select-selector`]:{backgroundColor:"inherit",border:`${Ur(i.lineWidth)} ${i.lineType} transparent`,boxShadow:"none"}}},[`${f}-cascader-picker`]:{margin:`-9px ${Ur(i.calc(i.paddingInline).mul(-1).equal())}`,backgroundColor:"transparent",[`${f}-cascader-input`]:{textAlign:"start",border:0,boxShadow:"none"}}}},[l]:{width:"100%",marginBottom:0,textAlign:"inherit","&:focus":{zIndex:1,borderInlineEndWidth:1},"&:hover":{zIndex:1,borderInlineEndWidth:1,[`${l}-search-with-button &`]:{zIndex:0}}},[`> ${l}:first-child, ${l}-group-addon:first-child`]:{borderStartEndRadius:0,borderEndEndRadius:0,[`${f}-select ${f}-select-selector`]:{borderStartEndRadius:0,borderEndEndRadius:0}},[`> ${l}-affix-wrapper`]:{[`&:not(:first-child) ${l}`]:{borderStartStartRadius:0,borderEndStartRadius:0},[`&:not(:last-child) ${l}`]:{borderStartEndRadius:0,borderEndEndRadius:0}},[`> ${l}:last-child, ${l}-group-addon:last-child`]:{borderStartStartRadius:0,borderEndStartRadius:0,[`${f}-select ${f}-select-selector`]:{borderStartStartRadius:0,borderEndStartRadius:0}},[`${l}-affix-wrapper`]:{"&:not(:last-child)":{borderStartEndRadius:0,borderEndEndRadius:0,[`${l}-search &`]:{borderStartStartRadius:i.borderRadius,borderEndStartRadius:i.borderRadius}},[`&:not(:first-child), ${l}-search &:not(:first-child)`]:{borderStartStartRadius:0,borderEndStartRadius:0}},[`&${l}-group-compact`]:Object.assign(Object.assign({display:"block"},ID()),{[`${l}-group-addon, ${l}-group-wrap, > ${l}`]:{"&:not(:first-child):not(:last-child)":{borderInlineEndWidth:i.lineWidth,"&:hover, &:focus":{zIndex:1}}},"& > *":{display:"inline-flex",float:"none",verticalAlign:"top",borderRadius:0},[`
        & > ${l}-affix-wrapper,
        & > ${l}-number-affix-wrapper,
        & > ${f}-picker-range
      `]:{display:"inline-flex"},"& > *:not(:last-child)":{marginInlineEnd:i.calc(i.lineWidth).mul(-1).equal(),borderInlineEndWidth:i.lineWidth},[l]:{float:"none"},[`& > ${f}-select > ${f}-select-selector,
      & > ${f}-select-auto-complete ${l},
      & > ${f}-cascader-picker ${l},
      & > ${l}-group-wrapper ${l}`]:{borderInlineEndWidth:i.lineWidth,borderRadius:0,"&:hover, &:focus":{zIndex:1}},[`& > ${f}-select-focused`]:{zIndex:1},[`& > ${f}-select > ${f}-select-arrow`]:{zIndex:1},[`& > *:first-child,
      & > ${f}-select:first-child > ${f}-select-selector,
      & > ${f}-select-auto-complete:first-child ${l},
      & > ${f}-cascader-picker:first-child ${l}`]:{borderStartStartRadius:i.borderRadius,borderEndStartRadius:i.borderRadius},[`& > *:last-child,
      & > ${f}-select:last-child > ${f}-select-selector,
      & > ${f}-cascader-picker:last-child ${l},
      & > ${f}-cascader-picker-focused:last-child ${l}`]:{borderInlineEndWidth:i.lineWidth,borderStartEndRadius:i.borderRadius,borderEndEndRadius:i.borderRadius},[`& > ${f}-select-auto-complete ${l}`]:{verticalAlign:"top"},[`${l}-group-wrapper + ${l}-group-wrapper`]:{marginInlineStart:i.calc(i.lineWidth).mul(-1).equal(),[`${l}-affix-wrapper`]:{borderRadius:0}},[`${l}-group-wrapper:not(:last-child)`]:{[`&${l}-search > ${l}-group`]:{[`& > ${l}-group-addon > ${l}-search-button`]:{borderRadius:0},[`& > ${l}`]:{borderStartStartRadius:i.borderRadius,borderStartEndRadius:0,borderEndEndRadius:0,borderEndStartRadius:i.borderRadius}}}})}},LN=i=>{const{componentCls:l,controlHeightSM:f,lineWidth:_,calc:b}=i,O=b(f).sub(b(_).mul(2)).sub(16).div(2).equal();return{[l]:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},Ad(i)),GP(i)),MN(i)),PN(i)),IN(i)),{'&[type="color"]':{height:i.controlHeight,[`&${l}-lg`]:{height:i.controlHeightLG},[`&${l}-sm`]:{height:f,paddingTop:O,paddingBottom:O}},'&[type="search"]::-webkit-search-cancel-button, &[type="search"]::-webkit-search-decoration':{"-webkit-appearance":"none"}})}},ON=i=>{const{componentCls:l}=i;return{[`${l}-clear-icon`]:{margin:0,lineHeight:0,color:i.colorTextQuaternary,fontSize:i.fontSizeIcon,verticalAlign:-1,cursor:"pointer",transition:`color ${i.motionDurationSlow}`,border:"none",outline:"none",backgroundColor:"transparent","&:hover":{color:i.colorTextTertiary},"&:active":{color:i.colorText},"&-hidden":{visibility:"hidden"},"&-has-suffix":{margin:`0 ${Ur(i.inputAffixPadding)}`}}}},DN=i=>{const{componentCls:l,inputAffixPadding:f,colorTextDescription:_,motionDurationSlow:b,colorIcon:z,colorIconHover:O,iconCls:r}=i,H=`${l}-affix-wrapper`,Z=`${l}-affix-wrapper-disabled`;return{[H]:Object.assign(Object.assign(Object.assign(Object.assign({},GP(i)),{display:"inline-flex",[`&:not(${l}-disabled):hover`]:{zIndex:1,[`${l}-search-with-button &`]:{zIndex:0}},"&-focused, &:focus":{zIndex:1},[`> input${l}`]:{padding:0},[`> input${l}, > textarea${l}`]:{fontSize:"inherit",border:"none",borderRadius:0,outline:"none",background:"transparent",color:"inherit","&::-ms-reveal":{display:"none"},"&:focus":{boxShadow:"none !important"}},"&::before":{display:"inline-block",width:0,visibility:"hidden",content:'"\\a0"'},[l]:{"&-prefix, &-suffix":{display:"flex",flex:"none",alignItems:"center","> *:not(:last-child)":{marginInlineEnd:i.paddingXS}},"&-show-count-suffix":{color:_},"&-show-count-has-suffix":{marginInlineEnd:i.paddingXXS},"&-prefix":{marginInlineEnd:f},"&-suffix":{marginInlineStart:f}}}),ON(i)),{[`${r}${l}-password-icon`]:{color:z,cursor:"pointer",transition:`all ${b}`,"&:hover":{color:O}}}),[Z]:{[`${r}${l}-password-icon`]:{color:z,cursor:"not-allowed","&:hover":{color:z}}}}},FN=i=>{const{componentCls:l,borderRadiusLG:f,borderRadiusSM:_}=i;return{[`${l}-group`]:Object.assign(Object.assign(Object.assign({},Ad(i)),zN(i)),{"&-rtl":{direction:"rtl"},"&-wrapper":Object.assign(Object.assign(Object.assign({display:"inline-block",width:"100%",textAlign:"start",verticalAlign:"top","&-rtl":{direction:"rtl"},"&-lg":{[`${l}-group-addon`]:{borderRadius:f,fontSize:i.inputFontSizeLG}},"&-sm":{[`${l}-group-addon`]:{borderRadius:_}}},AN(i)),RN(i)),{[`&:not(${l}-compact-first-item):not(${l}-compact-last-item)${l}-compact-item`]:{[`${l}, ${l}-group-addon`]:{borderRadius:0}},[`&:not(${l}-compact-last-item)${l}-compact-first-item`]:{[`${l}, ${l}-group-addon`]:{borderStartEndRadius:0,borderEndEndRadius:0}},[`&:not(${l}-compact-first-item)${l}-compact-last-item`]:{[`${l}, ${l}-group-addon`]:{borderStartStartRadius:0,borderEndStartRadius:0}},[`&:not(${l}-compact-last-item)${l}-compact-item`]:{[`${l}-affix-wrapper`]:{borderStartEndRadius:0,borderEndEndRadius:0}}})})}},BN=i=>{const{componentCls:l,antCls:f}=i,_=`${l}-search`;return{[_]:{[l]:{"&:hover, &:focus":{[`+ ${l}-group-addon ${_}-button:not(${f}-btn-primary)`]:{borderInlineStartColor:i.colorPrimaryHover}}},[`${l}-affix-wrapper`]:{height:i.controlHeight,borderRadius:0},[`${l}-lg`]:{lineHeight:i.calc(i.lineHeightLG).sub(2e-4).equal()},[`> ${l}-group`]:{[`> ${l}-group-addon:last-child`]:{insetInlineStart:-1,padding:0,border:0,[`${_}-button`]:{marginInlineEnd:-1,borderStartStartRadius:0,borderEndStartRadius:0,boxShadow:"none"},[`${_}-button:not(${f}-btn-primary)`]:{color:i.colorTextDescription,"&:hover":{color:i.colorPrimaryHover},"&:active":{color:i.colorPrimaryActive},[`&${f}-btn-loading::before`]:{insetInlineStart:0,insetInlineEnd:0,insetBlockStart:0,insetBlockEnd:0}}}},[`${_}-button`]:{height:i.controlHeight,"&:hover, &:focus":{zIndex:1}},"&-large":{[`${l}-affix-wrapper, ${_}-button`]:{height:i.controlHeightLG}},"&-small":{[`${l}-affix-wrapper, ${_}-button`]:{height:i.controlHeightSM}},"&-rtl":{direction:"rtl"},[`&${l}-compact-item`]:{[`&:not(${l}-compact-last-item)`]:{[`${l}-group-addon`]:{[`${l}-search-button`]:{marginInlineEnd:i.calc(i.lineWidth).mul(-1).equal(),borderRadius:0}}},[`&:not(${l}-compact-first-item)`]:{[`${l},${l}-affix-wrapper`]:{borderRadius:0}},[`> ${l}-group-addon ${l}-search-button,
        > ${l},
        ${l}-affix-wrapper`]:{"&:hover, &:focus, &:active":{zIndex:2}},[`> ${l}-affix-wrapper-focused`]:{zIndex:2}}}}},NN=i=>{const{componentCls:l,paddingLG:f}=i,_=`${l}-textarea`;return{[_]:{position:"relative","&-show-count":{[`> ${l}`]:{height:"100%"},[`${l}-data-count`]:{position:"absolute",bottom:i.calc(i.fontSize).mul(i.lineHeight).mul(-1).equal(),insetInlineEnd:0,color:i.colorTextDescription,whiteSpace:"nowrap",pointerEvents:"none"}},[`
        &-allow-clear > ${l},
        &-affix-wrapper${_}-has-feedback ${l}
      `]:{paddingInlineEnd:f},[`&-affix-wrapper${l}-affix-wrapper`]:{padding:0,[`> textarea${l}`]:{fontSize:"inherit",border:"none",outline:"none",background:"transparent","&:focus":{boxShadow:"none !important"}},[`${l}-suffix`]:{margin:0,"> *:not(:last-child)":{marginInline:0},[`${l}-clear-icon`]:{position:"absolute",insetInlineEnd:i.paddingInline,insetBlockStart:i.paddingXS},[`${_}-suffix`]:{position:"absolute",top:0,insetInlineEnd:i.paddingInline,bottom:0,zIndex:1,display:"inline-flex",alignItems:"center",margin:"auto",pointerEvents:"none"}}},[`&-affix-wrapper${l}-affix-wrapper-sm`]:{[`${l}-suffix`]:{[`${l}-clear-icon`]:{insetInlineEnd:i.paddingInlineSM}}}}}},jN=i=>{const{componentCls:l}=i;return{[`${l}-out-of-range`]:{[`&, & input, & textarea, ${l}-show-count-suffix, ${l}-data-count`]:{color:i.colorError}}}},JS=Ef("Input",i=>{const l=Ml(i,jP(i));return[LN(l),NN(l),DN(l),FN(l),BN(l),jN(l),fP(l)]},$P,{resetFont:!1}),$N=i=>{const{componentCls:l,sizePaddingEdgeHorizontal:f,colorSplit:_,lineWidth:b,textPaddingInline:z,orientationMargin:O,verticalMarginInline:r}=i;return{[l]:Object.assign(Object.assign({},Ad(i)),{borderBlockStart:`${Ur(b)} solid ${_}`,"&-vertical":{position:"relative",top:"-0.06em",display:"inline-block",height:"0.9em",marginInline:r,marginBlock:0,verticalAlign:"middle",borderTop:0,borderInlineStart:`${Ur(b)} solid ${_}`},"&-horizontal":{display:"flex",clear:"both",width:"100%",minWidth:"100%",margin:`${Ur(i.dividerHorizontalGutterMargin)} 0`},[`&-horizontal${l}-with-text`]:{display:"flex",alignItems:"center",margin:`${Ur(i.dividerHorizontalWithTextGutterMargin)} 0`,color:i.colorTextHeading,fontWeight:500,fontSize:i.fontSizeLG,whiteSpace:"nowrap",textAlign:"center",borderBlockStart:`0 ${_}`,"&::before, &::after":{position:"relative",width:"50%",borderBlockStart:`${Ur(b)} solid transparent`,borderBlockStartColor:"inherit",borderBlockEnd:0,transform:"translateY(50%)",content:"''"}},[`&-horizontal${l}-with-text-left`]:{"&::before":{width:`calc(${O} * 100%)`},"&::after":{width:`calc(100% - ${O} * 100%)`}},[`&-horizontal${l}-with-text-right`]:{"&::before":{width:`calc(100% - ${O} * 100%)`},"&::after":{width:`calc(${O} * 100%)`}},[`${l}-inner-text`]:{display:"inline-block",paddingBlock:0,paddingInline:z},"&-dashed":{background:"none",borderColor:_,borderStyle:"dashed",borderWidth:`${Ur(b)} 0 0`},[`&-horizontal${l}-with-text${l}-dashed`]:{"&::before, &::after":{borderStyle:"dashed none none"}},[`&-vertical${l}-dashed`]:{borderInlineStartWidth:b,borderInlineEnd:0,borderBlockStart:0,borderBlockEnd:0},"&-dotted":{background:"none",borderColor:_,borderStyle:"dotted",borderWidth:`${Ur(b)} 0 0`},[`&-horizontal${l}-with-text${l}-dotted`]:{"&::before, &::after":{borderStyle:"dotted none none"}},[`&-vertical${l}-dotted`]:{borderInlineStartWidth:b,borderInlineEnd:0,borderBlockStart:0,borderBlockEnd:0},[`&-plain${l}-with-text`]:{color:i.colorText,fontWeight:"normal",fontSize:i.fontSize},[`&-horizontal${l}-with-text-left${l}-no-default-orientation-margin-left`]:{"&::before":{width:0},"&::after":{width:"100%"},[`${l}-inner-text`]:{paddingInlineStart:f}},[`&-horizontal${l}-with-text-right${l}-no-default-orientation-margin-right`]:{"&::before":{width:"100%"},"&::after":{width:0},[`${l}-inner-text`]:{paddingInlineEnd:f}}})}},VN=i=>({textPaddingInline:"1em",orientationMargin:.05,verticalMarginInline:i.marginXS}),UN=Ef("Divider",i=>{const l=Ml(i,{dividerHorizontalWithTextGutterMargin:i.margin,dividerHorizontalGutterMargin:i.marginLG,sizePaddingEdgeHorizontal:0});return[$N(l)]},VN,{unitless:{orientationMargin:!0}});var HN=function(i,l){var f={};for(var _ in i)Object.prototype.hasOwnProperty.call(i,_)&&l.indexOf(_)<0&&(f[_]=i[_]);if(i!=null&&typeof Object.getOwnPropertySymbols=="function")for(var b=0,_=Object.getOwnPropertySymbols(i);b<_.length;b++)l.indexOf(_[b])<0&&Object.prototype.propertyIsEnumerable.call(i,_[b])&&(f[_[b]]=i[_[b]]);return f};const QS=i=>{const{getPrefixCls:l,direction:f,divider:_}=se.useContext(Xo),{prefixCls:b,type:z="horizontal",orientation:O="center",orientationMargin:r,className:H,rootClassName:Z,children:K,dashed:te,variant:le="solid",plain:Te,style:pe}=i,ge=HN(i,["prefixCls","type","orientation","orientationMargin","className","rootClassName","children","dashed","variant","plain","style"]),fe=l("divider",b),[me,_e,Ie]=UN(fe),Ne=!!K,nt=O==="left"&&r!=null,Le=O==="right"&&r!=null,Pe=sr(fe,_==null?void 0:_.className,_e,Ie,`${fe}-${z}`,{[`${fe}-with-text`]:Ne,[`${fe}-with-text-${O}`]:Ne,[`${fe}-dashed`]:!!te,[`${fe}-${le}`]:le!=="solid",[`${fe}-plain`]:!!Te,[`${fe}-rtl`]:f==="rtl",[`${fe}-no-default-orientation-margin-left`]:nt,[`${fe}-no-default-orientation-margin-right`]:Le},H,Z),rt=se.useMemo(()=>typeof r=="number"?r:/^\d+$/.test(r)?Number(r):r,[r]),at=Object.assign(Object.assign({},nt&&{marginLeft:rt}),Le&&{marginRight:rt});return me(se.createElement("div",Object.assign({className:Pe,style:Object.assign(Object.assign({},_==null?void 0:_.style),pe)},ge,{role:"separator"}),K&&z!=="vertical"&&se.createElement("span",{className:`${fe}-inner-text`,style:at},K)))};function WN(i){return!!(i.addonBefore||i.addonAfter)}function GN(i){return!!(i.prefix||i.suffix||i.allowClear)}function sA(i,l,f){var _=l.cloneNode(!0),b=Object.create(i,{target:{value:_},currentTarget:{value:_}});return _.value=f,typeof l.selectionStart=="number"&&typeof l.selectionEnd=="number"&&(_.selectionStart=l.selectionStart,_.selectionEnd=l.selectionEnd),_.setSelectionRange=function(){l.setSelectionRange.apply(l,arguments)},b}function mx(i,l,f,_){if(f){var b=l;if(l.type==="click"){b=sA(l,i,""),f(b);return}if(i.type!=="file"&&_!==void 0){b=sA(l,i,_),f(b);return}f(b)}}function qP(i,l){if(i){i.focus(l);var f=l||{},_=f.cursor;if(_){var b=i.value.length;switch(_){case"start":i.setSelectionRange(0,0);break;case"end":i.setSelectionRange(b,b);break;default:i.setSelectionRange(0,b)}}}}var ZP=Nn.forwardRef(function(i,l){var f,_,b,z=i.inputElement,O=i.children,r=i.prefixCls,H=i.prefix,Z=i.suffix,K=i.addonBefore,te=i.addonAfter,le=i.className,Te=i.style,pe=i.disabled,ge=i.readOnly,fe=i.focused,me=i.triggerFocus,_e=i.allowClear,Ie=i.value,Ne=i.handleReset,nt=i.hidden,Le=i.classes,Pe=i.classNames,rt=i.dataAttrs,at=i.styles,Qe=i.components,lt=i.onClear,Ct=O??z,Rt=(Qe==null?void 0:Qe.affixWrapper)||"span",Nt=(Qe==null?void 0:Qe.groupWrapper)||"span",At=(Qe==null?void 0:Qe.wrapper)||"span",xt=(Qe==null?void 0:Qe.groupAddon)||"span",gt=se.useRef(null),ht=function(Wr){var ar;(ar=gt.current)!==null&&ar!==void 0&&ar.contains(Wr.target)&&(me==null||me())},vt=GN(i),Ve=se.cloneElement(Ct,{value:Ie,className:sr((f=Ct.props)===null||f===void 0?void 0:f.className,!vt&&(Pe==null?void 0:Pe.variant))||null}),je=se.useRef(null);if(Nn.useImperativeHandle(l,function(){return{nativeElement:je.current||gt.current}}),vt){var it=null;if(_e){var Mt=!pe&&!ge&&Ie,Ot="".concat(r,"-clear-icon"),sn=li(_e)==="object"&&_e!==null&&_e!==void 0&&_e.clearIcon?_e.clearIcon:"";it=Nn.createElement("button",{type:"button",onClick:function(Wr){Ne==null||Ne(Wr),lt==null||lt()},onMouseDown:function(Wr){return Wr.preventDefault()},className:sr(Ot,jt(jt({},"".concat(Ot,"-hidden"),!Mt),"".concat(Ot,"-has-suffix"),!!Z))},sn)}var hn="".concat(r,"-affix-wrapper"),Tn=sr(hn,jt(jt(jt(jt(jt({},"".concat(r,"-disabled"),pe),"".concat(hn,"-disabled"),pe),"".concat(hn,"-focused"),fe),"".concat(hn,"-readonly"),ge),"".concat(hn,"-input-with-clear-btn"),Z&&_e&&Ie),Le==null?void 0:Le.affixWrapper,Pe==null?void 0:Pe.affixWrapper,Pe==null?void 0:Pe.variant),Ut=(Z||_e)&&Nn.createElement("span",{className:sr("".concat(r,"-suffix"),Pe==null?void 0:Pe.suffix),style:at==null?void 0:at.suffix},it,Z);Ve=Nn.createElement(Rt,$s({className:Tn,style:at==null?void 0:at.affixWrapper,onClick:ht},rt==null?void 0:rt.affixWrapper,{ref:gt}),H&&Nn.createElement("span",{className:sr("".concat(r,"-prefix"),Pe==null?void 0:Pe.prefix),style:at==null?void 0:at.prefix},H),Ve,Ut)}if(WN(i)){var bn="".concat(r,"-group"),Re="".concat(bn,"-addon"),Hr="".concat(bn,"-wrapper"),Nr=sr("".concat(r,"-wrapper"),bn,Le==null?void 0:Le.wrapper,Pe==null?void 0:Pe.wrapper),Ar=sr(Hr,jt({},"".concat(Hr,"-disabled"),pe),Le==null?void 0:Le.group,Pe==null?void 0:Pe.groupWrapper);Ve=Nn.createElement(Nt,{className:Ar,ref:je},Nn.createElement(At,{className:Nr},K&&Nn.createElement(xt,{className:Re},K),Ve,te&&Nn.createElement(xt,{className:Re},te)))}return Nn.cloneElement(Ve,{className:sr((_=Ve.props)===null||_===void 0?void 0:_.className,le)||null,style:nn(nn({},(b=Ve.props)===null||b===void 0?void 0:b.style),Te),hidden:nt})}),qN=["show"];function XP(i,l){return se.useMemo(function(){var f={};l&&(f.show=li(l)==="object"&&l.formatter?l.formatter:!!l),f=nn(nn({},f),i);var _=f,b=_.show,z=Ja(_,qN);return nn(nn({},z),{},{show:!!b,showFormatter:typeof b=="function"?b:void 0,strategy:z.strategy||function(O){return O.length}})},[i,l])}var ZN=["autoComplete","onChange","onFocus","onBlur","onPressEnter","onKeyDown","onKeyUp","prefixCls","disabled","htmlSize","className","maxLength","suffix","showCount","count","type","classes","classNames","styles","onCompositionStart","onCompositionEnd"],XN=se.forwardRef(function(i,l){var f=i.autoComplete,_=i.onChange,b=i.onFocus,z=i.onBlur,O=i.onPressEnter,r=i.onKeyDown,H=i.onKeyUp,Z=i.prefixCls,K=Z===void 0?"rc-input":Z,te=i.disabled,le=i.htmlSize,Te=i.className,pe=i.maxLength,ge=i.suffix,fe=i.showCount,me=i.count,_e=i.type,Ie=_e===void 0?"text":_e,Ne=i.classes,nt=i.classNames,Le=i.styles,Pe=i.onCompositionStart,rt=i.onCompositionEnd,at=Ja(i,ZN),Qe=se.useState(!1),lt=Gn(Qe,2),Ct=lt[0],Rt=lt[1],Nt=se.useRef(!1),At=se.useRef(!1),xt=se.useRef(null),gt=se.useRef(null),ht=function(yn){xt.current&&qP(xt.current,yn)},vt=wf(i.defaultValue,{value:i.value}),Ve=Gn(vt,2),je=Ve[0],it=Ve[1],Mt=je==null?"":String(je),Ot=se.useState(null),sn=Gn(Ot,2),hn=sn[0],Tn=sn[1],Ut=XP(me,fe),bn=Ut.max||pe,Re=Ut.strategy(Mt),Hr=!!bn&&Re>bn;se.useImperativeHandle(l,function(){var Un;return{focus:ht,blur:function(){var Ir;(Ir=xt.current)===null||Ir===void 0||Ir.blur()},setSelectionRange:function(Ir,ui,_i){var Lr;(Lr=xt.current)===null||Lr===void 0||Lr.setSelectionRange(Ir,ui,_i)},select:function(){var Ir;(Ir=xt.current)===null||Ir===void 0||Ir.select()},input:xt.current,nativeElement:((Un=gt.current)===null||Un===void 0?void 0:Un.nativeElement)||xt.current}}),se.useEffect(function(){At.current&&(At.current=!1),Rt(function(Un){return Un&&te?!1:Un})},[te]);var Nr=function(yn,Ir,ui){var _i=Ir;if(!Nt.current&&Ut.exceedFormatter&&Ut.max&&Ut.strategy(Ir)>Ut.max){if(_i=Ut.exceedFormatter(Ir,{max:Ut.max}),Ir!==_i){var Lr,yi;Tn([((Lr=xt.current)===null||Lr===void 0?void 0:Lr.selectionStart)||0,((yi=xt.current)===null||yi===void 0?void 0:yi.selectionEnd)||0])}}else if(ui.source==="compositionEnd")return;it(_i),xt.current&&mx(xt.current,yn,_,_i)};se.useEffect(function(){if(hn){var Un;(Un=xt.current)===null||Un===void 0||Un.setSelectionRange.apply(Un,Xr(hn))}},[hn]);var Ar=function(yn){Nr(yn,yn.target.value,{source:"change"})},Ht=function(yn){Nt.current=!1,Nr(yn,yn.currentTarget.value,{source:"compositionEnd"}),rt==null||rt(yn)},Wr=function(yn){O&&yn.key==="Enter"&&!At.current&&(At.current=!0,O(yn)),r==null||r(yn)},ar=function(yn){yn.key==="Enter"&&(At.current=!1),H==null||H(yn)},pi=function(yn){Rt(!0),b==null||b(yn)},$n=function(yn){At.current&&(At.current=!1),Rt(!1),z==null||z(yn)},Gr=function(yn){it(""),ht(),xt.current&&mx(xt.current,yn,_)},gi=Hr&&"".concat(K,"-out-of-range"),Pr=function(){var yn=IS(i,["prefixCls","onPressEnter","addonBefore","addonAfter","prefix","suffix","allowClear","defaultValue","showCount","count","classes","htmlSize","styles","classNames","onClear"]);return Nn.createElement("input",$s({autoComplete:f},yn,{onChange:Ar,onFocus:pi,onBlur:$n,onKeyDown:Wr,onKeyUp:ar,className:sr(K,jt({},"".concat(K,"-disabled"),te),nt==null?void 0:nt.input),style:Le==null?void 0:Le.input,ref:xt,size:le,type:Ie,onCompositionStart:function(ui){Nt.current=!0,Pe==null||Pe(ui)},onCompositionEnd:Ht}))},ci=function(){var yn=Number(bn)>0;if(ge||Ut.show){var Ir=Ut.showFormatter?Ut.showFormatter({value:Mt,count:Re,maxLength:bn}):"".concat(Re).concat(yn?" / ".concat(bn):"");return Nn.createElement(Nn.Fragment,null,Ut.show&&Nn.createElement("span",{className:sr("".concat(K,"-show-count-suffix"),jt({},"".concat(K,"-show-count-has-suffix"),!!ge),nt==null?void 0:nt.count),style:nn({},Le==null?void 0:Le.count)},Ir),ge)}return null};return Nn.createElement(ZP,$s({},at,{prefixCls:K,className:sr(Te,gi),handleReset:Gr,value:Mt,focused:Ct,triggerFocus:ht,suffix:ci(),disabled:te,classes:Ne,classNames:nt,styles:Le}),Pr())});const YN=i=>{const{getPrefixCls:l,direction:f}=se.useContext(Xo),{prefixCls:_,className:b}=i,z=l("input-group",_),O=l("input"),[r,H]=JS(O),Z=sr(z,{[`${z}-lg`]:i.size==="large",[`${z}-sm`]:i.size==="small",[`${z}-compact`]:i.compact,[`${z}-rtl`]:f==="rtl"},H,b),K=se.useContext(xf),te=se.useMemo(()=>Object.assign(Object.assign({},K),{isFormItemInput:!1}),[K]);return r(se.createElement("span",{className:Z,style:i.style,onMouseEnter:i.onMouseEnter,onMouseLeave:i.onMouseLeave,onFocus:i.onFocus,onBlur:i.onBlur},se.createElement(xf.Provider,{value:te},i.children)))},YP=i=>{let l;return typeof i=="object"&&(i!=null&&i.clearIcon)?l=i:i&&(l={clearIcon:Nn.createElement(MF,null)}),l};function KP(i,l){const f=se.useRef([]),_=()=>{f.current.push(setTimeout(()=>{var b,z,O,r;!((b=i.current)===null||b===void 0)&&b.input&&((z=i.current)===null||z===void 0?void 0:z.input.getAttribute("type"))==="password"&&(!((O=i.current)===null||O===void 0)&&O.input.hasAttribute("value"))&&((r=i.current)===null||r===void 0||r.input.removeAttribute("value"))}))};return se.useEffect(()=>(l&&_(),()=>f.current.forEach(b=>{b&&clearTimeout(b)})),[]),_}function KN(i){return!!(i.prefix||i.suffix||i.allowClear||i.showCount)}var JN=function(i,l){var f={};for(var _ in i)Object.prototype.hasOwnProperty.call(i,_)&&l.indexOf(_)<0&&(f[_]=i[_]);if(i!=null&&typeof Object.getOwnPropertySymbols=="function")for(var b=0,_=Object.getOwnPropertySymbols(i);b<_.length;b++)l.indexOf(_[b])<0&&Object.prototype.propertyIsEnumerable.call(i,_[b])&&(f[_[b]]=i[_[b]]);return f};const Nx=se.forwardRef((i,l)=>{var f;const{prefixCls:_,bordered:b=!0,status:z,size:O,disabled:r,onBlur:H,onFocus:Z,suffix:K,allowClear:te,addonAfter:le,addonBefore:Te,className:pe,style:ge,styles:fe,rootClassName:me,onChange:_e,classNames:Ie,variant:Ne}=i,nt=JN(i,["prefixCls","bordered","status","size","disabled","onBlur","onFocus","suffix","allowClear","addonAfter","addonBefore","className","style","styles","rootClassName","onChange","classNames","variant"]),{getPrefixCls:Le,direction:Pe,input:rt}=Nn.useContext(Xo),at=Le("input",_),Qe=se.useRef(null),lt=cm(at),[Ct,Rt,Nt]=JS(at,lt),{compactSize:At,compactItemClassnames:xt}=US(at,Pe),gt=bp(Ar=>{var Ht;return(Ht=O??At)!==null&&Ht!==void 0?Ht:Ar}),ht=Nn.useContext(vf),vt=r??ht,{status:Ve,hasFeedback:je,feedbackIcon:it}=se.useContext(xf),Mt=ZS(Ve,z),Ot=KN(i)||!!je;se.useRef(Ot);const sn=KP(Qe,!0),hn=Ar=>{sn(),H==null||H(Ar)},Tn=Ar=>{sn(),Z==null||Z(Ar)},Ut=Ar=>{sn(),_e==null||_e(Ar)},bn=(je||K)&&Nn.createElement(Nn.Fragment,null,K,je&&it),Re=YP(te??(rt==null?void 0:rt.allowClear)),[Hr,Nr]=SP("input",Ne,b);return Ct(Nn.createElement(XN,Object.assign({ref:bf(l,Qe),prefixCls:at,autoComplete:rt==null?void 0:rt.autoComplete},nt,{disabled:vt,onBlur:hn,onFocus:Tn,style:Object.assign(Object.assign({},rt==null?void 0:rt.style),ge),styles:Object.assign(Object.assign({},rt==null?void 0:rt.styles),fe),suffix:bn,allowClear:Re,className:sr(pe,me,Nt,lt,xt,rt==null?void 0:rt.className),onChange:Ut,addonBefore:Te&&Nn.createElement(Ow,{form:!0,space:!0},Te),addonAfter:le&&Nn.createElement(Ow,{form:!0,space:!0},le),classNames:Object.assign(Object.assign(Object.assign({},Ie),rt==null?void 0:rt.classNames),{input:sr({[`${at}-sm`]:gt==="small",[`${at}-lg`]:gt==="large",[`${at}-rtl`]:Pe==="rtl"},Ie==null?void 0:Ie.input,(f=rt==null?void 0:rt.classNames)===null||f===void 0?void 0:f.input,Rt),variant:sr({[`${at}-${Hr}`]:Nr},Fw(at,Mt)),affixWrapper:sr({[`${at}-affix-wrapper-sm`]:gt==="small",[`${at}-affix-wrapper-lg`]:gt==="large",[`${at}-affix-wrapper-rtl`]:Pe==="rtl"},Rt),wrapper:sr({[`${at}-group-rtl`]:Pe==="rtl"},Rt),groupWrapper:sr({[`${at}-group-wrapper-sm`]:gt==="small",[`${at}-group-wrapper-lg`]:gt==="large",[`${at}-group-wrapper-rtl`]:Pe==="rtl",[`${at}-group-wrapper-${Hr}`]:Nr},Fw(`${at}-group-wrapper`,Mt,je),Rt)})})))}),QN=i=>{const{componentCls:l,paddingXS:f}=i;return{[l]:{display:"inline-flex",alignItems:"center",flexWrap:"nowrap",columnGap:f,"&-rtl":{direction:"rtl"},[`${l}-input`]:{textAlign:"center",paddingInline:i.paddingXXS},[`&${l}-sm ${l}-input`]:{paddingInline:i.calc(i.paddingXXS).div(2).equal()},[`&${l}-lg ${l}-input`]:{paddingInline:i.paddingXS}}}},ej=Ef(["Input","OTP"],i=>{const l=Ml(i,jP(i));return[QN(l)]},$P);var tj=function(i,l){var f={};for(var _ in i)Object.prototype.hasOwnProperty.call(i,_)&&l.indexOf(_)<0&&(f[_]=i[_]);if(i!=null&&typeof Object.getOwnPropertySymbols=="function")for(var b=0,_=Object.getOwnPropertySymbols(i);b<_.length;b++)l.indexOf(_[b])<0&&Object.prototype.propertyIsEnumerable.call(i,_[b])&&(f[_[b]]=i[_[b]]);return f};const nj=se.forwardRef((i,l)=>{const{value:f,onChange:_,onActiveChange:b,index:z,mask:O}=i,r=tj(i,["value","onChange","onActiveChange","index","mask"]),H=f&&typeof O=="string"?O:f,Z=pe=>{_(z,pe.target.value)},K=se.useRef(null);se.useImperativeHandle(l,()=>K.current);const te=()=>{qu(()=>{var pe;const ge=(pe=K.current)===null||pe===void 0?void 0:pe.input;document.activeElement===ge&&ge&&ge.select()})},le=pe=>{const{key:ge,ctrlKey:fe,metaKey:me}=pe;ge==="ArrowLeft"?b(z-1):ge==="ArrowRight"?b(z+1):ge==="z"&&(fe||me)&&pe.preventDefault(),te()},Te=pe=>{pe.key==="Backspace"&&!f&&b(z-1),te()};return se.createElement(Nx,Object.assign({type:O===!0?"password":"text"},r,{ref:K,value:H,onInput:Z,onFocus:te,onKeyDown:le,onKeyUp:Te,onMouseDown:te,onMouseUp:te}))});var rj=function(i,l){var f={};for(var _ in i)Object.prototype.hasOwnProperty.call(i,_)&&l.indexOf(_)<0&&(f[_]=i[_]);if(i!=null&&typeof Object.getOwnPropertySymbols=="function")for(var b=0,_=Object.getOwnPropertySymbols(i);b<_.length;b++)l.indexOf(_[b])<0&&Object.prototype.propertyIsEnumerable.call(i,_[b])&&(f[_[b]]=i[_[b]]);return f};function yv(i){return(i||"").split("")}const ij=se.forwardRef((i,l)=>{const{prefixCls:f,length:_=6,size:b,defaultValue:z,value:O,onChange:r,formatter:H,variant:Z,disabled:K,status:te,autoFocus:le,mask:Te,type:pe,onInput:ge,inputMode:fe}=i,me=rj(i,["prefixCls","length","size","defaultValue","value","onChange","formatter","variant","disabled","status","autoFocus","mask","type","onInput","inputMode"]),{getPrefixCls:_e,direction:Ie}=se.useContext(Xo),Ne=_e("otp",f),nt=eP(me,{aria:!0,data:!0,attr:!0}),Le=cm(Ne),[Pe,rt,at]=ej(Ne,Le),Qe=bp(Ot=>b??Ot),lt=se.useContext(xf),Ct=ZS(lt.status,te),Rt=se.useMemo(()=>Object.assign(Object.assign({},lt),{status:Ct,hasFeedback:!1,feedbackIcon:null}),[lt,Ct]),Nt=se.useRef(null),At=se.useRef({});se.useImperativeHandle(l,()=>({focus:()=>{var Ot;(Ot=At.current[0])===null||Ot===void 0||Ot.focus()},blur:()=>{var Ot;for(let sn=0;sn<_;sn+=1)(Ot=At.current[sn])===null||Ot===void 0||Ot.blur()},nativeElement:Nt.current}));const xt=Ot=>H?H(Ot):Ot,[gt,ht]=se.useState(yv(xt(z||"")));se.useEffect(()=>{O!==void 0&&ht(yv(O))},[O]);const vt=mc(Ot=>{ht(Ot),ge&&ge(Ot),r&&Ot.length===_&&Ot.every(sn=>sn)&&Ot.some((sn,hn)=>gt[hn]!==sn)&&r(Ot.join(""))}),Ve=mc((Ot,sn)=>{let hn=Xr(gt);for(let Ut=0;Ut<Ot;Ut+=1)hn[Ut]||(hn[Ut]="");sn.length<=1?hn[Ot]=sn:hn=hn.slice(0,Ot).concat(yv(sn)),hn=hn.slice(0,_);for(let Ut=hn.length-1;Ut>=0&&!hn[Ut];Ut-=1)hn.pop();const Tn=xt(hn.map(Ut=>Ut||" ").join(""));return hn=yv(Tn).map((Ut,bn)=>Ut===" "&&!hn[bn]?hn[bn]:Ut),hn}),je=(Ot,sn)=>{var hn;const Tn=Ve(Ot,sn),Ut=Math.min(Ot+sn.length,_-1);Ut!==Ot&&Tn[Ot]!==void 0&&((hn=At.current[Ut])===null||hn===void 0||hn.focus()),vt(Tn)},it=Ot=>{var sn;(sn=At.current[Ot])===null||sn===void 0||sn.focus()},Mt={variant:Z,disabled:K,status:Ct,mask:Te,type:pe,inputMode:fe};return Pe(se.createElement("div",Object.assign({},nt,{ref:Nt,className:sr(Ne,{[`${Ne}-sm`]:Qe==="small",[`${Ne}-lg`]:Qe==="large",[`${Ne}-rtl`]:Ie==="rtl"},at,rt)}),se.createElement(xf.Provider,{value:Rt},Array.from({length:_}).map((Ot,sn)=>{const hn=`otp-${sn}`,Tn=gt[sn]||"";return se.createElement(nj,Object.assign({ref:Ut=>{At.current[sn]=Ut},key:hn,index:sn,size:Qe,htmlSize:1,className:`${Ne}-input`,onChange:je,value:Tn,onActiveChange:it,autoFocus:sn===0&&le},Mt))}))))});var oj={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M942.2 486.2Q889.47 375.11 816.7 305l-50.88 50.88C807.31 395.53 843.45 447.4 874.7 512 791.5 684.2 673.4 766 512 766q-72.67 0-133.87-22.38L323 798.75Q408 838 512 838q288.3 0 430.2-300.3a60.29 60.29 0 000-51.5zm-63.57-320.64L836 122.88a8 8 0 00-11.32 0L715.31 232.2Q624.86 186 512 186q-288.3 0-430.2 300.3a60.3 60.3 0 000 51.5q56.69 119.4 136.5 191.41L112.48 835a8 8 0 000 11.31L155.17 889a8 8 0 0011.31 0l712.15-712.12a8 8 0 000-11.32zM149.3 512C232.6 339.8 350.7 258 512 258c54.54 0 104.13 9.36 149.12 28.39l-70.3 70.3a176 176 0 00-238.13 238.13l-83.42 83.42C223.1 637.49 183.3 582.28 149.3 512zm246.7 0a112.11 112.11 0 01146.2-106.69L401.31 546.2A112 112 0 01396 512z"}},{tag:"path",attrs:{d:"M508 624c-3.46 0-6.87-.16-10.25-.47l-52.82 52.82a176.09 176.09 0 00227.42-227.42l-52.82 52.82c.31 3.38.47 6.79.47 10.25a111.94 111.94 0 01-112 112z"}}]},name:"eye-invisible",theme:"outlined"},sj=function(l,f){return se.createElement(xp,$s({},l,{ref:f,icon:oj}))},aj=se.forwardRef(sj),lj={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M942.2 486.2C847.4 286.5 704.1 186 512 186c-192.2 0-335.4 100.5-430.2 300.3a60.3 60.3 0 000 51.5C176.6 737.5 319.9 838 512 838c192.2 0 335.4-100.5 430.2-300.3 7.7-16.2 7.7-35 0-51.5zM512 766c-161.3 0-279.4-81.8-362.7-254C232.6 339.8 350.7 258 512 258c161.3 0 279.4 81.8 362.7 254C791.5 684.2 673.4 766 512 766zm-4-430c-97.2 0-176 78.8-176 176s78.8 176 176 176 176-78.8 176-176-78.8-176-176-176zm0 288c-61.9 0-112-50.1-112-112s50.1-112 112-112 112 50.1 112 112-50.1 112-112 112z"}}]},name:"eye",theme:"outlined"},cj=function(l,f){return se.createElement(xp,$s({},l,{ref:f,icon:lj}))},uj=se.forwardRef(cj),hj=function(i,l){var f={};for(var _ in i)Object.prototype.hasOwnProperty.call(i,_)&&l.indexOf(_)<0&&(f[_]=i[_]);if(i!=null&&typeof Object.getOwnPropertySymbols=="function")for(var b=0,_=Object.getOwnPropertySymbols(i);b<_.length;b++)l.indexOf(_[b])<0&&Object.prototype.propertyIsEnumerable.call(i,_[b])&&(f[_[b]]=i[_[b]]);return f};const dj=i=>i?se.createElement(uj,null):se.createElement(aj,null),fj={click:"onClick",hover:"onMouseOver"},pj=se.forwardRef((i,l)=>{const{disabled:f,action:_="click",visibilityToggle:b=!0,iconRender:z=dj}=i,O=se.useContext(vf),r=f??O,H=typeof b=="object"&&b.visible!==void 0,[Z,K]=se.useState(()=>H?b.visible:!1),te=se.useRef(null);se.useEffect(()=>{H&&K(b.visible)},[H,b]);const le=KP(te),Te=()=>{var Qe;if(r)return;Z&&le();const lt=!Z;K(lt),typeof b=="object"&&((Qe=b.onVisibleChange)===null||Qe===void 0||Qe.call(b,lt))},pe=Qe=>{const lt=fj[_]||"",Ct=z(Z),Rt={[lt]:Te,className:`${Qe}-icon`,key:"passwordIcon",onMouseDown:Nt=>{Nt.preventDefault()},onMouseUp:Nt=>{Nt.preventDefault()}};return se.cloneElement(se.isValidElement(Ct)?Ct:se.createElement("span",null,Ct),Rt)},{className:ge,prefixCls:fe,inputPrefixCls:me,size:_e}=i,Ie=hj(i,["className","prefixCls","inputPrefixCls","size"]),{getPrefixCls:Ne}=se.useContext(Xo),nt=Ne("input",me),Le=Ne("input-password",fe),Pe=b&&pe(Le),rt=sr(Le,ge,{[`${Le}-${_e}`]:!!_e}),at=Object.assign(Object.assign({},IS(Ie,["suffix","iconRender","visibilityToggle"])),{type:Z?"text":"password",className:rt,prefixCls:nt,suffix:Pe});return _e&&(at.size=_e),se.createElement(Nx,Object.assign({ref:bf(l,te)},at))});var mj=function(i,l){var f={};for(var _ in i)Object.prototype.hasOwnProperty.call(i,_)&&l.indexOf(_)<0&&(f[_]=i[_]);if(i!=null&&typeof Object.getOwnPropertySymbols=="function")for(var b=0,_=Object.getOwnPropertySymbols(i);b<_.length;b++)l.indexOf(_[b])<0&&Object.prototype.propertyIsEnumerable.call(i,_[b])&&(f[_[b]]=i[_[b]]);return f};const gj=se.forwardRef((i,l)=>{const{prefixCls:f,inputPrefixCls:_,className:b,size:z,suffix:O,enterButton:r=!1,addonAfter:H,loading:Z,disabled:K,onSearch:te,onChange:le,onCompositionStart:Te,onCompositionEnd:pe}=i,ge=mj(i,["prefixCls","inputPrefixCls","className","size","suffix","enterButton","addonAfter","loading","disabled","onSearch","onChange","onCompositionStart","onCompositionEnd"]),{getPrefixCls:fe,direction:me}=se.useContext(Xo),_e=se.useRef(!1),Ie=fe("input-search",f),Ne=fe("input",_),{compactSize:nt}=US(Ie,me),Le=bp(je=>{var it;return(it=z??nt)!==null&&it!==void 0?it:je}),Pe=se.useRef(null),rt=je=>{je!=null&&je.target&&je.type==="click"&&te&&te(je.target.value,je,{source:"clear"}),le==null||le(je)},at=je=>{var it;document.activeElement===((it=Pe.current)===null||it===void 0?void 0:it.input)&&je.preventDefault()},Qe=je=>{var it,Mt;te&&te((Mt=(it=Pe.current)===null||it===void 0?void 0:it.input)===null||Mt===void 0?void 0:Mt.value,je,{source:"input"})},lt=je=>{_e.current||Z||Qe(je)},Ct=typeof r=="boolean"?se.createElement(A5,null):null,Rt=`${Ie}-button`;let Nt;const At=r||{},xt=At.type&&At.type.__ANT_BUTTON===!0;xt||At.type==="button"?Nt=om(At,Object.assign({onMouseDown:at,onClick:je=>{var it,Mt;(Mt=(it=At==null?void 0:At.props)===null||it===void 0?void 0:it.onClick)===null||Mt===void 0||Mt.call(it,je),Qe(je)},key:"enterButton"},xt?{className:Rt,size:Le}:{})):Nt=se.createElement(GS,{className:Rt,type:r?"primary":void 0,size:Le,disabled:K,key:"enterButton",onMouseDown:at,onClick:Qe,loading:Z,icon:Ct},r),H&&(Nt=[Nt,om(H,{key:"addonAfter"})]);const gt=sr(Ie,{[`${Ie}-rtl`]:me==="rtl",[`${Ie}-${Le}`]:!!Le,[`${Ie}-with-button`]:!!r},b),ht=Object.assign(Object.assign({},ge),{className:gt,prefixCls:Ne,type:"search"}),vt=je=>{_e.current=!0,Te==null||Te(je)},Ve=je=>{_e.current=!1,pe==null||pe(je)};return se.createElement(Nx,Object.assign({ref:bf(Pe,l),onPressEnter:lt},ht,{size:Le,onCompositionStart:vt,onCompositionEnd:Ve,addonAfter:Nt,suffix:O,onChange:rt,disabled:K}))});var _j=`
  min-height:0 !important;
  max-height:none !important;
  height:0 !important;
  visibility:hidden !important;
  overflow:hidden !important;
  position:absolute !important;
  z-index:-1000 !important;
  top:0 !important;
  right:0 !important;
  pointer-events: none !important;
`,yj=["letter-spacing","line-height","padding-top","padding-bottom","font-family","font-weight","font-size","font-variant","text-rendering","text-transform","width","text-indent","padding-left","padding-right","border-width","box-sizing","word-break","white-space"],z1={},gu;function vj(i){var l=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1,f=i.getAttribute("id")||i.getAttribute("data-reactid")||i.getAttribute("name");if(l&&z1[f])return z1[f];var _=window.getComputedStyle(i),b=_.getPropertyValue("box-sizing")||_.getPropertyValue("-moz-box-sizing")||_.getPropertyValue("-webkit-box-sizing"),z=parseFloat(_.getPropertyValue("padding-bottom"))+parseFloat(_.getPropertyValue("padding-top")),O=parseFloat(_.getPropertyValue("border-bottom-width"))+parseFloat(_.getPropertyValue("border-top-width")),r=yj.map(function(Z){return"".concat(Z,":").concat(_.getPropertyValue(Z))}).join(";"),H={sizingStyle:r,paddingSize:z,borderSize:O,boxSizing:b};return l&&f&&(z1[f]=H),H}function xj(i){var l=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1,f=arguments.length>2&&arguments[2]!==void 0?arguments[2]:null,_=arguments.length>3&&arguments[3]!==void 0?arguments[3]:null;gu||(gu=document.createElement("textarea"),gu.setAttribute("tab-index","-1"),gu.setAttribute("aria-hidden","true"),gu.setAttribute("name","hiddenTextarea"),document.body.appendChild(gu)),i.getAttribute("wrap")?gu.setAttribute("wrap",i.getAttribute("wrap")):gu.removeAttribute("wrap");var b=vj(i,l),z=b.paddingSize,O=b.borderSize,r=b.boxSizing,H=b.sizingStyle;gu.setAttribute("style","".concat(H,";").concat(_j)),gu.value=i.value||i.placeholder||"";var Z=void 0,K=void 0,te,le=gu.scrollHeight;if(r==="border-box"?le+=O:r==="content-box"&&(le-=z),f!==null||_!==null){gu.value=" ";var Te=gu.scrollHeight-z;f!==null&&(Z=Te*f,r==="border-box"&&(Z=Z+z+O),le=Math.max(Z,le)),_!==null&&(K=Te*_,r==="border-box"&&(K=K+z+O),te=le>K?"":"hidden",le=Math.min(K,le))}var pe={height:le,overflowY:te,resize:"none"};return Z&&(pe.minHeight=Z),K&&(pe.maxHeight=K),pe}var bj=["prefixCls","defaultValue","value","autoSize","onResize","className","style","disabled","onChange","onInternalAutoSize"],L1=0,O1=1,D1=2,wj=se.forwardRef(function(i,l){var f=i,_=f.prefixCls,b=f.defaultValue,z=f.value,O=f.autoSize,r=f.onResize,H=f.className,Z=f.style,K=f.disabled,te=f.onChange;f.onInternalAutoSize;var le=Ja(f,bj),Te=wf(b,{value:z,postState:function(Ot){return Ot??""}}),pe=Gn(Te,2),ge=pe[0],fe=pe[1],me=function(Ot){fe(Ot.target.value),te==null||te(Ot)},_e=se.useRef();se.useImperativeHandle(l,function(){return{textArea:_e.current}});var Ie=se.useMemo(function(){return O&&li(O)==="object"?[O.minRows,O.maxRows]:[]},[O]),Ne=Gn(Ie,2),nt=Ne[0],Le=Ne[1],Pe=!!O,rt=function(){try{if(document.activeElement===_e.current){var Ot=_e.current,sn=Ot.selectionStart,hn=Ot.selectionEnd,Tn=Ot.scrollTop;_e.current.setSelectionRange(sn,hn),_e.current.scrollTop=Tn}}catch{}},at=se.useState(D1),Qe=Gn(at,2),lt=Qe[0],Ct=Qe[1],Rt=se.useState(),Nt=Gn(Rt,2),At=Nt[0],xt=Nt[1],gt=function(){Ct(L1)};Ka(function(){Pe&&gt()},[z,nt,Le,Pe]),Ka(function(){if(lt===L1)Ct(O1);else if(lt===O1){var Mt=xj(_e.current,!1,nt,Le);Ct(D1),xt(Mt)}else rt()},[lt]);var ht=se.useRef(),vt=function(){qu.cancel(ht.current)},Ve=function(Ot){lt===D1&&(r==null||r(Ot),O&&(vt(),ht.current=qu(function(){gt()})))};se.useEffect(function(){return vt},[]);var je=Pe?At:null,it=nn(nn({},Z),je);return(lt===L1||lt===O1)&&(it.overflowY="hidden",it.overflowX="hidden"),se.createElement(ay,{onResize:Ve,disabled:!(O||r)},se.createElement("textarea",$s({},le,{ref:_e,style:it,className:sr(_,H,jt({},"".concat(_,"-disabled"),K)),disabled:K,value:ge,onChange:me})))}),Sj=["defaultValue","value","onFocus","onBlur","onChange","allowClear","maxLength","onCompositionStart","onCompositionEnd","suffix","prefixCls","showCount","count","className","style","disabled","hidden","classNames","styles","onResize","onClear","onPressEnter","readOnly","autoSize","onKeyDown"],Ej=Nn.forwardRef(function(i,l){var f,_=i.defaultValue,b=i.value,z=i.onFocus,O=i.onBlur,r=i.onChange,H=i.allowClear,Z=i.maxLength,K=i.onCompositionStart,te=i.onCompositionEnd,le=i.suffix,Te=i.prefixCls,pe=Te===void 0?"rc-textarea":Te,ge=i.showCount,fe=i.count,me=i.className,_e=i.style,Ie=i.disabled,Ne=i.hidden,nt=i.classNames,Le=i.styles,Pe=i.onResize,rt=i.onClear,at=i.onPressEnter,Qe=i.readOnly,lt=i.autoSize,Ct=i.onKeyDown,Rt=Ja(i,Sj),Nt=wf(_,{value:b,defaultValue:_}),At=Gn(Nt,2),xt=At[0],gt=At[1],ht=xt==null?"":String(xt),vt=Nn.useState(!1),Ve=Gn(vt,2),je=Ve[0],it=Ve[1],Mt=Nn.useRef(!1),Ot=Nn.useState(null),sn=Gn(Ot,2),hn=sn[0],Tn=sn[1],Ut=se.useRef(null),bn=se.useRef(null),Re=function(){var dr;return(dr=bn.current)===null||dr===void 0?void 0:dr.textArea},Hr=function(){Re().focus()};se.useImperativeHandle(l,function(){var mr;return{resizableTextArea:bn.current,focus:Hr,blur:function(){Re().blur()},nativeElement:((mr=Ut.current)===null||mr===void 0?void 0:mr.nativeElement)||Re()}}),se.useEffect(function(){it(function(mr){return!Ie&&mr})},[Ie]);var Nr=Nn.useState(null),Ar=Gn(Nr,2),Ht=Ar[0],Wr=Ar[1];Nn.useEffect(function(){if(Ht){var mr;(mr=Re()).setSelectionRange.apply(mr,Xr(Ht))}},[Ht]);var ar=XP(fe,ge),pi=(f=ar.max)!==null&&f!==void 0?f:Z,$n=Number(pi)>0,Gr=ar.strategy(ht),gi=!!pi&&Gr>pi,Pr=function(dr,wo){var Zi=wo;!Mt.current&&ar.exceedFormatter&&ar.max&&ar.strategy(wo)>ar.max&&(Zi=ar.exceedFormatter(wo,{max:ar.max}),wo!==Zi&&Wr([Re().selectionStart||0,Re().selectionEnd||0])),gt(Zi),mx(dr.currentTarget,dr,r,Zi)},ci=function(dr){Mt.current=!0,K==null||K(dr)},Un=function(dr){Mt.current=!1,Pr(dr,dr.currentTarget.value),te==null||te(dr)},yn=function(dr){Pr(dr,dr.target.value)},Ir=function(dr){dr.key==="Enter"&&at&&at(dr),Ct==null||Ct(dr)},ui=function(dr){it(!0),z==null||z(dr)},_i=function(dr){it(!1),O==null||O(dr)},Lr=function(dr){gt(""),Hr(),mx(Re(),dr,r)},yi=le,oi;ar.show&&(ar.showFormatter?oi=ar.showFormatter({value:ht,count:Gr,maxLength:pi}):oi="".concat(Gr).concat($n?" / ".concat(pi):""),yi=Nn.createElement(Nn.Fragment,null,yi,Nn.createElement("span",{className:sr("".concat(pe,"-data-count"),nt==null?void 0:nt.count),style:Le==null?void 0:Le.count},oi)));var qi=function(dr){var wo;Pe==null||Pe(dr),(wo=Re())!==null&&wo!==void 0&&wo.style.height&&Tn(!0)},Ci=!lt&&!ge&&!H;return Nn.createElement(ZP,{ref:Ut,value:ht,allowClear:H,handleReset:Lr,suffix:yi,prefixCls:pe,classNames:nn(nn({},nt),{},{affixWrapper:sr(nt==null?void 0:nt.affixWrapper,jt(jt({},"".concat(pe,"-show-count"),ge),"".concat(pe,"-textarea-allow-clear"),H))}),disabled:Ie,focused:je,className:sr(me,gi&&"".concat(pe,"-out-of-range")),style:nn(nn({},_e),hn&&!Ci?{height:"auto"}:{}),dataAttrs:{affixWrapper:{"data-count":typeof oi=="string"?oi:void 0}},hidden:Ne,readOnly:Qe,onClear:rt},Nn.createElement(wj,$s({},Rt,{autoSize:lt,maxLength:Z,onKeyDown:Ir,onChange:yn,onFocus:ui,onBlur:_i,onCompositionStart:ci,onCompositionEnd:Un,className:sr(nt==null?void 0:nt.textarea),style:nn(nn({},Le==null?void 0:Le.textarea),{},{resize:_e==null?void 0:_e.resize}),disabled:Ie,prefixCls:pe,onResize:qi,ref:bn,readOnly:Qe})))}),Tj=function(i,l){var f={};for(var _ in i)Object.prototype.hasOwnProperty.call(i,_)&&l.indexOf(_)<0&&(f[_]=i[_]);if(i!=null&&typeof Object.getOwnPropertySymbols=="function")for(var b=0,_=Object.getOwnPropertySymbols(i);b<_.length;b++)l.indexOf(_[b])<0&&Object.prototype.propertyIsEnumerable.call(i,_[b])&&(f[_[b]]=i[_[b]]);return f};const Cj=se.forwardRef((i,l)=>{var f,_;const{prefixCls:b,bordered:z=!0,size:O,disabled:r,status:H,allowClear:Z,classNames:K,rootClassName:te,className:le,style:Te,styles:pe,variant:ge}=i,fe=Tj(i,["prefixCls","bordered","size","disabled","status","allowClear","classNames","rootClassName","className","style","styles","variant"]),{getPrefixCls:me,direction:_e,textArea:Ie}=se.useContext(Xo),Ne=bp(O),nt=se.useContext(vf),Le=r??nt,{status:Pe,hasFeedback:rt,feedbackIcon:at}=se.useContext(xf),Qe=ZS(Pe,H),lt=se.useRef(null);se.useImperativeHandle(l,()=>{var Ve;return{resizableTextArea:(Ve=lt.current)===null||Ve===void 0?void 0:Ve.resizableTextArea,focus:je=>{var it,Mt;qP((Mt=(it=lt.current)===null||it===void 0?void 0:it.resizableTextArea)===null||Mt===void 0?void 0:Mt.textArea,je)},blur:()=>{var je;return(je=lt.current)===null||je===void 0?void 0:je.blur()}}});const Ct=me("input",b),Rt=cm(Ct),[Nt,At,xt]=JS(Ct,Rt),[gt,ht]=SP("textArea",ge,z),vt=YP(Z??(Ie==null?void 0:Ie.allowClear));return Nt(se.createElement(Ej,Object.assign({autoComplete:Ie==null?void 0:Ie.autoComplete},fe,{style:Object.assign(Object.assign({},Ie==null?void 0:Ie.style),Te),styles:Object.assign(Object.assign({},Ie==null?void 0:Ie.styles),pe),disabled:Le,allowClear:vt,className:sr(xt,Rt,le,te,Ie==null?void 0:Ie.className),classNames:Object.assign(Object.assign(Object.assign({},K),Ie==null?void 0:Ie.classNames),{textarea:sr({[`${Ct}-sm`]:Ne==="small",[`${Ct}-lg`]:Ne==="large"},At,K==null?void 0:K.textarea,(f=Ie==null?void 0:Ie.classNames)===null||f===void 0?void 0:f.textarea),variant:sr({[`${Ct}-${gt}`]:ht},Fw(Ct,Qe)),affixWrapper:sr(`${Ct}-textarea-affix-wrapper`,{[`${Ct}-affix-wrapper-rtl`]:_e==="rtl",[`${Ct}-affix-wrapper-sm`]:Ne==="small",[`${Ct}-affix-wrapper-lg`]:Ne==="large",[`${Ct}-textarea-show-count`]:i.showCount||((_=i.count)===null||_===void 0?void 0:_.show)},At)}),prefixCls:Ct,suffix:rt&&se.createElement("span",{className:`${Ct}-textarea-suffix`},at),ref:lt})))}),fp=Nx;fp.Group=YN;fp.Search=gj;fp.TextArea=Cj;fp.Password=pj;fp.OTP=ij;var Mj=["prefixCls","className","checked","defaultChecked","disabled","loadingIcon","checkedChildren","unCheckedChildren","onClick","onChange","onKeyDown"],JP=se.forwardRef(function(i,l){var f,_=i.prefixCls,b=_===void 0?"rc-switch":_,z=i.className,O=i.checked,r=i.defaultChecked,H=i.disabled,Z=i.loadingIcon,K=i.checkedChildren,te=i.unCheckedChildren,le=i.onClick,Te=i.onChange,pe=i.onKeyDown,ge=Ja(i,Mj),fe=wf(!1,{value:O,defaultValue:r}),me=Gn(fe,2),_e=me[0],Ie=me[1];function Ne(rt,at){var Qe=_e;return H||(Qe=rt,Ie(Qe),Te==null||Te(Qe,at)),Qe}function nt(rt){rt.which===ei.LEFT?Ne(!1,rt):rt.which===ei.RIGHT&&Ne(!0,rt),pe==null||pe(rt)}function Le(rt){var at=Ne(!_e,rt);le==null||le(at,rt)}var Pe=sr(b,z,(f={},jt(f,"".concat(b,"-checked"),_e),jt(f,"".concat(b,"-disabled"),H),f));return se.createElement("button",$s({},ge,{type:"button",role:"switch","aria-checked":_e,disabled:H,className:Pe,ref:l,onKeyDown:nt,onClick:Le}),Z,se.createElement("span",{className:"".concat(b,"-inner")},se.createElement("span",{className:"".concat(b,"-inner-checked")},K),se.createElement("span",{className:"".concat(b,"-inner-unchecked")},te)))});JP.displayName="Switch";const Aj=i=>{const{componentCls:l,trackHeightSM:f,trackPadding:_,trackMinWidthSM:b,innerMinMarginSM:z,innerMaxMarginSM:O,handleSizeSM:r,calc:H}=i,Z=`${l}-inner`,K=Ur(H(r).add(H(_).mul(2)).equal()),te=Ur(H(O).mul(2).equal());return{[l]:{[`&${l}-small`]:{minWidth:b,height:f,lineHeight:Ur(f),[`${l}-inner`]:{paddingInlineStart:O,paddingInlineEnd:z,[`${Z}-checked, ${Z}-unchecked`]:{minHeight:f},[`${Z}-checked`]:{marginInlineStart:`calc(-100% + ${K} - ${te})`,marginInlineEnd:`calc(100% - ${K} + ${te})`},[`${Z}-unchecked`]:{marginTop:H(f).mul(-1).equal(),marginInlineStart:0,marginInlineEnd:0}},[`${l}-handle`]:{width:r,height:r},[`${l}-loading-icon`]:{top:H(H(r).sub(i.switchLoadingIconSize)).div(2).equal(),fontSize:i.switchLoadingIconSize},[`&${l}-checked`]:{[`${l}-inner`]:{paddingInlineStart:z,paddingInlineEnd:O,[`${Z}-checked`]:{marginInlineStart:0,marginInlineEnd:0},[`${Z}-unchecked`]:{marginInlineStart:`calc(100% - ${K} + ${te})`,marginInlineEnd:`calc(-100% + ${K} - ${te})`}},[`${l}-handle`]:{insetInlineStart:`calc(100% - ${Ur(H(r).add(_).equal())})`}},[`&:not(${l}-disabled):active`]:{[`&:not(${l}-checked) ${Z}`]:{[`${Z}-unchecked`]:{marginInlineStart:H(i.marginXXS).div(2).equal(),marginInlineEnd:H(i.marginXXS).mul(-1).div(2).equal()}},[`&${l}-checked ${Z}`]:{[`${Z}-checked`]:{marginInlineStart:H(i.marginXXS).mul(-1).div(2).equal(),marginInlineEnd:H(i.marginXXS).div(2).equal()}}}}}}},Ij=i=>{const{componentCls:l,handleSize:f,calc:_}=i;return{[l]:{[`${l}-loading-icon${i.iconCls}`]:{position:"relative",top:_(_(f).sub(i.fontSize)).div(2).equal(),color:i.switchLoadingIconColor,verticalAlign:"top"},[`&${l}-checked ${l}-loading-icon`]:{color:i.switchColor}}}},Pj=i=>{const{componentCls:l,trackPadding:f,handleBg:_,handleShadow:b,handleSize:z,calc:O}=i,r=`${l}-handle`;return{[l]:{[r]:{position:"absolute",top:f,insetInlineStart:f,width:z,height:z,transition:`all ${i.switchDuration} ease-in-out`,"&::before":{position:"absolute",top:0,insetInlineEnd:0,bottom:0,insetInlineStart:0,backgroundColor:_,borderRadius:O(z).div(2).equal(),boxShadow:b,transition:`all ${i.switchDuration} ease-in-out`,content:'""'}},[`&${l}-checked ${r}`]:{insetInlineStart:`calc(100% - ${Ur(O(z).add(f).equal())})`},[`&:not(${l}-disabled):active`]:{[`${r}::before`]:{insetInlineEnd:i.switchHandleActiveInset,insetInlineStart:0},[`&${l}-checked ${r}::before`]:{insetInlineEnd:0,insetInlineStart:i.switchHandleActiveInset}}}}},Rj=i=>{const{componentCls:l,trackHeight:f,trackPadding:_,innerMinMargin:b,innerMaxMargin:z,handleSize:O,calc:r}=i,H=`${l}-inner`,Z=Ur(r(O).add(r(_).mul(2)).equal()),K=Ur(r(z).mul(2).equal());return{[l]:{[H]:{display:"block",overflow:"hidden",borderRadius:100,height:"100%",paddingInlineStart:z,paddingInlineEnd:b,transition:`padding-inline-start ${i.switchDuration} ease-in-out, padding-inline-end ${i.switchDuration} ease-in-out`,[`${H}-checked, ${H}-unchecked`]:{display:"block",color:i.colorTextLightSolid,fontSize:i.fontSizeSM,transition:`margin-inline-start ${i.switchDuration} ease-in-out, margin-inline-end ${i.switchDuration} ease-in-out`,pointerEvents:"none",minHeight:f},[`${H}-checked`]:{marginInlineStart:`calc(-100% + ${Z} - ${K})`,marginInlineEnd:`calc(100% - ${Z} + ${K})`},[`${H}-unchecked`]:{marginTop:r(f).mul(-1).equal(),marginInlineStart:0,marginInlineEnd:0}},[`&${l}-checked ${H}`]:{paddingInlineStart:b,paddingInlineEnd:z,[`${H}-checked`]:{marginInlineStart:0,marginInlineEnd:0},[`${H}-unchecked`]:{marginInlineStart:`calc(100% - ${Z} + ${K})`,marginInlineEnd:`calc(-100% + ${Z} - ${K})`}},[`&:not(${l}-disabled):active`]:{[`&:not(${l}-checked) ${H}`]:{[`${H}-unchecked`]:{marginInlineStart:r(_).mul(2).equal(),marginInlineEnd:r(_).mul(-1).mul(2).equal()}},[`&${l}-checked ${H}`]:{[`${H}-checked`]:{marginInlineStart:r(_).mul(-1).mul(2).equal(),marginInlineEnd:r(_).mul(2).equal()}}}}}},kj=i=>{const{componentCls:l,trackHeight:f,trackMinWidth:_}=i;return{[l]:Object.assign(Object.assign(Object.assign(Object.assign({},Ad(i)),{position:"relative",display:"inline-block",boxSizing:"border-box",minWidth:_,height:f,lineHeight:Ur(f),verticalAlign:"middle",background:i.colorTextQuaternary,border:"0",borderRadius:100,cursor:"pointer",transition:`all ${i.motionDurationMid}`,userSelect:"none",[`&:hover:not(${l}-disabled)`]:{background:i.colorTextTertiary}}),FI(i)),{[`&${l}-checked`]:{background:i.switchColor,[`&:hover:not(${l}-disabled)`]:{background:i.colorPrimaryHover}},[`&${l}-loading, &${l}-disabled`]:{cursor:"not-allowed",opacity:i.switchDisabledOpacity,"*":{boxShadow:"none",cursor:"not-allowed"}},[`&${l}-rtl`]:{direction:"rtl"}})}},zj=i=>{const{fontSize:l,lineHeight:f,controlHeight:_,colorWhite:b}=i,z=l*f,O=_/2,r=2,H=z-r*2,Z=O-r*2;return{trackHeight:z,trackHeightSM:O,trackMinWidth:H*2+r*4,trackMinWidthSM:Z*2+r*2,trackPadding:r,handleBg:b,handleSize:H,handleSizeSM:Z,handleShadow:`0 2px 4px 0 ${new ks("#00230b").setA(.2).toRgbString()}`,innerMinMargin:H/2,innerMaxMargin:H+r+r*2,innerMinMarginSM:Z/2,innerMaxMarginSM:Z+r+r*2}},Lj=Ef("Switch",i=>{const l=Ml(i,{switchDuration:i.motionDurationMid,switchColor:i.colorPrimary,switchDisabledOpacity:i.opacityLoading,switchLoadingIconSize:i.calc(i.fontSizeIcon).mul(.75).equal(),switchLoadingIconColor:`rgba(0, 0, 0, ${i.opacityLoading})`,switchHandleActiveInset:"-30%"});return[kj(l),Rj(l),Pj(l),Ij(l),Aj(l)]},zj);var Oj=function(i,l){var f={};for(var _ in i)Object.prototype.hasOwnProperty.call(i,_)&&l.indexOf(_)<0&&(f[_]=i[_]);if(i!=null&&typeof Object.getOwnPropertySymbols=="function")for(var b=0,_=Object.getOwnPropertySymbols(i);b<_.length;b++)l.indexOf(_[b])<0&&Object.prototype.propertyIsEnumerable.call(i,_[b])&&(f[_[b]]=i[_[b]]);return f};const Dj=se.forwardRef((i,l)=>{const{prefixCls:f,size:_,disabled:b,loading:z,className:O,rootClassName:r,style:H,checked:Z,value:K,defaultChecked:te,defaultValue:le,onChange:Te}=i,pe=Oj(i,["prefixCls","size","disabled","loading","className","rootClassName","style","checked","value","defaultChecked","defaultValue","onChange"]),[ge,fe]=wf(!1,{value:Z??K,defaultValue:te??le}),{getPrefixCls:me,direction:_e,switch:Ie}=se.useContext(Xo),Ne=se.useContext(vf),nt=(b??Ne)||z,Le=me("switch",f),Pe=se.createElement("div",{className:`${Le}-handle`},z&&se.createElement(nP,{className:`${Le}-loading-icon`})),[rt,at,Qe]=Lj(Le),lt=bp(_),Ct=sr(Ie==null?void 0:Ie.className,{[`${Le}-small`]:lt==="small",[`${Le}-loading`]:z,[`${Le}-rtl`]:_e==="rtl"},O,r,at,Qe),Rt=Object.assign(Object.assign({},Ie==null?void 0:Ie.style),H),Nt=function(){fe(arguments.length<=0?void 0:arguments[0]),Te==null||Te.apply(void 0,arguments)};return rt(se.createElement(VS,{component:"Switch"},se.createElement(JP,Object.assign({},pe,{checked:ge,onChange:Nt,prefixCls:Le,className:Ct,style:Rt,disabled:nt,ref:l,loadingIcon:Pe}))))}),QP=Dj;QP.__ANT_SWITCH=!0;const jx=jA(i=>({mapRef:void 0,setMapRef:l=>i({mapRef:l}),mapCenter:[13.3844,52.4971],setMapCenter:l=>i({mapCenter:l}),mapZoom:10,setMapZoom:l=>i({mapZoom:l}),mapStyle:"mapbox://styles/levladik/ckwas7w420a0h15s8xanbvf8j",setMapStyle:l=>i({mapStyle:l})})),Fj=()=>{const{mapRef:i}=jx(),{posterSize:l,setPosterSize:f}=oy(),_=()=>{requestAnimationFrame(()=>{i&&i.resize()})};return fi.jsxs(fi.Fragment,{children:[fi.jsx(QS,{orientation:"left",children:"Size"}),fi.jsx("div",{className:"m-auto",children:fi.jsxs(cp.Group,{className:"text-nowrap",buttonStyle:"solid",size:"large",defaultValue:"30*40",value:l,onChange:b=>f(b.target.value,_),children:[fi.jsxs("div",{className:"mb-2",children:[fi.jsx(cp.Button,{value:"21*30",children:"21x30"}),fi.jsx(cp.Button,{value:"30*40",children:"30x40"})]}),fi.jsxs("div",{children:[fi.jsx(cp.Button,{value:"40*50",children:"40x50"}),fi.jsx(cp.Button,{value:"50*70",children:"50x70"})]})]})})]})};var Pv={exports:{}},Bj=Pv.exports,aA;function Nj(){return aA||(aA=1,function(i,l){(function(f,_){i.exports=_()})(Bj,function(){var f,_,b;function z(r,H){if(!f)f=H;else if(!_)_=H;else{var Z="self.onerror = function() { console.error('An error occurred while parsing the WebWorker bundle. This is most likely due to improper transpilation by Babel; please see https://docs.mapbox.com/mapbox-gl-js/guides/install/#transpiling'); }; var sharedChunk = {}; ("+f+")(sharedChunk); ("+_+")(sharedChunk); self.onerror = null;",K={};f(K),b=H(K),typeof window<"u"&&window&&window.URL&&window.URL.createObjectURL&&(b.workerUrl=window.URL.createObjectURL(new Blob([Z],{type:"text/javascript"})))}}z(["exports"],function(r){function H(s){return s&&s.__esModule&&Object.prototype.hasOwnProperty.call(s,"default")?s.default:s}var Z,K={},te={};function le(){if(Z)return te;Z=1,Object.defineProperty(te,"__esModule",{value:!0}),te.setMatrixArrayType=function(d){te.ARRAY_TYPE=e=d},te.toRadian=function(d){return d*a},te.equals=function(d,c){return Math.abs(d-c)<=s*Math.max(1,Math.abs(d),Math.abs(c))},te.RANDOM=te.ARRAY_TYPE=te.EPSILON=void 0;var s=1e-6;te.EPSILON=s;var e=typeof Float32Array<"u"?Float32Array:Array;te.ARRAY_TYPE=e;var n=Math.random;te.RANDOM=n;var a=Math.PI/180;return Math.hypot||(Math.hypot=function(){for(var d=0,c=arguments.length;c--;)d+=arguments[c]*arguments[c];return Math.sqrt(d)}),te}var Te,pe={};function ge(){if(Te)return pe;function s(c){return s=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(p){return typeof p}:function(p){return p&&typeof Symbol=="function"&&p.constructor===Symbol&&p!==Symbol.prototype?"symbol":typeof p},s(c)}Te=1,Object.defineProperty(pe,"__esModule",{value:!0}),pe.create=function(){var c=new e.ARRAY_TYPE(4);return e.ARRAY_TYPE!=Float32Array&&(c[1]=0,c[2]=0),c[0]=1,c[3]=1,c},pe.clone=function(c){var p=new e.ARRAY_TYPE(4);return p[0]=c[0],p[1]=c[1],p[2]=c[2],p[3]=c[3],p},pe.copy=function(c,p){return c[0]=p[0],c[1]=p[1],c[2]=p[2],c[3]=p[3],c},pe.identity=function(c){return c[0]=1,c[1]=0,c[2]=0,c[3]=1,c},pe.fromValues=function(c,p,w,T){var P=new e.ARRAY_TYPE(4);return P[0]=c,P[1]=p,P[2]=w,P[3]=T,P},pe.set=function(c,p,w,T,P){return c[0]=p,c[1]=w,c[2]=T,c[3]=P,c},pe.transpose=function(c,p){if(c===p){var w=p[1];c[1]=p[2],c[2]=w}else c[0]=p[0],c[1]=p[2],c[2]=p[1],c[3]=p[3];return c},pe.invert=function(c,p){var w=p[0],T=p[1],P=p[2],x=p[3],C=w*x-P*T;return C?(c[0]=x*(C=1/C),c[1]=-T*C,c[2]=-P*C,c[3]=w*C,c):null},pe.adjoint=function(c,p){var w=p[0];return c[0]=p[3],c[1]=-p[1],c[2]=-p[2],c[3]=w,c},pe.determinant=function(c){return c[0]*c[3]-c[2]*c[1]},pe.multiply=a,pe.rotate=function(c,p,w){var T=p[0],P=p[1],x=p[2],C=p[3],A=Math.sin(w),E=Math.cos(w);return c[0]=T*E+x*A,c[1]=P*E+C*A,c[2]=T*-A+x*E,c[3]=P*-A+C*E,c},pe.scale=function(c,p,w){var T=p[1],P=p[2],x=p[3],C=w[0],A=w[1];return c[0]=p[0]*C,c[1]=T*C,c[2]=P*A,c[3]=x*A,c},pe.fromRotation=function(c,p){var w=Math.sin(p),T=Math.cos(p);return c[0]=T,c[1]=w,c[2]=-w,c[3]=T,c},pe.fromScaling=function(c,p){return c[0]=p[0],c[1]=0,c[2]=0,c[3]=p[1],c},pe.str=function(c){return"mat2("+c[0]+", "+c[1]+", "+c[2]+", "+c[3]+")"},pe.frob=function(c){return Math.hypot(c[0],c[1],c[2],c[3])},pe.LDU=function(c,p,w,T){return c[2]=T[2]/T[0],w[0]=T[0],w[1]=T[1],w[3]=T[3]-c[2]*w[1],[c,p,w]},pe.add=function(c,p,w){return c[0]=p[0]+w[0],c[1]=p[1]+w[1],c[2]=p[2]+w[2],c[3]=p[3]+w[3],c},pe.subtract=d,pe.exactEquals=function(c,p){return c[0]===p[0]&&c[1]===p[1]&&c[2]===p[2]&&c[3]===p[3]},pe.equals=function(c,p){var w=c[0],T=c[1],P=c[2],x=c[3],C=p[0],A=p[1],E=p[2],M=p[3];return Math.abs(w-C)<=e.EPSILON*Math.max(1,Math.abs(w),Math.abs(C))&&Math.abs(T-A)<=e.EPSILON*Math.max(1,Math.abs(T),Math.abs(A))&&Math.abs(P-E)<=e.EPSILON*Math.max(1,Math.abs(P),Math.abs(E))&&Math.abs(x-M)<=e.EPSILON*Math.max(1,Math.abs(x),Math.abs(M))},pe.multiplyScalar=function(c,p,w){return c[0]=p[0]*w,c[1]=p[1]*w,c[2]=p[2]*w,c[3]=p[3]*w,c},pe.multiplyScalarAndAdd=function(c,p,w,T){return c[0]=p[0]+w[0]*T,c[1]=p[1]+w[1]*T,c[2]=p[2]+w[2]*T,c[3]=p[3]+w[3]*T,c},pe.sub=pe.mul=void 0;var e=function(c,p){if(c&&c.__esModule)return c;if(c===null||s(c)!=="object"&&typeof c!="function")return{default:c};var w=n(void 0);if(w&&w.has(c))return w.get(c);var T={},P=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var x in c)if(x!=="default"&&Object.prototype.hasOwnProperty.call(c,x)){var C=P?Object.getOwnPropertyDescriptor(c,x):null;C&&(C.get||C.set)?Object.defineProperty(T,x,C):T[x]=c[x]}return T.default=c,w&&w.set(c,T),T}(le());function n(c){if(typeof WeakMap!="function")return null;var p=new WeakMap,w=new WeakMap;return(n=function(T){return T?w:p})(c)}function a(c,p,w){var T=p[0],P=p[1],x=p[2],C=p[3],A=w[0],E=w[1],M=w[2],k=w[3];return c[0]=T*A+x*E,c[1]=P*A+C*E,c[2]=T*M+x*k,c[3]=P*M+C*k,c}function d(c,p,w){return c[0]=p[0]-w[0],c[1]=p[1]-w[1],c[2]=p[2]-w[2],c[3]=p[3]-w[3],c}return pe.mul=a,pe.sub=d,pe}var fe,me={};function _e(){if(fe)return me;function s(c){return s=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(p){return typeof p}:function(p){return p&&typeof Symbol=="function"&&p.constructor===Symbol&&p!==Symbol.prototype?"symbol":typeof p},s(c)}fe=1,Object.defineProperty(me,"__esModule",{value:!0}),me.create=function(){var c=new e.ARRAY_TYPE(6);return e.ARRAY_TYPE!=Float32Array&&(c[1]=0,c[2]=0,c[4]=0,c[5]=0),c[0]=1,c[3]=1,c},me.clone=function(c){var p=new e.ARRAY_TYPE(6);return p[0]=c[0],p[1]=c[1],p[2]=c[2],p[3]=c[3],p[4]=c[4],p[5]=c[5],p},me.copy=function(c,p){return c[0]=p[0],c[1]=p[1],c[2]=p[2],c[3]=p[3],c[4]=p[4],c[5]=p[5],c},me.identity=function(c){return c[0]=1,c[1]=0,c[2]=0,c[3]=1,c[4]=0,c[5]=0,c},me.fromValues=function(c,p,w,T,P,x){var C=new e.ARRAY_TYPE(6);return C[0]=c,C[1]=p,C[2]=w,C[3]=T,C[4]=P,C[5]=x,C},me.set=function(c,p,w,T,P,x,C){return c[0]=p,c[1]=w,c[2]=T,c[3]=P,c[4]=x,c[5]=C,c},me.invert=function(c,p){var w=p[0],T=p[1],P=p[2],x=p[3],C=p[4],A=p[5],E=w*x-T*P;return E?(c[0]=x*(E=1/E),c[1]=-T*E,c[2]=-P*E,c[3]=w*E,c[4]=(P*A-x*C)*E,c[5]=(T*C-w*A)*E,c):null},me.determinant=function(c){return c[0]*c[3]-c[1]*c[2]},me.multiply=a,me.rotate=function(c,p,w){var T=p[0],P=p[1],x=p[2],C=p[3],A=p[4],E=p[5],M=Math.sin(w),k=Math.cos(w);return c[0]=T*k+x*M,c[1]=P*k+C*M,c[2]=T*-M+x*k,c[3]=P*-M+C*k,c[4]=A,c[5]=E,c},me.scale=function(c,p,w){var T=p[1],P=p[2],x=p[3],C=p[4],A=p[5],E=w[0],M=w[1];return c[0]=p[0]*E,c[1]=T*E,c[2]=P*M,c[3]=x*M,c[4]=C,c[5]=A,c},me.translate=function(c,p,w){var T=p[0],P=p[1],x=p[2],C=p[3],A=p[4],E=p[5],M=w[0],k=w[1];return c[0]=T,c[1]=P,c[2]=x,c[3]=C,c[4]=T*M+x*k+A,c[5]=P*M+C*k+E,c},me.fromRotation=function(c,p){var w=Math.sin(p),T=Math.cos(p);return c[0]=T,c[1]=w,c[2]=-w,c[3]=T,c[4]=0,c[5]=0,c},me.fromScaling=function(c,p){return c[0]=p[0],c[1]=0,c[2]=0,c[3]=p[1],c[4]=0,c[5]=0,c},me.fromTranslation=function(c,p){return c[0]=1,c[1]=0,c[2]=0,c[3]=1,c[4]=p[0],c[5]=p[1],c},me.str=function(c){return"mat2d("+c[0]+", "+c[1]+", "+c[2]+", "+c[3]+", "+c[4]+", "+c[5]+")"},me.frob=function(c){return Math.hypot(c[0],c[1],c[2],c[3],c[4],c[5],1)},me.add=function(c,p,w){return c[0]=p[0]+w[0],c[1]=p[1]+w[1],c[2]=p[2]+w[2],c[3]=p[3]+w[3],c[4]=p[4]+w[4],c[5]=p[5]+w[5],c},me.subtract=d,me.multiplyScalar=function(c,p,w){return c[0]=p[0]*w,c[1]=p[1]*w,c[2]=p[2]*w,c[3]=p[3]*w,c[4]=p[4]*w,c[5]=p[5]*w,c},me.multiplyScalarAndAdd=function(c,p,w,T){return c[0]=p[0]+w[0]*T,c[1]=p[1]+w[1]*T,c[2]=p[2]+w[2]*T,c[3]=p[3]+w[3]*T,c[4]=p[4]+w[4]*T,c[5]=p[5]+w[5]*T,c},me.exactEquals=function(c,p){return c[0]===p[0]&&c[1]===p[1]&&c[2]===p[2]&&c[3]===p[3]&&c[4]===p[4]&&c[5]===p[5]},me.equals=function(c,p){var w=c[0],T=c[1],P=c[2],x=c[3],C=c[4],A=c[5],E=p[0],M=p[1],k=p[2],N=p[3],j=p[4],q=p[5];return Math.abs(w-E)<=e.EPSILON*Math.max(1,Math.abs(w),Math.abs(E))&&Math.abs(T-M)<=e.EPSILON*Math.max(1,Math.abs(T),Math.abs(M))&&Math.abs(P-k)<=e.EPSILON*Math.max(1,Math.abs(P),Math.abs(k))&&Math.abs(x-N)<=e.EPSILON*Math.max(1,Math.abs(x),Math.abs(N))&&Math.abs(C-j)<=e.EPSILON*Math.max(1,Math.abs(C),Math.abs(j))&&Math.abs(A-q)<=e.EPSILON*Math.max(1,Math.abs(A),Math.abs(q))},me.sub=me.mul=void 0;var e=function(c,p){if(c&&c.__esModule)return c;if(c===null||s(c)!=="object"&&typeof c!="function")return{default:c};var w=n(void 0);if(w&&w.has(c))return w.get(c);var T={},P=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var x in c)if(x!=="default"&&Object.prototype.hasOwnProperty.call(c,x)){var C=P?Object.getOwnPropertyDescriptor(c,x):null;C&&(C.get||C.set)?Object.defineProperty(T,x,C):T[x]=c[x]}return T.default=c,w&&w.set(c,T),T}(le());function n(c){if(typeof WeakMap!="function")return null;var p=new WeakMap,w=new WeakMap;return(n=function(T){return T?w:p})(c)}function a(c,p,w){var T=p[0],P=p[1],x=p[2],C=p[3],A=p[4],E=p[5],M=w[0],k=w[1],N=w[2],j=w[3],q=w[4],X=w[5];return c[0]=T*M+x*k,c[1]=P*M+C*k,c[2]=T*N+x*j,c[3]=P*N+C*j,c[4]=T*q+x*X+A,c[5]=P*q+C*X+E,c}function d(c,p,w){return c[0]=p[0]-w[0],c[1]=p[1]-w[1],c[2]=p[2]-w[2],c[3]=p[3]-w[3],c[4]=p[4]-w[4],c[5]=p[5]-w[5],c}return me.mul=a,me.sub=d,me}var Ie,Ne={};function nt(){if(Ie)return Ne;function s(c){return s=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(p){return typeof p}:function(p){return p&&typeof Symbol=="function"&&p.constructor===Symbol&&p!==Symbol.prototype?"symbol":typeof p},s(c)}Ie=1,Object.defineProperty(Ne,"__esModule",{value:!0}),Ne.create=function(){var c=new e.ARRAY_TYPE(9);return e.ARRAY_TYPE!=Float32Array&&(c[1]=0,c[2]=0,c[3]=0,c[5]=0,c[6]=0,c[7]=0),c[0]=1,c[4]=1,c[8]=1,c},Ne.fromMat4=function(c,p){return c[0]=p[0],c[1]=p[1],c[2]=p[2],c[3]=p[4],c[4]=p[5],c[5]=p[6],c[6]=p[8],c[7]=p[9],c[8]=p[10],c},Ne.clone=function(c){var p=new e.ARRAY_TYPE(9);return p[0]=c[0],p[1]=c[1],p[2]=c[2],p[3]=c[3],p[4]=c[4],p[5]=c[5],p[6]=c[6],p[7]=c[7],p[8]=c[8],p},Ne.copy=function(c,p){return c[0]=p[0],c[1]=p[1],c[2]=p[2],c[3]=p[3],c[4]=p[4],c[5]=p[5],c[6]=p[6],c[7]=p[7],c[8]=p[8],c},Ne.fromValues=function(c,p,w,T,P,x,C,A,E){var M=new e.ARRAY_TYPE(9);return M[0]=c,M[1]=p,M[2]=w,M[3]=T,M[4]=P,M[5]=x,M[6]=C,M[7]=A,M[8]=E,M},Ne.set=function(c,p,w,T,P,x,C,A,E,M){return c[0]=p,c[1]=w,c[2]=T,c[3]=P,c[4]=x,c[5]=C,c[6]=A,c[7]=E,c[8]=M,c},Ne.identity=function(c){return c[0]=1,c[1]=0,c[2]=0,c[3]=0,c[4]=1,c[5]=0,c[6]=0,c[7]=0,c[8]=1,c},Ne.transpose=function(c,p){if(c===p){var w=p[1],T=p[2],P=p[5];c[1]=p[3],c[2]=p[6],c[3]=w,c[5]=p[7],c[6]=T,c[7]=P}else c[0]=p[0],c[1]=p[3],c[2]=p[6],c[3]=p[1],c[4]=p[4],c[5]=p[7],c[6]=p[2],c[7]=p[5],c[8]=p[8];return c},Ne.invert=function(c,p){var w=p[0],T=p[1],P=p[2],x=p[3],C=p[4],A=p[5],E=p[6],M=p[7],k=p[8],N=k*C-A*M,j=-k*x+A*E,q=M*x-C*E,X=w*N+T*j+P*q;return X?(c[0]=N*(X=1/X),c[1]=(-k*T+P*M)*X,c[2]=(A*T-P*C)*X,c[3]=j*X,c[4]=(k*w-P*E)*X,c[5]=(-A*w+P*x)*X,c[6]=q*X,c[7]=(-M*w+T*E)*X,c[8]=(C*w-T*x)*X,c):null},Ne.adjoint=function(c,p){var w=p[0],T=p[1],P=p[2],x=p[3],C=p[4],A=p[5],E=p[6],M=p[7],k=p[8];return c[0]=C*k-A*M,c[1]=P*M-T*k,c[2]=T*A-P*C,c[3]=A*E-x*k,c[4]=w*k-P*E,c[5]=P*x-w*A,c[6]=x*M-C*E,c[7]=T*E-w*M,c[8]=w*C-T*x,c},Ne.determinant=function(c){var p=c[3],w=c[4],T=c[5],P=c[6],x=c[7],C=c[8];return c[0]*(C*w-T*x)+c[1]*(-C*p+T*P)+c[2]*(x*p-w*P)},Ne.multiply=a,Ne.translate=function(c,p,w){var T=p[0],P=p[1],x=p[2],C=p[3],A=p[4],E=p[5],M=p[6],k=p[7],N=p[8],j=w[0],q=w[1];return c[0]=T,c[1]=P,c[2]=x,c[3]=C,c[4]=A,c[5]=E,c[6]=j*T+q*C+M,c[7]=j*P+q*A+k,c[8]=j*x+q*E+N,c},Ne.rotate=function(c,p,w){var T=p[0],P=p[1],x=p[2],C=p[3],A=p[4],E=p[5],M=p[6],k=p[7],N=p[8],j=Math.sin(w),q=Math.cos(w);return c[0]=q*T+j*C,c[1]=q*P+j*A,c[2]=q*x+j*E,c[3]=q*C-j*T,c[4]=q*A-j*P,c[5]=q*E-j*x,c[6]=M,c[7]=k,c[8]=N,c},Ne.scale=function(c,p,w){var T=w[0],P=w[1];return c[0]=T*p[0],c[1]=T*p[1],c[2]=T*p[2],c[3]=P*p[3],c[4]=P*p[4],c[5]=P*p[5],c[6]=p[6],c[7]=p[7],c[8]=p[8],c},Ne.fromTranslation=function(c,p){return c[0]=1,c[1]=0,c[2]=0,c[3]=0,c[4]=1,c[5]=0,c[6]=p[0],c[7]=p[1],c[8]=1,c},Ne.fromRotation=function(c,p){var w=Math.sin(p),T=Math.cos(p);return c[0]=T,c[1]=w,c[2]=0,c[3]=-w,c[4]=T,c[5]=0,c[6]=0,c[7]=0,c[8]=1,c},Ne.fromScaling=function(c,p){return c[0]=p[0],c[1]=0,c[2]=0,c[3]=0,c[4]=p[1],c[5]=0,c[6]=0,c[7]=0,c[8]=1,c},Ne.fromMat2d=function(c,p){return c[0]=p[0],c[1]=p[1],c[2]=0,c[3]=p[2],c[4]=p[3],c[5]=0,c[6]=p[4],c[7]=p[5],c[8]=1,c},Ne.fromQuat=function(c,p){var w=p[0],T=p[1],P=p[2],x=p[3],C=w+w,A=T+T,E=P+P,M=w*C,k=T*C,N=T*A,j=P*C,q=P*A,X=P*E,W=x*C,J=x*A,ne=x*E;return c[0]=1-N-X,c[3]=k-ne,c[6]=j+J,c[1]=k+ne,c[4]=1-M-X,c[7]=q-W,c[2]=j-J,c[5]=q+W,c[8]=1-M-N,c},Ne.normalFromMat4=function(c,p){var w=p[0],T=p[1],P=p[2],x=p[3],C=p[4],A=p[5],E=p[6],M=p[7],k=p[8],N=p[9],j=p[10],q=p[11],X=p[12],W=p[13],J=p[14],ne=p[15],he=w*A-T*C,we=w*E-P*C,be=w*M-x*C,ve=T*E-P*A,Be=T*M-x*A,Me=P*M-x*E,Ue=k*W-N*X,Ye=k*J-j*X,Xe=k*ne-q*X,Je=N*J-j*W,st=N*ne-q*W,pt=j*ne-q*J,ot=he*pt-we*st+be*Je+ve*Xe-Be*Ye+Me*Ue;return ot?(c[0]=(A*pt-E*st+M*Je)*(ot=1/ot),c[1]=(E*Xe-C*pt-M*Ye)*ot,c[2]=(C*st-A*Xe+M*Ue)*ot,c[3]=(P*st-T*pt-x*Je)*ot,c[4]=(w*pt-P*Xe+x*Ye)*ot,c[5]=(T*Xe-w*st-x*Ue)*ot,c[6]=(W*Me-J*Be+ne*ve)*ot,c[7]=(J*be-X*Me-ne*we)*ot,c[8]=(X*Be-W*be+ne*he)*ot,c):null},Ne.projection=function(c,p,w){return c[0]=2/p,c[1]=0,c[2]=0,c[3]=0,c[4]=-2/w,c[5]=0,c[6]=-1,c[7]=1,c[8]=1,c},Ne.str=function(c){return"mat3("+c[0]+", "+c[1]+", "+c[2]+", "+c[3]+", "+c[4]+", "+c[5]+", "+c[6]+", "+c[7]+", "+c[8]+")"},Ne.frob=function(c){return Math.hypot(c[0],c[1],c[2],c[3],c[4],c[5],c[6],c[7],c[8])},Ne.add=function(c,p,w){return c[0]=p[0]+w[0],c[1]=p[1]+w[1],c[2]=p[2]+w[2],c[3]=p[3]+w[3],c[4]=p[4]+w[4],c[5]=p[5]+w[5],c[6]=p[6]+w[6],c[7]=p[7]+w[7],c[8]=p[8]+w[8],c},Ne.subtract=d,Ne.multiplyScalar=function(c,p,w){return c[0]=p[0]*w,c[1]=p[1]*w,c[2]=p[2]*w,c[3]=p[3]*w,c[4]=p[4]*w,c[5]=p[5]*w,c[6]=p[6]*w,c[7]=p[7]*w,c[8]=p[8]*w,c},Ne.multiplyScalarAndAdd=function(c,p,w,T){return c[0]=p[0]+w[0]*T,c[1]=p[1]+w[1]*T,c[2]=p[2]+w[2]*T,c[3]=p[3]+w[3]*T,c[4]=p[4]+w[4]*T,c[5]=p[5]+w[5]*T,c[6]=p[6]+w[6]*T,c[7]=p[7]+w[7]*T,c[8]=p[8]+w[8]*T,c},Ne.exactEquals=function(c,p){return c[0]===p[0]&&c[1]===p[1]&&c[2]===p[2]&&c[3]===p[3]&&c[4]===p[4]&&c[5]===p[5]&&c[6]===p[6]&&c[7]===p[7]&&c[8]===p[8]},Ne.equals=function(c,p){var w=c[0],T=c[1],P=c[2],x=c[3],C=c[4],A=c[5],E=c[6],M=c[7],k=c[8],N=p[0],j=p[1],q=p[2],X=p[3],W=p[4],J=p[5],ne=p[6],he=p[7],we=p[8];return Math.abs(w-N)<=e.EPSILON*Math.max(1,Math.abs(w),Math.abs(N))&&Math.abs(T-j)<=e.EPSILON*Math.max(1,Math.abs(T),Math.abs(j))&&Math.abs(P-q)<=e.EPSILON*Math.max(1,Math.abs(P),Math.abs(q))&&Math.abs(x-X)<=e.EPSILON*Math.max(1,Math.abs(x),Math.abs(X))&&Math.abs(C-W)<=e.EPSILON*Math.max(1,Math.abs(C),Math.abs(W))&&Math.abs(A-J)<=e.EPSILON*Math.max(1,Math.abs(A),Math.abs(J))&&Math.abs(E-ne)<=e.EPSILON*Math.max(1,Math.abs(E),Math.abs(ne))&&Math.abs(M-he)<=e.EPSILON*Math.max(1,Math.abs(M),Math.abs(he))&&Math.abs(k-we)<=e.EPSILON*Math.max(1,Math.abs(k),Math.abs(we))},Ne.sub=Ne.mul=void 0;var e=function(c,p){if(c&&c.__esModule)return c;if(c===null||s(c)!=="object"&&typeof c!="function")return{default:c};var w=n(void 0);if(w&&w.has(c))return w.get(c);var T={},P=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var x in c)if(x!=="default"&&Object.prototype.hasOwnProperty.call(c,x)){var C=P?Object.getOwnPropertyDescriptor(c,x):null;C&&(C.get||C.set)?Object.defineProperty(T,x,C):T[x]=c[x]}return T.default=c,w&&w.set(c,T),T}(le());function n(c){if(typeof WeakMap!="function")return null;var p=new WeakMap,w=new WeakMap;return(n=function(T){return T?w:p})(c)}function a(c,p,w){var T=p[0],P=p[1],x=p[2],C=p[3],A=p[4],E=p[5],M=p[6],k=p[7],N=p[8],j=w[0],q=w[1],X=w[2],W=w[3],J=w[4],ne=w[5],he=w[6],we=w[7],be=w[8];return c[0]=j*T+q*C+X*M,c[1]=j*P+q*A+X*k,c[2]=j*x+q*E+X*N,c[3]=W*T+J*C+ne*M,c[4]=W*P+J*A+ne*k,c[5]=W*x+J*E+ne*N,c[6]=he*T+we*C+be*M,c[7]=he*P+we*A+be*k,c[8]=he*x+we*E+be*N,c}function d(c,p,w){return c[0]=p[0]-w[0],c[1]=p[1]-w[1],c[2]=p[2]-w[2],c[3]=p[3]-w[3],c[4]=p[4]-w[4],c[5]=p[5]-w[5],c[6]=p[6]-w[6],c[7]=p[7]-w[7],c[8]=p[8]-w[8],c}return Ne.mul=a,Ne.sub=d,Ne}var Le,Pe={};function rt(){if(Le)return Pe;function s(x){return s=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(C){return typeof C}:function(C){return C&&typeof Symbol=="function"&&C.constructor===Symbol&&C!==Symbol.prototype?"symbol":typeof C},s(x)}Le=1,Object.defineProperty(Pe,"__esModule",{value:!0}),Pe.create=function(){var x=new e.ARRAY_TYPE(16);return e.ARRAY_TYPE!=Float32Array&&(x[1]=0,x[2]=0,x[3]=0,x[4]=0,x[6]=0,x[7]=0,x[8]=0,x[9]=0,x[11]=0,x[12]=0,x[13]=0,x[14]=0),x[0]=1,x[5]=1,x[10]=1,x[15]=1,x},Pe.clone=function(x){var C=new e.ARRAY_TYPE(16);return C[0]=x[0],C[1]=x[1],C[2]=x[2],C[3]=x[3],C[4]=x[4],C[5]=x[5],C[6]=x[6],C[7]=x[7],C[8]=x[8],C[9]=x[9],C[10]=x[10],C[11]=x[11],C[12]=x[12],C[13]=x[13],C[14]=x[14],C[15]=x[15],C},Pe.copy=function(x,C){return x[0]=C[0],x[1]=C[1],x[2]=C[2],x[3]=C[3],x[4]=C[4],x[5]=C[5],x[6]=C[6],x[7]=C[7],x[8]=C[8],x[9]=C[9],x[10]=C[10],x[11]=C[11],x[12]=C[12],x[13]=C[13],x[14]=C[14],x[15]=C[15],x},Pe.fromValues=function(x,C,A,E,M,k,N,j,q,X,W,J,ne,he,we,be){var ve=new e.ARRAY_TYPE(16);return ve[0]=x,ve[1]=C,ve[2]=A,ve[3]=E,ve[4]=M,ve[5]=k,ve[6]=N,ve[7]=j,ve[8]=q,ve[9]=X,ve[10]=W,ve[11]=J,ve[12]=ne,ve[13]=he,ve[14]=we,ve[15]=be,ve},Pe.set=function(x,C,A,E,M,k,N,j,q,X,W,J,ne,he,we,be,ve){return x[0]=C,x[1]=A,x[2]=E,x[3]=M,x[4]=k,x[5]=N,x[6]=j,x[7]=q,x[8]=X,x[9]=W,x[10]=J,x[11]=ne,x[12]=he,x[13]=we,x[14]=be,x[15]=ve,x},Pe.identity=a,Pe.transpose=function(x,C){if(x===C){var A=C[1],E=C[2],M=C[3],k=C[6],N=C[7],j=C[11];x[1]=C[4],x[2]=C[8],x[3]=C[12],x[4]=A,x[6]=C[9],x[7]=C[13],x[8]=E,x[9]=k,x[11]=C[14],x[12]=M,x[13]=N,x[14]=j}else x[0]=C[0],x[1]=C[4],x[2]=C[8],x[3]=C[12],x[4]=C[1],x[5]=C[5],x[6]=C[9],x[7]=C[13],x[8]=C[2],x[9]=C[6],x[10]=C[10],x[11]=C[14],x[12]=C[3],x[13]=C[7],x[14]=C[11],x[15]=C[15];return x},Pe.invert=function(x,C){var A=C[0],E=C[1],M=C[2],k=C[3],N=C[4],j=C[5],q=C[6],X=C[7],W=C[8],J=C[9],ne=C[10],he=C[11],we=C[12],be=C[13],ve=C[14],Be=C[15],Me=A*j-E*N,Ue=A*q-M*N,Ye=A*X-k*N,Xe=E*q-M*j,Je=E*X-k*j,st=M*X-k*q,pt=W*be-J*we,ot=W*ve-ne*we,It=W*Be-he*we,tn=J*ve-ne*be,Lt=J*Be-he*be,un=ne*Be-he*ve,cn=Me*un-Ue*Lt+Ye*tn+Xe*It-Je*ot+st*pt;return cn?(x[0]=(j*un-q*Lt+X*tn)*(cn=1/cn),x[1]=(M*Lt-E*un-k*tn)*cn,x[2]=(be*st-ve*Je+Be*Xe)*cn,x[3]=(ne*Je-J*st-he*Xe)*cn,x[4]=(q*It-N*un-X*ot)*cn,x[5]=(A*un-M*It+k*ot)*cn,x[6]=(ve*Ye-we*st-Be*Ue)*cn,x[7]=(W*st-ne*Ye+he*Ue)*cn,x[8]=(N*Lt-j*It+X*pt)*cn,x[9]=(E*It-A*Lt-k*pt)*cn,x[10]=(we*Je-be*Ye+Be*Me)*cn,x[11]=(J*Ye-W*Je-he*Me)*cn,x[12]=(j*ot-N*tn-q*pt)*cn,x[13]=(A*tn-E*ot+M*pt)*cn,x[14]=(be*Ue-we*Xe-ve*Me)*cn,x[15]=(W*Xe-J*Ue+ne*Me)*cn,x):null},Pe.adjoint=function(x,C){var A=C[0],E=C[1],M=C[2],k=C[3],N=C[4],j=C[5],q=C[6],X=C[7],W=C[8],J=C[9],ne=C[10],he=C[11],we=C[12],be=C[13],ve=C[14],Be=C[15];return x[0]=j*(ne*Be-he*ve)-J*(q*Be-X*ve)+be*(q*he-X*ne),x[1]=-(E*(ne*Be-he*ve)-J*(M*Be-k*ve)+be*(M*he-k*ne)),x[2]=E*(q*Be-X*ve)-j*(M*Be-k*ve)+be*(M*X-k*q),x[3]=-(E*(q*he-X*ne)-j*(M*he-k*ne)+J*(M*X-k*q)),x[4]=-(N*(ne*Be-he*ve)-W*(q*Be-X*ve)+we*(q*he-X*ne)),x[5]=A*(ne*Be-he*ve)-W*(M*Be-k*ve)+we*(M*he-k*ne),x[6]=-(A*(q*Be-X*ve)-N*(M*Be-k*ve)+we*(M*X-k*q)),x[7]=A*(q*he-X*ne)-N*(M*he-k*ne)+W*(M*X-k*q),x[8]=N*(J*Be-he*be)-W*(j*Be-X*be)+we*(j*he-X*J),x[9]=-(A*(J*Be-he*be)-W*(E*Be-k*be)+we*(E*he-k*J)),x[10]=A*(j*Be-X*be)-N*(E*Be-k*be)+we*(E*X-k*j),x[11]=-(A*(j*he-X*J)-N*(E*he-k*J)+W*(E*X-k*j)),x[12]=-(N*(J*ve-ne*be)-W*(j*ve-q*be)+we*(j*ne-q*J)),x[13]=A*(J*ve-ne*be)-W*(E*ve-M*be)+we*(E*ne-M*J),x[14]=-(A*(j*ve-q*be)-N*(E*ve-M*be)+we*(E*q-M*j)),x[15]=A*(j*ne-q*J)-N*(E*ne-M*J)+W*(E*q-M*j),x},Pe.determinant=function(x){var C=x[0],A=x[1],E=x[2],M=x[3],k=x[4],N=x[5],j=x[6],q=x[7],X=x[8],W=x[9],J=x[10],ne=x[11],he=x[12],we=x[13],be=x[14],ve=x[15];return(C*N-A*k)*(J*ve-ne*be)-(C*j-E*k)*(W*ve-ne*we)+(C*q-M*k)*(W*be-J*we)+(A*j-E*N)*(X*ve-ne*he)-(A*q-M*N)*(X*be-J*he)+(E*q-M*j)*(X*we-W*he)},Pe.multiply=d,Pe.translate=function(x,C,A){var E,M,k,N,j,q,X,W,J,ne,he,we,be=A[0],ve=A[1],Be=A[2];return C===x?(x[12]=C[0]*be+C[4]*ve+C[8]*Be+C[12],x[13]=C[1]*be+C[5]*ve+C[9]*Be+C[13],x[14]=C[2]*be+C[6]*ve+C[10]*Be+C[14],x[15]=C[3]*be+C[7]*ve+C[11]*Be+C[15]):(M=C[1],k=C[2],N=C[3],j=C[4],q=C[5],X=C[6],W=C[7],J=C[8],ne=C[9],he=C[10],we=C[11],x[0]=E=C[0],x[1]=M,x[2]=k,x[3]=N,x[4]=j,x[5]=q,x[6]=X,x[7]=W,x[8]=J,x[9]=ne,x[10]=he,x[11]=we,x[12]=E*be+j*ve+J*Be+C[12],x[13]=M*be+q*ve+ne*Be+C[13],x[14]=k*be+X*ve+he*Be+C[14],x[15]=N*be+W*ve+we*Be+C[15]),x},Pe.scale=function(x,C,A){var E=A[0],M=A[1],k=A[2];return x[0]=C[0]*E,x[1]=C[1]*E,x[2]=C[2]*E,x[3]=C[3]*E,x[4]=C[4]*M,x[5]=C[5]*M,x[6]=C[6]*M,x[7]=C[7]*M,x[8]=C[8]*k,x[9]=C[9]*k,x[10]=C[10]*k,x[11]=C[11]*k,x[12]=C[12],x[13]=C[13],x[14]=C[14],x[15]=C[15],x},Pe.rotate=function(x,C,A,E){var M,k,N,j,q,X,W,J,ne,he,we,be,ve,Be,Me,Ue,Ye,Xe,Je,st,pt,ot,It,tn,Lt=E[0],un=E[1],cn=E[2],vn=Math.hypot(Lt,un,cn);return vn<e.EPSILON?null:(Lt*=vn=1/vn,un*=vn,cn*=vn,M=Math.sin(A),k=Math.cos(A),q=C[1],X=C[2],W=C[3],ne=C[5],he=C[6],we=C[7],ve=C[9],Be=C[10],Me=C[11],Ue=Lt*Lt*(N=1-k)+k,Je=Lt*un*N-cn*M,st=un*un*N+k,pt=cn*un*N+Lt*M,ot=Lt*cn*N+un*M,It=un*cn*N-Lt*M,tn=cn*cn*N+k,x[0]=(j=C[0])*Ue+(J=C[4])*(Ye=un*Lt*N+cn*M)+(be=C[8])*(Xe=cn*Lt*N-un*M),x[1]=q*Ue+ne*Ye+ve*Xe,x[2]=X*Ue+he*Ye+Be*Xe,x[3]=W*Ue+we*Ye+Me*Xe,x[4]=j*Je+J*st+be*pt,x[5]=q*Je+ne*st+ve*pt,x[6]=X*Je+he*st+Be*pt,x[7]=W*Je+we*st+Me*pt,x[8]=j*ot+J*It+be*tn,x[9]=q*ot+ne*It+ve*tn,x[10]=X*ot+he*It+Be*tn,x[11]=W*ot+we*It+Me*tn,C!==x&&(x[12]=C[12],x[13]=C[13],x[14]=C[14],x[15]=C[15]),x)},Pe.rotateX=function(x,C,A){var E=Math.sin(A),M=Math.cos(A),k=C[4],N=C[5],j=C[6],q=C[7],X=C[8],W=C[9],J=C[10],ne=C[11];return C!==x&&(x[0]=C[0],x[1]=C[1],x[2]=C[2],x[3]=C[3],x[12]=C[12],x[13]=C[13],x[14]=C[14],x[15]=C[15]),x[4]=k*M+X*E,x[5]=N*M+W*E,x[6]=j*M+J*E,x[7]=q*M+ne*E,x[8]=X*M-k*E,x[9]=W*M-N*E,x[10]=J*M-j*E,x[11]=ne*M-q*E,x},Pe.rotateY=function(x,C,A){var E=Math.sin(A),M=Math.cos(A),k=C[0],N=C[1],j=C[2],q=C[3],X=C[8],W=C[9],J=C[10],ne=C[11];return C!==x&&(x[4]=C[4],x[5]=C[5],x[6]=C[6],x[7]=C[7],x[12]=C[12],x[13]=C[13],x[14]=C[14],x[15]=C[15]),x[0]=k*M-X*E,x[1]=N*M-W*E,x[2]=j*M-J*E,x[3]=q*M-ne*E,x[8]=k*E+X*M,x[9]=N*E+W*M,x[10]=j*E+J*M,x[11]=q*E+ne*M,x},Pe.rotateZ=function(x,C,A){var E=Math.sin(A),M=Math.cos(A),k=C[0],N=C[1],j=C[2],q=C[3],X=C[4],W=C[5],J=C[6],ne=C[7];return C!==x&&(x[8]=C[8],x[9]=C[9],x[10]=C[10],x[11]=C[11],x[12]=C[12],x[13]=C[13],x[14]=C[14],x[15]=C[15]),x[0]=k*M+X*E,x[1]=N*M+W*E,x[2]=j*M+J*E,x[3]=q*M+ne*E,x[4]=X*M-k*E,x[5]=W*M-N*E,x[6]=J*M-j*E,x[7]=ne*M-q*E,x},Pe.fromTranslation=function(x,C){return x[0]=1,x[1]=0,x[2]=0,x[3]=0,x[4]=0,x[5]=1,x[6]=0,x[7]=0,x[8]=0,x[9]=0,x[10]=1,x[11]=0,x[12]=C[0],x[13]=C[1],x[14]=C[2],x[15]=1,x},Pe.fromScaling=function(x,C){return x[0]=C[0],x[1]=0,x[2]=0,x[3]=0,x[4]=0,x[5]=C[1],x[6]=0,x[7]=0,x[8]=0,x[9]=0,x[10]=C[2],x[11]=0,x[12]=0,x[13]=0,x[14]=0,x[15]=1,x},Pe.fromRotation=function(x,C,A){var E,M,k,N=A[0],j=A[1],q=A[2],X=Math.hypot(N,j,q);return X<e.EPSILON?null:(N*=X=1/X,j*=X,q*=X,E=Math.sin(C),M=Math.cos(C),x[0]=N*N*(k=1-M)+M,x[1]=j*N*k+q*E,x[2]=q*N*k-j*E,x[3]=0,x[4]=N*j*k-q*E,x[5]=j*j*k+M,x[6]=q*j*k+N*E,x[7]=0,x[8]=N*q*k+j*E,x[9]=j*q*k-N*E,x[10]=q*q*k+M,x[11]=0,x[12]=0,x[13]=0,x[14]=0,x[15]=1,x)},Pe.fromXRotation=function(x,C){var A=Math.sin(C),E=Math.cos(C);return x[0]=1,x[1]=0,x[2]=0,x[3]=0,x[4]=0,x[5]=E,x[6]=A,x[7]=0,x[8]=0,x[9]=-A,x[10]=E,x[11]=0,x[12]=0,x[13]=0,x[14]=0,x[15]=1,x},Pe.fromYRotation=function(x,C){var A=Math.sin(C),E=Math.cos(C);return x[0]=E,x[1]=0,x[2]=-A,x[3]=0,x[4]=0,x[5]=1,x[6]=0,x[7]=0,x[8]=A,x[9]=0,x[10]=E,x[11]=0,x[12]=0,x[13]=0,x[14]=0,x[15]=1,x},Pe.fromZRotation=function(x,C){var A=Math.sin(C),E=Math.cos(C);return x[0]=E,x[1]=A,x[2]=0,x[3]=0,x[4]=-A,x[5]=E,x[6]=0,x[7]=0,x[8]=0,x[9]=0,x[10]=1,x[11]=0,x[12]=0,x[13]=0,x[14]=0,x[15]=1,x},Pe.fromRotationTranslation=c,Pe.fromQuat2=function(x,C){var A=new e.ARRAY_TYPE(3),E=-C[0],M=-C[1],k=-C[2],N=C[3],j=C[4],q=C[5],X=C[6],W=C[7],J=E*E+M*M+k*k+N*N;return J>0?(A[0]=2*(j*N+W*E+q*k-X*M)/J,A[1]=2*(q*N+W*M+X*E-j*k)/J,A[2]=2*(X*N+W*k+j*M-q*E)/J):(A[0]=2*(j*N+W*E+q*k-X*M),A[1]=2*(q*N+W*M+X*E-j*k),A[2]=2*(X*N+W*k+j*M-q*E)),c(x,C,A),x},Pe.getTranslation=function(x,C){return x[0]=C[12],x[1]=C[13],x[2]=C[14],x},Pe.getScaling=p,Pe.getRotation=function(x,C){var A=new e.ARRAY_TYPE(3);p(A,C);var E=1/A[0],M=1/A[1],k=1/A[2],N=C[0]*E,j=C[1]*M,q=C[2]*k,X=C[4]*E,W=C[5]*M,J=C[6]*k,ne=C[8]*E,he=C[9]*M,we=C[10]*k,be=N+W+we,ve=0;return be>0?(ve=2*Math.sqrt(be+1),x[3]=.25*ve,x[0]=(J-he)/ve,x[1]=(ne-q)/ve,x[2]=(j-X)/ve):N>W&&N>we?(ve=2*Math.sqrt(1+N-W-we),x[3]=(J-he)/ve,x[0]=.25*ve,x[1]=(j+X)/ve,x[2]=(ne+q)/ve):W>we?(ve=2*Math.sqrt(1+W-N-we),x[3]=(ne-q)/ve,x[0]=(j+X)/ve,x[1]=.25*ve,x[2]=(J+he)/ve):(ve=2*Math.sqrt(1+we-N-W),x[3]=(j-X)/ve,x[0]=(ne+q)/ve,x[1]=(J+he)/ve,x[2]=.25*ve),x},Pe.fromRotationTranslationScale=function(x,C,A,E){var M=C[0],k=C[1],N=C[2],j=C[3],q=M+M,X=k+k,W=N+N,J=M*q,ne=M*X,he=M*W,we=k*X,be=k*W,ve=N*W,Be=j*q,Me=j*X,Ue=j*W,Ye=E[0],Xe=E[1],Je=E[2];return x[0]=(1-(we+ve))*Ye,x[1]=(ne+Ue)*Ye,x[2]=(he-Me)*Ye,x[3]=0,x[4]=(ne-Ue)*Xe,x[5]=(1-(J+ve))*Xe,x[6]=(be+Be)*Xe,x[7]=0,x[8]=(he+Me)*Je,x[9]=(be-Be)*Je,x[10]=(1-(J+we))*Je,x[11]=0,x[12]=A[0],x[13]=A[1],x[14]=A[2],x[15]=1,x},Pe.fromRotationTranslationScaleOrigin=function(x,C,A,E,M){var k=C[0],N=C[1],j=C[2],q=C[3],X=k+k,W=N+N,J=j+j,ne=k*X,he=k*W,we=k*J,be=N*W,ve=N*J,Be=j*J,Me=q*X,Ue=q*W,Ye=q*J,Xe=E[0],Je=E[1],st=E[2],pt=M[0],ot=M[1],It=M[2],tn=(1-(be+Be))*Xe,Lt=(he+Ye)*Xe,un=(we-Ue)*Xe,cn=(he-Ye)*Je,vn=(1-(ne+Be))*Je,Bt=(ve+Me)*Je,Pn=(we+Ue)*st,dn=(ve-Me)*st,Cn=(1-(ne+be))*st;return x[0]=tn,x[1]=Lt,x[2]=un,x[3]=0,x[4]=cn,x[5]=vn,x[6]=Bt,x[7]=0,x[8]=Pn,x[9]=dn,x[10]=Cn,x[11]=0,x[12]=A[0]+pt-(tn*pt+cn*ot+Pn*It),x[13]=A[1]+ot-(Lt*pt+vn*ot+dn*It),x[14]=A[2]+It-(un*pt+Bt*ot+Cn*It),x[15]=1,x},Pe.fromQuat=function(x,C){var A=C[0],E=C[1],M=C[2],k=C[3],N=A+A,j=E+E,q=M+M,X=A*N,W=E*N,J=E*j,ne=M*N,he=M*j,we=M*q,be=k*N,ve=k*j,Be=k*q;return x[0]=1-J-we,x[1]=W+Be,x[2]=ne-ve,x[3]=0,x[4]=W-Be,x[5]=1-X-we,x[6]=he+be,x[7]=0,x[8]=ne+ve,x[9]=he-be,x[10]=1-X-J,x[11]=0,x[12]=0,x[13]=0,x[14]=0,x[15]=1,x},Pe.frustum=function(x,C,A,E,M,k,N){var j=1/(A-C),q=1/(M-E),X=1/(k-N);return x[0]=2*k*j,x[1]=0,x[2]=0,x[3]=0,x[4]=0,x[5]=2*k*q,x[6]=0,x[7]=0,x[8]=(A+C)*j,x[9]=(M+E)*q,x[10]=(N+k)*X,x[11]=-1,x[12]=0,x[13]=0,x[14]=N*k*2*X,x[15]=0,x},Pe.perspectiveNO=w,Pe.perspectiveZO=function(x,C,A,E,M){var k,N=1/Math.tan(C/2);return x[0]=N/A,x[1]=0,x[2]=0,x[3]=0,x[4]=0,x[5]=N,x[6]=0,x[7]=0,x[8]=0,x[9]=0,x[11]=-1,x[12]=0,x[13]=0,x[15]=0,M!=null&&M!==1/0?(x[10]=M*(k=1/(E-M)),x[14]=M*E*k):(x[10]=-1,x[14]=-E),x},Pe.perspectiveFromFieldOfView=function(x,C,A,E){var M=Math.tan(C.upDegrees*Math.PI/180),k=Math.tan(C.downDegrees*Math.PI/180),N=Math.tan(C.leftDegrees*Math.PI/180),j=Math.tan(C.rightDegrees*Math.PI/180),q=2/(N+j),X=2/(M+k);return x[0]=q,x[1]=0,x[2]=0,x[3]=0,x[4]=0,x[5]=X,x[6]=0,x[7]=0,x[8]=-(N-j)*q*.5,x[9]=(M-k)*X*.5,x[10]=E/(A-E),x[11]=-1,x[12]=0,x[13]=0,x[14]=E*A/(A-E),x[15]=0,x},Pe.orthoNO=T,Pe.orthoZO=function(x,C,A,E,M,k,N){var j=1/(C-A),q=1/(E-M),X=1/(k-N);return x[0]=-2*j,x[1]=0,x[2]=0,x[3]=0,x[4]=0,x[5]=-2*q,x[6]=0,x[7]=0,x[8]=0,x[9]=0,x[10]=X,x[11]=0,x[12]=(C+A)*j,x[13]=(M+E)*q,x[14]=k*X,x[15]=1,x},Pe.lookAt=function(x,C,A,E){var M,k,N,j,q,X,W,J,ne,he,we=C[0],be=C[1],ve=C[2],Be=E[0],Me=E[1],Ue=E[2],Ye=A[0],Xe=A[1],Je=A[2];return Math.abs(we-Ye)<e.EPSILON&&Math.abs(be-Xe)<e.EPSILON&&Math.abs(ve-Je)<e.EPSILON?a(x):(W=we-Ye,J=be-Xe,ne=ve-Je,M=Me*(ne*=he=1/Math.hypot(W,J,ne))-Ue*(J*=he),k=Ue*(W*=he)-Be*ne,N=Be*J-Me*W,(he=Math.hypot(M,k,N))?(M*=he=1/he,k*=he,N*=he):(M=0,k=0,N=0),j=J*N-ne*k,q=ne*M-W*N,X=W*k-J*M,(he=Math.hypot(j,q,X))?(j*=he=1/he,q*=he,X*=he):(j=0,q=0,X=0),x[0]=M,x[1]=j,x[2]=W,x[3]=0,x[4]=k,x[5]=q,x[6]=J,x[7]=0,x[8]=N,x[9]=X,x[10]=ne,x[11]=0,x[12]=-(M*we+k*be+N*ve),x[13]=-(j*we+q*be+X*ve),x[14]=-(W*we+J*be+ne*ve),x[15]=1,x)},Pe.targetTo=function(x,C,A,E){var M=C[0],k=C[1],N=C[2],j=E[0],q=E[1],X=E[2],W=M-A[0],J=k-A[1],ne=N-A[2],he=W*W+J*J+ne*ne;he>0&&(W*=he=1/Math.sqrt(he),J*=he,ne*=he);var we=q*ne-X*J,be=X*W-j*ne,ve=j*J-q*W;return(he=we*we+be*be+ve*ve)>0&&(we*=he=1/Math.sqrt(he),be*=he,ve*=he),x[0]=we,x[1]=be,x[2]=ve,x[3]=0,x[4]=J*ve-ne*be,x[5]=ne*we-W*ve,x[6]=W*be-J*we,x[7]=0,x[8]=W,x[9]=J,x[10]=ne,x[11]=0,x[12]=M,x[13]=k,x[14]=N,x[15]=1,x},Pe.str=function(x){return"mat4("+x[0]+", "+x[1]+", "+x[2]+", "+x[3]+", "+x[4]+", "+x[5]+", "+x[6]+", "+x[7]+", "+x[8]+", "+x[9]+", "+x[10]+", "+x[11]+", "+x[12]+", "+x[13]+", "+x[14]+", "+x[15]+")"},Pe.frob=function(x){return Math.hypot(x[0],x[1],x[2],x[3],x[4],x[5],x[6],x[7],x[8],x[9],x[10],x[11],x[12],x[13],x[14],x[15])},Pe.add=function(x,C,A){return x[0]=C[0]+A[0],x[1]=C[1]+A[1],x[2]=C[2]+A[2],x[3]=C[3]+A[3],x[4]=C[4]+A[4],x[5]=C[5]+A[5],x[6]=C[6]+A[6],x[7]=C[7]+A[7],x[8]=C[8]+A[8],x[9]=C[9]+A[9],x[10]=C[10]+A[10],x[11]=C[11]+A[11],x[12]=C[12]+A[12],x[13]=C[13]+A[13],x[14]=C[14]+A[14],x[15]=C[15]+A[15],x},Pe.subtract=P,Pe.multiplyScalar=function(x,C,A){return x[0]=C[0]*A,x[1]=C[1]*A,x[2]=C[2]*A,x[3]=C[3]*A,x[4]=C[4]*A,x[5]=C[5]*A,x[6]=C[6]*A,x[7]=C[7]*A,x[8]=C[8]*A,x[9]=C[9]*A,x[10]=C[10]*A,x[11]=C[11]*A,x[12]=C[12]*A,x[13]=C[13]*A,x[14]=C[14]*A,x[15]=C[15]*A,x},Pe.multiplyScalarAndAdd=function(x,C,A,E){return x[0]=C[0]+A[0]*E,x[1]=C[1]+A[1]*E,x[2]=C[2]+A[2]*E,x[3]=C[3]+A[3]*E,x[4]=C[4]+A[4]*E,x[5]=C[5]+A[5]*E,x[6]=C[6]+A[6]*E,x[7]=C[7]+A[7]*E,x[8]=C[8]+A[8]*E,x[9]=C[9]+A[9]*E,x[10]=C[10]+A[10]*E,x[11]=C[11]+A[11]*E,x[12]=C[12]+A[12]*E,x[13]=C[13]+A[13]*E,x[14]=C[14]+A[14]*E,x[15]=C[15]+A[15]*E,x},Pe.exactEquals=function(x,C){return x[0]===C[0]&&x[1]===C[1]&&x[2]===C[2]&&x[3]===C[3]&&x[4]===C[4]&&x[5]===C[5]&&x[6]===C[6]&&x[7]===C[7]&&x[8]===C[8]&&x[9]===C[9]&&x[10]===C[10]&&x[11]===C[11]&&x[12]===C[12]&&x[13]===C[13]&&x[14]===C[14]&&x[15]===C[15]},Pe.equals=function(x,C){var A=x[0],E=x[1],M=x[2],k=x[3],N=x[4],j=x[5],q=x[6],X=x[7],W=x[8],J=x[9],ne=x[10],he=x[11],we=x[12],be=x[13],ve=x[14],Be=x[15],Me=C[0],Ue=C[1],Ye=C[2],Xe=C[3],Je=C[4],st=C[5],pt=C[6],ot=C[7],It=C[8],tn=C[9],Lt=C[10],un=C[11],cn=C[12],vn=C[13],Bt=C[14],Pn=C[15];return Math.abs(A-Me)<=e.EPSILON*Math.max(1,Math.abs(A),Math.abs(Me))&&Math.abs(E-Ue)<=e.EPSILON*Math.max(1,Math.abs(E),Math.abs(Ue))&&Math.abs(M-Ye)<=e.EPSILON*Math.max(1,Math.abs(M),Math.abs(Ye))&&Math.abs(k-Xe)<=e.EPSILON*Math.max(1,Math.abs(k),Math.abs(Xe))&&Math.abs(N-Je)<=e.EPSILON*Math.max(1,Math.abs(N),Math.abs(Je))&&Math.abs(j-st)<=e.EPSILON*Math.max(1,Math.abs(j),Math.abs(st))&&Math.abs(q-pt)<=e.EPSILON*Math.max(1,Math.abs(q),Math.abs(pt))&&Math.abs(X-ot)<=e.EPSILON*Math.max(1,Math.abs(X),Math.abs(ot))&&Math.abs(W-It)<=e.EPSILON*Math.max(1,Math.abs(W),Math.abs(It))&&Math.abs(J-tn)<=e.EPSILON*Math.max(1,Math.abs(J),Math.abs(tn))&&Math.abs(ne-Lt)<=e.EPSILON*Math.max(1,Math.abs(ne),Math.abs(Lt))&&Math.abs(he-un)<=e.EPSILON*Math.max(1,Math.abs(he),Math.abs(un))&&Math.abs(we-cn)<=e.EPSILON*Math.max(1,Math.abs(we),Math.abs(cn))&&Math.abs(be-vn)<=e.EPSILON*Math.max(1,Math.abs(be),Math.abs(vn))&&Math.abs(ve-Bt)<=e.EPSILON*Math.max(1,Math.abs(ve),Math.abs(Bt))&&Math.abs(Be-Pn)<=e.EPSILON*Math.max(1,Math.abs(Be),Math.abs(Pn))},Pe.sub=Pe.mul=Pe.ortho=Pe.perspective=void 0;var e=function(x,C){if(x&&x.__esModule)return x;if(x===null||s(x)!=="object"&&typeof x!="function")return{default:x};var A=n(void 0);if(A&&A.has(x))return A.get(x);var E={},M=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var k in x)if(k!=="default"&&Object.prototype.hasOwnProperty.call(x,k)){var N=M?Object.getOwnPropertyDescriptor(x,k):null;N&&(N.get||N.set)?Object.defineProperty(E,k,N):E[k]=x[k]}return E.default=x,A&&A.set(x,E),E}(le());function n(x){if(typeof WeakMap!="function")return null;var C=new WeakMap,A=new WeakMap;return(n=function(E){return E?A:C})(x)}function a(x){return x[0]=1,x[1]=0,x[2]=0,x[3]=0,x[4]=0,x[5]=1,x[6]=0,x[7]=0,x[8]=0,x[9]=0,x[10]=1,x[11]=0,x[12]=0,x[13]=0,x[14]=0,x[15]=1,x}function d(x,C,A){var E=C[0],M=C[1],k=C[2],N=C[3],j=C[4],q=C[5],X=C[6],W=C[7],J=C[8],ne=C[9],he=C[10],we=C[11],be=C[12],ve=C[13],Be=C[14],Me=C[15],Ue=A[0],Ye=A[1],Xe=A[2],Je=A[3];return x[0]=Ue*E+Ye*j+Xe*J+Je*be,x[1]=Ue*M+Ye*q+Xe*ne+Je*ve,x[2]=Ue*k+Ye*X+Xe*he+Je*Be,x[3]=Ue*N+Ye*W+Xe*we+Je*Me,x[4]=(Ue=A[4])*E+(Ye=A[5])*j+(Xe=A[6])*J+(Je=A[7])*be,x[5]=Ue*M+Ye*q+Xe*ne+Je*ve,x[6]=Ue*k+Ye*X+Xe*he+Je*Be,x[7]=Ue*N+Ye*W+Xe*we+Je*Me,x[8]=(Ue=A[8])*E+(Ye=A[9])*j+(Xe=A[10])*J+(Je=A[11])*be,x[9]=Ue*M+Ye*q+Xe*ne+Je*ve,x[10]=Ue*k+Ye*X+Xe*he+Je*Be,x[11]=Ue*N+Ye*W+Xe*we+Je*Me,x[12]=(Ue=A[12])*E+(Ye=A[13])*j+(Xe=A[14])*J+(Je=A[15])*be,x[13]=Ue*M+Ye*q+Xe*ne+Je*ve,x[14]=Ue*k+Ye*X+Xe*he+Je*Be,x[15]=Ue*N+Ye*W+Xe*we+Je*Me,x}function c(x,C,A){var E=C[0],M=C[1],k=C[2],N=C[3],j=E+E,q=M+M,X=k+k,W=E*j,J=E*q,ne=E*X,he=M*q,we=M*X,be=k*X,ve=N*j,Be=N*q,Me=N*X;return x[0]=1-(he+be),x[1]=J+Me,x[2]=ne-Be,x[3]=0,x[4]=J-Me,x[5]=1-(W+be),x[6]=we+ve,x[7]=0,x[8]=ne+Be,x[9]=we-ve,x[10]=1-(W+he),x[11]=0,x[12]=A[0],x[13]=A[1],x[14]=A[2],x[15]=1,x}function p(x,C){var A=C[4],E=C[5],M=C[6],k=C[8],N=C[9],j=C[10];return x[0]=Math.hypot(C[0],C[1],C[2]),x[1]=Math.hypot(A,E,M),x[2]=Math.hypot(k,N,j),x}function w(x,C,A,E,M){var k,N=1/Math.tan(C/2);return x[0]=N/A,x[1]=0,x[2]=0,x[3]=0,x[4]=0,x[5]=N,x[6]=0,x[7]=0,x[8]=0,x[9]=0,x[11]=-1,x[12]=0,x[13]=0,x[15]=0,M!=null&&M!==1/0?(x[10]=(M+E)*(k=1/(E-M)),x[14]=2*M*E*k):(x[10]=-1,x[14]=-2*E),x}function T(x,C,A,E,M,k,N){var j=1/(C-A),q=1/(E-M),X=1/(k-N);return x[0]=-2*j,x[1]=0,x[2]=0,x[3]=0,x[4]=0,x[5]=-2*q,x[6]=0,x[7]=0,x[8]=0,x[9]=0,x[10]=2*X,x[11]=0,x[12]=(C+A)*j,x[13]=(M+E)*q,x[14]=(N+k)*X,x[15]=1,x}function P(x,C,A){return x[0]=C[0]-A[0],x[1]=C[1]-A[1],x[2]=C[2]-A[2],x[3]=C[3]-A[3],x[4]=C[4]-A[4],x[5]=C[5]-A[5],x[6]=C[6]-A[6],x[7]=C[7]-A[7],x[8]=C[8]-A[8],x[9]=C[9]-A[9],x[10]=C[10]-A[10],x[11]=C[11]-A[11],x[12]=C[12]-A[12],x[13]=C[13]-A[13],x[14]=C[14]-A[14],x[15]=C[15]-A[15],x}return Pe.perspective=w,Pe.ortho=T,Pe.mul=d,Pe.sub=P,Pe}var at,Qe={},lt={};function Ct(){if(at)return lt;function s(M){return s=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(k){return typeof k}:function(k){return k&&typeof Symbol=="function"&&k.constructor===Symbol&&k!==Symbol.prototype?"symbol":typeof k},s(M)}at=1,Object.defineProperty(lt,"__esModule",{value:!0}),lt.create=a,lt.clone=function(M){var k=new e.ARRAY_TYPE(3);return k[0]=M[0],k[1]=M[1],k[2]=M[2],k},lt.length=d,lt.fromValues=function(M,k,N){var j=new e.ARRAY_TYPE(3);return j[0]=M,j[1]=k,j[2]=N,j},lt.copy=function(M,k){return M[0]=k[0],M[1]=k[1],M[2]=k[2],M},lt.set=function(M,k,N,j){return M[0]=k,M[1]=N,M[2]=j,M},lt.add=function(M,k,N){return M[0]=k[0]+N[0],M[1]=k[1]+N[1],M[2]=k[2]+N[2],M},lt.subtract=c,lt.multiply=p,lt.divide=w,lt.ceil=function(M,k){return M[0]=Math.ceil(k[0]),M[1]=Math.ceil(k[1]),M[2]=Math.ceil(k[2]),M},lt.floor=function(M,k){return M[0]=Math.floor(k[0]),M[1]=Math.floor(k[1]),M[2]=Math.floor(k[2]),M},lt.min=function(M,k,N){return M[0]=Math.min(k[0],N[0]),M[1]=Math.min(k[1],N[1]),M[2]=Math.min(k[2],N[2]),M},lt.max=function(M,k,N){return M[0]=Math.max(k[0],N[0]),M[1]=Math.max(k[1],N[1]),M[2]=Math.max(k[2],N[2]),M},lt.round=function(M,k){return M[0]=Math.round(k[0]),M[1]=Math.round(k[1]),M[2]=Math.round(k[2]),M},lt.scale=function(M,k,N){return M[0]=k[0]*N,M[1]=k[1]*N,M[2]=k[2]*N,M},lt.scaleAndAdd=function(M,k,N,j){return M[0]=k[0]+N[0]*j,M[1]=k[1]+N[1]*j,M[2]=k[2]+N[2]*j,M},lt.distance=T,lt.squaredDistance=P,lt.squaredLength=x,lt.negate=function(M,k){return M[0]=-k[0],M[1]=-k[1],M[2]=-k[2],M},lt.inverse=function(M,k){return M[0]=1/k[0],M[1]=1/k[1],M[2]=1/k[2],M},lt.normalize=function(M,k){var N=k[0],j=k[1],q=k[2],X=N*N+j*j+q*q;return X>0&&(X=1/Math.sqrt(X)),M[0]=k[0]*X,M[1]=k[1]*X,M[2]=k[2]*X,M},lt.dot=C,lt.cross=function(M,k,N){var j=k[0],q=k[1],X=k[2],W=N[0],J=N[1],ne=N[2];return M[0]=q*ne-X*J,M[1]=X*W-j*ne,M[2]=j*J-q*W,M},lt.lerp=function(M,k,N,j){var q=k[0],X=k[1],W=k[2];return M[0]=q+j*(N[0]-q),M[1]=X+j*(N[1]-X),M[2]=W+j*(N[2]-W),M},lt.hermite=function(M,k,N,j,q,X){var W=X*X,J=W*(2*X-3)+1,ne=W*(X-2)+X,he=W*(X-1),we=W*(3-2*X);return M[0]=k[0]*J+N[0]*ne+j[0]*he+q[0]*we,M[1]=k[1]*J+N[1]*ne+j[1]*he+q[1]*we,M[2]=k[2]*J+N[2]*ne+j[2]*he+q[2]*we,M},lt.bezier=function(M,k,N,j,q,X){var W=1-X,J=W*W,ne=X*X,he=J*W,we=3*X*J,be=3*ne*W,ve=ne*X;return M[0]=k[0]*he+N[0]*we+j[0]*be+q[0]*ve,M[1]=k[1]*he+N[1]*we+j[1]*be+q[1]*ve,M[2]=k[2]*he+N[2]*we+j[2]*be+q[2]*ve,M},lt.random=function(M,k){k=k||1;var N=2*e.RANDOM()*Math.PI,j=2*e.RANDOM()-1,q=Math.sqrt(1-j*j)*k;return M[0]=Math.cos(N)*q,M[1]=Math.sin(N)*q,M[2]=j*k,M},lt.transformMat4=function(M,k,N){var j=k[0],q=k[1],X=k[2],W=N[3]*j+N[7]*q+N[11]*X+N[15];return M[0]=(N[0]*j+N[4]*q+N[8]*X+N[12])/(W=W||1),M[1]=(N[1]*j+N[5]*q+N[9]*X+N[13])/W,M[2]=(N[2]*j+N[6]*q+N[10]*X+N[14])/W,M},lt.transformMat3=function(M,k,N){var j=k[0],q=k[1],X=k[2];return M[0]=j*N[0]+q*N[3]+X*N[6],M[1]=j*N[1]+q*N[4]+X*N[7],M[2]=j*N[2]+q*N[5]+X*N[8],M},lt.transformQuat=function(M,k,N){var j=N[0],q=N[1],X=N[2],W=k[0],J=k[1],ne=k[2],he=q*ne-X*J,we=X*W-j*ne,be=j*J-q*W,ve=q*be-X*we,Be=X*he-j*be,Me=j*we-q*he,Ue=2*N[3];return we*=Ue,be*=Ue,Be*=2,Me*=2,M[0]=W+(he*=Ue)+(ve*=2),M[1]=J+we+Be,M[2]=ne+be+Me,M},lt.rotateX=function(M,k,N,j){var q=[],X=[];return q[0]=k[0]-N[0],q[1]=k[1]-N[1],q[2]=k[2]-N[2],X[0]=q[0],X[1]=q[1]*Math.cos(j)-q[2]*Math.sin(j),X[2]=q[1]*Math.sin(j)+q[2]*Math.cos(j),M[0]=X[0]+N[0],M[1]=X[1]+N[1],M[2]=X[2]+N[2],M},lt.rotateY=function(M,k,N,j){var q=[],X=[];return q[0]=k[0]-N[0],q[1]=k[1]-N[1],q[2]=k[2]-N[2],X[0]=q[2]*Math.sin(j)+q[0]*Math.cos(j),X[1]=q[1],X[2]=q[2]*Math.cos(j)-q[0]*Math.sin(j),M[0]=X[0]+N[0],M[1]=X[1]+N[1],M[2]=X[2]+N[2],M},lt.rotateZ=function(M,k,N,j){var q=[],X=[];return q[0]=k[0]-N[0],q[1]=k[1]-N[1],q[2]=k[2]-N[2],X[0]=q[0]*Math.cos(j)-q[1]*Math.sin(j),X[1]=q[0]*Math.sin(j)+q[1]*Math.cos(j),X[2]=q[2],M[0]=X[0]+N[0],M[1]=X[1]+N[1],M[2]=X[2]+N[2],M},lt.angle=function(M,k){var N=M[0],j=M[1],q=M[2],X=k[0],W=k[1],J=k[2],ne=Math.sqrt(N*N+j*j+q*q)*Math.sqrt(X*X+W*W+J*J),he=ne&&C(M,k)/ne;return Math.acos(Math.min(Math.max(he,-1),1))},lt.zero=function(M){return M[0]=0,M[1]=0,M[2]=0,M},lt.str=function(M){return"vec3("+M[0]+", "+M[1]+", "+M[2]+")"},lt.exactEquals=function(M,k){return M[0]===k[0]&&M[1]===k[1]&&M[2]===k[2]},lt.equals=function(M,k){var N=M[0],j=M[1],q=M[2],X=k[0],W=k[1],J=k[2];return Math.abs(N-X)<=e.EPSILON*Math.max(1,Math.abs(N),Math.abs(X))&&Math.abs(j-W)<=e.EPSILON*Math.max(1,Math.abs(j),Math.abs(W))&&Math.abs(q-J)<=e.EPSILON*Math.max(1,Math.abs(q),Math.abs(J))},lt.forEach=lt.sqrLen=lt.len=lt.sqrDist=lt.dist=lt.div=lt.mul=lt.sub=void 0;var e=function(M,k){if(M&&M.__esModule)return M;if(M===null||s(M)!=="object"&&typeof M!="function")return{default:M};var N=n(void 0);if(N&&N.has(M))return N.get(M);var j={},q=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var X in M)if(X!=="default"&&Object.prototype.hasOwnProperty.call(M,X)){var W=q?Object.getOwnPropertyDescriptor(M,X):null;W&&(W.get||W.set)?Object.defineProperty(j,X,W):j[X]=M[X]}return j.default=M,N&&N.set(M,j),j}(le());function n(M){if(typeof WeakMap!="function")return null;var k=new WeakMap,N=new WeakMap;return(n=function(j){return j?N:k})(M)}function a(){var M=new e.ARRAY_TYPE(3);return e.ARRAY_TYPE!=Float32Array&&(M[0]=0,M[1]=0,M[2]=0),M}function d(M){return Math.hypot(M[0],M[1],M[2])}function c(M,k,N){return M[0]=k[0]-N[0],M[1]=k[1]-N[1],M[2]=k[2]-N[2],M}function p(M,k,N){return M[0]=k[0]*N[0],M[1]=k[1]*N[1],M[2]=k[2]*N[2],M}function w(M,k,N){return M[0]=k[0]/N[0],M[1]=k[1]/N[1],M[2]=k[2]/N[2],M}function T(M,k){return Math.hypot(k[0]-M[0],k[1]-M[1],k[2]-M[2])}function P(M,k){var N=k[0]-M[0],j=k[1]-M[1],q=k[2]-M[2];return N*N+j*j+q*q}function x(M){var k=M[0],N=M[1],j=M[2];return k*k+N*N+j*j}function C(M,k){return M[0]*k[0]+M[1]*k[1]+M[2]*k[2]}lt.sub=c,lt.mul=p,lt.div=w,lt.dist=T,lt.sqrDist=P,lt.len=d,lt.sqrLen=x;var A,E=(A=a(),function(M,k,N,j,q,X){var W,J;for(k||(k=3),N||(N=0),J=j?Math.min(j*k+N,M.length):M.length,W=N;W<J;W+=k)A[0]=M[W],A[1]=M[W+1],A[2]=M[W+2],q(A,A,X),M[W]=A[0],M[W+1]=A[1],M[W+2]=A[2];return M});return lt.forEach=E,lt}var Rt,Nt,At={};function xt(){if(Rt)return At;function s(E){return s=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(M){return typeof M}:function(M){return M&&typeof Symbol=="function"&&M.constructor===Symbol&&M!==Symbol.prototype?"symbol":typeof M},s(E)}Rt=1,Object.defineProperty(At,"__esModule",{value:!0}),At.create=a,At.clone=function(E){var M=new e.ARRAY_TYPE(4);return M[0]=E[0],M[1]=E[1],M[2]=E[2],M[3]=E[3],M},At.fromValues=function(E,M,k,N){var j=new e.ARRAY_TYPE(4);return j[0]=E,j[1]=M,j[2]=k,j[3]=N,j},At.copy=function(E,M){return E[0]=M[0],E[1]=M[1],E[2]=M[2],E[3]=M[3],E},At.set=function(E,M,k,N,j){return E[0]=M,E[1]=k,E[2]=N,E[3]=j,E},At.add=function(E,M,k){return E[0]=M[0]+k[0],E[1]=M[1]+k[1],E[2]=M[2]+k[2],E[3]=M[3]+k[3],E},At.subtract=d,At.multiply=c,At.divide=p,At.ceil=function(E,M){return E[0]=Math.ceil(M[0]),E[1]=Math.ceil(M[1]),E[2]=Math.ceil(M[2]),E[3]=Math.ceil(M[3]),E},At.floor=function(E,M){return E[0]=Math.floor(M[0]),E[1]=Math.floor(M[1]),E[2]=Math.floor(M[2]),E[3]=Math.floor(M[3]),E},At.min=function(E,M,k){return E[0]=Math.min(M[0],k[0]),E[1]=Math.min(M[1],k[1]),E[2]=Math.min(M[2],k[2]),E[3]=Math.min(M[3],k[3]),E},At.max=function(E,M,k){return E[0]=Math.max(M[0],k[0]),E[1]=Math.max(M[1],k[1]),E[2]=Math.max(M[2],k[2]),E[3]=Math.max(M[3],k[3]),E},At.round=function(E,M){return E[0]=Math.round(M[0]),E[1]=Math.round(M[1]),E[2]=Math.round(M[2]),E[3]=Math.round(M[3]),E},At.scale=function(E,M,k){return E[0]=M[0]*k,E[1]=M[1]*k,E[2]=M[2]*k,E[3]=M[3]*k,E},At.scaleAndAdd=function(E,M,k,N){return E[0]=M[0]+k[0]*N,E[1]=M[1]+k[1]*N,E[2]=M[2]+k[2]*N,E[3]=M[3]+k[3]*N,E},At.distance=w,At.squaredDistance=T,At.length=P,At.squaredLength=x,At.negate=function(E,M){return E[0]=-M[0],E[1]=-M[1],E[2]=-M[2],E[3]=-M[3],E},At.inverse=function(E,M){return E[0]=1/M[0],E[1]=1/M[1],E[2]=1/M[2],E[3]=1/M[3],E},At.normalize=function(E,M){var k=M[0],N=M[1],j=M[2],q=M[3],X=k*k+N*N+j*j+q*q;return X>0&&(X=1/Math.sqrt(X)),E[0]=k*X,E[1]=N*X,E[2]=j*X,E[3]=q*X,E},At.dot=function(E,M){return E[0]*M[0]+E[1]*M[1]+E[2]*M[2]+E[3]*M[3]},At.cross=function(E,M,k,N){var j=k[0]*N[1]-k[1]*N[0],q=k[0]*N[2]-k[2]*N[0],X=k[0]*N[3]-k[3]*N[0],W=k[1]*N[2]-k[2]*N[1],J=k[1]*N[3]-k[3]*N[1],ne=k[2]*N[3]-k[3]*N[2],he=M[0],we=M[1],be=M[2],ve=M[3];return E[0]=we*ne-be*J+ve*W,E[1]=-he*ne+be*X-ve*q,E[2]=he*J-we*X+ve*j,E[3]=-he*W+we*q-be*j,E},At.lerp=function(E,M,k,N){var j=M[0],q=M[1],X=M[2],W=M[3];return E[0]=j+N*(k[0]-j),E[1]=q+N*(k[1]-q),E[2]=X+N*(k[2]-X),E[3]=W+N*(k[3]-W),E},At.random=function(E,M){var k,N,j,q,X,W;M=M||1;do X=(k=2*e.RANDOM()-1)*k+(N=2*e.RANDOM()-1)*N;while(X>=1);do W=(j=2*e.RANDOM()-1)*j+(q=2*e.RANDOM()-1)*q;while(W>=1);var J=Math.sqrt((1-X)/W);return E[0]=M*k,E[1]=M*N,E[2]=M*j*J,E[3]=M*q*J,E},At.transformMat4=function(E,M,k){var N=M[0],j=M[1],q=M[2],X=M[3];return E[0]=k[0]*N+k[4]*j+k[8]*q+k[12]*X,E[1]=k[1]*N+k[5]*j+k[9]*q+k[13]*X,E[2]=k[2]*N+k[6]*j+k[10]*q+k[14]*X,E[3]=k[3]*N+k[7]*j+k[11]*q+k[15]*X,E},At.transformQuat=function(E,M,k){var N=M[0],j=M[1],q=M[2],X=k[0],W=k[1],J=k[2],ne=k[3],he=ne*N+W*q-J*j,we=ne*j+J*N-X*q,be=ne*q+X*j-W*N,ve=-X*N-W*j-J*q;return E[0]=he*ne+ve*-X+we*-J-be*-W,E[1]=we*ne+ve*-W+be*-X-he*-J,E[2]=be*ne+ve*-J+he*-W-we*-X,E[3]=M[3],E},At.zero=function(E){return E[0]=0,E[1]=0,E[2]=0,E[3]=0,E},At.str=function(E){return"vec4("+E[0]+", "+E[1]+", "+E[2]+", "+E[3]+")"},At.exactEquals=function(E,M){return E[0]===M[0]&&E[1]===M[1]&&E[2]===M[2]&&E[3]===M[3]},At.equals=function(E,M){var k=E[0],N=E[1],j=E[2],q=E[3],X=M[0],W=M[1],J=M[2],ne=M[3];return Math.abs(k-X)<=e.EPSILON*Math.max(1,Math.abs(k),Math.abs(X))&&Math.abs(N-W)<=e.EPSILON*Math.max(1,Math.abs(N),Math.abs(W))&&Math.abs(j-J)<=e.EPSILON*Math.max(1,Math.abs(j),Math.abs(J))&&Math.abs(q-ne)<=e.EPSILON*Math.max(1,Math.abs(q),Math.abs(ne))},At.forEach=At.sqrLen=At.len=At.sqrDist=At.dist=At.div=At.mul=At.sub=void 0;var e=function(E,M){if(E&&E.__esModule)return E;if(E===null||s(E)!=="object"&&typeof E!="function")return{default:E};var k=n(void 0);if(k&&k.has(E))return k.get(E);var N={},j=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var q in E)if(q!=="default"&&Object.prototype.hasOwnProperty.call(E,q)){var X=j?Object.getOwnPropertyDescriptor(E,q):null;X&&(X.get||X.set)?Object.defineProperty(N,q,X):N[q]=E[q]}return N.default=E,k&&k.set(E,N),N}(le());function n(E){if(typeof WeakMap!="function")return null;var M=new WeakMap,k=new WeakMap;return(n=function(N){return N?k:M})(E)}function a(){var E=new e.ARRAY_TYPE(4);return e.ARRAY_TYPE!=Float32Array&&(E[0]=0,E[1]=0,E[2]=0,E[3]=0),E}function d(E,M,k){return E[0]=M[0]-k[0],E[1]=M[1]-k[1],E[2]=M[2]-k[2],E[3]=M[3]-k[3],E}function c(E,M,k){return E[0]=M[0]*k[0],E[1]=M[1]*k[1],E[2]=M[2]*k[2],E[3]=M[3]*k[3],E}function p(E,M,k){return E[0]=M[0]/k[0],E[1]=M[1]/k[1],E[2]=M[2]/k[2],E[3]=M[3]/k[3],E}function w(E,M){return Math.hypot(M[0]-E[0],M[1]-E[1],M[2]-E[2],M[3]-E[3])}function T(E,M){var k=M[0]-E[0],N=M[1]-E[1],j=M[2]-E[2],q=M[3]-E[3];return k*k+N*N+j*j+q*q}function P(E){return Math.hypot(E[0],E[1],E[2],E[3])}function x(E){var M=E[0],k=E[1],N=E[2],j=E[3];return M*M+k*k+N*N+j*j}At.sub=d,At.mul=c,At.div=p,At.dist=w,At.sqrDist=T,At.len=P,At.sqrLen=x;var C,A=(C=a(),function(E,M,k,N,j,q){var X,W;for(M||(M=4),k||(k=0),W=N?Math.min(N*M+k,E.length):E.length,X=k;X<W;X+=M)C[0]=E[X],C[1]=E[X+1],C[2]=E[X+2],C[3]=E[X+3],j(C,C,q),E[X]=C[0],E[X+1]=C[1],E[X+2]=C[2],E[X+3]=C[3];return E});return At.forEach=A,At}function gt(){if(Nt)return Qe;function s(Me){return s=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(Ue){return typeof Ue}:function(Ue){return Ue&&typeof Symbol=="function"&&Ue.constructor===Symbol&&Ue!==Symbol.prototype?"symbol":typeof Ue},s(Me)}Nt=1,Object.defineProperty(Qe,"__esModule",{value:!0}),Qe.create=w,Qe.identity=function(Me){return Me[0]=0,Me[1]=0,Me[2]=0,Me[3]=1,Me},Qe.setAxisAngle=T,Qe.getAxisAngle=function(Me,Ue){var Ye=2*Math.acos(Ue[3]),Xe=Math.sin(Ye/2);return Xe>e.EPSILON?(Me[0]=Ue[0]/Xe,Me[1]=Ue[1]/Xe,Me[2]=Ue[2]/Xe):(Me[0]=1,Me[1]=0,Me[2]=0),Ye},Qe.getAngle=function(Me,Ue){var Ye=k(Me,Ue);return Math.acos(2*Ye*Ye-1)},Qe.multiply=P,Qe.rotateX=function(Me,Ue,Ye){Ye*=.5;var Xe=Ue[0],Je=Ue[1],st=Ue[2],pt=Ue[3],ot=Math.sin(Ye),It=Math.cos(Ye);return Me[0]=Xe*It+pt*ot,Me[1]=Je*It+st*ot,Me[2]=st*It-Je*ot,Me[3]=pt*It-Xe*ot,Me},Qe.rotateY=function(Me,Ue,Ye){Ye*=.5;var Xe=Ue[0],Je=Ue[1],st=Ue[2],pt=Ue[3],ot=Math.sin(Ye),It=Math.cos(Ye);return Me[0]=Xe*It-st*ot,Me[1]=Je*It+pt*ot,Me[2]=st*It+Xe*ot,Me[3]=pt*It-Je*ot,Me},Qe.rotateZ=function(Me,Ue,Ye){Ye*=.5;var Xe=Ue[0],Je=Ue[1],st=Ue[2],pt=Ue[3],ot=Math.sin(Ye),It=Math.cos(Ye);return Me[0]=Xe*It+Je*ot,Me[1]=Je*It-Xe*ot,Me[2]=st*It+pt*ot,Me[3]=pt*It-st*ot,Me},Qe.calculateW=function(Me,Ue){var Ye=Ue[0],Xe=Ue[1],Je=Ue[2];return Me[0]=Ye,Me[1]=Xe,Me[2]=Je,Me[3]=Math.sqrt(Math.abs(1-Ye*Ye-Xe*Xe-Je*Je)),Me},Qe.exp=x,Qe.ln=C,Qe.pow=function(Me,Ue,Ye){return C(Me,Ue),M(Me,Me,Ye),x(Me,Me),Me},Qe.slerp=A,Qe.random=function(Me){var Ue=e.RANDOM(),Ye=e.RANDOM(),Xe=e.RANDOM(),Je=Math.sqrt(1-Ue),st=Math.sqrt(Ue);return Me[0]=Je*Math.sin(2*Math.PI*Ye),Me[1]=Je*Math.cos(2*Math.PI*Ye),Me[2]=st*Math.sin(2*Math.PI*Xe),Me[3]=st*Math.cos(2*Math.PI*Xe),Me},Qe.invert=function(Me,Ue){var Ye=Ue[0],Xe=Ue[1],Je=Ue[2],st=Ue[3],pt=Ye*Ye+Xe*Xe+Je*Je+st*st,ot=pt?1/pt:0;return Me[0]=-Ye*ot,Me[1]=-Xe*ot,Me[2]=-Je*ot,Me[3]=st*ot,Me},Qe.conjugate=function(Me,Ue){return Me[0]=-Ue[0],Me[1]=-Ue[1],Me[2]=-Ue[2],Me[3]=Ue[3],Me},Qe.fromMat3=E,Qe.fromEuler=function(Me,Ue,Ye,Xe){var Je=.5*Math.PI/180;Ue*=Je,Ye*=Je,Xe*=Je;var st=Math.sin(Ue),pt=Math.cos(Ue),ot=Math.sin(Ye),It=Math.cos(Ye),tn=Math.sin(Xe),Lt=Math.cos(Xe);return Me[0]=st*It*Lt-pt*ot*tn,Me[1]=pt*ot*Lt+st*It*tn,Me[2]=pt*It*tn-st*ot*Lt,Me[3]=pt*It*Lt+st*ot*tn,Me},Qe.str=function(Me){return"quat("+Me[0]+", "+Me[1]+", "+Me[2]+", "+Me[3]+")"},Qe.setAxes=Qe.sqlerp=Qe.rotationTo=Qe.equals=Qe.exactEquals=Qe.normalize=Qe.sqrLen=Qe.squaredLength=Qe.len=Qe.length=Qe.lerp=Qe.dot=Qe.scale=Qe.mul=Qe.add=Qe.set=Qe.copy=Qe.fromValues=Qe.clone=void 0;var e=p(le()),n=p(nt()),a=p(Ct()),d=p(xt());function c(Me){if(typeof WeakMap!="function")return null;var Ue=new WeakMap,Ye=new WeakMap;return(c=function(Xe){return Xe?Ye:Ue})(Me)}function p(Me,Ue){if(Me&&Me.__esModule)return Me;if(Me===null||s(Me)!=="object"&&typeof Me!="function")return{default:Me};var Ye=c(Ue);if(Ye&&Ye.has(Me))return Ye.get(Me);var Xe={},Je=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var st in Me)if(st!=="default"&&Object.prototype.hasOwnProperty.call(Me,st)){var pt=Je?Object.getOwnPropertyDescriptor(Me,st):null;pt&&(pt.get||pt.set)?Object.defineProperty(Xe,st,pt):Xe[st]=Me[st]}return Xe.default=Me,Ye&&Ye.set(Me,Xe),Xe}function w(){var Me=new e.ARRAY_TYPE(4);return e.ARRAY_TYPE!=Float32Array&&(Me[0]=0,Me[1]=0,Me[2]=0),Me[3]=1,Me}function T(Me,Ue,Ye){Ye*=.5;var Xe=Math.sin(Ye);return Me[0]=Xe*Ue[0],Me[1]=Xe*Ue[1],Me[2]=Xe*Ue[2],Me[3]=Math.cos(Ye),Me}function P(Me,Ue,Ye){var Xe=Ue[0],Je=Ue[1],st=Ue[2],pt=Ue[3],ot=Ye[0],It=Ye[1],tn=Ye[2],Lt=Ye[3];return Me[0]=Xe*Lt+pt*ot+Je*tn-st*It,Me[1]=Je*Lt+pt*It+st*ot-Xe*tn,Me[2]=st*Lt+pt*tn+Xe*It-Je*ot,Me[3]=pt*Lt-Xe*ot-Je*It-st*tn,Me}function x(Me,Ue){var Ye=Ue[0],Xe=Ue[1],Je=Ue[2],st=Ue[3],pt=Math.sqrt(Ye*Ye+Xe*Xe+Je*Je),ot=Math.exp(st),It=pt>0?ot*Math.sin(pt)/pt:0;return Me[0]=Ye*It,Me[1]=Xe*It,Me[2]=Je*It,Me[3]=ot*Math.cos(pt),Me}function C(Me,Ue){var Ye=Ue[0],Xe=Ue[1],Je=Ue[2],st=Ue[3],pt=Math.sqrt(Ye*Ye+Xe*Xe+Je*Je),ot=pt>0?Math.atan2(pt,st)/pt:0;return Me[0]=Ye*ot,Me[1]=Xe*ot,Me[2]=Je*ot,Me[3]=.5*Math.log(Ye*Ye+Xe*Xe+Je*Je+st*st),Me}function A(Me,Ue,Ye,Xe){var Je,st,pt,ot,It,tn=Ue[0],Lt=Ue[1],un=Ue[2],cn=Ue[3],vn=Ye[0],Bt=Ye[1],Pn=Ye[2],dn=Ye[3];return(st=tn*vn+Lt*Bt+un*Pn+cn*dn)<0&&(st=-st,vn=-vn,Bt=-Bt,Pn=-Pn,dn=-dn),1-st>e.EPSILON?(Je=Math.acos(st),pt=Math.sin(Je),ot=Math.sin((1-Xe)*Je)/pt,It=Math.sin(Xe*Je)/pt):(ot=1-Xe,It=Xe),Me[0]=ot*tn+It*vn,Me[1]=ot*Lt+It*Bt,Me[2]=ot*un+It*Pn,Me[3]=ot*cn+It*dn,Me}function E(Me,Ue){var Ye,Xe=Ue[0]+Ue[4]+Ue[8];if(Xe>0)Ye=Math.sqrt(Xe+1),Me[3]=.5*Ye,Me[0]=(Ue[5]-Ue[7])*(Ye=.5/Ye),Me[1]=(Ue[6]-Ue[2])*Ye,Me[2]=(Ue[1]-Ue[3])*Ye;else{var Je=0;Ue[4]>Ue[0]&&(Je=1),Ue[8]>Ue[3*Je+Je]&&(Je=2);var st=(Je+1)%3,pt=(Je+2)%3;Ye=Math.sqrt(Ue[3*Je+Je]-Ue[3*st+st]-Ue[3*pt+pt]+1),Me[Je]=.5*Ye,Me[3]=(Ue[3*st+pt]-Ue[3*pt+st])*(Ye=.5/Ye),Me[st]=(Ue[3*st+Je]+Ue[3*Je+st])*Ye,Me[pt]=(Ue[3*pt+Je]+Ue[3*Je+pt])*Ye}return Me}Qe.clone=d.clone,Qe.fromValues=d.fromValues,Qe.copy=d.copy,Qe.set=d.set,Qe.add=d.add,Qe.mul=P;var M=d.scale;Qe.scale=M;var k=d.dot;Qe.dot=k,Qe.lerp=d.lerp;var N=d.length;Qe.length=N,Qe.len=N;var j=d.squaredLength;Qe.squaredLength=j,Qe.sqrLen=j;var q=d.normalize;Qe.normalize=q,Qe.exactEquals=d.exactEquals,Qe.equals=d.equals;var X,W,J,ne=(X=a.create(),W=a.fromValues(1,0,0),J=a.fromValues(0,1,0),function(Me,Ue,Ye){var Xe=a.dot(Ue,Ye);return Xe<-.999999?(a.cross(X,W,Ue),a.len(X)<1e-6&&a.cross(X,J,Ue),a.normalize(X,X),T(Me,X,Math.PI),Me):Xe>.999999?(Me[0]=0,Me[1]=0,Me[2]=0,Me[3]=1,Me):(a.cross(X,Ue,Ye),Me[0]=X[0],Me[1]=X[1],Me[2]=X[2],Me[3]=1+Xe,q(Me,Me))});Qe.rotationTo=ne;var he,we,be=(he=w(),we=w(),function(Me,Ue,Ye,Xe,Je,st){return A(he,Ue,Je,st),A(we,Ye,Xe,st),A(Me,he,we,2*st*(1-st)),Me});Qe.sqlerp=be;var ve,Be=(ve=n.create(),function(Me,Ue,Ye,Xe){return ve[0]=Ye[0],ve[3]=Ye[1],ve[6]=Ye[2],ve[1]=Xe[0],ve[4]=Xe[1],ve[7]=Xe[2],ve[2]=-Ue[0],ve[5]=-Ue[1],ve[8]=-Ue[2],q(Me,E(Me,ve))});return Qe.setAxes=Be,Qe}var ht,vt={};function Ve(){if(ht)return vt;function s(A){return s=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(E){return typeof E}:function(E){return E&&typeof Symbol=="function"&&E.constructor===Symbol&&E!==Symbol.prototype?"symbol":typeof E},s(A)}ht=1,Object.defineProperty(vt,"__esModule",{value:!0}),vt.create=function(){var A=new e.ARRAY_TYPE(8);return e.ARRAY_TYPE!=Float32Array&&(A[0]=0,A[1]=0,A[2]=0,A[4]=0,A[5]=0,A[6]=0,A[7]=0),A[3]=1,A},vt.clone=function(A){var E=new e.ARRAY_TYPE(8);return E[0]=A[0],E[1]=A[1],E[2]=A[2],E[3]=A[3],E[4]=A[4],E[5]=A[5],E[6]=A[6],E[7]=A[7],E},vt.fromValues=function(A,E,M,k,N,j,q,X){var W=new e.ARRAY_TYPE(8);return W[0]=A,W[1]=E,W[2]=M,W[3]=k,W[4]=N,W[5]=j,W[6]=q,W[7]=X,W},vt.fromRotationTranslationValues=function(A,E,M,k,N,j,q){var X=new e.ARRAY_TYPE(8);X[0]=A,X[1]=E,X[2]=M,X[3]=k;var W=.5*N,J=.5*j,ne=.5*q;return X[4]=W*k+J*M-ne*E,X[5]=J*k+ne*A-W*M,X[6]=ne*k+W*E-J*A,X[7]=-W*A-J*E-ne*M,X},vt.fromRotationTranslation=p,vt.fromTranslation=function(A,E){return A[0]=0,A[1]=0,A[2]=0,A[3]=1,A[4]=.5*E[0],A[5]=.5*E[1],A[6]=.5*E[2],A[7]=0,A},vt.fromRotation=function(A,E){return A[0]=E[0],A[1]=E[1],A[2]=E[2],A[3]=E[3],A[4]=0,A[5]=0,A[6]=0,A[7]=0,A},vt.fromMat4=function(A,E){var M=n.create();a.getRotation(M,E);var k=new e.ARRAY_TYPE(3);return a.getTranslation(k,E),p(A,M,k),A},vt.copy=w,vt.identity=function(A){return A[0]=0,A[1]=0,A[2]=0,A[3]=1,A[4]=0,A[5]=0,A[6]=0,A[7]=0,A},vt.set=function(A,E,M,k,N,j,q,X,W){return A[0]=E,A[1]=M,A[2]=k,A[3]=N,A[4]=j,A[5]=q,A[6]=X,A[7]=W,A},vt.getDual=function(A,E){return A[0]=E[4],A[1]=E[5],A[2]=E[6],A[3]=E[7],A},vt.setDual=function(A,E){return A[4]=E[0],A[5]=E[1],A[6]=E[2],A[7]=E[3],A},vt.getTranslation=function(A,E){var M=E[4],k=E[5],N=E[6],j=E[7],q=-E[0],X=-E[1],W=-E[2],J=E[3];return A[0]=2*(M*J+j*q+k*W-N*X),A[1]=2*(k*J+j*X+N*q-M*W),A[2]=2*(N*J+j*W+M*X-k*q),A},vt.translate=function(A,E,M){var k=E[0],N=E[1],j=E[2],q=E[3],X=.5*M[0],W=.5*M[1],J=.5*M[2],ne=E[4],he=E[5],we=E[6],be=E[7];return A[0]=k,A[1]=N,A[2]=j,A[3]=q,A[4]=q*X+N*J-j*W+ne,A[5]=q*W+j*X-k*J+he,A[6]=q*J+k*W-N*X+we,A[7]=-k*X-N*W-j*J+be,A},vt.rotateX=function(A,E,M){var k=-E[0],N=-E[1],j=-E[2],q=E[3],X=E[4],W=E[5],J=E[6],ne=E[7],he=X*q+ne*k+W*j-J*N,we=W*q+ne*N+J*k-X*j,be=J*q+ne*j+X*N-W*k,ve=ne*q-X*k-W*N-J*j;return n.rotateX(A,E,M),A[4]=he*(q=A[3])+ve*(k=A[0])+we*(j=A[2])-be*(N=A[1]),A[5]=we*q+ve*N+be*k-he*j,A[6]=be*q+ve*j+he*N-we*k,A[7]=ve*q-he*k-we*N-be*j,A},vt.rotateY=function(A,E,M){var k=-E[0],N=-E[1],j=-E[2],q=E[3],X=E[4],W=E[5],J=E[6],ne=E[7],he=X*q+ne*k+W*j-J*N,we=W*q+ne*N+J*k-X*j,be=J*q+ne*j+X*N-W*k,ve=ne*q-X*k-W*N-J*j;return n.rotateY(A,E,M),A[4]=he*(q=A[3])+ve*(k=A[0])+we*(j=A[2])-be*(N=A[1]),A[5]=we*q+ve*N+be*k-he*j,A[6]=be*q+ve*j+he*N-we*k,A[7]=ve*q-he*k-we*N-be*j,A},vt.rotateZ=function(A,E,M){var k=-E[0],N=-E[1],j=-E[2],q=E[3],X=E[4],W=E[5],J=E[6],ne=E[7],he=X*q+ne*k+W*j-J*N,we=W*q+ne*N+J*k-X*j,be=J*q+ne*j+X*N-W*k,ve=ne*q-X*k-W*N-J*j;return n.rotateZ(A,E,M),A[4]=he*(q=A[3])+ve*(k=A[0])+we*(j=A[2])-be*(N=A[1]),A[5]=we*q+ve*N+be*k-he*j,A[6]=be*q+ve*j+he*N-we*k,A[7]=ve*q-he*k-we*N-be*j,A},vt.rotateByQuatAppend=function(A,E,M){var k=M[0],N=M[1],j=M[2],q=M[3],X=E[0],W=E[1],J=E[2],ne=E[3];return A[0]=X*q+ne*k+W*j-J*N,A[1]=W*q+ne*N+J*k-X*j,A[2]=J*q+ne*j+X*N-W*k,A[3]=ne*q-X*k-W*N-J*j,A[4]=(X=E[4])*q+(ne=E[7])*k+(W=E[5])*j-(J=E[6])*N,A[5]=W*q+ne*N+J*k-X*j,A[6]=J*q+ne*j+X*N-W*k,A[7]=ne*q-X*k-W*N-J*j,A},vt.rotateByQuatPrepend=function(A,E,M){var k=E[0],N=E[1],j=E[2],q=E[3],X=M[0],W=M[1],J=M[2],ne=M[3];return A[0]=k*ne+q*X+N*J-j*W,A[1]=N*ne+q*W+j*X-k*J,A[2]=j*ne+q*J+k*W-N*X,A[3]=q*ne-k*X-N*W-j*J,A[4]=k*(ne=M[7])+q*(X=M[4])+N*(J=M[6])-j*(W=M[5]),A[5]=N*ne+q*W+j*X-k*J,A[6]=j*ne+q*J+k*W-N*X,A[7]=q*ne-k*X-N*W-j*J,A},vt.rotateAroundAxis=function(A,E,M,k){if(Math.abs(k)<e.EPSILON)return w(A,E);var N=Math.hypot(M[0],M[1],M[2]);k*=.5;var j=Math.sin(k),q=j*M[0]/N,X=j*M[1]/N,W=j*M[2]/N,J=Math.cos(k),ne=E[0],he=E[1],we=E[2],be=E[3];A[0]=ne*J+be*q+he*W-we*X,A[1]=he*J+be*X+we*q-ne*W,A[2]=we*J+be*W+ne*X-he*q,A[3]=be*J-ne*q-he*X-we*W;var ve=E[4],Be=E[5],Me=E[6],Ue=E[7];return A[4]=ve*J+Ue*q+Be*W-Me*X,A[5]=Be*J+Ue*X+Me*q-ve*W,A[6]=Me*J+Ue*W+ve*X-Be*q,A[7]=Ue*J-ve*q-Be*X-Me*W,A},vt.add=function(A,E,M){return A[0]=E[0]+M[0],A[1]=E[1]+M[1],A[2]=E[2]+M[2],A[3]=E[3]+M[3],A[4]=E[4]+M[4],A[5]=E[5]+M[5],A[6]=E[6]+M[6],A[7]=E[7]+M[7],A},vt.multiply=T,vt.scale=function(A,E,M){return A[0]=E[0]*M,A[1]=E[1]*M,A[2]=E[2]*M,A[3]=E[3]*M,A[4]=E[4]*M,A[5]=E[5]*M,A[6]=E[6]*M,A[7]=E[7]*M,A},vt.lerp=function(A,E,M,k){var N=1-k;return P(E,M)<0&&(k=-k),A[0]=E[0]*N+M[0]*k,A[1]=E[1]*N+M[1]*k,A[2]=E[2]*N+M[2]*k,A[3]=E[3]*N+M[3]*k,A[4]=E[4]*N+M[4]*k,A[5]=E[5]*N+M[5]*k,A[6]=E[6]*N+M[6]*k,A[7]=E[7]*N+M[7]*k,A},vt.invert=function(A,E){var M=C(E);return A[0]=-E[0]/M,A[1]=-E[1]/M,A[2]=-E[2]/M,A[3]=E[3]/M,A[4]=-E[4]/M,A[5]=-E[5]/M,A[6]=-E[6]/M,A[7]=E[7]/M,A},vt.conjugate=function(A,E){return A[0]=-E[0],A[1]=-E[1],A[2]=-E[2],A[3]=E[3],A[4]=-E[4],A[5]=-E[5],A[6]=-E[6],A[7]=E[7],A},vt.normalize=function(A,E){var M=C(E);if(M>0){M=Math.sqrt(M);var k=E[0]/M,N=E[1]/M,j=E[2]/M,q=E[3]/M,X=E[4],W=E[5],J=E[6],ne=E[7],he=k*X+N*W+j*J+q*ne;A[0]=k,A[1]=N,A[2]=j,A[3]=q,A[4]=(X-k*he)/M,A[5]=(W-N*he)/M,A[6]=(J-j*he)/M,A[7]=(ne-q*he)/M}return A},vt.str=function(A){return"quat2("+A[0]+", "+A[1]+", "+A[2]+", "+A[3]+", "+A[4]+", "+A[5]+", "+A[6]+", "+A[7]+")"},vt.exactEquals=function(A,E){return A[0]===E[0]&&A[1]===E[1]&&A[2]===E[2]&&A[3]===E[3]&&A[4]===E[4]&&A[5]===E[5]&&A[6]===E[6]&&A[7]===E[7]},vt.equals=function(A,E){var M=A[0],k=A[1],N=A[2],j=A[3],q=A[4],X=A[5],W=A[6],J=A[7],ne=E[0],he=E[1],we=E[2],be=E[3],ve=E[4],Be=E[5],Me=E[6],Ue=E[7];return Math.abs(M-ne)<=e.EPSILON*Math.max(1,Math.abs(M),Math.abs(ne))&&Math.abs(k-he)<=e.EPSILON*Math.max(1,Math.abs(k),Math.abs(he))&&Math.abs(N-we)<=e.EPSILON*Math.max(1,Math.abs(N),Math.abs(we))&&Math.abs(j-be)<=e.EPSILON*Math.max(1,Math.abs(j),Math.abs(be))&&Math.abs(q-ve)<=e.EPSILON*Math.max(1,Math.abs(q),Math.abs(ve))&&Math.abs(X-Be)<=e.EPSILON*Math.max(1,Math.abs(X),Math.abs(Be))&&Math.abs(W-Me)<=e.EPSILON*Math.max(1,Math.abs(W),Math.abs(Me))&&Math.abs(J-Ue)<=e.EPSILON*Math.max(1,Math.abs(J),Math.abs(Ue))},vt.sqrLen=vt.squaredLength=vt.len=vt.length=vt.dot=vt.mul=vt.setReal=vt.getReal=void 0;var e=c(le()),n=c(gt()),a=c(rt());function d(A){if(typeof WeakMap!="function")return null;var E=new WeakMap,M=new WeakMap;return(d=function(k){return k?M:E})(A)}function c(A,E){if(A&&A.__esModule)return A;if(A===null||s(A)!=="object"&&typeof A!="function")return{default:A};var M=d(E);if(M&&M.has(A))return M.get(A);var k={},N=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var j in A)if(j!=="default"&&Object.prototype.hasOwnProperty.call(A,j)){var q=N?Object.getOwnPropertyDescriptor(A,j):null;q&&(q.get||q.set)?Object.defineProperty(k,j,q):k[j]=A[j]}return k.default=A,M&&M.set(A,k),k}function p(A,E,M){var k=.5*M[0],N=.5*M[1],j=.5*M[2],q=E[0],X=E[1],W=E[2],J=E[3];return A[0]=q,A[1]=X,A[2]=W,A[3]=J,A[4]=k*J+N*W-j*X,A[5]=N*J+j*q-k*W,A[6]=j*J+k*X-N*q,A[7]=-k*q-N*X-j*W,A}function w(A,E){return A[0]=E[0],A[1]=E[1],A[2]=E[2],A[3]=E[3],A[4]=E[4],A[5]=E[5],A[6]=E[6],A[7]=E[7],A}function T(A,E,M){var k=E[0],N=E[1],j=E[2],q=E[3],X=M[4],W=M[5],J=M[6],ne=M[7],he=E[4],we=E[5],be=E[6],ve=E[7],Be=M[0],Me=M[1],Ue=M[2],Ye=M[3];return A[0]=k*Ye+q*Be+N*Ue-j*Me,A[1]=N*Ye+q*Me+j*Be-k*Ue,A[2]=j*Ye+q*Ue+k*Me-N*Be,A[3]=q*Ye-k*Be-N*Me-j*Ue,A[4]=k*ne+q*X+N*J-j*W+he*Ye+ve*Be+we*Ue-be*Me,A[5]=N*ne+q*W+j*X-k*J+we*Ye+ve*Me+be*Be-he*Ue,A[6]=j*ne+q*J+k*W-N*X+be*Ye+ve*Ue+he*Me-we*Be,A[7]=q*ne-k*X-N*W-j*J+ve*Ye-he*Be-we*Me-be*Ue,A}vt.getReal=n.copy,vt.setReal=n.copy,vt.mul=T;var P=n.dot;vt.dot=P;var x=n.length;vt.length=x,vt.len=x;var C=n.squaredLength;return vt.squaredLength=C,vt.sqrLen=C,vt}var je,it,Mt={};function Ot(){if(je)return Mt;function s(E){return s=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(M){return typeof M}:function(M){return M&&typeof Symbol=="function"&&M.constructor===Symbol&&M!==Symbol.prototype?"symbol":typeof M},s(E)}je=1,Object.defineProperty(Mt,"__esModule",{value:!0}),Mt.create=a,Mt.clone=function(E){var M=new e.ARRAY_TYPE(2);return M[0]=E[0],M[1]=E[1],M},Mt.fromValues=function(E,M){var k=new e.ARRAY_TYPE(2);return k[0]=E,k[1]=M,k},Mt.copy=function(E,M){return E[0]=M[0],E[1]=M[1],E},Mt.set=function(E,M,k){return E[0]=M,E[1]=k,E},Mt.add=function(E,M,k){return E[0]=M[0]+k[0],E[1]=M[1]+k[1],E},Mt.subtract=d,Mt.multiply=c,Mt.divide=p,Mt.ceil=function(E,M){return E[0]=Math.ceil(M[0]),E[1]=Math.ceil(M[1]),E},Mt.floor=function(E,M){return E[0]=Math.floor(M[0]),E[1]=Math.floor(M[1]),E},Mt.min=function(E,M,k){return E[0]=Math.min(M[0],k[0]),E[1]=Math.min(M[1],k[1]),E},Mt.max=function(E,M,k){return E[0]=Math.max(M[0],k[0]),E[1]=Math.max(M[1],k[1]),E},Mt.round=function(E,M){return E[0]=Math.round(M[0]),E[1]=Math.round(M[1]),E},Mt.scale=function(E,M,k){return E[0]=M[0]*k,E[1]=M[1]*k,E},Mt.scaleAndAdd=function(E,M,k,N){return E[0]=M[0]+k[0]*N,E[1]=M[1]+k[1]*N,E},Mt.distance=w,Mt.squaredDistance=T,Mt.length=P,Mt.squaredLength=x,Mt.negate=function(E,M){return E[0]=-M[0],E[1]=-M[1],E},Mt.inverse=function(E,M){return E[0]=1/M[0],E[1]=1/M[1],E},Mt.normalize=function(E,M){var k=M[0],N=M[1],j=k*k+N*N;return j>0&&(j=1/Math.sqrt(j)),E[0]=M[0]*j,E[1]=M[1]*j,E},Mt.dot=function(E,M){return E[0]*M[0]+E[1]*M[1]},Mt.cross=function(E,M,k){var N=M[0]*k[1]-M[1]*k[0];return E[0]=E[1]=0,E[2]=N,E},Mt.lerp=function(E,M,k,N){var j=M[0],q=M[1];return E[0]=j+N*(k[0]-j),E[1]=q+N*(k[1]-q),E},Mt.random=function(E,M){M=M||1;var k=2*e.RANDOM()*Math.PI;return E[0]=Math.cos(k)*M,E[1]=Math.sin(k)*M,E},Mt.transformMat2=function(E,M,k){var N=M[0],j=M[1];return E[0]=k[0]*N+k[2]*j,E[1]=k[1]*N+k[3]*j,E},Mt.transformMat2d=function(E,M,k){var N=M[0],j=M[1];return E[0]=k[0]*N+k[2]*j+k[4],E[1]=k[1]*N+k[3]*j+k[5],E},Mt.transformMat3=function(E,M,k){var N=M[0],j=M[1];return E[0]=k[0]*N+k[3]*j+k[6],E[1]=k[1]*N+k[4]*j+k[7],E},Mt.transformMat4=function(E,M,k){var N=M[0],j=M[1];return E[0]=k[0]*N+k[4]*j+k[12],E[1]=k[1]*N+k[5]*j+k[13],E},Mt.rotate=function(E,M,k,N){var j=M[0]-k[0],q=M[1]-k[1],X=Math.sin(N),W=Math.cos(N);return E[0]=j*W-q*X+k[0],E[1]=j*X+q*W+k[1],E},Mt.angle=function(E,M){var k=E[0],N=E[1],j=M[0],q=M[1],X=Math.sqrt(k*k+N*N)*Math.sqrt(j*j+q*q);return Math.acos(Math.min(Math.max(X&&(k*j+N*q)/X,-1),1))},Mt.zero=function(E){return E[0]=0,E[1]=0,E},Mt.str=function(E){return"vec2("+E[0]+", "+E[1]+")"},Mt.exactEquals=function(E,M){return E[0]===M[0]&&E[1]===M[1]},Mt.equals=function(E,M){var k=E[0],N=E[1],j=M[0],q=M[1];return Math.abs(k-j)<=e.EPSILON*Math.max(1,Math.abs(k),Math.abs(j))&&Math.abs(N-q)<=e.EPSILON*Math.max(1,Math.abs(N),Math.abs(q))},Mt.forEach=Mt.sqrLen=Mt.sqrDist=Mt.dist=Mt.div=Mt.mul=Mt.sub=Mt.len=void 0;var e=function(E,M){if(E&&E.__esModule)return E;if(E===null||s(E)!=="object"&&typeof E!="function")return{default:E};var k=n(void 0);if(k&&k.has(E))return k.get(E);var N={},j=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var q in E)if(q!=="default"&&Object.prototype.hasOwnProperty.call(E,q)){var X=j?Object.getOwnPropertyDescriptor(E,q):null;X&&(X.get||X.set)?Object.defineProperty(N,q,X):N[q]=E[q]}return N.default=E,k&&k.set(E,N),N}(le());function n(E){if(typeof WeakMap!="function")return null;var M=new WeakMap,k=new WeakMap;return(n=function(N){return N?k:M})(E)}function a(){var E=new e.ARRAY_TYPE(2);return e.ARRAY_TYPE!=Float32Array&&(E[0]=0,E[1]=0),E}function d(E,M,k){return E[0]=M[0]-k[0],E[1]=M[1]-k[1],E}function c(E,M,k){return E[0]=M[0]*k[0],E[1]=M[1]*k[1],E}function p(E,M,k){return E[0]=M[0]/k[0],E[1]=M[1]/k[1],E}function w(E,M){return Math.hypot(M[0]-E[0],M[1]-E[1])}function T(E,M){var k=M[0]-E[0],N=M[1]-E[1];return k*k+N*N}function P(E){return Math.hypot(E[0],E[1])}function x(E){var M=E[0],k=E[1];return M*M+k*k}Mt.len=P,Mt.sub=d,Mt.mul=c,Mt.div=p,Mt.dist=w,Mt.sqrDist=T,Mt.sqrLen=x;var C,A=(C=a(),function(E,M,k,N,j,q){var X,W;for(M||(M=2),k||(k=0),W=N?Math.min(N*M+k,E.length):E.length,X=k;X<W;X+=M)C[0]=E[X],C[1]=E[X+1],j(C,C,q),E[X]=C[0],E[X+1]=C[1];return E});return Mt.forEach=A,Mt}function sn(){if(it)return K;function s(E){return s=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(M){return typeof M}:function(M){return M&&typeof Symbol=="function"&&M.constructor===Symbol&&M!==Symbol.prototype?"symbol":typeof M},s(E)}it=1,Object.defineProperty(K,"__esModule",{value:!0}),K.vec4=K.vec3=K.vec2=K.quat2=K.quat=K.mat4=K.mat3=K.mat2d=K.mat2=K.glMatrix=void 0;var e=A(le());K.glMatrix=e;var n=A(ge());K.mat2=n;var a=A(_e());K.mat2d=a;var d=A(nt());K.mat3=d;var c=A(rt());K.mat4=c;var p=A(gt());K.quat=p;var w=A(Ve());K.quat2=w;var T=A(Ot());K.vec2=T;var P=A(Ct());K.vec3=P;var x=A(xt());function C(E){if(typeof WeakMap!="function")return null;var M=new WeakMap,k=new WeakMap;return(C=function(N){return N?k:M})(E)}function A(E,M){if(E&&E.__esModule)return E;if(E===null||s(E)!=="object"&&typeof E!="function")return{default:E};var k=C(M);if(k&&k.has(E))return k.get(E);var N={},j=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var q in E)if(q!=="default"&&Object.prototype.hasOwnProperty.call(E,q)){var X=j?Object.getOwnPropertyDescriptor(E,q):null;X&&(X.get||X.set)?Object.defineProperty(N,q,X):N[q]=E[q]}return N.default=E,k&&k.set(E,N),N}return K.vec4=x,K}var hn,Tn,Ut,bn,Re=sn(),Hr=function(){if(Tn)return hn;function s(e,n,a,d){this.cx=3*e,this.bx=3*(a-e)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*n,this.by=3*(d-n)-this.cy,this.ay=1-this.cy-this.by,this.p1x=e,this.p1y=n,this.p2x=a,this.p2y=d}return Tn=1,hn=s,s.prototype={sampleCurveX:function(e){return((this.ax*e+this.bx)*e+this.cx)*e},sampleCurveY:function(e){return((this.ay*e+this.by)*e+this.cy)*e},sampleCurveDerivativeX:function(e){return(3*this.ax*e+2*this.bx)*e+this.cx},solveCurveX:function(e,n){if(n===void 0&&(n=1e-6),e<0)return 0;if(e>1)return 1;for(var a=e,d=0;d<8;d++){var c=this.sampleCurveX(a)-e;if(Math.abs(c)<n)return a;var p=this.sampleCurveDerivativeX(a);if(Math.abs(p)<1e-6)break;a-=c/p}var w=0,T=1;for(a=e,d=0;d<20&&(c=this.sampleCurveX(a),!(Math.abs(c-e)<n));d++)e>c?w=a:T=a,a=.5*(T-w)+w;return a},solve:function(e,n){return this.sampleCurveY(this.solveCurveX(e,n))}},hn}(),Nr=H(Hr);function Ar(){if(bn)return Ut;function s(e,n){this.x=e,this.y=n}return bn=1,Ut=s,s.prototype={clone:function(){return new s(this.x,this.y)},add:function(e){return this.clone()._add(e)},sub:function(e){return this.clone()._sub(e)},multByPoint:function(e){return this.clone()._multByPoint(e)},divByPoint:function(e){return this.clone()._divByPoint(e)},mult:function(e){return this.clone()._mult(e)},div:function(e){return this.clone()._div(e)},rotate:function(e){return this.clone()._rotate(e)},rotateAround:function(e,n){return this.clone()._rotateAround(e,n)},matMult:function(e){return this.clone()._matMult(e)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(e){return this.x===e.x&&this.y===e.y},dist:function(e){return Math.sqrt(this.distSqr(e))},distSqr:function(e){var n=e.x-this.x,a=e.y-this.y;return n*n+a*a},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(e){return Math.atan2(this.y-e.y,this.x-e.x)},angleWith:function(e){return this.angleWithSep(e.x,e.y)},angleWithSep:function(e,n){return Math.atan2(this.x*n-this.y*e,this.x*e+this.y*n)},_matMult:function(e){var n=e[2]*this.x+e[3]*this.y;return this.x=e[0]*this.x+e[1]*this.y,this.y=n,this},_add:function(e){return this.x+=e.x,this.y+=e.y,this},_sub:function(e){return this.x-=e.x,this.y-=e.y,this},_mult:function(e){return this.x*=e,this.y*=e,this},_div:function(e){return this.x/=e,this.y/=e,this},_multByPoint:function(e){return this.x*=e.x,this.y*=e.y,this},_divByPoint:function(e){return this.x/=e.x,this.y/=e.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var e=this.y;return this.y=this.x,this.x=-e,this},_rotate:function(e){var n=Math.cos(e),a=Math.sin(e),d=a*this.x+n*this.y;return this.x=n*this.x-a*this.y,this.y=d,this},_rotateAround:function(e,n){var a=Math.cos(e),d=Math.sin(e),c=n.y+d*(this.x-n.x)+a*(this.y-n.y);return this.x=n.x+a*(this.x-n.x)-d*(this.y-n.y),this.y=c,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},s.convert=function(e){return e instanceof s?e:Array.isArray(e)?new s(e[0],e[1]):e},Ut}var Ht=H(Ar());function Wr(s,e){if(Array.isArray(s)){if(!Array.isArray(e)||s.length!==e.length)return!1;for(let n=0;n<s.length;n++)if(!Wr(s[n],e[n]))return!1;return!0}if(typeof s=="object"&&s!==null&&e!==null){if(typeof e!="object"||Object.keys(s).length!==Object.keys(e).length)return!1;for(const n in s)if(!Wr(s[n],e[n]))return!1;return!0}return s===e}const ar=Math.PI/180,pi=180/Math.PI;function $n(s){return s*ar}function Gr(s){return s*pi}const gi=[[0,0],[1,0],[1,1],[0,1]];function Pr(s){if(s<=0)return 0;if(s>=1)return 1;const e=s*s,n=e*s;return 4*(s<.5?n:3*(s-e)+n-.75)}function ci(s,e,n,a){const d=new Nr(s,e,n,a);return function(c){return d.solve(c)}}const Un=ci(.25,.1,.25,1);function yn(s,e,n){return Math.min(n,Math.max(e,s))}function Ir(s,e,n){return(n=yn((n-s)/(e-s),0,1))*n*(3-2*n)}function ui(s,e,n){const a=n-e,d=((s-e)%a+a)%a+e;return d===e?n:d}function _i(s,e,n){if(!s.length)return n(null,[]);let a=s.length;const d=new Array(s.length);let c=null;s.forEach((p,w)=>{e(p,(T,P)=>{T&&(c=T),d[w]=P,--a==0&&n(c,d)})})}function Lr(s,...e){for(const n of e)for(const a in n)s[a]=n[a];return s}let yi=1;function oi(){return yi++}function qi(s){return s<=1?1:Math.pow(2,Math.ceil(Math.log(s)/Math.LN2))}function Ci(s,e){s.forEach(n=>{e[n]&&(e[n]=e[n].bind(e))})}function mr(s,e){return s.indexOf(e,s.length-e.length)!==-1}function dr(s,e,n){const a={};for(const d in s)a[d]=e.call(this,s[d],d,s);return a}function wo(s,e,n){const a={};for(const d in s)e.call(this,s[d],d,s)&&(a[d]=s[d]);return a}function Zi(s){return Array.isArray(s)?s.map(Zi):typeof s=="object"&&s?dr(s,Zi):s}const ko={};function nr(s){ko[s]||(typeof console<"u"&&console.warn(s),ko[s]=!0)}function ss(s,e,n){return(n.y-s.y)*(e.x-s.x)>(e.y-s.y)*(n.x-s.x)}function Vs(s){let e=0;for(let n,a,d=0,c=s.length,p=c-1;d<c;p=d++)n=s[d],a=s[p],e+=(a.x-n.x)*(n.y+a.y);return e}function io([s,e,n]){const a=$n(e+90),d=$n(n);return{x:s*Math.cos(a)*Math.sin(d),y:s*Math.sin(a)*Math.sin(d),z:s*Math.cos(d),azimuthal:e,polar:n}}function as(){return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope}function ls(s){const e={};if(s.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(n,a,d,c)=>{const p=d||c;return e[a]=!p||p.toLowerCase(),""}),e["max-age"]){const n=parseInt(e["max-age"],10);isNaN(n)?delete e["max-age"]:e["max-age"]=n}return e}let Ao=null;function Ts(s,e){return[s[4*e],s[4*e+1],s[4*e+2],s[4*e+3]]}function oo(s,e,n,a){for(;e<n;){const d=e+n>>1;s[d]<a?e=d+1:n=d}return e}function bt(s,e,n,a){for(;e<n;){const d=e+n>>1;s[d]<=a?e=d+1:n=d}return e}function oe(s){return s>0?1/(1.001-s):1+s}function de(s){return s>0?1-1/(1.001-s):-s}const Se={API_URL:"https://api.mapbox.com",get API_URL_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i},get API_TILEJSON_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/v[0-9]*\/.*\.json.*$)/i},get API_SPRITE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*\/sprite.*\..*$)/i},get API_FONTS_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/fonts\/v[0-9]*\/)(.*\.pbf.*$)/i},get API_STYLE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*$)/i},get API_CDN_URL_REGEX(){return/^((https?:)?\/\/)?api\.mapbox\.c(n|om)(\/mapbox-gl-js\/)(.*$)/i},get EVENTS_URL(){if(!Se.API_URL)return null;try{const s=new URL(Se.API_URL);return s.hostname==="api.mapbox.cn"?"https://events.mapbox.cn/events/v2":s.hostname==="api.mapbox.com"?"https://events.mapbox.com/events/v2":null}catch{return null}},SESSION_PATH:"/map-sessions/v1",FEEDBACK_URL:"https://apps.mapbox.com/feedback",TILE_URL_VERSION:"v4",RASTER_URL_PREFIX:"raster/v1",RASTERARRAYS_URL_PREFIX:"rasterarrays/v1",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,DEFAULT_STYLE:"mapbox://styles/mapbox/standard",MAX_PARALLEL_IMAGE_REQUESTS:16,DRACO_URL:"https://api.mapbox.com/mapbox-gl-js/draco_decoder_gltf_v1.5.6.wasm",MESHOPT_URL:"https://api.mapbox.com/mapbox-gl-js/meshopt_base_v0.20.wasm",MESHOPT_SIMD_URL:"https://api.mapbox.com/mapbox-gl-js/meshopt_simd_v0.20.wasm",GLYPHS_URL:"mapbox://fonts/mapbox/{fontstack}/{range}.pbf",TILES3D_URL_PREFIX:"3dtiles/v1"};function He(s){return Se.API_URL_REGEX.test(s)}function $e(s){return Se.API_SPRITE_REGEX.test(s)}let et,_t,Ke,mt,wt,Tt;function Jt(){return et==null&&(et=self.OffscreenCanvas&&new OffscreenCanvas(1,1).getContext("2d")&&typeof self.createImageBitmap=="function"),et}const fn={now:()=>mt!==void 0?mt:performance.now(),setNow(s){mt=s},restoreNow(){mt=void 0},frame(s){const e=requestAnimationFrame(s);return{cancel:()=>cancelAnimationFrame(e)}},getImageData(s,e=0){const{width:n,height:a}=s;wt||(wt=document.createElement("canvas"));const d=wt.getContext("2d",{willReadFrequently:!0});if(!d)throw new Error("failed to create canvas 2d context");return(n>wt.width||a>wt.height)&&(wt.width=n,wt.height=a),d.clearRect(-e,-e,n+2*e,a+2*e),d.drawImage(s,0,0,n,a),d.getImageData(-e,-e,n+2*e,a+2*e)},resolveURL:s=>(_t||(_t=document.createElement("a")),_t.href=s,_t.href),get devicePixelRatio(){return window.devicePixelRatio},get prefersReducedMotion(){return!!window.matchMedia&&(Ke==null&&(Ke=window.matchMedia("(prefers-reduced-motion: reduce)")),Ke.matches)},hasCanvasFingerprintNoise(){if(Tt!==void 0)return Tt;if(!Jt())return Tt=!1,!1;const s=new OffscreenCanvas(85,1),e=s.getContext("2d",{willReadFrequently:!0});let n=0;for(let d=0;d<s.width;++d)e.fillStyle=`rgba(${n++},${n++},${n++}, 255)`,e.fillRect(d,0,1,1);const a=e.getImageData(0,0,s.width,s.height);n=0;for(let d=0;d<a.data.length;++d)if(d%4!=3&&n++!==a.data[d])return Tt=!0,!0;return Tt=!1,!1}};function on(s,e){const n=s.indexOf("?");if(n<0)return`${s}?${new URLSearchParams(e).toString()}`;const a=new URLSearchParams(s.slice(n));for(const d in e)a.set(d,e[d]);return`${s.slice(0,n)}?${a.toString()}`}function En(s,e={persistentParams:[]}){const n=s.indexOf("?");if(n<0)return s;const a=new URLSearchParams,d=new URLSearchParams(s.slice(n));for(const p of e.persistentParams){const w=d.get(p);w&&a.set(p,w)}const c=a.toString();return`${s.slice(0,n)}${c.length>0?`?${c}`:""}`}const zn="mapbox-tiles";let Rn=500,In=50;const kr=["language","worldview","jobid"];let lr,Hn;function Br(){try{return caches}catch{}}function ti(){const s=Br();s&&lr==null&&(lr=s.open(zn))}let zr=1/0;const po={supported:!1,testSupport:function(s){!zs&&ao&&(cs?Xs(s):so=s)}};let so,ao,zs=!1,cs=!1;const Al=typeof self<"u"?self:{};function Xs(s){const e=s.createTexture();s.bindTexture(s.TEXTURE_2D,e);try{if(s.texImage2D(s.TEXTURE_2D,0,s.RGBA,s.RGBA,s.UNSIGNED_BYTE,ao),s.isContextLost())return;po.supported=!0}catch{}s.deleteTexture(e),zs=!0}Al.document&&(ao=Al.document.createElement("img"),ao.onload=function(){so&&Xs(so),so=null,cs=!0},ao.onerror=function(){zs=!0,so=null},ao.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");const lo={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Iconset:"Iconset",Image:"Image",Model:"Model"};typeof Object.freeze=="function"&&Object.freeze(lo);class Il extends Error{constructor(e,n,a){n===401&&He(a)&&(e+=": you may have provided an invalid Mapbox access token. See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes"),super(e),this.status=n,this.url=a}toString(){return`${this.name}: ${this.message} (${this.status}): ${this.url}`}}const zo=as()?()=>self.worker&&self.worker.referrer:()=>(location.protocol==="blob:"?parent:self).location.href,$o=function(s,e){if(!(/^file:/.test(n=s.url)||/^file:/.test(zo())&&!/^\w+:/.test(n))){if(self.fetch&&self.Request&&self.AbortController&&Request.prototype.hasOwnProperty("signal"))return function(a,d){const c=new AbortController,p=new Request(a.url,{method:a.method||"GET",body:a.body,credentials:a.credentials,headers:a.headers,referrer:zo(),referrerPolicy:a.referrerPolicy,signal:c.signal});let w=!1,T=!1;const P=(x=p.url).indexOf("sku=")>0&&He(x);var x;a.type==="json"&&p.headers.set("Accept","application/json");const C=(E,M,k)=>{if(T)return;if(E&&E.message!=="SecurityError"&&nr(E.toString()),M&&k)return A(M);const N=Date.now();fetch(p).then(j=>{if(j.ok){const q=P?j.clone():null;return A(j,q,N)}return d(new Il(j.statusText,j.status,a.url))}).catch(j=>{j.name!=="AbortError"&&d(new Error(`${j.message} ${a.url}`))})},A=(E,M,k)=>{(a.type==="arrayBuffer"?E.arrayBuffer():a.type==="json"?E.json():E.text()).then(N=>{T||(M&&k&&function(j,q,X){if(ti(),lr==null)return;const W=ls(q.headers.get("Cache-Control")||"");if(W["no-store"])return;const J={status:q.status,statusText:q.statusText,headers:new Headers};q.headers.forEach((we,be)=>J.headers.set(be,we)),W["max-age"]&&J.headers.set("Expires",new Date(X+1e3*W["max-age"]).toUTCString());const ne=J.headers.get("Expires");if(!ne||new Date(ne).getTime()-X<42e4)return;let he=En(j.url,{persistentParams:kr});if(q.status===206){const we=j.headers.get("Range");if(!we)return;J.status=200,he=on(he,{range:we})}(function(we,be){if(Hn===void 0)try{new Response(new ReadableStream),Hn=!0}catch{Hn=!1}Hn?be(we.body):we.blob().then(be)})(q,we=>{const be=new Response((ve=q.status)!==200&&ve!==404&&[101,103,204,205,304].includes(ve)?null:we,J);var ve;ti(),lr!=null&&lr.then(Be=>Be.put(he,be)).catch(Be=>nr(Be.message))})}(p,M,k),w=!0,d(null,N,E.headers.get("Cache-Control"),E.headers.get("Expires")))}).catch(N=>{T||d(new Error(N.message))})};return P?function(E,M){if(ti(),lr==null)return M(null);lr.then(k=>{let N=En(E.url,{persistentParams:kr});const j=E.headers.get("Range");j&&(N=on(N,{range:j})),k.match(N).then(q=>{const X=function(W){if(!W)return!1;const J=new Date(W.headers.get("Expires")||0),ne=ls(W.headers.get("Cache-Control")||"");return J>Date.now()&&!ne["no-cache"]}(q);k.delete(N),X&&k.put(N,q.clone()),M(null,q,X)}).catch(M)}).catch(M)}(p,C):C(null,null),{cancel:()=>{T=!0,w||c.abort()}}}(s,e);if(as()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",s,e,void 0,!0)}var n;return function(a,d){const c=new XMLHttpRequest;c.open(a.method||"GET",a.url,!0),a.type==="arrayBuffer"&&(c.responseType="arraybuffer");for(const p in a.headers)c.setRequestHeader(p,a.headers[p]);return a.type==="json"&&(c.responseType="text",c.setRequestHeader("Accept","application/json")),c.withCredentials=a.credentials==="include",c.onerror=()=>{d(new Error(c.statusText))},c.onload=()=>{if((c.status>=200&&c.status<300||c.status===0)&&c.response!==null){let p=c.response;if(a.type==="json")try{p=JSON.parse(c.response)}catch(w){return d(w)}d(null,p,c.getResponseHeader("Cache-Control"),c.getResponseHeader("Expires"))}else d(new Il(c.statusText,c.status,a.url))},c.send(a.body),{cancel:()=>c.abort()}}(s,e)},Yo=function(s,e){return $o(Lr(s,{type:"arrayBuffer"}),e)};function tl(s){const e=document.createElement("a");return e.href=s,e.protocol===location.protocol&&e.host===location.host}const ya="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let co,So;co=[],So=0;const Cs=function(s,e){if(po.supported&&(s.headers||(s.headers={}),s.headers.accept="image/webp,*/*"),So>=Se.MAX_PARALLEL_IMAGE_REQUESTS){const c={requestParameters:s,callback:e,cancelled:!1,cancel(){this.cancelled=!0}};return co.push(c),c}So++;let n=!1;const a=()=>{if(!n)for(n=!0,So--;co.length&&So<Se.MAX_PARALLEL_IMAGE_REQUESTS;){const c=co.shift(),{requestParameters:p,callback:w,cancelled:T}=c;T||(c.cancel=Cs(p,w).cancel)}},d=Yo(s,(c,p,w,T)=>{a(),c?e(c):p&&(self.createImageBitmap?function(P,x){const C=new Blob([new Uint8Array(P)],{type:"image/png"});createImageBitmap(C).then(A=>{x(null,A)}).catch(A=>{x(new Error(`Could not load image because of ${A.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})}(p,(P,x)=>e(P,x,w,T)):function(P,x){const C=new Image;C.onload=()=>{x(null,C),URL.revokeObjectURL(C.src),C.onload=null,requestAnimationFrame(()=>{C.src=ya})},C.onerror=()=>x(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const A=new Blob([new Uint8Array(P)],{type:"image/png"});C.src=P.byteLength?URL.createObjectURL(A):ya}(p,(P,x)=>e(P,x,w,T)))});return{cancel:()=>{d.cancel(),a()}}};var Ms,Vo,us,mo={exports:{}},Io={exports:{}},Uo={exports:{}},va=function(){if(us)return mo.exports;us=1;var s=(Ms||(Ms=1,Io.exports=function(n,a){var d,c,p,w,T,P,x,C;for(c=n.length-(d=3&n.length),p=a,T=3432918353,P=461845907,C=0;C<c;)x=255&n.charCodeAt(C)|(255&n.charCodeAt(++C))<<8|(255&n.charCodeAt(++C))<<16|(255&n.charCodeAt(++C))<<24,++C,p=27492+(65535&(w=5*(65535&(p=(p^=x=(65535&(x=(x=(65535&x)*T+(((x>>>16)*T&65535)<<16)&4294967295)<<15|x>>>17))*P+(((x>>>16)*P&65535)<<16)&4294967295)<<13|p>>>19))+((5*(p>>>16)&65535)<<16)&4294967295))+((58964+(w>>>16)&65535)<<16);switch(x=0,d){case 3:x^=(255&n.charCodeAt(C+2))<<16;case 2:x^=(255&n.charCodeAt(C+1))<<8;case 1:p^=x=(65535&(x=(x=(65535&(x^=255&n.charCodeAt(C)))*T+(((x>>>16)*T&65535)<<16)&4294967295)<<15|x>>>17))*P+(((x>>>16)*P&65535)<<16)&4294967295}return p^=n.length,p=2246822507*(65535&(p^=p>>>16))+((2246822507*(p>>>16)&65535)<<16)&4294967295,p=3266489909*(65535&(p^=p>>>13))+((3266489909*(p>>>16)&65535)<<16)&4294967295,(p^=p>>>16)>>>0}),Io.exports),e=(Vo||(Vo=1,Uo.exports=function(n,a){for(var d,c=n.length,p=a^c,w=0;c>=4;)d=1540483477*(65535&(d=255&n.charCodeAt(w)|(255&n.charCodeAt(++w))<<8|(255&n.charCodeAt(++w))<<16|(255&n.charCodeAt(++w))<<24))+((1540483477*(d>>>16)&65535)<<16),p=1540483477*(65535&p)+((1540483477*(p>>>16)&65535)<<16)^(d=1540483477*(65535&(d^=d>>>24))+((1540483477*(d>>>16)&65535)<<16)),c-=4,++w;switch(c){case 3:p^=(255&n.charCodeAt(w+2))<<16;case 2:p^=(255&n.charCodeAt(w+1))<<8;case 1:p=1540483477*(65535&(p^=255&n.charCodeAt(w)))+((1540483477*(p>>>16)&65535)<<16)}return p=1540483477*(65535&(p^=p>>>13))+((1540483477*(p>>>16)&65535)<<16),(p^=p>>>15)>>>0}),Uo.exports);return mo.exports=s,mo.exports.murmur3=s,mo.exports.murmur2=e,mo.exports}(),xa=H(va);class hi{constructor(e,...n){Lr(this,n[0]||{}),this.type=e}}class As extends hi{constructor(e,n={}){super("error",Lr({error:e},n))}}function nl(s,e,n){n[s]&&n[s].indexOf(e)!==-1||(n[s]=n[s]||[],n[s].push(e))}function Oa(s,e,n){if(n&&n[s]){const a=n[s].indexOf(e);a!==-1&&n[s].splice(a,1)}}class go{on(e,n){return this._listeners=this._listeners||{},nl(e,n,this._listeners),this}off(e,n){return Oa(e,n,this._listeners),Oa(e,n,this._oneTimeListeners),this}once(e,n){return n?(this._oneTimeListeners=this._oneTimeListeners||{},nl(e,n,this._oneTimeListeners),this):new Promise(a=>this.once(e,a))}fire(e,n){const a=typeof e=="string"?new hi(e,n):e,d=a.type;if(this.listens(d)){a.target=this;const c=this._listeners&&this._listeners[d]?this._listeners[d].slice():[];for(const T of c)T.call(this,a);const p=this._oneTimeListeners&&this._oneTimeListeners[d]?this._oneTimeListeners[d].slice():[];for(const T of p)Oa(d,T,this._oneTimeListeners),T.call(this,a);const w=this._eventedParent;w&&(Lr(a,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),w.fire(a))}else a instanceof As&&console.error(a.error);return this}listens(e){return!!(this._listeners&&this._listeners[e]&&this._listeners[e].length>0||this._oneTimeListeners&&this._oneTimeListeners[e]&&this._oneTimeListeners[e].length>0||this._eventedParent&&this._eventedParent.listens(e))}setEventedParent(e,n){return this._eventedParent=e,this._eventedParentData=n,this}}var Ls,Ys={},Da=function(){if(Ls)return Ys;Ls=1;var s={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function e(c){return(c=Math.round(c))<0?0:c>255?255:c}function n(c){return e(c[c.length-1]==="%"?parseFloat(c)/100*255:parseInt(c))}function a(c){return(p=c[c.length-1]==="%"?parseFloat(c)/100:parseFloat(c))<0?0:p>1?1:p;var p}function d(c,p,w){return w<0?w+=1:w>1&&(w-=1),6*w<1?c+(p-c)*w*6:2*w<1?p:3*w<2?c+(p-c)*(2/3-w)*6:c}try{Ys.parseCSSColor=function(c){var p,w=c.replace(/ /g,"").toLowerCase();if(w in s)return s[w].slice();if(w[0]==="#")return w.length===4?(p=parseInt(w.substr(1),16))>=0&&p<=4095?[(3840&p)>>4|(3840&p)>>8,240&p|(240&p)>>4,15&p|(15&p)<<4,1]:null:w.length===7&&(p=parseInt(w.substr(1),16))>=0&&p<=16777215?[(16711680&p)>>16,(65280&p)>>8,255&p,1]:null;var T=w.indexOf("("),P=w.indexOf(")");if(T!==-1&&P+1===w.length){var x=w.substr(0,T),C=w.substr(T+1,P-(T+1)).split(","),A=1;switch(x){case"rgba":if(C.length!==4)return null;A=a(C.pop());case"rgb":return C.length!==3?null:[n(C[0]),n(C[1]),n(C[2]),A];case"hsla":if(C.length!==4)return null;A=a(C.pop());case"hsl":if(C.length!==3)return null;var E=(parseFloat(C[0])%360+360)%360/360,M=a(C[1]),k=a(C[2]),N=k<=.5?k*(M+1):k+M-k*M,j=2*k-N;return[e(255*d(j,N,E+1/3)),e(255*d(j,N,E)),e(255*d(j,N,E-1/3)),A];default:return null}}return null}}catch{}return Ys}();class ir{constructor(e,n,a,d=1){this.r=e,this.g=n,this.b=a,this.a=d}static parse(e){if(!e)return;if(e instanceof ir)return e;if(typeof e!="string")return;const n=Da.parseCSSColor(e);return n?new ir(n[0]/255*n[3],n[1]/255*n[3],n[2]/255*n[3],n[3]):void 0}toStringPremultipliedAlpha(){const[e,n,a,d]=this.a===0?[0,0,0,0]:[255*this.r/this.a,255*this.g/this.a,255*this.b/this.a,this.a];return`rgba(${Math.round(e)},${Math.round(n)},${Math.round(a)},${d})`}toString(){const[e,n,a,d]=[this.r,this.g,this.b,this.a];return`rgba(${Math.round(255*e)},${Math.round(255*n)},${Math.round(255*a)},${d})`}toRenderColor(e){const{r:n,g:a,b:d,a:c}=this;return new hs(e,n,a,d,c)}clone(){return new ir(this.r,this.g,this.b,this.a)}}class hs{constructor(e,n,a,d,c){if(e){const p=e.image.height,w=p*p;n=c===0?0:n/c*(p-1),a=c===0?0:a/c*(p-1),d=c===0?0:d/c*(p-1);const T=Math.floor(n),P=Math.floor(a),x=Math.floor(d),C=Math.ceil(n),A=Math.ceil(a),E=Math.ceil(d),M=n-T,k=a-P,N=d-x,j=e.image.data,q=4*(T+P*w+x*p),X=4*(T+P*w+E*p),W=4*(T+A*w+x*p),J=4*(T+A*w+E*p),ne=4*(C+P*w+x*p),he=4*(C+P*w+E*p),we=4*(C+A*w+x*p),be=4*(C+A*w+E*p);if(q<0||be>=j.length)throw new Error("out of range");this.r=kn(kn(kn(j[q],j[X],N),kn(j[W],j[J],N),k),kn(kn(j[ne],j[he],N),kn(j[we],j[be],N),k),M)/255*c,this.g=kn(kn(kn(j[q+1],j[X+1],N),kn(j[W+1],j[J+1],N),k),kn(kn(j[ne+1],j[he+1],N),kn(j[we+1],j[be+1],N),k),M)/255*c,this.b=kn(kn(kn(j[q+2],j[X+2],N),kn(j[W+2],j[J+2],N),k),kn(kn(j[ne+2],j[he+2],N),kn(j[we+2],j[be+2],N),k),M)/255*c,this.a=c}else this.r=n,this.g=a,this.b=d,this.a=c}toArray(){const{r:e,g:n,b:a,a:d}=this;return d===0?[0,0,0,0]:[255*e/d,255*n/d,255*a/d,d]}toHslaArray(){if(this.a===0)return[0,0,0,0];const{r:e,g:n,b:a,a:d}=this,c=Math.min(Math.max(e/d,0),1),p=Math.min(Math.max(n/d,0),1),w=Math.min(Math.max(a/d,0),1),T=Math.min(c,p,w),P=Math.max(c,p,w),x=(T+P)/2;if(T===P)return[0,0,100*x,d];const C=P-T,A=x>.5?C/(2-P-T):C/(P+T);let E=0;return P===c?E=(p-w)/C+(p<w?6:0):P===p?E=(w-c)/C+2:P===w&&(E=(c-p)/C+4),E*=60,[Math.min(Math.max(E,0),360),Math.min(Math.max(100*A,0),100),Math.min(Math.max(100*x,0),100),d]}toArray01(){const{r:e,g:n,b:a,a:d}=this;return d===0?[0,0,0,0]:[e/d,n/d,a/d,d]}toArray01Scaled(e){const{r:n,g:a,b:d,a:c}=this;return c===0?[0,0,0]:[n/c*e,a/c*e,d/c*e]}toArray01PremultipliedAlpha(){const{r:e,g:n,b:a,a:d}=this;return[e,n,a,d]}toArray01Linear(){const{r:e,g:n,b:a,a:d}=this;return d===0?[0,0,0,0]:[Math.pow(e/d,2.2),Math.pow(n/d,2.2),Math.pow(a/d,2.2),d]}}function kn(s,e,n){return s*(1-n)+e*n}function Po(s,e,n){return s.map((a,d)=>kn(a,e[d],n))}ir.black=new ir(0,0,0,1),ir.white=new ir(1,1,1,1),ir.transparent=new ir(0,0,0,0),ir.red=new ir(1,0,0,1),ir.blue=new ir(0,0,1,1);var yr=Object.freeze({__proto__:null,array:Po,color:function(s,e,n){return new ir(kn(s.r,e.r,n),kn(s.g,e.g,n),kn(s.b,e.b,n),kn(s.a,e.a,n))},number:kn});function ia(s,...e){for(const n of e)for(const a in n)s[a]=n[a];return s}class Eo extends Error{constructor(e,n){super(n),this.message=n,this.key=e}}class Fa{constructor(e,n=[]){this.parent=e,this.bindings={};for(const[a,d]of n)this.bindings[a]=d}concat(e){return new Fa(this,e)}get(e){if(this.bindings[e])return this.bindings[e];if(this.parent)return this.parent.get(e);throw new Error(`${e} not found in scope.`)}has(e){return!!this.bindings[e]||!!this.parent&&this.parent.has(e)}}const Kn={kind:"null"},qt={kind:"number"},Jn={kind:"string"},Xn={kind:"boolean"},ni={kind:"color"},ba={kind:"object"},wr={kind:"value"},rl={kind:"collator"},ds={kind:"formatted"},oa={kind:"resolvedImage"};function Lo(s,e){return{kind:"array",itemType:s,N:e}}function wi(s){if(s.kind==="array"){const e=wi(s.itemType);return typeof s.N=="number"?`array<${e}, ${s.N}>`:s.itemType.kind==="value"?"array":`array<${e}>`}return s.kind}const Pd=[Kn,qt,Jn,Xn,ni,ds,ba,Lo(wr),oa];function il(s,e){if(e.kind==="error")return null;if(s.kind==="array"){if(e.kind==="array"&&(e.N===0&&e.itemType.kind==="value"||!il(s.itemType,e.itemType))&&(typeof s.N!="number"||s.N===e.N))return null}else{if(s.kind===e.kind)return null;if(s.kind==="value"){for(const n of Pd)if(!il(n,e))return null}}return`Expected ${wi(s)} but found ${wi(e)} instead.`}function Yl(s,e){return e.some(n=>n.kind===s.kind)}function Kl(s,e){return e.some(n=>n==="null"?s===null:n==="array"?Array.isArray(s):n==="object"?s&&!Array.isArray(s)&&typeof s=="object":n===typeof s)}class Eu{constructor(e,n,a){this.sensitivity=e?n?"variant":"case":n?"accent":"base",this.locale=a,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(e,n){return this.collator.compare(e,n)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class Os{constructor(e,n,a,d,c){this.text=e.normalize?e.normalize():e,this.image=n,this.scale=a,this.fontStack=d,this.textColor=c}}class fs{constructor(e){this.sections=e}static fromString(e){return new fs([new Os(e,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(e=>e.text.length!==0||e.image&&e.image.namePrimary)}static factory(e){return e instanceof fs?e:fs.fromString(e)}toString(){return this.sections.length===0?"":this.sections.map(e=>e.text).join("")}serialize(){const e=["format"];for(const n of this.sections){if(n.image){e.push(["image",n.image.namePrimary]);continue}e.push(n.text);const a={};n.fontStack&&(a["text-font"]=["literal",n.fontStack.split(",")]),n.scale&&(a["font-scale"]=n.scale),n.textColor&&(a["text-color"]=["rgba"].concat(n.textColor.toRenderColor(null).toArray())),e.push(a)}return e}}class sa{constructor(e,n){if(this.id=e,this.options=n||{params:{}},this.options.transform){const{a,b:d,c,d:p,e:w,f:T}=this.options.transform;this.options.transform=new DOMMatrix([a,d,c,p,w,T])}else this.options.transform=new DOMMatrix([1,0,0,1,0,0])}static deserializeId(e){return JSON.parse(e).id}static deserializeFromString(e){const n=JSON.parse(e),{a,b:d,c,d:p,e:w,f:T}=n.options.transform;return new DOMMatrix([a,d,c,p,w,T]),new sa(n.id,n.options)}scaleSelf(e){return this.options.transform=this.options.transform.scale(e),this}serialize(){const e={id:this.id};this.options&&(e.options=this.options);const{a:n,b:a,c:d,d:c,e:p,f:w}=this.options.transform;return e.options.transform={a:n,b:a,c:d,d:c,e:p,f:w},JSON.stringify(e)}}class Oo{constructor(e){this.namePrimary=e.namePrimary,e.nameSecondary&&(this.nameSecondary=e.nameSecondary),e.optionsPrimary&&(this.optionsPrimary=e.optionsPrimary),e.optionsSecondary&&(this.optionsSecondary=e.optionsSecondary),this.available=e.available}toString(){return this.namePrimary&&this.nameSecondary?`[${this.namePrimary},${this.nameSecondary}]`:this.namePrimary}getPrimary(){return new sa(this.namePrimary,{params:this.optionsPrimary&&this.optionsPrimary.params||{}})}getSerializedPrimary(){return this.getPrimary().serialize()}getSecondary(){return this.nameSecondary?new sa(this.nameSecondary,{params:this.optionsSecondary&&this.optionsSecondary.params||{}}):null}static from(e){return typeof e=="string"?Oo.build(e):e}static build(e,n,a,d){return e?new Oo({namePrimary:e,nameSecondary:n,optionsPrimary:a,optionsSecondary:d,available:!1}):null}}function ol(s,e,n,a){return typeof s=="number"&&s>=0&&s<=255&&typeof e=="number"&&e>=0&&e<=255&&typeof n=="number"&&n>=0&&n<=255?a===void 0||typeof a=="number"&&a>=0&&a<=1?null:`Invalid rgba value [${[s,e,n,a].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof a=="number"?[s,e,n,a]:[s,e,n]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function sl(s){if(s===null||typeof s=="string"||typeof s=="boolean"||typeof s=="number"||s instanceof ir||s instanceof Eu||s instanceof fs||s instanceof Oo)return!0;if(Array.isArray(s)){for(const e of s)if(!sl(e))return!1;return!0}if(typeof s=="object"){for(const e in s)if(!sl(s[e]))return!1;return!0}return!1}function zi(s){if(s===null)return Kn;if(typeof s=="string")return Jn;if(typeof s=="boolean")return Xn;if(typeof s=="number")return qt;if(s instanceof ir)return ni;if(s instanceof Eu)return rl;if(s instanceof fs)return ds;if(s instanceof Oo)return oa;if(Array.isArray(s)){const e=s.length;let n;for(const a of s){const d=zi(a);if(n){if(n===d)continue;n=wr;break}n=d}return Lo(n||wr,e)}return ba}function To(s){const e=typeof s;return s===null?"":e==="string"||e==="number"||e==="boolean"?String(s):s instanceof ir?s.toStringPremultipliedAlpha():s instanceof fs||s instanceof Oo?s.toString():JSON.stringify(s)}class Is{constructor(e,n){this.type=e,this.value=n}static parse(e,n){if(e.length!==2)return n.error(`'literal' expression requires exactly one argument, but found ${e.length-1} instead.`);if(!sl(e[1]))return n.error("invalid value");const a=e[1];let d=zi(a);const c=n.expectedType;return d.kind!=="array"||d.N!==0||!c||c.kind!=="array"||typeof c.N=="number"&&c.N!==0||(d=c),new Is(d,a)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return this.type.kind==="array"||this.type.kind==="object"?["literal",this.value]:this.value instanceof ir?["rgba"].concat(this.value.toRenderColor(null).toArray()):this.value instanceof fs?this.value.serialize():this.value}}class _o{constructor(e){this.name="ExpressionEvaluationError",this.message=e}toJSON(){return this.message}}const Jl={string:Jn,number:qt,boolean:Xn,object:ba};class wa{constructor(e,n){this.type=e,this.args=n}static parse(e,n){if(e.length<2)return n.error("Expected at least one argument.");let a,d=1;const c=e[0];if(c==="array"){let w,T;if(e.length>2){const P=e[1];if(typeof P!="string"||!(P in Jl)||P==="object")return n.error('The item type argument of "array" must be one of string, number, boolean',1);w=Jl[P],d++}else w=wr;if(e.length>3){if(e[2]!==null&&(typeof e[2]!="number"||e[2]<0||e[2]!==Math.floor(e[2])))return n.error('The length argument to "array" must be a positive integer literal',2);T=e[2],d++}a=Lo(w,T)}else a=Jl[c];const p=[];for(;d<e.length;d++){const w=n.parse(e[d],d,wr);if(!w)return null;p.push(w)}return new wa(a,p)}evaluate(e){for(let n=0;n<this.args.length;n++){const a=this.args[n].evaluate(e);if(!il(this.type,zi(a)))return a;if(n===this.args.length-1)throw new _o(`The expression ${JSON.stringify(this.args[n].serialize())} evaluated to ${wi(zi(a))} but was expected to be of type ${wi(this.type)}.`)}return null}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){const e=this.type,n=[e.kind];if(e.kind==="array"){const a=e.itemType;if(a.kind==="string"||a.kind==="number"||a.kind==="boolean"){n.push(a.kind);const d=e.N;(typeof d=="number"||this.args.length>1)&&n.push(d)}}return n.concat(this.args.map(a=>a.serialize()))}}class Ba{constructor(e){this.type=ds,this.sections=e}static parse(e,n){if(e.length<2)return n.error("Expected at least one argument.");const a=e[1];if(!Array.isArray(a)&&typeof a=="object")return n.error("First argument must be an image or text section.");const d=[];let c=!1;for(let p=1;p<=e.length-1;++p){const w=e[p];if(c&&typeof w=="object"&&!Array.isArray(w)){c=!1;let T=null;if(w["font-scale"]&&(T=n.parseObjectValue(w["font-scale"],p,"font-scale",qt),!T))return null;let P=null;if(w["text-font"]&&(P=n.parseObjectValue(w["text-font"],p,"text-font",Lo(Jn)),!P))return null;let x=null;if(w["text-color"]&&(x=n.parseObjectValue(w["text-color"],p,"text-color",ni),!x))return null;const C=d[d.length-1];C.scale=T,C.font=P,C.textColor=x}else{const T=n.parse(e[p],p,wr);if(!T)return null;const P=T.type.kind;if(P!=="string"&&P!=="value"&&P!=="null"&&P!=="resolvedImage")return n.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");c=!0,d.push({content:T,scale:null,font:null,textColor:null})}}return new Ba(d)}evaluate(e){return new fs(this.sections.map(n=>{const a=n.content.evaluate(e);return zi(a)===oa?new Os("",a,null,null,null):new Os(To(a),null,n.scale?n.scale.evaluate(e):null,n.font?n.font.evaluate(e).join(","):null,n.textColor?n.textColor.evaluate(e):null)}))}eachChild(e){for(const n of this.sections)e(n.content),n.scale&&e(n.scale),n.font&&e(n.font),n.textColor&&e(n.textColor)}outputDefined(){return!1}serialize(){const e=["format"];for(const n of this.sections){e.push(n.content.serialize());const a={};n.scale&&(a["font-scale"]=n.scale.serialize()),n.font&&(a["text-font"]=n.font.serialize()),n.textColor&&(a["text-color"]=n.textColor.serialize()),e.push(a)}return e}}class al{constructor(e,n,a,d){this._imageWarnHistory={},this.type=oa,this.inputPrimary=e,this.inputSecondary=n,this.inputPrimaryParams=a,this.inputSecondaryParams=d}static parse(e,n){if(e.length<2)return n.error("Expected two or more arguments.");let a=1;const d=[];function c(){if(a<e.length){const w=n.parse(e[a],a++,Jn);return w?(d.push({image:w,options:void 0}),!0):(n.error(d.length?"Secondary image variant is not a string.":"No image name provided."),!1)}return!0}function p(){if(a<e.length){if((w=e[a])===null||typeof w!="object"||Array.isArray(w))return!0;const T=e[a].params,P=n.concat(a);if(!T)return a++,!0;if(typeof T!="object"||T.constructor!==Object)return P.error('Image options "params" should be an object'),!1;const x={},C=P.concat(void 0,"params");for(const A in T){if(!A)return C.error("Image parameter name should be non-empty"),!1;const E=C.concat(void 0,A).parse(T[A],void 0,ni,void 0,{typeAnnotation:"coerce"});if(!E)return!1;x[A]=E}return d[d.length-1].options=x,a++,!0}var w;return!0}for(let w=0;w<2;w++)if(!c()||!p())return;return new al(d[0].image,d[1]?d[1].image:void 0,d[0].options,d[1]?d[1].options:void 0)}evaluateParams(e,n){const a={};if(n){for(const d in n)if(n[d])try{const c=n[d].evaluate(e),p=`Ignoring image parameter "${d}" with semi-transparent color ${c.toString()}`;if(c.a!==1){this._imageWarnHistory[p]||(console.warn(p),this._imageWarnHistory[p]=!0);continue}a[d]=c}catch{continue}if(Object.keys(a).length!==0)return{params:a}}}evaluate(e){const n=Oo.build(this.inputPrimary.evaluate(e),this.inputSecondary?this.inputSecondary.evaluate(e):void 0,this.inputPrimaryParams?this.evaluateParams(e,this.inputPrimaryParams):void 0,this.inputSecondaryParams?this.evaluateParams(e,this.inputSecondaryParams):void 0);return n&&e.availableImages&&(n.available=e.availableImages.indexOf(n.namePrimary)>-1,n.nameSecondary&&n.available&&e.availableImages&&(n.available=e.availableImages.indexOf(n.nameSecondary)>-1)),n}eachChild(e){if(e(this.inputPrimary),this.inputPrimaryParams)for(const n in this.inputPrimaryParams)this.inputPrimaryParams[n]&&e(this.inputPrimaryParams[n]);if(this.inputSecondary&&(e(this.inputSecondary),this.inputSecondaryParams))for(const n in this.inputSecondaryParams)this.inputSecondaryParams[n]&&e(this.inputSecondaryParams[n])}outputDefined(){return!1}serializeParams(e){const n={};if(e){for(const a in e)e[a]&&(n[a]=e[a].serialize());return{params:n}}}serialize(){const e=["image",this.inputPrimary.serialize()];return this.inputPrimaryParams&&e.push(this.serializeParams(this.inputPrimaryParams)),this.inputSecondary&&(e.push(this.inputSecondary.serialize()),this.inputSecondaryParams&&e.push(this.serializeParams(this.inputSecondaryParams))),e}}function ll(s){return s instanceof Number?"number":s instanceof String?"string":s instanceof Boolean?"boolean":Array.isArray(s)?"array":s===null?"null":typeof s}const Oh={"to-boolean":Xn,"to-color":ni,"to-number":qt,"to-string":Jn};class Na{constructor(e,n){this.type=e,this.args=n}static parse(e,n){if(e.length<2)return n.error("Expected at least one argument.");const a=e[0],d=[];let c=Kn;if(a==="to-array"){if(!Array.isArray(e[1]))return null;const p=e[1].length;if(n.expectedType){if(n.expectedType.kind!=="array")return n.error(`Expected ${n.expectedType.kind} but found array.`);c=Lo(n.expectedType.itemType,p)}else{if(!(p>0&&sl(e[1][0])))return null;c=Lo(zi(e[1][0]),p)}for(let w=0;w<p;w++){const T=e[1][w];let P;if(ll(T)==="array")P=n.parse(T,void 0,c.itemType);else{const x=ll(T);if(x!==c.itemType.kind)return n.error(`Expected ${c.itemType.kind} but found ${x}.`);P=n.registry.literal.parse(["literal",T===void 0?null:T],n)}if(!P)return null;d.push(P)}}else{if((a==="to-boolean"||a==="to-string")&&e.length!==2)return n.error("Expected one argument.");c=Oh[a];for(let p=1;p<e.length;p++){const w=n.parse(e[p],p,wr);if(!w)return null;d.push(w)}}return new Na(c,d)}evaluate(e){if(this.type.kind==="boolean")return!!this.args[0].evaluate(e);if(this.type.kind==="color"){let n,a;for(const d of this.args){if(n=d.evaluate(e),a=null,n instanceof ir)return n;if(typeof n=="string"){const c=e.parseColor(n);if(c)return c}else if(Array.isArray(n)&&(a=n.length<3||n.length>4?`Invalid rbga value ${JSON.stringify(n)}: expected an array containing either three or four numeric values.`:ol(n[0],n[1],n[2],n[3]),!a))return new ir(n[0]/255,n[1]/255,n[2]/255,n[3])}throw new _o(a||`Could not parse color from value '${typeof n=="string"?n:String(JSON.stringify(n))}'`)}if(this.type.kind==="number"){let n=null;for(const a of this.args){if(n=a.evaluate(e),n===null)return 0;const d=Number(n);if(!isNaN(d))return d}throw new _o(`Could not convert ${JSON.stringify(n)} to number.`)}return this.type.kind==="formatted"?fs.fromString(To(this.args[0].evaluate(e))):this.type.kind==="resolvedImage"?Oo.build(To(this.args[0].evaluate(e))):this.type.kind==="array"?this.args.map(n=>n.evaluate(e)):To(this.args[0].evaluate(e))}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){if(this.type.kind==="formatted")return new Ba([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if(this.type.kind==="resolvedImage")return new al(this.args[0]).serialize();const e=this.type.kind==="array"?[]:[`to-${this.type.kind}`];return this.eachChild(n=>{e.push(n.serialize())}),e}}const Rd=["Unknown","Point","LineString","Polygon"];class Ku{constructor(e,n){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null,this.scope=e,this.options=n}id(){return this.feature&&this.feature.id!==void 0?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?Rd[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}measureLight(e){return this.globals.brightness||0}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){const e=this.featureDistanceData.center,n=this.featureDistanceData.scale,{x:a,y:d}=this.featureTileCoord;return this.featureDistanceData.bearing[0]*(a*n-e[0])+this.featureDistanceData.bearing[1]*(d*n-e[1])}return 0}parseColor(e){let n=this._parseColorCache[e];return n||(n=this._parseColorCache[e]=ir.parse(e)),n}getConfig(e){return this.options?this.options.get(e):null}}class Ko{constructor(e,n,a,d,c){this.name=e,this.type=n,this._evaluate=a,this.args=d,this._overloadIndex=c}evaluate(e){if(!this._evaluate){const n=Ko.definitions[this.name];this._evaluate=Array.isArray(n)?n[2]:n.overloads[this._overloadIndex][1]}return this._evaluate(e,this.args)}eachChild(e){this.args.forEach(e)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map(e=>e.serialize()))}static parse(e,n){const a=e[0],d=Ko.definitions[a];if(!d)return n.error(`Unknown expression "${a}". If you wanted a literal array, use ["literal", [...]].`,0);const c=Array.isArray(d)?d[0]:d.type,p=Array.isArray(d)?[[d[1],d[2]]]:d.overloads,w=[];let T=null,P=-1;for(const[x,C]of p){if(Array.isArray(x)&&x.length!==e.length-1)continue;w.push(x),P++,T=new Wh(n.registry,n.path,null,n.scope,void 0,n._scope,n.options);const A=[];let E=!1;for(let M=1;M<e.length;M++){const k=e[M],N=Array.isArray(x)?x[M-1]:x.type,j=T.parse(k,1+A.length,N);if(!j){E=!0;break}A.push(j)}if(!E)if(Array.isArray(x)&&x.length!==A.length)T.error(`Expected ${x.length} arguments, but found ${A.length} instead.`);else{for(let M=0;M<A.length;M++){const k=Array.isArray(x)?x[M]:x.type,N=A[M];T.concat(M+1).checkSubtype(k,N.type)}if(T.errors.length===0)return new Ko(a,c,C,A,P)}}if(w.length===1)n.errors.push(...T.errors);else{const x=(w.length?w:p.map(([A])=>A)).map(_c).join(" | "),C=[];for(let A=1;A<e.length;A++){const E=n.parse(e[A],1+C.length);if(!E)return null;C.push(wi(E.type))}n.error(`Expected arguments of type ${x}, but found (${C.join(", ")}) instead.`)}return null}static register(e,n){Ko.definitions=n;for(const a in n)e[a]=Ko}}function _c(s){return Array.isArray(s)?`(${s.map(wi).join(", ")})`:`(${wi(s.type)}...)`}class Dh{constructor(e,n,a){this.type=rl,this.locale=a,this.caseSensitive=e,this.diacriticSensitive=n}static parse(e,n){if(e.length!==2)return n.error("Expected one argument.");const a=e[1];if(typeof a!="object"||Array.isArray(a))return n.error("Collator options argument must be an object.");const d=a["case-sensitive"]===void 0?n.parse(!1,1,Xn):n.parseObjectValue(a["case-sensitive"],1,"case-sensitive",Xn);if(!d)return null;const c=a["diacritic-sensitive"]===void 0?n.parse(!1,1,Xn):n.parseObjectValue(a["diacritic-sensitive"],1,"diacritic-sensitive",Xn);if(!c)return null;let p=null;return a.locale&&(p=n.parseObjectValue(a.locale,1,"locale",Jn),!p)?null:new Dh(d,c,p)}evaluate(e){return new Eu(this.caseSensitive.evaluate(e),this.diacriticSensitive.evaluate(e),this.locale?this.locale.evaluate(e):null)}eachChild(e){e(this.caseSensitive),e(this.diacriticSensitive),this.locale&&e(this.locale)}outputDefined(){return!1}serialize(){const e={};return e["case-sensitive"]=this.caseSensitive.serialize(),e["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(e.locale=this.locale.serialize()),["collator",e]}}function kd(s,e,n=0,a=s.length-1,d=Sp){for(;a>n;){if(a-n>600){const T=a-n+1,P=e-n+1,x=Math.log(T),C=.5*Math.exp(2*x/3),A=.5*Math.sqrt(x*C*(T-C)/T)*(P-T/2<0?-1:1);kd(s,e,Math.max(n,Math.floor(e-P*C/T+A)),Math.min(a,Math.floor(e+(T-P)*C/T+A)),d)}const c=s[e];let p=n,w=a;for(Ju(s,n,e),d(s[a],c)>0&&Ju(s,n,a);p<w;){for(Ju(s,p,w),p++,w--;d(s[p],c)<0;)p++;for(;d(s[w],c)>0;)w--}d(s[n],c)===0?Ju(s,n,w):(w++,Ju(s,w,a)),w<=e&&(n=w+1),e<=w&&(a=w-1)}}function Ju(s,e,n){const a=s[e];s[e]=s[n],s[n]=a}function Sp(s,e){return s<e?-1:s>e?1:0}function Ep(s){let e=0;for(let n,a,d=0,c=s.length,p=c-1;d<c;p=d++)n=s[d],a=s[p],e+=(a.x-n.x)*(n.y+a.y);return e}function Tu(s,e){s[0]=Math.min(s[0],e[0]),s[1]=Math.min(s[1],e[1]),s[2]=Math.max(s[2],e[0]),s[3]=Math.max(s[3],e[1])}function Cu(s,e){return!(s[0]<=e[0]||s[2]>=e[2]||s[1]<=e[1]||s[3]>=e[3])}function zd(s,e,n){const a=s[0]-e[0],d=s[1]-e[1],c=s[0]-n[0],p=s[1]-n[1];return a*p-c*d==0&&a*c<=0&&d*p<=0}function cl(s,e,n=!1){let a=!1;for(let w=0,T=e.length;w<T;w++){const P=e[w];for(let x=0,C=P.length,A=C-1;x<C;A=x++){const E=P[A],M=P[x];if(zd(s,E,M))return n;(c=E)[1]>(d=s)[1]!=(p=M)[1]>d[1]&&d[0]<(p[0]-c[0])*(d[1]-c[1])/(p[1]-c[1])+c[0]&&(a=!a)}}var d,c,p;return a}function Uc(s,e,n,a){const d=a[0]-n[0],c=a[1]-n[1],p=(s[0]-n[0])*c-d*(s[1]-n[1]),w=(e[0]-n[0])*c-d*(e[1]-n[1]);return p>0&&w<0||p<0&&w>0}function ja(s,e,n,a){return(d=[a[0]-n[0],a[1]-n[1]])[0]*(c=[e[0]-s[0],e[1]-s[1]])[1]-d[1]*c[0]!=0&&!(!Uc(s,e,n,a)||!Uc(n,a,s,e));var d,c}const Pl=8192;function Fh(s,e){const n=(180+s[0])/360,a=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+s[1]*Math.PI/360)))/360,d=Math.pow(2,e.z);return[Math.round(n*d*Pl),Math.round(a*d*Pl)]}function Tp(s,e){for(let n=0;n<e.length;n++)if(cl(s,e[n]))return!0;return!1}function Cf(s,e,n){for(const a of n)for(let d=0,c=a.length,p=c-1;d<c;p=d++)if(ja(s,e,a[p],a[d]))return!0;return!1}function Mf(s,e){for(let n=0;n<s.length;++n)if(!cl(s[n],e))return!1;for(let n=0;n<s.length-1;++n)if(Cf(s[n],s[n+1],e))return!1;return!0}function Mu(s,e){for(let n=0;n<e.length;n++)if(Mf(s,e[n]))return!0;return!1}function Sr(s,e,n){const a=[];for(let d=0;d<s.length;d++){const c=[];for(let p=0;p<s[d].length;p++){const w=Fh(s[d][p],n);Tu(e,w),c.push(w)}a.push(c)}return a}function Dn(s,e,n){const a=[];for(let d=0;d<s.length;d++){const c=Sr(s[d],e,n);a.push(c)}return a}function Bh(s,e,n,a){if(s[0]<n[0]||s[0]>n[2]){const d=.5*a;let c=s[0]-n[0]>d?-a:n[0]-s[0]>d?a:0;c===0&&(c=s[0]-n[2]>d?-a:n[2]-s[0]>d?a:0),s[0]+=c}Tu(e,s)}function or(s,e,n,a){const d=Math.pow(2,a.z)*Pl,c=[a.x*Pl,a.y*Pl],p=[];if(!s)return p;for(const w of s)for(const T of w){const P=[T.x+c[0],T.y+c[1]];Bh(P,e,n,d),p.push(P)}return p}function aa(s,e,n,a){const d=Math.pow(2,a.z)*Pl,c=[a.x*Pl,a.y*Pl],p=[];if(!s)return p;for(const T of s){const P=[];for(const x of T){const C=[x.x+c[0],x.y+c[1]];Tu(e,C),P.push(C)}p.push(P)}if(e[2]-e[0]<=d/2){(w=e)[0]=w[1]=1/0,w[2]=w[3]=-1/0;for(const T of p)for(const P of T)Bh(P,e,n,d)}var w;return p}class $a{constructor(e,n){this.type=Xn,this.geojson=e,this.geometries=n}static parse(e,n){if(e.length!==2)return n.error(`'within' expression requires exactly one argument, but found ${e.length-1} instead.`);if(sl(e[1])){const a=e[1];if(a.type==="FeatureCollection")for(let d=0;d<a.features.length;++d){const c=a.features[d].geometry.type;if(c==="Polygon"||c==="MultiPolygon")return new $a(a,a.features[d].geometry)}else if(a.type==="Feature"){const d=a.geometry.type;if(d==="Polygon"||d==="MultiPolygon")return new $a(a,a.geometry)}else if(a.type==="Polygon"||a.type==="MultiPolygon")return new $a(a,a)}return n.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(e){if(e.geometry()!=null&&e.canonicalID()!=null){if(e.geometryType()==="Point")return function(n,a){const d=[1/0,1/0,-1/0,-1/0],c=[1/0,1/0,-1/0,-1/0],p=n.canonicalID();if(!p)return!1;if(a.type==="Polygon"){const w=Sr(a.coordinates,c,p),T=or(n.geometry(),d,c,p);if(!Cu(d,c))return!1;for(const P of T)if(!cl(P,w))return!1}if(a.type==="MultiPolygon"){const w=Dn(a.coordinates,c,p),T=or(n.geometry(),d,c,p);if(!Cu(d,c))return!1;for(const P of T)if(!Tp(P,w))return!1}return!0}(e,this.geometries);if(e.geometryType()==="LineString")return function(n,a){const d=[1/0,1/0,-1/0,-1/0],c=[1/0,1/0,-1/0,-1/0],p=n.canonicalID();if(!p)return!1;if(a.type==="Polygon"){const w=Sr(a.coordinates,c,p),T=aa(n.geometry(),d,c,p);if(!Cu(d,c))return!1;for(const P of T)if(!Mf(P,w))return!1}if(a.type==="MultiPolygon"){const w=Dn(a.coordinates,c,p),T=aa(n.geometry(),d,c,p);if(!Cu(d,c))return!1;for(const P of T)if(!Mu(P,w))return!1}return!0}(e,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}const Wn={kilometers:1,miles:1e3/1609.344,nauticalmiles:1e3/1852,meters:1e3,metres:1e3,yards:1e3/.9144,feet:1e3/.3048,inches:1e3/.0254},Nh=1/298.257223563,Qu=Nh*(2-Nh),Hc=Math.PI/180;class yc{static fromTile(e,n,a){const d=Math.PI*(1-2*(e+.5)/Math.pow(2,n)),c=Math.atan(.5*(Math.exp(d)-Math.exp(-d)))/Hc;return new yc(c,a)}static get units(){return Wn}constructor(e,n){if(e===void 0)throw new Error("No latitude given.");if(n&&!Wn[n])throw new Error(`Unknown unit ${n}. Use one of: ${Object.keys(Wn).join(", ")}`);const a=6378.137*Hc*(n?Wn[n]:1),d=Math.cos(e*Hc),c=1/(1-Qu*(1-d*d)),p=Math.sqrt(c);this.kx=a*p*d,this.ky=a*p*c*(1-Qu)}distance(e,n){const a=ms(e[0]-n[0])*this.kx,d=(e[1]-n[1])*this.ky;return Math.sqrt(a*a+d*d)}bearing(e,n){const a=ms(n[0]-e[0])*this.kx;return Math.atan2(a,(n[1]-e[1])*this.ky)/Hc}destination(e,n,a){const d=a*Hc;return this.offset(e,Math.sin(d)*n,Math.cos(d)*n)}offset(e,n,a){return[e[0]+n/this.kx,e[1]+a/this.ky]}lineDistance(e){let n=0;for(let a=0;a<e.length-1;a++)n+=this.distance(e[a],e[a+1]);return n}area(e){let n=0;for(let a=0;a<e.length;a++){const d=e[a];for(let c=0,p=d.length,w=p-1;c<p;w=c++)n+=ms(d[c][0]-d[w][0])*(d[c][1]+d[w][1])*(a?-1:1)}return Math.abs(n)/2*this.kx*this.ky}along(e,n){let a=0;if(n<=0)return e[0];for(let d=0;d<e.length-1;d++){const c=e[d],p=e[d+1],w=this.distance(c,p);if(a+=w,a>n)return ps(c,p,(n-(a-w))/w)}return e[e.length-1]}pointToSegmentDistance(e,n,a){let[d,c]=n,p=ms(a[0]-d)*this.kx,w=(a[1]-c)*this.ky;if(p!==0||w!==0){const T=(ms(e[0]-d)*this.kx*p+(e[1]-c)*this.ky*w)/(p*p+w*w);T>1?(d=a[0],c=a[1]):T>0&&(d+=p/this.kx*T,c+=w/this.ky*T)}return p=ms(e[0]-d)*this.kx,w=(e[1]-c)*this.ky,Math.sqrt(p*p+w*w)}pointOnLine(e,n){let a=1/0,d=e[0][0],c=e[0][1],p=0,w=0;for(let T=0;T<e.length-1;T++){let P=e[T][0],x=e[T][1],C=ms(e[T+1][0]-P)*this.kx,A=(e[T+1][1]-x)*this.ky,E=0;C===0&&A===0||(E=(ms(n[0]-P)*this.kx*C+(n[1]-x)*this.ky*A)/(C*C+A*A),E>1?(P=e[T+1][0],x=e[T+1][1]):E>0&&(P+=C/this.kx*E,x+=A/this.ky*E)),C=ms(n[0]-P)*this.kx,A=(n[1]-x)*this.ky;const M=C*C+A*A;M<a&&(a=M,d=P,c=x,p=T,w=E)}return{point:[d,c],index:p,t:Math.max(0,Math.min(1,w))}}lineSlice(e,n,a){let d=this.pointOnLine(a,e),c=this.pointOnLine(a,n);if(d.index>c.index||d.index===c.index&&d.t>c.t){const P=d;d=c,c=P}const p=[d.point],w=d.index+1,T=c.index;!Ql(a[w],p[0])&&w<=T&&p.push(a[w]);for(let P=w+1;P<=T;P++)p.push(a[P]);return Ql(a[T],c.point)||p.push(c.point),p}lineSliceAlong(e,n,a){let d=0;const c=[];for(let p=0;p<a.length-1;p++){const w=a[p],T=a[p+1],P=this.distance(w,T);if(d+=P,d>e&&c.length===0&&c.push(ps(w,T,(e-(d-P))/P)),d>=n)return c.push(ps(w,T,(n-(d-P))/P)),c;d>e&&c.push(T)}return c}bufferPoint(e,n){const a=n/this.ky,d=n/this.kx;return[e[0]-d,e[1]-a,e[0]+d,e[1]+a]}bufferBBox(e,n){const a=n/this.ky,d=n/this.kx;return[e[0]-d,e[1]-a,e[2]+d,e[3]+a]}insideBBox(e,n){return ms(e[0]-n[0])>=0&&ms(e[0]-n[2])<=0&&e[1]>=n[1]&&e[1]<=n[3]}}function Ql(s,e){return s[0]===e[0]&&s[1]===e[1]}function ps(s,e,n){const a=ms(e[0]-s[0]);return[s[0]+a*n,s[1]+(e[1]-s[1])*n]}function ms(s){for(;s<-180;)s+=360;for(;s>180;)s-=360;return s}class eh{constructor(e=[],n=(a,d)=>a<d?-1:a>d?1:0){if(this.data=e,this.length=this.data.length,this.compare=n,this.length>0)for(let a=(this.length>>1)-1;a>=0;a--)this._down(a)}push(e){this.data.push(e),this._up(this.length++)}pop(){if(this.length===0)return;const e=this.data[0],n=this.data.pop();return--this.length>0&&(this.data[0]=n,this._down(0)),e}peek(){return this.data[0]}_up(e){const{data:n,compare:a}=this,d=n[e];for(;e>0;){const c=e-1>>1,p=n[c];if(a(d,p)>=0)break;n[e]=p,e=c}n[e]=d}_down(e){const{data:n,compare:a}=this,d=this.length>>1,c=n[e];for(;e<d;){let p=1+(e<<1);const w=p+1;if(w<this.length&&a(n[w],n[p])<0&&(p=w),a(n[p],c)>=0)break;n[e]=n[p],e=p}n[e]=c}}var pn=8192;function jh(s,e){return e.dist-s.dist}const ul=100,Jo=50;function Wc(s){const e=[1/0,1/0,-1/0,-1/0];if(e.length!==s.length)return!1;for(let n=0;n<e.length;n++)if(e[n]!==s[n])return!1;return!0}function hl(s){return s[1]-s[0]+1}function Rl(s,e){const n=s[1]>=s[0]&&s[1]<e;return n||console.warn("Distance Expression: Index is out of range"),n}function dl(s,e){if(s[0]>s[1])return[null,null];const n=hl(s);if(e){if(n===2)return[s,null];const a=Math.floor(n/2);return[[s[0],s[0]+a],[s[0]+a,s[1]]]}{if(n===1)return[s,null];const a=Math.floor(n/2)-1;return[[s[0],s[0]+a],[s[0]+a+1,s[1]]]}}function gs(s,e){const n=[1/0,1/0,-1/0,-1/0];if(!Rl(e,s.length))return n;for(let a=e[0];a<=e[1];++a)Tu(n,s[a]);return n}function Gc(s){const e=[1/0,1/0,-1/0,-1/0];for(let n=0;n<s.length;++n)for(let a=0;a<s[n].length;++a)Tu(e,s[n][a]);return e}function vc(s,e,n){if(Wc(s)||Wc(e))return NaN;let a=0,d=0;return s[2]<e[0]&&(a=e[0]-s[2]),s[0]>e[2]&&(a=s[0]-e[2]),s[1]>e[3]&&(d=s[1]-e[3]),s[3]<e[1]&&(d=e[1]-s[3]),n.distance([0,0],[a,d])}function $h(s){return 360*s-180}function Ld(s){return 360/Math.PI*Math.atan(Math.exp((180-360*s)*Math.PI/180))-90}function Vh(s,e){const n=Math.pow(2,e.z),a=(s.y/pn+e.y)/n;return[$h((s.x/pn+e.x)/n),Ld(a)]}function Od(s,e){const n=[];for(let a=0;a<s.length;++a)n.push(Vh(s[a],e));return n}function Af(s,e,n){const a=n.pointOnLine(e,s).point;return n.distance(s,a)}function If(s,e,n,a,d){const c=n.slice(a[0],a[1]+1);let p=1/0;for(let w=e[0];w<=e[1];++w)if((p=Math.min(p,Af(s[w],c,d)))===0)return 0;return p}function ec(s,e,n,a,d){const c=Math.min(d.pointToSegmentDistance(s,n,a),d.pointToSegmentDistance(e,n,a)),p=Math.min(d.pointToSegmentDistance(n,s,e),d.pointToSegmentDistance(a,s,e));return Math.min(c,p)}function Cp(s,e,n,a,d){if(!Rl(e,s.length)||!Rl(a,n.length))return NaN;let c=1/0;for(let p=e[0];p<e[1];++p)for(let w=a[0];w<a[1];++w){if(ja(s[p],s[p+1],n[w],n[w+1]))return 0;c=Math.min(c,ec(s[p],s[p+1],n[w],n[w+1],d))}return c}function Pf(s,e,n,a,d){if(!Rl(e,s.length)||!Rl(a,n.length))return NaN;let c=1/0;for(let p=e[0];p<=e[1];++p)for(let w=a[0];w<=a[1];++w)if((c=Math.min(c,d.distance(s[p],n[w])))===0)return c;return c}function la(s,e,n){if(cl(s,e,!0))return 0;let a=1/0;for(const d of e){const c=d.length;if(c<2)return console.warn("Distance Expression: Invalid polygon!"),NaN;if(d[0]!==d[c-1]&&(a=Math.min(a,n.pointToSegmentDistance(s,d[c-1],d[0])))===0||(a=Math.min(a,Af(s,d,n)))===0)return a}return a}function xc(s,e,n,a){if(!Rl(e,s.length))return NaN;for(let c=e[0];c<=e[1];++c)if(cl(s[c],n,!0))return 0;let d=1/0;for(let c=e[0];c<e[1];++c)for(const p of n)for(let w=0,T=p.length,P=T-1;w<T;P=w++){if(ja(s[c],s[c+1],p[P],p[w]))return 0;d=Math.min(d,ec(s[c],s[c+1],p[P],p[w],a))}return d}function Uh(s,e){for(const n of s)for(let a=0;a<=n.length-1;++a)if(cl(n[a],e,!0))return!0;return!1}function Va(s,e,n,a=1/0){const d=Gc(s),c=Gc(e);if(a!==1/0&&vc(d,c,n)>=a)return a;if(Cu(d,c)){if(Uh(s,e))return 0}else if(Uh(e,s))return 0;let p=a;for(const w of s)for(let T=0,P=w.length,x=P-1;T<P;x=T++)for(const C of e)for(let A=0,E=C.length,M=E-1;A<E;M=A++){if(ja(w[x],w[T],C[M],C[A]))return 0;p=Math.min(p,ec(w[x],w[T],C[M],C[A],n))}return p}function Ua(s,e,n,a,d,c,p){if(c===null||p===null)return;const w=vc(gs(a,c),gs(d,p),n);w<e&&s.push({dist:w,range1:c,range2:p})}function fl(s,e,n,a,d=1/0){let c=Math.min(a.distance(s[0],n[0][0]),d);if(c===0)return c;const p=new eh([{dist:0,range1:[0,s.length-1],range2:[0,0]}],jh),w=e?Jo:ul,T=Gc(n);for(;p.length;){const P=p.pop();if(P.dist>=c)continue;const x=P.range1;if(hl(x)<=w){if(!Rl(x,s.length))return NaN;if(e){const C=xc(s,x,n,a);if((c=Math.min(c,C))===0)return c}else for(let C=x[0];C<=x[1];++C){const A=la(s[C],n,a);if((c=Math.min(c,A))===0)return c}}else{const C=dl(x,e);if(C[0]!==null){const A=vc(gs(s,C[0]),T,a);A<c&&p.push({dist:A,range1:C[0],range2:[0,0]})}if(C[1]!==null){const A=vc(gs(s,C[1]),T,a);A<c&&p.push({dist:A,range1:C[1],range2:[0,0]})}}}return c}function Au(s,e,n,a,d,c=1/0){let p=Math.min(c,d.distance(s[0],n[0]));if(p===0)return p;const w=new eh([{dist:0,range1:[0,s.length-1],range2:[0,n.length-1]}],jh),T=e?Jo:ul,P=a?Jo:ul;for(;w.length;){const x=w.pop();if(x.dist>=p)continue;const C=x.range1,A=x.range2;if(hl(C)<=T&&hl(A)<=P){if(!Rl(C,s.length)||!Rl(A,n.length))return NaN;if(e&&a?p=Math.min(p,Cp(s,C,n,A,d)):e||a?e&&!a?p=Math.min(p,If(n,A,s,C,d)):!e&&a&&(p=Math.min(p,If(s,C,n,A,d))):p=Math.min(p,Pf(s,C,n,A,d)),p===0)return p}else{const E=dl(C,e),M=dl(A,a);Ua(w,p,d,s,n,E[0],M[0]),Ua(w,p,d,s,n,E[0],M[1]),Ua(w,p,d,s,n,E[1],M[0]),Ua(w,p,d,s,n,E[1],M[1])}}return p}function Hh(s,e,n,a,d=1/0){let c=d;const p=gs(s,[0,s.length-1]);for(const w of n)if(!(c!==1/0&&vc(p,gs(w,[0,w.length-1]),a)>=c)&&(c=Math.min(c,Au(s,e,w,!0,a,c)),c===0))return c;return c}function Iu(s,e,n,a,d=1/0){let c=d;const p=gs(s,[0,s.length-1]);for(const w of n){if(c!==1/0&&vc(p,Gc(w),a)>=c)continue;const T=fl(s,e,w,a,c);if(isNaN(T))return T;if((c=Math.min(c,T))===0)return c}return c}function kl(s){return s==="Point"||s==="MultiPoint"||s==="LineString"||s==="MultiLineString"||s==="Polygon"||s==="MultiPolygon"}class pl{constructor(e,n){this.type=qt,this.geojson=e,this.geometries=n}static parse(e,n){if(e.length!==2)return n.error(`'distance' expression requires either one argument, but found ' ${e.length-1} instead.`);if(sl(e[1])){const a=e[1];if(a.type==="FeatureCollection"){for(let d=0;d<a.features.length;++d)if(kl(a.features[d].geometry.type))return new pl(a,a.features[d].geometry)}else if(a.type==="Feature"){if(kl(a.geometry.type))return new pl(a,a.geometry)}else if(kl(a.type))return new pl(a,a)}return n.error("'distance' expression needs to be an array with format ['Distance', GeoJSONObj].")}evaluate(e){const n=e.geometry(),a=e.canonicalID();if(n!=null&&a!=null){if(e.geometryType()==="Point")return function(d,c,p){const w=[];for(const P of d)for(const x of P)w.push(Vh(x,c));const T=new yc(w[0][1],"meters");return p.type==="Point"||p.type==="MultiPoint"||p.type==="LineString"?Au(w,!1,p.type==="Point"?[p.coordinates]:p.coordinates,p.type==="LineString",T):p.type==="MultiLineString"?Hh(w,!1,p.coordinates,T):p.type==="Polygon"||p.type==="MultiPolygon"?Iu(w,!1,p.type==="Polygon"?[p.coordinates]:p.coordinates,T):null}(n,a,this.geometries);if(e.geometryType()==="LineString")return function(d,c,p){const w=[];for(const P of d){const x=[];for(const C of P)x.push(Vh(C,c));w.push(x)}const T=new yc(w[0][0][1],"meters");if(p.type==="Point"||p.type==="MultiPoint"||p.type==="LineString")return Hh(p.type==="Point"?[p.coordinates]:p.coordinates,p.type==="LineString",w,T);if(p.type==="MultiLineString"){let P=1/0;for(let x=0;x<p.coordinates.length;x++){const C=Hh(p.coordinates[x],!0,w,T,P);if(isNaN(C))return C;if((P=Math.min(P,C))===0)return P}return P}if(p.type==="Polygon"||p.type==="MultiPolygon"){let P=1/0;for(let x=0;x<w.length;x++){const C=Iu(w[x],!0,p.type==="Polygon"?[p.coordinates]:p.coordinates,T,P);if(isNaN(C))return C;if((P=Math.min(P,C))===0)return P}return P}return null}(n,a,this.geometries);if(e.geometryType()==="Polygon")return function(d,c,p){const w=[];for(const P of function(x,C){const A=x.length;if(A<=1)return[x];const E=[];let M,k;for(let N=0;N<A;N++){const j=Ep(x[N]);j!==0&&(x[N].area=Math.abs(j),k===void 0&&(k=j<0),k===j<0?(M&&E.push(M),M=[x[N]]):M.push(x[N]))}return M&&E.push(M),E}(d)){const x=[];for(let C=0;C<P.length;++C)x.push(Od(P[C],c));w.push(x)}const T=new yc(w[0][0][0][1],"meters");if(p.type==="Point"||p.type==="MultiPoint"||p.type==="LineString")return Iu(p.type==="Point"?[p.coordinates]:p.coordinates,p.type==="LineString",w,T);if(p.type==="MultiLineString"){let P=1/0;for(let x=0;x<p.coordinates.length;x++){const C=Iu(p.coordinates[x],!0,w,T,P);if(isNaN(C))return C;if((P=Math.min(P,C))===0)return P}return P}return p.type==="Polygon"||p.type==="MultiPolygon"?function(P,x,C){let A=1/0;for(const E of P)for(const M of x){const k=Va(E,M,C,A);if(isNaN(k))return k;if((A=Math.min(A,k))===0)return A}return A}(p.type==="Polygon"?[p.coordinates]:p.coordinates,w,T):null}(n,a,this.geometries);console.warn("Distance Expression: currently only evaluates valid Point/LineString/Polygon geometries.")}else console.warn("Distance Expression: requirs valid feature and canonical information.");return null}eachChild(){}outputDefined(){return!0}serialize(){return["distance",this.geojson]}}function tc(s,e){switch(s){case"string":return To(e);case"number":return+e;case"boolean":return!!e;case"color":return ir.parse(e);case"formatted":return fs.fromString(To(e));case"resolvedImage":return Oo.build(To(e))}return e}function th(s,e,n,a){return a!==void 0&&(s=a*Math.round(s/a)),e!==void 0&&s<e&&(s=e),n!==void 0&&s>n&&(s=n),s}class bc{constructor(e,n,a){this.type=e,this.key=n,this.scope=a}static parse(e,n){let a=n.expectedType;if(a==null&&(a=wr),e.length<2||e.length>3)return n.error("Invalid number of arguments for 'config' expression.");const d=n.parse(e[1],1);if(!(d instanceof Is))return n.error("Key name of 'config' expression must be a string literal.");if(e.length>=3){const c=n.parse(e[2],2);return c instanceof Is?new bc(a,To(d.value),To(c.value)):n.error("Scope of 'config' expression must be a string literal.")}return new bc(a,To(d.value))}evaluate(e){const n=[this.key,this.scope,e.scope].filter(Boolean).join(""),a=e.getConfig(n);if(!a)return null;const{type:d,value:c,values:p,minValue:w,maxValue:T,stepValue:P}=a,x=a.default.evaluate(e);let C=x;if(c){const A=e.scope;e.scope=(A||"").split("").slice(1).join(""),C=c.evaluate(e),e.scope=A}return d&&(C=tc(d,C)),C===void 0||w===void 0&&T===void 0&&P===void 0||(typeof C=="number"?C=th(C,w,T,P):Array.isArray(C)&&(C=C.map(A=>typeof A=="number"?th(A,w,T,P):A))),c!==void 0&&C!==void 0&&p&&!p.includes(C)&&(C=x,d&&(C=tc(d,C))),(d&&d!==this.type||C!==void 0&&zi(C)!==this.type)&&(C=tc(this.type.kind,C)),C}eachChild(){}outputDefined(){return!1}serialize(){const e=["config",this.key];return this.scope&&e.concat(this.key),e}}function nc(s){if(s instanceof Ko&&(s.name==="get"&&s.args.length===1||s.name==="feature-state"||s.name==="has"&&s.args.length===1||s.name==="properties"||s.name==="geometry-type"||s.name==="id"||/^filter-/.test(s.name))||s instanceof $a||s instanceof pl)return!1;let e=!0;return s.eachChild(n=>{e&&!nc(n)&&(e=!1)}),e}function Sa(s){if(s instanceof Ko&&s.name==="feature-state")return!1;let e=!0;return s.eachChild(n=>{e&&!Sa(n)&&(e=!1)}),e}function zl(s){if(s instanceof bc)return new Set([s.key]);let e=new Set;return s.eachChild(n=>{e=new Set([...e,...zl(n)])}),e}function Ll(s,e){if(s instanceof Ko&&e.indexOf(s.name)>=0)return!1;let n=!0;return s.eachChild(a=>{n&&!Ll(a,e)&&(n=!1)}),n}class wc{constructor(e,n){this.type=n.type,this.name=e,this.boundExpression=n}static parse(e,n){if(e.length!==2||typeof e[1]!="string")return n.error("'var' expression requires exactly one string literal argument.");const a=e[1];return n.scope.has(a)?new wc(a,n.scope.get(a)):n.error(`Unknown variable "${a}". Make sure "${a}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(e){return this.boundExpression.evaluate(e)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}class nh{constructor(e,n=[],a,d=new Fa,c=[],p,w){this.registry=e,this.path=n,this.key=n.map(T=>typeof T=="string"?`['${T}']`:`[${T}]`).join(""),this.scope=d,this.errors=c,this.expectedType=a,this._scope=p,this.options=w}parse(e,n,a,d,c={}){return n||a?this.concat(n,null,a,d)._parse(e,c):this._parse(e,c)}parseObjectValue(e,n,a,d,c,p={}){return this.concat(n,a,d,c)._parse(e,p)}_parse(e,n){function a(d,c,p){return p==="assert"?new wa(c,[d]):p==="coerce"?new Na(c,[d]):d}if(e!==null&&typeof e!="string"&&typeof e!="boolean"&&typeof e!="number"||(e=["literal",e]),Array.isArray(e)){if(e.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const d=typeof e[0]=="string"?this.registry[e[0]]:void 0;if(d){let c=d.parse(e,this);if(!c)return null;if(this.expectedType){const p=this.expectedType,w=c.type;if(p.kind!=="string"&&p.kind!=="number"&&p.kind!=="boolean"&&p.kind!=="object"&&p.kind!=="array"||w.kind!=="value")if(p.kind!=="color"&&p.kind!=="formatted"&&p.kind!=="resolvedImage"||w.kind!=="value"&&w.kind!=="string"){if(this.checkSubtype(p,w))return null}else c=a(c,p,n.typeAnnotation||"coerce");else c=a(c,p,n.typeAnnotation||"assert")}if(!(c instanceof Is)&&c.type.kind!=="resolvedImage"&&rc(c)){const p=new Ku(this._scope,this.options);try{c=new Is(c.type,c.evaluate(p))}catch(w){return this.error(w.message),null}}return c}return Na.parse(["to-array",e],this)}return this.error(e===void 0?"'undefined' value invalid. Use null instead.":typeof e=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof e} instead.`)}concat(e,n,a,d){let c=typeof e=="number"?this.path.concat(e):this.path;c=typeof n=="string"?c.concat(n):c;const p=d?this.scope.concat(d):this.scope;return new nh(this.registry,c,a||null,p,this.errors,this._scope,this.options)}error(e,...n){const a=`${this.key}${n.map(d=>`[${d}]`).join("")}`;this.errors.push(new Eo(a,e))}checkSubtype(e,n){const a=il(e,n);return a&&this.error(a),a}}var Wh=nh;function rc(s){if(s instanceof wc)return rc(s.boundExpression);if(s instanceof Ko&&s.name==="error"||s instanceof Dh||s instanceof $a||s instanceof pl||s instanceof bc)return!1;const e=s instanceof Na||s instanceof wa;let n=!0;return s.eachChild(a=>{n=e?n&&rc(a):n&&a instanceof Is}),!!n&&nc(s)&&Ll(s,["zoom","heatmap-density","line-progress","raster-value","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center","measure-light","raster-particle-speed"])}function gr(s,e){const n=s.length-1;let a,d,c=0,p=n,w=0;for(;c<=p;)if(w=Math.floor((c+p)/2),a=s[w],d=s[w+1],a<=e){if(w===n||e<d)return w;c=w+1}else{if(!(a>e))throw new _o("Input is not a number.");p=w-1}return 0}class qc{constructor(e,n,a){this.type=e,this.input=n,this.labels=[],this.outputs=[];for(const[d,c]of a)this.labels.push(d),this.outputs.push(c)}static parse(e,n){if(e.length-1<4)return n.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return n.error("Expected an even number of arguments.");const a=n.parse(e[1],1,qt);if(!a)return null;const d=[];let c=null;n.expectedType&&n.expectedType.kind!=="value"&&(c=n.expectedType);for(let p=1;p<e.length;p+=2){const w=p===1?-1/0:e[p],T=e[p+1],P=p,x=p+1;if(typeof w!="number")return n.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',P);if(d.length&&d[d.length-1][0]>=w)return n.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',P);const C=n.parse(T,x,c);if(!C)return null;c=c||C.type,d.push([w,C])}return new qc(c,a,d)}evaluate(e){const n=this.labels,a=this.outputs;if(n.length===1)return a[0].evaluate(e);const d=this.input.evaluate(e);if(d<=n[0])return a[0].evaluate(e);const c=n.length;return d>=n[c-1]?a[c-1].evaluate(e):a[gr(n,d)].evaluate(e)}eachChild(e){e(this.input);for(const n of this.outputs)e(n)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}serialize(){const e=["step",this.input.serialize()];for(let n=0;n<this.labels.length;n++)n>0&&e.push(this.labels[n]),e.push(this.outputs[n].serialize());return e}}const Dd=.95047,ic=1.08883,rh=4/29,Sc=6/29,Li=3*Sc*Sc,Mp=Sc*Sc*Sc,ih=Math.PI/180,Ap=180/Math.PI;function Pu(s){return s>Mp?Math.pow(s,1/3):s/Li+rh}function Zc(s){return s>Sc?s*s*s:Li*(s-rh)}function Qi(s){return 255*(s<=.0031308?12.92*s:1.055*Math.pow(s,1/2.4)-.055)}function Ru(s){return(s/=255)<=.04045?s/12.92:Math.pow((s+.055)/1.055,2.4)}function oc(s){const e=Ru(s.r),n=Ru(s.g),a=Ru(s.b),d=Pu((.4124564*e+.3575761*n+.1804375*a)/Dd),c=Pu((.2126729*e+.7151522*n+.072175*a)/1);return{l:116*c-16,a:500*(d-c),b:200*(c-Pu((.0193339*e+.119192*n+.9503041*a)/ic)),alpha:s.a}}function Ec(s){let e=(s.l+16)/116,n=isNaN(s.a)?e:e+s.a/500,a=isNaN(s.b)?e:e-s.b/200;return e=1*Zc(e),n=Dd*Zc(n),a=ic*Zc(a),new ir(Qi(3.2404542*n-1.5371385*e-.4985314*a),Qi(-.969266*n+1.8760108*e+.041556*a),Qi(.0556434*n-.2040259*e+1.0572252*a),s.alpha)}function Rf(s,e,n){const a=e-s;return s+n*(a>180||a<-180?a-360*Math.round(a/360):a)}const Xc={forward:oc,reverse:Ec,interpolate:function(s,e,n){return{l:kn(s.l,e.l,n),a:kn(s.a,e.a,n),b:kn(s.b,e.b,n),alpha:kn(s.alpha,e.alpha,n)}}},sc={forward:function(s){const{l:e,a:n,b:a}=oc(s),d=Math.atan2(a,n)*Ap;return{h:d<0?d+360:d,c:Math.sqrt(n*n+a*a),l:e,alpha:s.a}},reverse:function(s){const e=s.h*ih,n=s.c;return Ec({l:s.l,a:Math.cos(e)*n,b:Math.sin(e)*n,alpha:s.alpha})},interpolate:function(s,e,n){return{h:Rf(s.h,e.h,n),c:kn(s.c,e.c,n),l:kn(s.l,e.l,n),alpha:kn(s.alpha,e.alpha,n)}}};var ml=Object.freeze({__proto__:null,hcl:sc,lab:Xc});class _s{constructor(e,n,a,d,c,p){this.type=e,this.operator=n,this.interpolation=a,this.input=d,this.dynamicStops=c,this.labels=[],this.outputs=[];for(const[w,T]of p)this.labels.push(w),this.outputs.push(T)}static interpolationFactor(e,n,a,d){let c=0;if(e.name==="exponential")c=Gh(n,e.base,a,d);else if(e.name==="linear")c=Gh(n,1,a,d);else if(e.name==="cubic-bezier"){const p=e.controlPoints;c=new Nr(p[0],p[1],p[2],p[3]).solve(Gh(n,1,a,d))}return c}static parse(e,n){let[a,d,c,...p]=e;if(!Array.isArray(d)||d.length===0)return n.error("Expected an interpolation type expression.",1);if(d[0]==="linear")d={name:"linear"};else if(d[0]==="exponential"){const P=d[1];if(typeof P!="number")return n.error("Exponential interpolation requires a numeric base.",1,1);d={name:"exponential",base:P}}else{if(d[0]!=="cubic-bezier")return n.error(`Unknown interpolation type ${String(d[0])}`,1,0);{const P=d.slice(1);if(P.length!==4||P.some(x=>typeof x!="number"||x<0||x>1))return n.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);d={name:"cubic-bezier",controlPoints:P}}}if(e.length-1<3)return n.error(`Expected at least 3 arguments, but found only ${e.length-1}.`);if(e.length-1>3&&(e.length-1)%2!=0)return n.error("Expected an even number of arguments.");if(c=n.parse(c,2,qt),!c)return null;const w=[];let T=null;if(a==="interpolate-hcl"||a==="interpolate-lab"?T=ni:n.expectedType&&n.expectedType.kind!=="value"&&(T=n.expectedType),e.length-1==3){const P=n.parse(p[0],3,wr);return P?new _s(T,a,d,c,P,w):null}for(let P=0;P<p.length;P+=2){const x=p[P],C=p[P+1],A=P+3,E=P+4;if(typeof x!="number")return n.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',A);if(w.length&&w[w.length-1][0]>=x)return n.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',A);const M=n.parse(C,E,T);if(!M)return null;T=T||M.type,w.push([x,M])}return T.kind==="number"||T.kind==="color"||T.kind==="array"&&T.itemType.kind==="number"&&typeof T.N=="number"?new _s(T,a,d,c,null,w):n.error(`Type ${wi(T)} is not interpolatable.`)}evaluate(e){let n=this.labels,a=this.outputs;if(this.dynamicStops){const x=this.dynamicStops.evaluate(e);if(x.length%2!=0)throw new _o("Expected an even number of arguments.");n=[],a=[];for(let C=0;C<x.length;C+=2){const A=x[C],E=new Is(qt,x[C+1]);if(typeof A!="number")throw new _o('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.');if(n.length&&n[n.length-1]>=A)throw new _o('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.');n.push(A),a.push(E)}if(n.length===0)throw new _o("Expected at least one input/output pair.")}if(n.length===1)return a[0].evaluate(e);const d=this.input.evaluate(e);if(d<=n[0])return a[0].evaluate(e);const c=n.length;if(d>=n[c-1])return a[c-1].evaluate(e);const p=gr(n,d),w=_s.interpolationFactor(this.interpolation,d,n[p],n[p+1]),T=a[p].evaluate(e),P=a[p+1].evaluate(e);return this.operator==="interpolate"?yr[this.type.kind.toLowerCase()](T,P,w):this.operator==="interpolate-hcl"?sc.reverse(sc.interpolate(sc.forward(T),sc.forward(P),w)):Xc.reverse(Xc.interpolate(Xc.forward(T),Xc.forward(P),w))}eachChild(e){e(this.input);for(const n of this.outputs)e(n)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}serialize(){let e;e=this.interpolation.name==="linear"?["linear"]:this.interpolation.name==="exponential"?this.interpolation.base===1?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);const n=[this.operator,e,this.input.serialize()];if(this.dynamicStops)n.push(this.dynamicStops.serialize());else for(let a=0;a<this.labels.length;a++)n.push(this.labels[a],this.outputs[a].serialize());return n}}function Gh(s,e,n,a){const d=a-n,c=s-n;return d===0?0:e===1?c/d:(Math.pow(e,c)-1)/(Math.pow(e,d)-1)}class Yc{constructor(e,n){this.type=e,this.args=n}static parse(e,n){if(e.length<2)return n.error("Expectected at least one argument.");let a=null;const d=n.expectedType;d&&d.kind!=="value"&&(a=d);const c=[];for(const w of e.slice(1)){const T=n.parse(w,1+c.length,a,void 0,{typeAnnotation:"omit"});if(!T)return null;a=a||T.type,c.push(T)}const p=d&&c.some(w=>il(d,w.type));return new Yc(p?wr:a,c)}evaluate(e){let n,a=null,d=0;for(const c of this.args){if(d++,a=c.evaluate(e),a&&a instanceof Oo&&!a.available&&(n||(n=a),a=null,d===this.args.length))return n;if(a!==null)break}return a}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){const e=["coalesce"];return this.eachChild(n=>{e.push(n.serialize())}),e}}class ku{constructor(e,n){this.type=n.type,this.bindings=[].concat(e),this.result=n}evaluate(e){return this.result.evaluate(e)}eachChild(e){for(const n of this.bindings)e(n[1]);e(this.result)}static parse(e,n){if(e.length<4)return n.error(`Expected at least 3 arguments, but found ${e.length-1} instead.`);const a=[];for(let c=1;c<e.length-1;c+=2){const p=e[c];if(typeof p!="string")return n.error(`Expected string, but found ${typeof p} instead.`,c);if(/[^a-zA-Z0-9_]/.test(p))return n.error("Variable names must contain only alphanumeric characters or '_'.",c);const w=n.parse(e[c+1],c+1);if(!w)return null;a.push([p,w])}const d=n.parse(e[e.length-1],e.length-1,n.expectedType,a);return d?new ku(a,d):null}outputDefined(){return this.result.outputDefined()}serialize(){const e=["let"];for(const[n,a]of this.bindings)e.push(n,a.serialize());return e.push(this.result.serialize()),e}}class qh{constructor(e,n,a){this.type=e,this.index=n,this.input=a}static parse(e,n){if(e.length!==3)return n.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const a=n.parse(e[1],1,qt),d=n.parse(e[2],2,Lo(n.expectedType||wr));return a&&d?new qh(d.type.itemType,a,d):null}evaluate(e){const n=this.index.evaluate(e),a=this.input.evaluate(e);if(n<0)throw new _o(`Array index out of bounds: ${n} < 0.`);if(n>a.length-1)throw new _o(`Array index out of bounds: ${n} > ${a.length-1}.`);if(n===Math.floor(n))return a[n];const d=Math.floor(n),c=Math.ceil(n),p=a[d],w=a[c];if(typeof p!="number"||typeof w!="number")throw new _o(`Cannot interpolate between non-number values at index ${n}.`);const T=n-d;return p*(1-T)+w*T}eachChild(e){e(this.index),e(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}class Kc{constructor(e,n){this.type=Xn,this.needle=e,this.haystack=n}static parse(e,n){if(e.length!==3)return n.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const a=n.parse(e[1],1,wr),d=n.parse(e[2],2,wr);return a&&d?Yl(a.type,[Xn,Jn,qt,Kn,wr])?new Kc(a,d):n.error(`Expected first argument to be of type boolean, string, number or null, but found ${wi(a.type)} instead`):null}evaluate(e){const n=this.needle.evaluate(e),a=this.haystack.evaluate(e);if(a==null)return!1;if(!Kl(n,["boolean","string","number","null"]))throw new _o(`Expected first argument to be of type boolean, string, number or null, but found ${wi(zi(n))} instead.`);if(!Kl(a,["string","array"]))throw new _o(`Expected second argument to be of type array or string, but found ${wi(zi(a))} instead.`);return a.indexOf(n)>=0}eachChild(e){e(this.needle),e(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}class Jc{constructor(e,n,a){this.type=qt,this.needle=e,this.haystack=n,this.fromIndex=a}static parse(e,n){if(e.length<=2||e.length>=5)return n.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const a=n.parse(e[1],1,wr),d=n.parse(e[2],2,wr);if(!a||!d)return null;if(!Yl(a.type,[Xn,Jn,qt,Kn,wr]))return n.error(`Expected first argument to be of type boolean, string, number or null, but found ${wi(a.type)} instead`);if(e.length===4){const c=n.parse(e[3],3,qt);return c?new Jc(a,d,c):null}return new Jc(a,d)}evaluate(e){const n=this.needle.evaluate(e),a=this.haystack.evaluate(e);if(!Kl(n,["boolean","string","number","null"]))throw new _o(`Expected first argument to be of type boolean, string, number or null, but found ${wi(zi(n))} instead.`);if(!Kl(a,["string","array"]))throw new _o(`Expected second argument to be of type array or string, but found ${wi(zi(a))} instead.`);if(this.fromIndex){const d=this.fromIndex.evaluate(e);return a.indexOf(n,d)}return a.indexOf(n)}eachChild(e){e(this.needle),e(this.haystack),this.fromIndex&&e(this.fromIndex)}outputDefined(){return!1}serialize(){if(this.fromIndex!=null&&this.fromIndex!==void 0){const e=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),e]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}class Ol{constructor(e,n,a,d,c,p){this.inputType=e,this.type=n,this.input=a,this.cases=d,this.outputs=c,this.otherwise=p}static parse(e,n){if(e.length<5)return n.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if(e.length%2!=1)return n.error("Expected an even number of arguments.");let a,d;n.expectedType&&n.expectedType.kind!=="value"&&(d=n.expectedType);const c={},p=[];for(let P=2;P<e.length-1;P+=2){let x=e[P];const C=e[P+1];Array.isArray(x)||(x=[x]);const A=n.concat(P);if(x.length===0)return A.error("Expected at least one branch label.");for(const M of x){if(typeof M!="number"&&typeof M!="string")return A.error("Branch labels must be numbers or strings.");if(typeof M=="number"&&Math.abs(M)>Number.MAX_SAFE_INTEGER)return A.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof M=="number"&&Math.floor(M)!==M)return A.error("Numeric branch labels must be integer values.");if(a){if(A.checkSubtype(a,zi(M)))return null}else a=zi(M);if(c[String(M)]!==void 0)return A.error("Branch labels must be unique.");c[String(M)]=p.length}const E=n.parse(C,P,d);if(!E)return null;d=d||E.type,p.push(E)}const w=n.parse(e[1],1,wr);if(!w)return null;const T=n.parse(e[e.length-1],e.length-1,d);return T?w.type.kind!=="value"&&n.concat(1).checkSubtype(a,w.type)?null:new Ol(a,d,w,c,p,T):null}evaluate(e){const n=this.input.evaluate(e);return(zi(n)===this.inputType&&this.outputs[this.cases[n]]||this.otherwise).evaluate(e)}eachChild(e){e(this.input),this.outputs.forEach(e),e(this.otherwise)}outputDefined(){return this.outputs.every(e=>e.outputDefined())&&this.otherwise.outputDefined()}serialize(){const e=["match",this.input.serialize()],n=Object.keys(this.cases).sort(),a=[],d={};for(const p of n){const w=d[this.cases[p]];w===void 0?(d[this.cases[p]]=a.length,a.push([this.cases[p],[p]])):a[w][1].push(p)}const c=p=>this.inputType.kind==="number"?Number(p):p;for(const[p,w]of a)e.push(w.length===1?c(w[0]):w.map(c)),e.push(this.outputs[p].serialize());return e.push(this.otherwise.serialize()),e}}class Qc{constructor(e,n,a){this.type=e,this.branches=n,this.otherwise=a}static parse(e,n){if(e.length<4)return n.error(`Expected at least 3 arguments, but found only ${e.length-1}.`);if(e.length%2!=0)return n.error("Expected an odd number of arguments.");let a;n.expectedType&&n.expectedType.kind!=="value"&&(a=n.expectedType);const d=[];for(let p=1;p<e.length-1;p+=2){const w=n.parse(e[p],p,Xn);if(!w)return null;const T=n.parse(e[p+1],p+1,a);if(!T)return null;d.push([w,T]),a=a||T.type}const c=n.parse(e[e.length-1],e.length-1,a);return c?new Qc(a,d,c):null}evaluate(e){for(const[n,a]of this.branches)if(n.evaluate(e))return a.evaluate(e);return this.otherwise.evaluate(e)}eachChild(e){for(const[n,a]of this.branches)e(n),e(a);e(this.otherwise)}outputDefined(){return this.branches.every(([e,n])=>n.outputDefined())&&this.otherwise.outputDefined()}serialize(){const e=["case"];return this.eachChild(n=>{e.push(n.serialize())}),e}}class eu{constructor(e,n,a,d){this.type=e,this.input=n,this.beginIndex=a,this.endIndex=d}static parse(e,n){if(e.length<=2||e.length>=5)return n.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const a=n.parse(e[1],1,wr),d=n.parse(e[2],2,qt);if(!a||!d)return null;if(!Yl(a.type,[Lo(wr),Jn,wr]))return n.error(`Expected first argument to be of type array or string, but found ${wi(a.type)} instead`);if(e.length===4){const c=n.parse(e[3],3,qt);return c?new eu(a.type,a,d,c):null}return new eu(a.type,a,d)}evaluate(e){const n=this.input.evaluate(e),a=this.beginIndex.evaluate(e);if(!Kl(n,["string","array"]))throw new _o(`Expected first argument to be of type array or string, but found ${wi(zi(n))} instead.`);if(this.endIndex){const d=this.endIndex.evaluate(e);return n.slice(a,d)}return n.slice(a)}eachChild(e){e(this.input),e(this.beginIndex),this.endIndex&&e(this.endIndex)}outputDefined(){return!1}serialize(){if(this.endIndex!=null&&this.endIndex!==void 0){const e=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),e]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}function Zh(s,e){return s==="=="||s==="!="?e.kind==="boolean"||e.kind==="string"||e.kind==="number"||e.kind==="null"||e.kind==="value":e.kind==="string"||e.kind==="number"||e.kind==="value"}function kf(s,e,n,a){return a.compare(e,n)===0}function tu(s,e,n){const a=s!=="=="&&s!=="!=";return class eR{constructor(c,p,w){this.type=Xn,this.lhs=c,this.rhs=p,this.collator=w,this.hasUntypedArgument=c.type.kind==="value"||p.type.kind==="value"}static parse(c,p){if(c.length!==3&&c.length!==4)return p.error("Expected two or three arguments.");const w=c[0];let T=p.parse(c[1],1,wr);if(!T)return null;if(!Zh(w,T.type))return p.concat(1).error(`"${w}" comparisons are not supported for type '${wi(T.type)}'.`);let P=p.parse(c[2],2,wr);if(!P)return null;if(!Zh(w,P.type))return p.concat(2).error(`"${w}" comparisons are not supported for type '${wi(P.type)}'.`);if(T.type.kind!==P.type.kind&&T.type.kind!=="value"&&P.type.kind!=="value")return p.error(`Cannot compare types '${wi(T.type)}' and '${wi(P.type)}'.`);a&&(T.type.kind==="value"&&P.type.kind!=="value"?T=new wa(P.type,[T]):T.type.kind!=="value"&&P.type.kind==="value"&&(P=new wa(T.type,[P])));let x=null;if(c.length===4){if(T.type.kind!=="string"&&P.type.kind!=="string"&&T.type.kind!=="value"&&P.type.kind!=="value")return p.error("Cannot use collator to compare non-string types.");if(x=p.parse(c[3],3,rl),!x)return null}return new eR(T,P,x)}evaluate(c){const p=this.lhs.evaluate(c),w=this.rhs.evaluate(c);if(a&&this.hasUntypedArgument){const T=zi(p),P=zi(w);if(T.kind!==P.kind||T.kind!=="string"&&T.kind!=="number")throw new _o(`Expected arguments for "${s}" to be (string, string) or (number, number), but found (${T.kind}, ${P.kind}) instead.`)}if(this.collator&&!a&&this.hasUntypedArgument){const T=zi(p),P=zi(w);if(T.kind!=="string"||P.kind!=="string")return e(c,p,w)}return this.collator?n(c,p,w,this.collator.evaluate(c)):e(c,p,w)}eachChild(c){c(this.lhs),c(this.rhs),this.collator&&c(this.collator)}outputDefined(){return!0}serialize(){const c=[s];return this.eachChild(p=>{c.push(p.serialize())}),c}}}const oh=tu("==",function(s,e,n){return e===n},kf),nu=tu("!=",function(s,e,n){return e!==n},function(s,e,n,a){return!kf(0,e,n,a)}),Fd=tu("<",function(s,e,n){return e<n},function(s,e,n,a){return a.compare(e,n)<0}),Tc=tu(">",function(s,e,n){return e>n},function(s,e,n,a){return a.compare(e,n)>0}),zf=tu("<=",function(s,e,n){return e<=n},function(s,e,n,a){return a.compare(e,n)<=0}),Cc=tu(">=",function(s,e,n){return e>=n},function(s,e,n,a){return a.compare(e,n)>=0});class Ha{constructor(e,n,a,d,c,p){this.type=Jn,this.number=e,this.locale=n,this.currency=a,this.unit=d,this.minFractionDigits=c,this.maxFractionDigits=p}static parse(e,n){if(e.length!==3)return n.error("Expected two arguments.");const a=n.parse(e[1],1,qt);if(!a)return null;const d=e[2];if(typeof d!="object"||Array.isArray(d))return n.error("NumberFormat options argument must be an object.");let c=null;if(d.locale&&(c=n.parseObjectValue(d.locale,2,"locale",Jn),!c))return null;let p=null;if(d.currency&&(p=n.parseObjectValue(d.currency,2,"currency",Jn),!p))return null;let w=null;if(d.unit&&(w=n.parseObjectValue(d.unit,2,"unit",Jn),!w))return null;let T=null;if(d["min-fraction-digits"]&&(T=n.parseObjectValue(d["min-fraction-digits"],2,"min-fraction-digits",qt),!T))return null;let P=null;return d["max-fraction-digits"]&&(P=n.parseObjectValue(d["max-fraction-digits"],2,"max-fraction-digits",qt),!P)?null:new Ha(a,c,p,w,T,P)}evaluate(e){return new Intl.NumberFormat(this.locale?this.locale.evaluate(e):[],{style:(this.currency?"currency":this.unit&&"unit")||"decimal",currency:this.currency?this.currency.evaluate(e):void 0,unit:this.unit?this.unit.evaluate(e):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(e):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(e):void 0}).format(this.number.evaluate(e))}eachChild(e){e(this.number),this.locale&&e(this.locale),this.currency&&e(this.currency),this.unit&&e(this.unit),this.minFractionDigits&&e(this.minFractionDigits),this.maxFractionDigits&&e(this.maxFractionDigits)}outputDefined(){return!1}serialize(){const e={};return this.locale&&(e.locale=this.locale.serialize()),this.currency&&(e.currency=this.currency.serialize()),this.unit&&(e.unit=this.unit.serialize()),this.minFractionDigits&&(e["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(e["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),e]}}class Mc{constructor(e){this.type=qt,this.input=e}static parse(e,n){if(e.length!==2)return n.error(`Expected 1 argument, but found ${e.length-1} instead.`);const a=n.parse(e[1],1);return a?a.type.kind!=="array"&&a.type.kind!=="string"&&a.type.kind!=="value"?n.error(`Expected argument of type string or array, but found ${wi(a.type)} instead.`):new Mc(a):null}evaluate(e){const n=this.input.evaluate(e);if(typeof n=="string"||Array.isArray(n))return n.length;throw new _o(`Expected value to be of type string or array, but found ${wi(zi(n))} instead.`)}eachChild(e){e(this.input)}outputDefined(){return!1}serialize(){const e=["length"];return this.eachChild(n=>{e.push(n.serialize())}),e}}function Dl(s){return function(){s=1831565813+(s|=0)|0;let e=Math.imul(s^s>>>15,1|s);return e=e+Math.imul(e^e>>>7,61|e)^e,((e^e>>>14)>>>0)/4294967296}}const Ac={"==":oh,"!=":nu,">":Tc,"<":Fd,">=":Cc,"<=":zf,array:wa,at:qh,boolean:wa,case:Qc,coalesce:Yc,collator:Dh,format:Ba,image:al,in:Kc,"index-of":Jc,interpolate:_s,"interpolate-hcl":_s,"interpolate-lab":_s,length:Mc,let:ku,literal:Is,match:Ol,number:wa,"number-format":Ha,object:wa,slice:eu,step:qc,string:wa,"to-boolean":Na,"to-color":Na,"to-number":Na,"to-string":Na,var:wc,within:$a,distance:pl,config:bc};function Bd(s,[e,n,a,d]){e=e.evaluate(s),n=n.evaluate(s),a=a.evaluate(s);const c=d?d.evaluate(s):1,p=ol(e,n,a,c);if(p)throw new _o(p);return new ir(e/255*c,n/255*c,a/255*c,c)}function Nd(s,[e,n,a,d]){e=e.evaluate(s),n=n.evaluate(s),a=a.evaluate(s);const c=d?d.evaluate(s):1,p=function(P,x,C,A){return typeof P=="number"&&P>=0&&P<=360?typeof x=="number"&&x>=0&&x<=100&&typeof C=="number"&&C>=0&&C<=100?A===void 0||typeof A=="number"&&A>=0&&A<=1?null:`Invalid hsla value [${[P,x,C,A].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid hsla value [${(typeof A=="number"?[P,x,C,A]:[P,x,C]).join(", ")}]: 's', and 'l' must be between 0 and 100.`:`Invalid hsla value [${(typeof A=="number"?[P,x,C,A]:[P,x,C]).join(", ")}]: 'h' must be between 0 and 360.`}(e,n,a,c);if(p)throw new _o(p);const w=`hsla(${e}, ${n}%, ${a}%, ${c})`,T=ir.parse(w);if(!T)throw new _o(`Failed to parse HSLA color: ${w}`);return T}function Fl(s,e){return s in e}function ca(s,e){const n=e[s];return n===void 0?null:n}function ua(s){return{type:s}}function Wa(s){return{result:"success",value:s}}function gl(s){return{result:"error",value:s}}function Ga(s,e){return!!s&&!!s.parameters&&s.parameters.indexOf(e)>-1}function ha(s){return s["property-type"]==="data-driven"}function eo(s){return Ga(s.expression,"measure-light")}function to(s){return Ga(s.expression,"zoom")}function Ea(s){return!!s.expression&&s.expression.interpolated}function ys(s){return typeof s=="object"&&s!==null&&!Array.isArray(s)}function Qo(s){return s}function Ks(s,e){const n=e.type==="color",a=s.stops&&typeof s.stops[0][0]=="object",d=a||!(a||s.property!==void 0),c=s.type||(Ea(e)?"exponential":"interval");if(n&&((s=ia({},s)).stops&&(s.stops=s.stops.map(P=>[P[0],ir.parse(P[1])])),s.default=ir.parse(s.default?s.default:e.default)),s.colorSpace&&s.colorSpace!=="rgb"&&!ml[s.colorSpace])throw new Error(`Unknown color space: ${s.colorSpace}`);let p,w,T;if(c==="exponential")p=zu;else if(c==="interval")p=sh;else if(c==="categorical"){p=Js,w=Object.create(null);for(const P of s.stops)w[P[0]]=P[1];T=typeof s.stops[0][0]}else{if(c!=="identity")throw new Error(`Unknown function type "${c}"`);p=Lf}if(a){const P={},x=[];for(let E=0;E<s.stops.length;E++){const M=s.stops[E],k=M[0].zoom;P[k]===void 0&&(P[k]={zoom:k,type:s.type,property:s.property,default:s.default,stops:[]},x.push(k)),P[k].stops.push([M[0].value,M[1]])}const C=[];for(const E of x)C.push([P[E].zoom,Ks(P[E],e)]);const A={name:"linear"};return{kind:"composite",interpolationType:A,interpolationFactor:_s.interpolationFactor.bind(void 0,A),zoomStops:C.map(E=>E[0]),evaluate:({zoom:E},M)=>zu({stops:C,base:s.base},e,E).evaluate(E,M)}}if(d){const P=c==="exponential"?{name:"exponential",base:s.base!==void 0?s.base:1}:null;return{kind:"camera",interpolationType:P,interpolationFactor:_s.interpolationFactor.bind(void 0,P),zoomStops:s.stops.map(x=>x[0]),evaluate:({zoom:x})=>p(s,e,x,w,T)}}return{kind:"source",evaluate(P,x){const C=x&&x.properties?x.properties[s.property]:void 0;return C===void 0?Bl(s.default,e.default):p(s,e,C,w,T)}}}function Bl(s,e,n){return s!==void 0?s:e!==void 0?e:n!==void 0?n:void 0}function Js(s,e,n,a,d){return Bl(typeof n===d?a[n]:void 0,s.default,e.default)}function sh(s,e,n){if(ll(n)!=="number")return Bl(s.default,e.default);const a=s.stops.length;if(a===1||n<=s.stops[0][0])return s.stops[0][1];if(n>=s.stops[a-1][0])return s.stops[a-1][1];const d=gr(s.stops.map(c=>c[0]),n);return s.stops[d][1]}function zu(s,e,n){const a=s.base!==void 0?s.base:1;if(ll(n)!=="number")return Bl(s.default,e.default);const d=s.stops.length;if(d===1||n<=s.stops[0][0])return s.stops[0][1];if(n>=s.stops[d-1][0])return s.stops[d-1][1];const c=gr(s.stops.map(x=>x[0]),n),p=function(x,C,A,E){const M=E-A,k=x-A;return M===0?0:C===1?k/M:(Math.pow(C,k)-1)/(Math.pow(C,M)-1)}(n,a,s.stops[c][0],s.stops[c+1][0]),w=s.stops[c][1],T=s.stops[c+1][1];let P=yr[e.type]||Qo;if(s.colorSpace&&s.colorSpace!=="rgb"){const x=ml[s.colorSpace];P=(C,A)=>x.reverse(x.interpolate(x.forward(C),x.forward(A),p))}return typeof w.evaluate=="function"?{evaluate(...x){const C=w.evaluate.apply(void 0,x),A=T.evaluate.apply(void 0,x);if(C!==void 0&&A!==void 0)return P(C,A,p)}}:P(w,T,p)}function Lf(s,e,n){return e.type==="color"?n=ir.parse(n):e.type==="formatted"?n=fs.fromString(n.toString()):e.type==="resolvedImage"?n=Oo.build(n.toString()):ll(n)===e.type||e.type==="enum"&&e.values[n]||(n=void 0),Bl(n,s.default,e.default)}Ko.register(Ac,{error:[{kind:"error"},[Jn],(s,[e])=>{throw new _o(e.evaluate(s))}],typeof:[Jn,[wr],(s,[e])=>wi(zi(e.evaluate(s)))],"to-rgba":[Lo(qt,4),[ni],(s,[e])=>e.evaluate(s).toRenderColor(null).toArray()],"to-hsla":[Lo(qt,4),[ni],(s,[e])=>e.evaluate(s).toRenderColor(null).toHslaArray()],rgb:[ni,[qt,qt,qt],Bd],rgba:[ni,[qt,qt,qt,qt],Bd],hsl:[ni,[qt,qt,qt],Nd],hsla:[ni,[qt,qt,qt,qt],Nd],has:{type:Xn,overloads:[[[Jn],(s,[e])=>Fl(e.evaluate(s),s.properties())],[[Jn,ba],(s,[e,n])=>Fl(e.evaluate(s),n.evaluate(s))]]},get:{type:wr,overloads:[[[Jn],(s,[e])=>ca(e.evaluate(s),s.properties())],[[Jn,ba],(s,[e,n])=>ca(e.evaluate(s),n.evaluate(s))]]},"feature-state":[wr,[Jn],(s,[e])=>ca(e.evaluate(s),s.featureState||{})],properties:[ba,[],s=>s.properties()],"geometry-type":[Jn,[],s=>s.geometryType()],id:[wr,[],s=>s.id()],zoom:[qt,[],s=>s.globals.zoom],pitch:[qt,[],s=>s.globals.pitch||0],"distance-from-center":[qt,[],s=>s.distanceFromCenter()],"measure-light":[qt,[Jn],(s,[e])=>s.measureLight(e.evaluate(s))],"heatmap-density":[qt,[],s=>s.globals.heatmapDensity||0],"line-progress":[qt,[],s=>s.globals.lineProgress||0],"raster-value":[qt,[],s=>s.globals.rasterValue||0],"raster-particle-speed":[qt,[],s=>s.globals.rasterParticleSpeed||0],"sky-radial-progress":[qt,[],s=>s.globals.skyRadialProgress||0],accumulated:[wr,[],s=>s.globals.accumulated===void 0?null:s.globals.accumulated],"+":[qt,ua(qt),(s,e)=>{let n=0;for(const a of e)n+=a.evaluate(s);return n}],"*":[qt,ua(qt),(s,e)=>{let n=1;for(const a of e)n*=a.evaluate(s);return n}],"-":{type:qt,overloads:[[[qt,qt],(s,[e,n])=>e.evaluate(s)-n.evaluate(s)],[[qt],(s,[e])=>-e.evaluate(s)]]},"/":[qt,[qt,qt],(s,[e,n])=>e.evaluate(s)/n.evaluate(s)],"%":[qt,[qt,qt],(s,[e,n])=>e.evaluate(s)%n.evaluate(s)],ln2:[qt,[],()=>Math.LN2],pi:[qt,[],()=>Math.PI],e:[qt,[],()=>Math.E],"^":[qt,[qt,qt],(s,[e,n])=>Math.pow(e.evaluate(s),n.evaluate(s))],sqrt:[qt,[qt],(s,[e])=>Math.sqrt(e.evaluate(s))],log10:[qt,[qt],(s,[e])=>Math.log(e.evaluate(s))/Math.LN10],ln:[qt,[qt],(s,[e])=>Math.log(e.evaluate(s))],log2:[qt,[qt],(s,[e])=>Math.log(e.evaluate(s))/Math.LN2],sin:[qt,[qt],(s,[e])=>Math.sin(e.evaluate(s))],cos:[qt,[qt],(s,[e])=>Math.cos(e.evaluate(s))],tan:[qt,[qt],(s,[e])=>Math.tan(e.evaluate(s))],asin:[qt,[qt],(s,[e])=>Math.asin(e.evaluate(s))],acos:[qt,[qt],(s,[e])=>Math.acos(e.evaluate(s))],atan:[qt,[qt],(s,[e])=>Math.atan(e.evaluate(s))],min:[qt,ua(qt),(s,e)=>Math.min(...e.map(n=>n.evaluate(s)))],max:[qt,ua(qt),(s,e)=>Math.max(...e.map(n=>n.evaluate(s)))],abs:[qt,[qt],(s,[e])=>Math.abs(e.evaluate(s))],round:[qt,[qt],(s,[e])=>{const n=e.evaluate(s);return n<0?-Math.round(-n):Math.round(n)}],floor:[qt,[qt],(s,[e])=>Math.floor(e.evaluate(s))],ceil:[qt,[qt],(s,[e])=>Math.ceil(e.evaluate(s))],"filter-==":[Xn,[Jn,wr],(s,[e,n])=>s.properties()[e.value]===n.value],"filter-id-==":[Xn,[wr],(s,[e])=>s.id()===e.value],"filter-type-==":[Xn,[Jn],(s,[e])=>s.geometryType()===e.value],"filter-<":[Xn,[Jn,wr],(s,[e,n])=>{const a=s.properties()[e.value],d=n.value;return typeof a==typeof d&&a<d}],"filter-id-<":[Xn,[wr],(s,[e])=>{const n=s.id(),a=e.value;return typeof n==typeof a&&n<a}],"filter->":[Xn,[Jn,wr],(s,[e,n])=>{const a=s.properties()[e.value],d=n.value;return typeof a==typeof d&&a>d}],"filter-id->":[Xn,[wr],(s,[e])=>{const n=s.id(),a=e.value;return typeof n==typeof a&&n>a}],"filter-<=":[Xn,[Jn,wr],(s,[e,n])=>{const a=s.properties()[e.value],d=n.value;return typeof a==typeof d&&a<=d}],"filter-id-<=":[Xn,[wr],(s,[e])=>{const n=s.id(),a=e.value;return typeof n==typeof a&&n<=a}],"filter->=":[Xn,[Jn,wr],(s,[e,n])=>{const a=s.properties()[e.value],d=n.value;return typeof a==typeof d&&a>=d}],"filter-id->=":[Xn,[wr],(s,[e])=>{const n=s.id(),a=e.value;return typeof n==typeof a&&n>=a}],"filter-has":[Xn,[wr],(s,[e])=>e.value in s.properties()],"filter-has-id":[Xn,[],s=>s.id()!==null&&s.id()!==void 0],"filter-type-in":[Xn,[Lo(Jn)],(s,[e])=>e.value.indexOf(s.geometryType())>=0],"filter-id-in":[Xn,[Lo(wr)],(s,[e])=>e.value.indexOf(s.id())>=0],"filter-in-small":[Xn,[Jn,Lo(wr)],(s,[e,n])=>n.value.indexOf(s.properties()[e.value])>=0],"filter-in-large":[Xn,[Jn,Lo(wr)],(s,[e,n])=>function(a,d,c,p){for(;c<=p;){const w=c+p>>1;if(d[w]===a)return!0;d[w]>a?p=w-1:c=w+1}return!1}(s.properties()[e.value],n.value,0,n.value.length-1)],all:{type:Xn,overloads:[[[Xn,Xn],(s,[e,n])=>e.evaluate(s)&&n.evaluate(s)],[ua(Xn),(s,e)=>{for(const n of e)if(!n.evaluate(s))return!1;return!0}]]},any:{type:Xn,overloads:[[[Xn,Xn],(s,[e,n])=>e.evaluate(s)||n.evaluate(s)],[ua(Xn),(s,e)=>{for(const n of e)if(n.evaluate(s))return!0;return!1}]]},"!":[Xn,[Xn],(s,[e])=>!e.evaluate(s)],"is-supported-script":[Xn,[Jn],(s,[e])=>{const n=s.globals&&s.globals.isSupportedScript;return!n||n(e.evaluate(s))}],upcase:[Jn,[Jn],(s,[e])=>e.evaluate(s).toUpperCase()],downcase:[Jn,[Jn],(s,[e])=>e.evaluate(s).toLowerCase()],concat:[Jn,ua(wr),(s,e)=>e.map(n=>To(n.evaluate(s))).join("")],"resolved-locale":[Jn,[rl],(s,[e])=>e.evaluate(s).resolvedLocale()],random:[qt,[qt,qt,wr],(s,e)=>{const[n,a,d]=e.map(p=>p.evaluate(s));if(n>a||n===a)return n;let c;if(typeof d=="string")c=function(p){let w=0;if(p.length===0)return w;for(let T=0;T<p.length;T++)w=(w<<5)-w+p.charCodeAt(T),w|=0;return w}(d);else{if(typeof d!="number")throw new _o(`Invalid seed input: ${d}`);c=d}return n+Dl(c)()*(a-n)}]});class ru{constructor(e,n,a,d){this.expression=e,this._warningHistory={},this._evaluator=new Ku(a,d),this._defaultValue=n?function(c){return c.type==="color"&&(ys(c.default)||Array.isArray(c.default))?new ir(0,0,0,0):c.type==="color"?ir.parse(c.default)||null:c.default===void 0?null:c.default}(n):null,this._enumValues=n&&n.type==="enum"?n.values:null,this.configDependencies=zl(e)}evaluateWithoutErrorHandling(e,n,a,d,c,p,w,T){return this._evaluator.globals=e,this._evaluator.feature=n,this._evaluator.featureState=a,this._evaluator.canonical=d||null,this._evaluator.availableImages=c||null,this._evaluator.formattedSection=p,this._evaluator.featureTileCoord=w||null,this._evaluator.featureDistanceData=T||null,this.expression.evaluate(this._evaluator)}evaluate(e,n,a,d,c,p,w,T){this._evaluator.globals=e,this._evaluator.feature=n||null,this._evaluator.featureState=a||null,this._evaluator.canonical=d||null,this._evaluator.availableImages=c||null,this._evaluator.formattedSection=p||null,this._evaluator.featureTileCoord=w||null,this._evaluator.featureDistanceData=T||null;try{const P=this.expression.evaluate(this._evaluator);if(P==null||typeof P=="number"&&P!=P)return this._defaultValue;if(this._enumValues&&!(P in this._enumValues))throw new _o(`Expected value to be one of ${Object.keys(this._enumValues).map(x=>JSON.stringify(x)).join(", ")}, but found ${JSON.stringify(P)} instead.`);return P}catch(P){return this._warningHistory[P.message]||(this._warningHistory[P.message]=!0,typeof console<"u"&&console.warn(`Failed to evaluate expression "${JSON.stringify(this.expression.serialize())}". ${P.message}`)),this._defaultValue}}}function Xh(s){return Array.isArray(s)&&s.length>0&&typeof s[0]=="string"&&s[0]in Ac}function Ta(s,e,n,a){const d=new Wh(Ac,[],e?function(p){const w={color:ni,string:Jn,number:qt,enum:Jn,boolean:Xn,formatted:ds,resolvedImage:oa};return p.type==="array"?Lo(w[p.value]||wr,p.length):w[p.type]}(e):void 0,void 0,void 0,n,a),c=d.parse(s,void 0,void 0,void 0,e&&e.type==="string"?{typeAnnotation:"coerce"}:void 0);return c?Wa(new ru(c,e,n,a)):gl(d.errors)}class Ic{constructor(e,n,a,d){this.kind=e,this._styleExpression=n,this.isLightConstant=a,this.isLineProgressConstant=d,this.isStateDependent=e!=="constant"&&!Sa(n.expression),this.configDependencies=zl(n.expression)}evaluateWithoutErrorHandling(e,n,a,d,c,p){return this._styleExpression.evaluateWithoutErrorHandling(e,n,a,d,c,p)}evaluate(e,n,a,d,c,p){return this._styleExpression.evaluate(e,n,a,d,c,p)}}class _l{constructor(e,n,a,d,c,p){this.kind=e,this.zoomStops=a,this._styleExpression=n,this.isStateDependent=e!=="camera"&&!Sa(n.expression),this.isLightConstant=c,this.isLineProgressConstant=p,this.configDependencies=zl(n.expression),this.interpolationType=d}evaluateWithoutErrorHandling(e,n,a,d,c,p){return this._styleExpression.evaluateWithoutErrorHandling(e,n,a,d,c,p)}evaluate(e,n,a,d,c,p){return this._styleExpression.evaluate(e,n,a,d,c,p)}interpolationFactor(e,n,a){return this.interpolationType?_s.interpolationFactor(this.interpolationType,e,n,a):0}}function Lu(s,e,n,a){if((s=Ta(s,e,n,a)).result==="error")return s;const d=s.value.expression,c=nc(d);if(!c&&!ha(e))return gl([new Eo("","data expressions not supported")]);const p=Ll(d,["zoom","pitch","distance-from-center"]);if(!p&&!to(e))return gl([new Eo("","zoom expressions not supported")]);const w=Ll(d,["measure-light"]);if(!w&&!eo(e))return gl([new Eo("","measure-light expression not supported")]);const T=Ll(d,["line-progress"]);if(!T&&!function(C){return Ga(C.expression,"line-progress")}(e))return gl([new Eo("","line-progress expression not supported")]);const P=e.expression&&e.expression.relaxZoomRestriction,x=yl(d);return x||p||P?x instanceof Eo?gl([x]):x instanceof _s&&!Ea(e)?gl([new Eo("",'"interpolate" expressions cannot be used with this property')]):Wa(x?new _l(c&&T?"camera":"composite",s.value,x.labels,x instanceof _s?x.interpolation:void 0,w,T):new Ic(c&&T?"constant":"source",s.value,w,T)):gl([new Eo("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression, or in the properties of atmosphere.')])}class Yh{constructor(e,n){this._parameters=e,this._specification=n,ia(this,Ks(this._parameters,this._specification))}static deserialize(e){return new Yh(e._parameters,e._specification)}static serialize(e){return{_parameters:e._parameters,_specification:e._specification}}}function yl(s){let e=null;if(s instanceof ku)e=yl(s.result);else if(s instanceof Yc){for(const n of s.args)if(e=yl(n),e)break}else(s instanceof qc||s instanceof _s)&&s.input instanceof Ko&&s.input.name==="zoom"&&(e=s);return e instanceof Eo||s.eachChild(n=>{const a=yl(n);a instanceof Eo?e=a:e&&a&&e!==a&&(e=new Eo("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),e}var Ca,xe,$=function(){if(xe)return Ca;xe=1,Ca=e;var s=3;function e(n,a,d){var c=this.cells=[];if(n instanceof ArrayBuffer){this.arrayBuffer=n;var p=new Int32Array(this.arrayBuffer);n=p[0],this.d=(a=p[1])+2*(d=p[2]);for(var w=0;w<this.d*this.d;w++){var T=p[s+w],P=p[s+w+1];c.push(T===P?null:p.subarray(T,P))}var x=p[s+c.length+1];this.keys=p.subarray(p[s+c.length],x),this.bboxes=p.subarray(x),this.insert=this._insertReadonly}else{this.d=a+2*d;for(var C=0;C<this.d*this.d;C++)c.push([]);this.keys=[],this.bboxes=[]}this.n=a,this.extent=n,this.padding=d,this.scale=a/n,this.uid=0;var A=d/a*n;this.min=-A,this.max=n+A}return e.prototype.insert=function(n,a,d,c,p){this._forEachCell(a,d,c,p,this._insertCell,this.uid++),this.keys.push(n),this.bboxes.push(a),this.bboxes.push(d),this.bboxes.push(c),this.bboxes.push(p)},e.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},e.prototype._insertCell=function(n,a,d,c,p,w){this.cells[p].push(w)},e.prototype.query=function(n,a,d,c,p){var w=this.min,T=this.max;if(n<=w&&a<=w&&T<=d&&T<=c&&!p)return Array.prototype.slice.call(this.keys);var P=[];return this._forEachCell(n,a,d,c,this._queryCell,P,{},p),P},e.prototype._queryCell=function(n,a,d,c,p,w,T,P){var x=this.cells[p];if(x!==null)for(var C=this.keys,A=this.bboxes,E=0;E<x.length;E++){var M=x[E];if(T[M]===void 0){var k=4*M;(P?P(A[k+0],A[k+1],A[k+2],A[k+3]):n<=A[k+2]&&a<=A[k+3]&&d>=A[k+0]&&c>=A[k+1])?(T[M]=!0,w.push(C[M])):T[M]=!1}}},e.prototype._forEachCell=function(n,a,d,c,p,w,T,P){for(var x=this._convertToCellCoord(n),C=this._convertToCellCoord(a),A=this._convertToCellCoord(d),E=this._convertToCellCoord(c),M=x;M<=A;M++)for(var k=C;k<=E;k++){var N=this.d*k+M;if((!P||P(this._convertFromCellCoord(M),this._convertFromCellCoord(k),this._convertFromCellCoord(M+1),this._convertFromCellCoord(k+1)))&&p.call(this,n,a,d,c,N,w,T,P))return}},e.prototype._convertFromCellCoord=function(n){return(n-this.padding)/this.scale},e.prototype._convertToCellCoord=function(n){return Math.max(0,Math.min(this.d-1,Math.floor(n*this.scale)+this.padding))},e.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var n=this.cells,a=s+this.cells.length+1+1,d=0,c=0;c<this.cells.length;c++)d+=this.cells[c].length;var p=new Int32Array(a+d+this.keys.length+this.bboxes.length);p[0]=this.extent,p[1]=this.n,p[2]=this.padding;for(var w=a,T=0;T<n.length;T++){var P=n[T];p[s+T]=w,p.set(P,w),w+=P.length}return p[s+n.length]=w,p.set(this.keys,w),p[s+n.length+1]=w+=this.keys.length,p.set(this.bboxes,w),w+=this.bboxes.length,p.buffer},Ca}(),ae=H($);const De={};function qe(s,e,n={}){Object.defineProperty(s,"_classRegistryKey",{value:e,writable:!1}),De[e]={klass:s,omit:n.omit||[]}}qe(Object,"Object"),ae.serialize=function(s,e){const n=s.toArrayBuffer();return e&&e.add(n),{buffer:n}},ae.deserialize=function(s){return new ae(s.buffer)},Object.defineProperty(ae,"name",{value:"Grid"}),qe(ae,"Grid"),typeof DOMMatrix<"u"&&qe(DOMMatrix,"DOMMatrix"),qe(ir,"Color"),qe(Error,"Error"),qe(fs,"Formatted"),qe(Os,"FormattedSection"),qe(Il,"AJAXError"),qe(Oo,"ResolvedImage"),qe(Yh,"StylePropertyFunction"),qe(ru,"StyleExpression",{omit:["_evaluator"]}),qe(sa,"ImageIdWithOptions"),qe(_l,"ZoomDependentExpression"),qe(Ic,"ZoomConstantExpression"),qe(Ko,"CompoundExpression",{omit:["_evaluate"]});for(const s in Ac)De[Ac[s]._classRegistryKey]||qe(Ac[s],`Expression${s}`);function Dt(s){return s&&typeof ArrayBuffer<"u"&&(s instanceof ArrayBuffer||s.constructor&&s.constructor.name==="ArrayBuffer")}function Qt(s){return self.ImageBitmap&&s instanceof ImageBitmap}function mn(s,e){if(s==null||typeof s=="boolean"||typeof s=="number"||typeof s=="string"||s instanceof Boolean||s instanceof Number||s instanceof String||s instanceof Date||s instanceof RegExp)return s;if(Dt(s)||Qt(s))return e&&e.add(s),s;if(ArrayBuffer.isView(s))return e&&e.add(s.buffer),s;if(s instanceof ImageData)return e&&e.add(s.data.buffer),s;if(Array.isArray(s)){const n=[];for(const a of s)n.push(mn(a,e));return n}if(s instanceof Map){const n={$name:"Map"};for(const[a,d]of s.entries())n[a]=mn(d);return n}if(s instanceof Set){const n={$name:"Set"};let a=0;for(const d of s.values())n[++a]=mn(d);return n}if(typeof s=="object"){const n=s.constructor,a=n._classRegistryKey;if(!a)throw new Error(`Can't serialize object of unregistered class "${a}".`);const d=n.serialize?n.serialize(s,e):{};if(!n.serialize){for(const c in s)s.hasOwnProperty(c)&&(De[a].omit.indexOf(c)>=0||(d[c]=mn(s[c],e)));s instanceof Error&&(d.message=s.message)}if(d.$name)throw new Error("$name property is reserved for worker serialization logic.");return a!=="Object"&&(d.$name=a),d}throw new Error("can't serialize object of type "+typeof s)}function An(s){if(s==null||typeof s=="boolean"||typeof s=="number"||typeof s=="string"||s instanceof Boolean||s instanceof Number||s instanceof String||s instanceof Date||s instanceof RegExp||Dt(s)||Qt(s)||ArrayBuffer.isView(s)||s instanceof ImageData)return s;if(Array.isArray(s))return s.map(An);if(typeof s=="object"){const e=s.$name||"Object";if(e==="Map"){const d=new Map;for(const c of Object.keys(s))c!=="$name"&&d.set(c,An(s[c]));return d}if(e==="Set"){const d=new Set;for(const c of Object.keys(s))c!=="$name"&&d.add(An(s[c]));return d}const{klass:n}=De[e];if(!n)throw new Error(`Can't deserialize unregistered class "${e}".`);if(n.deserialize)return n.deserialize(s);const a=Object.create(n.prototype);for(const d of Object.keys(s))d!=="$name"&&(a[d]=An(s[d]));return a}throw new Error("can't deserialize object of type "+typeof s)}const Xt={"Latin-1 Supplement":s=>s>=128&&s<=255,Arabic:s=>s>=1536&&s<=1791,"Arabic Supplement":s=>s>=1872&&s<=1919,"Arabic Extended-A":s=>s>=2208&&s<=2303,"Hangul Jamo":s=>s>=4352&&s<=4607,"Unified Canadian Aboriginal Syllabics":s=>s>=5120&&s<=5759,Khmer:s=>s>=6016&&s<=6143,"Unified Canadian Aboriginal Syllabics Extended":s=>s>=6320&&s<=6399,"General Punctuation":s=>s>=8192&&s<=8303,"Letterlike Symbols":s=>s>=8448&&s<=8527,"Number Forms":s=>s>=8528&&s<=8591,"Miscellaneous Technical":s=>s>=8960&&s<=9215,"Control Pictures":s=>s>=9216&&s<=9279,"Optical Character Recognition":s=>s>=9280&&s<=9311,"Enclosed Alphanumerics":s=>s>=9312&&s<=9471,"Geometric Shapes":s=>s>=9632&&s<=9727,"Miscellaneous Symbols":s=>s>=9728&&s<=9983,"Miscellaneous Symbols and Arrows":s=>s>=11008&&s<=11263,"CJK Radicals Supplement":s=>s>=11904&&s<=12031,"Kangxi Radicals":s=>s>=12032&&s<=12255,"Ideographic Description Characters":s=>s>=12272&&s<=12287,"CJK Symbols and Punctuation":s=>s>=12288&&s<=12351,Hiragana:s=>s>=12352&&s<=12447,Katakana:s=>s>=12448&&s<=12543,Bopomofo:s=>s>=12544&&s<=12591,"Hangul Compatibility Jamo":s=>s>=12592&&s<=12687,Kanbun:s=>s>=12688&&s<=12703,"Bopomofo Extended":s=>s>=12704&&s<=12735,"CJK Strokes":s=>s>=12736&&s<=12783,"Katakana Phonetic Extensions":s=>s>=12784&&s<=12799,"Enclosed CJK Letters and Months":s=>s>=12800&&s<=13055,"CJK Compatibility":s=>s>=13056&&s<=13311,"CJK Unified Ideographs Extension A":s=>s>=13312&&s<=19903,"Yijing Hexagram Symbols":s=>s>=19904&&s<=19967,"CJK Unified Ideographs":s=>s>=19968&&s<=40959,"Yi Syllables":s=>s>=40960&&s<=42127,"Yi Radicals":s=>s>=42128&&s<=42191,"Hangul Jamo Extended-A":s=>s>=43360&&s<=43391,"Hangul Syllables":s=>s>=44032&&s<=55215,"Hangul Jamo Extended-B":s=>s>=55216&&s<=55295,"Private Use Area":s=>s>=57344&&s<=63743,"CJK Compatibility Ideographs":s=>s>=63744&&s<=64255,"Arabic Presentation Forms-A":s=>s>=64336&&s<=65023,"Vertical Forms":s=>s>=65040&&s<=65055,"CJK Compatibility Forms":s=>s>=65072&&s<=65103,"Small Form Variants":s=>s>=65104&&s<=65135,"Arabic Presentation Forms-B":s=>s>=65136&&s<=65279,"Halfwidth and Fullwidth Forms":s=>s>=65280&&s<=65519,Osage:s=>s>=66736&&s<=66815,"CJK Unified Ideographs Extension B":s=>s>=131072&&s<=173791};function Qn(s){for(const e of s)if(cr(e.charCodeAt(0)))return!0;return!1}function qn(s){for(const e of s)if(!Rr(e.charCodeAt(0)))return!1;return!0}function Rr(s){return!(Xt.Arabic(s)||Xt["Arabic Supplement"](s)||Xt["Arabic Extended-A"](s)||Xt["Arabic Presentation Forms-A"](s)||Xt["Arabic Presentation Forms-B"](s))}function cr(s){return!(s!==746&&s!==747&&(s<4352||!(Xt["Bopomofo Extended"](s)||Xt.Bopomofo(s)||Xt["CJK Compatibility Forms"](s)&&!(s>=65097&&s<=65103)||Xt["CJK Compatibility Ideographs"](s)||Xt["CJK Compatibility"](s)||Xt["CJK Radicals Supplement"](s)||Xt["CJK Strokes"](s)||!(!Xt["CJK Symbols and Punctuation"](s)||s>=12296&&s<=12305||s>=12308&&s<=12319||s===12336)||Xt["CJK Unified Ideographs Extension A"](s)||Xt["CJK Unified Ideographs"](s)||Xt["Enclosed CJK Letters and Months"](s)||Xt["Hangul Compatibility Jamo"](s)||Xt["Hangul Jamo Extended-A"](s)||Xt["Hangul Jamo Extended-B"](s)||Xt["Hangul Jamo"](s)||Xt["Hangul Syllables"](s)||Xt.Hiragana(s)||Xt["Ideographic Description Characters"](s)||Xt.Kanbun(s)||Xt["Kangxi Radicals"](s)||Xt["Katakana Phonetic Extensions"](s)||Xt.Katakana(s)&&s!==12540||!(!Xt["Halfwidth and Fullwidth Forms"](s)||s===65288||s===65289||s===65293||s>=65306&&s<=65310||s===65339||s===65341||s===65343||s>=65371&&s<=65503||s===65507||s>=65512&&s<=65519)||!(!Xt["Small Form Variants"](s)||s>=65112&&s<=65118||s>=65123&&s<=65126)||Xt["Unified Canadian Aboriginal Syllabics"](s)||Xt["Unified Canadian Aboriginal Syllabics Extended"](s)||Xt["Vertical Forms"](s)||Xt["Yijing Hexagram Symbols"](s)||Xt["Yi Syllables"](s)||Xt["Yi Radicals"](s))))}function er(s){return!(cr(s)||function(e){return!!(Xt["Latin-1 Supplement"](e)&&(e===167||e===169||e===174||e===177||e===188||e===189||e===190||e===215||e===247)||Xt["General Punctuation"](e)&&(e===8214||e===8224||e===8225||e===8240||e===8241||e===8251||e===8252||e===8258||e===8263||e===8264||e===8265||e===8273)||Xt["Letterlike Symbols"](e)||Xt["Number Forms"](e)||Xt["Miscellaneous Technical"](e)&&(e>=8960&&e<=8967||e>=8972&&e<=8991||e>=8996&&e<=9e3||e===9003||e>=9085&&e<=9114||e>=9150&&e<=9165||e===9167||e>=9169&&e<=9179||e>=9186&&e<=9215)||Xt["Control Pictures"](e)&&e!==9251||Xt["Optical Character Recognition"](e)||Xt["Enclosed Alphanumerics"](e)||Xt["Geometric Shapes"](e)||Xt["Miscellaneous Symbols"](e)&&!(e>=9754&&e<=9759)||Xt["Miscellaneous Symbols and Arrows"](e)&&(e>=11026&&e<=11055||e>=11088&&e<=11097||e>=11192&&e<=11243)||Xt["CJK Symbols and Punctuation"](e)||Xt.Katakana(e)||Xt["Private Use Area"](e)||Xt["CJK Compatibility Forms"](e)||Xt["Small Form Variants"](e)||Xt["Halfwidth and Fullwidth Forms"](e)||e===8734||e===8756||e===8757||e>=9984&&e<=10087||e>=10102&&e<=10131||e===65532||e===65533)}(s))}function vr(s){return s>=1424&&s<=2303||Xt["Arabic Presentation Forms-A"](s)||Xt["Arabic Presentation Forms-B"](s)}function Kr(s,e){return!(!e&&vr(s)||s>=2304&&s<=3583||s>=3840&&s<=4255||Xt.Khmer(s))}function Xi(s){for(const e of s)if(vr(e.charCodeAt(0)))return!0;return!1}const bi="deferred",di="loading",Ii="loaded";let Jr=null,jr="unavailable",ri=null;const Fi=function(s){s&&typeof s=="string"&&s.indexOf("NetworkError")>-1&&(jr="error"),Jr&&Jr(s)};function Pi(){no.fire(new hi("pluginStateChange",{pluginStatus:jr,pluginURL:ri}))}const no=new go,Ps=function(){return jr},Ma=function(){if(jr!==bi||!ri)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");jr=di,Pi(),ri&&Yo({url:ri},s=>{s?Fi(s):(jr=Ii,Pi())})},Yi={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>jr===Ii||Yi.applyArabicShaping!=null,isLoading:()=>jr===di,setState(s){jr=s.pluginStatus,ri=s.pluginURL},isParsed:()=>Yi.applyArabicShaping!=null&&Yi.processBidirectionalText!=null&&Yi.processStyledBidirectionalText!=null,getPluginURL:()=>ri};class qr{constructor(e,n){this.zoom=e,n?(this.now=n.now,this.fadeDuration=n.fadeDuration,this.transition=n.transition,this.pitch=n.pitch,this.brightness=n.brightness):(this.now=0,this.fadeDuration=0,this.transition={},this.pitch=0,this.brightness=0)}isSupportedScript(e){return function(n,a){for(const d of n)if(!Kr(d.charCodeAt(0),a))return!1;return!0}(e,Yi.isLoaded())}}class Ds{constructor(e,n,a,d){this.property=e,this.value=n,this.expression=function(c,p,w,T){if(ys(c))return new Yh(c,p);if(Xh(c)||Array.isArray(c)&&c.length>0){const P=Lu(c,p,w,T);if(P.result==="error")throw new Error(P.value.map(x=>`${x.key}: ${x.message}`).join(", "));return P.value}{let P=c;return typeof c=="string"&&p.type==="color"&&(P=ir.parse(c)),{kind:"constant",configDependencies:new Set,evaluate:()=>P}}}(n===void 0?e.specification.default:n,e.specification,a,d)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(e,n,a){return this.property.possiblyEvaluate(this,e,n,a)}}class Hi{constructor(e,n,a){this.property=e,this.value=new Ds(e,void 0,n,a)}transitioned(e,n){return new Us(this.property,this.value,n,Lr({},e.transition,this.transition),e.now)}untransitioned(){return new Us(this.property,this.value,null,{},0)}}class vs{constructor(e,n,a){this._properties=e,this._values=Object.create(e.defaultTransitionablePropertyValues),this._scope=n,this._options=a,this.configDependencies=new Set}getValue(e){return Zi(this._values[e].value.value)}setValue(e,n){this._values.hasOwnProperty(e)||(this._values[e]=new Hi(this._values[e].property,this._scope,this._options)),this._values[e].value=new Ds(this._values[e].property,n===null?void 0:Zi(n),this._scope,this._options),this._values[e].value.expression.configDependencies&&(this.configDependencies=new Set([...this.configDependencies,...this._values[e].value.expression.configDependencies]))}setTransitionOrValue(e,n){n&&(this._options=n);const a=this._properties.properties;if(e)for(const d in e){const c=e[d];if(mr(d,"-transition")){const p=d.slice(0,-11);a[p]&&this.setTransition(p,c)}else a.hasOwnProperty(d)&&this.setValue(d,c)}}getTransition(e){return Zi(this._values[e].transition)}setTransition(e,n){this._values.hasOwnProperty(e)||(this._values[e]=new Hi(this._values[e].property)),this._values[e].transition=Zi(n)||void 0}serialize(){const e={};for(const n of Object.keys(this._values)){const a=this.getValue(n);a!==void 0&&(e[n]=a);const d=this.getTransition(n);d!==void 0&&(e[`${n}-transition`]=d)}return e}transitioned(e,n){const a=new ac(this._properties);for(const d of Object.keys(this._values))a._values[d]=this._values[d].transitioned(e,n._values[d]);return a}untransitioned(){const e=new ac(this._properties);for(const n of Object.keys(this._values))e._values[n]=this._values[n].untransitioned();return e}}class Us{constructor(e,n,a,d,c){const p=d.delay||0,w=d.duration||0;c=c||0,this.property=e,this.value=n,this.begin=c+p,this.end=this.begin+w,e.specification.transition&&(d.delay||d.duration)&&(this.prior=a)}possiblyEvaluate(e,n,a){const d=e.now||0,c=this.value.possiblyEvaluate(e,n,a),p=this.prior;if(p){if(d>this.end)return this.prior=null,c;if(this.value.isDataDriven())return this.prior=null,c;if(d<this.begin)return p.possiblyEvaluate(e,n,a);{const w=(d-this.begin)/(this.end-this.begin);return this.property.interpolate(p.possiblyEvaluate(e,n,a),c,Pr(w))}}return c}}class ac{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitioningPropertyValues)}possiblyEvaluate(e,n,a){const d=new Do(this._properties);for(const c of Object.keys(this._values))d._values[c]=this._values[c].possiblyEvaluate(e,n,a);return d}hasTransition(){for(const e of Object.keys(this._values))if(this._values[e].prior)return!0;return!1}}class es{constructor(e,n,a){this._properties=e,this._values=Object.create(e.defaultPropertyValues),this._scope=n,this._options=a,this.configDependencies=new Set}getValue(e){return Zi(this._values[e].value)}setValue(e,n){this._values[e]=new Ds(this._values[e].property,n===null?void 0:Zi(n),this._scope,this._options),this._values[e].expression.configDependencies&&(this.configDependencies=new Set([...this.configDependencies,...this._values[e].expression.configDependencies]))}serialize(){const e={};for(const n of Object.keys(this._values)){const a=this.getValue(n);a!==void 0&&(e[n]=a)}return e}possiblyEvaluate(e,n,a){const d=new Do(this._properties);for(const c of Object.keys(this._values))d._values[c]=this._values[c].possiblyEvaluate(e,n,a);return d}}class Ri{constructor(e,n,a){this.property=e,this.value=n,this.parameters=a}isConstant(){return this.value.kind==="constant"}constantOr(e){return this.value.kind==="constant"?this.value.value:e}evaluate(e,n,a,d){return this.property.evaluate(this.value,this.parameters,e,n,a,d)}}class Do{constructor(e){this._properties=e,this._values=Object.create(e.defaultPossiblyEvaluatedValues)}get(e){return this._values[e]}}class Zt{constructor(e){this.specification=e}possiblyEvaluate(e,n){return e.expression.evaluate(n)}interpolate(e,n,a){const d=yr[this.specification.type];return d?d(e,n,a):e}}class an{constructor(e,n){this.specification=e,this.overrides=n}possiblyEvaluate(e,n,a,d){return new Ri(this,e.expression.kind==="constant"||e.expression.kind==="camera"?{kind:"constant",value:e.expression.evaluate(n,null,{},a,d)}:e.expression,n)}interpolate(e,n,a){if(e.value.kind!=="constant"||n.value.kind!=="constant")return e;if(e.value.value===void 0||n.value.value===void 0)return new Ri(this,{kind:"constant",value:void 0},e.parameters);const d=yr[this.specification.type];return d?new Ri(this,{kind:"constant",value:d(e.value.value,n.value.value,a)},e.parameters):e}evaluate(e,n,a,d,c,p){return e.kind==="constant"?e.value:e.evaluate(n,a,d,c,p)}}class Qs{constructor(e){this.specification=e}possiblyEvaluate(e,n,a,d){return!!e.expression.evaluate(n,null,{},a,d)}interpolate(){return!1}}class $i{constructor(e){this.properties=e,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];const n=new qr(0,{});for(const a in e){const d=e[a];d.specification.overridable&&this.overridableProperties.push(a);const c=this.defaultPropertyValues[a]=new Ds(d,void 0),p=this.defaultTransitionablePropertyValues[a]=new Hi(d);this.defaultTransitioningPropertyValues[a]=p.untransitioned(),this.defaultPossiblyEvaluatedValues[a]=c.possiblyEvaluate(n)}}}qe(an,"DataDrivenProperty"),qe(Zt,"DataConstantProperty"),qe(Qs,"ColorRampProperty");var yt=JSON.parse('{"$version":8,"$root":{"version":{"required":true,"type":"enum","values":[8]},"fragment":{"type":"boolean"},"name":{"type":"string"},"metadata":{"type":"*"},"center":{"type":"array","value":"number"},"zoom":{"type":"number"},"bearing":{"type":"number","default":0,"period":360},"pitch":{"type":"number","default":0},"light":{"type":"light"},"lights":{"required":false,"type":"array","value":"light-3d"},"terrain":{"type":"terrain","optional":true},"fog":{"type":"fog"},"snow":{"type":"snow","experimental":true},"rain":{"type":"rain","experimental":true},"camera":{"type":"camera"},"color-theme":{"type":"colorTheme"},"indoor":{"type":"indoor","experimental":true},"imports":{"type":"array","value":"import"},"schema":{"type":"schema"},"sources":{"required":true,"type":"sources"},"sprite":{"type":"string"},"glyphs":{"type":"string","default":"mapbox://fonts/mapbox/{fontstack}/{range}.pbf"},"transition":{"type":"transition"},"projection":{"type":"projection"},"layers":{"required":true,"type":"array","value":"layer"},"models":{"type":"models"},"featuresets":{"experimental":true,"type":"featuresets"}},"featuresets":{"experimental":true,"*":{"type":"featureset"}},"featureset":{"experimental":true,"metadata":{"type":"*"},"selectors":{"type":"array","value":"selector"}},"selector":{"experimental":true,"layer":{"type":"string","required":true},"properties":{"type":"selectorProperty","required":false},"featureNamespace":{"type":"string","required":false}},"selectorProperty":{"experimental":true,"*":{"type":"*"}},"model":{"type":"string","required":true},"import":{"id":{"type":"string","required":true},"url":{"type":"string","required":true},"config":{"type":"config"},"data":{"type":"$root"},"color-theme":{"type":"colorTheme","optional":true}},"config":{"*":{"type":"*"}},"schema":{"*":{"type":"option"}},"option":{"default":{"type":"*","property-type":"data-constant","expression":{},"required":true},"type":{"type":"enum","values":{"string":1,"number":1,"boolean":1,"color":1}},"array":{"type":"boolean"},"minValue":{"type":"number"},"maxValue":{"type":"number"},"stepValue":{"type":"number"},"values":{"type":"array","value":"*"},"metadata":{"type":"*"}},"models":{"*":{"type":"model"}},"light-3d":{"id":{"type":"string","required":true},"properties":{"type":"properties"},"type":{"type":"enum","values":{"ambient":{},"directional":{},"flat":{}}}},"properties":["properties_light_directional","properties_light_ambient","properties_light_flat"],"properties_light_directional":{"direction":{"type":"array","default":[210,30],"minimum":[0,0],"maximum":[360,90],"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"cast-shadows":{"type":"boolean","default":false,"property-type":"data-constant"},"shadow-quality":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1,"expression":{"parameters":["zoom"]},"experimental":true},"shadow-intensity":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_ambient":{"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_flat":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"property-type":"data-constant","expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"sources":{"*":{"type":"source"}},"source":["source_vector","source_raster","source_raster_dem","source_raster_array","source_geojson","source_video","source_image","source_model"],"source_vector":{"type":{"required":true,"type":"enum","values":{"vector":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"attribution":{"type":"string"},"promoteId":{"type":"promoteId"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster":{"type":{"required":true,"type":"enum","values":{"raster":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"attribution":{"type":"string"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_dem":{"type":{"required":true,"type":"enum","values":{"raster-dem":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"encoding":{"type":"enum","values":{"terrarium":1,"mapbox":1},"default":"mapbox"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_array":{"experimental":true,"type":{"required":true,"type":"enum","values":{"raster-array":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"rasterLayers":{"type":"*"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_geojson":{"type":{"required":true,"type":"enum","values":{"geojson":1}},"data":{"type":"*"},"maxzoom":{"type":"number","default":18},"minzoom":{"type":"number","default":0},"attribution":{"type":"string"},"buffer":{"type":"number","default":128,"maximum":512,"minimum":0},"filter":{"type":"*"},"tolerance":{"type":"number","default":0.375},"cluster":{"type":"boolean","default":false},"clusterRadius":{"type":"number","default":50,"minimum":0},"clusterMaxZoom":{"type":"number"},"clusterMinPoints":{"type":"number"},"clusterProperties":{"type":"*"},"lineMetrics":{"type":"boolean","default":false},"generateId":{"type":"boolean","default":false},"promoteId":{"type":"promoteId"},"dynamic":{"type":"boolean","default":false}},"source_video":{"type":{"required":true,"type":"enum","values":{"video":1}},"urls":{"required":true,"type":"array","value":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_image":{"type":{"required":true,"type":"enum","values":{"image":1}},"url":{"required":false,"type":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_model":{"type":{"required":true,"type":"enum","values":{"model":1,"batched-model":1}},"maxzoom":{"type":"number","default":18},"minzoom":{"type":"number","default":0},"tiles":{"type":"array","value":"string"}},"layer":{"id":{"type":"string","required":true},"type":{"type":"enum","values":{"fill":{},"line":{},"symbol":{},"circle":{},"heatmap":{},"fill-extrusion":{},"raster":{},"raster-particle":{"experimental":true},"hillshade":{},"model":{"experimental":true},"background":{},"sky":{},"slot":{},"clip":{}},"required":true},"metadata":{"type":"*"},"source":{"type":"string"},"source-layer":{"type":"string"},"slot":{"type":"string"},"minzoom":{"type":"number","minimum":0,"maximum":24},"maxzoom":{"type":"number","minimum":0,"maximum":24},"filter":{"type":"filter"},"layout":{"type":"layout"},"paint":{"type":"paint"}},"layout":["layout_clip","layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_raster-particle","layout_hillshade","layout_background","layout_sky","layout_model"],"layout_background":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_sky":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_model":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"},"model-id":{"type":"string","default":"","property-type":"data-driven","expression":{"parameters":["zoom","feature"]}}},"layout_clip":{"clip-layer-types":{"type":"array","value":"enum","values":{"model":1,"symbol":1},"default":[],"expression":{},"property-type":"data-constant"},"clip-layer-scope":{"type":"array","value":"string","default":[],"expression":{},"property-type":"data-constant"}},"layout_fill":{"fill-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"},"fill-elevation-reference":{"type":"enum","values":{"none":1,"hd-road-base":1,"hd-road-markup":1},"default":"none","experimental":true,"private":true,"expression":{},"property-type":"data-constant"}},"layout_circle":{"circle-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_heatmap":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_fill-extrusion":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"},"fill-extrusion-edge-radius":{"type":"number","experimental":true,"default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"constant"}},"layout_line":{"line-cap":{"type":"enum","values":{"butt":1,"round":1,"square":1},"default":"butt","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-join":{"type":"enum","values":{"bevel":1,"round":1,"miter":1,"none":1},"default":"miter","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{"type":"number","default":2,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-round-limit":{"type":"number","default":1.05,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-z-offset":{"type":"number","experimental":true,"default":0,"expression":{"parameters":["zoom","feature","line-progress"]},"property-type":"data-driven"},"line-elevation-reference":{"type":"enum","values":{"none":1,"sea":1,"ground":1,"hd-road-markup":1},"default":"none","experimental":true,"expression":{},"property-type":"data-constant"},"line-cross-slope":{"type":"number","experimental":true,"expression":{},"property-type":"constant"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"},"line-width-unit":{"type":"enum","values":{"pixels":1,"meters":1},"default":"pixels","experimental":true,"private":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"}},"layout_symbol":{"symbol-placement":{"type":"enum","values":{"point":1,"line":1,"line-center":1},"default":"point","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"symbol-spacing":{"type":"number","default":250,"minimum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{"type":"enum","values":{"auto":1,"viewport-y":1,"source":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"symbol-z-elevate":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"symbol-elevation-reference":{"type":"enum","values":{"sea":1,"ground":1,"hd-road-markup":1},"default":"ground","experimental":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-size":{"type":"number","default":1,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-size-scale-range":{"type":"array","value":"number","length":2,"default":[0.8,2],"minimum":0.1,"maximum":10,"experimental":true,"private":true,"expression":{},"property-type":"data-constant"},"icon-text-fit":{"type":"enum","values":{"none":1,"width":1,"height":1,"both":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit-padding":{"type":"array","value":"number","length":4,"default":[0,0,0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-image":{"type":"resolvedImage","tokens":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{"type":"number","default":0,"period":360,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-offset":{"type":"array","value":"number","length":2,"default":[0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-field":{"type":"formatted","default":"","tokens":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-font":{"type":"array","value":"string","default":["Open Sans Regular","Arial Unicode MS Regular"],"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size":{"type":"number","default":16,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size-scale-range":{"type":"array","value":"number","length":2,"default":[0.8,2],"minimum":0.1,"maximum":10,"experimental":true,"private":true,"expression":{},"property-type":"data-constant"},"text-max-width":{"type":"number","default":10,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{"type":"number","default":1.2,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{"type":"number","default":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-justify":{"type":"enum","values":{"auto":1,"left":1,"center":1,"right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{"type":"number","default":0,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["zoom","feature"]}},"text-variable-anchor":{"type":"array","value":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{"type":"number","default":45,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-writing-mode":{"type":"array","value":"enum","values":{"horizontal":1,"vertical":1},"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-rotate":{"type":"number","default":0,"period":360,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-keep-upright":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-transform":{"type":"enum","values":{"none":1,"uppercase":1,"lowercase":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-offset":{"type":"array","value":"number","length":2,"default":[0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_raster":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_raster-particle":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_hillshade":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"filter":{"type":"array","value":"*"},"filter_symbol":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature","pitch","distance-from-center"]}},"filter_fill":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_hillshade":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_raster":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_raster-particle":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_clip":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_model":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_line":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_circle":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_fill-extrusion":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_heatmap":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_operator":{"type":"enum","values":{"==":1,"!=":1,">":1,">=":1,"<":1,"<=":1,"in":1,"!in":1,"all":1,"any":1,"none":1,"has":1,"!has":1}},"geometry_type":{"type":"enum","values":{"Point":1,"LineString":1,"Polygon":1}},"function":{"expression":{"type":"expression"},"stops":{"type":"array","value":"function_stop"},"base":{"type":"number","default":1,"minimum":0},"property":{"type":"string","default":"$zoom"},"type":{"type":"enum","values":{"identity":1,"exponential":1,"interval":1,"categorical":1},"default":"exponential"},"colorSpace":{"type":"enum","values":{"rgb":1,"lab":1,"hcl":1},"default":"rgb"},"default":{"type":"*","required":false}},"function_stop":{"type":"array","minimum":0,"maximum":24,"value":["number","color"],"length":2},"expression":{"type":"array","value":"*","minimum":1},"fog":{"range":{"type":"array","default":[0.5,10],"minimum":-20,"maximum":20,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"high-color":{"type":"color","property-type":"data-constant","default":"#245cdf","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"space-color":{"type":"color","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,"#010b19",7,"#367ab9"],"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"horizon-blend":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,0.2,7,0.1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"star-intensity":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],5,0.35,6,0],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vertical-range":{"type":"array","default":[0,0],"minimum":0,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}}},"snow":{"density":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],11,0,13,0.85],"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"opacity":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],11,0,13,0.3],"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette-color":{"type":"color","property-type":"data-constant","default":"#ffffff","experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"center-thinning":{"type":"number","property-type":"data-constant","default":0.4,"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"direction":{"type":"array","default":[0,50],"minimum":0,"maximum":360,"length":2,"value":"number","property-type":"data-constant","transition":true,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"flake-size":{"type":"number","property-type":"data-constant","default":0.71,"minimum":0,"maximum":5,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true}},"rain":{"density":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],11,0,13,0.5],"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"color":{"type":"color","property-type":"data-constant","default":["interpolate",["linear"],["measure-light","brightness"],0,"#03113d",0.3,"#a8adbc"],"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"opacity":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["measure-light","brightness"],0,0.88,1,0.7],"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],11,0,13,1],"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette-color":{"type":"color","property-type":"data-constant","default":["interpolate",["linear"],["measure-light","brightness"],0,"#001736",0.3,"#464646"],"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"center-thinning":{"type":"number","property-type":"data-constant","default":0.57,"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"direction":{"type":"array","default":[0,80],"minimum":0,"maximum":360,"length":2,"value":"number","property-type":"data-constant","transition":true,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"droplet-size":{"type":"array","default":[2.6,18.2],"minimum":0,"maximum":50,"length":2,"value":"number","property-type":"data-constant","transition":true,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"distortion-strength":{"type":"number","property-type":"data-constant","default":0.7,"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true}},"camera":{"camera-projection":{"type":"enum","values":{"perspective":1,"orthographic":1},"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"default":"perspective","property-type":"data-constant"}},"colorTheme":{"data":{"type":"string","property-type":"data-constant","expression":{}}},"indoor":{"floorplanFeaturesetId":{"type":"string","experimental":true,"property-type":"data-constant","expression":{}},"buildingFeaturesetId":{"type":"string","experimental":true,"property-type":"data-constant","expression":{}}},"light":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"property-type":"data-constant","expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"projection":{"name":{"type":"enum","values":{"albers":1,"equalEarth":1,"equirectangular":1,"lambertConformalConic":1,"mercator":1,"naturalEarth":1,"winkelTripel":1,"globe":1},"default":"mercator","required":true},"center":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-180,-90],"maximum":[180,90]},"parallels":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-90,-90],"maximum":[90,90]}},"terrain":{"source":{"type":"string","required":true},"exaggeration":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1000,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"paint":["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_raster-particle","paint_hillshade","paint_background","paint_sky","paint_model"],"paint_fill":{"fill-antialias":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-outline-color":{"type":"color","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"fill-z-offset":{"type":"number","default":0,"minimum":0,"transition":true,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-extrusion-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-extrusion-height":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-height-alignment":{"type":"enum","experimental":true,"values":{"terrain":1,"flat":1},"default":"flat","property-type":"data-constant"},"fill-extrusion-base-alignment":{"type":"enum","experimental":true,"values":{"terrain":1,"flat":1},"default":"terrain","property-type":"data-constant"},"fill-extrusion-vertical-gradient":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-ambient-occlusion-intensity":{"property-type":"data-constant","type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-radius":{"property-type":"data-constant","type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-wall-radius":{"property-type":"data-constant","type":"number","experimental":true,"default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-radius":{"property-type":"data-constant","type":"number","experimental":true,"default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-attenuation":{"property-type":"data-constant","type":"number","experimental":true,"default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-flood-light-color":{"property-type":"data-constant","type":"color","experimental":true,"default":"#ffffff","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-intensity":{"property-type":"data-constant","type":"number","experimental":true,"default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-wall-radius":{"property-type":"data-driven","type":"number","experimental":true,"default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-radius":{"property-type":"data-driven","type":"number","experimental":true,"default":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-attenuation":{"property-type":"data-constant","type":"number","experimental":true,"default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-vertical-scale":{"property-type":"data-constant","type":"number","experimental":true,"default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-rounded-roof":{"property-type":"data-constant","type":"boolean","default":true,"experimental":true,"expression":{"parameters":["zoom"]}},"fill-extrusion-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"data-constant"},"fill-extrusion-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"fill-extrusion-line-width":{"type":"number","default":0,"minimum":0,"transition":true,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-extrusion-cast-shadows":{"type":"boolean","default":true,"property-type":"data-constant"}},"paint_line":{"line-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"line-width":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light","line-progress"]},"property-type":"data-driven"},"line-gap-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-offset":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-dasharray":{"type":"array","value":"number","minimum":0,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-gradient":{"type":"color","expression":{"interpolated":true,"parameters":["line-progress"]},"property-type":"color-ramp"},"line-trim-offset":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"property-type":"constant"},"line-trim-fade-range":{"type":"array","value":"number","experimental":true,"length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"line-trim-color":{"type":"color","experimental":true,"default":"transparent","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"line-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"line-border-width":{"type":"number","private":true,"default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-border-color":{"type":"color","private":true,"default":"rgba(0, 0, 0, 0)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-occlusion-opacity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true,"property-type":"data-constant"}},"paint_circle":{"circle-radius":{"type":"number","default":5,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-blur":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_heatmap":{"heatmap-radius":{"type":"number","default":30,"minimum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-weight":{"type":"number","default":1,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-intensity":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"heatmap-color":{"type":"color","default":["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",0.1,"royalblue",0.3,"cyan",0.5,"lime",0.7,"yellow",1,"red"],"expression":{"interpolated":true,"parameters":["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_symbol":{"icon-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-occlusion-opacity":{"type":"number","minimum":0,"maximum":1,"default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"text-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"icon-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-image-cross-fade":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"transition":true},"text-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-occlusion-opacity":{"type":"number","minimum":0,"maximum":1,"default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-color":{"type":"color","default":"#000000","transition":true,"overridable":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-color-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"expression":{},"property-type":"data-constant"},"icon-color-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"expression":{},"property-type":"data-constant"},"icon-color-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"data-constant"},"icon-color-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{},"property-type":"data-constant"},"symbol-z-offset":{"type":"number","default":0,"minimum":0,"transition":true,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"}},"paint_raster":{"raster-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-color":{"type":"color","expression":{"interpolated":true,"parameters":["raster-value"]},"property-type":"color-ramp"},"raster-color-mix":{"type":"array","default":[0.2126,0.7152,0.0722,0],"length":4,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-color-range":{"type":"array","length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-hue-rotate":{"type":"number","default":0,"period":360,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-resampling":{"type":"enum","values":{"linear":1,"nearest":1},"default":"linear","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{"type":"number","default":300,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"raster-array-band":{"type":"string","required":false,"experimental":true,"property-type":"data-constant"},"raster-elevation":{"type":"number","default":0,"minimum":0,"transition":true,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_raster-particle":{"raster-particle-array-band":{"type":"string","required":false,"property-type":"data-constant"},"raster-particle-count":{"type":"number","default":512,"minimum":1,"property-type":"data-constant"},"raster-particle-color":{"type":"color","expression":{"interpolated":true,"parameters":["raster-particle-speed"]},"property-type":"color-ramp"},"raster-particle-max-speed":{"type":"number","default":1,"minimum":1,"property-type":"data-constant"},"raster-particle-speed-factor":{"type":"number","default":0.2,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-particle-fade-opacity-factor":{"type":"number","default":0.98,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-particle-reset-rate-factor":{"type":"number","default":0.8,"minimum":0,"maximum":1,"property-type":"data-constant"},"raster-particle-elevation":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_hillshade":{"hillshade-illumination-direction":{"type":"number","default":335,"minimum":0,"maximum":359,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{"type":"number","default":0.5,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"hillshade-highlight-color":{"type":"color","default":"#FFFFFF","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"hillshade-accent-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"hillshade-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_background":{"background-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":[]},"experimental":true,"property-type":"data-constant"},"background-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"background-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_sky":{"sky-type":{"type":"enum","values":{"gradient":1,"atmosphere":1},"default":"atmosphere","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun":{"type":"array","value":"number","length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun-intensity":{"type":"number","default":10,"minimum":0,"maximum":100,"property-type":"data-constant"},"sky-gradient-center":{"type":"array","value":"number","default":[0,0],"length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient-radius":{"type":"number","default":90,"minimum":0,"maximum":180,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient":{"type":"color","default":["interpolate",["linear"],["sky-radial-progress"],0.8,"#87ceeb",1,"white"],"expression":{"interpolated":true,"parameters":["sky-radial-progress"]},"property-type":"color-ramp"},"sky-atmosphere-halo-color":{"type":"color","default":"white","property-type":"data-constant"},"sky-atmosphere-color":{"type":"color","default":"white","property-type":"data-constant"},"sky-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_model":{"model-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"property-type":"data-driven"},"model-rotation":{"type":"array","value":"number","length":3,"default":[0,0,0],"period":360,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-scale":{"type":"array","value":"number","length":3,"default":[1,1,1],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-translation":{"type":"array","value":"number","length":3,"default":[0,0,0],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-color":{"type":"color","default":"#ffffff","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light","zoom"]},"transition":true},"model-color-mix-intensity":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-type":{"type":"enum","values":{"common-3d":1,"location-indicator":1},"default":"common-3d","property-type":"data-constant"},"model-cast-shadows":{"type":"boolean","default":true,"property-type":"data-constant"},"model-receive-shadows":{"type":"boolean","default":true,"property-type":"data-constant"},"model-ambient-occlusion-intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant","transition":true},"model-emissive-strength":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":5,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-roughness":{"type":"number","default":1,"minimum":0,"maximum":1,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state"]},"transition":true},"model-height-based-emissive-strength-multiplier":{"type":"array","default":[1,1,1,1,0],"length":5,"value":"number","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"data-constant"},"model-front-cutoff":{"type":"array","private":true,"value":"number","property-type":"data-constant","expression":{"interpolated":true,"parameters":["zoom"]},"length":3,"default":[0,0,1],"minimum":[0,0,0],"maximum":[1,1,1]}},"transition":{"duration":{"type":"number","default":300,"minimum":0},"delay":{"type":"number","default":0,"minimum":0}},"property-type":{"data-driven":{"type":"property-type"},"color-ramp":{"type":"property-type"},"data-constant":{"type":"property-type"},"constant":{"type":"property-type"}},"promoteId":{"*":{"type":"string"}}}');function Aa(s){return s instanceof Number||s instanceof String||s instanceof Boolean?s.valueOf():s}function vl(s){if(Array.isArray(s))return s.map(vl);if(s instanceof Object&&!(s instanceof Number||s instanceof String||s instanceof Boolean)){const e={};for(const n in s)e[n]=vl(s[n]);return e}return Aa(s)}function ah(s){if(s===!0||s===!1)return!0;if(!Array.isArray(s)||s.length===0)return!1;switch(s[0]){case"has":return s.length>=2&&s[1]!=="$id"&&s[1]!=="$type";case"in":return s.length>=3&&(typeof s[1]!="string"||Array.isArray(s[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return s.length!==3||Array.isArray(s[1])||Array.isArray(s[2]);case"any":case"all":for(const e of s.slice(1))if(!ah(e)&&typeof e!="boolean")return!1;return!0;default:return!0}}function lh(s,e="",n=null,a="fill"){if(s==null)return{filter:()=>!0,needGeometry:!1,needFeature:!1};ah(s)||(s=cc(s));const d=s;let c=!0;try{c=function(x){if(!lc(x))return x;let C=vl(x);return jl(C),C=Nl(C),C}(d)}catch{console.warn(`Failed to extract static filter. Filter will continue working, but at higher memory usage and slower framerate.
This is most likely a bug, please report this via https://github.com/mapbox/mapbox-gl-js/issues/new?assignees=&labels=&template=Bug_report.md
and paste the contents of this message in the report.
Thank you!
Filter Expression:
${JSON.stringify(d,null,2)}
        `)}let p=null,w=null;if(a!=="background"&&a!=="sky"&&a!=="slot"){w=yt[`filter_${a}`];const x=Ta(c,w,e,n);if(x.result==="error")throw new Error(x.value.map(C=>`${C.key}: ${C.message}`).join(", "));p=(C,A,E)=>x.value.evaluate(C,A,{},E)}let T=null,P=null;if(c!==d){const x=Ta(d,w,e,n);if(x.result==="error")throw new Error(x.value.map(C=>`${C.key}: ${C.message}`).join(", "));T=(C,A,E,M,k)=>x.value.evaluate(C,A,{},E,void 0,void 0,M,k),P=!nc(x.value.expression)}return{filter:p,dynamicFilter:T||void 0,needGeometry:Kh(c),needFeature:!!P}}function Nl(s){if(!Array.isArray(s))return s;const e=function(n){if(jd.has(n[0])){for(let a=1;a<n.length;a++)if(lc(n[a]))return!0}return n}(s);return e===!0?e:e.map(n=>Nl(n))}function jl(s){let e=!1;const n=[];if(s[0]==="case"){for(let a=1;a<s.length-1;a+=2)e=e||lc(s[a]),n.push(s[a+1]);n.push(s[s.length-1])}else if(s[0]==="match"){e=e||lc(s[1]);for(let a=2;a<s.length-1;a+=2)n.push(s[a+1]);n.push(s[s.length-1])}else if(s[0]==="step"){e=e||lc(s[1]);for(let a=1;a<s.length-1;a+=2)n.push(s[a+1])}e&&(s.length=0,s.push("any",...n));for(let a=1;a<s.length;a++)jl(s[a])}function lc(s){if(!Array.isArray(s))return!1;if((e=s[0])==="pitch"||e==="distance-from-center")return!0;var e;for(let n=1;n<s.length;n++)if(lc(s[n]))return!0;return!1}const jd=new Set(["in","==","!=",">",">=","<","<=","to-boolean"]);function $l(s,e){return s<e?-1:s>e?1:0}function Kh(s){if(!Array.isArray(s))return!1;if(s[0]==="within"||s[0]==="distance")return!0;for(let e=1;e<s.length;e++)if(Kh(s[e]))return!0;return!1}function cc(s){if(!s)return!0;const e=s[0];return s.length<=1?e!=="any":e==="=="?Ho(s[1],s[2],"=="):e==="!="?Rs(Ho(s[1],s[2],"==")):e==="<"||e===">"||e==="<="||e===">="?Ho(s[1],s[2],e):e==="any"?(n=s.slice(1),["any"].concat(n.map(cc))):e==="all"?["all"].concat(s.slice(1).map(cc)):e==="none"?["all"].concat(s.slice(1).map(cc).map(Rs)):e==="in"?uc(s[1],s.slice(2)):e==="!in"?Rs(uc(s[1],s.slice(2))):e==="has"?iu(s[1]):e!=="!has"||Rs(iu(s[1]));var n}function Ho(s,e,n){switch(s){case"$type":return[`filter-type-${n}`,e];case"$id":return[`filter-id-${n}`,e];default:return[`filter-${n}`,s,e]}}function uc(s,e){if(e.length===0)return!1;switch(s){case"$type":return["filter-type-in",["literal",e]];case"$id":return["filter-id-in",["literal",e]];default:return e.length>200&&!e.some(n=>typeof n!=typeof e[0])?["filter-in-large",s,["literal",e.sort($l)]]:["filter-in-small",s,["literal",e]]}}function iu(s){switch(s){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",s]}}function Rs(s){return["!",s]}const hc="";function Wo(s,e){return e?`${s}${hc}${e}`:s}const Jh="-transition",Qh=new Set(["fill","line","background","hillshade","raster"]);class vi extends go{constructor(e,n,a,d,c){if(super(),this.id=e.id,this.fqid=Wo(this.id,a),this.type=e.type,this.scope=a,this.lut=d,this.options=c,this._featureFilter={filter:()=>!0,needGeometry:!1,needFeature:!1},this._filterCompiled=!1,this.configDependencies=new Set,e.type!=="custom"){if(this.metadata=e.metadata,this.minzoom=e.minzoom,this.maxzoom=e.maxzoom,e.type&&e.type!=="background"&&e.type!=="sky"&&e.type!=="slot"){this.source=e.source,this.sourceLayer=e["source-layer"],this.filter=e.filter;const p=Ta(this.filter,yt[`filter_${e.type}`]);p.result!=="error"&&(this.configDependencies=new Set([...this.configDependencies,...p.value.configDependencies]))}if(e.slot&&(this.slot=e.slot),n.layout&&(this._unevaluatedLayout=new es(n.layout,this.scope,c),this.configDependencies=new Set([...this.configDependencies,...this._unevaluatedLayout.configDependencies])),n.paint){this._transitionablePaint=new vs(n.paint,this.scope,c);for(const p in e.paint)this.setPaintProperty(p,e.paint[p]);for(const p in e.layout)this.setLayoutProperty(p,e.layout[p]);this.configDependencies=new Set([...this.configDependencies,...this._transitionablePaint.configDependencies]),this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new Do(n.paint)}}}onAdd(e){}onRemove(e){}isDraped(e){return!this.is3D()&&Qh.has(this.type)}getLayoutProperty(e){return e==="visibility"?this.visibility:this._unevaluatedLayout.getValue(e)}setLayoutProperty(e,n){if(this.type==="custom"&&e==="visibility")return void(this.visibility=n);const a=this._unevaluatedLayout;a._properties.properties[e]&&(a.setValue(e,n),this.configDependencies=new Set([...this.configDependencies,...a.configDependencies]),e==="visibility"&&this.possiblyEvaluateVisibility())}possiblyEvaluateVisibility(){this._unevaluatedLayout._values.visibility&&(this.visibility=this._unevaluatedLayout._values.visibility.possiblyEvaluate({zoom:0}))}getPaintProperty(e){return mr(e,Jh)?this._transitionablePaint.getTransition(e.slice(0,-11)):this._transitionablePaint.getValue(e)}setPaintProperty(e,n){const a=this._transitionablePaint,d=a._properties.properties;if(mr(e,Jh)){const C=e.slice(0,-11);return d[C]&&a.setTransition(C,n||void 0),!1}if(!d[e])return!1;const c=a._values[e],p=c.value.isDataDriven(),w=c.value;a.setValue(e,n),this.configDependencies=new Set([...this.configDependencies,...a.configDependencies]),this._handleSpecialPaintPropertyUpdate(e);const T=a._values[e].value,P=T.isDataDriven(),x=mr(e,"pattern")||e==="line-dasharray";return P||p||x||this._handleOverridablePaintPropertyUpdate(e,w,T)}_handleSpecialPaintPropertyUpdate(e){}getProgramIds(){return null}getDefaultProgramParams(e,n,a){return null}_handleOverridablePaintPropertyUpdate(e,n,a){return!1}isHidden(e){return!!(this.minzoom&&e<this.minzoom)||!!(this.maxzoom&&e>=this.maxzoom)||this.visibility==="none"}updateTransitions(e){this._transitioningPaint=this._transitionablePaint.transitioned(e,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(e,n){this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(e,void 0,n)),this.paint=this._transitioningPaint.possiblyEvaluate(e,void 0,n)}serialize(){return wo({id:this.id,type:this.type,slot:this.slot,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()},(e,n)=>!(e===void 0||n==="layout"&&!Object.keys(e).length||n==="paint"&&!Object.keys(e).length))}is3D(){return!1}isSky(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}hasShadowPass(){return!1}canCastShadows(){return!1}hasLightBeamPass(){return!1}cutoffRange(){return 0}tileCoverLift(){return 0}resize(){}isStateDependent(){for(const e in this.paint._values){const n=this.paint.get(e);if(n instanceof Ri&&ha(n.property.specification)&&(n.value.kind==="source"||n.value.kind==="composite")&&n.value.isStateDependent)return!0}return!1}compileFilter(e){this._filterCompiled||(this._featureFilter=lh(this.filter,this.scope,e),this._filterCompiled=!0)}invalidateCompiledFilter(){this._filterCompiled=!1}dynamicFilter(){return this._featureFilter.dynamicFilter}dynamicFilterNeedsFeature(){return this._featureFilter.needFeature}getLayerRenderingStats(){return this._stats}resetLayerRenderingStats(e){this._stats&&(e.renderPass==="shadow"?this._stats.numRenderedVerticesInShadowPass=0:this._stats.numRenderedVerticesInTransparentPass=0)}queryRadius(e){}queryIntersectsFeature(e,n,a,d,c,p,w,T,P){}}const ed={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class ou{constructor(e,n){this._structArray=e,this._pos1=n*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class xi{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(e,n){return e._trim(),n&&(e.isTransferred=!0,n.add(e.arrayBuffer)),{length:e.length,arrayBuffer:e.arrayBuffer}}static deserialize(e){const n=Object.create(this.prototype);return n.arrayBuffer=e.arrayBuffer,n.length=e.length,n.capacity=e.arrayBuffer.byteLength/n.bytesPerElement,n._refreshViews(),n}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(e){this.reserve(e),this.length=e}reserve(e){if(e>this.capacity){this.capacity=Math.max(e,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const n=this.uint8;this._refreshViews(),n&&this.uint8.set(n)}}_refreshViews(){throw new Error("StructArray#_refreshViews() must be implemented by each concrete StructArray layout")}emplace(...e){throw new Error("StructArray#emplace() must be implemented by each concrete StructArray layout")}emplaceBack(...e){throw new Error("StructArray#emplaceBack() must be implemented by each concrete StructArray layout")}destroy(){this.int8=this.uint8=this.int16=this.uint16=this.int32=this.uint32=this.float32=null,this.arrayBuffer=null}}function $r(s,e=1){let n=0,a=0;return{members:s.map(d=>{const c=ed[d.type].BYTES_PER_ELEMENT,p=n=ch(n,Math.max(e,c)),w=d.components||1;return a=Math.max(a,c),n+=c*w,{name:d.name,type:d.type,components:w,offset:p}}),size:ch(n,Math.max(a,e)),alignment:e}}function ch(s,e){return Math.ceil(s/e)*e}class Ia extends xi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n){const a=this.length;return this.resize(a+1),this.emplace(a,e,n)}emplace(e,n,a){const d=2*e;return this.int16[d+0]=n,this.int16[d+1]=a,e}}Ia.prototype.bytesPerElement=4,qe(Ia,"StructArrayLayout2i4");class yo extends xi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,a){const d=this.length;return this.resize(d+1),this.emplace(d,e,n,a)}emplace(e,n,a,d){const c=3*e;return this.int16[c+0]=n,this.int16[c+1]=a,this.int16[c+2]=d,e}}yo.prototype.bytesPerElement=6,qe(yo,"StructArrayLayout3i6");class Fo extends xi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,a,d){const c=this.length;return this.resize(c+1),this.emplace(c,e,n,a,d)}emplace(e,n,a,d,c){const p=4*e;return this.int16[p+0]=n,this.int16[p+1]=a,this.int16[p+2]=d,this.int16[p+3]=c,e}}Fo.prototype.bytesPerElement=8,qe(Fo,"StructArrayLayout4i8");class uo extends xi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,a,d,c){const p=this.length;return this.resize(p+1),this.emplace(p,e,n,a,d,c)}emplace(e,n,a,d,c,p){const w=5*e;return this.int16[w+0]=n,this.int16[w+1]=a,this.int16[w+2]=d,this.int16[w+3]=c,this.int16[w+4]=p,e}}uo.prototype.bytesPerElement=10,qe(uo,"StructArrayLayout5i10");class td extends xi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,a,d,c,p,w){const T=this.length;return this.resize(T+1),this.emplace(T,e,n,a,d,c,p,w)}emplace(e,n,a,d,c,p,w,T){const P=6*e,x=12*e,C=3*e;return this.int16[P+0]=n,this.int16[P+1]=a,this.uint8[x+4]=d,this.uint8[x+5]=c,this.uint8[x+6]=p,this.uint8[x+7]=w,this.float32[C+2]=T,e}}td.prototype.bytesPerElement=12,qe(td,"StructArrayLayout2i4ub1f12");class xl extends xi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,a,d){const c=this.length;return this.resize(c+1),this.emplace(c,e,n,a,d)}emplace(e,n,a,d,c){const p=4*e;return this.float32[p+0]=n,this.float32[p+1]=a,this.float32[p+2]=d,this.float32[p+3]=c,e}}xl.prototype.bytesPerElement=16,qe(xl,"StructArrayLayout4f16");class Vl extends xi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,a){const d=this.length;return this.resize(d+1),this.emplace(d,e,n,a)}emplace(e,n,a,d){const c=3*e;return this.float32[c+0]=n,this.float32[c+1]=a,this.float32[c+2]=d,e}}Vl.prototype.bytesPerElement=12,qe(Vl,"StructArrayLayout3f12");class Ou extends xi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,a,d,c){const p=this.length;return this.resize(p+1),this.emplace(p,e,n,a,d,c)}emplace(e,n,a,d,c,p){const w=6*e,T=3*e;return this.uint16[w+0]=n,this.uint16[w+1]=a,this.uint16[w+2]=d,this.uint16[w+3]=c,this.float32[T+2]=p,e}}Ou.prototype.bytesPerElement=12,qe(Ou,"StructArrayLayout4ui1f12");class Fs extends xi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n,a,d){const c=this.length;return this.resize(c+1),this.emplace(c,e,n,a,d)}emplace(e,n,a,d,c){const p=4*e;return this.uint16[p+0]=n,this.uint16[p+1]=a,this.uint16[p+2]=d,this.uint16[p+3]=c,e}}Fs.prototype.bytesPerElement=8,qe(Fs,"StructArrayLayout4ui8");class nd extends xi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,a,d,c,p){const w=this.length;return this.resize(w+1),this.emplace(w,e,n,a,d,c,p)}emplace(e,n,a,d,c,p,w){const T=6*e;return this.int16[T+0]=n,this.int16[T+1]=a,this.int16[T+2]=d,this.int16[T+3]=c,this.int16[T+4]=p,this.int16[T+5]=w,e}}nd.prototype.bytesPerElement=12,qe(nd,"StructArrayLayout6i12");class $d extends xi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n,a,d,c,p,w,T,P,x,C,A){const E=this.length;return this.resize(E+1),this.emplace(E,e,n,a,d,c,p,w,T,P,x,C,A)}emplace(e,n,a,d,c,p,w,T,P,x,C,A,E){const M=12*e;return this.int16[M+0]=n,this.int16[M+1]=a,this.int16[M+2]=d,this.int16[M+3]=c,this.uint16[M+4]=p,this.uint16[M+5]=w,this.uint16[M+6]=T,this.uint16[M+7]=P,this.int16[M+8]=x,this.int16[M+9]=C,this.int16[M+10]=A,this.int16[M+11]=E,e}}$d.prototype.bytesPerElement=24,qe($d,"StructArrayLayout4i4ui4i24");class Vd extends xi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,a,d,c,p){const w=this.length;return this.resize(w+1),this.emplace(w,e,n,a,d,c,p)}emplace(e,n,a,d,c,p,w){const T=10*e,P=5*e;return this.int16[T+0]=n,this.int16[T+1]=a,this.int16[T+2]=d,this.float32[P+2]=c,this.float32[P+3]=p,this.float32[P+4]=w,e}}Vd.prototype.bytesPerElement=20,qe(Vd,"StructArrayLayout3i3f20");class Ul extends xi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e){const n=this.length;return this.resize(n+1),this.emplace(n,e)}emplace(e,n){return this.uint32[1*e+0]=n,e}}Ul.prototype.bytesPerElement=4,qe(Ul,"StructArrayLayout1ul4");class Bs extends xi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n){const a=this.length;return this.resize(a+1),this.emplace(a,e,n)}emplace(e,n,a){const d=2*e;return this.uint16[d+0]=n,this.uint16[d+1]=a,e}}Bs.prototype.bytesPerElement=4,qe(Bs,"StructArrayLayout2ui4");class uh extends xi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n,a,d,c,p,w,T,P,x,C,A,E){const M=this.length;return this.resize(M+1),this.emplace(M,e,n,a,d,c,p,w,T,P,x,C,A,E)}emplace(e,n,a,d,c,p,w,T,P,x,C,A,E,M){const k=20*e,N=10*e;return this.int16[k+0]=n,this.int16[k+1]=a,this.int16[k+2]=d,this.int16[k+3]=c,this.int16[k+4]=p,this.float32[N+3]=w,this.float32[N+4]=T,this.float32[N+5]=P,this.float32[N+6]=x,this.int16[k+14]=C,this.uint32[N+8]=A,this.uint16[k+18]=E,this.uint16[k+19]=M,e}}uh.prototype.bytesPerElement=40,qe(uh,"StructArrayLayout5i4f1i1ul2ui40");class hh extends xi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,a,d,c,p,w){const T=this.length;return this.resize(T+1),this.emplace(T,e,n,a,d,c,p,w)}emplace(e,n,a,d,c,p,w,T){const P=8*e;return this.int16[P+0]=n,this.int16[P+1]=a,this.int16[P+2]=d,this.int16[P+4]=c,this.int16[P+5]=p,this.int16[P+6]=w,this.int16[P+7]=T,e}}hh.prototype.bytesPerElement=16,qe(hh,"StructArrayLayout3i2i2i16");class Ud extends xi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,a,d,c){const p=this.length;return this.resize(p+1),this.emplace(p,e,n,a,d,c)}emplace(e,n,a,d,c,p){const w=4*e,T=8*e;return this.float32[w+0]=n,this.float32[w+1]=a,this.float32[w+2]=d,this.int16[T+6]=c,this.int16[T+7]=p,e}}Ud.prototype.bytesPerElement=16,qe(Ud,"StructArrayLayout2f1f2i16");class Of extends xi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,a,d,c,p){const w=this.length;return this.resize(w+1),this.emplace(w,e,n,a,d,c,p)}emplace(e,n,a,d,c,p,w){const T=20*e,P=5*e;return this.uint8[T+0]=n,this.uint8[T+1]=a,this.float32[P+1]=d,this.float32[P+2]=c,this.float32[P+3]=p,this.float32[P+4]=w,e}}Of.prototype.bytesPerElement=20,qe(Of,"StructArrayLayout2ub4f20");class Ns extends xi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n,a){const d=this.length;return this.resize(d+1),this.emplace(d,e,n,a)}emplace(e,n,a,d){const c=3*e;return this.uint16[c+0]=n,this.uint16[c+1]=a,this.uint16[c+2]=d,e}}Ns.prototype.bytesPerElement=6,qe(Ns,"StructArrayLayout3ui6");class Hd extends xi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,n,a,d,c,p,w,T,P,x,C,A,E,M,k,N,j,q,X,W,J){const ne=this.length;return this.resize(ne+1),this.emplace(ne,e,n,a,d,c,p,w,T,P,x,C,A,E,M,k,N,j,q,X,W,J)}emplace(e,n,a,d,c,p,w,T,P,x,C,A,E,M,k,N,j,q,X,W,J,ne){const he=30*e,we=15*e,be=60*e;return this.int16[he+0]=n,this.int16[he+1]=a,this.int16[he+2]=d,this.float32[we+2]=c,this.float32[we+3]=p,this.uint16[he+8]=w,this.uint16[he+9]=T,this.uint32[we+5]=P,this.uint32[we+6]=x,this.uint32[we+7]=C,this.uint16[he+16]=A,this.uint16[he+17]=E,this.uint16[he+18]=M,this.float32[we+10]=k,this.float32[we+11]=N,this.uint8[be+48]=j,this.uint8[be+49]=q,this.uint8[be+50]=X,this.uint32[we+13]=W,this.int16[he+28]=J,this.uint8[be+58]=ne,e}}Hd.prototype.bytesPerElement=60,qe(Hd,"StructArrayLayout3i2f2ui3ul3ui2f3ub1ul1i1ub60");class Wd extends xi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,n,a,d,c,p,w,T,P,x,C,A,E,M,k,N,j,q,X,W,J,ne,he,we,be,ve,Be,Me,Ue,Ye,Xe,Je){const st=this.length;return this.resize(st+1),this.emplace(st,e,n,a,d,c,p,w,T,P,x,C,A,E,M,k,N,j,q,X,W,J,ne,he,we,be,ve,Be,Me,Ue,Ye,Xe,Je)}emplace(e,n,a,d,c,p,w,T,P,x,C,A,E,M,k,N,j,q,X,W,J,ne,he,we,be,ve,Be,Me,Ue,Ye,Xe,Je,st){const pt=20*e,ot=40*e,It=80*e;return this.float32[pt+0]=n,this.float32[pt+1]=a,this.int16[ot+4]=d,this.int16[ot+5]=c,this.int16[ot+6]=p,this.int16[ot+7]=w,this.int16[ot+8]=T,this.int16[ot+9]=P,this.int16[ot+10]=x,this.int16[ot+11]=C,this.int16[ot+12]=A,this.uint16[ot+13]=E,this.uint16[ot+14]=M,this.uint16[ot+15]=k,this.uint16[ot+16]=N,this.uint16[ot+17]=j,this.uint16[ot+18]=q,this.uint16[ot+19]=X,this.uint16[ot+20]=W,this.uint16[ot+21]=J,this.uint16[ot+22]=ne,this.uint16[ot+23]=he,this.uint16[ot+24]=we,this.uint16[ot+25]=be,this.uint16[ot+26]=ve,this.uint16[ot+27]=Be,this.uint32[pt+14]=Me,this.float32[pt+15]=Ue,this.float32[pt+16]=Ye,this.float32[pt+17]=Xe,this.float32[pt+18]=Je,this.uint8[It+76]=st,e}}Wd.prototype.bytesPerElement=80,qe(Wd,"StructArrayLayout2f9i15ui1ul4f1ub80");class bl extends xi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e){const n=this.length;return this.resize(n+1),this.emplace(n,e)}emplace(e,n){return this.float32[1*e+0]=n,e}}bl.prototype.bytesPerElement=4,qe(bl,"StructArrayLayout1f4");class su extends xi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,a,d,c){const p=this.length;return this.resize(p+1),this.emplace(p,e,n,a,d,c)}emplace(e,n,a,d,c,p){const w=5*e;return this.float32[w+0]=n,this.float32[w+1]=a,this.float32[w+2]=d,this.float32[w+3]=c,this.float32[w+4]=p,e}}su.prototype.bytesPerElement=20,qe(su,"StructArrayLayout5f20");class Df extends xi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,a,d,c,p,w){const T=this.length;return this.resize(T+1),this.emplace(T,e,n,a,d,c,p,w)}emplace(e,n,a,d,c,p,w,T){const P=7*e;return this.float32[P+0]=n,this.float32[P+1]=a,this.float32[P+2]=d,this.float32[P+3]=c,this.float32[P+4]=p,this.float32[P+5]=w,this.float32[P+6]=T,e}}Df.prototype.bytesPerElement=28,qe(Df,"StructArrayLayout7f28");class Ff extends xi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,a,d,c,p,w,T,P,x,C){const A=this.length;return this.resize(A+1),this.emplace(A,e,n,a,d,c,p,w,T,P,x,C)}emplace(e,n,a,d,c,p,w,T,P,x,C,A){const E=11*e;return this.float32[E+0]=n,this.float32[E+1]=a,this.float32[E+2]=d,this.float32[E+3]=c,this.float32[E+4]=p,this.float32[E+5]=w,this.float32[E+6]=T,this.float32[E+7]=P,this.float32[E+8]=x,this.float32[E+9]=C,this.float32[E+10]=A,e}}Ff.prototype.bytesPerElement=44,qe(Ff,"StructArrayLayout11f44");class dh extends xi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,a,d,c,p,w,T,P){const x=this.length;return this.resize(x+1),this.emplace(x,e,n,a,d,c,p,w,T,P)}emplace(e,n,a,d,c,p,w,T,P,x){const C=9*e;return this.float32[C+0]=n,this.float32[C+1]=a,this.float32[C+2]=d,this.float32[C+3]=c,this.float32[C+4]=p,this.float32[C+5]=w,this.float32[C+6]=T,this.float32[C+7]=P,this.float32[C+8]=x,e}}dh.prototype.bytesPerElement=36,qe(dh,"StructArrayLayout9f36");class Pc extends xi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n){const a=this.length;return this.resize(a+1),this.emplace(a,e,n)}emplace(e,n,a){const d=2*e;return this.float32[d+0]=n,this.float32[d+1]=a,e}}Pc.prototype.bytesPerElement=8,qe(Pc,"StructArrayLayout2f8");class fh extends xi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n,a,d){const c=this.length;return this.resize(c+1),this.emplace(c,e,n,a,d)}emplace(e,n,a,d,c){const p=6*e;return this.uint32[3*e+0]=n,this.uint16[p+2]=a,this.uint16[p+3]=d,this.uint16[p+4]=c,e}}fh.prototype.bytesPerElement=12,qe(fh,"StructArrayLayout1ul3ui12");class rd extends xi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e){const n=this.length;return this.resize(n+1),this.emplace(n,e)}emplace(e,n){return this.uint16[1*e+0]=n,e}}rd.prototype.bytesPerElement=2,qe(rd,"StructArrayLayout1ui2");class Gd extends xi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,a,d,c,p,w,T,P,x,C,A,E,M,k,N){const j=this.length;return this.resize(j+1),this.emplace(j,e,n,a,d,c,p,w,T,P,x,C,A,E,M,k,N)}emplace(e,n,a,d,c,p,w,T,P,x,C,A,E,M,k,N,j){const q=16*e;return this.float32[q+0]=n,this.float32[q+1]=a,this.float32[q+2]=d,this.float32[q+3]=c,this.float32[q+4]=p,this.float32[q+5]=w,this.float32[q+6]=T,this.float32[q+7]=P,this.float32[q+8]=x,this.float32[q+9]=C,this.float32[q+10]=A,this.float32[q+11]=E,this.float32[q+12]=M,this.float32[q+13]=k,this.float32[q+14]=N,this.float32[q+15]=j,e}}Gd.prototype.bytesPerElement=64,qe(Gd,"StructArrayLayout16f64");class id extends xi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,a,d,c,p,w){const T=this.length;return this.resize(T+1),this.emplace(T,e,n,a,d,c,p,w)}emplace(e,n,a,d,c,p,w,T){const P=10*e,x=5*e;return this.uint16[P+0]=n,this.uint16[P+1]=a,this.uint16[P+2]=d,this.uint16[P+3]=c,this.float32[x+2]=p,this.float32[x+3]=w,this.float32[x+4]=T,e}}id.prototype.bytesPerElement=20,qe(id,"StructArrayLayout4ui3f20");class qd extends xi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e){const n=this.length;return this.resize(n+1),this.emplace(n,e)}emplace(e,n){return this.int16[1*e+0]=n,e}}qd.prototype.bytesPerElement=2,qe(qd,"StructArrayLayout1i2");class ph extends xi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer)}emplaceBack(e){const n=this.length;return this.resize(n+1),this.emplace(n,e)}emplace(e,n){return this.uint8[1*e+0]=n,e}}ph.prototype.bytesPerElement=1,qe(ph,"StructArrayLayout1ub1");class Ip extends ou{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.int16[this._pos2+3]}get tileAnchorY(){return this._structArray.int16[this._pos2+4]}get x1(){return this._structArray.float32[this._pos4+3]}get y1(){return this._structArray.float32[this._pos4+4]}get x2(){return this._structArray.float32[this._pos4+5]}get y2(){return this._structArray.float32[this._pos4+6]}get padding(){return this._structArray.int16[this._pos2+14]}get featureIndex(){return this._structArray.uint32[this._pos4+8]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+18]}get bucketIndex(){return this._structArray.uint16[this._pos2+19]}}Ip.prototype.size=40;class Pp extends uh{get(e){return new Ip(this,e)}}qe(Pp,"CollisionBoxArray");class Bf extends ou{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+8]}get numGlyphs(){return this._structArray.uint16[this._pos2+9]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+5]}get lineStartIndex(){return this._structArray.uint32[this._pos4+6]}get lineLength(){return this._structArray.uint32[this._pos4+7]}get segment(){return this._structArray.uint16[this._pos2+16]}get lowerSize(){return this._structArray.uint16[this._pos2+17]}get upperSize(){return this._structArray.uint16[this._pos2+18]}get lineOffsetX(){return this._structArray.float32[this._pos4+10]}get lineOffsetY(){return this._structArray.float32[this._pos4+11]}get writingMode(){return this._structArray.uint8[this._pos1+48]}get placedOrientation(){return this._structArray.uint8[this._pos1+49]}set placedOrientation(e){this._structArray.uint8[this._pos1+49]=e}get hidden(){return this._structArray.uint8[this._pos1+50]}set hidden(e){this._structArray.uint8[this._pos1+50]=e}get crossTileID(){return this._structArray.uint32[this._pos4+13]}set crossTileID(e){this._structArray.uint32[this._pos4+13]=e}get associatedIconIndex(){return this._structArray.int16[this._pos2+28]}get flipState(){return this._structArray.uint8[this._pos1+58]}set flipState(e){this._structArray.uint8[this._pos1+58]=e}}Bf.prototype.size=60;class Rp extends Hd{get(e){return new Bf(this,e)}}qe(Rp,"PlacedSymbolArray");class kp extends ou{get tileAnchorX(){return this._structArray.float32[this._pos4+0]}get tileAnchorY(){return this._structArray.float32[this._pos4+1]}get projectedAnchorX(){return this._structArray.int16[this._pos2+4]}get projectedAnchorY(){return this._structArray.int16[this._pos2+5]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+6]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+7]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+8]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+9]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+10]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+11]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+12]}get key(){return this._structArray.uint16[this._pos2+13]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+14]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+15]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+16]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+17]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+18]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+19]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+20]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+21]}get featureIndex(){return this._structArray.uint16[this._pos2+22]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+23]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+24]}get numIconVertices(){return this._structArray.uint16[this._pos2+25]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+26]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+27]}get crossTileID(){return this._structArray.uint32[this._pos4+14]}set crossTileID(e){this._structArray.uint32[this._pos4+14]=e}get textOffset0(){return this._structArray.float32[this._pos4+15]}get textOffset1(){return this._structArray.float32[this._pos4+16]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+17]}get zOffset(){return this._structArray.float32[this._pos4+18]}set zOffset(e){this._structArray.float32[this._pos4+18]=e}get hasIconTextFit(){return this._structArray.uint8[this._pos1+76]}}kp.prototype.size=80;class od extends Wd{get(e){return new kp(this,e)}}qe(od,"SymbolInstanceArray");class Zd extends bl{getoffsetX(e){return this.float32[1*e+0]}}qe(Zd,"GlyphOffsetArray");class Pa extends Ia{getx(e){return this.int16[2*e+0]}gety(e){return this.int16[2*e+1]}}qe(Pa,"SymbolLineVertexArray");class Xd extends ou{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}get layoutVertexArrayOffset(){return this._structArray.uint16[this._pos2+4]}}Xd.prototype.size=12;class fm extends fh{get(e){return new Xd(this,e)}}qe(fm,"FeatureIndexArray");class zp extends Bs{geta_centroid_pos0(e){return this.uint16[2*e+0]}geta_centroid_pos1(e){return this.uint16[2*e+1]}}qe(zp,"FillExtrusionCentroidArray");class Lp extends ou{get a_join_normal_inside0(){return this._structArray.int16[this._pos2+0]}get a_join_normal_inside1(){return this._structArray.int16[this._pos2+1]}get a_join_normal_inside2(){return this._structArray.int16[this._pos2+2]}}Lp.prototype.size=6;class Op extends yo{get(e){return new Lp(this,e)}}qe(Op,"FillExtrusionWallArray");const sd=$r([{name:"a_pos",components:2,type:"Int16"}],4),Pg=$r([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]);class vo{constructor(e=[]){this.segments=e}_prepareSegment(e,n,a,d){let c=this.segments[this.segments.length-1];return e>vo.MAX_VERTEX_ARRAY_LENGTH&&nr(`Max vertices per segment is ${vo.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${e}`),(!c||c.vertexLength+e>vo.MAX_VERTEX_ARRAY_LENGTH||c.sortKey!==d)&&(c={vertexOffset:n,primitiveOffset:a,vertexLength:0,primitiveLength:0},d!==void 0&&(c.sortKey=d),this.segments.push(c)),c}prepareSegment(e,n,a,d){return this._prepareSegment(e,n.length,a.length,d)}get(){return this.segments}destroy(){for(const e of this.segments)for(const n in e.vaos)e.vaos[n].destroy()}static simpleSegment(e,n,a,d){return new vo([{vertexOffset:e,primitiveOffset:n,vertexLength:a,primitiveLength:d,vaos:{},sortKey:0}])}}function pm(s,e){return 256*(s=yn(Math.floor(s),0,255))+yn(Math.floor(e),0,255)}vo.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,qe(vo,"SegmentVector");const dc=$r([{name:"a_pattern",components:4,type:"Uint16"},{name:"a_pixel_ratio",components:1,type:"Float32"}]),Yd=$r([{name:"a_dash",components:4,type:"Uint16"}]);class Du{constructor(){this.ids=[],this.uniqueIds=[],this.positions=[],this.indexed=!1}add(e,n,a,d){this.ids.push(Nf(e)),this.positions.push(n,a,d)}eachPosition(e,n){const a=Nf(e);let d=0,c=this.ids.length-1;for(;d<c;){const p=d+c>>1;this.ids[p]>=a?c=p:d=p+1}for(;this.ids[d]===a;)n(this.positions[3*d],this.positions[3*d+1],this.positions[3*d+2]),d++}static serialize(e,n){const a=new Float64Array(e.ids),d=new Uint32Array(e.positions);return Kd(a,d,0,a.length-1),n&&(n.add(a.buffer),n.add(d.buffer)),{ids:a,positions:d}}static deserialize(e){const n=new Du;let a;n.ids=e.ids,n.positions=e.positions;for(const d of n.ids)d!==a&&n.uniqueIds.push(d),a=d;return n.indexed=!0,n}}function Nf(s){const e=+s;return!isNaN(e)&&Number.MIN_SAFE_INTEGER<=e&&e<=Number.MAX_SAFE_INTEGER?e:xa(String(s))}function Kd(s,e,n,a){for(;n<a;){const d=s[n+a>>1];let c=n-1,p=a+1;for(;;){do c++;while(s[c]<d);do p--;while(s[p]>d);if(c>=p)break;Jd(s,c,p),Jd(e,3*c,3*p),Jd(e,3*c+1,3*p+1),Jd(e,3*c+2,3*p+2)}p-n<a-p?(Kd(s,e,n,p),n=p+1):(Kd(s,e,p+1,a),a=p)}}function Jd(s,e,n){const a=s[e];s[e]=s[n],s[n]=a}qe(Du,"FeaturePositionMap");class wl{constructor(e){this.gl=e.gl,this.initialized=!1}fetchUniformLocation(e,n){return this.location||this.initialized||(this.location=this.gl.getUniformLocation(e,n),this.initialized=!0),!!this.location}set(e,n,a){throw new Error("Uniform#set() must be implemented by each concrete Uniform")}}class Hl extends wl{constructor(e){super(e),this.current=0}set(e,n,a){this.fetchUniformLocation(e,n)&&this.current!==a&&(this.current=a,this.gl.uniform1i(this.location,a))}}class xo extends wl{constructor(e){super(e),this.current=0}set(e,n,a){this.fetchUniformLocation(e,n)&&this.current!==a&&(this.current=a,this.gl.uniform1f(this.location,a))}}class Wl extends wl{constructor(e){super(e),this.current=[0,0]}set(e,n,a){this.fetchUniformLocation(e,n)&&(a[0]===this.current[0]&&a[1]===this.current[1]||(this.current=a,this.gl.uniform2f(this.location,a[0],a[1])))}}class jf extends wl{constructor(e){super(e),this.current=[0,0,0]}set(e,n,a){this.fetchUniformLocation(e,n)&&(a[0]===this.current[0]&&a[1]===this.current[1]&&a[2]===this.current[2]||(this.current=a,this.gl.uniform3f(this.location,a[0],a[1],a[2])))}}class Qd extends wl{constructor(e){super(e),this.current=[0,0,0,0]}set(e,n,a){this.fetchUniformLocation(e,n)&&(a[0]===this.current[0]&&a[1]===this.current[1]&&a[2]===this.current[2]&&a[3]===this.current[3]||(this.current=a,this.gl.uniform4f(this.location,a[0],a[1],a[2],a[3])))}}class ef extends wl{constructor(e){super(e),this.current=ir.transparent.toRenderColor(null)}set(e,n,a){this.fetchUniformLocation(e,n)&&(a.r===this.current.r&&a.g===this.current.g&&a.b===this.current.b&&a.a===this.current.a||(this.current=a,this.gl.uniform4f(this.location,a.r,a.g,a.b,a.a)))}}const mm=new Float32Array(16);class ad extends wl{constructor(e){super(e),this.current=mm}set(e,n,a){if(this.fetchUniformLocation(e,n)){if(a[12]!==this.current[12]||a[0]!==this.current[0])return this.current=a,void this.gl.uniformMatrix4fv(this.location,!1,a);for(let d=1;d<16;d++)if(a[d]!==this.current[d]){this.current=a,this.gl.uniformMatrix4fv(this.location,!1,a);break}}}}const gm=new Float32Array(9),Rg=new Float32Array(4);class ea extends wl{constructor(e){super(e),this.current=Rg}set(e,n,a){if(this.fetchUniformLocation(e,n)){for(let d=0;d<4;d++)if(a[d]!==this.current[d]){this.current=a,this.gl.uniformMatrix2fv(this.location,!1,a);break}}}}function ta(s){return[pm(255*s.r,255*s.g),pm(255*s.b,255*s.a)]}class mh{constructor(e,n,a,d){this.value=e,this.uniformNames=n.map(c=>`u_${c}`),this.type=a,this.context=d}setUniform(e,n,a,d,c){const p=d.constantOr(this.value);n.set(e,c,p instanceof ir?p.toRenderColor(this.ignoreLut?null:this.context.lut):p)}getBinding(e,n){return this.type==="color"?new ef(e):new xo(e)}}class gh{constructor(e,n){this.uniformNames=n.map(a=>`u_${a}`),this.pattern=null,this.pixelRatio=1}setConstantPatternPositions(e){this.pixelRatio=e.pixelRatio||1,this.pattern=e.tl.concat(e.br)}setUniform(e,n,a,d,c){const p=c==="u_pattern"||c==="u_dash"?this.pattern:c==="u_pixel_ratio"?this.pixelRatio:null;p&&n.set(e,c,p)}getBinding(e,n){return n==="u_pattern"||n==="u_dash"?new Qd(e):new xo(e)}}class Rc{constructor(e,n,a,d){this.expression=e,this.type=a,this.maxValue=0,this.paintVertexAttributes=n.map(c=>({name:`a_${c}`,type:"Float32",components:a==="color"?2:1,offset:0})),this.paintVertexArray=new d}populatePaintArray(e,n,a,d,c,p,w){const T=this.paintVertexArray.length,P=this.expression.evaluate(new qr(0,{brightness:p}),n,{},c,d,w);this.paintVertexArray.resize(e),this._setPaintValue(T,e,P,this.context)}updatePaintArray(e,n,a,d,c,p,w){const T=this.expression.evaluate({zoom:0,brightness:w},a,d,void 0,c);this._setPaintValue(e,n,T,this.context)}_setPaintValue(e,n,a,d){if(this.type==="color"){const c=ta(a.toRenderColor(this.ignoreLut?null:d.lut));for(let p=e;p<n;p++)this.paintVertexArray.emplace(p,c[0],c[1])}else{for(let c=e;c<n;c++)this.paintVertexArray.emplace(c,a);this.maxValue=Math.max(this.maxValue,Math.abs(a))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class Gl{constructor(e,n,a,d,c,p){this.expression=e,this.uniformNames=n.map(w=>`u_${w}_t`),this.type=a,this.useIntegerZoom=d,this.context=c,this.maxValue=0,this.paintVertexAttributes=n.map(w=>({name:`a_${w}`,type:"Float32",components:a==="color"?4:2,offset:0})),this.paintVertexArray=new p}populatePaintArray(e,n,a,d,c,p,w){const T=this.expression.evaluate(new qr(this.context.zoom,{brightness:p}),n,{},c,d,w),P=this.expression.evaluate(new qr(this.context.zoom+1,{brightness:p}),n,{},c,d,w),x=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValue(x,e,T,P,this.context)}updatePaintArray(e,n,a,d,c,p,w){const T=this.expression.evaluate({zoom:this.context.zoom,brightness:w},a,d,void 0,c),P=this.expression.evaluate({zoom:this.context.zoom+1,brightness:w},a,d,void 0,c);this._setPaintValue(e,n,T,P,this.context)}_setPaintValue(e,n,a,d,c){if(this.type==="color"){const p=ta(a.toRenderColor(this.ignoreLut?null:c.lut)),w=ta(a.toRenderColor(this.ignoreLut?null:c.lut));for(let T=e;T<n;T++)this.paintVertexArray.emplace(T,p[0],p[1],w[0],w[1])}else{for(let p=e;p<n;p++)this.paintVertexArray.emplace(p,a,d);this.maxValue=Math.max(this.maxValue,Math.abs(a),Math.abs(d))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(e,n,a,d,c){const p=this.useIntegerZoom?Math.floor(a.zoom):a.zoom,w=yn(this.expression.interpolationFactor(p,this.context.zoom,this.context.zoom+1),0,1);n.set(e,c,w)}getBinding(e,n){return new xo(e)}}class au{constructor(e,n,a,d,c){this.expression=e,this.layerId=c,this.paintVertexAttributes=(a==="array"?Yd:dc).members;for(let p=0;p<n.length;++p);this.paintVertexArray=new d}populatePaintArray(e,n,a,d){const c=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValues(c,e,n.patterns&&n.patterns[this.layerId],a)}updatePaintArray(e,n,a,d,c,p,w){this._setPaintValues(e,n,a.patterns&&a.patterns[this.layerId],p)}_setPaintValues(e,n,a,d){if(!d||!a)return;const c=d[a];if(!c)return;const{tl:p,br:w,pixelRatio:T}=c;for(let P=e;P<n;P++)this.paintVertexArray.emplace(P,p[0],p[1],w[0],w[1],T)}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class lu{constructor(e,n,a=()=>!0){this.binders={},this._buffers=[],this.context=n;const d=[];for(const c in e.paint._values){const p=e.paint.get(c),w=e.paint.get(`${c}-use-theme`);if(c.endsWith("-use-theme")||!a(c)||!(p instanceof Ri&&ha(p.property.specification)))continue;const T=_m(c,e.type),P=p.value,x=p.property.specification.type,C=!!p.property.useIntegerZoom,A=c==="line-dasharray"||c.endsWith("pattern"),E=c==="line-dasharray"&&e.layout.get("line-cap").value.kind!=="constant";if(P.kind!=="constant"||E)if(P.kind==="source"||E||A){const M=$f(c,x,"source");this.binders[c]=A?new au(P,T,x,M,e.id):new Rc(P,T,x,M),d.push(`/a_${c}`)}else{const M=$f(c,x,"composite");this.binders[c]=new Gl(P,T,x,C,n,M),d.push(`/z_${c}`)}else this.binders[c]=A?new gh(P.value,T):new mh(P.value,T,x,n),d.push(`/u_${c}`);w&&(this.binders[c].ignoreLut=w.constantOr("default")==="none",this.binders[c].checkUseTheme=!0)}this.cacheKey=d.sort().join("")}getMaxValue(e){const n=this.binders[e];return n instanceof Rc||n instanceof Gl?n.maxValue:0}populatePaintArrays(e,n,a,d,c,p,w){for(const T in this.binders){const P=this.binders[T];P.context=this.context,(P instanceof Rc||P instanceof Gl||P instanceof au)&&P.populatePaintArray(e,n,a,d,c,p,w)}}setConstantPatternPositions(e){for(const n in this.binders){const a=this.binders[n];a instanceof gh&&a.setConstantPatternPositions(e)}}updatePaintArrays(e,n,a,d,c,p,w,T,P){let x=!1;const C=Object.keys(e),A=C.length!==0&&!T,E=A?C:n.uniqueIds;this.context.lut=c.lut;for(const M in this.binders){const k=this.binders[M];if(k.context=this.context,(k instanceof Rc||k instanceof Gl||k instanceof au)&&(k.expression.isStateDependent===!0||k.expression.isLightConstant===!1)){const N=c.paint.get(M);k.expression=N.value;for(const j of E){const q=e[j.toString()];n.eachPosition(j,(X,W,J)=>{const ne=d.feature(X);k.updatePaintArray(W,J,ne,q,p,w,P)})}if(!A)for(const j of a.uniqueIds){const q=e[j.toString()];a.eachPosition(j,(X,W,J)=>{const ne=d.feature(X);k.updatePaintArray(W,J,ne,q,p,w,P)})}x=!0}}return x}defines(){const e=[];for(const n in this.binders){const a=this.binders[n];(a instanceof mh||a instanceof gh)&&e.push(...a.uniformNames.map(d=>`#define HAS_UNIFORM_${d}`))}return e}getBinderAttributes(){const e=[];for(const n in this.binders){const a=this.binders[n];if(a instanceof Rc||a instanceof Gl||a instanceof au)for(let d=0;d<a.paintVertexAttributes.length;d++)e.push(a.paintVertexAttributes[d].name)}return e}getBinderUniforms(){const e=[];for(const n in this.binders){const a=this.binders[n];if(a instanceof mh||a instanceof gh||a instanceof Gl)for(const d of a.uniformNames)e.push(d)}return e}getPaintVertexBuffers(){return this._buffers}getUniforms(e){const n=[];for(const a in this.binders){const d=this.binders[a];if(d instanceof mh||d instanceof gh||d instanceof Gl)for(const c of d.uniformNames)n.push({name:c,property:a,binding:d.getBinding(e,c)})}return n}setUniforms(e,n,a,d,c){for(const{name:p,property:w,binding:T}of a){if(this.binders[w].checkUseTheme&&this.binders[w]instanceof mh){const P=d.get(`${w}-use-theme`);P.isConstant()&&(this.binders[w].ignoreLut=P.constantOr("default")==="none")}this.binders[w].setUniform(e,T,c,d.get(w),p)}}updatePaintBuffers(){this._buffers=[];for(const e in this.binders){const n=this.binders[e];(n instanceof Rc||n instanceof Gl||n instanceof au)&&n.paintVertexBuffer&&this._buffers.push(n.paintVertexBuffer)}}upload(e){for(const n in this.binders){const a=this.binders[n];(a instanceof Rc||a instanceof Gl||a instanceof au)&&a.upload(e)}this.updatePaintBuffers()}destroy(){for(const e in this.binders){const n=this.binders[e];(n instanceof Rc||n instanceof Gl||n instanceof au)&&n.destroy()}}}class cu{constructor(e,n,a=()=>!0){this.programConfigurations={};for(const d of e)this.programConfigurations[d.id]=new lu(d,n,a);this.needsUpload=!1,this._featureMap=new Du,this._featureMapWithoutIds=new Du,this._bufferOffset=0,this._idlessCounter=0}populatePaintArrays(e,n,a,d,c,p,w,T){for(const P in this.programConfigurations)this.programConfigurations[P].populatePaintArrays(e,n,d,c,p,w,T);n.id!==void 0?this._featureMap.add(n.id,a,this._bufferOffset,e):(this._featureMapWithoutIds.add(this._idlessCounter,a,this._bufferOffset,e),this._idlessCounter+=1),this._bufferOffset=e,this.needsUpload=!0}updatePaintArrays(e,n,a,d,c,p,w){for(const T of a)this.needsUpload=this.programConfigurations[T.id].updatePaintArrays(e,this._featureMap,this._featureMapWithoutIds,n,T,d,c,p,w||0)||this.needsUpload}get(e){return this.programConfigurations[e]}upload(e){if(this.needsUpload){for(const n in this.programConfigurations)this.programConfigurations[n].upload(e);this.needsUpload=!1}}destroy(){for(const e in this.programConfigurations)this.programConfigurations[e].destroy()}}const ld={"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-occlusion-opacity":["occlusion_opacity"],"icon-occlusion-opacity":["occlusion_opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-emissive-strength":["emissive_strength"],"icon-emissive-strength":["emissive_strength"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"symbol-z-offset":["z_offset"],"line-gap-width":["gapwidth"],"line-pattern":["pattern","pixel_ratio"],"fill-pattern":["pattern","pixel_ratio"],"fill-extrusion-pattern":["pattern","pixel_ratio"],"line-dasharray":["dash"]};function _m(s,e){return ld[s]||[s.replace(`${e}-`,"").replace(/-/g,"_")]}const ym={"line-pattern":{source:Ou,composite:Ou},"fill-pattern":{source:Ou,composite:Ou},"fill-extrusion-pattern":{source:Ou,composite:Ou},"line-dasharray":{source:Fs,composite:Fs}},cd={color:{source:Pc,composite:xl},number:{source:bl,composite:Pc}};function $f(s,e,n){const a=ym[s];return a&&a[n]||cd[e][n]}qe(mh,"ConstantBinder"),qe(gh,"PatternConstantBinder"),qe(Rc,"SourceExpressionBinder"),qe(au,"PatternCompositeBinder"),qe(Gl,"CompositeExpressionBinder"),qe(lu,"ProgramConfiguration",{omit:["_buffers"]}),qe(cu,"ProgramConfigurationSet");const Hs=pn/Math.PI/2,tf=5,ud=6,vm=16383,Fu=64,nf=[Fu,32,16],Sl=-Hs,Ra=Hs;function ka(s,e,n,a=Hs){return n=$n(n),[s*Math.sin(n)*a,-e*a,s*Math.cos(n)*a]}function _h(s,e,n){return ka(Math.cos($n(s)),Math.sin($n(s)),e,n)}const yh=63710088e-1,rf=2*Math.PI*yh;class Qr{constructor(e,n){if(isNaN(e)||isNaN(n))throw new Error(`Invalid LngLat object: (${e}, ${n})`);if(this.lng=+e,this.lat=+n,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new Qr(ui(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(e){const n=Math.PI/180,a=this.lat*n,d=e.lat*n,c=Math.sin(a)*Math.sin(d)+Math.cos(a)*Math.cos(d)*Math.cos((e.lng-this.lng)*n);return yh*Math.acos(Math.min(c,1))}toBounds(e=0){const n=360*e/40075017,a=n/Math.cos(Math.PI/180*this.lat);return new uu({lng:this.lng-a,lat:this.lat-n},{lng:this.lng+a,lat:this.lat+n})}toEcef(e){return _h(this.lat,this.lng,Hs+e*Hs/yh)}static convert(e){if(e instanceof Qr)return e;if(Array.isArray(e)&&(e.length===2||e.length===3))return new Qr(Number(e[0]),Number(e[1]));if(!Array.isArray(e)&&typeof e=="object"&&e!==null)return new Qr(Number("lng"in e?e.lng:e.lon),Number(e.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}class uu{constructor(e,n){if(e)if(n)this.setSouthWest(e).setNorthEast(n);else if(e.length===4){const a=e;this.setSouthWest([a[0],a[1]]).setNorthEast([a[2],a[3]])}else{const a=e;this.setSouthWest(a[0]).setNorthEast(a[1])}}setNorthEast(e){return this._ne=e instanceof Qr?new Qr(e.lng,e.lat):Qr.convert(e),this}setSouthWest(e){return this._sw=e instanceof Qr?new Qr(e.lng,e.lat):Qr.convert(e),this}extend(e){const n=this._sw,a=this._ne;let d,c;if(e instanceof Qr)d=e,c=e;else{if(!(e instanceof uu))return Array.isArray(e)?e.length===4||e.every(Array.isArray)?this.extend(uu.convert(e)):this.extend(Qr.convert(e)):typeof e=="object"&&e!==null&&e.hasOwnProperty("lat")&&(e.hasOwnProperty("lon")||e.hasOwnProperty("lng"))?this.extend(Qr.convert(e)):this;if(d=e._sw,c=e._ne,!d||!c)return this}return n||a?(n.lng=Math.min(d.lng,n.lng),n.lat=Math.min(d.lat,n.lat),a.lng=Math.max(c.lng,a.lng),a.lat=Math.max(c.lat,a.lat)):(this._sw=new Qr(d.lng,d.lat),this._ne=new Qr(c.lng,c.lat)),this}getCenter(){return new Qr((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new Qr(this.getWest(),this.getNorth())}getSouthEast(){return new Qr(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(e){const{lng:n,lat:a}=Qr.convert(e);let d=this._sw.lng<=n&&n<=this._ne.lng;return this._sw.lng>this._ne.lng&&(d=this._sw.lng>=n&&n>=this._ne.lng),this._sw.lat<=a&&a<=this._ne.lat&&d}static convert(e){if(e)return e instanceof uu?e:new uu(e)}}const hd=0,Ws=25.5;function of(s){return rf*Math.cos(s*Math.PI/180)}function Bu(s){return(180+s)/360}function ql(s){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+s*Math.PI/360)))/360}function Ki(s,e){return s/of(e)}function qa(s){return 360*s-180}function jn(s){return 360/Math.PI*Math.atan(Math.exp((180-360*s)*Math.PI/180))-90}function Nu(s,e){return s*of(jn(e))}const da=85.051129;function u(s){return Math.cos($n(yn(s,-85.051129,da)))}function t(s,e){const n=yn(e,hd,Ws),a=Math.pow(2,n);return u(s)*rf/(512*a)}function o(s){return 1/Math.cos(s*Math.PI/180)}function h(s,e=0){const n=Math.exp(Math.PI*(1-(s.y+e/pn)/(1<<s.z)*2));return 80150034*n/(n*n+1)/pn/(1<<s.z)}class g{constructor(e,n,a=0){this.x=+e,this.y=+n,this.z=+a}static fromLngLat(e,n=0){const a=Qr.convert(e);return new g(Bu(a.lng),ql(a.lat),Ki(n,a.lat))}toLngLat(){return new Qr(qa(this.x),jn(this.y))}toAltitude(){return Nu(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/rf*o(jn(this.y))}}function v(s,e,n,a,d,c,p,w,T){const P=(e+a)/2,x=(n+d)/2,C=new Ht(P,x);w(C),function(A,E,M,k,N,j){const q=M-N,X=k-j;return Math.abs((k-E)*q-(M-A)*X)/Math.hypot(q,X)}(C.x,C.y,c.x,c.y,p.x,p.y)>=T?(v(s,e,n,P,x,c,C,w,T),v(s,P,x,a,d,C,p,w,T)):s.push(p)}function S(s,e,n){let a=s[0],d=a.x,c=a.y;e(a);const p=[a];for(let w=1;w<s.length;w++){const T=s[w],{x:P,y:x}=T;e(T),v(p,d,c,P,x,a,T,e,n),d=P,c=x,a=T}return p}function I(s,e,n,a){if(a(e,n)){const d=e.add(n)._mult(.5);I(s,e,d,a),I(s,d,n,a)}else s.push(n)}function L(s,e){let n=s[0];const a=[n];for(let d=1;d<s.length;d++){const c=s[d];I(a,n,c,e),n=c}return a}const D=Math.pow(2,14)-1,B=-D-1;function V(s,e){const n=Math.round(s.x*e),a=Math.round(s.y*e);return s.x=yn(n,B,D),s.y=yn(a,B,D),(n<s.x||n>s.x+1||a<s.y||a>s.y+1)&&nr("Geometry exceeds allowed extent, reduce your vector tile buffer size"),s}function U(s,e,n){const a=s.loadGeometry(),d=s.extent,c=pn/d;if(e&&n&&n.projection.isReprojectedInTileSpace){const p=1<<e.z,{scale:w,x:T,y:P,projection:x}=n,C=A=>{const E=qa((e.x+A.x/d)/p),M=jn((e.y+A.y/d)/p),k=x.project(E,M);A.x=(k.x*w-T)*d,A.y=(k.y*w-P)*d};for(let A=0;A<a.length;A++)if(s.type!==1)a[A]=S(a[A],C,1);else{const E=[];for(const M of a[A])M.x<0||M.x>=d||M.y<0||M.y>=d||(C(M),E.push(M));a[A]=E}}for(const p of a)for(const w of p)V(w,c);return a}function G(s,e){return{type:s.type,id:s.id,properties:s.properties,geometry:e?U(s):[]}}function re(s,e,n,a,d){s.emplaceBack(2*e+(a+1)/2,2*n+(d+1)/2)}function Q(s,e,n){s.emplaceBack(e.x,e.y,e.z,n[0]*16384,n[1]*16384,n[2]*16384)}class ue{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(n=>n.fqid),this.index=e.index,this.hasPattern=!1,this.projection=e.projection,this.layoutVertexArray=new Ia,this.indexArray=new Ns,this.segments=new vo,this.programConfigurations=new cu(e.layers,{zoom:e.zoom,lut:e.lut}),this.stateDependentLayerIds=this.layers.filter(n=>n.isStateDependent()).map(n=>n.id)}updateFootprints(e,n){}populate(e,n,a,d){const c=this.layers[0],p=[];let w=null;c.type==="circle"&&(w=c.layout.get("circle-sort-key"));for(const{feature:P,id:x,index:C,sourceLayerIndex:A}of e){const E=this.layers[0]._featureFilter.needGeometry,M=G(P,E);if(!this.layers[0]._featureFilter.filter(new qr(this.zoom),M,a))continue;const k=w?w.evaluate(M,{},a):void 0,N={id:x,properties:P.properties,type:P.type,sourceLayerIndex:A,index:C,geometry:E?M.geometry:U(P,a,d),patterns:{},sortKey:k};p.push(N)}w&&p.sort((P,x)=>P.sortKey-x.sortKey);let T=null;d.projection.name==="globe"&&(this.globeExtVertexArray=new nd,T=d.projection);for(const P of p){const{geometry:x,index:C,sourceLayerIndex:A}=P,E=e[C].feature;this.addFeature(P,x,C,n.availableImages,a,T,n.brightness),n.featureIndex.insert(E,x,C,A,this.index)}}update(e,n,a,d,c,p,w){this.programConfigurations.updatePaintArrays(e,n,c,a,d,p,w)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,sd.members),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.globeExtVertexArray&&(this.globeExtVertexBuffer=e.createVertexBuffer(this.globeExtVertexArray,Pg.members))),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy())}addFeature(e,n,a,d,c,p,w){for(const T of n)for(const P of T){const x=P.x,C=P.y;if(x<0||x>=pn||C<0||C>=pn)continue;if(p){const M=p.projectTilePoint(x,C,c),k=p.upVector(c,x,C),N=this.globeExtVertexArray;Q(N,M,k),Q(N,M,k),Q(N,M,k),Q(N,M,k)}const A=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,e.sortKey),E=A.vertexLength;re(this.layoutVertexArray,x,C,-1,-1),re(this.layoutVertexArray,x,C,1,-1),re(this.layoutVertexArray,x,C,1,1),re(this.layoutVertexArray,x,C,-1,1),this.indexArray.emplaceBack(E,E+1,E+2),this.indexArray.emplaceBack(E,E+2,E+3),A.vertexLength+=4,A.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,a,{},d,c,w)}}function ce(s,e){for(let n=0;n<s.length;n++)if(Ze(e,s[n]))return!0;for(let n=0;n<e.length;n++)if(Ze(s,e[n]))return!0;return!!Fe(s,e)}function ye(s,e,n){return!!Ze(s,e)||!!Oe(e,s,n)}function Ae(s,e){if(s.length===1)return Ge(e,s[0]);for(let n=0;n<e.length;n++){const a=e[n];for(let d=0;d<a.length;d++)if(Ze(s,a[d]))return!0}for(let n=0;n<s.length;n++)if(Ge(e,s[n]))return!0;for(let n=0;n<e.length;n++)if(Fe(s,e[n]))return!0;return!1}function Ee(s,e,n){if(s.length>1){if(Fe(s,e))return!0;for(let a=0;a<e.length;a++)if(Oe(e[a],s,n))return!0}for(let a=0;a<s.length;a++)if(Oe(s[a],e,n))return!0;return!1}function Fe(s,e){if(s.length===0||e.length===0)return!1;for(let n=0;n<s.length-1;n++){const a=s[n],d=s[n+1];for(let c=0;c<e.length-1;c++)if(ze(a,d,e[c],e[c+1]))return!0}return!1}function ze(s,e,n,a){return ss(s,n,a)!==ss(e,n,a)&&ss(s,e,n)!==ss(s,e,a)}function Oe(s,e,n){const a=n*n;if(e.length===1)return s.distSqr(e[0])<a;for(let d=1;d<e.length;d++)if(ke(s,e[d-1],e[d])<a)return!0;return!1}function ke(s,e,n){const a=e.distSqr(n);if(a===0)return s.distSqr(e);const d=((s.x-e.x)*(n.x-e.x)+(s.y-e.y)*(n.y-e.y))/a;return s.distSqr(d<0?e:d>1?n:n.sub(e)._mult(d)._add(e))}function Ge(s,e){let n,a,d,c=!1;for(let p=0;p<s.length;p++){n=s[p];for(let w=0,T=n.length-1;w<n.length;T=w++)a=n[w],d=n[T],a.y>e.y!=d.y>e.y&&e.x<(d.x-a.x)*(e.y-a.y)/(d.y-a.y)+a.x&&(c=!c)}return c}function Ze(s,e){let n=!1;for(let a=0,d=s.length-1;a<s.length;d=a++){const c=s[a],p=s[d];c.y>e.y!=p.y>e.y&&e.x<(p.x-c.x)*(e.y-c.y)/(p.y-c.y)+c.x&&(n=!n)}return n}function ft(s,e,n,a,d){for(const p of s)if(e<=p.x&&n<=p.y&&a>=p.x&&d>=p.y)return!0;const c=[new Ht(e,n),new Ht(e,d),new Ht(a,d),new Ht(a,n)];if(s.length>2){for(const p of c)if(Ze(s,p))return!0}for(let p=0;p<s.length-1;p++)if(ct(s[p],s[p+1],c))return!0;return!1}function ct(s,e,n){const a=n[0],d=n[2];if(s.x<a.x&&e.x<a.x||s.x>d.x&&e.x>d.x||s.y<a.y&&e.y<a.y||s.y>d.y&&e.y>d.y)return!1;const c=ss(s,e,n[0]);return c!==ss(s,e,n[1])||c!==ss(s,e,n[2])||c!==ss(s,e,n[3])}function We(s,e,n,a,d,c){let p=e.y-s.y,w=s.x-e.x;if(c=c||0){const T=p*p+w*w;if(T===0)return!0;const P=Math.sqrt(T);p/=P,w/=P}return!((n.x-s.x)*p+(n.y-s.y)*w-c<0||(a.x-s.x)*p+(a.y-s.y)*w-c<0||(d.x-s.x)*p+(d.y-s.y)*w-c<0)}function tt(s,e,n,a,d,c,p){return!(We(s,e,a,d,c,p)||We(e,n,a,d,c,p)||We(n,s,a,d,c,p)||We(a,d,s,e,n,p)||We(d,c,s,e,n,p)||We(c,a,s,e,n,p))}function zt(s,e,n){const a=e.paint.get(s).value;return a.kind==="constant"?a.value:n.programConfigurations.get(e.id).getMaxValue(s)}function Gt(s){return Math.sqrt(s[0]*s[0]+s[1]*s[1])}function Yt(s,e,n,a,d){if(!e[0]&&!e[1])return s;const c=Ht.convert(e)._mult(d);n==="viewport"&&c._rotate(-a);const p=[];for(let w=0;w<s.length;w++)p.push(s[w].sub(c));return p}function dt(s,e,n,a){const d=Ht.convert(s)._mult(a);return e==="viewport"&&d._rotate(-n),d}let Ft,Et;qe(ue,"CircleBucket",{omit:["layers"]});var rn,Vt={exports:{}},kt=(rn||(rn=1,function(s,e){(function(n){function a(c,p,w){var T=d(256*c,256*(p=Math.pow(2,w)-p-1),w),P=d(256*(c+1),256*(p+1),w);return T[0]+","+T[1]+","+P[0]+","+P[1]}function d(c,p,w){var T=2*Math.PI*6378137/256/Math.pow(2,w);return[c*T-2*Math.PI*6378137/2,p*T-2*Math.PI*6378137/2]}n.getURL=function(c,p,w,T,P,x){return x=x||{},c+"?"+["bbox="+a(w,T,P),"format="+(x.format||"image/png"),"service="+(x.service||"WMS"),"version="+(x.version||"1.1.1"),"request="+(x.request||"GetMap"),"srs="+(x.srs||"EPSG:3857"),"width="+(x.width||256),"height="+(x.height||256),"layers="+p].join("&")},n.getTileBBox=a,n.getMercCoords=d,Object.defineProperty(n,"__esModule",{value:!0})})(e)}(0,Vt.exports)),Vt.exports);class _n{constructor(e,n,a){this.z=e,this.x=n,this.y=a,this.key=xn(0,e,e,n,a)}equals(e){return this.z===e.z&&this.x===e.x&&this.y===e.y}url(e,n){const a=kt.getTileBBox(this.x,this.y,this.z),d=function(c,p,w){let T,P="";for(let x=c;x>0;x--)T=1<<x-1,P+=(p&T?1:0)+(w&T?2:0);return P}(this.z,this.x,this.y);return e[(this.x+this.y)%e.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(n==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",d).replace("{bbox-epsg-3857}",a)}toString(){return`${this.z}/${this.x}/${this.y}`}}class gn{constructor(e,n){this.wrap=e,this.canonical=n,this.key=xn(e,n.z,n.z,n.x,n.y)}}class ln{constructor(e,n,a,d,c){this.overscaledZ=e,this.wrap=n,this.canonical=new _n(a,+d,+c),this.key=n===0&&e===a?this.canonical.key:xn(n,e,a,d,c)}equals(e){return this.overscaledZ===e.overscaledZ&&this.wrap===e.wrap&&this.canonical.equals(e.canonical)}scaledTo(e){const n=this.canonical.z-e;return e>this.canonical.z?new ln(e,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new ln(e,this.wrap,e,this.canonical.x>>n,this.canonical.y>>n)}calculateScaledKey(e,n=!0){if(this.overscaledZ===e&&n)return this.key;if(e>this.canonical.z)return xn(this.wrap*+n,e,this.canonical.z,this.canonical.x,this.canonical.y);{const a=this.canonical.z-e;return xn(this.wrap*+n,e,e,this.canonical.x>>a,this.canonical.y>>a)}}isChildOf(e){if(e.wrap!==this.wrap)return!1;const n=this.canonical.z-e.canonical.z;return e.overscaledZ===0||e.overscaledZ<this.overscaledZ&&e.canonical.z<this.canonical.z&&e.canonical.x===this.canonical.x>>n&&e.canonical.y===this.canonical.y>>n}children(e){if(this.overscaledZ>=e)return[new ln(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const n=this.canonical.z+1,a=2*this.canonical.x,d=2*this.canonical.y;return[new ln(n,this.wrap,n,a,d),new ln(n,this.wrap,n,a+1,d),new ln(n,this.wrap,n,a,d+1),new ln(n,this.wrap,n,a+1,d+1)]}isLessThan(e){return this.wrap<e.wrap||!(this.wrap>e.wrap)&&(this.overscaledZ<e.overscaledZ||!(this.overscaledZ>e.overscaledZ)&&(this.canonical.x<e.canonical.x||!(this.canonical.x>e.canonical.x)&&this.canonical.y<e.canonical.y))}wrapped(){return new ln(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(e){return new ln(this.overscaledZ,e,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new gn(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}}function xn(s,e,n,a,d){const c=1<<Math.min(n,22);let p=c*(d%c)+a%c;return s&&n<22&&(p+=c*c*((s<0?-2*s-1:2*s)%(1<<2*(22-n)))),16*(32*p+n)+(e-n)}const tr=[s=>{let e=s.canonical.x-1,n=s.wrap;return e<0&&(e=(1<<s.canonical.z)-1,n--),new ln(s.overscaledZ,n,s.canonical.z,e,s.canonical.y)},s=>{let e=s.canonical.x+1,n=s.wrap;return e===1<<s.canonical.z&&(e=0,n++),new ln(s.overscaledZ,n,s.canonical.z,e,s.canonical.y)},s=>new ln(s.overscaledZ,s.wrap,s.canonical.z,s.canonical.x,(s.canonical.y===0?1<<s.canonical.z:s.canonical.y)-1),s=>new ln(s.overscaledZ,s.wrap,s.canonical.z,s.canonical.x,s.canonical.y===(1<<s.canonical.z)-1?0:s.canonical.y+1)];qe(_n,"CanonicalTileID"),qe(ln,"OverscaledTileID",{omit:["projMatrix","expandedProjMatrix"]});const Ln=$r([{type:"Float32",name:"a_globe_pos",components:3},{type:"Float32",name:"a_uv",components:2}]),{members:Fn}=Ln,Yn=$r([{name:"a_pos_3",components:3,type:"Int16"}]);var Dr=$r([{name:"a_pos",type:"Int16",components:2}]);class pr{constructor(e,n){this.pos=e,this.dir=n}intersectsPlane(e,n,a){const d=Re.vec3.dot(n,this.dir);if(Math.abs(d)<1e-6)return!1;const c=((e[0]-this.pos[0])*n[0]+(e[1]-this.pos[1])*n[1]+(e[2]-this.pos[2])*n[2])/d;return a[0]=this.pos[0]+this.dir[0]*c,a[1]=this.pos[1]+this.dir[1]*c,a[2]=this.pos[2]+this.dir[2]*c,!0}closestPointOnSphere(e,n,a){if(Re.vec3.equals(this.pos,e)||n===0)return a[0]=a[1]=a[2]=0,!1;const[d,c,p]=this.dir,w=this.pos[0]-e[0],T=this.pos[1]-e[1],P=this.pos[2]-e[2],x=d*d+c*c+p*p,C=2*(w*d+T*c+P*p),A=C*C-4*x*(w*w+T*T+P*P-n*n);if(A<0){const E=Math.max(-C/2,0),M=w+d*E,k=T+c*E,N=P+p*E,j=Math.hypot(M,k,N);return a[0]=M*n/j,a[1]=k*n/j,a[2]=N*n/j,!1}{const E=(-C-Math.sqrt(A))/(2*x);if(E<0){const M=Math.hypot(w,T,P);return a[0]=w*n/M,a[1]=T*n/M,a[2]=P*n/M,!1}return a[0]=w+d*E,a[1]=T+c*E,a[2]=P+p*E,!0}}}class Oi{constructor(e,n,a,d,c){this.TL=e,this.TR=n,this.BR=a,this.BL=d,this.horizon=c}static fromInvProjectionMatrix(e,n,a){const d=[-1,1,1],c=[1,1,1],p=[1,-1,1],w=[-1,-1,1],T=Re.vec3.transformMat4(d,d,e),P=Re.vec3.transformMat4(c,c,e),x=Re.vec3.transformMat4(p,p,e),C=Re.vec3.transformMat4(w,w,e);return new Oi(T,P,x,C,n/a)}}function Si(s,e,n){let a=1/0,d=-1/0;const c=[];for(const p of s){Re.vec3.sub(c,p,e);const w=Re.vec3.dot(c,n);a=Math.min(a,w),d=Math.max(d,w)}return[a,d]}function si(s,e){let n=!0;for(let a=0;a<s.planes.length;a++){const d=s.planes[a];let c=0;for(let p=0;p<e.length;p++)c+=Re.vec3.dot(d,e[p])+d[3]>=0;if(c===0)return 0;c!==e.length&&(n=!1)}return n?2:1}function Fr(s,e){for(const n of s.projections){const a=Si(e,s.points[0],n.axis);if(n.projection[1]<a[0]||n.projection[0]>a[1])return 0}return 1}function ur(s,e){let n=0;const a=[0,0,0,0];for(let d=0;d<s.length;d++)a[0]=s[d][0],a[1]=s[d][1],a[2]=s[d][2],a[3]=1,Re.vec4.dot(a,e)>=0&&n++;return n}class Er{constructor(e,n){this.points=e||new Array(8).fill([0,0,0]),this.planes=n||new Array(6).fill([0,0,0,0]),this.bounds=Bn.fromPoints(this.points),this.projections=[],this.frustumEdges=[Re.vec3.sub([],this.points[2],this.points[3]),Re.vec3.sub([],this.points[0],this.points[3]),Re.vec3.sub([],this.points[4],this.points[0]),Re.vec3.sub([],this.points[5],this.points[1]),Re.vec3.sub([],this.points[6],this.points[2]),Re.vec3.sub([],this.points[7],this.points[3])];for(const a of this.frustumEdges){const d=[0,-a[2],a[1]],c=[a[2],0,-a[0]];this.projections.push({axis:d,projection:Si(this.points,this.points[0],d)}),this.projections.push({axis:c,projection:Si(this.points,this.points[0],c)})}}static fromInvProjectionMatrix(e,n,a,d){const c=Math.pow(2,a),p=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(P=>{const x=Re.vec4.transformMat4([],P,e),C=1/x[3]/n*c;return Re.vec4.mul(x,x,[C,C,d?1/x[3]:C,C])}),w=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(P=>{const x=Re.vec3.sub([],p[P[0]],p[P[1]]),C=Re.vec3.sub([],p[P[2]],p[P[1]]),A=Re.vec3.normalize([],Re.vec3.cross([],x,C)),E=-Re.vec3.dot(A,p[P[1]]);return A.concat(E)}),T=[];for(let P=0;P<p.length;P++)T.push([p[P][0],p[P][1],p[P][2]]);return new Er(T,w)}intersectsPrecise(e,n,a){for(let d=0;d<n.length;d++)if(!ur(e,n[d]))return 0;for(let d=0;d<this.planes.length;d++)if(!ur(e,this.planes[d]))return 0;for(const d of a)for(const c of this.frustumEdges){const p=Re.vec3.cross([],d,c),w=Re.vec3.length(p);if(w===0)continue;Re.vec3.scale(p,p,1/w);const T=Si(this.points,this.points[0],p),P=Si(e,this.points[0],p);if(T[0]>P[1]||P[0]>T[1])return 0}return 1}containsPoint(e){for(const n of this.planes){const a=n[3];if(Re.vec3.dot([n[0],n[1],n[2]],e)+a<0)return!1}return!0}}class Bn{static fromPoints(e){const n=[1/0,1/0,1/0],a=[-1/0,-1/0,-1/0];for(const d of e)Re.vec3.min(n,n,d),Re.vec3.max(a,a,d);return new Bn(n,a)}static fromTileIdAndHeight(e,n,a){const d=1<<e.canonical.z,c=e.canonical.x,p=e.canonical.y;return new Bn([c/d,p/d,n],[(c+1)/d,(p+1)/d,a])}static applyTransform(e,n){const a=e.getCorners();for(let d=0;d<a.length;++d)Re.vec3.transformMat4(a[d],a[d],n);return Bn.fromPoints(a)}static applyTransformFast(e,n){const a=[n[12],n[13],n[14]],d=[...a];for(let c=0;c<3;c++)for(let p=0;p<3;p++){const w=n[4*p+c],T=w*e.min[p],P=w*e.max[p];a[c]+=Math.min(T,P),d[c]+=Math.max(T,P)}return new Bn(a,d)}static projectAabbCorners(e,n){const a=e.getCorners();for(let d=0;d<a.length;++d)Re.vec3.transformMat4(a[d],a[d],n);return a}constructor(e,n){this.min=e,this.max=n,this.center=Re.vec3.scale([],Re.vec3.add([],this.min,this.max),.5)}quadrant(e){const n=[e%2==0,e<2],a=Re.vec3.clone(this.min),d=Re.vec3.clone(this.max);for(let c=0;c<n.length;c++)a[c]=n[c]?this.min[c]:this.center[c],d[c]=n[c]?this.center[c]:this.max[c];return d[2]=this.max[2],new Bn(a,d)}distanceX(e){return Math.max(Math.min(this.max[0],e[0]),this.min[0])-e[0]}distanceY(e){return Math.max(Math.min(this.max[1],e[1]),this.min[1])-e[1]}distanceZ(e){return Math.max(Math.min(this.max[2],e[2]),this.min[2])-e[2]}getCorners(){const e=this.min,n=this.max;return[[e[0],e[1],e[2]],[n[0],e[1],e[2]],[n[0],n[1],e[2]],[e[0],n[1],e[2]],[e[0],e[1],n[2]],[n[0],e[1],n[2]],[n[0],n[1],n[2]],[e[0],n[1],n[2]]]}intersects(e){return this.intersectsAabb(e.bounds)?si(e,this.getCorners()):0}intersectsFlat(e){return this.intersectsAabb(e.bounds)?si(e,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsPrecise(e,n){return n||this.intersects(e)?Fr(e,this.getCorners()):0}intersectsPreciseFlat(e,n){return n||this.intersectsFlat(e)?Fr(e,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsAabb(e){for(let n=0;n<3;++n)if(this.min[n]>e.max[n]||e.min[n]>this.max[n])return!1;return!0}intersectsAabbXY(e){return!(this.min[0]>e.max[0]||e.min[0]>this.max[0]||this.min[1]>e.max[1]||e.min[1]>this.max[1])}encapsulate(e){for(let n=0;n<3;n++)this.min[n]=Math.min(this.min[n],e.min[n]),this.max[n]=Math.max(this.max[n],e.max[n])}encapsulatePoint(e){for(let n=0;n<3;n++)this.min[n]=Math.min(this.min[n],e[n]),this.max[n]=Math.max(this.max[n],e[n])}closestPoint(e){return[Math.max(Math.min(this.max[0],e[0]),this.min[0]),Math.max(Math.min(this.max[1],e[1]),this.min[1]),Math.max(Math.min(this.max[2],e[2]),this.min[2])]}}function ii(s){return s*Hs/yh}qe(Bn,"Aabb");const Ji=[new Bn([Sl,Sl,Sl],[Ra,Ra,Ra]),new Bn([Sl,Sl,Sl],[0,0,Ra]),new Bn([0,Sl,Sl],[Ra,0,Ra]),new Bn([Sl,0,Sl],[0,Ra,Ra]),new Bn([0,0,Sl],[Ra,Ra,Ra])];function ts(s,e,n,a=!0){const d=Re.vec3.scale([],s._camera.position,s.worldSize),c=[e,n,1,1];Re.vec4.transformMat4(c,c,s.pixelMatrixInverse),Re.vec4.scale(c,c,1/c[3]);const p=Re.vec3.sub([],c,d),w=Re.vec3.normalize([],p),T=s.globeMatrix,P=[T[12],T[13],T[14]],x=Re.vec3.sub([],P,d),C=Re.vec3.length(x),A=Re.vec3.normalize([],x),E=s.worldSize/(2*Math.PI),M=Re.vec3.dot(A,w),k=Math.asin(E/C);if(k<Math.acos(M)){if(!a)return null;const Be=[],Me=[];Re.vec3.scale(Be,w,C/M),Re.vec3.normalize(Me,Re.vec3.sub(Me,Be,x)),Re.vec3.normalize(w,Re.vec3.add(w,x,Re.vec3.scale(w,Me,Math.tan(k)*C)))}const N=[];new pr(d,w).closestPointOnSphere(P,E,N);const j=Re.vec3.normalize([],Ts(T,0)),q=Re.vec3.normalize([],Ts(T,1)),X=Re.vec3.normalize([],Ts(T,2)),W=Re.vec3.dot(j,N),J=Re.vec3.dot(q,N),ne=Re.vec3.dot(X,N),he=Gr(Math.asin(-J/E));let we=Gr(Math.atan2(W,ne));we=s.center.lng+function(Be,Me){const Ue=(Me-Be+180)%360-180;return Ue<-180?Ue+360:Ue}(s.center.lng,we);const be=Bu(we),ve=yn(ql(he),0,1);return new g(be,ve)}class Za{constructor(e,n,a){this.a=Re.vec3.sub([],e,a),this.b=Re.vec3.sub([],n,a),this.center=a;const d=Re.vec3.normalize([],this.a),c=Re.vec3.normalize([],this.b);this.angle=Math.acos(Re.vec3.dot(d,c))}}function Bo(s,e){if(s.angle===0)return null;let n;return n=s.a[e]===0?1/s.angle*.5*Math.PI:1/s.angle*Math.atan(s.b[e]/s.a[e]/Math.sin(s.angle)-1/Math.tan(s.angle)),n<0||n>1?null:function(a,d,c,p){const w=Math.sin(c);return a*(Math.sin((1-p)*c)/w)+d*(Math.sin(p*c)/w)}(s.a[e],s.b[e],s.angle,yn(n,0,1))+s.center[e]}function ns(s){if(s.z<=1)return Ji[s.z+2*s.y+s.x];const e=Yr(mi(s));return Bn.fromPoints(e)}function Co(s,e,n){return Re.vec3.scale(s,s,1-n),Re.vec3.scaleAndAdd(s,s,e,n)}function Vi(s,e,n){for(const a of s)Re.vec3.transformMat4(a,a,e),Re.vec3.scale(a,a,n)}function ki(s,e,n,a){const d=e/s.worldSize,c=s.globeMatrix;if(n.z<=1){const be=ns(n).getCorners();return Vi(be,c,d),Bn.fromPoints(be)}const p=mi(n,a),w=Yr(p,Hs+ii(s._tileCoverLift));Vi(w,c,d);const T=Number.MAX_VALUE,P=[-T,-T,-T],x=[T,T,T];if(p.contains(s.center)){for(const Be of w)Re.vec3.min(x,x,Be),Re.vec3.max(P,P,Be);P[2]=0;const be=s.point,ve=[be.x*d,be.y*d,0];return Re.vec3.min(x,x,ve),Re.vec3.max(P,P,ve),new Bn(x,P)}if(s._tileCoverLift>0){for(const be of w)Re.vec3.min(x,x,be),Re.vec3.max(P,P,be);return new Bn(x,P)}const C=[c[12]*d,c[13]*d,c[14]*d],A=p.getCenter(),E=yn(s.center.lat,-85.051129,da),M=yn(A.lat,-85.051129,da),k=Bu(s.center.lng),N=ql(E);let j=k-Bu(A.lng);const q=N-ql(M);j>.5?j-=1:j<-.5&&(j+=1);let X=0;if(Math.abs(j)>Math.abs(q))X=j>=0?1:3;else{X=q>=0?0:2;const be=[c[4]*d,c[5]*d,c[6]*d],ve=-Math.sin($n(q>=0?p.getSouth():p.getNorth()))*Hs;Re.vec3.scaleAndAdd(C,C,be,ve)}const W=w[X],J=w[(X+1)%4],ne=new Za(W,J,C),he=[Bo(ne,0)||W[0],Bo(ne,1)||W[1],Bo(ne,2)||W[2]],we=na(s.zoom);if(we>0){const be=function({x:Be,y:Me,z:Ue},Ye,Xe,Je,st){const pt=1/(1<<Ue);let ot=Be*pt,It=ot+pt,tn=Me*pt,Lt=tn+pt,un=0;const cn=(ot+It)/2-Je;return cn>.5?un=-1:cn<-.5&&(un=1),ot=((ot+un)*Ye-(Je*=Ye))*Xe+Je,It=((It+un)*Ye-Je)*Xe+Je,tn=(tn*Ye-(st*=Ye))*Xe+st,Lt=(Lt*Ye-st)*Xe+st,[[ot,Lt,0],[It,Lt,0],[It,tn,0],[ot,tn,0]]}(n,e,s._pixelsPerMercatorPixel,k,N);for(let Be=0;Be<w.length;Be++)Co(w[Be],be[Be],we);const ve=Re.vec3.add([],be[X],be[(X+1)%4]);Re.vec3.scale(ve,ve,.5),Co(he,ve,we)}for(const be of w)Re.vec3.min(x,x,be),Re.vec3.max(P,P,be);return x[2]=Math.min(W[2],J[2]),Re.vec3.min(x,x,he),Re.vec3.max(P,P,he),new Bn(x,P)}function mi({x:s,y:e,z:n},a=!1){const d=1/(1<<n),c=new Qr(qa(s*d),e===(1<<n)-1&&a?-90:jn((e+1)*d)),p=new Qr(qa((s+1)*d),e===0&&a?90:jn(e*d));return new uu(c,p)}function Yr(s,e=Hs){const n=$n(s.getNorth()),a=$n(s.getSouth()),d=Math.cos(n),c=Math.cos(a),p=Math.sin(n),w=Math.sin(a),T=s.getWest(),P=s.getEast();return[ka(c,w,T,e),ka(c,w,P,e),ka(d,p,P,e),ka(d,p,T,e)]}function ho(s,e,n,a){const d=1<<n.z,c=(s/pn+n.x)/d;return _h(jn((e/pn+n.y)/d),qa(c),a)}function Go({min:s,max:e}){return vm/Math.max(e[0]-s[0],e[1]-s[1],e[2]-s[2])}const Ei=new Float64Array(16);function Gs(s){const e=Go(s),n=Re.mat4.fromScaling(Ei,[e,e,e]);return Re.mat4.translate(n,n,Re.vec3.negate([],s.min))}function El(s){const e=Re.mat4.fromTranslation(Ei,s.min),n=1/Go(s);return Re.mat4.scale(e,e,[n,n,n])}function fa(s){const e=pn/(2*Math.PI);return s/(2*Math.PI)/e}function kc(s,e){return pn/(512*Math.pow(2,s))*Go(ns(e))}function pa(s,e,n,a,d){const c=fa(n),p=[s,e,-n/(2*Math.PI)],w=Re.mat4.identity(new Float64Array(16));return Re.mat4.translate(w,w,p),Re.mat4.scale(w,w,[c,c,c]),Re.mat4.rotateX(w,w,$n(-d)),Re.mat4.rotateY(w,w,$n(-a)),w}function na(s){return Ir(tf,ud,s)}function qs(s,e){const n=_h(e.lat,e.lng),a=function(c){const p=_h(c._center.lat,c._center.lng),w=Re.vec3.fromValues(0,1,0);let T=Re.vec3.cross([],w,p);const P=Re.mat4.fromRotation([],-c.angle,p);T=Re.vec3.transformMat4(T,T,P),Re.mat4.fromRotation(P,-c._pitch,T);const x=Re.vec3.normalize([],p);return Re.vec3.scale(x,x,ii(c.cameraToCenterDistance/c.pixelsPerMeter)),Re.vec3.transformMat4(x,x,P),Re.vec3.add([],p,x)}(s),d=Re.vec3.subtract([],a,n);return Re.vec3.angle(d,n)}function zc(s,e){return qs(s,e)>Math.PI/2*1.01}const Wi=$n(85),vh=Math.cos(Wi),dd=Math.sin(Wi),Dp=Re.mat4.create(),Vf=s=>{const e=[];return s.paint.get("circle-pitch-alignment")==="map"&&e.push("PITCH_WITH_MAP"),s.paint.get("circle-pitch-scale")==="map"&&e.push("SCALE_WITH_MAP"),e};function kg(s,e,n,a,d,c,p,w,T){if(c&&s.queryGeometry.isAboveHorizon)return!1;c&&(T*=s.pixelToTileUnitsFactor);const P=s.tileID.canonical,x=n.projection.upVectorScale(P,n.center.lat,n.worldSize).metersToTile;for(const C of e)for(const A of C){const E=A.add(w),M=d&&n.elevation?n.elevation.exaggeration()*d.getElevationAt(E.x,E.y,!0):0,k=n.projection.projectTilePoint(E.x,E.y,P);if(M>0){const X=n.projection.upVector(P,E.x,E.y);k.x+=X[0]*x*M,k.y+=X[1]*x*M,k.z+=X[2]*x*M}const N=c?E:_y(k.x,k.y,k.z,a),j=c?s.tilespaceRays.map(X=>zg(X,M)):s.queryGeometry.screenGeometry,q=Re.vec4.transformMat4([],[k.x,k.y,k.z,1],a);if(!p&&c?T*=q[3]/n.cameraToCenterDistance:p&&!c&&(T*=n.cameraToCenterDistance/q[3]),c){const X=jn((A.y/pn+P.y)/(1<<P.z));T/=n.projection.pixelsPerMeter(X,1)/Ki(1,X)}if(ye(j,N,T))return!0}return!1}function _y(s,e,n,a){const d=Re.vec4.transformMat4([],[s,e,n,1],a);return new Ht(d[0]/d[3],d[1]/d[3])}const yy=Re.vec3.fromValues(0,0,0),Lc=Re.vec3.fromValues(0,0,1);function zg(s,e){const n=Re.vec3.create();return yy[2]=e,s.intersectsPlane(yy,Lc,n),new Ht(n[0],n[1])}class vy extends ue{}let xh,Fp,fd,Bp;function xm(s,{width:e,height:n},a,d){if(d){if(d instanceof Uint8ClampedArray)d=new Uint8Array(d.buffer);else if(d.length!==e*n*a)throw new RangeError("mismatched image size")}else d=new Uint8Array(e*n*a);return s.width=e,s.height=n,s.data=d,s}function bm(s,e,n){const{width:a,height:d}=e;a===s.width&&d===s.height||(Lg(s,e,{x:0,y:0},{x:0,y:0},{width:Math.min(s.width,a),height:Math.min(s.height,d)},n,null),s.width=a,s.height=d,s.data=e.data)}function Lg(s,e,n,a,d,c,p,w){if(d.width===0||d.height===0)return e;if(d.width>s.width||d.height>s.height||n.x>s.width-d.width||n.y>s.height-d.height)throw new RangeError("out of range source coordinates for image copy");if(d.width>e.width||d.height>e.height||a.x>e.width-d.width||a.y>e.height-d.height)throw new RangeError("out of range destination coordinates for image copy");const T=s.data,P=e.data,x=c===4&&w;for(let C=0;C<d.height;C++){const A=((n.y+C)*s.width+n.x)*c,E=((a.y+C)*e.width+a.x)*c;if(x)for(let M=0;M<d.width;M++){const k=A+M*c+3,N=E+M*c;P[N+0]=255,P[N+1]=255,P[N+2]=255,P[N+3]=T[k]}else if(p)for(let M=0;M<d.width;M++){const k=A+M*c,N=E+M*c,j=T[k+3],q=new ir(T[k+0]/255*j,T[k+1]/255*j,T[k+2]/255*j,j).toRenderColor(p).toArray();P[N+0]=q[0],P[N+1]=q[1],P[N+2]=q[2],P[N+3]=q[3]}else for(let M=0;M<d.width*c;M++)P[E+M]=T[A+M]}return e}qe(vy,"HeatmapBucket",{omit:["layers"]});class ju{constructor(e,n){xm(this,e,1,n)}resize(e){bm(this,new ju(e),1)}clone(){return new ju({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,n,a,d,c){Lg(e,n,a,d,c,1,null)}}class ma{constructor(e,n){xm(this,e,4,n)}resize(e){bm(this,new ma(e),4)}replace(e,n){n?this.data.set(e):this.data=e instanceof Uint8ClampedArray?new Uint8Array(e.buffer):e}clone(){return new ma({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,n,a,d,c,p,w){Lg(e,n,a,d,c,4,p,w)}}class Og{constructor(e,n){this.width=e.width,this.height=e.height,this.data=n instanceof Uint8Array?new Float32Array(n.buffer):n}}function Uf(s){const e={},n=s.resolution||256,a=s.clips?s.clips.length:1,d=s.image||new ma({width:n,height:a}),c=(p,w,T)=>{e[s.evaluationKey]=T;const P=s.expression.evaluate(e);P&&(d.data[p+w+0]=Math.floor(255*P.r/P.a),d.data[p+w+1]=Math.floor(255*P.g/P.a),d.data[p+w+2]=Math.floor(255*P.b/P.a),d.data[p+w+3]=Math.floor(255*P.a))};if(s.clips)for(let p=0,w=0;p<a;++p,w+=4*n)for(let T=0,P=0;T<n;T++,P+=4){const x=T/(n-1),{start:C,end:A}=s.clips[p];c(w,P,C*(1-x)+A*x)}else for(let p=0,w=0;p<n;p++,w+=4)c(0,w,p/(n-1));return d}qe(ju,"AlphaImage"),qe(ma,"RGBAImage");const wm=$r([{name:"a_pos",components:2,type:"Int16"}],4),{members:Sm}=wm;function Hf(s,e,n=2){const a=e&&e.length,d=a?e[0]*n:s.length;let c=Em(s,0,d,n,!0);const p=[];if(!c||c.next===c.prev)return p;let w,T,P;if(a&&(c=function(x,C,A,E){const M=[];for(let k=0,N=C.length;k<N;k++){const j=Em(x,C[k]*E,k<N-1?C[k+1]*E:x.length,E,!1);j===j.next&&(j.steiner=!0),M.push(Xx(j))}M.sort(qx);for(let k=0;k<M.length;k++)A=Mm(M[k],A);return A}(s,e,c,n)),s.length>80*n){w=1/0,T=1/0;let x=-1/0,C=-1/0;for(let A=n;A<d;A+=n){const E=s[A],M=s[A+1];E<w&&(w=E),M<T&&(T=M),E>x&&(x=E),M>C&&(C=M)}P=Math.max(x-w,C-T),P=P!==0?32767/P:0}return sf(c,p,n,w,T,P,0),p}function Em(s,e,n,a,d){let c;if(d===function(p,w,T,P){let x=0;for(let C=w,A=T-P;C<T;C+=P)x+=(p[A]-p[C])*(p[C+1]+p[A+1]),A=C;return x}(s,e,n,a)>0)for(let p=e;p<n;p+=a)c=St(p/a|0,s[p],s[p+1],c);else for(let p=n-a;p>=e;p-=a)c=St(p/a|0,s[p],s[p+1],c);return c&&R(c,c.next)&&(en(c),c=c.next),c}function pd(s,e){if(!s)return s;e||(e=s);let n,a=s;do if(n=!1,a.steiner||!R(a,a.next)&&y(a.prev,a,a.next)!==0)a=a.next;else{if(en(a),a=e=a.prev,a===a.next)break;n=!0}while(n||a!==e);return e}function sf(s,e,n,a,d,c,p){if(!s)return;!p&&c&&function(T,P,x,C){let A=T;do A.z===0&&(A.z=af(A.x,A.y,P,x,C)),A.prevZ=A.prev,A.nextZ=A.next,A=A.next;while(A!==T);A.prevZ.nextZ=null,A.prevZ=null,function(E){let M,k=1;do{let N,j=E;E=null;let q=null;for(M=0;j;){M++;let X=j,W=0;for(let ne=0;ne<k&&(W++,X=X.nextZ,X);ne++);let J=k;for(;W>0||J>0&&X;)W!==0&&(J===0||!X||j.z<=X.z)?(N=j,j=j.nextZ,W--):(N=X,X=X.nextZ,J--),q?q.nextZ=N:E=N,N.prevZ=q,q=N;j=X}q.nextZ=null,k*=2}while(M>1)}(A)}(s,a,d,c);let w=s;for(;s.prev!==s.next;){const T=s.prev,P=s.next;if(c?Dg(s,a,d,c):Tm(s))e.push(T.i,s.i,P.i),en(s),s=P.next,w=P.next;else if((s=P)===w){p?p===1?sf(s=Cm(pd(s),e),e,n,a,d,c,2):p===2&&xy(s,e,n,a,d,c):sf(pd(s),e,n,a,d,c,1);break}}}function Tm(s){const e=s.prev,n=s,a=s.next;if(y(e,n,a)>=0)return!1;const d=e.x,c=n.x,p=a.x,w=e.y,T=n.y,P=a.y,x=d<c?d<p?d:p:c<p?c:p,C=w<T?w<P?w:P:T<P?T:P,A=d>c?d>p?d:p:c>p?c:p,E=w>T?w>P?w:P:T>P?T:P;let M=a.next;for(;M!==e;){if(M.x>=x&&M.x<=A&&M.y>=C&&M.y<=E&&bh(d,w,c,T,p,P,M.x,M.y)&&y(M.prev,M,M.next)>=0)return!1;M=M.next}return!0}function Dg(s,e,n,a){const d=s.prev,c=s,p=s.next;if(y(d,c,p)>=0)return!1;const w=d.x,T=c.x,P=p.x,x=d.y,C=c.y,A=p.y,E=w<T?w<P?w:P:T<P?T:P,M=x<C?x<A?x:A:C<A?C:A,k=w>T?w>P?w:P:T>P?T:P,N=x>C?x>A?x:A:C>A?C:A,j=af(E,M,e,n,a),q=af(k,N,e,n,a);let X=s.prevZ,W=s.nextZ;for(;X&&X.z>=j&&W&&W.z<=q;){if(X.x>=E&&X.x<=k&&X.y>=M&&X.y<=N&&X!==d&&X!==p&&bh(w,x,T,C,P,A,X.x,X.y)&&y(X.prev,X,X.next)>=0||(X=X.prevZ,W.x>=E&&W.x<=k&&W.y>=M&&W.y<=N&&W!==d&&W!==p&&bh(w,x,T,C,P,A,W.x,W.y)&&y(W.prev,W,W.next)>=0))return!1;W=W.nextZ}for(;X&&X.z>=j;){if(X.x>=E&&X.x<=k&&X.y>=M&&X.y<=N&&X!==d&&X!==p&&bh(w,x,T,C,P,A,X.x,X.y)&&y(X.prev,X,X.next)>=0)return!1;X=X.prevZ}for(;W&&W.z<=q;){if(W.x>=E&&W.x<=k&&W.y>=M&&W.y<=N&&W!==d&&W!==p&&bh(w,x,T,C,P,A,W.x,W.y)&&y(W.prev,W,W.next)>=0)return!1;W=W.nextZ}return!0}function Cm(s,e){let n=s;do{const a=n.prev,d=n.next.next;!R(a,d)&&F(a,n,n.next,d)&&Ce(a,d)&&Ce(d,a)&&(e.push(a.i,n.i,d.i),en(n),en(n.next),n=s=d),n=n.next}while(n!==s);return pd(n)}function xy(s,e,n,a,d,c){let p=s;do{let w=p.next.next;for(;w!==p.prev;){if(p.i!==w.i&&m(p,w)){let T=ut(p,w);return p=pd(p,p.next),T=pd(T,T.next),sf(p,e,n,a,d,c,0),void sf(T,e,n,a,d,c,0)}w=w.next}p=p.next}while(p!==s)}function qx(s,e){return s.x-e.x}function Mm(s,e){const n=function(d,c){let p=c;const w=d.x,T=d.y;let P,x=-1/0;do{if(T<=p.y&&T>=p.next.y&&p.next.y!==p.y){const k=p.x+(T-p.y)*(p.next.x-p.x)/(p.next.y-p.y);if(k<=w&&k>x&&(x=k,P=p.x<p.next.x?p:p.next,k===w))return P}p=p.next}while(p!==c);if(!P)return null;const C=P,A=P.x,E=P.y;let M=1/0;p=P;do{if(w>=p.x&&p.x>=A&&w!==p.x&&bh(T<E?w:x,T,A,E,T<E?x:w,T,p.x,p.y)){const k=Math.abs(T-p.y)/(w-p.x);Ce(p,d)&&(k<M||k===M&&(p.x>P.x||p.x===P.x&&Zx(P,p)))&&(P=p,M=k)}p=p.next}while(p!==C);return P}(s,e);if(!n)return e;const a=ut(n,s);return pd(a,a.next),pd(n,n.next)}function Zx(s,e){return y(s.prev,s,e.prev)<0&&y(e.next,s,s.next)<0}function af(s,e,n,a,d){return(s=1431655765&((s=858993459&((s=252645135&((s=16711935&((s=(s-n)*d|0)|s<<8))|s<<4))|s<<2))|s<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-a)*d|0)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function Xx(s){let e=s,n=s;do(e.x<n.x||e.x===n.x&&e.y<n.y)&&(n=e),e=e.next;while(e!==s);return n}function bh(s,e,n,a,d,c,p,w){return(d-p)*(e-w)>=(s-p)*(c-w)&&(s-p)*(a-w)>=(n-p)*(e-w)&&(n-p)*(c-w)>=(d-p)*(a-w)}function m(s,e){return s.next.i!==e.i&&s.prev.i!==e.i&&!function(n,a){let d=n;do{if(d.i!==n.i&&d.next.i!==n.i&&d.i!==a.i&&d.next.i!==a.i&&F(d,d.next,n,a))return!0;d=d.next}while(d!==n);return!1}(s,e)&&(Ce(s,e)&&Ce(e,s)&&function(n,a){let d=n,c=!1;const p=(n.x+a.x)/2,w=(n.y+a.y)/2;do d.y>w!=d.next.y>w&&d.next.y!==d.y&&p<(d.next.x-d.x)*(w-d.y)/(d.next.y-d.y)+d.x&&(c=!c),d=d.next;while(d!==n);return c}(s,e)&&(y(s.prev,s,e.prev)||y(s,e.prev,e))||R(s,e)&&y(s.prev,s,s.next)>0&&y(e.prev,e,e.next)>0)}function y(s,e,n){return(e.y-s.y)*(n.x-e.x)-(e.x-s.x)*(n.y-e.y)}function R(s,e){return s.x===e.x&&s.y===e.y}function F(s,e,n,a){const d=ee(y(s,e,n)),c=ee(y(s,e,a)),p=ee(y(n,a,s)),w=ee(y(n,a,e));return d!==c&&p!==w||!(d!==0||!Y(s,n,e))||!(c!==0||!Y(s,a,e))||!(p!==0||!Y(n,s,a))||!(w!==0||!Y(n,e,a))}function Y(s,e,n){return e.x<=Math.max(s.x,n.x)&&e.x>=Math.min(s.x,n.x)&&e.y<=Math.max(s.y,n.y)&&e.y>=Math.min(s.y,n.y)}function ee(s){return s>0?1:s<0?-1:0}function Ce(s,e){return y(s.prev,s,s.next)<0?y(s,e,s.next)>=0&&y(s,s.prev,e)>=0:y(s,e,s.prev)<0||y(s,s.next,e)<0}function ut(s,e){const n=wn(s.i,s.x,s.y),a=wn(e.i,e.x,e.y),d=s.next,c=e.prev;return s.next=e,e.prev=s,n.next=d,d.prev=n,a.next=n,n.prev=a,c.next=a,a.prev=c,a}function St(s,e,n,a){const d=wn(s,e,n);return a?(d.next=a.next,d.prev=a,a.next.prev=d,a.next=d):(d.prev=d,d.next=d),d}function en(s){s.next.prev=s.prev,s.prev.next=s.next,s.prevZ&&(s.prevZ.nextZ=s.nextZ),s.nextZ&&(s.nextZ.prevZ=s.prevZ)}function wn(s,e,n){return{i:s,x:e,y:n,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}function Mn(s,e){const n=s.length;if(n<=1)return[s];const a=[];let d,c;for(let p=0;p<n;p++){const w=Vs(s[p]);w!==0&&(s[p].area=Math.abs(w),c===void 0&&(c=w<0),c===w<0?(d&&a.push(d),d=[s[p]]):d.push(s[p]))}if(d&&a.push(d),e>1)for(let p=0;p<a.length;p++)a[p].length<=e||(kd(a[p],e,1,a[p].length-1,Sn),a[p]=a[p].slice(0,e));return a}function Sn(s,e){return e.area-s.area}function rr(s,e){if(!s)return null;const n=typeof s=="string"?s:s.getPrimary().id;e[n]||(e[n]=[]);const a=Oo.from(s).getPrimary();return e[n].push(a),a.serialize()}function fr(s,e,n){const a=n.patternDependencies;let d=!1;for(const c of e){const p=c.paint.get(`${s}-pattern`);p.isConstant()||(d=!0),rr(p.constantOr(null),a)&&(d=!0)}return d}function _r(s,e,n,a,d){const c=d.patternDependencies;for(const p of e){const w=p.paint.get(`${s}-pattern`).value;if(w.kind!=="constant"){let T=w.evaluate({zoom:a},n,{},d.availableImages);T=T&&T.name?T.name:T;const P=rr(T,c);P&&(n.patterns[p.id]=P)}}return n}class xs{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(n=>n.fqid),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new Ia,this.indexArray=new Ns,this.indexArray2=new Bs,this.programConfigurations=new cu(e.layers,{zoom:e.zoom,lut:e.lut}),this.segments=new vo,this.segments2=new vo,this.stateDependentLayerIds=this.layers.filter(n=>n.isStateDependent()).map(n=>n.id),this.projection=e.projection}updateFootprints(e,n){}populate(e,n,a,d){this.hasPattern=fr("fill",this.layers,n);const c=this.layers[0].layout.get("fill-sort-key"),p=[];for(const{feature:w,id:T,index:P,sourceLayerIndex:x}of e){const C=this.layers[0]._featureFilter.needGeometry,A=G(w,C);if(!this.layers[0]._featureFilter.filter(new qr(this.zoom),A,a))continue;const E=c?c.evaluate(A,{},a,n.availableImages):void 0,M={id:T,properties:w.properties,type:w.type,sourceLayerIndex:x,index:P,geometry:C?A.geometry:U(w,a,d),patterns:{},sortKey:E};p.push(M)}c&&p.sort((w,T)=>w.sortKey-T.sortKey);for(const w of p){const{geometry:T,index:P,sourceLayerIndex:x}=w;if(this.hasPattern){const C=_r("fill",this.layers,w,this.zoom,n);this.patternFeatures.push(C)}else this.addFeature(w,T,P,a,{},n.availableImages,n.brightness);n.featureIndex.insert(e[P].feature,T,P,x,this.index)}}update(e,n,a,d,c,p,w){this.programConfigurations.updatePaintArrays(e,n,c,a,d,p,w)}addFeatures(e,n,a,d,c,p){for(const w of this.patternFeatures)this.addFeature(w,w.geometry,w.index,n,a,d,p)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Sm),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.indexBuffer2=e.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(e,n,a,d,c,p=[],w){for(const T of Mn(n,500)){let P=0;for(const k of T)P+=k.length;const x=this.segments.prepareSegment(P,this.layoutVertexArray,this.indexArray),C=x.vertexLength,A=[],E=[];for(const k of T){if(k.length===0)continue;k!==T[0]&&E.push(A.length/2);const N=this.segments2.prepareSegment(k.length,this.layoutVertexArray,this.indexArray2),j=N.vertexLength;this.layoutVertexArray.emplaceBack(k[0].x,k[0].y),this.indexArray2.emplaceBack(j+k.length-1,j),A.push(k[0].x),A.push(k[0].y);for(let q=1;q<k.length;q++)this.layoutVertexArray.emplaceBack(k[q].x,k[q].y),this.indexArray2.emplaceBack(j+q-1,j+q),A.push(k[q].x),A.push(k[q].y);N.vertexLength+=k.length,N.primitiveLength+=k.length}const M=Hf(A,E);for(let k=0;k<M.length;k+=3)this.indexArray.emplaceBack(C+M[k],C+M[k+1],C+M[k+2]);x.vertexLength+=P,x.primitiveLength+=M.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,a,c,p,d,w)}}let Wt,Pt,Kt,On;qe(xs,"FillBucket",{omit:["layers","patternFeatures"]});class br{constructor(e,n,a,d){if(this.triangleCount=n.length/3,this.min=new Ht(0,0),this.max=new Ht(0,0),this.xScale=0,this.yScale=0,this.cellsX=0,this.cellsY=0,this.cells=[],this.payload=[],this.triangleCount===0||e.length===0)return;const[c,p]=[e[0].clone(),e[0].clone()];for(let C=1;C<e.length;++C){const A=e[C];c.x=Math.min(c.x,A.x),c.y=Math.min(c.y,A.y),p.x=Math.max(p.x,A.x),p.y=Math.max(p.y,A.y)}if(d){const C=Math.ceil(Math.max(p.x-c.x,p.y-c.y)/d);a=Math.max(a,C)}if(a===0)return;this.min=c,this.max=p;const w=this.max.sub(this.min);w.x=Math.max(w.x,1),w.y=Math.max(w.y,1);const T=Math.max(w.x,w.y)/a;this.cellsX=Math.max(1,Math.ceil(w.x/T)),this.cellsY=Math.max(1,Math.ceil(w.y/T)),this.xScale=1/T,this.yScale=1/T;const P=[];for(let C=0;C<this.triangleCount;C++){const A=e[n[3*C+0]].sub(this.min),E=e[n[3*C+1]].sub(this.min),M=e[n[3*C+2]].sub(this.min),k=Tr(Math.floor(Math.min(A.x,E.x,M.x)),this.xScale,this.cellsX),N=Tr(Math.floor(Math.max(A.x,E.x,M.x)),this.xScale,this.cellsX),j=Tr(Math.floor(Math.min(A.y,E.y,M.y)),this.yScale,this.cellsY),q=Tr(Math.floor(Math.max(A.y,E.y,M.y)),this.yScale,this.cellsY),X=new Ht(0,0),W=new Ht(0,0),J=new Ht(0,0),ne=new Ht(0,0);for(let he=j;he<=q;++he){X.y=W.y=he*T,J.y=ne.y=(he+1)*T;for(let we=k;we<=N;++we)X.x=J.x=we*T,W.x=ne.x=(we+1)*T,(tt(A,E,M,X,W,ne)||tt(A,E,M,X,ne,J))&&P.push({cellIdx:he*this.cellsX+we,triIdx:C})}}if(P.length===0)return;P.sort((C,A)=>C.cellIdx-A.cellIdx||C.triIdx-A.triIdx);let x=0;for(;x<P.length;){const C=P[x].cellIdx,A={start:this.payload.length,len:0};for(;x<P.length&&P[x].cellIdx===C;)++A.len,this.payload.push(P[x++].triIdx);this.cells[C]=A}}_lazyInitLookup(){this.lookup||(this.lookup=new Uint8Array(Math.ceil(this.triangleCount/8))),this.lookup.fill(0)}queryPoint(e,n){if(this.triangleCount===0||this.cells.length===0||e.x>this.max.x||this.min.x>e.x||e.y>this.max.y||this.min.y>e.y)return;const a=Tr(e.x-this.min.x,this.xScale,this.cellsX),d=Tr(e.y-this.min.y,this.yScale,this.cellsY),c=this.cells[d*this.cellsX+a];if(c){this._lazyInitLookup();for(let p=0;p<c.len;p++){const w=this.payload[c.start+p],T=Math.floor(w/8),P=1<<w%8;if(!(this.lookup[T]&P)&&(this.lookup[T]|=P,n.push(w),n.length===this.triangleCount))return}}}query(e,n,a){if(this.triangleCount===0||this.cells.length===0||e.x>this.max.x||this.min.x>n.x||e.y>this.max.y||this.min.y>n.y)return;this._lazyInitLookup();const d=Tr(e.x-this.min.x,this.xScale,this.cellsX),c=Tr(n.x-this.min.x,this.xScale,this.cellsX),p=Tr(e.y-this.min.y,this.yScale,this.cellsY),w=Tr(n.y-this.min.y,this.yScale,this.cellsY);for(let T=p;T<=w;T++)for(let P=d;P<=c;P++){const x=this.cells[T*this.cellsX+P];if(x)for(let C=0;C<x.len;C++){const A=this.payload[x.start+C],E=Math.floor(A/8),M=1<<A%8;if(!(this.lookup[E]&M)&&(this.lookup[E]|=M,a.push(A),a.length===this.triangleCount))return}}}}function Tr(s,e,n){return Math.max(0,Math.min(n-1,Math.floor(s*e)))}qe(br,"TriangleGridIndex");class Vr{constructor(e){this.zoom=e.zoom,this.layers=e.layers,this.layerIds=this.layers.map(n=>n.fqid),this.index=e.index,this.hasPattern=!1,this.stateDependentLayerIds=this.layers.filter(n=>n.isStateDependent()).map(n=>n.id),this.footprints=[]}updateFootprints(e,n){for(const a of this.footprints)n.push({footprint:a,id:e})}populate(e,n,a,d){const c=[];for(const{feature:p,id:w,index:T,sourceLayerIndex:P}of e){const x=this.layers[0]._featureFilter.needGeometry,C=G(p,x);if(!this.layers[0]._featureFilter.filter(new qr(this.zoom),C,a))continue;const A={id:w,properties:p.properties,type:p.type,sourceLayerIndex:P,index:T,geometry:x?C.geometry:U(p,a,d),patterns:{}};c.push(A)}for(const p of c){const{geometry:w,index:T,sourceLayerIndex:P}=p;this.addFeature(p,w,T,a,{},n.availableImages,n.brightness),n.featureIndex.insert(e[T].feature,w,T,P,this.index)}}isEmpty(){return this.footprints.length===0}uploadPending(){return!1}upload(e){}update(e,n,a,d,c,p,w){}destroy(){}addFeature(e,n,a,d,c,p=[],w){for(const T of Mn(n,2)){const P=[],x=[],C=[],A=new Ht(1/0,1/0),E=new Ht(-1/0,-1/0);for(const N of T)if(N.length!==0){N!==T[0]&&C.push(x.length/2);for(let j=0;j<N.length;j++)x.push(N[j].x),x.push(N[j].y),P.push(N[j]),A.x=Math.min(A.x,N[j].x),A.y=Math.min(A.y,N[j].y),E.x=Math.max(E.x,N[j].x),E.y=Math.max(E.y,N[j].y)}const M=Hf(x,C),k=new br(P,M,8,256);this.footprints.push({vertices:P,indices:M,grid:k,min:A,max:E})}}}qe(Vr,"ClipBucket",{omit:["layers"]});const ai=$r([{name:"a_pos_normal_ed",components:4,type:"Int16"}]),ga=$r([{name:"a_pos_end",components:4,type:"Int16"},{name:"a_angular_offset_factor",components:1,type:"Int16"}]),ro=$r([{name:"a_centroid_pos",components:2,type:"Uint16"}]),md=$r([{name:"a_join_normal_inside",components:3,type:"Int16"}]),Yx=$r([{name:"a_hidden_by_landmark",components:1,type:"Uint8"}]),JR=$r([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]),{members:QR}=ai;var Kx,x2,Jx,b2,Qx,w2,S2,by={};function E2(){if(x2)return Kx;x2=1;var s=Ar();function e(d,c,p,w,T){this.properties={},this.extent=p,this.type=0,this._pbf=d,this._geometry=-1,this._keys=w,this._values=T,d.readFields(n,this,c)}function n(d,c,p){d==1?c.id=p.readVarint():d==2?function(w,T){for(var P=w.readVarint()+w.pos;w.pos<P;){var x=T._keys[w.readVarint()],C=T._values[w.readVarint()];T.properties[x]=C}}(p,c):d==3?c.type=p.readVarint():d==4&&(c._geometry=p.pos)}function a(d){for(var c,p,w=0,T=0,P=d.length,x=P-1;T<P;x=T++)w+=((p=d[x]).x-(c=d[T]).x)*(c.y+p.y);return w}return Kx=e,e.types=["Unknown","Point","LineString","Polygon"],e.prototype.loadGeometry=function(){var d=this._pbf;d.pos=this._geometry;for(var c,p=d.readVarint()+d.pos,w=1,T=0,P=0,x=0,C=[];d.pos<p;){if(T<=0){var A=d.readVarint();w=7&A,T=A>>3}if(T--,w===1||w===2)P+=d.readSVarint(),x+=d.readSVarint(),w===1&&(c&&C.push(c),c=[]),c.push(new s(P,x));else{if(w!==7)throw new Error("unknown command "+w);c&&c.push(c[0].clone())}}return c&&C.push(c),C},e.prototype.bbox=function(){var d=this._pbf;d.pos=this._geometry;for(var c=d.readVarint()+d.pos,p=1,w=0,T=0,P=0,x=1/0,C=-1/0,A=1/0,E=-1/0;d.pos<c;){if(w<=0){var M=d.readVarint();p=7&M,w=M>>3}if(w--,p===1||p===2)(T+=d.readSVarint())<x&&(x=T),T>C&&(C=T),(P+=d.readSVarint())<A&&(A=P),P>E&&(E=P);else if(p!==7)throw new Error("unknown command "+p)}return[x,A,C,E]},e.prototype.toGeoJSON=function(d,c,p){var w,T,P=this.extent*Math.pow(2,p),x=this.extent*d,C=this.extent*c,A=this.loadGeometry(),E=e.types[this.type];function M(j){for(var q=0;q<j.length;q++){var X=j[q];j[q]=[360*(X.x+x)/P-180,360/Math.PI*Math.atan(Math.exp((180-360*(X.y+C)/P)*Math.PI/180))-90]}}switch(this.type){case 1:var k=[];for(w=0;w<A.length;w++)k[w]=A[w][0];M(A=k);break;case 2:for(w=0;w<A.length;w++)M(A[w]);break;case 3:for(A=function(j){var q=j.length;if(q<=1)return[j];for(var X,W,J=[],ne=0;ne<q;ne++){var he=a(j[ne]);he!==0&&(W===void 0&&(W=he<0),W===he<0?(X&&J.push(X),X=[j[ne]]):X.push(j[ne]))}return X&&J.push(X),J}(A),w=0;w<A.length;w++)for(T=0;T<A[w].length;T++)M(A[w][T])}A.length===1?A=A[0]:E="Multi"+E;var N={type:"Feature",geometry:{type:E,coordinates:A},properties:this.properties};return"id"in this&&(N.id=this.id),N},Kx}function T2(){if(b2)return Jx;b2=1;var s=E2();function e(a,d){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=a,this._keys=[],this._values=[],this._features=[],a.readFields(n,this,d),this.length=this._features.length}function n(a,d,c){a===15?d.version=c.readVarint():a===1?d.name=c.readString():a===5?d.extent=c.readVarint():a===2?d._features.push(c.pos):a===3?d._keys.push(c.readString()):a===4&&d._values.push(function(p){for(var w=null,T=p.readVarint()+p.pos;p.pos<T;){var P=p.readVarint()>>3;w=P===1?p.readString():P===2?p.readFloat():P===3?p.readDouble():P===4?p.readVarint64():P===5?p.readVarint():P===6?p.readSVarint():P===7?p.readBoolean():null}return w}(c))}return Jx=e,e.prototype.feature=function(a){if(a<0||a>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[a];var d=this._pbf.readVarint()+this._pbf.pos;return new s(this._pbf,d,this.extent,this._keys,this._values)},Jx}function C2(){return S2||(S2=1,by.VectorTile=function(){if(w2)return Qx;w2=1;var s=T2();function e(n,a,d){if(n===3){var c=new s(d,d.readVarint()+d.pos);c.length&&(a[c.name]=c)}}return Qx=function(n,a){this.layers=n.readFields(e,{},a)},Qx}(),by.VectorTileFeature=E2(),by.VectorTileLayer=T2()),by}var Am=C2();class Np extends Ht{constructor(e,n,a){super(e,n),this.z=a}}class M2 extends Np{constructor(e,n,a,d){super(e,n,a),this.w=d}}function wy(s,e,n,a){const d=[],c=a===0?(p,w,T,P,x,C)=>{p.push(new Ht(C,T+(C-w)/(P-w)*(x-T)))}:(p,w,T,P,x,C)=>{p.push(new Ht(w+(C-T)/(x-T)*(P-w),C))};for(const p of s){const w=[];for(const T of p){if(T.length<=2)continue;const P=[];for(let A=0;A<T.length-1;A++){const E=T[A].x,M=T[A].y,k=T[A+1].x,N=T[A+1].y,j=a===0?E:M,q=a===0?k:N;j<e?q>e&&c(P,E,M,k,N,e):j>n?q<n&&c(P,E,M,k,N,n):P.push(T[A]),q<e&&j>=e&&c(P,E,M,k,N,e),q>n&&j<=n&&c(P,E,M,k,N,n)}let x=T[T.length-1];const C=a===0?x.x:x.y;C>=e&&C<=n&&P.push(x),P.length&&(x=P[P.length-1],P[0].x===x.x&&P[0].y===x.y||P.push(P[0]),w.push(P))}w.length&&d.push(w)}return d}function A2(s,e,n,a){const d=n==="x"?"y":"x",c=(a-s[n])/(e[n]-s[n]);s[d]=s[d]+(e[d]-s[d])*c,s[n]=a,s.hasOwnProperty("z")&&(s.z=kn(s.z,e.z,c)),s.hasOwnProperty("w")&&(s.w=kn(s.w,e.w,c))}function I2(s,e,n,a){const d=n,c=a;for(const p of["x","y"]){let w=s,T=e;w[p]>=T[p]&&(w=e,T=s),w[p]<d&&T[p]>d&&A2(w,T,p,d),w[p]<c&&T[p]>c&&A2(T,w,p,c)}}const Sy=Number.MAX_SAFE_INTEGER;function P2(s,e,n,a){return s.order<e||s.order===Sy||!(s.clipMask&n)||function(d,c){return c.length!==0&&c.find(p=>p===d)===void 0}(a,s.clipScope)}function Ey(s,e){return s.x-e.x||s.y-e.y}function R2(s,e){return Ey(s.min,e.min)===0&&Ey(s.max,e.max)===0}function eb(s,e){return!(s.min.x>e.max.x||s.max.x<e.min.x||s.min.y>e.max.y||s.max.y<e.min.y)}function tb(s,e){if(s.length!==e.length)return!1;for(let n=0;n<s.length;n++)if(s[n].sourceId!==e[n].sourceId||!R2(s[n],e[n])||s[n].order!==e[n].order||s[n].clipMask!==e[n].clipMask||!Wr(s[n].clipScope,e[n].clipScope))return!1;return!0}function k2(s,e,n){const a=1/pn,d=1/(1<<n.canonical.z),c=(e.x*a+n.canonical.x)*d+n.wrap,p=(e.y*a+n.canonical.y)*d;return{min:new Ht((s.x*a+n.canonical.x)*d+n.wrap,(s.y*a+n.canonical.y)*d),max:new Ht(c,p)}}function e3(s,e,n){const a=1<<n.canonical.z,d=((e.x-n.wrap)*a-n.canonical.x)*pn,c=(e.y*a-n.canonical.y)*pn;return{min:new Ht(((s.x-n.wrap)*a-n.canonical.x)*pn,(s.y*a-n.canonical.y)*pn),max:new Ht(d,c)}}function z2(s,e,n,a,d,c,p){const w=s.indices,T=s.vertices,P=[];for(let x=a;x<a+d;x+=3){const C=e[n[x+0]+c],A=e[n[x+1]+c],E=e[n[x+2]+c],M=Math.min(C.x,A.x,E.x),k=Math.max(C.x,A.x,E.x),N=Math.min(C.y,A.y,E.y),j=Math.max(C.y,A.y,E.y);P.length=0,s.grid.query(new Ht(M,N),new Ht(k,j),P);for(let q=0;q<P.length;q++){const X=P[q];if(tt(T[w[3*X+0]],T[w[3*X+1]],T[w[3*X+2]],C,A,E,p))return!0}}return!1}function L2(s,e,n,a){if(!s||!n)return!1;let d=s.vertices;if(!e.canonical.equals(a.canonical)||e.wrap!==a.wrap){if(n.vertices.length<s.vertices.length)return L2(n,a,s,e);const c=e.canonical,p=a.canonical,w=Math.pow(2,p.z-c.z);d=s.vertices.map(T=>new Ht((T.x+c.x*pn)*w-p.x*pn,(T.y+c.y*pn)*w-p.y*pn))}return z2(n,d,s.indices,0,s.indices.length,0,0)}function O2(s,e,n,a){const d=Math.pow(2,a.z-n.z);return new Ht((s+n.x*pn)*d-a.x*pn,(e+n.y*pn)*d-a.y*pn)}function D2(s,e){const n=[];e.grid.queryPoint(s,n);const a=e.indices,d=e.vertices;for(let c=0;c<n.length;c++){const p=n[c];if(Ze([d[a[3*p+0]],d[a[3*p+1]],d[a[3*p+2]]],s))return!0}return!1}const nb=[new Ht(0,0),new Ht(pn,0),new Ht(pn,pn),new Ht(0,pn)];function F2(s,e){const n=[];let a=[];if(!e||s.length<2)return[s];if(s.length===2)return ct(s[0],s[1],nb)?[s]:[];for(let d=0;d<s.length+2;d++){const c=s[d%s.length],p=s[(d+1)%s.length],w=ct(d===0?s[s.length-1]:s[(d-1)%s.length],c,nb),T=ct(c,p,nb),P=w||T;P&&a.push(c),P&&T||a.length>0&&(a.length>1&&n.push(a),a=[])}return a.length>1&&n.push(a),n}const rb=Am.VectorTileFeature.types,t3=["fill-extrusion-base","fill-extrusion-height","fill-extrusion-color","fill-extrusion-pattern","fill-extrusion-flood-light-wall-radius","fill-extrusion-line-width","fill-extrusion-emissive-strength"],n3=["fill-extrusion-flood-light-ground-radius"],r3=Math.pow(2,13),i3=Math.pow(2,15)-1,B2=new Ht(0,1),Wf=2147483648;function Fg(s,e,n,a,d,c,p,w){s.emplaceBack((e<<1)+p,(n<<1)+c,(Math.floor(a*r3)<<1)+d,Math.round(w))}function Bg(s,e,n){s.emplaceBack(e.x*pn,e.y*pn,n?1:0)}function Ty(s,e,n,a,d,c){s.emplaceBack(e.x,e.y,(n.x<<1)+a,(n.y<<1)+d,c)}function Ng(s,e,n){s.emplaceBack(e.x,e.y,e.z,n[0]*16384,n[1]*16384,n[2]*16384)}class N2{constructor(){this.vertexOffset=0,this.vertexCount=0,this.indexOffset=0,this.indexCount=0}}class j2{constructor(){this.centroidXY=new Ht(0,0),this.vertexArrayOffset=0,this.vertexCount=0,this.groundVertexArrayOffset=0,this.groundVertexCount=0,this.flags=0,this.footprintSegIdx=-1,this.footprintSegLen=0,this.polygonSegIdx=-1,this.polygonSegLen=0,this.min=new Ht(Number.MAX_VALUE,Number.MAX_VALUE),this.max=new Ht(-Number.MAX_VALUE,-Number.MAX_VALUE),this.height=0}span(){return new Ht(this.max.x-this.min.x,this.max.y-this.min.y)}}class $2{constructor(){this.acc=new Ht(0,0),this.accCount=0,this.centroidDataIndex=0}startRing(e,n){e.min.x===Number.MAX_VALUE&&(e.min.x=e.max.x=n.x,e.min.y=e.max.y=n.y)}appendEdge(e,n,a){this.accCount++,this.acc._add(n);let d=!!this.borders;n.x<e.min.x?(e.min.x=n.x,d=!0):n.x>e.max.x&&(e.max.x=n.x,d=!0),n.y<e.min.y?(e.min.y=n.y,d=!0):n.y>e.max.y&&(e.max.y=n.y,d=!0),((n.x===0||n.x===pn)&&n.x===a.x)!=((n.y===0||n.y===pn)&&n.y===a.y)&&this.processBorderOverlap(n,a),d&&this.checkBorderIntersection(n,a)}checkBorderIntersection(e,n){n.x<0!=e.x<0&&this.addBorderIntersection(0,kn(n.y,e.y,(0-n.x)/(e.x-n.x))),n.x>pn!=e.x>pn&&this.addBorderIntersection(1,kn(n.y,e.y,(pn-n.x)/(e.x-n.x))),n.y<0!=e.y<0&&this.addBorderIntersection(2,kn(n.x,e.x,(0-n.y)/(e.y-n.y))),n.y>pn!=e.y>pn&&this.addBorderIntersection(3,kn(n.x,e.x,(pn-n.y)/(e.y-n.y)))}addBorderIntersection(e,n){this.borders||(this.borders=[[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE]]);const a=this.borders[e];n<a[0]&&(a[0]=n),n>a[1]&&(a[1]=n)}processBorderOverlap(e,n){if(e.x===n.x){if(e.y===n.y)return;const a=e.x===0?0:1;this.addBorderIntersection(a,n.y),this.addBorderIntersection(a,e.y)}else{const a=e.y===0?2:3;this.addBorderIntersection(a,n.x),this.addBorderIntersection(a,e.x)}}centroid(){return this.accCount===0?new Ht(0,0):new Ht(Math.floor(Math.max(0,this.acc.x)/this.accCount),Math.floor(Math.max(0,this.acc.y)/this.accCount))}intersectsCount(){return this.borders?this.borders.reduce((e,n)=>e+ +(n[0]!==Number.MAX_VALUE),0):0}}function V2(s,e){const n=s.add(e)._unit(),a=yn(s.x*n.x+s.y*n.y,-1,1);var d,c,p;return p=Math.acos(a),Math.min(4,Math.max(-4,Math.tan(p)))/4*i3*((d=s).x*(c=e).y-d.y*c.x<0?-1:1)}const o3=[s=>s.x<0,s=>s.x>pn,s=>s.y<0,s=>s.y>pn];function s3(s,e,n,a){const d=[4];if(a===0)return d;n._mult(a);const c=s.sub(n),p=e.sub(n),w=[s,e,c,p];for(let T=0;T<4;T++)for(const P of w)if(o3[T](P)){d.push(T);break}return d}class U2{constructor(e){this.vertexArray=new uo,this.indexArray=new Ns,this.programConfigurations=new cu(e.layers,{zoom:e.zoom,lut:e.lut},n=>n3.includes(n)),this._segments=new vo,this.hiddenByLandmarkVertexArray=new ph,this._segmentToGroundQuads={},this._segmentToGroundQuads[0]=[],this._segmentToRegionTriCounts={},this._segmentToRegionTriCounts[0]=[0,0,0,0,0],this.regionSegments={},this.regionSegments[4]=new vo}getDefaultSegment(){return this.regionSegments[4]}hasData(){return this.vertexArray.length!==0}addData(e,n,a,d=!1){const c=e.length;if(c>2){let p=Math.max(0,this._segments.get().length-1);const w=this._segments._prepareSegment(4*c,this.vertexArray.length,2*this._segmentToGroundQuads[p].length);let T;p!==this._segments.get().length-1&&(p++,this._segmentToGroundQuads[p]=[],this._segmentToRegionTriCounts[p]=[0,0,0,0,0]);{const P=e[0],x=e[1];T=V2(P.sub(e[c-1])._perp()._unit(),x.sub(P)._perp()._unit())}for(let P=0;P<c;P++){const x=P===c-1?0:P+1,C=e[P],A=e[x],E=e[x===c-1?0:x+1],M=A.sub(C)._perp()._unit(),k=V2(M,E.sub(A)._perp()._unit()),N=T,j=k;if(ib(C,A,n)||d&&G2(C,n)&&G2(A,n)){T=k;continue}const q=w.vertexLength;Ty(this.vertexArray,C,A,1,1,N),Ty(this.vertexArray,C,A,1,0,N),Ty(this.vertexArray,C,A,0,1,j),Ty(this.vertexArray,C,A,0,0,j),w.vertexLength+=4;const X=s3(C,A,M,a);for(const W of X)this._segmentToGroundQuads[p].push({id:q,region:W}),this._segmentToRegionTriCounts[p][W]+=2,w.primitiveLength+=2;T=k}}}prepareBorderSegments(){if(!this.hasData())return;const e=this._segments.get(),n=e.length;for(let a=0;a<n;a++)this._segmentToGroundQuads[a].sort((d,c)=>d.region-c.region);for(let a=0;a<n;a++){const d=this._segmentToGroundQuads[a],c=e[a],p=this._segmentToRegionTriCounts[a];p.reduce((T,P)=>T+P,0);let w=0;for(let T=0;T<=4;T++){const P=p[T];if(P!==0){let x=this.regionSegments[T];x||(x=this.regionSegments[T]=new vo);const C={vertexOffset:c.vertexOffset,primitiveOffset:c.primitiveOffset+w,vertexLength:c.vertexLength,primitiveLength:P};x.get().push(C)}w+=P}for(let T=0;T<d.length;T++){const P=d[T].id;this.indexArray.emplaceBack(P,P+1,P+3),this.indexArray.emplaceBack(P,P+3,P+2)}}this._segmentToGroundQuads=null,this._segmentToRegionTriCounts=null,this._segments.destroy(),this._segments=null}addPaintPropertiesData(e,n,a,d,c,p){this.hasData()&&this.programConfigurations.populatePaintArrays(this.vertexArray.length,e,n,a,d,c,p)}upload(e){this.hasData()&&(this.vertexBuffer=e.createVertexBuffer(this.vertexArray,ga.members),this.indexBuffer=e.createIndexBuffer(this.indexArray))}uploadPaintProperties(e){this.hasData()&&this.programConfigurations.upload(e)}update(e,n,a,d,c,p,w){this.hasData()&&this.programConfigurations.updatePaintArrays(e,n,a,d,c,p,w)}updateHiddenByLandmark(e){if(!this.hasData())return;const n=e.groundVertexCount+e.groundVertexArrayOffset;if(e.groundVertexCount===0)return;const a=e.flags&Wf?1:0;for(let d=e.groundVertexArrayOffset;d<n;++d)this.hiddenByLandmarkVertexArray.emplace(d,a);this._needsHiddenByLandmarkUpdate=!0}uploadHiddenByLandmark(e){this.hasData()&&this._needsHiddenByLandmarkUpdate&&(!this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexArray.length>0?this.hiddenByLandmarkVertexBuffer=e.createVertexBuffer(this.hiddenByLandmarkVertexArray,Yx.members,!0):this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.updateData(this.hiddenByLandmarkVertexArray),this._needsHiddenByLandmarkUpdate=!1)}destroy(){if(this.vertexBuffer){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.destroy(),this._segments&&this._segments.destroy(),this.programConfigurations.destroy();for(let e=0;e<=4;e++){const n=this.regionSegments[e];n&&n.destroy()}}}}class Cy{constructor(e){this.zoom=e.zoom,this.canonical=e.canonical,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(n=>n.fqid),this.index=e.index,this.hasPattern=!1,this.edgeRadius=0,this.projection=e.projection,this.activeReplacements=[],this.replacementUpdateTime=0,this.centroidData=[],this.footprintIndices=new Ns,this.footprintVertices=new Ia,this.footprintSegments=[],this.layoutVertexArray=new Fo,this.centroidVertexArray=new zp,this.wallVertexArray=new Op,this.indexArray=new Ns,this.programConfigurations=new cu(e.layers,{zoom:e.zoom,lut:e.lut},n=>t3.includes(n)),this.segments=new vo,this.stateDependentLayerIds=this.layers.filter(n=>n.isStateDependent()).map(n=>n.id),this.groundEffect=new U2(e),this.maxHeight=0,this.partLookup={},this.triangleSubSegments=[],this.polygonSegments=[]}updateFootprints(e,n){}populate(e,n,a,d){this.features=[],this.hasPattern=fr("fill-extrusion",this.layers,n),this.featuresOnBorder=[],this.borderFeatureIndices=[[],[],[],[]],this.borderDoneWithNeighborZ=[-1,-1,-1,-1],this.selfDEMTileTimestamp=Number.MAX_VALUE,this.borderDEMTileTimestamp=[Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE],this.tileToMeter=h(a),this.edgeRadius=this.layers[0].layout.get("fill-extrusion-edge-radius")/this.tileToMeter,this.wallMode=this.layers[0].paint.get("fill-extrusion-line-width").constantOr(1)!==0;for(const{feature:c,id:p,index:w,sourceLayerIndex:T}of e){const P=this.layers[0]._featureFilter.needGeometry,x=G(c,P);if(!this.layers[0]._featureFilter.filter(new qr(this.zoom),x,a))continue;const C={id:p,sourceLayerIndex:T,index:w,geometry:P?x.geometry:U(c,a,d),properties:c.properties,type:c.type,patterns:{}},A=this.layoutVertexArray.length,E=rb[C.type]==="Polygon";if(this.hasPattern)this.features.push(_r("fill-extrusion",this.layers,C,this.zoom,n));else if(this.wallMode)for(const M of C.geometry)for(const k of F2(M,E))this.addFeature(C,[k],w,a,{},n.availableImages,d,n.brightness);else this.addFeature(C,C.geometry,w,a,{},n.availableImages,d,n.brightness);n.featureIndex.insert(c,C.geometry,w,T,this.index,A)}this.sortBorders(),this.projection.name==="mercator"&&this.splitToSubtiles(),this.groundEffect.prepareBorderSegments(),this.polygonSegments.length=0}addFeatures(e,n,a,d,c,p){for(const w of this.features){const T=rb[w.type]==="Polygon",{geometry:P}=w;if(this.wallMode)for(const x of P)for(const C of F2(x,T))this.addFeature(w,[C],w.index,n,a,d,c,p);else this.addFeature(w,P,w.index,n,a,d,c,p)}this.sortBorders(),this.projection.name==="mercator"&&this.splitToSubtiles()}update(e,n,a,d,c,p,w){this.programConfigurations.updatePaintArrays(e,n,c,a,d,p,w),this.groundEffect.update(e,n,c,a,d,p,w)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload||this.groundEffect.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,QR),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.wallVertexBuffer=e.createVertexBuffer(this.wallVertexArray,md.members),this.layoutVertexExtArray&&(this.layoutVertexExtBuffer=e.createVertexBuffer(this.layoutVertexExtArray,JR.members,!0)),this.groundEffect.upload(e)),this.groundEffect.uploadPaintProperties(e),this.programConfigurations.upload(e),this.uploaded=!0}uploadCentroid(e){this.groundEffect.uploadHiddenByLandmark(e),this.needsCentroidUpdate&&(!this.centroidVertexBuffer&&this.centroidVertexArray.length>0?this.centroidVertexBuffer=e.createVertexBuffer(this.centroidVertexArray,ro.members,!0):this.centroidVertexBuffer&&this.centroidVertexBuffer.updateData(this.centroidVertexArray),this.needsCentroidUpdate=!1)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.centroidVertexBuffer&&this.centroidVertexBuffer.destroy(),this.layoutVertexExtBuffer&&this.layoutVertexExtBuffer.destroy(),this.groundEffect.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(e,n,a,d,c,p,w,T){const P=this.layers[0].paint.get("fill-extrusion-flood-light-ground-radius").evaluate(e,{})/this.tileToMeter,x=[new Ht(0,0),new Ht(pn,pn)],C=w.projection,A=C.name==="globe",E=this.wallMode||rb[e.type]==="Polygon",M=new $2;M.centroidDataIndex=this.centroidData.length;const k=new j2,N=this.layers[0].paint.get("fill-extrusion-base").evaluate(e,{},d)<=0,j=this.layers[0].paint.get("fill-extrusion-height").evaluate(e,{},d);let q;if(k.height=j,k.vertexArrayOffset=this.layoutVertexArray.length,k.groundVertexArrayOffset=this.groundEffect.vertexArray.length,A&&!this.layoutVertexExtArray&&(this.layoutVertexExtArray=new nd),this.wallMode){if(A)return void nr("Non zero fill-extrusion-line-width is not yet supported on globe.");if(n.length!==1)return;q=function(ve){const Be=ve[0].x===ve[ve.length-1].x&&ve[0].y===ve[ve.length-1].y;(function(vn){let Bt=0;const Pn=vn.length;for(let dn=0;dn<Pn;dn++)Bt+=(vn[(dn+1)%Pn].x-vn[dn].x)*(vn[(dn+1)%Pn].y+vn[dn].y);return Bt>=0})(ve)||(ve=ve.reverse());const Ue={geometry:[],joinNormals:[],indices:[]},Ye=[],Xe=[],Je=[];let st=ve.length;for(;st>=2&&ve[st-1].equals(ve[st-2]);)st--;if(st<(Be?3:2))return Ue;let pt,ot,It,tn,Lt,un=0;for(;un<st-1&&ve[un].equals(ve[un+1]);)un++;Be&&(pt=ve[st-2],Lt=ve[un].sub(pt)._unit()._perp());for(let vn=un;vn<st;vn++){if(It=vn===st-1?Be?ve[un+1]:void 0:ve[vn+1],It&&ve[vn].equals(It))continue;Lt&&(tn=Lt),pt&&(ot=pt),pt=ve[vn],Lt=It?It.sub(pt)._unit()._perp():tn,tn=tn||Lt;let Bt=tn.add(Lt);Bt.x===0&&Bt.y===0||Bt._unit();const Pn=Bt.x*Lt.x+Bt.y*Lt.y,dn=Pn!==0?1/Pn:1/0,Cn=tn.x*Lt.y-tn.y*Lt.x>0;let Zn="miter";const xr=2;Zn==="miter"&&dn>xr&&(Zn="bevel"),Zn==="bevel"&&(dn>100&&(Zn="flipbevel"),dn<xr&&(Zn="miter"));const Cr=(Or,Mr,Zr,Bi)=>{const Mi=new Ht(Or.x,Or.y),hr=new Ht(Or.x,Or.y);Mi.x+=Mr.x*Bi,Mi.y+=Mr.y*Bi,hr.x-=Mr.x*Math.max(Zr,1),hr.y-=Mr.y*Math.max(Zr,1),Je.push(Mr),Ye.push(Mi),Xe.push(hr)};if(Zn==="miter")Bt._mult(dn),Cr(pt,Bt,0,0);else if(Zn==="flipbevel")Bt=Lt.mult(-1),Cr(pt,Bt,0,0),Cr(pt,Bt.mult(-1),0,0);else{const Or=-Math.sqrt(dn*dn-1),Mr=Cn?Or:0,Zr=Cn?0:Or;ot&&Cr(pt,tn,Mr,Zr),It&&Cr(pt,Lt,Mr,Zr)}}Ue.geometry=[...Ye,...Xe.reverse(),Ye[0]],Ue.joinNormals=[...Je,...Je.reverse(),Je[Je.length-1]];const cn=Ue.geometry.length-1;for(let vn=0;vn<cn/2;vn++)if(vn+1<cn/2){let Bt=vn,Pn=vn+1,dn=cn-1-vn,Cn=cn-2-vn;Bt=Bt===0?cn-1:Bt-1,Pn=Pn===0?cn-1:Pn-1,dn=dn===0?cn-1:dn-1,Cn=Cn===0?cn-1:Cn-1,Ue.indices.push(dn),Ue.indices.push(Pn),Ue.indices.push(Bt),Ue.indices.push(dn),Ue.indices.push(Cn),Ue.indices.push(Pn)}return Ue}(n[0]),n=[q.geometry]}const X=(ve,Be)=>ve<(Be.length-1)/2||ve===Be.length-1,W=this.wallMode?[n]:Mn(n,500);for(let ve=W.length-1;ve>=0;ve--){const Be=W[ve];(Be.length===0||(J=Be[0]).every(Me=>Me.x<=0)||J.every(Me=>Me.x>=pn)||J.every(Me=>Me.y<=0)||J.every(Me=>Me.y>=pn))&&W.splice(ve,1)}var J;let ne;if(A)ne=Y2(W,x,d);else{ne=[];for(const ve of W)ne.push({polygon:ve,bounds:x})}const he=E?this.edgeRadius:0,we=he>0&&this.zoom<17,be=(ve,Be)=>{if(ve.length===0)return!1;const Me=ve[ve.length-1];return Be.x===Me.x&&Be.y===Me.y};for(const{polygon:ve,bounds:Be}of ne){let Me=0,Ue=0;for(const st of ve)E&&!st[0].equals(st[st.length-1])&&st.push(st[0]),Ue+=E?st.length-1:st.length;const Ye=this.segments.prepareSegment((E?5:4)*Ue,this.layoutVertexArray,this.indexArray);k.footprintSegIdx<0&&(k.footprintSegIdx=this.footprintSegments.length),k.polygonSegIdx<0&&(k.polygonSegIdx=this.polygonSegments.length);const Xe={triangleArrayOffset:this.indexArray.length,triangleCount:0,triangleSegIdx:this.segments.segments.length-1},Je=new N2;if(Je.vertexOffset=this.footprintVertices.length,Je.indexOffset=3*this.footprintIndices.length,Je.ringIndices=[],E){const st=[],pt=[];Me=Ye.vertexLength;for(let It=0;It<ve.length;It++){const tn=ve[It];tn.length&&It!==0&&pt.push(st.length/2);const Lt=[];let un,cn;un=tn[1].sub(tn[0])._perp()._unit(),Je.ringIndices.push(tn.length-1);for(let vn=1;vn<tn.length;vn++){const Bt=tn[vn],Pn=tn[vn===tn.length-1?1:vn+1],dn=Bt.clone();if(he){cn=Pn.sub(Bt)._perp()._unit();const Cn=un.add(cn)._unit(),Zn=he*Math.min(4,1/(un.x*Cn.x+un.y*Cn.y));dn.x+=Zn*Cn.x,dn.y+=Zn*Cn.y,dn.x=Math.round(dn.x),dn.y=Math.round(dn.y),un=cn}if(!N||he!==0&&!we||be(Lt,dn)||Lt.push(dn),Fg(this.layoutVertexArray,dn.x,dn.y,0,0,1,1,0),this.wallMode){const Cn=X(vn,tn);Bg(this.wallVertexArray,q.joinNormals[vn],!Cn)}Ye.vertexLength++,this.footprintVertices.emplaceBack(Bt.x,Bt.y),st.push(Bt.x,Bt.y),A&&Ng(this.layoutVertexExtArray,C.projectTilePoint(dn.x,dn.y,d),C.upVector(d,dn.x,dn.y))}N&&(he===0||we)&&(Lt.length!==0&&be(Lt,Lt[0])&&Lt.pop(),this.groundEffect.addData(Lt,Be,P))}const ot=this.wallMode?q.indices:Hf(st,pt);for(let It=0;It<ot.length;It+=3)this.footprintIndices.emplaceBack(Je.vertexOffset+ot[It+0],Je.vertexOffset+ot[It+1],Je.vertexOffset+ot[It+2]),this.indexArray.emplaceBack(Me+ot[It],Me+ot[It+2],Me+ot[It+1]),Ye.primitiveLength++;Je.indexCount+=ot.length,Je.vertexCount+=this.footprintVertices.length-Je.vertexOffset}for(let st=0;st<ve.length;st++){const pt=ve[st];M.startRing(k,pt[0]);let ot=pt.length>4&&q2(pt[pt.length-2],pt[0],pt[1]),It=he?a3(pt[pt.length-2],pt[0],pt[1],he):0;const tn=[];let Lt,un,cn;un=pt[1].sub(pt[0])._perp()._unit();let vn=!0;for(let Bt=1,Pn=0;Bt<pt.length;Bt++){let dn=pt[Bt-1],Cn=pt[Bt];const Zn=pt[Bt===pt.length-1?1:Bt+1];if(M.appendEdge(k,Cn,dn),ib(Cn,dn,Be)){he&&(un=Zn.sub(Cn)._perp()._unit(),vn=!vn);continue}const xr=Cn.sub(dn)._perp(),Cr=xr.x/(Math.abs(xr.x)+Math.abs(xr.y)),Or=xr.y>0?1:0,Mr=dn.dist(Cn);if(Pn+Mr>32768&&(Pn=0),he){cn=Zn.sub(Cn)._perp()._unit();let hr=W2(dn,Cn,Zn,H2(un,cn),he);isNaN(hr)&&(hr=0);const Ai=Cn.sub(dn)._unit();dn=dn.add(Ai.mult(It))._round(),Cn=Cn.add(Ai.mult(-hr))._round(),It=hr,un=cn,N&&this.zoom>=17&&(be(tn,dn)||tn.push(dn),be(tn,Cn)||tn.push(Cn))}const Zr=Ye.vertexLength,Bi=pt.length>4&&q2(dn,Cn,Zn);let Mi=Z2(Pn,ot,vn);if(Fg(this.layoutVertexArray,dn.x,dn.y,Cr,Or,0,0,Mi),Fg(this.layoutVertexArray,dn.x,dn.y,Cr,Or,0,1,Mi),this.wallMode){const hr=X(Bt-1,pt),Ai=q.joinNormals[Bt-1];Bg(this.wallVertexArray,Ai,hr),Bg(this.wallVertexArray,Ai,hr)}if(Pn+=Mr,Mi=Z2(Pn,Bi,!vn),ot=Bi,Fg(this.layoutVertexArray,Cn.x,Cn.y,Cr,Or,0,0,Mi),Fg(this.layoutVertexArray,Cn.x,Cn.y,Cr,Or,0,1,Mi),this.wallMode){const hr=X(Bt,pt),Ai=q.joinNormals[Bt];Bg(this.wallVertexArray,Ai,hr),Bg(this.wallVertexArray,Ai,hr)}if(Ye.vertexLength+=4,this.indexArray.emplaceBack(Zr+0,Zr+1,Zr+2),this.indexArray.emplaceBack(Zr+1,Zr+3,Zr+2),Ye.primitiveLength+=2,he){const hr=Me+(Bt===1?pt.length-2:Bt-2),Ai=Bt===1?Me:hr+1;if(this.indexArray.emplaceBack(Zr+1,hr,Zr+3),this.indexArray.emplaceBack(hr,Ai,Zr+3),Ye.primitiveLength+=2,Lt===void 0&&(Lt=Zr),!ib(Zn,pt[Bt],Be)){const Ti=Bt===pt.length-1?Lt:Ye.vertexLength;this.indexArray.emplaceBack(Zr+2,Zr+3,Ti),this.indexArray.emplaceBack(Zr+3,Ti+1,Ti),this.indexArray.emplaceBack(Zr+3,Ai,Ti+1),Ye.primitiveLength+=3}vn=!vn}if(A){const hr=this.layoutVertexExtArray,Ai=C.projectTilePoint(dn.x,dn.y,d),Ti=C.projectTilePoint(Cn.x,Cn.y,d),Ni=C.upVector(d,dn.x,dn.y),ws=C.upVector(d,Cn.x,Cn.y);Ng(hr,Ai,Ni),Ng(hr,Ai,Ni),Ng(hr,Ti,ws),Ng(hr,Ti,ws)}}E&&(Me+=pt.length-1),N&&he&&this.zoom>=17&&(tn.length!==0&&be(tn,tn[0])&&tn.pop(),this.groundEffect.addData(tn,Be,P,he>0))}this.footprintSegments.push(Je),Xe.triangleCount=this.indexArray.length-Xe.triangleArrayOffset,this.polygonSegments.push(Xe),++k.footprintSegLen,++k.polygonSegLen}if(k.vertexCount=this.layoutVertexArray.length-k.vertexArrayOffset,k.groundVertexCount=this.groundEffect.vertexArray.length-k.groundVertexArrayOffset,k.vertexCount!==0){if(k.centroidXY=M.borders?B2:this.encodeCentroid(M,k),this.centroidData.push(k),M.borders){this.featuresOnBorder.push(M);const ve=this.featuresOnBorder.length-1;for(let Be=0;Be<M.borders.length;Be++)M.borders[Be][0]!==Number.MAX_VALUE&&this.borderFeatureIndices[Be].push(ve)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,a,c,p,d,T),this.groundEffect.addPaintPropertiesData(e,a,c,p,d,T),this.maxHeight=Math.max(this.maxHeight,j)}}sortBorders(){for(let e=0;e<this.borderFeatureIndices.length;e++)this.borderFeatureIndices[e].sort((n,a)=>this.featuresOnBorder[n].borders[e][0]-this.featuresOnBorder[a].borders[e][0])}splitToSubtiles(){const e=[];for(let w=0;w<this.centroidData.length;w++){const T=this.centroidData[w],P=+(T.min.y+T.max.y>pn),x=2*P+(+(T.min.x+T.max.x>pn)^P);for(let C=0;C<T.polygonSegLen;C++){const A=T.polygonSegIdx+C;e.push({centroidIdx:w,subtile:x,polygonSegmentIdx:A,triangleSegmentIdx:this.polygonSegments[A].triangleSegIdx})}}const n=new Ns;e.sort((w,T)=>w.triangleSegmentIdx===T.triangleSegmentIdx?w.subtile-T.subtile:w.triangleSegmentIdx-T.triangleSegmentIdx);let a=0,d=0,c=0;for(const w of e){if(w.triangleSegmentIdx!==a)break;c++}const p=e.length;for(;d!==e.length;){a=e[d].triangleSegmentIdx;let w=0,T=d,P=d;for(let x=T;x<c&&e[x].subtile===w;x++)P++;for(;T!==c;){const x=e[T];w=x.subtile;const C=this.centroidData[x.centroidIdx].min.clone(),A=this.centroidData[x.centroidIdx].max.clone(),E={vertexOffset:this.segments.segments[a].vertexOffset,primitiveOffset:n.length,vertexLength:this.segments.segments[a].vertexLength,primitiveLength:0,sortKey:void 0,vaos:{}};for(let M=T;M<P;M++){const k=e[M],N=this.polygonSegments[k.polygonSegmentIdx],j=this.centroidData[k.centroidIdx].min,q=this.centroidData[k.centroidIdx].max,X=this.indexArray.uint16;for(let W=N.triangleArrayOffset;W<N.triangleArrayOffset+N.triangleCount;W++)n.emplaceBack(X[3*W],X[3*W+1],X[3*W+2]);E.primitiveLength+=N.triangleCount,C.x=Math.min(C.x,j.x),C.y=Math.min(C.y,j.y),A.x=Math.max(A.x,q.x),A.y=Math.max(A.y,q.y)}E.primitiveLength>0&&this.triangleSubSegments.push({segment:E,min:C,max:A}),T=P;for(let M=T;M<c&&e[M].subtile===e[T].subtile;M++)P++}d=c;for(let x=d;x<p&&e[x].triangleSegmentIdx===e[d].triangleSegmentIdx;x++)c++}n._trim(),this.indexArray=n}getVisibleSegments(e,n,a){const d=new vo;if(this.wallMode){for(const k of this.triangleSubSegments)d.segments.push(k.segment);return d}let c=0,p=0;const w=1<<e.canonical.z;if(n){const k=n.getMinMaxForTile(e);k&&(c=k.min,p=k.max)}p+=this.maxHeight;const T=e.toUnwrapped();let P;const x=[T.canonical.x/w+T.wrap,T.canonical.y/w],C=[(T.canonical.x+1)/w+T.wrap,(T.canonical.y+1)/w],A=(k,N,j)=>[k[0]*(1-j[0])+N[0]*j[0],k[1]*(1-j[1])+N[1]*j[1]],E=[],M=[];for(const k of this.triangleSubSegments){E[0]=k.min.x/pn,E[1]=k.min.y/pn,M[0]=k.max.x/pn,M[1]=k.max.y/pn;const N=A(x,C,E),j=A(x,C,M);if(new Bn([N[0],N[1],c],[j[0],j[1],p]).intersectsPrecise(a)===0){P&&(d.segments.push(P),P=void 0);continue}const q=k.segment;P&&P.vertexOffset!==q.vertexOffset&&(d.segments.push(P),P=void 0),P?(P.vertexLength+=q.vertexLength,P.primitiveLength+=q.primitiveLength):P={vertexOffset:q.vertexOffset,primitiveLength:q.primitiveLength,vertexLength:q.vertexLength,primitiveOffset:q.primitiveOffset,sortKey:void 0,vaos:{}}}return P&&d.segments.push(P),d}encodeCentroid(e,n){const a=e.centroid(),d=n.span(),c=Math.min(7,Math.round(d.x*this.tileToMeter/10)),p=Math.min(7,Math.round(d.y*this.tileToMeter/10));return new Ht(yn(a.x,1,pn-1)<<3|c,yn(a.y,1,pn-1)<<3|p)}encodeBorderCentroid(e){if(!e.borders)return new Ht(0,0);const n=e.borders,a=Number.MAX_VALUE;if(n[0][0]!==a||n[1][0]!==a){const d=n[0][0]!==a?0:1;return new Ht(6|(n[0][0]!==a?0:65528),(n[d][0]+n[d][1])/2<<3|6)}{const d=n[2][0]!==a?2:3;return new Ht((n[d][0]+n[d][1])/2<<3|6,6|(n[2][0]!==a?0:65528))}}showCentroid(e){const n=this.centroidData[e.centroidDataIndex];n.flags&=Wf,n.centroidXY.x=0,n.centroidXY.y=0,this.writeCentroidToBuffer(n)}writeCentroidToBuffer(e){this.groundEffect.updateHiddenByLandmark(e);const n=e.vertexArrayOffset,a=e.vertexCount+e.vertexArrayOffset,d=e.flags&Wf?B2:e.centroidXY,c=this.centroidVertexArray.geta_centroid_pos0(n);if(this.centroidVertexArray.geta_centroid_pos1(n)!==d.y||c!==d.x){for(let p=n;p<a;++p)this.centroidVertexArray.emplace(p,d.x,d.y);this.needsCentroidUpdate=!0}}createCentroidsBuffer(){this.centroidVertexArray.resize(this.layoutVertexArray.length),this.groundEffect.hiddenByLandmarkVertexArray.resize(this.groundEffect.vertexArray.length);for(const e of this.centroidData)this.writeCentroidToBuffer(e)}updateReplacement(e,n,a){if(n.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=n.updateTime;const d=n.getReplacementRegionsForTile(e.toUnwrapped());if(tb(this.activeReplacements,d))return;if(this.activeReplacements=d,this.centroidVertexArray.length===0)this.createCentroidsBuffer();else for(const p of this.centroidData)p.flags&=2147483647;const c=[];for(const p of this.activeReplacements){if(p.order<a)continue;const w=Math.max(1,Math.pow(2,p.footprintTileId.canonical.z-e.canonical.z));for(const T of this.centroidData)if(!(T.flags&Wf||p.min.x>T.max.x||T.min.x>p.max.x||p.min.y>T.max.y||T.min.y>p.max.y))for(let P=0;P<T.footprintSegLen;P++){const x=this.footprintSegments[T.footprintSegIdx+P];if(c.length=0,l3(this.footprintVertices,x.vertexOffset,x.vertexCount,p.footprintTileId.canonical,e.canonical,c),z2(p.footprint,c,this.footprintIndices.uint16,x.indexOffset,x.indexCount,-x.vertexOffset,-w)){T.flags|=Wf;break}}}for(const p of this.centroidData)this.writeCentroidToBuffer(p);this.borderDoneWithNeighborZ=[-1,-1,-1,-1]}footprintContainsPoint(e,n,a){let d=!1;for(let c=0;c<a.footprintSegLen;c++){const p=this.footprintSegments[a.footprintSegIdx+c];let w=0;for(const T of p.ringIndices){for(let P=w,x=T+w-1;P<T+w;x=P++){const C=this.footprintVertices.int16[2*(P+p.vertexOffset)+0],A=this.footprintVertices.int16[2*(P+p.vertexOffset)+1],E=this.footprintVertices.int16[2*(x+p.vertexOffset)+1];A>n!=E>n&&e<(this.footprintVertices.int16[2*(x+p.vertexOffset)+0]-C)*(n-A)/(E-A)+C&&(d=!d)}w=T}}return d}getHeightAtTileCoord(e,n){let a=Number.NEGATIVE_INFINITY,d=!0;const c=4*(e+pn)*pn+(n+pn);if(this.partLookup.hasOwnProperty(c)){const p=this.partLookup[c];return p?{height:p.height,hidden:!!(p.flags&Wf)}:void 0}for(const p of this.centroidData)e>p.max.x||p.min.x>e||n>p.max.y||p.min.y>n||this.footprintContainsPoint(e,n,p)&&p&&p.height>a&&(a=p.height,this.partLookup[c]=p,d=!!(p.flags&Wf));if(a!==Number.NEGATIVE_INFINITY)return{height:a,hidden:d};this.partLookup[c]=void 0}}function H2(s,e){const n=s.add(e)._unit();return s.x*n.x+s.y*n.y}function a3(s,e,n,a){const d=e.sub(s)._perp()._unit(),c=n.sub(e)._perp()._unit();return W2(s,e,n,H2(d,c),a)}function W2(s,e,n,a,d){const c=Math.sqrt(1-a*a);return Math.min(s.dist(e)/3,e.dist(n)/3,d*c/a)}function ib(s,e,n){return s.x<n[0].x&&e.x<n[0].x||s.x>n[1].x&&e.x>n[1].x||s.y<n[0].y&&e.y<n[0].y||s.y>n[1].y&&e.y>n[1].y}function G2(s,e){return s.x<e[0].x||s.x>e[1].x||s.y<e[0].y||s.y>e[1].y}function q2(s,e,n){if(s.x<0||s.x>=pn||e.x<0||e.x>=pn||n.x<0||n.x>=pn)return!1;const a=n.sub(e),d=a.perp(),c=s.sub(e);return(a.x*c.x+a.y*c.y)/Math.sqrt((a.x*a.x+a.y*a.y)*(c.x*c.x+c.y*c.y))>-.866&&d.x*c.x+d.y*c.y<0}function Z2(s,e,n){const a=e?2|s:-3&s;return n?1|a:-2&a}function X2(){const s=Math.PI/32,e=Math.tan(s),n=yh;return n*Math.sqrt(1+2*e*e)-n}function Y2(s,e,n){const a=1<<n.z,d=qa(n.x/a),c=qa((n.x+1)/a),p=jn(n.y/a),w=jn((n.y+1)/a);return function(T,P,x,C,A=0,E){const M=[];if(!T.length||!x||!C)return M;const k=(ne,he)=>{for(const we of ne)M.push({polygon:we,bounds:he})},N=Math.ceil(Math.log2(x)),j=Math.ceil(Math.log2(C)),q=N-j,X=[];for(let ne=0;ne<Math.abs(q);ne++)X.push(q>0?0:1);for(let ne=0;ne<Math.min(N,j);ne++)X.push(0),X.push(1);let W=T;if(W=wy(W,P[0].y-A,P[1].y+A,1),W=wy(W,P[0].x-A,P[1].x+A,0),!W.length)return M;const J=[];for(X.length?J.push({polygons:W,bounds:P,depth:0}):k(W,P);J.length;){const ne=J.pop(),he=ne.depth,we=X[he],be=ne.bounds[0],ve=ne.bounds[1],Be=we===0?be.x:be.y,Me=we===0?ve.x:ve.y,Ue=E(we,Be,Me),Ye=wy(ne.polygons,Be-A,Ue+A,we),Xe=wy(ne.polygons,Ue-A,Me+A,we);if(Ye.length){const Je=[be,new Ht(we===0?Ue:ve.x,we===1?Ue:ve.y)];X.length>he+1?J.push({polygons:Ye,bounds:Je,depth:he+1}):k(Ye,Je)}if(Xe.length){const Je=[new Ht(we===0?Ue:be.x,we===1?Ue:be.y),ve];X.length>he+1?J.push({polygons:Xe,bounds:Je,depth:he+1}):k(Xe,Je)}}return M}(s,e,Math.ceil((c-d)/11.25),Math.ceil((p-w)/11.25),1,(T,P,x)=>{if(T===0)return .5*(P+x);{const C=jn((n.y+P/pn)/a);return(ql(.5*(jn((n.y+x/pn)/a)+C))*a-n.y)*pn}})}function l3(s,e,n,a,d,c){const p=Math.pow(2,a.z-d.z);for(let w=0;w<n;w++){let T=s.int16[2*(w+e)+0],P=s.int16[2*(w+e)+1];T=(T+d.x*pn)*p-a.x*pn,P=(P+d.y*pn)*p-a.y*pn,c.push(new Ht(T,P))}}let K2,J2;function jg(s,e){return s.x*e.x+s.y*e.y}function Q2(s,e){if(s.length===1){let n=0;const a=e[n++];let d;for(;!d||a.equals(d);)if(d=e[n++],!d)return 1/0;for(;n<e.length;n++){const c=e[n],p=s[0],w=d.sub(a),T=c.sub(a),P=p.sub(a),x=jg(w,w),C=jg(w,T),A=jg(T,T),E=jg(P,w),M=jg(P,T),k=x*A-C*C,N=(A*E-C*M)/k,j=(x*M-C*E)/k,q=a.z*(1-N-j)+d.z*N+c.z*j;if(isFinite(q))return q}return 1/0}{let n=1/0;for(const a of e)n=Math.min(n,a.z);return n}}function eE(s,e,n,a,d,c,p,w){const T=p*d.getElevationAt(s,e,!0,!0),P=c[0]!==0,x=P?c[1]===0?p*(c[0]/7-450):p*function(C,A,E){const M=Math.floor(A[0]/8),k=Math.floor(A[1]/8),N=10*(A[0]-8*M),j=10*(A[1]-8*k),q=C.getElevationAt(M,k,!0,!0),X=C.getMeterToDEM(E),W=Math.floor(.5*(N*X-1)),J=Math.floor(.5*(j*X-1)),ne=C.tileCoordToPixel(M,k),he=2*W+1,we=2*J+1,be=function(Xe,Je,st,pt,ot){return[Xe.getElevationAtPixel(Je,st,!0),Xe.getElevationAtPixel(Je+ot,st,!0),Xe.getElevationAtPixel(Je,st+ot,!0),Xe.getElevationAtPixel(Je+pt,st+ot,!0)]}(C,ne.x-W,ne.y-J,he,we),ve=Math.abs(be[0]-be[1]),Be=Math.abs(be[2]-be[3]),Me=Math.abs(be[0]-be[2])+Math.abs(be[1]-be[3]),Ue=Math.min(.25,.5*X*(ve+Be)/he),Ye=Math.min(.25,.5*X*Me/we);return q+Math.max(Ue*N,Ye*j)}(d,c,w):T;return{base:T+(n===0?-1:n),top:P?Math.max(x+a,T+n+2):T+a}}qe(Cy,"FillExtrusionBucket",{omit:["layers","features"]}),qe(j2,"PartData"),qe(N2,"FootprintSegment"),qe($2,"BorderCentroidData"),qe(U2,"GroundEffect");const c3=$r([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_linesofar",components:1,type:"Float32"}],4),u3=$r([{name:"a_z_offset_width",components:2,type:"Float32"}],4),{members:h3}=c3,d3=$r([{name:"a_packed",components:4,type:"Float32"}]),{members:f3}=d3,p3=$r([{name:"a_pattern_data",components:3,type:"Float32"}]),{members:m3}=p3;class tE{constructor(e,n){this.width=e,this.height=n,this.nextRow=0,this.image=new ju({width:e,height:n}),this.positions={},this.uploaded=!1}getDash(e,n){const a=this.getKey(e,n);return this.positions[a]}trim(){const e=this.width,n=this.height=qi(this.nextRow);this.image.resize({width:e,height:n})}getKey(e,n){return e.join(",")+n}getDashRanges(e,n,a){const d=[];let c=e.length%2==1?-e[e.length-1]*a:0,p=e[0]*a,w=!0;d.push({left:c,right:p,isDash:w,zeroLength:e[0]===0});let T=e[0];for(let P=1;P<e.length;P++){w=!w;const x=e[P];c=T*a,T+=x,p=T*a,d.push({left:c,right:p,isDash:w,zeroLength:x===0})}return d}addRoundDash(e,n,a){const d=n/2;for(let c=-a;c<=a;c++){const p=this.width*(this.nextRow+a+c);let w=0,T=e[w];for(let P=0;P<this.width;P++){P/T.right>1&&(T=e[++w]);const x=Math.abs(P-T.left),C=Math.abs(P-T.right),A=Math.min(x,C);let E;const M=c/a*(d+1);if(T.isDash){const k=d-Math.abs(M);E=Math.sqrt(A*A+k*k)}else E=d-Math.sqrt(A*A+M*M);this.image.data[p+P]=Math.max(0,Math.min(255,E+128))}}}addRegularDash(e,n){for(let T=e.length-1;T>=0;--T){const P=e[T],x=e[T+1];P.zeroLength?e.splice(T,1):x&&x.isDash===P.isDash&&(x.left=P.left,e.splice(T,1))}const a=e[0],d=e[e.length-1];a.isDash===d.isDash&&(a.left=d.left-this.width,d.right=a.right+this.width);const c=this.width*this.nextRow;let p=0,w=e[p];for(let T=0;T<this.width;T++){T/w.right>1&&(w=e[++p]);const P=Math.abs(T-w.left),x=Math.abs(T-w.right),C=Math.min(P,x);this.image.data[c+T]=Math.max(0,Math.min(255,(w.isDash?C:-C)+n+128))}}addDash(e,n){const a=this.getKey(e,n);if(this.positions[a])return this.positions[a];const d=n==="round",c=d?7:0,p=2*c+1;if(this.nextRow+p>this.height)return nr("LineAtlas out of space"),null;e.length===0&&e.push(1);let w=0;for(let x=0;x<e.length;x++)e[x]<0&&(nr("Negative value is found in line dasharray, replacing values with 0"),e[x]=0),w+=e[x];if(w!==0){const x=this.width/w,C=this.getDashRanges(e,this.width,x);d?this.addRoundDash(C,x,c):this.addRegularDash(C,n==="square"?.5*x:0)}const T=this.nextRow+c;this.nextRow+=p;const P={tl:[T,c],br:[w,0]};return this.positions[a]=P,P}}qe(tE,"LineAtlas");const g3=Am.VectorTileFeature.types,_3=Math.cos(Math.PI/180*37.5),y3=Math.cos(Math.PI/180*5);class ob{constructor(e){this.evaluationGlobals={zoom:0,lineProgress:void 0},this.zoom=e.zoom,this.evaluationGlobals.zoom=this.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(n=>n.fqid),this.index=e.index,this.projection=e.projection,this.hasPattern=!1,this.hasZOffset=!1,this.hasCrossSlope=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(n=>{this.gradients[n.id]={}}),this.layoutVertexArray=new td,this.layoutVertexArray2=new xl,this.patternVertexArray=new Vl,this.indexArray=new Ns,this.programConfigurations=new cu(e.layers,{zoom:e.zoom,lut:e.lut}),this.segments=new vo,this.maxLineLength=0,this.zOffsetVertexArray=new Pc,this.stateDependentLayerIds=this.layers.filter(n=>n.isStateDependent()).map(n=>n.id),this.tessellationStep=e.tessellationStep?e.tessellationStep:pn/64}updateFootprints(e,n){}populate(e,n,a,d){this.hasPattern=fr("line",this.layers,n);const c=this.layers[0].layout.get("line-sort-key");this.tileToMeter=h(a),this.hasZOffset=!this.layers[0].isDraped();const p=this.layers[0].layout.get("line-elevation-reference");this.hasZOffset&&p==="none"&&nr(`line-elevation-reference: ground is used for the layer ${this.layerIds[0]} because non-zero line-z-offset value was found.`);const w=this.layers[0].layout.get("line-cross-slope");this.hasCrossSlope=this.hasZOffset&&w!==void 0;const T=[];for(const{feature:A,id:E,index:M,sourceLayerIndex:k}of e){const N=this.layers[0]._featureFilter.needGeometry,j=G(A,N);if(!this.layers[0]._featureFilter.filter(new qr(this.zoom),j,a))continue;const q=c?c.evaluate(j,{},a):void 0,X={id:E,properties:A.properties,type:A.type,sourceLayerIndex:k,index:M,geometry:N?j.geometry:U(A,a,d),patterns:{},sortKey:q};T.push(X)}c&&T.sort((A,E)=>A.sortKey-E.sortKey);const{lineAtlas:P,featureIndex:x}=n,C=this.addConstantDashes(P);for(const A of T){const{geometry:E,index:M,sourceLayerIndex:k}=A;if(C&&this.addFeatureDashes(A,P),this.hasPattern){const N=_r("line",this.layers,A,this.zoom,n);this.patternFeatures.push(N)}else this.addFeature(A,E,M,a,P.positions,n.availableImages,n.brightness);x.insert(e[M].feature,E,M,k,this.index)}}addConstantDashes(e){let n=!1;for(const a of this.layers){const d=a.paint.get("line-dasharray").value,c=a.layout.get("line-cap").value;if(d.kind!=="constant"||c.kind!=="constant")n=!0;else{const p=c.value,w=d.value;if(!w)continue;e.addDash(w,p)}}return n}addFeatureDashes(e,n){const a=this.zoom;for(const d of this.layers){const c=d.paint.get("line-dasharray").value,p=d.layout.get("line-cap").value;if(c.kind==="constant"&&p.kind==="constant")continue;let w,T;if(c.kind==="constant"){if(w=c.value,!w)continue}else w=c.evaluate({zoom:a},e);T=p.kind==="constant"?p.value:p.evaluate({zoom:a},e),n.addDash(w,T),e.patterns[d.id]=n.getKey(w,T)}}update(e,n,a,d,c,p,w){this.programConfigurations.updatePaintArrays(e,n,c,a,d,p,w)}addFeatures(e,n,a,d,c,p){for(const w of this.patternFeatures)this.addFeature(w,w.geometry,w.index,n,a,d,p)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=e.createVertexBuffer(this.layoutVertexArray2,f3)),this.patternVertexArray.length!==0&&(this.patternVertexBuffer=e.createVertexBuffer(this.patternVertexArray,m3)),!this.zOffsetVertexBuffer&&this.zOffsetVertexArray.length>0&&(this.zOffsetVertexBuffer=e.createVertexBuffer(this.zOffsetVertexArray,u3.members,!0)),this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,h3),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.zOffsetVertexBuffer&&this.zOffsetVertexBuffer.destroy(),this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(e){if(e.properties&&e.properties.hasOwnProperty("mapbox_clip_start")&&e.properties.hasOwnProperty("mapbox_clip_end"))return{start:+e.properties.mapbox_clip_start,end:+e.properties.mapbox_clip_end}}addFeature(e,n,a,d,c,p,w){const T=this.layers[0].layout,P=T.get("line-join").evaluate(e,{}),x=T.get("line-cap").evaluate(e,{}),C=T.get("line-miter-limit"),A=T.get("line-round-limit");this.lineClips=this.lineFeatureClips(e),this.lineFeature=e,this.zOffsetValue=T.get("line-z-offset").value;const E=this.layers[0].paint.get("line-width").value;E.kind!=="constant"&&E.isLineProgressConstant===!1&&(this.variableWidthValue=E);for(const M of n)this.addLine(M,e,d,P,x,C,A);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,a,c,p,d,w)}addLine(e,n,a,d,c,p,w){this.distance=0,this.prevDistance=0,this.scaledDistance=0,this.totalDistance=0,this.totalFeatureLength=0,this.lineSoFar=0,this.currentVertex=void 0;const T=d==="none";if(this.patternJoinNone=this.hasPattern&&T,this.segmentStart=0,this.segmentStartf32=0,this.segmentPoints=[],this.lineClips){this.lineClipsArray.push(this.lineClips);for(let X=0;X<e.length-1;X++)this.totalDistance+=e[X].dist(e[X+1]);this.totalFeatureLength=this.totalDistance/(this.lineClips.end-this.lineClips.start),this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const P=g3[n.type]==="Polygon";let x=e.length;for(;x>=2&&e[x-1].equals(e[x-2]);)x--;let C=0;for(;C<x-1&&e[C].equals(e[C+1]);)C++;if(x<(P?3:2))return;d==="bevel"&&(p=1.05);const A=this.segments.prepareSegment(10*x,this.layoutVertexArray,this.indexArray);let E,M,k,N,j,q;this.e1=this.e2=-1,P&&(E=e[x-2],j=e[C].sub(E)._unit()._perp());for(let X=C;X<x;X++){if(k=X===x-1?P?e[C+1]:void 0:e[X+1],k&&e[X].equals(k))continue;j&&(N=j),E&&(M=E),E=e[X],q=this.evaluateLineProgressFeatures(M?M.dist(E):0),j=k?k.sub(E)._unit()._perp():N,N=N||j;const W=M&&k;let J=W?d:P||T?"butt":c;const ne=N.x*j.x+N.y*j.y;if(T){const Ye=function(Xe){if(Xe.patternJoinNone){const Je=Xe.segmentPoints.length/2,st=Xe.lineSoFar-Xe.segmentStart;for(let pt=0;pt<Je;++pt){const ot=Xe.segmentPoints[2*pt+1],It=Math.round(Xe.segmentPoints[2*pt])+.5+.25*ot;Xe.patternVertexArray.emplaceBack(It,st,Xe.segmentStart),Xe.patternVertexArray.emplaceBack(It,st,Xe.segmentStart)}Xe.segmentPoints.length=0}Xe.e1=Xe.e2=-1};if(W&&ne<y3){this.updateDistance(M,E),this.addCurrentVertex(E,N,1,1,A,q),Ye(this),this.addCurrentVertex(E,j,-1,-1,A,q);continue}if(M){if(!k){this.updateDistance(M,E),this.addCurrentVertex(E,N,1,1,A,q),Ye(this);continue}J="miter"}}let he=N.add(j);he.x===0&&he.y===0||he._unit();const we=he.x*j.x+he.y*j.y,be=we!==0?1/we:1/0,ve=2*Math.sqrt(2-2*we),Be=we<_3&&M&&k,Me=N.x*j.y-N.y*j.x>0,Ue=this.overscaling<=16?15*pn/(512*this.overscaling):0;if(W&&J==="round"){if(be<w)J="miter";else if(be<=2){const Ye=sb(E,-10,pn+10);J=this.hasZOffset&&(Ye||this.hasCrossSlope)?"miter":"fakeround"}}if(J==="miter"&&be>p&&(J="bevel"),J==="bevel"&&(be>2&&(J="flipbevel"),be<p&&(J="miter")),M&&!(J==="miter"&&Be)&&this.updateDistance(M,E),J==="miter")if(Be){const Ye=E.dist(M);if(Ye>2*Ue){const Je=E.sub(E.sub(M)._mult(Ue/Ye)._round());this.updateDistance(M,Je),this.addCurrentVertex(Je,N,0,0,A,q),M=Je}this.updateDistance(M,E),he._mult(be),this.addCurrentVertex(E,he,0,0,A,q);const Xe=E.dist(k);if(Xe>2*Ue){const Je=E.add(k.sub(E)._mult(Ue/Xe)._round());this.updateDistance(E,Je),this.addCurrentVertex(Je,j,0,0,A,q),E=Je}}else he._mult(be),this.addCurrentVertex(E,he,0,0,A,q);else if(J==="flipbevel"){if(be>100)he=j.mult(-1);else{const Ye=be*N.add(j).mag()/N.sub(j).mag();he._perp()._mult(Ye*(Me?-1:1))}this.addCurrentVertex(E,he,0,0,A,q),this.addCurrentVertex(E,he.mult(-1),0,0,A,q)}else if(J==="bevel"||J==="fakeround"){q!=null&&M&&this.addCurrentVertex(E,N,-1,-1,A,q);const Ye=E.dist(M)<=2*Ue&&J!=="bevel",Xe=he.mult(Me?1:-1);Xe._mult(be);const Je=j.mult(Me?-1:1),st=N.mult(Me?-1:1),pt=this.evaluateLineProgressFeatures(this.distance);if(q==null&&(this.addHalfVertex(E,Xe.x,Xe.y,!1,!Me,0,A,pt),Ye||this.addHalfVertex(E,Xe.x+2*st.x,Xe.y+2*st.y,!1,Me,0,A,pt)),J==="fakeround"){const ot=Math.round(180*ve/Math.PI/20);this.addHalfVertex(E,st.x,st.y,!1,Me,0,A,pt);for(let It=0;It<ot;It++){let tn=It/ot;if(tn!==.5){const un=tn-.5;tn+=tn*un*(tn-1)*((1.0904+ne*(ne*(3.55645-1.43519*ne)-3.2452))*un*un+(.848013+ne*(.215638*ne-1.06021)))}const Lt=Je.sub(st)._mult(tn)._add(st)._unit();this.addHalfVertex(E,Lt.x,Lt.y,!1,Me,0,A,pt)}this.addHalfVertex(E,Je.x,Je.y,!1,Me,0,A,pt)}Ye||q!=null||this.addHalfVertex(E,Xe.x+2*Je.x,Xe.y+2*Je.y,!1,Me,0,A,pt),q!=null&&k&&this.addCurrentVertex(E,j,1,1,A,q)}else J==="butt"?this.addCurrentVertex(E,he,0,0,A,q):J==="square"?(M||this.addCurrentVertex(E,he,-1,-1,A,q),this.addCurrentVertex(E,he,0,0,A,q),M&&this.addCurrentVertex(E,he,1,1,A,q)):J==="round"&&(M&&(this.addCurrentVertex(E,N,0,0,A,q),this.addCurrentVertex(E,N,1,1,A,q,!0)),k&&(this.addCurrentVertex(E,j,-1,-1,A,q,!0),this.addCurrentVertex(E,j,0,0,A,q)))}}addVerticesTo(e,n,a,d,c,p,w,T,P,x){const C=(n.w-e.w)/this.tessellationStep|0;let A=0;const E=this.scaledDistance;if(C>1){this.lineSoFar=e.w;const k=(n.x-e.x)/C,N=(n.y-e.y)/C,j=(n.z-e.z)/C,q=(n.w-e.w)/C;for(let X=1;X<C;++X){e.x+=k,e.y+=N,e.z+=j,this.lineSoFar+=q,A+=q;const W=this.evaluateLineProgressFeatures(this.prevDistance+A);this.scaledDistance=(this.prevDistance+A)/this.totalDistance,this.addHalfVertex(e,a,d,x,!1,w,P,W),this.addHalfVertex(e,c,p,x,!0,-T,P,W)}}this.lineSoFar=n.w,this.scaledDistance=E;const M=this.evaluateLineProgressFeatures(this.distance);this.addHalfVertex(n,a,d,x,!1,w,P,M),this.addHalfVertex(n,c,p,x,!0,-T,P,M)}evaluateLineProgressFeatures(e){if(!this.variableWidthValue&&!this.hasZOffset)return null;this.evaluationGlobals.lineProgress=0,this.lineClips?this.evaluationGlobals.lineProgress=Math.min(1,(this.totalFeatureLength*this.lineClips.start+e)/this.totalFeatureLength):nr(`line-progress evaluation for ${this.layerIds[0]} requires enabling 'lineMetrics' for the source.`);let n=0;return this.variableWidthValue&&this.variableWidthValue.kind!=="constant"&&(n=this.variableWidthValue.evaluate(this.evaluationGlobals,this.lineFeature)||0),this.hasZOffset?this.zOffsetValue.kind==="constant"?{zOffset:this.zOffsetValue.value,variableWidth:n}:{zOffset:this.zOffsetValue.evaluate(this.evaluationGlobals,this.lineFeature)||0,variableWidth:n}:{zOffset:0,variableWidth:n}}addCurrentVertex(e,n,a,d,c,p,w=!1){const T=n.x+n.y*a,P=n.y-n.x*a,x=n.y*d-n.x,C=-n.y-n.x*d;if(p!=null){const A=this.hasZOffset,E=-10,M=pn+10,k=p.zOffset,N=new M2(e.x,e.y,k,this.lineSoFar),j=!!A&&sb(e,E,M),q=this.lineSoFar,X=this.distance;if(this.currentVertex)if(j){const W=this.currentVertexIsOutside,J=this.currentVertex,ne=new M2(e.x,e.y,k,this.lineSoFar);if(I2(J,ne,E,M),!sb(ne,E,M)){if(W){this.e1=this.e2=-1,this.distance-=J.dist(N),this.lineSoFar=J.w;const he=this.evaluateLineProgressFeatures(J.w-this.totalFeatureLength*(this.lineClips?this.lineClips.start:0));this.addHalfVertex(J,T,P,w,!1,a,c,he),this.addHalfVertex(J,x,C,w,!0,-d,c,he),this.prevDistance=this.distance}this.distance=this.prevDistance+J.dist(ne),this.scaledDistance=this.distance/this.totalDistance,this.addVerticesTo(J,ne,T,P,x,C,a,d,c,w),this.distance=X,this.scaledDistance=this.distance/this.totalDistance}}else{const W=this.currentVertex;if(this.currentVertexIsOutside){I2(W,N,E,M),this.e1=this.e2=-1,this.distance-=W.dist(N),this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=W.w;const J=this.evaluateLineProgressFeatures(W.w-this.totalFeatureLength*(this.lineClips?this.lineClips.start:0));this.addHalfVertex(W,T,P,w,!1,a,c,J),this.addHalfVertex(W,x,C,w,!0,-d,c,J),this.prevDistance=this.distance,this.distance=X,this.scaledDistance=this.distance/this.totalDistance}this.addVerticesTo(W,N,T,P,x,C,a,d,c,w)}else j||(this.addHalfVertex(e,T,P,w,!1,a,c,p),this.addHalfVertex(e,x,C,w,!0,-d,c,p));this.currentVertex=N,this.currentVertexIsOutside=j,this.lineSoFar=q}else this.addHalfVertex(e,T,P,w,!1,a,c,p),this.addHalfVertex(e,x,C,w,!0,-d,c,p)}addHalfVertex({x:e,y:n},a,d,c,p,w,T,P){this.patternJoinNone&&(this.segmentPoints.length===0&&(this.segmentStart=this.lineSoFar,this.segmentStartf32=Math.fround(this.lineSoFar)),p||this.segmentPoints.push(this.lineSoFar-this.segmentStart,w)),this.layoutVertexArray.emplaceBack((e<<1)+(c?1:0),(n<<1)+(p?1:0),Math.round(63*a)+128,Math.round(63*d)+128,1+(w===0?0:w<0?-1:1),0,this.lineSoFar-this.segmentStartf32),this.lineClips&&this.layoutVertexArray2.emplaceBack(this.scaledDistance,this.lineClipsArray.length,this.lineClips.start,this.lineClips.end);const x=T.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,x),T.primitiveLength++),p?this.e2=x:this.e1=x,P!=null&&this.zOffsetVertexArray.emplaceBack(P.zOffset,P.variableWidth)}updateScaledDistance(){this.lineClips?(this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=this.totalFeatureLength*this.lineClips.start+this.distance):this.lineSoFar=this.distance}updateDistance(e,n){this.prevDistance=this.distance,this.distance+=e.dist(n),this.updateScaledDistance()}}function sb(s,e,n){return s.x<e||s.x>n||s.y<e||s.y>n}let nE,rE;function iE(s,e,n){return e*(pn/(s.tileSize*Math.pow(2,n-s.tileID.overscaledZ)))}qe(ob,"LineBucket",{omit:["layers","patternFeatures","currentVertex","currentVertexIsOutside"]});const oE=(s,e,n)=>(1-n)*s+n*e;function sE(s,e){return 1/iE(s,1,e.tileZoom)}function aE(s,e,n,a){return s.translatePosMatrix(a||e.tileID.projMatrix,e,n.paint.get("line-translate"),n.paint.get("line-translate-anchor"))}const lE=s=>{const e=[];cE(s)&&e.push("RENDER_LINE_DASH"),s.paint.get("line-gradient")&&e.push("RENDER_LINE_GRADIENT");const n=s.paint.get("line-trim-offset");n[0]===0&&n[1]===0||e.push("RENDER_LINE_TRIM_OFFSET"),s.paint.get("line-border-width").constantOr(1)!==0&&e.push("RENDER_LINE_BORDER");const a=s.layout.get("line-join").constantOr("miter")==="none",d=!!s.paint.get("line-pattern").constantOr(1);return a&&d&&e.push("LINE_JOIN_NONE"),e};function cE(s){const e=s.paint.get("line-dasharray").value;return e.value||e.kind!=="constant"}let ab;const uE=()=>ab||(ab={layout:nE||(nE=new $i({"line-cap":new an(yt.layout_line["line-cap"]),"line-join":new an(yt.layout_line["line-join"]),"line-miter-limit":new Zt(yt.layout_line["line-miter-limit"]),"line-round-limit":new Zt(yt.layout_line["line-round-limit"]),"line-sort-key":new an(yt.layout_line["line-sort-key"]),"line-z-offset":new an(yt.layout_line["line-z-offset"]),"line-elevation-reference":new Zt(yt.layout_line["line-elevation-reference"]),"line-cross-slope":new Zt(yt.layout_line["line-cross-slope"]),visibility:new Zt(yt.layout_line.visibility),"line-width-unit":new Zt(yt.layout_line["line-width-unit"])})),paint:rE||(rE=new $i({"line-opacity":new an(yt.paint_line["line-opacity"]),"line-color":new an(yt.paint_line["line-color"]),"line-translate":new Zt(yt.paint_line["line-translate"]),"line-translate-anchor":new Zt(yt.paint_line["line-translate-anchor"]),"line-width":new an(yt.paint_line["line-width"]),"line-gap-width":new an(yt.paint_line["line-gap-width"]),"line-offset":new an(yt.paint_line["line-offset"]),"line-blur":new an(yt.paint_line["line-blur"]),"line-dasharray":new an(yt.paint_line["line-dasharray"]),"line-pattern":new an(yt.paint_line["line-pattern"]),"line-gradient":new Qs(yt.paint_line["line-gradient"]),"line-trim-offset":new Zt(yt.paint_line["line-trim-offset"]),"line-trim-fade-range":new Zt(yt.paint_line["line-trim-fade-range"]),"line-trim-color":new Zt(yt.paint_line["line-trim-color"]),"line-emissive-strength":new Zt(yt.paint_line["line-emissive-strength"]),"line-border-width":new an(yt.paint_line["line-border-width"]),"line-border-color":new an(yt.paint_line["line-border-color"]),"line-occlusion-opacity":new Zt(yt.paint_line["line-occlusion-opacity"]),"line-color-use-theme":new an({type:"string",default:"default","property-type":"data-driven"}),"line-gradient-use-theme":new an({type:"string",default:"default","property-type":"data-driven"}),"line-trim-color-use-theme":new an({type:"string",default:"default","property-type":"data-driven"}),"line-border-color-use-theme":new an({type:"string",default:"default","property-type":"data-driven"})}))},ab);class v3 extends an{possiblyEvaluate(e,n){return n=new qr(Math.floor(n.zoom),{now:n.now,fadeDuration:n.fadeDuration,transition:n.transition}),super.possiblyEvaluate(e,n)}evaluate(e,n,a,d){return n=Lr({},n,{zoom:Math.floor(n.zoom)}),super.evaluate(e,n,a,d)}}let $g;function hE(s,e){return e>0?e+2*s:s}const x3=$r([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_tex_size",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),b3=$r([{name:"a_globe_anchor",components:3,type:"Int16"},{name:"a_globe_normal",components:3,type:"Float32"}],4),w3=$r([{name:"a_projected_pos",components:4,type:"Float32"}],4);$r([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const S3=$r([{name:"a_auto_z_offset",components:1,type:"Float32"}],4),E3=$r([{name:"a_texb",components:2,type:"Uint16"}]),T3=$r([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"},{name:"a_elevation_from_sea",components:2,type:"Float32"}]),C3=$r([{name:"a_size_scale",components:1,type:"Float32"},{name:"a_padding",components:2,type:"Float32"},{name:"a_auto_z_offset",components:1,type:"Float32"}]);$r([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"tileAnchorX"},{type:"Int16",name:"tileAnchorY"},{type:"Float32",name:"x1"},{type:"Float32",name:"y1"},{type:"Float32",name:"x2"},{type:"Float32",name:"y2"},{type:"Int16",name:"padding"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const dE=$r([{name:"a_pos",components:3,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),M3=$r([{name:"a_pos_2f",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);$r([{name:"triangle",components:3,type:"Uint16"}]),$r([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"},{type:"Uint8",name:"flipState"}]),$r([{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Float32",name:"zOffset"},{type:"Uint8",name:"hasIconTextFit"}]),$r([{type:"Float32",name:"offsetX"}]),$r([{type:"Int16",name:"x"},{type:"Int16",name:"y"}]);var za=24;const wh=128;function My(s,e,n,a,d){if(s.kind==="camera")return s.maxSize;if(s.kind==="composite"){const c=e.possiblyEvaluate(new qr(s.maxZoom),n).evaluate(d,{},n),p=e.possiblyEvaluate(new qr(s.minZoom),n).evaluate(d,{},n);return Math.max(c,p)}return e.possiblyEvaluate(new qr(a)).evaluate(d,{},n)}function lb(s,e){const{expression:n}=e;if(n.kind==="constant")return{kind:"constant",layoutSize:n.evaluate(new qr(s+1))};if(n.kind==="source")return{kind:"source"};{const{zoomStops:a,interpolationType:d}=n;let c=0;for(;c<a.length&&a[c]<=s;)c++;c=Math.max(0,c-1);let p=c;for(;p<a.length&&a[p]<s+1;)p++;p=Math.min(a.length-1,p);const w=a[c],T=a[p];return n.kind==="composite"?{kind:"composite",minZoom:w,maxZoom:T,interpolationType:d}:{kind:"camera",minZoom:w,maxZoom:T,minSize:n.evaluate(new qr(w)),maxSize:n.evaluate(new qr(T)),interpolationType:d}}}function Ay(s,{uSize:e,uSizeT:n},{lowerSize:a,upperSize:d}){return s.kind==="source"?a/wh:s.kind==="composite"?kn(a/wh,d/wh,n):e}function Im(s,e,n=1){let a=0,d=0;if(s.kind==="constant")d=s.layoutSize*n;else if(s.kind!=="source"){const{interpolationType:c,minZoom:p,maxZoom:w}=s,T=c?yn(_s.interpolationFactor(c,e,p,w),0,1):0;s.kind==="camera"?d=kn(s.minSize,s.maxSize,T)*n:a=T*n}return{uSizeT:a,uSize:d}}var A3=Object.freeze({__proto__:null,SIZE_PACK_FACTOR:wh,evaluateSizeForFeature:Ay,evaluateSizeForZoom:Im,getRasterizedIconSize:My,getSizeData:lb});function I3(s,e,n){return s.sections.forEach(a=>{a.text=function(d,c,p){const w=c.layout.get("text-transform").evaluate(p,{});return w==="uppercase"?d=d.toLocaleUpperCase():w==="lowercase"&&(d=d.toLocaleLowerCase()),Yi.applyArabicShaping&&(d=Yi.applyArabicShaping(d)),d}(a.text,e,n)}),s}const Vg={"!":"","#":"",$:"","%":"","&":"","(":"",")":"","*":"","+":"",",":"","-":"",".":"","/":"",":":"",";":"","<":"","=":"",">":"","?":"","@":"","[":"","\\":"","]":"","^":"",_:"","`":"","{":"","|":"","}":"","~":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":""};function P3(s){return s===""||s===""||s===""||s===""||s===""||s===""||s===""||s===""||s===""||s===""||s===""||s===""||s===""||s===""||s===""||s===""||s===""}function R3(s){return s===""||s===""||s===""||s===""||s===""||s===""||s===""||s===""||s===""||s===""}var fE,cb,pE,ub={};/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */function k3(){return fE||(fE=1,ub.read=function(s,e,n,a,d){var c,p,w=8*d-a-1,T=(1<<w)-1,P=T>>1,x=-7,C=n?d-1:0,A=n?-1:1,E=s[e+C];for(C+=A,c=E&(1<<-x)-1,E>>=-x,x+=w;x>0;c=256*c+s[e+C],C+=A,x-=8);for(p=c&(1<<-x)-1,c>>=-x,x+=a;x>0;p=256*p+s[e+C],C+=A,x-=8);if(c===0)c=1-P;else{if(c===T)return p?NaN:1/0*(E?-1:1);p+=Math.pow(2,a),c-=P}return(E?-1:1)*p*Math.pow(2,c-a)},ub.write=function(s,e,n,a,d,c){var p,w,T,P=8*c-d-1,x=(1<<P)-1,C=x>>1,A=d===23?Math.pow(2,-24)-Math.pow(2,-77):0,E=a?0:c-1,M=a?1:-1,k=e<0||e===0&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(w=isNaN(e)?1:0,p=x):(p=Math.floor(Math.log(e)/Math.LN2),e*(T=Math.pow(2,-p))<1&&(p--,T*=2),(e+=p+C>=1?A/T:A*Math.pow(2,1-C))*T>=2&&(p++,T/=2),p+C>=x?(w=0,p=x):p+C>=1?(w=(e*T-1)*Math.pow(2,d),p+=C):(w=e*Math.pow(2,C-1)*Math.pow(2,d),p=0));d>=8;s[n+E]=255&w,E+=M,w/=256,d-=8);for(p=p<<d|w,P+=d;P>0;s[n+E]=255&p,E+=M,p/=256,P-=8);s[n+E-M]|=128*k}),ub}function mE(){if(pE)return cb;pE=1,cb=e;var s=k3();function e(W){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(W)?W:new Uint8Array(W||0),this.pos=0,this.type=0,this.length=this.buf.length}e.Varint=0,e.Fixed64=1,e.Bytes=2,e.Fixed32=5;var n=4294967296,a=1/n,d=typeof TextDecoder>"u"?null:new TextDecoder("utf8");function c(W){return W.type===e.Bytes?W.readVarint()+W.pos:W.pos+1}function p(W,J,ne){return ne?4294967296*J+(W>>>0):4294967296*(J>>>0)+(W>>>0)}function w(W,J,ne){var he=J<=16383?1:J<=2097151?2:J<=268435455?3:Math.floor(Math.log(J)/(7*Math.LN2));ne.realloc(he);for(var we=ne.pos-1;we>=W;we--)ne.buf[we+he]=ne.buf[we]}function T(W,J){for(var ne=0;ne<W.length;ne++)J.writeVarint(W[ne])}function P(W,J){for(var ne=0;ne<W.length;ne++)J.writeSVarint(W[ne])}function x(W,J){for(var ne=0;ne<W.length;ne++)J.writeFloat(W[ne])}function C(W,J){for(var ne=0;ne<W.length;ne++)J.writeDouble(W[ne])}function A(W,J){for(var ne=0;ne<W.length;ne++)J.writeBoolean(W[ne])}function E(W,J){for(var ne=0;ne<W.length;ne++)J.writeFixed32(W[ne])}function M(W,J){for(var ne=0;ne<W.length;ne++)J.writeSFixed32(W[ne])}function k(W,J){for(var ne=0;ne<W.length;ne++)J.writeFixed64(W[ne])}function N(W,J){for(var ne=0;ne<W.length;ne++)J.writeSFixed64(W[ne])}function j(W,J){return(W[J]|W[J+1]<<8|W[J+2]<<16)+16777216*W[J+3]}function q(W,J,ne){W[ne]=J,W[ne+1]=J>>>8,W[ne+2]=J>>>16,W[ne+3]=J>>>24}function X(W,J){return(W[J]|W[J+1]<<8|W[J+2]<<16)+(W[J+3]<<24)}return e.prototype={destroy:function(){this.buf=null},readFields:function(W,J,ne){for(ne=ne||this.length;this.pos<ne;){var he=this.readVarint(),we=he>>3,be=this.pos;this.type=7&he,W(we,J,this),this.pos===be&&this.skip(he)}return J},readMessage:function(W,J){return this.readFields(W,J,this.readVarint()+this.pos)},readFixed32:function(){var W=j(this.buf,this.pos);return this.pos+=4,W},readSFixed32:function(){var W=X(this.buf,this.pos);return this.pos+=4,W},readFixed64:function(){var W=j(this.buf,this.pos)+j(this.buf,this.pos+4)*n;return this.pos+=8,W},readSFixed64:function(){var W=j(this.buf,this.pos)+X(this.buf,this.pos+4)*n;return this.pos+=8,W},readFloat:function(){var W=s.read(this.buf,this.pos,!0,23,4);return this.pos+=4,W},readDouble:function(){var W=s.read(this.buf,this.pos,!0,52,8);return this.pos+=8,W},readVarint:function(W){var J,ne,he=this.buf;return J=127&(ne=he[this.pos++]),ne<128?J:(J|=(127&(ne=he[this.pos++]))<<7,ne<128?J:(J|=(127&(ne=he[this.pos++]))<<14,ne<128?J:(J|=(127&(ne=he[this.pos++]))<<21,ne<128?J:function(we,be,ve){var Be,Me,Ue=ve.buf;if(Be=(112&(Me=Ue[ve.pos++]))>>4,Me<128||(Be|=(127&(Me=Ue[ve.pos++]))<<3,Me<128)||(Be|=(127&(Me=Ue[ve.pos++]))<<10,Me<128)||(Be|=(127&(Me=Ue[ve.pos++]))<<17,Me<128)||(Be|=(127&(Me=Ue[ve.pos++]))<<24,Me<128)||(Be|=(1&(Me=Ue[ve.pos++]))<<31,Me<128))return p(we,Be,be);throw new Error("Expected varint not more than 10 bytes")}(J|=(15&(ne=he[this.pos]))<<28,W,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var W=this.readVarint();return W%2==1?(W+1)/-2:W/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var W=this.readVarint()+this.pos,J=this.pos;return this.pos=W,W-J>=12&&d?function(ne,he,we){return d.decode(ne.subarray(he,we))}(this.buf,J,W):function(ne,he,we){for(var be="",ve=he;ve<we;){var Be,Me,Ue,Ye=ne[ve],Xe=null,Je=Ye>239?4:Ye>223?3:Ye>191?2:1;if(ve+Je>we)break;Je===1?Ye<128&&(Xe=Ye):Je===2?(192&(Be=ne[ve+1]))==128&&(Xe=(31&Ye)<<6|63&Be)<=127&&(Xe=null):Je===3?(Me=ne[ve+2],(192&(Be=ne[ve+1]))==128&&(192&Me)==128&&((Xe=(15&Ye)<<12|(63&Be)<<6|63&Me)<=2047||Xe>=55296&&Xe<=57343)&&(Xe=null)):Je===4&&(Me=ne[ve+2],Ue=ne[ve+3],(192&(Be=ne[ve+1]))==128&&(192&Me)==128&&(192&Ue)==128&&((Xe=(15&Ye)<<18|(63&Be)<<12|(63&Me)<<6|63&Ue)<=65535||Xe>=1114112)&&(Xe=null)),Xe===null?(Xe=65533,Je=1):Xe>65535&&(Xe-=65536,be+=String.fromCharCode(Xe>>>10&1023|55296),Xe=56320|1023&Xe),be+=String.fromCharCode(Xe),ve+=Je}return be}(this.buf,J,W)},readBytes:function(){var W=this.readVarint()+this.pos,J=this.buf.subarray(this.pos,W);return this.pos=W,J},readPackedVarint:function(W,J){if(this.type!==e.Bytes)return W.push(this.readVarint(J));var ne=c(this);for(W=W||[];this.pos<ne;)W.push(this.readVarint(J));return W},readPackedSVarint:function(W){if(this.type!==e.Bytes)return W.push(this.readSVarint());var J=c(this);for(W=W||[];this.pos<J;)W.push(this.readSVarint());return W},readPackedBoolean:function(W){if(this.type!==e.Bytes)return W.push(this.readBoolean());var J=c(this);for(W=W||[];this.pos<J;)W.push(this.readBoolean());return W},readPackedFloat:function(W){if(this.type!==e.Bytes)return W.push(this.readFloat());var J=c(this);for(W=W||[];this.pos<J;)W.push(this.readFloat());return W},readPackedDouble:function(W){if(this.type!==e.Bytes)return W.push(this.readDouble());var J=c(this);for(W=W||[];this.pos<J;)W.push(this.readDouble());return W},readPackedFixed32:function(W){if(this.type!==e.Bytes)return W.push(this.readFixed32());var J=c(this);for(W=W||[];this.pos<J;)W.push(this.readFixed32());return W},readPackedSFixed32:function(W){if(this.type!==e.Bytes)return W.push(this.readSFixed32());var J=c(this);for(W=W||[];this.pos<J;)W.push(this.readSFixed32());return W},readPackedFixed64:function(W){if(this.type!==e.Bytes)return W.push(this.readFixed64());var J=c(this);for(W=W||[];this.pos<J;)W.push(this.readFixed64());return W},readPackedSFixed64:function(W){if(this.type!==e.Bytes)return W.push(this.readSFixed64());var J=c(this);for(W=W||[];this.pos<J;)W.push(this.readSFixed64());return W},skip:function(W){var J=7&W;if(J===e.Varint)for(;this.buf[this.pos++]>127;);else if(J===e.Bytes)this.pos=this.readVarint()+this.pos;else if(J===e.Fixed32)this.pos+=4;else{if(J!==e.Fixed64)throw new Error("Unimplemented type: "+J);this.pos+=8}},writeTag:function(W,J){this.writeVarint(W<<3|J)},realloc:function(W){for(var J=this.length||16;J<this.pos+W;)J*=2;if(J!==this.length){var ne=new Uint8Array(J);ne.set(this.buf),this.buf=ne,this.length=J}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(W){this.realloc(4),q(this.buf,W,this.pos),this.pos+=4},writeSFixed32:function(W){this.realloc(4),q(this.buf,W,this.pos),this.pos+=4},writeFixed64:function(W){this.realloc(8),q(this.buf,-1&W,this.pos),q(this.buf,Math.floor(W*a),this.pos+4),this.pos+=8},writeSFixed64:function(W){this.realloc(8),q(this.buf,-1&W,this.pos),q(this.buf,Math.floor(W*a),this.pos+4),this.pos+=8},writeVarint:function(W){(W=+W||0)>268435455||W<0?function(J,ne){var he,we;if(J>=0?(he=J%4294967296|0,we=J/4294967296|0):(we=~(-J/4294967296),4294967295^(he=~(-J%4294967296))?he=he+1|0:(he=0,we=we+1|0)),J>=18446744073709552e3||J<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");ne.realloc(10),function(be,ve,Be){Be.buf[Be.pos++]=127&be|128,be>>>=7,Be.buf[Be.pos++]=127&be|128,be>>>=7,Be.buf[Be.pos++]=127&be|128,be>>>=7,Be.buf[Be.pos++]=127&be|128,Be.buf[Be.pos]=127&(be>>>=7)}(he,0,ne),function(be,ve){var Be=(7&be)<<4;ve.buf[ve.pos++]|=Be|((be>>>=3)?128:0),be&&(ve.buf[ve.pos++]=127&be|((be>>>=7)?128:0),be&&(ve.buf[ve.pos++]=127&be|((be>>>=7)?128:0),be&&(ve.buf[ve.pos++]=127&be|((be>>>=7)?128:0),be&&(ve.buf[ve.pos++]=127&be|((be>>>=7)?128:0),be&&(ve.buf[ve.pos++]=127&be)))))}(we,ne)}(W,this):(this.realloc(4),this.buf[this.pos++]=127&W|(W>127?128:0),W<=127||(this.buf[this.pos++]=127&(W>>>=7)|(W>127?128:0),W<=127||(this.buf[this.pos++]=127&(W>>>=7)|(W>127?128:0),W<=127||(this.buf[this.pos++]=W>>>7&127))))},writeSVarint:function(W){this.writeVarint(W<0?2*-W-1:2*W)},writeBoolean:function(W){this.writeVarint(!!W)},writeString:function(W){W=String(W),this.realloc(4*W.length),this.pos++;var J=this.pos;this.pos=function(he,we,be){for(var ve,Be,Me=0;Me<we.length;Me++){if((ve=we.charCodeAt(Me))>55295&&ve<57344){if(!Be){ve>56319||Me+1===we.length?(he[be++]=239,he[be++]=191,he[be++]=189):Be=ve;continue}if(ve<56320){he[be++]=239,he[be++]=191,he[be++]=189,Be=ve;continue}ve=Be-55296<<10|ve-56320|65536,Be=null}else Be&&(he[be++]=239,he[be++]=191,he[be++]=189,Be=null);ve<128?he[be++]=ve:(ve<2048?he[be++]=ve>>6|192:(ve<65536?he[be++]=ve>>12|224:(he[be++]=ve>>18|240,he[be++]=ve>>12&63|128),he[be++]=ve>>6&63|128),he[be++]=63&ve|128)}return be}(this.buf,W,this.pos);var ne=this.pos-J;ne>=128&&w(J,ne,this),this.pos=J-1,this.writeVarint(ne),this.pos+=ne},writeFloat:function(W){this.realloc(4),s.write(this.buf,W,this.pos,!0,23,4),this.pos+=4},writeDouble:function(W){this.realloc(8),s.write(this.buf,W,this.pos,!0,52,8),this.pos+=8},writeBytes:function(W){var J=W.length;this.writeVarint(J),this.realloc(J);for(var ne=0;ne<J;ne++)this.buf[this.pos++]=W[ne]},writeRawMessage:function(W,J){this.pos++;var ne=this.pos;W(J,this);var he=this.pos-ne;he>=128&&w(ne,he,this),this.pos=ne-1,this.writeVarint(he),this.pos+=he},writeMessage:function(W,J,ne){this.writeTag(W,e.Bytes),this.writeRawMessage(J,ne)},writePackedVarint:function(W,J){J.length&&this.writeMessage(W,T,J)},writePackedSVarint:function(W,J){J.length&&this.writeMessage(W,P,J)},writePackedBoolean:function(W,J){J.length&&this.writeMessage(W,A,J)},writePackedFloat:function(W,J){J.length&&this.writeMessage(W,x,J)},writePackedDouble:function(W,J){J.length&&this.writeMessage(W,C,J)},writePackedFixed32:function(W,J){J.length&&this.writeMessage(W,E,J)},writePackedSFixed32:function(W,J){J.length&&this.writeMessage(W,M,J)},writePackedFixed64:function(W,J){J.length&&this.writeMessage(W,k,J)},writePackedSFixed64:function(W,J){J.length&&this.writeMessage(W,N,J)},writeBytesField:function(W,J){this.writeTag(W,e.Bytes),this.writeBytes(J)},writeFixed32Field:function(W,J){this.writeTag(W,e.Fixed32),this.writeFixed32(J)},writeSFixed32Field:function(W,J){this.writeTag(W,e.Fixed32),this.writeSFixed32(J)},writeFixed64Field:function(W,J){this.writeTag(W,e.Fixed64),this.writeFixed64(J)},writeSFixed64Field:function(W,J){this.writeTag(W,e.Fixed64),this.writeSFixed64(J)},writeVarintField:function(W,J){this.writeTag(W,e.Varint),this.writeVarint(J)},writeSVarintField:function(W,J){this.writeTag(W,e.Varint),this.writeSVarint(J)},writeStringField:function(W,J){this.writeTag(W,e.Bytes),this.writeString(J)},writeFloatField:function(W,J){this.writeTag(W,e.Fixed32),this.writeFloat(J)},writeDoubleField:function(W,J){this.writeTag(W,e.Fixed64),this.writeDouble(J)},writeBooleanField:function(W,J){this.writeVarintField(W,!!J)}},cb}var Iy=H(mE());const hb=3;function z3(s,e,n){e.glyphs=[],s===1&&n.readMessage(L3,e)}function L3(s,e,n){if(s===3){const{id:a,bitmap:d,width:c,height:p,left:w,top:T,advance:P}=n.readMessage(O3,{});e.glyphs.push({id:a,bitmap:new ju({width:c+2*hb,height:p+2*hb},d),metrics:{width:c,height:p,left:w,top:T,advance:P}})}else s===4?e.ascender=n.readSVarint():s===5&&(e.descender=n.readSVarint())}function O3(s,e,n){s===1?e.id=n.readVarint():s===2?e.bitmap=n.readBytes():s===3?e.width=n.readVarint():s===4?e.height=n.readVarint():s===5?e.left=n.readSVarint():s===6?e.top=n.readSVarint():s===7&&(e.advance=n.readVarint())}const D3=hb,hu={horizontal:1,vertical:2,horizontalOnly:3};class Ug{constructor(){this.scale=1,this.fontStack="",this.image=null}static forText(e,n){const a=new Ug;return a.scale=e||1,a.fontStack=n,a}static forImage(e){const n=new Ug;return n.image=e,n}}class Pm{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(e,n){const a=new Pm;for(let d=0;d<e.sections.length;d++){const c=e.sections[d];c.image?a.addImageSection(c):a.addTextSection(c,n)}return a}length(){return this.text.length}getSection(e){return this.sections[this.sectionIndex[e]]}getSections(){return this.sections}getSectionIndex(e){return this.sectionIndex[e]}getCodePoint(e){return this.text.codePointAt(e)}verticalizePunctuation(e){this.text=function(n,a){let d="";for(let c=0;c<n.length;c++){const p=n.charCodeAt(c+1)||null,w=n.charCodeAt(c-1)||null;d+=!a&&(p&&er(p)&&!Vg[n[c+1]]||w&&er(w)&&!Vg[n[c-1]])||!Vg[n[c]]?n[c]:Vg[n[c]]}return d}(this.text,e)}trim(){let e=0;for(let a=0;a<this.text.length&&Py[this.text.charCodeAt(a)];a++)e++;let n=this.text.length;for(let a=this.text.length-1;a>=0&&a>=e&&Py[this.text.charCodeAt(a)];a--)n--;this.text=this.text.substring(e,n),this.sectionIndex=this.sectionIndex.slice(e,n)}substring(e,n){const a=new Pm;return a.text=this.text.substring(e,n),a.sectionIndex=this.sectionIndex.slice(e,n),a.sections=this.sections,a}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((e,n)=>Math.max(e,this.sections[n].scale),0)}addTextSection(e,n){this.text+=e.text,this.sections.push(Ug.forText(e.scale,e.fontStack||n));const a=this.sections.length-1;for(let d=0;d<e.text.length;++d)this.sectionIndex.push(a)}addImageSection(e){const n=e.image&&e.image.namePrimary?e.image.getPrimary():null;if(!n)return void nr("Can't add FormattedSection with an empty image.");const a=this.getNextImageSectionCharCode();a?(this.text+=String.fromCodePoint(a),this.sections.push(Ug.forImage(n)),this.sectionIndex.push(this.sections.length-1)):nr("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function db(s,e,n,a,d,c,p,w,T,P,x,C,A,E,M){const k=Pm.fromFeature(s,d);C===hu.vertical&&k.verticalizePunctuation(A);let N=[];const j=function(ne,he,we,be,ve,Be){if(!ne)return[];const Me=[],Ue=function(st,pt,ot,It,tn,Lt){let un=0;for(let cn=0;cn<st.length();cn++){const vn=st.getSection(cn);un+=gE(st.getCodePoint(cn),vn,It,tn,pt,Lt)}return un/Math.max(1,Math.ceil(un/ot))}(ne,he,we,be,ve,Be),Ye=ne.text.indexOf("")>=0;let Xe=0;for(let st=0;st<ne.length();st++){const pt=ne.getSection(st),ot=ne.getCodePoint(st);if(Py[ot]||(Xe+=gE(ot,pt,be,ve,he,Be)),st<ne.length()-1){const It=!((Je=ot)<11904||!(Xt["Bopomofo Extended"](Je)||Xt.Bopomofo(Je)||Xt["CJK Compatibility Forms"](Je)||Xt["CJK Compatibility Ideographs"](Je)||Xt["CJK Compatibility"](Je)||Xt["CJK Radicals Supplement"](Je)||Xt["CJK Strokes"](Je)||Xt["CJK Symbols and Punctuation"](Je)||Xt["CJK Unified Ideographs Extension A"](Je)||Xt["CJK Unified Ideographs"](Je)||Xt["Enclosed CJK Letters and Months"](Je)||Xt["Halfwidth and Fullwidth Forms"](Je)||Xt.Hiragana(Je)||Xt["Ideographic Description Characters"](Je)||Xt["Kangxi Radicals"](Je)||Xt["Katakana Phonetic Extensions"](Je)||Xt.Katakana(Je)||Xt["Vertical Forms"](Je)||Xt["Yi Radicals"](Je)||Xt["Yi Syllables"](Je)));(F3[ot]||It||pt.image)&&Me.push(yE(st+1,Xe,Ue,Me,B3(ot,ne.getCodePoint(st+1),It&&Ye),!1))}}var Je;return vE(yE(ne.length(),Xe,Ue,Me,0,!0))}(k,P,c,e,a,E),{processBidirectionalText:q,processStyledBidirectionalText:X}=Yi;if(q&&k.sections.length===1){const ne=q(k.toString(),j);for(const he of ne){const we=new Pm;we.text=he,we.sections=k.sections;for(let be=0;be<he.length;be++)we.sectionIndex.push(0);N.push(we)}}else if(X){const ne=X(k.text,k.sectionIndex,j);for(const he of ne){const we=new Pm;we.text=he[0],we.sectionIndex=he[1],we.sections=k.sections,N.push(we)}}else N=function(ne,he){const we=[],be=ne.text;let ve=0;for(const Be of he)we.push(ne.substring(ve,Be)),ve=Be;return ve<be.length&&we.push(ne.substring(ve,be.length)),we}(k,j);const W=[],J={positionedLines:W,text:k.toString(),top:x[1],bottom:x[1],left:x[0],right:x[0],writingMode:C,iconsInText:!1,verticalizable:!1,hasBaseline:!1};return function(ne,he,we,be,ve,Be,Me,Ue,Ye,Xe,Je,st){let pt=0,ot=0,It=0;const tn=Ue==="right"?1:Ue==="left"?0:.5;let Lt=!1;for(const dn of ve){const Cn=dn.getSections();for(const Zn of Cn){if(Zn.image)continue;const xr=he[Zn.fontStack];if(xr&&(Lt=xr.ascender!==void 0&&xr.descender!==void 0,!Lt))break}if(!Lt)break}let un=0;for(const dn of ve){dn.trim();const Cn=dn.getMaxScale(),Zn=(Cn-1)*za,xr={positionedGlyphs:[],lineOffset:0};ne.positionedLines[un]=xr;const Cr=xr.positionedGlyphs;let Or=0;if(!dn.length()){ot+=Be,++un;continue}let Mr=0,Zr=0;for(let Mi=0;Mi<dn.length();Mi++){const hr=dn.getSection(Mi),Ai=dn.getSectionIndex(Mi),Ti=dn.getCodePoint(Mi);let Ni=hr.scale,ws=null,Ss=null,qo=null,Zl=za,fo=0;const bo=!(Ye===hu.horizontal||!Je&&!cr(Ti)||Je&&(Py[Ti]||(cn=Ti,Xt.Arabic(cn)||Xt["Arabic Supplement"](cn)||Xt["Arabic Extended-A"](cn)||Xt["Arabic Presentation Forms-A"](cn)||Xt["Arabic Presentation Forms-B"](cn))));if(hr.image){const Tl=be[hr.image.serialize()];if(!Tl)continue;qo=hr.image.id,ne.iconsInText=ne.iconsInText||!0,Ss=Tl.paddedRect;const Es=Tl.displaySize;Ni=Ni*za/st,ws={width:Es[0],height:Es[1],left:0,top:-3,advance:bo?Es[1]:Es[0],localGlyph:!1},fo=Lt?-ws.height*Ni:Cn*za-17-Es[1]*Ni,Zl=ws.advance;const fc=(bo?Es[0]:Es[1])*Ni-za*Cn;fc>0&&fc>Or&&(Or=fc)}else{const Tl=we[hr.fontStack];if(!Tl)continue;Tl[Ti]&&(Ss=Tl[Ti]);const Es=he[hr.fontStack];if(!Es)continue;const fc=Es.glyphs[Ti];if(!fc)continue;if(ws=fc.metrics,Zl=Ti!==8203?za:0,Lt){const js=Es.ascender!==void 0?Math.abs(Es.ascender):0,gd=Es.descender!==void 0?Math.abs(Es.descender):0,Yf=(js+gd)*Ni;Mr<Yf&&(Mr=Yf,Zr=(js-gd)/2*Ni),fo=-js*Ni}else fo=(Cn-Ni)*za-17}bo?(ne.verticalizable=!0,Cr.push({glyph:Ti,imageName:qo,x:pt,y:ot+fo,vertical:bo,scale:Ni,localGlyph:ws.localGlyph,fontStack:hr.fontStack,sectionIndex:Ai,metrics:ws,rect:Ss}),pt+=Zl*Ni+Xe):(Cr.push({glyph:Ti,imageName:qo,x:pt,y:ot+fo,vertical:bo,scale:Ni,localGlyph:ws.localGlyph,fontStack:hr.fontStack,sectionIndex:Ai,metrics:ws,rect:Ss}),pt+=ws.advance*Ni+Xe)}Cr.length!==0&&(It=Math.max(pt-Xe,It),Lt?xE(Cr,tn,Or,Zr,Be*Cn/2):xE(Cr,tn,Or,0,Be/2)),pt=0;const Bi=Be*Cn+Or;xr.lineOffset=Math.max(Or,Zn),ot+=Bi,++un}var cn;const vn=ot,{horizontalAlign:Bt,verticalAlign:Pn}=fb(Me);(function(dn,Cn,Zn,xr,Cr,Or){const Mr=(Cn-Zn)*Cr,Zr=-Or*xr;for(const Bi of dn)for(const Mi of Bi.positionedGlyphs)Mi.x+=Mr,Mi.y+=Zr})(ne.positionedLines,tn,Bt,Pn,It,vn),ne.top+=-Pn*vn,ne.bottom=ne.top+vn,ne.left+=-Bt*It,ne.right=ne.left+It,ne.hasBaseline=Lt}(J,e,n,a,N,p,w,T,C,P,A,M),!function(ne){for(const he of ne)if(he.positionedGlyphs.length!==0)return!1;return!0}(W)&&J}const Py={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},F3={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function gE(s,e,n,a,d,c){if(e.image){const p=a[e.image.serialize()];return p?p.displaySize[0]*e.scale*za/c+d:0}{const p=n[e.fontStack],w=p&&p.glyphs[s];return w?w.metrics.advance*e.scale+d:0}}function _E(s,e,n,a){const d=Math.pow(s-e,2);return a?s<e?d/2:2*d:d+Math.abs(n)*n}function B3(s,e,n){let a=0;return s===10&&(a-=1e4),n&&(a+=150),s!==40&&s!==65288||(a+=50),e!==41&&e!==65289||(a+=50),a}function yE(s,e,n,a,d,c){let p=null,w=_E(e,n,d,c);for(const T of a){const P=_E(e-T.x,n,d,c)+T.badness;P<=w&&(p=T,w=P)}return{index:s,x:e,priorBreak:p,badness:w}}function vE(s){return s?vE(s.priorBreak).concat(s.index):[]}function fb(s){let e=.5,n=.5;switch(s){case"right":case"top-right":case"bottom-right":e=1;break;case"left":case"top-left":case"bottom-left":e=0}switch(s){case"bottom":case"bottom-right":case"bottom-left":n=1;break;case"top":case"top-right":case"top-left":n=0}return{horizontalAlign:e,verticalAlign:n}}function xE(s,e,n,a,d){if(!(e||n||a||d))return;const c=s.length-1,p=s[c],w=(p.x+p.metrics.advance*p.scale)*e;for(let T=0;T<=c;T++)s[T].x-=w,s[T].y+=n+a+d}function N3(s,e,n,a){const{horizontalAlign:d,verticalAlign:c}=fb(a),p=n[0]-s.displaySize[0]*d,w=n[1]-s.displaySize[1]*c;return{imagePrimary:s,imageSecondary:e,top:w,bottom:w+s.displaySize[1],left:p,right:p+s.displaySize[0]}}function bE(s,e,n,a,d,c){const p=s.imagePrimary;let w;if(p.content){const N=p.content,j=p.pixelRatio||1;w=[N[0]/j,N[1]/j,p.displaySize[0]-N[2]/j,p.displaySize[1]-N[3]/j]}const T=e.left*c,P=e.right*c;let x,C,A,E;n==="width"||n==="both"?(E=d[0]+T-a[3],C=d[0]+P+a[1]):(E=d[0]+(T+P-p.displaySize[0])/2,C=E+p.displaySize[0]);const M=e.top*c,k=e.bottom*c;return n==="height"||n==="both"?(x=d[1]+M-a[0],A=d[1]+k+a[2]):(x=d[1]+(M+k-p.displaySize[1])/2,A=x+p.displaySize[1]),{imagePrimary:p,imageSecondary:void 0,top:x,right:C,bottom:A,left:E,collisionPadding:w}}class lf extends Ht{constructor(e,n,a,d,c){super(e,n),this.angle=d,this.z=a,c!==void 0&&(this.segment=c)}clone(){return new lf(this.x,this.y,this.z,this.angle,this.segment)}}function wE(s,e,n,a,d){if(e.segment===void 0)return!0;let c=e,p=e.segment+1,w=0;for(;w>-n/2;){if(p--,p<0)return!1;w-=s[p].dist(c),c=s[p]}w+=s[p].dist(s[p+1]),p++;const T=[];let P=0;for(;w<n/2;){const x=s[p],C=s[p+1];if(!C)return!1;let A=s[p-1].angleTo(x)-x.angleTo(C);for(A=Math.abs((A+3*Math.PI)%(2*Math.PI)-Math.PI),T.push({distance:w,angleDelta:A}),P+=A;w-T[0].distance>a;)P-=T.shift().angleDelta;if(P>d)return!1;p++,w+=x.dist(C)}return!0}function SE(s){let e=0;for(let n=0;n<s.length-1;n++)e+=s[n].dist(s[n+1]);return e}function EE(s,e,n){return s?.6*e*n:0}function TE(s,e){return Math.max(s?s.right-s.left:0,e?e.right-e.left:0)}function j3(s,e,n,a,d,c){const p=EE(n,d,c),w=TE(n,a)*c;let T=0;const P=SE(s)/2;for(let x=0;x<s.length-1;x++){const C=s[x],A=s[x+1],E=C.dist(A);if(T+E>P){const M=(P-T)/E,k=kn(C.x,A.x,M),N=kn(C.y,A.y,M),j=new lf(k,N,0,A.angleTo(C),x);return!p||wE(s,j,w,p,e)?j:void 0}T+=E}}function $3(s,e,n,a,d,c,p,w,T){const P=EE(a,c,p),x=TE(a,d),C=x*p,A=s[0].x===0||s[0].x===T||s[0].y===0||s[0].y===T;return e-C<e/4&&(e=C+e/4),CE(s,A?e/2*w%e:(x/2+2*c)*p*w%e,e,P,n,C,A,!1,T)}function CE(s,e,n,a,d,c,p,w,T){const P=c/2,x=SE(s);let C=0,A=e-n,E=[];for(let M=0;M<s.length-1;M++){const k=s[M],N=s[M+1],j=k.dist(N),q=N.angleTo(k);for(;A+n<C+j;){A+=n;const X=(A-C)/j,W=kn(k.x,N.x,X),J=kn(k.y,N.y,X);if(W>=0&&W<T&&J>=0&&J<T&&A-P>=0&&A+P<=x){const ne=new lf(W,J,0,q,M);a&&!wE(s,ne,c,a,d)||E.push(ne)}}C+=j}return w||E.length||p||(E=CE(s,C/2,n,a,d,c,p,!0,T)),E}function ME(s,e,n,a,d){const c=[];for(let p=0;p<s.length;p++){const w=s[p];let T;for(let P=0;P<w.length-1;P++){let x=w[P],C=w[P+1];x.x<e&&C.x<e||(x.x<e?x=new Ht(e,x.y+(e-x.x)/(C.x-x.x)*(C.y-x.y))._round():C.x<e&&(C=new Ht(e,x.y+(e-x.x)/(C.x-x.x)*(C.y-x.y))._round()),x.y<n&&C.y<n||(x.y<n?x=new Ht(x.x+(n-x.y)/(C.y-x.y)*(C.x-x.x),n)._round():C.y<n&&(C=new Ht(x.x+(n-x.y)/(C.y-x.y)*(C.x-x.x),n)._round()),x.x>=a&&C.x>=a||(x.x>=a?x=new Ht(a,x.y+(a-x.x)/(C.x-x.x)*(C.y-x.y))._round():C.x>=a&&(C=new Ht(a,x.y+(a-x.x)/(C.x-x.x)*(C.y-x.y))._round()),x.y>=d&&C.y>=d||(x.y>=d?x=new Ht(x.x+(d-x.y)/(C.y-x.y)*(C.x-x.x),d)._round():C.y>=d&&(C=new Ht(x.x+(d-x.y)/(C.y-x.y)*(C.x-x.x),d)._round()),T&&x.equals(T[T.length-1])||(T=[x],c.push(T)),T.push(C)))))}}return c}function AE(s){let e=0,n=0;for(const p of s)e+=p.w*p.h,n=Math.max(n,p.w);s.sort((p,w)=>w.h-p.h);const a=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(e/.95)),n),h:1/0}];let d=0,c=0;for(const p of s)for(let w=a.length-1;w>=0;w--){const T=a[w];if(!(p.w>T.w||p.h>T.h)){if(p.x=T.x,p.y=T.y,c=Math.max(c,p.y+p.h),d=Math.max(d,p.x+p.w),p.w===T.w&&p.h===T.h){const P=a.pop();w<a.length&&(a[w]=P)}else p.h===T.h?(T.x+=p.w,T.w-=p.w):p.w===T.w?(T.y+=p.h,T.h-=p.h):(a.push({x:T.x+p.w,y:T.y,w:T.w-p.w,h:p.h}),T.y+=p.h,T.h-=p.h);break}}return{w:d,h:c,fill:e/(d*c)||0}}qe(lf,"Anchor");const Hg=1;class pb{constructor(e,{pixelRatio:n,version:a,stretchX:d,stretchY:c,content:p},w){this.paddedRect=e,this.pixelRatio=n,this.stretchX=d,this.stretchY=c,this.content=p,this.version=a,this.padding=w}get tl(){return[this.paddedRect.x+this.padding,this.paddedRect.y+this.padding]}get br(){return[this.paddedRect.x+this.paddedRect.w-this.padding,this.paddedRect.y+this.paddedRect.h-this.padding]}get displaySize(){return[(this.paddedRect.w-2*this.padding)/this.pixelRatio,(this.paddedRect.h-2*this.padding)/this.pixelRatio]}}class IE{constructor(e,n,a){const d={},c={};this.haveRenderCallbacks=[];const p=[];this.addImages(e,d,Hg,p),this.addImages(n,c,2,p);const{w,h:T}=AE(p),P=new ma({width:w||1,height:T||1});for(const x in e){const C=e[x],A=d[x].paddedRect;ma.copy(C.data,P,{x:0,y:0},{x:A.x+Hg,y:A.y+Hg},C.data,a,C.sdf)}for(const x in n){const C=n[x],A=c[x].paddedRect;let E=c[x].padding;const M=A.x+E,k=A.y+E,N=C.data.width,j=C.data.height;E=E>1?E-1:E,ma.copy(C.data,P,{x:0,y:0},{x:M,y:k},C.data,a),ma.copy(C.data,P,{x:0,y:j-E},{x:M,y:k-E},{width:N,height:E},a),ma.copy(C.data,P,{x:0,y:0},{x:M,y:k+j},{width:N,height:E},a),ma.copy(C.data,P,{x:N-E,y:0},{x:M-E,y:k},{width:E,height:j},a),ma.copy(C.data,P,{x:0,y:0},{x:M+N,y:k},{width:E,height:j},a),ma.copy(C.data,P,{x:N-E,y:j-E},{x:M-E,y:k-E},{width:E,height:E},a),ma.copy(C.data,P,{x:0,y:j-E},{x:M+N,y:k-E},{width:E,height:E},a),ma.copy(C.data,P,{x:0,y:0},{x:M+N,y:k+j},{width:E,height:E},a),ma.copy(C.data,P,{x:N-E,y:0},{x:M-E,y:k+j},{width:E,height:E},a)}this.image=P,this.iconPositions=d,this.patternPositions=c}addImages(e,n,a,d){for(const c in e){const p=e[c],w={x:0,y:0,w:p.data.width+2*a,h:p.data.height+2*a};d.push(w),n[c]=new pb(w,p,a),p.hasRenderCallback&&this.haveRenderCallbacks.push(sa.deserializeId(c))}}patchUpdatedImages(e,n,a){this.haveRenderCallbacks=this.haveRenderCallbacks.filter(d=>e.hasImage(d,a)),e.dispatchRenderCallbacks(this.haveRenderCallbacks,a);for(const d in e.getUpdatedImages(a)){for(const c of Object.keys(this.iconPositions))sa.deserializeId(c)===d&&this.patchUpdatedImage(this.iconPositions[c],e.getImage(d,a),n);for(const c of Object.keys(this.patternPositions))sa.deserializeId(c)===d&&this.patchUpdatedImage(this.patternPositions[c],e.getImage(d,a),n)}}patchUpdatedImage(e,n,a){if(!e||!n||e.version===n.version)return;e.version=n.version;const[d,c]=e.tl;a.update(n.data,{position:{x:d,y:c}})}}qe(pb,"ImagePosition"),qe(IE,"ImageAtlas");const Ry=1e20;function PE(s,e,n,a,d,c,p,w,T){for(let P=e;P<e+a;P++)RE(s,n*c+P,c,d,p,w,T);for(let P=n;P<n+d;P++)RE(s,P*c+e,1,a,p,w,T)}function RE(s,e,n,a,d,c,p){c[0]=0,p[0]=-1e20,p[1]=Ry,d[0]=s[e];for(let w=1,T=0,P=0;w<a;w++){d[w]=s[e+w*n];const x=w*w;do{const C=c[T];P=(d[w]-d[C]+x-C*C)/(w-C)/2}while(P<=p[T]&&--T>-1);T++,c[T]=w,p[T]=P,p[T+1]=Ry}for(let w=0,T=0;w<a;w++){for(;p[T+1]<w;)T++;const P=c[T],x=w-P;s[e+w*n]=d[P]+x*x}}const Sh=2,mb={none:0,ideographs:1,all:2};class Rm{constructor(e,n,a){this.requestManager=e,this.localGlyphMode=n,this.localFontFamily=a,this.urls={},this.entries={},this.localGlyphs={200:{},400:{},500:{},900:{}}}setURL(e,n){this.urls[n]=e}getGlyphs(e,n,a){const d=[],c=this.urls[n]||Se.GLYPHS_URL;for(const p in e)for(const w of e[p])d.push({stack:p,id:w});_i(d,({stack:p,id:w},T)=>{let P=this.entries[p];P||(P=this.entries[p]={glyphs:{},requests:{},ranges:{},ascender:void 0,descender:void 0});let x=P.glyphs[w];if(x!==void 0)return void T(null,{stack:p,id:w,glyph:x});if(x=this._tinySDF(P,p,w),x)return P.glyphs[w]=x,void T(null,{stack:p,id:w,glyph:x});const C=Math.floor(w/256);if(256*C>65535)return nr("glyphs > 65535 not supported"),void T(null,{stack:p,id:w,glyph:x});if(P.ranges[C])return void T(null,{stack:p,id:w,glyph:x});let A=P.requests[C];A||(A=P.requests[C]=[],Rm.loadGlyphRange(p,C,c,this.requestManager,(E,M)=>{if(M){P.ascender=M.ascender,P.descender=M.descender;for(const k in M.glyphs)this._doesCharSupportLocalGlyph(+k)||(P.glyphs[+k]=M.glyphs[+k]);P.ranges[C]=!0}for(const k of A)k(E,M);delete P.requests[C]})),A.push((E,M)=>{E?T(E):M&&T(null,{stack:p,id:w,glyph:M.glyphs[w]||null})})},(p,w)=>{if(p)a(p);else if(w){const T={};for(const{stack:P,id:x,glyph:C}of w)T[P]===void 0&&(T[P]={}),T[P].glyphs===void 0&&(T[P].glyphs={}),T[P].glyphs[x]=C&&{id:C.id,bitmap:C.bitmap.clone(),metrics:C.metrics},T[P].ascender=this.entries[P].ascender,T[P].descender=this.entries[P].descender;a(null,T)}})}_doesCharSupportLocalGlyph(e){return this.localGlyphMode!==mb.none&&(this.localGlyphMode===mb.all?!!this.localFontFamily:!!this.localFontFamily&&(Xt["CJK Unified Ideographs"](e)||Xt["Hangul Syllables"](e)||Xt.Hiragana(e)||Xt.Katakana(e)||Xt["CJK Symbols and Punctuation"](e)||Xt["CJK Unified Ideographs Extension A"](e)||Xt["CJK Unified Ideographs Extension B"](e)||Xt.Osage(e)))}_tinySDF(e,n,a){const d=this.localFontFamily;if(!d||!this._doesCharSupportLocalGlyph(a))return;let c=e.tinySDF;if(!c){let k="400";/bold/i.test(n)?k="900":/medium/i.test(n)?k="500":/light/i.test(n)&&(k="200"),c=e.tinySDF=new Rm.TinySDF({fontFamily:d,fontWeight:k,fontSize:24*Sh,buffer:3*Sh,radius:8*Sh}),c.fontWeight=k}if(this.localGlyphs[c.fontWeight][a])return this.localGlyphs[c.fontWeight][a];const p=String.fromCodePoint(a),{data:w,width:T,height:P,glyphWidth:x,glyphHeight:C,glyphLeft:A,glyphTop:E,glyphAdvance:M}=c.draw(p);return this.localGlyphs[c.fontWeight][a]={id:a,bitmap:new ju({width:T,height:P},w),metrics:{width:x/Sh,height:C/Sh,left:A/Sh,top:E/Sh-27,advance:M/Sh,localGlyph:!0}}}}Rm.loadGlyphRange=function(s,e,n,a,d){const c=256*e,p=c+255,w=a.transformRequest(a.normalizeGlyphsURL(n).replace("{fontstack}",s).replace("{range}",`${c}-${p}`),lo.Glyphs);Yo(w,(T,P)=>{if(T)d(T);else if(P){const x={},C=function(A){return new Iy(A).readFields(z3,{})}(P);for(const A of C.glyphs)x[A.id]=A;d(null,{glyphs:x,ascender:C.ascender,descender:C.descender})}})},Rm.TinySDF=class{constructor({fontSize:s=24,buffer:e=3,radius:n=8,cutoff:a=.25,fontFamily:d="sans-serif",fontWeight:c="normal",fontStyle:p="normal"}={}){this.buffer=e,this.cutoff=a,this.radius=n;const w=this.size=s+4*e,T=this._createCanvas(w),P=this.ctx=T.getContext("2d",{willReadFrequently:!0});P.font=`${p} ${c} ${s}px ${d}`,P.textBaseline="alphabetic",P.textAlign="left",P.fillStyle="black",this.gridOuter=new Float64Array(w*w),this.gridInner=new Float64Array(w*w),this.f=new Float64Array(w),this.z=new Float64Array(w+1),this.v=new Uint16Array(w)}_createCanvas(s){const e=document.createElement("canvas");return e.width=e.height=s,e}draw(s){const{width:e,actualBoundingBoxAscent:n,actualBoundingBoxDescent:a,actualBoundingBoxLeft:d,actualBoundingBoxRight:c}=this.ctx.measureText(s),p=Math.ceil(n),w=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(c-d))),T=Math.min(this.size-this.buffer,p+Math.ceil(a)),P=w+2*this.buffer,x=T+2*this.buffer,C=Math.max(P*x,0),A=new Uint8ClampedArray(C),E={data:A,width:P,height:x,glyphWidth:w,glyphHeight:T,glyphTop:p,glyphLeft:0,glyphAdvance:e};if(w===0||T===0)return E;const{ctx:M,buffer:k,gridInner:N,gridOuter:j}=this;M.clearRect(k,k,w,T),M.fillText(s,k,k+p);const q=M.getImageData(k,k,w,T);j.fill(Ry,0,C),N.fill(0,0,C);for(let X=0;X<T;X++)for(let W=0;W<w;W++){const J=q.data[4*(X*w+W)+3]/255;if(J===0)continue;const ne=(X+k)*P+W+k;if(J===1)j[ne]=0,N[ne]=Ry;else{const he=.5-J;j[ne]=he>0?he*he:0,N[ne]=he<0?he*he:0}}PE(j,0,0,P,x,P,this.f,this.v,this.z),PE(N,k,k,w,T,P,this.f,this.v,this.z);for(let X=0;X<C;X++){const W=Math.sqrt(j[X])-Math.sqrt(N[X]);A[X]=Math.round(255-255*(W/this.radius+this.cutoff))}return E}};const jp=Hg;function kE(s,e){return s+e[1]-e[0]}function zE(s,e,n,a,d=1){const c=[],p=s.imagePrimary,w=p.pixelRatio,T=p.paddedRect.w-2*jp,P=p.paddedRect.h-2*jp,x=(s.right-s.left)*d,C=(s.bottom-s.top)*d,A=p.stretchX||[[0,T]],E=p.stretchY||[[0,P]],M=A.reduce(kE,0),k=E.reduce(kE,0),N=T-M,j=P-k;let q=0,X=M,W=0,J=k,ne=0,he=N,we=0,be=j;if(p.content&&a){const Be=p.content;q=ky(A,0,Be[0]),W=ky(E,0,Be[1]),X=ky(A,Be[0],Be[2]),J=ky(E,Be[1],Be[3]),ne=Be[0]-q,we=Be[1]-W,he=Be[2]-Be[0]-X,be=Be[3]-Be[1]-J}const ve=(Be,Me,Ue,Ye)=>{const Xe=zy(Be.stretch-q,X,x,s.left*d),Je=Ly(Be.fixed-ne,he,Be.stretch,M),st=zy(Me.stretch-W,J,C,s.top*d),pt=Ly(Me.fixed-we,be,Me.stretch,k),ot=zy(Ue.stretch-q,X,x,s.left*d),It=Ly(Ue.fixed-ne,he,Ue.stretch,M),tn=zy(Ye.stretch-W,J,C,s.top*d),Lt=Ly(Ye.fixed-we,be,Ye.stretch,k),un=new Ht(Xe,st),cn=new Ht(ot,st),vn=new Ht(ot,tn),Bt=new Ht(Xe,tn),Pn=new Ht(Je/w,pt/w),dn=new Ht(It/w,Lt/w),Cn=e*Math.PI/180;if(Cn){const Zr=Math.sin(Cn),Bi=Math.cos(Cn),Mi=[Bi,-Zr,Zr,Bi];un._matMult(Mi),cn._matMult(Mi),Bt._matMult(Mi),vn._matMult(Mi)}const Zn=Be.stretch+Be.fixed,xr=Ue.stretch+Ue.fixed,Cr=Me.stretch+Me.fixed,Or=Ye.stretch+Ye.fixed,Mr=s.imageSecondary;return{tl:un,tr:cn,bl:Bt,br:vn,texPrimary:{x:p.paddedRect.x+jp+Zn,y:p.paddedRect.y+jp+Cr,w:xr-Zn,h:Or-Cr},texSecondary:Mr?{x:Mr.paddedRect.x+jp+Zn,y:Mr.paddedRect.y+jp+Cr,w:xr-Zn,h:Or-Cr}:void 0,writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:Pn,pixelOffsetBR:dn,minFontScaleX:he/w/x,minFontScaleY:be/w/C,isSDF:n}};if(a&&(p.stretchX||p.stretchY)){const Be=LE(A,N,M),Me=LE(E,j,k);for(let Ue=0;Ue<Be.length-1;Ue++){const Ye=Be[Ue],Xe=Be[Ue+1];for(let Je=0;Je<Me.length-1;Je++)c.push(ve(Ye,Me[Je],Xe,Me[Je+1]))}}else c.push(ve({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:T+1},{fixed:0,stretch:P+1}));return c}function ky(s,e,n){let a=0;for(const d of s)a+=Math.max(e,Math.min(n,d[1]))-Math.max(e,Math.min(n,d[0]));return a}function LE(s,e,n){const a=[{fixed:-1,stretch:0}];for(const[d,c]of s){const p=a[a.length-1];a.push({fixed:d-p.stretch,stretch:p.stretch}),a.push({fixed:d-p.stretch,stretch:p.stretch+(c-d)})}return a.push({fixed:e+jp,stretch:n}),a}function zy(s,e,n,a){return s/e*n+a}function Ly(s,e,n,a){return s-e*n/a}function V3(s,e,n,a){const d=e+s.positionedLines[a].lineOffset;return a===0?n+d/2:n+(d+(e+s.positionedLines[a-1].lineOffset))/2}function U3(s,e=1,n=!1){let a=1/0,d=1/0,c=-1/0,p=-1/0;const w=s[0];for(let E=0;E<w.length;E++){const M=w[E];(!E||M.x<a)&&(a=M.x),(!E||M.y<d)&&(d=M.y),(!E||M.x>c)&&(c=M.x),(!E||M.y>p)&&(p=M.y)}const T=Math.min(c-a,p-d);let P=T/2;const x=new eh([],H3);if(T===0)return new Ht(a,d);for(let E=a;E<c;E+=T)for(let M=d;M<p;M+=T)x.push(new km(E+P,M+P,P,s));let C=function(E){let M=0,k=0,N=0;const j=E[0];for(let q=0,X=j.length,W=X-1;q<X;W=q++){const J=j[q],ne=j[W],he=J.x*ne.y-ne.x*J.y;k+=(J.x+ne.x)*he,N+=(J.y+ne.y)*he,M+=3*he}return new km(k/M,N/M,0,E)}(s),A=x.length;for(;x.length;){const E=x.pop();(E.d>C.d||!C.d)&&(C=E,n&&console.log("found best %d after %d probes",Math.round(1e4*E.d)/1e4,A)),E.max-C.d<=e||(P=E.h/2,x.push(new km(E.p.x-P,E.p.y-P,P,s)),x.push(new km(E.p.x+P,E.p.y-P,P,s)),x.push(new km(E.p.x-P,E.p.y+P,P,s)),x.push(new km(E.p.x+P,E.p.y+P,P,s)),A+=4)}return n&&(console.log(`num probes: ${A}`),console.log(`best distance: ${C.d}`)),C.p}function H3(s,e){return e.max-s.max}class km{constructor(e,n,a,d){this.p=new Ht(e,n),this.h=a,this.d=function(c,p){let w=!1,T=1/0;for(let P=0;P<p.length;P++){const x=p[P];for(let C=0,A=x.length,E=A-1;C<A;E=C++){const M=x[C],k=x[E];M.y>c.y!=k.y>c.y&&c.x<(k.x-M.x)*(c.y-M.y)/(k.y-M.y)+M.x&&(w=!w),T=Math.min(T,ke(c,M,k))}}return(w?1:-1)*Math.sqrt(T)}(this.p,d),this.max=this.d+this.h*Math.SQRT2}}const gb=Number.POSITIVE_INFINITY,W3=Math.sqrt(2);function OE(s,[e,n]){let a=0,d=0;if(n===gb){e<0&&(e=0);const c=e/W3;switch(s){case"top-right":case"top-left":d=c-7;break;case"bottom-right":case"bottom-left":d=7-c;break;case"bottom":d=7-e;break;case"top":d=e-7}switch(s){case"top-right":case"bottom-right":a=-c;break;case"top-left":case"bottom-left":a=c;break;case"left":a=e;break;case"right":a=-e}}else{switch(e=Math.abs(e),n=Math.abs(n),s){case"top-right":case"top-left":case"top":d=n-7;break;case"bottom-right":case"bottom-left":case"bottom":d=7-n}switch(s){case"top-right":case"bottom-right":case"right":a=-e;break;case"top-left":case"bottom-left":case"left":a=e}}return[a,d]}function _b(s){switch(s){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function G3(s,e,n,a,d,c,p,w,T,P,x,C,A,E,M,k){let N=c.textMaxSize.evaluate(e,{},A);N===void 0?N=p*c.textScaleFactor:N*=c.textScaleFactor;const j=s.layers[0].layout,q=j.get("icon-offset").evaluate(e,{},A),X=FE(n.horizontal)||n.vertical,W=E.name==="globe",J=za,ne=p*c.textScaleFactor/J,he=s.tilePixelRatio*N/J,we=(Je=s.overscaling,s.zoom>18&&Je>2&&(Je>>=1),Math.max(pn/(512*Je),1)*j.get("symbol-spacing")),be=j.get("text-padding")*s.tilePixelRatio,ve=j.get("icon-padding")*s.tilePixelRatio,Be=$n(j.get("text-max-angle")),Me=j.get("text-rotation-alignment")==="map"&&j.get("symbol-placement")!=="point",Ue=j.get("icon-rotation-alignment")==="map"&&j.get("symbol-placement")!=="point",Ye=j.get("symbol-placement"),Xe=we/2;var Je;const st=j.get("icon-text-fit").evaluate(e,{},A),pt=j.get("icon-text-fit-padding").evaluate(e,{},A),ot=st!=="none";let It;s.hasAnyIconTextFit===!1&&ot&&(s.hasAnyIconTextFit=!0),a&&ot&&(s.allowVerticalPlacement&&n.vertical&&(It=bE(a,n.vertical,st,pt,q,ne)),X&&(a=bE(a,X,st,pt,q,ne)));const tn=(Lt,un,cn)=>{if(un.x<0||un.x>=pn||un.y<0||un.y>=pn)return;let vn=null;if(W){const{x:Bt,y:Pn,z:dn}=E.projectTilePoint(un.x,un.y,cn);vn={anchor:new lf(Bt,Pn,dn,0,void 0),up:E.upVector(cn,un.x,un.y)}}(function(Bt,Pn,dn,Cn,Zn,xr,Cr,Or,Mr,Zr,Bi,Mi,hr,Ai,Ti,Ni,ws,Ss,qo,Zl,fo,bo,Tl,Es,fc,js,gd,Yf){const Kf=Bt.addToLineVertexArray(Pn,Cn);let cf,Jf,Qf,av,mC,gC,_C,yC=0,vC=0,xC=0,bC=0,Jb=-1,Qb=-1;const _d={};let wC=xa("");const Wp=dn?dn.anchor:Pn,e1=Mr.layout.get("icon-text-fit").evaluate(fo,{},js)!=="none";let t1=0,n1=0;if(Mr._unevaluatedLayout.getValue("text-radial-offset")===void 0?[t1,n1]=Mr.layout.get("text-offset").evaluate(fo,{},js).map(fu=>fu*za):(t1=Mr.layout.get("text-radial-offset").evaluate(fo,{},js)*za,n1=gb),Bt.allowVerticalPlacement&&Zn.vertical){const fu=Zn.vertical;if(Ti)gC=yb(fu),Or&&(_C=yb(Or));else{const Oc=Mr.layout.get("text-rotate").evaluate(fo,{},js)+90;Qf=Oy(Zr,Wp,Pn,Bi,Mi,hr,fu,Ai,Oc,Ni),Or&&(av=Oy(Zr,Wp,Pn,Bi,Mi,hr,Or,Ss,Oc))}}if(xr){const fu=Bt.iconSizeData,Oc=Es?My(Bt.iconSizeData,Bt.layers[0]._unevaluatedLayout._values["icon-size"],js,Bt.zoom,fo):1,Um=Mr.layout.get("icon-rotate").evaluate(fo,{},js),SC=zE(xr,Um,Tl,e1,Es?1/Oc:bo.iconScaleFactor),i1=Or?zE(Or,Um,Tl,e1,bo.iconScaleFactor):void 0;Jf=Oy(Zr,Wp,Pn,Bi,Mi,hr,xr,Ss,Um,null,Es?bo.iconScaleFactor*Oc:1),yC=4*SC.length;let Gp=null;fu.kind==="source"?(Gp=[wh*Mr.layout.get("icon-size").evaluate(fo,{},js)*bo.iconScaleFactor],Gp[0]>Gf&&nr(`${Bt.layerIds[0]}: Value for "icon-size" is >= ${Wg}. Reduce your "icon-size".`)):fu.kind==="composite"&&(Gp=[wh*bo.compositeIconSizes[0].evaluate(fo,{},js)*bo.iconScaleFactor,wh*bo.compositeIconSizes[1].evaluate(fo,{},js)*bo.iconScaleFactor],(Gp[0]>Gf||Gp[1]>Gf)&&nr(`${Bt.layerIds[0]}: Value for "icon-size" is >= ${Wg}. Reduce your "icon-size".`)),Bt.addSymbols(Bt.icon,SC,Gp,Zl,qo,fo,!1,dn,Pn,Kf.lineStartIndex,Kf.lineLength,-1,fc,js,gd,Yf),Jb=Bt.icon.placedSymbolArray.length-1,i1&&(vC=4*i1.length,Bt.addSymbols(Bt.icon,i1,Gp,Zl,qo,fo,hu.vertical,dn,Pn,Kf.lineStartIndex,Kf.lineLength,-1,fc,js,gd,Yf),Qb=Bt.icon.placedSymbolArray.length-1)}for(const fu in Zn.horizontal){const Oc=Zn.horizontal[fu];cf||(wC=xa(Oc.text),Ti?mC=yb(Oc):cf=Oy(Zr,Wp,Pn,Bi,Mi,hr,Oc,Ai,Mr.layout.get("text-rotate").evaluate(fo,{},js),Ni));const Um=Oc.positionedLines.length===1;if(xC+=DE(Bt,dn,Pn,Oc,Cr,Mr,Ti,fo,Ni,Kf,Zn.vertical?hu.horizontal:hu.horizontalOnly,Um?Object.keys(Zn.horizontal):[fu],_d,Jb,bo,fc,js,gd),Um)break}Zn.vertical&&(bC+=DE(Bt,dn,Pn,Zn.vertical,Cr,Mr,Ti,fo,Ni,Kf,hu.vertical,["vertical"],_d,Qb,bo,fc,js,gd));let ep=-1;const r1=(fu,Oc)=>fu?Math.max(fu,Oc):Oc;ep=r1(mC,ep),ep=r1(gC,ep),ep=r1(_C,ep);const Tz=ep>-1?1:0;Bt.glyphOffsetArray.length>=65535&&nr("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),fo.sortKey!==void 0&&Bt.addToSortKeyRanges(Bt.symbolInstances.length,fo.sortKey),Bt.symbolInstances.emplaceBack(Pn.x,Pn.y,Wp.x,Wp.y,Wp.z,_d.right>=0?_d.right:-1,_d.center>=0?_d.center:-1,_d.left>=0?_d.left:-1,_d.vertical>=0?_d.vertical:-1,Jb,Qb,wC,cf!==void 0?cf:Bt.collisionBoxArray.length,cf!==void 0?cf+1:Bt.collisionBoxArray.length,Qf!==void 0?Qf:Bt.collisionBoxArray.length,Qf!==void 0?Qf+1:Bt.collisionBoxArray.length,Jf!==void 0?Jf:Bt.collisionBoxArray.length,Jf!==void 0?Jf+1:Bt.collisionBoxArray.length,av||Bt.collisionBoxArray.length,av?av+1:Bt.collisionBoxArray.length,Bi,xC,bC,yC,vC,Tz,0,t1,n1,ep,0,e1?1:0)})(s,un,vn,Lt,n,a,d,It,s.layers[0],s.collisionBoxArray,e.index,e.sourceLayerIndex,s.index,be,Me,T,0,ve,Ue,q,e,c,P,x,C,A,M,k)};if(Ye==="line")for(const Lt of ME(e.geometry,0,0,pn,pn)){const un=$3(Lt,we,Be,n.vertical||X,a,J,he,s.overscaling,pn);for(const cn of un)X&&q3(s,X.text,Xe,cn)||tn(Lt,cn,A)}else if(Ye==="line-center"){for(const Lt of e.geometry)if(Lt.length>1){const un=j3(Lt,Be,n.vertical||X,a,J,he);un&&tn(Lt,un,A)}}else if(e.type==="Polygon")for(const Lt of Mn(e.geometry,0)){const un=U3(Lt,16);tn(Lt[0],new lf(un.x,un.y,0,0,void 0),A)}else if(e.type==="LineString")for(const Lt of e.geometry)tn(Lt,new lf(Lt[0].x,Lt[0].y,0,0,void 0),A);else if(e.type==="Point")for(const Lt of e.geometry)for(const un of Lt)tn([un],new lf(un.x,un.y,0,0,void 0),A)}const Wg=255,Gf=Wg*wh;function DE(s,e,n,a,d,c,p,w,T,P,x,C,A,E,M,k,N,j){const q=function(J,ne,he,we,be,ve,Be,Me){const Ue=[];if(ne.positionedLines.length===0)return Ue;const Ye=we.layout.get("text-rotate").evaluate(ve,{})*Math.PI/180,Xe=function(It){const tn=It[0],Lt=It[1],un=tn*Lt;return un>0?[tn,-Lt]:un<0?[-tn,Lt]:tn===0?[Lt,tn]:[Lt,-tn]}(he);let Je=Math.abs(ne.top-ne.bottom);for(const It of ne.positionedLines)Je-=It.lineOffset;const st=ne.positionedLines.length,pt=Je/st;let ot=ne.top-he[1];for(let It=0;It<st;++It){const tn=ne.positionedLines[It];ot=V3(ne,pt,ot,It);for(const Lt of tn.positionedGlyphs){if(!Lt.rect)continue;const un=Lt.rect||{};let cn=D3+1,vn=!0,Bt=1,Pn=0;if(Lt.imageName){const qo=Be[Oo.build(Lt.imageName).getSerializedPrimary()];if(!qo)continue;if(qo.sdf){nr("SDF images are not supported in formatted text and will be ignored.");continue}vn=!1,Bt=qo.pixelRatio,cn=Hg/Bt}const dn=(be||Me)&&Lt.vertical,Cn=Lt.metrics.advance*Lt.scale/2,Zn=Lt.metrics,xr=Lt.rect;if(xr===null)continue;Me&&ne.verticalizable&&(Pn=Lt.imageName?Cn-Lt.metrics.width*Lt.scale/2:0);const Cr=be?[Lt.x+Cn,Lt.y]:[0,0];let Or=[0,0],Mr=[0,0],Zr=!1;be||(dn?(Mr=[Lt.x+Cn+Xe[0],Lt.y+Xe[1]-Pn],Zr=!0):Or=[Lt.x+Cn+he[0],Lt.y+he[1]-Pn]);const Bi=xr.w*Lt.scale/(Bt*(Lt.localGlyph?Sh:1)),Mi=xr.h*Lt.scale/(Bt*(Lt.localGlyph?Sh:1));let hr,Ai,Ti,Ni;if(dn){const qo=Lt.y-ot,Zl=new Ht(-Cn,Cn-qo),fo=-Math.PI/2,bo=new Ht(...Mr);hr=new Ht(-Cn+Or[0],Or[1]),hr._rotateAround(fo,Zl)._add(bo),hr.x+=-qo+Cn,hr.y-=(Zn.left-cn)*Lt.scale;const Tl=Lt.imageName?Zn.advance*Lt.scale:za*Lt.scale,Es=String.fromCodePoint(Lt.glyph);P3(Es)?hr.x+=(1-cn)*Lt.scale:R3(Es)?hr.x+=Tl-Zn.height*Lt.scale+(-cn-1)*Lt.scale:hr.x+=Lt.imageName||Zn.width+2*cn===xr.w&&Zn.height+2*cn===xr.h?(Tl-Mi)/2:(Tl-(Zn.height+2*cn)*Lt.scale)/2,Ai=new Ht(hr.x,hr.y-Bi),Ti=new Ht(hr.x+Mi,hr.y),Ni=new Ht(hr.x+Mi,hr.y-Bi)}else{const qo=(Zn.left-cn)*Lt.scale-Cn+Or[0],Zl=(-Zn.top-cn)*Lt.scale+Or[1],fo=qo+Bi,bo=Zl+Mi;hr=new Ht(qo,Zl),Ai=new Ht(fo,Zl),Ti=new Ht(qo,bo),Ni=new Ht(fo,bo)}if(Ye){let qo;qo=be?new Ht(0,0):Zr?new Ht(Xe[0],Xe[1]):new Ht(he[0],he[1]),hr._rotateAround(Ye,qo),Ai._rotateAround(Ye,qo),Ti._rotateAround(Ye,qo),Ni._rotateAround(Ye,qo)}const ws=new Ht(0,0),Ss=new Ht(0,0);Ue.push({tl:hr,tr:Ai,bl:Ti,br:Ni,texPrimary:un,texSecondary:void 0,writingMode:ne.writingMode,glyphOffset:Cr,sectionIndex:Lt.sectionIndex,isSDF:vn,pixelOffsetTL:ws,pixelOffsetBR:Ss,minFontScaleX:0,minFontScaleY:0})}}return Ue}(0,a,T,c,p,w,d,s.allowVerticalPlacement),X=s.textSizeData;let W=null;X.kind==="source"?(W=[wh*c.layout.get("text-size").evaluate(w,{},N)*M.textScaleFactor],W[0]>Gf&&nr(`${s.layerIds[0]}: Value for "text-size" is >= ${Wg}. Reduce your "text-size".`)):X.kind==="composite"&&(W=[wh*M.compositeTextSizes[0].evaluate(w,{},N)*M.textScaleFactor,wh*M.compositeTextSizes[1].evaluate(w,{},N)*M.textScaleFactor],(W[0]>Gf||W[1]>Gf)&&nr(`${s.layerIds[0]}: Value for "text-size" is >= ${Wg}. Reduce your "text-size".`)),s.addSymbols(s.text,q,W,T,p,w,x,e,n,P.lineStartIndex,P.lineLength,E,k,N,j,!1);for(const J of C)A[J]=s.text.placedSymbolArray.length-1;return 4*q.length}function FE(s){for(const e in s)return s[e];return null}function Oy(s,e,n,a,d,c,p,w,T,P,x=1){let C=p.top/x,A=p.bottom/x,E=p.left/x,M=p.right/x;const k=p.collisionPadding;if(k&&(E-=k[0],C-=k[1],M+=k[2],A+=k[3]),T){const N=new Ht(E,C),j=new Ht(M,C),q=new Ht(E,A),X=new Ht(M,A),W=$n(T);let J=new Ht(0,0);P&&(J=new Ht(P[0],P[1])),N._rotateAround(W,J),j._rotateAround(W,J),q._rotateAround(W,J),X._rotateAround(W,J),E=Math.min(N.x,j.x,q.x,X.x),M=Math.max(N.x,j.x,q.x,X.x),C=Math.min(N.y,j.y,q.y,X.y),A=Math.max(N.y,j.y,q.y,X.y)}return s.emplaceBack(e.x,e.y,e.z,n.x,n.y,E,C,M,A,w,a,d,c),s.length-1}function yb(s){s.collisionPadding&&(s.top-=s.collisionPadding[1],s.bottom+=s.collisionPadding[3]);const e=s.bottom-s.top;return e>0?Math.max(10,e):null}function q3(s,e,n,a){const d=s.compareText;if(e in d){const c=d[e];for(let p=c.length-1;p>=0;p--)if(a.dist(c[p])<n)return!0}else d[e]=[];return d[e].push(a),!1}function BE(s,e){const n=s.fovAboveCenter,a=s.elevation?s.elevation.getMinElevationBelowMSL()*e:0,d=(s._camera.position[2]*s.worldSize-a)/Math.cos(s._pitch),c=Math.sin(n)*d/Math.sin(Math.max(Math.PI/2-s._pitch-n,.01));let p=Math.sin(s._pitch)*c+d;const w=d*(1/s._horizonShift);return s.elevation&&s.elevation.exaggeration()!==0||(p*=1+Math.max(s.zoom-17,0)),Math.min(1.01*p,w)}function Gg(s,e){if(!e.isReprojectedInTileSpace)return{scale:1<<s.z,x:s.x,y:s.y,x2:s.x+1,y2:s.y+1,projection:e};const n=Math.pow(2,-s.z),a=s.x*n,d=(s.x+1)*n,c=s.y*n,p=(s.y+1)*n,w=qa(a),T=qa(d),P=jn(c),x=jn(p),C=e.project(w,P),A=e.project(T,P),E=e.project(T,x),M=e.project(w,x);let k=Math.min(C.x,A.x,E.x,M.x),N=Math.min(C.y,A.y,E.y,M.y),j=Math.max(C.x,A.x,E.x,M.x),q=Math.max(C.y,A.y,E.y,M.y);const X=n/16;function W(ne,he,we,be,ve,Be){const Me=(we+ve)/2,Ue=(be+Be)/2,Ye=e.project(qa(Me),jn(Ue)),Xe=Math.max(0,k-Ye.x,N-Ye.y,Ye.x-j,Ye.y-q);k=Math.min(k,Ye.x),j=Math.max(j,Ye.x),N=Math.min(N,Ye.y),q=Math.max(q,Ye.y),Xe>X&&(W(ne,Ye,we,be,Me,Ue),W(Ye,he,Me,Ue,ve,Be))}W(C,A,a,c,d,c),W(A,E,d,c,d,p),W(E,M,d,p,a,p),W(M,C,a,p,a,c),k-=X,N-=X,j+=X,q+=X;const J=1/Math.max(j-k,q-N);return{scale:J,x:k*J,y:N*J,x2:j*J,y2:q*J,projection:e}}function NE(s,{x:e,y:n},a=0){return new Ht(((e-a)*s.scale-s.x)*pn,(n*s.scale-s.y)*pn)}const Z3=Re.mat4.identity(new Float32Array(16));class qf{constructor(e){this.spec=e,this.name=e.name,this.wrap=!1,this.requiresDraping=!1,this.supportsWorldCopies=!1,this.supportsTerrain=!1,this.supportsFog=!1,this.supportsFreeCamera=!1,this.zAxisUnit="meters",this.isReprojectedInTileSpace=!0,this.unsupportedLayers=["custom"],this.center=[0,0],this.range=[3.5,7]}project(e,n){return{x:0,y:0,z:0}}unproject(e,n){return new Qr(0,0)}projectTilePoint(e,n,a){return{x:e,y:n,z:0}}locationPoint(e,n,a=!0){return e._coordinatePoint(e.locationCoordinate(n),a)}pixelsPerMeter(e,n){return Ki(1,e)*n}pixelSpaceConversion(e,n,a){return 1}farthestPixelDistance(e){return BE(e,e.pixelsPerMeter)}pointCoordinate(e,n,a,d){const c=e.horizonLineFromTop(!1),p=new Ht(n,Math.max(c,a));return e.rayIntersectionCoordinate(e.pointRayIntersection(p,d))}pointCoordinate3D(e,n,a){const d=new Ht(n,a);if(e.elevation)return e.elevation.pointCoordinate(d);{const c=this.pointCoordinate(e,d.x,d.y,0);return[c.x,c.y,c.z]}}isPointAboveHorizon(e,n){if(e.elevation&&e.elevation.visibleDemTiles.length)return!this.pointCoordinate3D(e,n.x,n.y);const a=e.horizonLineFromTop();return n.y<a}createInversionMatrix(e,n){return Z3}createTileMatrix(e,n,a){let d,c,p;const w=a.canonical,T=Re.mat4.identity(new Float64Array(16));if(this.isReprojectedInTileSpace){const P=Gg(w,this);d=1,c=P.x+a.wrap*P.scale,p=P.y,Re.mat4.scale(T,T,[d/P.scale,d/P.scale,e.pixelsPerMeter/n])}else d=n/e.zoomScale(w.z),c=(w.x+Math.pow(2,w.z)*a.wrap)*d,p=w.y*d;return Re.mat4.translate(T,T,[c,p,0]),Re.mat4.scale(T,T,[d/pn,d/pn,1]),T}upVector(e,n,a){return[0,0,1]}upVectorScale(e,n,a){return{metersToTile:1}}}class X3 extends qf{constructor(e){super(e),this.range=[4,7],this.center=e.center||[-96,37.5];const[n,a]=this.parallels=e.parallels||[29.5,45.5],d=Math.sin($n(n));this.n=(d+Math.sin($n(a)))/2,this.c=1+d*(2*this.n-d),this.r0=Math.sqrt(this.c)/this.n}project(e,n){const{n:a,c:d,r0:c}=this,p=$n(e-this.center[0]),w=$n(n),T=Math.sqrt(d-2*a*Math.sin(w))/a;return{x:T*Math.sin(p*a),y:T*Math.cos(p*a)-c,z:0}}unproject(e,n){const{n:a,c:d,r0:c}=this,p=c+n;let w=Math.atan2(e,Math.abs(p))*Math.sign(p);p*a<0&&(w-=Math.PI*Math.sign(e)*Math.sign(p));const T=$n(this.center[0])*a;w=ui(w,-Math.PI-T,Math.PI-T);const P=yn(Gr(w/a)+this.center[0],-180,180),x=Math.asin(yn((d-(e*e+p*p)*a*a)/(2*a),-1,1)),C=yn(Gr(x),-85.051129,da);return new Qr(P,C)}}const qg=1.340264,Zg=-.081106,Xg=893e-6,Yg=.003796,Dy=Math.sqrt(3)/2;class Y3 extends qf{project(e,n){n=n/180*Math.PI,e=e/180*Math.PI;const a=Math.asin(Dy*Math.sin(n)),d=a*a,c=d*d*d;return{x:.5*(e*Math.cos(a)/(Dy*(qg+3*Zg*d+c*(7*Xg+9*Yg*d)))/Math.PI+.5),y:1-.5*(a*(qg+Zg*d+c*(Xg+Yg*d))/Math.PI+1),z:0}}unproject(e,n){e=(2*e-.5)*Math.PI;let a=n=(2*(1-n)-1)*Math.PI,d=a*a,c=d*d*d;for(let x,C,A,E=0;E<12&&(C=a*(qg+Zg*d+c*(Xg+Yg*d))-n,A=qg+3*Zg*d+c*(7*Xg+9*Yg*d),x=C/A,a=yn(a-x,-Math.PI/3,Math.PI/3),d=a*a,c=d*d*d,!(Math.abs(x)<1e-12));++E);const p=Dy*e*(qg+3*Zg*d+c*(7*Xg+9*Yg*d))/Math.cos(a),w=Math.asin(Math.sin(a)/Dy),T=yn(180*p/Math.PI,-180,180),P=yn(180*w/Math.PI,-85.051129,da);return new Qr(T,P)}}class K3 extends qf{constructor(e){super(e),this.wrap=!0,this.supportsWorldCopies=!0}project(e,n){return{x:.5+e/360,y:.5-n/360,z:0}}unproject(e,n){const a=360*(e-.5),d=yn(360*(.5-n),-85.051129,da);return new Qr(a,d)}}const zm=Math.PI/2;function Fy(s){return Math.tan((zm+s)/2)}class J3 extends qf{constructor(e){super(e),this.center=e.center||[0,30];const[n,a]=this.parallels=e.parallels||[30,30];let d=$n(n),c=$n(a);this.southernCenter=d+c<0,this.southernCenter&&(d=-d,c=-c);const p=Math.cos(d),w=Fy(d);this.n=d===c?Math.sin(d):Math.log(p/Math.cos(c))/Math.log(Fy(c)/w),this.f=p*Math.pow(Fy(d),this.n)/this.n}project(e,n){n=$n(n),this.southernCenter&&(n=-n),e=$n(e-this.center[0]);const a=1e-6,{n:d,f:c}=this;c>0?n<-zm+a&&(n=-zm+a):n>zm-a&&(n=zm-a);const p=c/Math.pow(Fy(n),d);let w=p*Math.sin(d*e),T=c-p*Math.cos(d*e);return w=.5*(w/Math.PI+.5),T=.5*(T/Math.PI+.5),{x:w,y:this.southernCenter?T:1-T,z:0}}unproject(e,n){e=(2*e-.5)*Math.PI,this.southernCenter&&(n=1-n),n=(2*(1-n)-.5)*Math.PI;const{n:a,f:d}=this,c=d-n,p=Math.sign(c),w=Math.sign(a)*Math.sqrt(e*e+c*c);let T=Math.atan2(e,Math.abs(c))*p;c*a<0&&(T-=Math.PI*Math.sign(e)*p);const P=yn(Gr(T/a)+this.center[0],-180,180),x=yn(Gr(2*Math.atan(Math.pow(d/w,1/a))-zm),-85.051129,da);return new Qr(P,this.southernCenter?-x:x)}}class jE extends qf{constructor(e){super(e),this.wrap=!0,this.supportsWorldCopies=!0,this.supportsTerrain=!0,this.supportsFog=!0,this.supportsFreeCamera=!0,this.isReprojectedInTileSpace=!1,this.unsupportedLayers=[],this.range=null}project(e,n){return{x:Bu(e),y:ql(n),z:0}}unproject(e,n){const a=qa(e),d=jn(n);return new Qr(a,d)}}const $E=$n(da);class Q3 extends qf{project(e,n){const a=(n=$n(n))*n,d=a*a;return{x:.5*((e=$n(e))*(.8707-.131979*a+d*(d*(.003971*a-.001529*d)-.013791))/Math.PI+.5),y:1-.5*(n*(1.007226+a*(.015085+d*(.028874*a-.044475-.005916*d)))/Math.PI+1),z:0}}unproject(e,n){e=(2*e-.5)*Math.PI;let a=n=(2*(1-n)-1)*Math.PI,d=25,c=0,p=a*a;do{p=a*a;const P=p*p;c=(a*(1.007226+p*(.015085+P*(.028874*p-.044475-.005916*P)))-n)/(1.007226+p*(.045255+P*(.259866*p-.311325-.005916*11*P))),a=yn(a-c,-$E,$E)}while(Math.abs(c)>1e-6&&--d>0);p=a*a;const w=yn(Gr(e/(.8707+p*(p*(p*p*p*(.003971-.001529*p)-.013791)-.131979))),-180,180),T=Gr(a);return new Qr(w,T)}}const VE=$n(da);class ek extends qf{project(e,n){n=$n(n),e=$n(e);const a=Math.cos(n),d=2/Math.PI,c=Math.acos(a*Math.cos(e/2)),p=Math.sin(c)/c,w=.5*(e*d+2*a*Math.sin(e/2)/p)||0,T=.5*(n+Math.sin(n)/p)||0;return{x:.5*(w/Math.PI+.5),y:1-.5*(T/Math.PI+1),z:0}}unproject(e,n){let a=e=(2*e-.5)*Math.PI,d=n=(2*(1-n)-1)*Math.PI,c=25;const p=1e-6;let w=0,T=0;do{const P=Math.cos(d),x=Math.sin(d),C=2*x*P,A=x*x,E=P*P,M=Math.cos(a/2),k=Math.sin(a/2),N=2*M*k,j=k*k,q=1-E*M*M,X=q?1/q:0,W=q?Math.acos(P*M)*Math.sqrt(1/q):0,J=.5*(2*W*P*k+2*a/Math.PI)-e,ne=.5*(W*x+d)-n,he=.5*X*(E*j+W*P*M*A)+1/Math.PI,we=X*(N*C/4-W*x*k),be=.125*X*(C*k-W*x*E*N),ve=.5*X*(A*M+W*j*P)+.5,Be=we*be-ve*he;w=(ne*we-J*ve)/Be,T=(J*be-ne*he)/Be,a=yn(a-w,-Math.PI,Math.PI),d=yn(d-T,-VE,VE)}while((Math.abs(w)>p||Math.abs(T)>p)&&--c>0);return new Qr(Gr(a),Gr(d))}}class UE extends qf{constructor(e){super(e),this.center=e.center||[0,0],this.parallels=e.parallels||[0,0],this.cosPhi=Math.max(.01,Math.cos($n(this.parallels[0]))),this.scale=1/(2*Math.max(Math.PI*this.cosPhi,1/this.cosPhi)),this.wrap=!0,this.supportsWorldCopies=!0}project(e,n){const{scale:a,cosPhi:d}=this;return{x:$n(e)*d*a+.5,y:-Math.sin($n(n))/d*a+.5,z:0}}unproject(e,n){const{scale:a,cosPhi:d}=this,c=-(n-.5)/a,p=yn(Gr((e-.5)/a)/d,-180,180),w=Math.asin(yn(c*d,-1,1)),T=yn(Gr(w),-85.051129,da);return new Qr(p,T)}}class tk extends jE{constructor(e){super(e),this.requiresDraping=!0,this.supportsWorldCopies=!1,this.supportsFog=!0,this.zAxisUnit="pixels",this.unsupportedLayers=["debug"],this.range=[3,5]}projectTilePoint(e,n,a){const d=ho(e,n,a),c=Gs(ns(a));return Re.vec3.transformMat4(d,d,c),{x:d[0],y:d[1],z:d[2]}}locationPoint(e,n){const a=_h(n.lat,n.lng),d=Re.vec3.normalize([],a),c=e.elevation?e.elevation.getAtPointOrZero(e.locationCoordinate(n),e._centerAltitude):e._centerAltitude,p=Ki(1,0)*pn*c;Re.vec3.scaleAndAdd(a,a,d,p);const w=Re.mat4.identity(new Float64Array(16));return Re.mat4.multiply(w,e.pixelMatrix,e.globeMatrix),Re.vec3.transformMat4(a,a,w),new Ht(a[0],a[1])}pixelsPerMeter(e,n){return Ki(1,0)*n}pixelSpaceConversion(e,n,a){const d=Ki(1,e)*n,c=kn(Ki(1,45)*n,d,a);return this.pixelsPerMeter(e,n)/c}createTileMatrix(e,n,a){const d=El(ns(a.canonical));return Re.mat4.multiply(new Float64Array(16),e.globeMatrix,d)}createInversionMatrix(e,n){const{center:a}=e,d=Gs(ns(n));return Re.mat4.rotateY(d,d,$n(a.lng)),Re.mat4.rotateX(d,d,$n(a.lat)),Re.mat4.scale(d,d,[e._pixelsPerMercatorPixel,e._pixelsPerMercatorPixel,1]),Float32Array.from(d)}pointCoordinate(e,n,a,d){return ts(e,n,a,!0)||new g(0,0)}pointCoordinate3D(e,n,a){const d=this.pointCoordinate(e,n,a,0);return[d.x,d.y,d.z]}isPointAboveHorizon(e,n){return!ts(e,n.x,n.y,!1)}farthestPixelDistance(e){const n=function(d,c){const p=d.cameraToCenterDistance,w=d._centerAltitude*c,T=d._camera,P=d._camera.forward(),x=Re.vec3.add([],Re.vec3.scale([],P,-p),[0,0,w]),C=d.worldSize/(2*Math.PI),A=[0,0,-C],E=d.width/d.height,M=Math.tan(d.fovAboveCenter),k=Re.vec3.scale([],T.up(),M),N=Re.vec3.scale([],T.right(),M*E),j=Re.vec3.normalize([],Re.vec3.add([],Re.vec3.add([],P,k),N)),q=[];let X;if(new pr(x,j).closestPointOnSphere(A,C,q)){const W=Re.vec3.add([],q,A),J=Re.vec3.sub([],W,x);X=Math.cos(d.fovAboveCenter)*Re.vec3.length(J)}else{const W=Re.vec3.sub([],x,A),J=Re.vec3.sub([],A,x);Re.vec3.normalize(J,J);const ne=Re.vec3.length(W)-C;X=Math.sqrt(ne*(ne+2*C));const he=Math.acos(X/(C+ne))-Math.acos(Re.vec3.dot(P,J));X*=Math.cos(he)}return 1.01*X}(e,this.pixelsPerMeter(e.center.lat,e.worldSize)),a=na(e.zoom);if(a>0){const d=BE(e,Ki(1,e.center.lat)*e.worldSize),c=e.worldSize/(2*Math.PI),p=Math.max(e.width,e.height)/e.worldSize*Math.PI;return kn(n,d+c*(1-Math.cos(p)),Math.pow(a,10))}return n}upVector(e,n,a){return ho(n,a,e,1)}upVectorScale(e){return{metersToTile:ii(Go(ns(e)))}}}function HE(s){const e=s.parallels,n=!!e&&Math.abs(e[0]+e[1])<.01;switch(s.name){case"mercator":return new jE(s);case"equirectangular":return new K3(s);case"naturalEarth":return new Q3(s);case"equalEarth":return new Y3(s);case"winkelTripel":return new ek(s);case"albers":return n?new UE(s):new X3(s);case"lambertConformalConic":return n?new UE(s):new J3(s);case"globe":return new tk(s)}throw new Error(`Invalid projection name: ${s.name}`)}const nk=Am.VectorTileFeature.types,rk=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function By(s,e,n,a,d,c,p,w,T,P,x,C,A){const E=w?Math.min(Gf,Math.round(w[0])):0,M=w?Math.min(Gf,Math.round(w[1])):0;s.emplaceBack(e,n,Math.round(32*a),Math.round(32*d),c,p,(E<<1)+(T?1:0),M,16*P,16*x,256*C,256*A)}function Ny(s,e,n){s.emplaceBack(e,n)}function jy(s,e,n,a,d,c,p){s.emplaceBack(e,n,a,d,c,p)}function $y(s,e,n,a,d){s.emplaceBack(e,n,a,d),s.emplaceBack(e,n,a,d),s.emplaceBack(e,n,a,d),s.emplaceBack(e,n,a,d)}function ik(s){for(const e of s.sections)if(Xi(e.text))return!0;return!1}class vb{constructor(e){this.layoutVertexArray=new $d,this.indexArray=new Ns,this.programConfigurations=e,this.segments=new vo,this.dynamicLayoutVertexArray=new xl,this.opacityVertexArray=new Ul,this.placedSymbolArray=new Rp,this.iconTransitioningVertexArray=new Bs,this.globeExtVertexArray=new Vd,this.zOffsetVertexArray=new bl}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0&&this.iconTransitioningVertexArray.length===0}upload(e,n,a,d,c){this.isEmpty()||(a&&(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,x3.members),this.indexBuffer=e.createIndexBuffer(this.indexArray,n),this.dynamicLayoutVertexBuffer=e.createVertexBuffer(this.dynamicLayoutVertexArray,w3.members,!0),this.opacityVertexBuffer=e.createVertexBuffer(this.opacityVertexArray,rk,!0),this.iconTransitioningVertexArray.length>0&&(this.iconTransitioningVertexBuffer=e.createVertexBuffer(this.iconTransitioningVertexArray,E3.members,!0)),this.globeExtVertexArray.length>0&&(this.globeExtVertexBuffer=e.createVertexBuffer(this.globeExtVertexArray,b3.members,!0)),!this.zOffsetVertexBuffer&&(this.zOffsetVertexArray.length>0||c)&&(this.zOffsetVertexBuffer=e.createVertexBuffer(this.zOffsetVertexArray,S3.members,!0)),this.opacityVertexBuffer.itemSize=1),(a||d)&&this.programConfigurations.upload(e))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy(),this.iconTransitioningVertexBuffer&&this.iconTransitioningVertexBuffer.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy(),this.zOffsetVertexBuffer&&this.zOffsetVertexBuffer.destroy())}}qe(vb,"SymbolBuffers");class xb{constructor(e,n,a){this.layoutVertexArray=new e,this.layoutAttributes=n,this.indexArray=new a,this.segments=new vo,this.collisionVertexArray=new Of,this.collisionVertexArrayExt=new xl}upload(e){this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=e.createVertexBuffer(this.collisionVertexArray,T3.members,!0),this.collisionVertexBufferExt=e.createVertexBuffer(this.collisionVertexArrayExt,C3.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy(),this.collisionVertexBufferExt.destroy())}}qe(xb,"CollisionBuffers");class Vy{constructor(e){this.collisionBoxArray=e.collisionBoxArray,this.zoom=e.zoom,this.lut=e.lut,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(p=>p.fqid),this.index=e.index,this.pixelRatio=e.pixelRatio,this.sourceLayerIndex=e.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.fullyClipped=!1,this.hasAnyIconTextFit=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=Re.mat4.identity([]),this.placementViewportMatrix=Re.mat4.identity([]);const n=this.layers[0]._unevaluatedLayout._values;this.textSizeData=lb(this.zoom,n["text-size"]),this.iconSizeData=lb(this.zoom,n["icon-size"]);const a=this.layers[0].layout,d=a.get("symbol-sort-key"),c=a.get("symbol-z-order");this.canOverlap=a.get("text-allow-overlap")||a.get("icon-allow-overlap")||a.get("text-ignore-placement")||a.get("icon-ignore-placement"),this.sortFeaturesByKey=c!=="viewport-y"&&d.constantOr(1)!==void 0,this.sortFeaturesByY=(c==="viewport-y"||c==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,this.writingModes=a.get("text-writing-mode").map(p=>hu[p]),this.stateDependentLayerIds=this.layers.filter(p=>p.isStateDependent()).map(p=>p.id),this.sourceID=e.sourceID,this.projection=e.projection,this.hasAnyZOffset=!1,this.zOffsetSortDirty=!1,this.zOffsetBuffersNeedUpload=a.get("symbol-z-elevate"),this.activeReplacements=[],this.replacementUpdateTime=0}createArrays(){this.text=new vb(new cu(this.layers,{zoom:this.zoom,lut:this.lut},e=>e.startsWith("text")||e.startsWith("symbol"))),this.icon=new vb(new cu(this.layers,{zoom:this.zoom,lut:this.lut},e=>e.startsWith("icon")||e.startsWith("symbol"))),this.glyphOffsetArray=new Zd,this.lineVertexArray=new Pa,this.symbolInstances=new od}calculateGlyphDependencies(e,n,a,d,c){for(const p of e){const w=p.codePointAt(0);if(w===void 0)break;if(n[w]=!0,d&&c&&w<=65535){const T=Vg[p];T&&(n[T.charCodeAt(0)]=!0)}}}updateFootprints(e,n){}updateReplacement(e,n){if(n.updateTime===this.replacementUpdateTime)return!1;this.replacementUpdateTime=n.updateTime;const a=n.getReplacementRegionsForTile(e.toUnwrapped(),!0);return!tb(this.activeReplacements,a)&&(this.activeReplacements=a,!0)}populate(e,n,a,d){const c=this.layers[0],p=c.layout,w=this.projection.name==="globe",T=p.get("text-font"),P=p.get("text-field"),x=p.get("icon-image"),[C,A]=p.get("icon-size-scale-range"),E=yn(n.scaleFactor||1,C,A),M=(P.value.kind!=="constant"||P.value.value instanceof fs&&!P.value.value.isEmpty()||P.value.value.toString().length>0)&&(T.value.kind!=="constant"||T.value.value.length>0),k=x.value.kind!=="constant"||!!x.value.value||Object.keys(x.parameters).length>0,N=p.get("symbol-sort-key");if(this.features=[],!M&&!k)return;const j=n.iconDependencies,q=n.glyphDependencies,X=n.availableImages,W=new qr(this.zoom);for(const{feature:J,id:ne,index:he,sourceLayerIndex:we}of e){const be=c._featureFilter.needGeometry,ve=G(J,be);if(!c._featureFilter.filter(W,ve,a))continue;if(be||(ve.geometry=U(J,a,d)),w&&J.type!==1&&a.z<=5){const Xe=ve.geometry,Je=.98078528056,st=(pt,ot)=>{const It=ho(pt.x,pt.y,a,1),tn=ho(ot.x,ot.y,a,1);return Re.vec3.dot(It,tn)<Je};for(let pt=0;pt<Xe.length;pt++)Xe[pt]=L(Xe[pt],st)}let Be,Me;if(M){const Xe=c.getValueAndResolveTokens("text-field",ve,a,X),Je=fs.factory(Xe);ik(Je)&&(this.hasRTLText=!0),(!this.hasRTLText||Ps()==="unavailable"||this.hasRTLText&&Yi.isParsed())&&(Be=I3(Je,c,ve))}if(k){const Xe=c.getValueAndResolveTokens("icon-image",ve,a,X);Me=Xe instanceof Oo?Xe:Oo.build(Xe)}if(!Be&&!Me)continue;const Ue=this.sortFeaturesByKey?N.evaluate(ve,{},a):void 0,Ye={id:ne,text:Be,icon:Me,index:he,sourceLayerIndex:we,geometry:ve.geometry,properties:J.properties,type:nk[J.type],sortKey:Ue};if(this.features.push(Ye),Me){const Xe=My(this.iconSizeData,this.layers[0]._unevaluatedLayout._values["icon-size"],a,this.zoom,Ye)*E*this.pixelRatio,Je=Me.getPrimary().scaleSelf(Xe);if(j[Je.id]=j[Je.id]||[],j[Je.id].push(Je),Me.nameSecondary){const st=Me.getSecondary().scaleSelf(Xe);j[st.id]=j[st.id]||[],j[st.id].push(st)}}if(Be){const Xe=T.evaluate(ve,{},a).join(","),Je=p.get("text-rotation-alignment")==="map"&&p.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(hu.vertical)>=0;for(const st of Be.sections)if(st.image){const pt=st.image.getPrimary().scaleSelf(this.pixelRatio);j[pt.id]=j[pt.id]||[],j[pt.id].push(pt)}else{const pt=Qn(Be.toString()),ot=st.fontStack||Xe,It=q[ot]=q[ot]||{};this.calculateGlyphDependencies(st.text,It,Je,this.allowVerticalPlacement,pt)}}}p.get("symbol-placement")==="line"&&(this.features=function(J){const ne={},he={},we=[];let be=0;function ve(Ye){we.push(J[Ye]),be++}function Be(Ye,Xe,Je){const st=he[Ye];return delete he[Ye],he[Xe]=st,we[st].geometry[0].pop(),we[st].geometry[0]=we[st].geometry[0].concat(Je[0]),st}function Me(Ye,Xe,Je){const st=ne[Xe];return delete ne[Xe],ne[Ye]=st,we[st].geometry[0].shift(),we[st].geometry[0]=Je[0].concat(we[st].geometry[0]),st}function Ue(Ye,Xe,Je){const st=Je?Xe[0][Xe[0].length-1]:Xe[0][0];return`${Ye}:${st.x}:${st.y}`}for(let Ye=0;Ye<J.length;Ye++){const Xe=J[Ye],Je=Xe.geometry,st=Xe.text?Xe.text.toString():null;if(!st){ve(Ye);continue}const pt=Ue(st,Je),ot=Ue(st,Je,!0);if(pt in he&&ot in ne&&he[pt]!==ne[ot]){const It=Me(pt,ot,Je),tn=Be(pt,ot,we[It].geometry);delete ne[pt],delete he[ot],he[Ue(st,we[tn].geometry,!0)]=tn,we[It].geometry=null}else pt in he?Be(pt,ot,Je):ot in ne?Me(pt,ot,Je):(ve(Ye),ne[pt]=be-1,he[ot]=be-1)}return we.filter(Ye=>Ye.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((J,ne)=>J.sortKey-ne.sortKey)}update(e,n,a,d,c,p,w){this.text.programConfigurations.updatePaintArrays(e,n,c,a,d,p,w),this.icon.programConfigurations.updatePaintArrays(e,n,c,a,d,p,w)}updateZOffset(){const e=(c,p,w)=>{a+=p,a>c.length&&c.resize(a);for(let T=-p;T<0;T++)c.emplace(T+a,w)},n=(c,p,w)=>{d+=p,d>c.length&&c.resize(d);for(let T=-p;T<0;T++)c.emplace(T+d,w)};if(!this.zOffsetBuffersNeedUpload)return;this.zOffsetBuffersNeedUpload=!1;let a=0,d=0;for(let c=0;c<this.symbolInstances.length;c++){const p=this.symbolInstances.get(c),{numHorizontalGlyphVertices:w,numVerticalGlyphVertices:T,numIconVertices:P}=p,x=p.zOffset,C=P>0;if((w>0||T>0)&&(e(this.text.zOffsetVertexArray,w,x),e(this.text.zOffsetVertexArray,T,x)),C){const{placedIconSymbolIndex:A,verticalPlacedIconSymbolIndex:E}=p;A>=0&&n(this.icon.zOffsetVertexArray,P,x),E>=0&&n(this.icon.zOffsetVertexArray,p.numVerticalIconVertices,x)}}this.text.zOffsetVertexBuffer&&this.text.zOffsetVertexBuffer.updateData(this.text.zOffsetVertexArray),this.icon.zOffsetVertexBuffer&&this.icon.zOffsetVertexBuffer.updateData(this.icon.zOffsetVertexArray)}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(e){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(e),this.iconCollisionBox.upload(e)),this.text.upload(e,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload),this.icon.upload(e,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}getProjection(){return this.projectionInstance||(this.projectionInstance=HE(this.projection)),this.projectionInstance}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(e,n){const a=this.lineVertexArray.length;if(e.segment!==void 0)for(const{x:d,y:c}of n)this.lineVertexArray.emplaceBack(d,c);return{lineStartIndex:a,lineLength:this.lineVertexArray.length-a}}addSymbols(e,n,a,d,c,p,w,T,P,x,C,A,E,M,k,N){const j=e.indexArray,q=e.layoutVertexArray,X=e.globeExtVertexArray,W=e.segments.prepareSegment(4*n.length,q,j,this.canOverlap?p.sortKey:void 0),J=this.glyphOffsetArray.length,ne=W.vertexLength,he=this.allowVerticalPlacement&&w===hu.vertical?Math.PI/2:0,we=p.text&&p.text.sections;for(let ve=0;ve<n.length;ve++){const{tl:Be,tr:Me,bl:Ue,br:Ye,texPrimary:Xe,texSecondary:Je,pixelOffsetTL:st,pixelOffsetBR:pt,minFontScaleX:ot,minFontScaleY:It,glyphOffset:tn,isSDF:Lt,sectionIndex:un}=n[ve],cn=W.vertexLength,vn=tn[1];if(By(q,P.x,P.y,Be.x,vn+Be.y,Xe.x,Xe.y,a,Lt,st.x,st.y,ot,It),By(q,P.x,P.y,Me.x,vn+Me.y,Xe.x+Xe.w,Xe.y,a,Lt,pt.x,st.y,ot,It),By(q,P.x,P.y,Ue.x,vn+Ue.y,Xe.x,Xe.y+Xe.h,a,Lt,st.x,pt.y,ot,It),By(q,P.x,P.y,Ye.x,vn+Ye.y,Xe.x+Xe.w,Xe.y+Xe.h,a,Lt,pt.x,pt.y,ot,It),T){const{x:Bt,y:Pn,z:dn}=T.anchor,[Cn,Zn,xr]=T.up;jy(X,Bt,Pn,dn,Cn,Zn,xr),jy(X,Bt,Pn,dn,Cn,Zn,xr),jy(X,Bt,Pn,dn,Cn,Zn,xr),jy(X,Bt,Pn,dn,Cn,Zn,xr),$y(e.dynamicLayoutVertexArray,Bt,Pn,dn,he)}else $y(e.dynamicLayoutVertexArray,P.x,P.y,P.z,he);if(N){const Bt=Je||Xe;Ny(e.iconTransitioningVertexArray,Bt.x,Bt.y),Ny(e.iconTransitioningVertexArray,Bt.x+Bt.w,Bt.y),Ny(e.iconTransitioningVertexArray,Bt.x,Bt.y+Bt.h),Ny(e.iconTransitioningVertexArray,Bt.x+Bt.w,Bt.y+Bt.h)}j.emplaceBack(cn,cn+1,cn+2),j.emplaceBack(cn+1,cn+2,cn+3),W.vertexLength+=4,W.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(tn[0]),ve!==n.length-1&&un===n[ve+1].sectionIndex||e.programConfigurations.populatePaintArrays(q.length,p,p.index,{},E,M,k,we&&we[un])}const be=T?T.anchor:P;e.placedSymbolArray.emplaceBack(be.x,be.y,be.z,P.x,P.y,J,this.glyphOffsetArray.length-J,ne,x,C,P.segment,a?a[0]:0,a?a[1]:0,d[0],d[1],w,0,!1,0,A,0)}_commitLayoutVertex(e,n,a,d,c,p,w){e.emplaceBack(n,a,d,c,p,Math.round(w.x),Math.round(w.y))}_addCollisionDebugVertices(e,n,a,d,c,p,w){const T=a.segments.prepareSegment(4,a.layoutVertexArray,a.indexArray),P=T.vertexLength,x=w.tileAnchorX,C=w.tileAnchorY;for(let E=0;E<4;E++)a.collisionVertexArray.emplaceBack(0,0,0,0,0,0);this._commitDebugCollisionVertexUpdate(a.collisionVertexArrayExt,n,e.padding,w.zOffset),this._commitLayoutVertex(a.layoutVertexArray,d,c,p,x,C,new Ht(e.x1,e.y1)),this._commitLayoutVertex(a.layoutVertexArray,d,c,p,x,C,new Ht(e.x2,e.y1)),this._commitLayoutVertex(a.layoutVertexArray,d,c,p,x,C,new Ht(e.x2,e.y2)),this._commitLayoutVertex(a.layoutVertexArray,d,c,p,x,C,new Ht(e.x1,e.y2)),T.vertexLength+=4;const A=a.indexArray;A.emplaceBack(P,P+1),A.emplaceBack(P+1,P+2),A.emplaceBack(P+2,P+3),A.emplaceBack(P+3,P),T.primitiveLength+=4}_addTextDebugCollisionBoxes(e,n,a,d,c,p){for(let w=d;w<c;w++){const T=a.get(w),P=this.getSymbolInstanceTextSize(e,p,n,w);this._addCollisionDebugVertices(T,P,this.textCollisionBox,T.projectedAnchorX,T.projectedAnchorY,T.projectedAnchorZ,p)}}_addIconDebugCollisionBoxes(e,n,a,d,c,p){for(let w=d;w<c;w++){const T=a.get(w),P=this.getSymbolInstanceIconSize(e,n,p.placedIconSymbolIndex);this._addCollisionDebugVertices(T,P,this.iconCollisionBox,T.projectedAnchorX,T.projectedAnchorY,T.projectedAnchorZ,p)}}generateCollisionDebugBuffers(e,n,a){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new xb(hh,dE.members,Bs),this.iconCollisionBox=new xb(hh,dE.members,Bs);const d=Im(this.iconSizeData,e),c=Im(this.textSizeData,e,a);for(let p=0;p<this.symbolInstances.length;p++){const w=this.symbolInstances.get(p);this._addTextDebugCollisionBoxes(c,e,n,w.textBoxStartIndex,w.textBoxEndIndex,w),this._addTextDebugCollisionBoxes(c,e,n,w.verticalTextBoxStartIndex,w.verticalTextBoxEndIndex,w),this._addIconDebugCollisionBoxes(d,e,n,w.iconBoxStartIndex,w.iconBoxEndIndex,w),this._addIconDebugCollisionBoxes(d,e,n,w.verticalIconBoxStartIndex,w.verticalIconBoxEndIndex,w)}}getSymbolInstanceTextSize(e,n,a,d){const c=this.text.placedSymbolArray.get(n.rightJustifiedTextSymbolIndex>=0?n.rightJustifiedTextSymbolIndex:n.centerJustifiedTextSymbolIndex>=0?n.centerJustifiedTextSymbolIndex:n.leftJustifiedTextSymbolIndex>=0?n.leftJustifiedTextSymbolIndex:n.verticalPlacedTextSymbolIndex>=0?n.verticalPlacedTextSymbolIndex:d),p=Ay(this.textSizeData,e,c)/za;return this.tilePixelRatio*p}getSymbolInstanceIconSize(e,n,a){const d=this.icon.placedSymbolArray.get(a),c=Ay(this.iconSizeData,e,d);return this.tilePixelRatio*c}_commitDebugCollisionVertexUpdate(e,n,a,d){e.emplaceBack(n,-a,-a,d),e.emplaceBack(n,a,-a,d),e.emplaceBack(n,a,a,d),e.emplaceBack(n,-a,a,d)}_updateTextDebugCollisionBoxes(e,n,a,d,c,p,w){for(let T=d;T<c;T++){const P=a.get(T),x=this.getSymbolInstanceTextSize(e,p,n,T);this._commitDebugCollisionVertexUpdate(this.textCollisionBox.collisionVertexArrayExt,x,P.padding,p.zOffset)}}_updateIconDebugCollisionBoxes(e,n,a,d,c,p,w){for(let T=d;T<c;T++){const P=a.get(T),x=this.getSymbolInstanceIconSize(e,n,p.placedIconSymbolIndex);this._commitDebugCollisionVertexUpdate(this.iconCollisionBox.collisionVertexArrayExt,x,P.padding,p.zOffset)}}updateCollisionDebugBuffers(e,n,a,d){if(!this.hasDebugData())return;this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexArrayExt.clear(),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexArrayExt.clear();const c=Im(this.iconSizeData,e,d),p=Im(this.textSizeData,e,a);for(let w=0;w<this.symbolInstances.length;w++){const T=this.symbolInstances.get(w);this._updateTextDebugCollisionBoxes(p,e,n,T.textBoxStartIndex,T.textBoxEndIndex,T,a),this._updateTextDebugCollisionBoxes(p,e,n,T.verticalTextBoxStartIndex,T.verticalTextBoxEndIndex,T,a),this._updateIconDebugCollisionBoxes(c,e,n,T.iconBoxStartIndex,T.iconBoxEndIndex,T,d),this._updateIconDebugCollisionBoxes(c,e,n,T.verticalIconBoxStartIndex,T.verticalIconBoxEndIndex,T,d)}this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexBufferExt&&this.textCollisionBox.collisionVertexBufferExt.updateData(this.textCollisionBox.collisionVertexArrayExt),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexBufferExt&&this.iconCollisionBox.collisionVertexBufferExt.updateData(this.iconCollisionBox.collisionVertexArrayExt)}_deserializeCollisionBoxesForSymbol(e,n,a,d,c,p,w,T,P){const x={};if(n<a){const{x1:C,y1:A,x2:E,y2:M,padding:k,projectedAnchorX:N,projectedAnchorY:j,projectedAnchorZ:q,tileAnchorX:X,tileAnchorY:W,featureIndex:J}=e.get(n);x.textBox={x1:C,y1:A,x2:E,y2:M,padding:k,projectedAnchorX:N,projectedAnchorY:j,projectedAnchorZ:q,tileAnchorX:X,tileAnchorY:W},x.textFeatureIndex=J}if(d<c){const{x1:C,y1:A,x2:E,y2:M,padding:k,projectedAnchorX:N,projectedAnchorY:j,projectedAnchorZ:q,tileAnchorX:X,tileAnchorY:W,featureIndex:J}=e.get(d);x.verticalTextBox={x1:C,y1:A,x2:E,y2:M,padding:k,projectedAnchorX:N,projectedAnchorY:j,projectedAnchorZ:q,tileAnchorX:X,tileAnchorY:W},x.verticalTextFeatureIndex=J}if(p<w){const{x1:C,y1:A,x2:E,y2:M,padding:k,projectedAnchorX:N,projectedAnchorY:j,projectedAnchorZ:q,tileAnchorX:X,tileAnchorY:W,featureIndex:J}=e.get(p);x.iconBox={x1:C,y1:A,x2:E,y2:M,padding:k,projectedAnchorX:N,projectedAnchorY:j,projectedAnchorZ:q,tileAnchorX:X,tileAnchorY:W},x.iconFeatureIndex=J}if(T<P){const{x1:C,y1:A,x2:E,y2:M,padding:k,projectedAnchorX:N,projectedAnchorY:j,projectedAnchorZ:q,tileAnchorX:X,tileAnchorY:W,featureIndex:J}=e.get(T);x.verticalIconBox={x1:C,y1:A,x2:E,y2:M,padding:k,projectedAnchorX:N,projectedAnchorY:j,projectedAnchorZ:q,tileAnchorX:X,tileAnchorY:W},x.verticalIconFeatureIndex=J}return x}deserializeCollisionBoxes(e){this.collisionArrays=[];for(let n=0;n<this.symbolInstances.length;n++){const a=this.symbolInstances.get(n);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(e,a.textBoxStartIndex,a.textBoxEndIndex,a.verticalTextBoxStartIndex,a.verticalTextBoxEndIndex,a.iconBoxStartIndex,a.iconBoxEndIndex,a.verticalIconBoxStartIndex,a.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}hasIconTextFit(){return this.hasAnyIconTextFit}addIndicesForPlacedSymbol(e,n){const a=e.placedSymbolArray.get(n),d=a.vertexStartIndex+4*a.numGlyphs;for(let c=a.vertexStartIndex;c<d;c+=4)e.indexArray.emplaceBack(c,c+1,c+2),e.indexArray.emplaceBack(c+1,c+2,c+3)}getSortedSymbolIndexes(e){if(this.sortedAngle===e&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const n=Math.sin(e),a=Math.cos(e),d=[],c=[],p=[];for(let w=0;w<this.symbolInstances.length;++w){p.push(w);const T=this.symbolInstances.get(w);d.push(0|Math.round(n*T.tileAnchorX+a*T.tileAnchorY)),c.push(T.featureIndex)}return p.sort((w,T)=>d[w]-d[T]||c[T]-c[w]),p}getSortedIndexesByZOffset(){if(!this.zOffsetSortDirty)return this.symbolInstanceIndexesSortedZOffset;if(!this.symbolInstanceIndexesSortedZOffset){this.symbolInstanceIndexesSortedZOffset=[];for(let e=0;e<this.symbolInstances.length;++e)this.symbolInstanceIndexesSortedZOffset.push(e)}return this.zOffsetSortDirty=!1,this.symbolInstanceIndexesSortedZOffset.sort((e,n)=>this.symbolInstances.get(n).zOffset-this.symbolInstances.get(e).zOffset)}addToSortKeyRanges(e,n){const a=this.sortKeyRanges[this.sortKeyRanges.length-1];a&&a.sortKey===n?a.symbolInstanceEnd=e+1:this.sortKeyRanges.push({sortKey:n,symbolInstanceStart:e,symbolInstanceEnd:e+1})}sortFeatures(e){if(this.sortFeaturesByY&&this.sortedAngle!==e&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(e),this.sortedAngle=e,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const n of this.symbolInstanceIndexes){const a=this.symbolInstances.get(n);this.featureSortOrder.push(a.featureIndex);const{rightJustifiedTextSymbolIndex:d,centerJustifiedTextSymbolIndex:c,leftJustifiedTextSymbolIndex:p,verticalPlacedTextSymbolIndex:w,placedIconSymbolIndex:T,verticalPlacedIconSymbolIndex:P}=a;d>=0&&this.addIndicesForPlacedSymbol(this.text,d),c>=0&&c!==d&&this.addIndicesForPlacedSymbol(this.text,c),p>=0&&p!==c&&p!==d&&this.addIndicesForPlacedSymbol(this.text,p),w>=0&&this.addIndicesForPlacedSymbol(this.text,w),T>=0&&this.addIndicesForPlacedSymbol(this.icon,T),P>=0&&this.addIndicesForPlacedSymbol(this.icon,P)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}let WE,GE,bb;qe(Vy,"SymbolBucket",{omit:["layers","collisionBoxArray","features","compareText"]}),Vy.addDynamicAttributes=$y;class qE{constructor(e){this.type=e.property.overrides?e.property.overrides.runtimeType:Kn,this.defaultValue=e}evaluate(e){if(e.formattedSection){const n=this.defaultValue.property.overrides;if(n&&n.hasOverride(e.formattedSection))return n.getOverride(e.formattedSection)}return e.feature&&e.featureState?this.defaultValue.evaluate(e.feature,e.featureState):this.defaultValue.property.specification.default}eachChild(e){this.defaultValue.isConstant()||e(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}qe(qE,"FormatSectionOverride",{omit:["defaultValue"]});const wb=()=>bb||(bb={layout:WE||(WE=new $i({"symbol-placement":new Zt(yt.layout_symbol["symbol-placement"]),"symbol-spacing":new Zt(yt.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new Zt(yt.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new an(yt.layout_symbol["symbol-sort-key"]),"symbol-z-order":new Zt(yt.layout_symbol["symbol-z-order"]),"symbol-z-elevate":new Zt(yt.layout_symbol["symbol-z-elevate"]),"symbol-elevation-reference":new Zt(yt.layout_symbol["symbol-elevation-reference"]),"icon-allow-overlap":new Zt(yt.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new Zt(yt.layout_symbol["icon-ignore-placement"]),"icon-optional":new Zt(yt.layout_symbol["icon-optional"]),"icon-rotation-alignment":new Zt(yt.layout_symbol["icon-rotation-alignment"]),"icon-size":new an(yt.layout_symbol["icon-size"]),"icon-size-scale-range":new Zt(yt.layout_symbol["icon-size-scale-range"]),"icon-text-fit":new an(yt.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new an(yt.layout_symbol["icon-text-fit-padding"]),"icon-image":new an(yt.layout_symbol["icon-image"]),"icon-rotate":new an(yt.layout_symbol["icon-rotate"]),"icon-padding":new Zt(yt.layout_symbol["icon-padding"]),"icon-keep-upright":new Zt(yt.layout_symbol["icon-keep-upright"]),"icon-offset":new an(yt.layout_symbol["icon-offset"]),"icon-anchor":new an(yt.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new Zt(yt.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new Zt(yt.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new Zt(yt.layout_symbol["text-rotation-alignment"]),"text-field":new an(yt.layout_symbol["text-field"]),"text-font":new an(yt.layout_symbol["text-font"]),"text-size":new an(yt.layout_symbol["text-size"]),"text-size-scale-range":new Zt(yt.layout_symbol["text-size-scale-range"]),"text-max-width":new an(yt.layout_symbol["text-max-width"]),"text-line-height":new an(yt.layout_symbol["text-line-height"]),"text-letter-spacing":new an(yt.layout_symbol["text-letter-spacing"]),"text-justify":new an(yt.layout_symbol["text-justify"]),"text-radial-offset":new an(yt.layout_symbol["text-radial-offset"]),"text-variable-anchor":new Zt(yt.layout_symbol["text-variable-anchor"]),"text-anchor":new an(yt.layout_symbol["text-anchor"]),"text-max-angle":new Zt(yt.layout_symbol["text-max-angle"]),"text-writing-mode":new Zt(yt.layout_symbol["text-writing-mode"]),"text-rotate":new an(yt.layout_symbol["text-rotate"]),"text-padding":new Zt(yt.layout_symbol["text-padding"]),"text-keep-upright":new Zt(yt.layout_symbol["text-keep-upright"]),"text-transform":new an(yt.layout_symbol["text-transform"]),"text-offset":new an(yt.layout_symbol["text-offset"]),"text-allow-overlap":new Zt(yt.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new Zt(yt.layout_symbol["text-ignore-placement"]),"text-optional":new Zt(yt.layout_symbol["text-optional"]),visibility:new Zt(yt.layout_symbol.visibility)})),paint:GE||(GE=new $i({"icon-opacity":new an(yt.paint_symbol["icon-opacity"]),"icon-occlusion-opacity":new an(yt.paint_symbol["icon-occlusion-opacity"]),"icon-emissive-strength":new an(yt.paint_symbol["icon-emissive-strength"]),"text-emissive-strength":new an(yt.paint_symbol["text-emissive-strength"]),"icon-color":new an(yt.paint_symbol["icon-color"]),"icon-halo-color":new an(yt.paint_symbol["icon-halo-color"]),"icon-halo-width":new an(yt.paint_symbol["icon-halo-width"]),"icon-halo-blur":new an(yt.paint_symbol["icon-halo-blur"]),"icon-translate":new Zt(yt.paint_symbol["icon-translate"]),"icon-translate-anchor":new Zt(yt.paint_symbol["icon-translate-anchor"]),"icon-image-cross-fade":new an(yt.paint_symbol["icon-image-cross-fade"]),"text-opacity":new an(yt.paint_symbol["text-opacity"]),"text-occlusion-opacity":new an(yt.paint_symbol["text-occlusion-opacity"]),"text-color":new an(yt.paint_symbol["text-color"],{runtimeType:ni,getOverride:s=>s.textColor,hasOverride:s=>!!s.textColor}),"text-halo-color":new an(yt.paint_symbol["text-halo-color"]),"text-halo-width":new an(yt.paint_symbol["text-halo-width"]),"text-halo-blur":new an(yt.paint_symbol["text-halo-blur"]),"text-translate":new Zt(yt.paint_symbol["text-translate"]),"text-translate-anchor":new Zt(yt.paint_symbol["text-translate-anchor"]),"icon-color-saturation":new Zt(yt.paint_symbol["icon-color-saturation"]),"icon-color-contrast":new Zt(yt.paint_symbol["icon-color-contrast"]),"icon-color-brightness-min":new Zt(yt.paint_symbol["icon-color-brightness-min"]),"icon-color-brightness-max":new Zt(yt.paint_symbol["icon-color-brightness-max"]),"symbol-z-offset":new an(yt.paint_symbol["symbol-z-offset"]),"icon-color-use-theme":new an({type:"string",default:"default","property-type":"data-driven"}),"icon-halo-color-use-theme":new an({type:"string",default:"default","property-type":"data-driven"}),"text-color-use-theme":new an({type:"string",default:"default","property-type":"data-driven"}),"text-halo-color-use-theme":new an({type:"string",default:"default","property-type":"data-driven"})}))},bb);class Uy extends vi{constructor(e,n,a,d){super(e,wb(),n,a,d),this._colorAdjustmentMatrix=Re.mat4.identity([]),this.hasInitialOcclusionOpacityProperties=e.paint!==void 0&&("icon-occlusion-opacity"in e.paint||"text-occlusion-opacity"in e.paint)}recalculate(e,n){super.recalculate(e,n),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));const a=this.layout.get("text-writing-mode");if(a){const d=[];for(const c of a)d.indexOf(c)<0&&d.push(c);this.layout._values["text-writing-mode"]=d}else this.layout._values["text-writing-mode"]=this.layout.get("symbol-placement")==="point"?["horizontal"]:["horizontal","vertical"];this._setPaintOverrides()}getColorAdjustmentMatrix(e,n,a,d){return this._saturation===e&&this._contrast===n&&this._brightnessMin===a&&this._brightnessMax===d||(this._colorAdjustmentMatrix=function(c,p,w,T){c=de(c),p=oe(p);const P=Re.mat4.create(),x=c/3,C=1-2*x,A=[C,x,x,0,x,C,x,0,x,x,C,0,0,0,0,1],E=.5-.5*p,M=T-w;return Re.mat4.multiply(P,[M,0,0,0,0,M,0,0,0,0,M,0,w,w,w,1],[p,0,0,0,0,p,0,0,0,0,p,0,E,E,E,1]),Re.mat4.multiply(P,P,A),P}(e,n,a,d),this._saturation=e,this._contrast=n,this._brightnessMin=a,this._brightnessMax=d),this._colorAdjustmentMatrix}getValueAndResolveTokens(e,n,a,d){const c=this.layout.get(e).evaluate(n,{},a,d),p=this._unevaluatedLayout._values[e];return p.isDataDriven()||Xh(p.value)||!c?c:function(w,T){return T.replace(/{([^{}]+)}/g,(P,x)=>x in w?String(w[x]):"")}(n.properties,c)}createBucket(e){return new Vy(e)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(const e of wb().paint.overridableProperties){if(!Uy.hasPaintOverride(this.layout,e))continue;const n=this.paint.get(e),a=new qE(n),d=new ru(a,n.property.specification,this.scope,this.options);let c=null;c=n.value.kind==="constant"||n.value.kind==="source"?new Ic("source",d):new _l("composite",d,n.value.zoomStops,n.value._interpolationType),this.paint._values[e]=new Ri(n.property,c,n.parameters)}}_handleOverridablePaintPropertyUpdate(e,n,a){return!(!this.layout||n.isDataDriven()||a.isDataDriven())&&Uy.hasPaintOverride(this.layout,e)}static hasPaintOverride(e,n){const a=e.get("text-field"),d=wb().paint.properties[n];let c=!1;const p=w=>{for(const T of w)if(d.overrides&&d.overrides.hasOverride(T))return void(c=!0)};if(a.value.kind==="constant"&&a.value.value instanceof fs)p(a.value.value.sections);else if(a.value.kind==="source"){const w=P=>{c||(P instanceof Is&&zi(P.value)===ds?p(P.value.sections):P instanceof Ba?p(P.sections):P.eachChild(w))},T=a.value;T._styleExpression&&w(T._styleExpression.expression)}return c}getProgramIds(){return["symbol"]}getDefaultProgramParams(e,n,a){return{config:new lu(this,{zoom:n,lut:a}),overrideFog:!1}}}let ZE,XE,YE,KE;var Sb=$r([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);function Eb(s){switch(s){case WebGL2RenderingContext.RGBA8:return WebGL2RenderingContext.RGBA;case WebGL2RenderingContext.DEPTH_COMPONENT16:return WebGL2RenderingContext.DEPTH_COMPONENT;case WebGL2RenderingContext.DEPTH24_STENCIL8:return WebGL2RenderingContext.DEPTH_STENCIL;case WebGL2RenderingContext.R8:case WebGL2RenderingContext.R32F:return WebGL2RenderingContext.RED}}function Tb(s){switch(s){case WebGL2RenderingContext.RGBA8:return WebGL2RenderingContext.UNSIGNED_BYTE;case WebGL2RenderingContext.DEPTH_COMPONENT16:return WebGL2RenderingContext.UNSIGNED_SHORT;case WebGL2RenderingContext.DEPTH24_STENCIL8:return WebGL2RenderingContext.UNSIGNED_INT_24_8;case WebGL2RenderingContext.R8:return WebGL2RenderingContext.UNSIGNED_BYTE;case WebGL2RenderingContext.R32F:return WebGL2RenderingContext.FLOAT}}class Cb{constructor(e,n,a,d){this.context=e,this.format=a,this.useMipmap=d&&d.useMipmap,this.texture=e.gl.createTexture(),this.update(n,{premultiply:d&&d.premultiply})}update(e,n){const a=e&&e instanceof HTMLVideoElement&&e.width===0?e.videoWidth:e.width,d=e&&e instanceof HTMLVideoElement&&e.height===0?e.videoHeight:e.height,{context:c}=this,{gl:p}=c,{x:w,y:T}=n&&n.position?n.position:{x:0,y:0},P=Math.max(w+a,this.size?this.size[0]:0),x=Math.max(T+d,this.size?this.size[1]:0);!this.size||this.size[0]===P&&this.size[1]===x||(p.bindTexture(p.TEXTURE_2D,null),p.deleteTexture(this.texture),this.texture=p.createTexture(),this.size=null),p.bindTexture(p.TEXTURE_2D,this.texture),c.pixelStoreUnpackFlipY.set(!1),c.pixelStoreUnpack.set(1),c.pixelStoreUnpackPremultiplyAlpha.set(this.format===p.RGBA8&&(!n||n.premultiply!==!1));const C=e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement||e instanceof ImageData||ImageBitmap&&e instanceof ImageBitmap;if(!this.size&&P>0&&x>0){const A=this.useMipmap?Math.floor(Math.log2(Math.max(P,x)))+1:1;p.texStorage2D(p.TEXTURE_2D,A,this.format,P,x),this.size=[P,x]}if(this.size)if(C)p.texSubImage2D(p.TEXTURE_2D,0,w,T,Eb(this.format),Tb(this.format),e);else{const A=e.data;A&&p.texSubImage2D(p.TEXTURE_2D,0,w,T,a,d,Eb(this.format),Tb(this.format),A)}this.useMipmap&&p.generateMipmap(p.TEXTURE_2D)}bind(e,n,a=!1){const{context:d}=this,{gl:c}=d;c.bindTexture(c.TEXTURE_2D,this.texture),e!==this.minFilter&&(c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MAG_FILTER,e),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MIN_FILTER,this.useMipmap&&!a?e===c.NEAREST?c.NEAREST_MIPMAP_NEAREST:c.LINEAR_MIPMAP_LINEAR:e),this.minFilter=e),n!==this.wrapS&&(c.texParameteri(c.TEXTURE_2D,c.TEXTURE_WRAP_S,n),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_WRAP_T,n),this.wrapS=n)}bindExtraParam(e,n,a,d){const{context:c}=this,{gl:p}=c;p.bindTexture(p.TEXTURE_2D,this.texture),n!==this.magFilter&&(p.texParameteri(p.TEXTURE_2D,p.TEXTURE_MAG_FILTER,n),this.magFilter=n),e!==this.minFilter&&(p.texParameteri(p.TEXTURE_2D,p.TEXTURE_MIN_FILTER,this.useMipmap?e===p.NEAREST?p.NEAREST_MIPMAP_NEAREST:p.LINEAR_MIPMAP_LINEAR:e),this.minFilter=e),a!==this.wrapS&&(p.texParameteri(p.TEXTURE_2D,p.TEXTURE_WRAP_S,a),this.wrapS=a),d!==this.wrapT&&(p.texParameteri(p.TEXTURE_2D,p.TEXTURE_WRAP_T,d),this.wrapT=d)}destroy(){const{gl:e}=this.context;e.deleteTexture(this.texture),this.texture=null}}class Hy{constructor(e,n){this.context=e,this.texture=n}bind(e,n){const{context:a}=this,{gl:d}=a;d.bindTexture(d.TEXTURE_2D,this.texture),e!==this.minFilter&&(d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MAG_FILTER,e),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MIN_FILTER,e),this.minFilter=e),n!==this.wrapS&&(d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_S,n),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_T,n),this.wrapS=n)}}function Wy(s,e,n,a,d,c,p,w){const T=[s,e,1,n,a,1,d,c,1],P=[p,w,1],x=Re.mat3.adjoint([],T),[C,A,E]=Re.vec3.transformMat3(P,P,x);return Re.mat3.multiply(T,T,[C,0,0,0,A,0,0,0,E])}function JE(s,e,n,a,d,c,p,w){const T=function(P,x,C,A,E,M,k,N){const j=Wy(0,0,1,0,1,1,0,1),q=Wy(P,x,C,A,E,M,k,N),X=Re.mat3.adjoint([],j);return Re.mat3.multiply(q,q,X)}(s,e,n,a,d,c,p,w);return[T[2]/T[8]/pn,T[5]/T[8]/pn]}function Gy(s){return[s[0],Math.min(Math.max(s[1],-85.051129),da)]}class QE extends go{constructor(e,n,a,d){super(),this.id=e,this.dispatcher=a,this.coordinates=n.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.onNorthPole=!1,this.onSouthPole=!1,this.setEventedParent(d),this.options=n,this._dirty=!1}load(e,n){if(this._loaded=n||!1,this.fire(new hi("dataloading",{dataType:"source"})),this.url=this.options.url,!this.url)return e&&(this.coordinates=e),this._loaded=!0,void this._finishLoading();this._imageRequest=Cs(this.map._requestManager.transformRequest(this.url,lo.Image),(a,d)=>{this._imageRequest=null,this._loaded=!0,a?this.fire(new As(a)):d&&(this.image=d instanceof HTMLImageElement?fn.getImageData(d):d,this._dirty=!0,this.width=this.image.width,this.height=this.image.height,e&&(this.coordinates=e),this._finishLoading())})}loaded(){return this._loaded}updateImage(e){return e.url?(this._imageRequest&&e.url!==this.options.url&&(this._imageRequest.cancel(),this._imageRequest=null),this.options.url=e.url,this.load(e.coordinates,this._loaded),this):this}setTexture(e){if(!(e.handle instanceof WebGLTexture))throw new Error("The provided handle is not a WebGLTexture instance");return this.texture=new Hy(this.map.painter.context,e.handle),this.width=e.dimensions[0],this.height=e.dimensions[1],this._dirty=!1,this._loaded=!0,this._finishLoading(),this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new hi("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(e){this.map=e,this.load()}onRemove(e){this._imageRequest&&(this._imageRequest.cancel(),this._imageRequest=null),!this.texture||this.texture instanceof Hy||this.texture.destroy(),this.boundsBuffer&&(this.boundsBuffer.destroy(),this.elevatedGlobeVertexBuffer&&this.elevatedGlobeVertexBuffer.destroy(),this.elevatedGlobeIndexBuffer&&this.elevatedGlobeIndexBuffer.destroy())}setCoordinates(e){if(this.coordinates=e,this._boundsArray=void 0,this._unsupportedCoords=!1,!e.length)return this;this.onNorthPole=!1,this.onSouthPole=!1;let n=e[0][1],a=e[0][1];for(const c of e)c[1]>a&&(a=c[1]),c[1]<n&&(n=c[1]);const d=(a+n)/2;if(d>da?this.onNorthPole=!0:d<-85.051129&&(this.onSouthPole=!0),!this.onNorthPole&&!this.onSouthPole){const c=e.map(g.fromLngLat);this.tileID=function(p){let w=1/0,T=1/0,P=-1/0,x=-1/0;for(const k of p)w=Math.min(w,k.x),T=Math.min(T,k.y),P=Math.max(P,k.x),x=Math.max(x,k.y);const C=Math.max(P-w,x-T),A=Math.max(0,Math.floor(-Math.log(C)/Math.LN2)),E=Math.pow(2,A);let M=Math.floor((w+P)/2*E);return M>1&&(M-=1),new _n(A,M,Math.floor((T+x)/2*E))}(c),this.minzoom=this.maxzoom=this.tileID.z}return this.fire(new hi("data",{dataType:"source",sourceDataType:"content"})),this}_clear(){this._boundsArray=void 0,this._unsupportedCoords=!1}_prepareData(e){for(const j in this.tiles){const q=this.tiles[j];q.state!=="loaded"&&(q.state="loaded",q.texture=this.texture)}if(this._boundsArray||this.onNorthPole||this.onSouthPole||this._unsupportedCoords)return;const n=Gg(new _n(0,0,0),this.map.transform.projection),a=[n.projection.project(this.coordinates[0][0],this.coordinates[0][1]),n.projection.project(this.coordinates[1][0],this.coordinates[1][1]),n.projection.project(this.coordinates[2][0],this.coordinates[2][1]),n.projection.project(this.coordinates[3][0],this.coordinates[3][1])];if(!function(j){const q=j[1].x-j[0].x,X=j[1].y-j[0].y,W=j[2].x-j[1].x,J=j[2].y-j[1].y,ne=j[3].x-j[2].x,he=j[3].y-j[2].y,we=j[0].x-j[3].x,be=j[0].y-j[3].y,ve=q*J-W*X,Be=W*he-ne*J,Me=ne*be-we*he,Ue=we*X-q*be;return ve>0&&Be>0&&Me>0&&Ue>0||ve<0&&Be<0&&Me<0&&Ue<0}(a))return console.warn("Image source coordinates are defining non-convex area in the Mercator projection"),void(this._unsupportedCoords=!0);const d=Gg(this.tileID,this.map.transform.projection),[c,p,w,T]=this.coordinates.map(j=>{const q=d.projection.project(j[0],j[1]);return NE(d,q)._round()});this.perspectiveTransform=JE(c.x,c.y,p.x,p.y,w.x,w.y,T.x,T.y);const P=this._boundsArray=new Fo;P.emplaceBack(c.x,c.y,0,0),P.emplaceBack(p.x,p.y,pn,0),P.emplaceBack(T.x,T.y,0,pn),P.emplaceBack(w.x,w.y,pn,pn),this.boundsBuffer&&(this.boundsBuffer.destroy(),this.elevatedGlobeVertexBuffer&&this.elevatedGlobeVertexBuffer.destroy(),this.elevatedGlobeIndexBuffer&&this.elevatedGlobeIndexBuffer.destroy()),this.boundsBuffer=e.createVertexBuffer(P,Sb.members),this.boundsSegments=vo.simpleSegment(0,0,4,2);const x=[],C=[Gy((A=this.coordinates)[0]),Gy(A[1]),Gy(A[2]),Gy(A[3])];var A;const[E,M,k,N]=function(j){let q=j[0][0],X=q,W=j[0][1],J=W;for(let ne=1;ne<j.length;ne++)j[ne][0]<q?q=j[ne][0]:j[ne][0]>X&&(X=j[ne][0]),j[ne][1]<W?W=j[ne][1]:j[ne][1]>J&&(J=j[ne][1]);return[q,W,X-q,J-W]}(C);{const j=new Fo,[q,X,W,J]=function(st){let pt=st[0].x,ot=pt,It=st[0].y,tn=It;for(let Lt=1;Lt<st.length;Lt++)st[Lt].x<pt?pt=st[Lt].x:st[Lt].x>ot&&(ot=st[Lt].x),st[Lt].y<It?It=st[Lt].y:st[Lt].y>tn&&(tn=st[Lt].y);return[pt,It,ot-pt,tn-It]}(a),ne=st=>[(st.x-q)/W,(st.y-X)/J],[he,we,be,ve]=a.map(ne),Be=function(st,pt,ot,It,tn,Lt,un,cn){const vn=Wy(0,0,1,0,1,1,0,1),Bt=Wy(st,pt,ot,It,tn,Lt,un,cn),Pn=Re.mat3.adjoint([],Bt);return Re.mat3.multiply(vn,vn,Pn)}(he[0],he[1],we[0],we[1],be[0],be[1],ve[0],ve[1]);this.elevatedGlobePerspectiveTransform=JE(he[0],he[1],we[0],we[1],be[0],be[1],ve[0],ve[1]);const Me=(st,pt)=>{x.push(st.lng);const ot=Math.round((st.lng-E)/k*pn),It=Math.round((st.lat-M)/N*pn),tn=ne(pt),Lt=Re.vec3.transformMat3([],[tn[0],tn[1],1],Be),un=Math.round(Lt[0]/Lt[2]*pn),cn=Math.round(Lt[1]/Lt[2]*pn);j.emplaceBack(ot,It,un,cn)},Ue=a[3].x-a[0].x,Ye=a[3].y-a[0].y,Xe=a[2].x-a[1].x,Je=a[2].y-a[1].y;for(let st=0;st<65;st++){const pt=st/64,ot=[a[0].x+pt*Ue,a[0].y+pt*Ye],It=[a[1].x+pt*Xe,a[1].y+pt*Je],tn=It[0]-ot[0],Lt=It[1]-ot[1];for(let un=0;un<65;un++){const cn=un/64,vn={x:ot[0]+tn*cn,y:ot[1]+Lt*cn,z:0};Me(n.projection.unproject(vn.x,vn.y),vn)}}this.elevatedGlobeVertexBuffer=e.createVertexBuffer(j,Sb.members)}{this.maxLongitudeTriangleSize=0;let j=[],q=new Ns;const X=(W,J,ne)=>{q.emplaceBack(W,J,ne);const he=x[W],we=x[J],be=x[ne],ve=Math.min(Math.min(he,we),be),Be=Math.max(Math.max(he,we),be)-ve;Be>this.maxLongitudeTriangleSize&&(this.maxLongitudeTriangleSize=Be),j.push(ve+Be/2)};for(let W=0;W<64;W++)for(let J=0;J<64;J++){const ne=65*W+J,he=ne+1,we=ne+65,be=we+1;X(ne,we,he),X(he,we,be)}[j,q]=function(W,J){const ne=Array.from({length:W.length},(be,ve)=>ve);ne.sort((be,ve)=>W[be]-W[ve]);const he=[],we=new Ns;for(let be=0;be<ne.length;be++){const ve=ne[be];he.push(W[ve]);const Be=3*ve,Me=Be+1;we.emplaceBack(J.uint16[Be],J.uint16[Me],J.uint16[Me+1])}return[he,we]}(j,q),this.elevatedGlobeTrianglesCenterLongitudes=j,this.elevatedGlobeIndexBuffer=e.createIndexBuffer(q)}this.elevatedGlobeSegments=vo.simpleSegment(0,0,4225,8192),this.elevatedGlobeGridMatrix=new Float32Array([0,k/pn,0,N/pn,0,0,M,E,0])}prepare(){const e=Object.keys(this.tiles).length!==0;if(this.tileID&&!e)return;const n=this.map.painter.context,a=n.gl;!this._dirty||this.texture instanceof Hy||(this.texture?this.texture.update(this.image):(this.texture=new Cb(n,this.image,a.RGBA8),this.texture.bind(a.LINEAR,a.CLAMP_TO_EDGE)),this._dirty=!1),e&&this._prepareData(n)}loadTile(e,n){this.tileID&&this.tileID.equals(e.tileID.canonical)?(this.tiles[String(e.tileID.wrap)]=e,e.buckets={},n(null)):(e.state="errored",n(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}getSegmentsForLongitude(e){const n=this.elevatedGlobeSegments;if(!this.elevatedGlobeTrianglesCenterLongitudes||!n)return null;const a=this.elevatedGlobeTrianglesCenterLongitudes;let d=(c=e+180)+360*Math.round((a[0]-c)/360);var c;const p=new vo,w=(C,A)=>{p.segments.push({vertexOffset:0,primitiveOffset:C,vertexLength:n.segments[0].vertexLength,primitiveLength:A,sortKey:void 0,vaos:{}})},T=.51*this.maxLongitudeTriangleSize;if(Math.abs(a[0]-d)<=T){const C=bt(a,0,a.length,d+T);return C===a.length||w(C,oo(a,C+1,a.length,d+360-T)-C),p}d<a[0]&&(d+=360);const P=oo(a,0,a.length,d-T);if(P===a.length)return w(0,a.length),p;w(0,P-0);const x=bt(a,P+1,a.length,d+T);return x!==a.length&&w(x,a.length-x),p}}const ok=(Math.pow(256,2)-1)/16907520;class eT extends vi{constructor(e,n,a,d){super(e,{layout:YE||(YE=new $i({visibility:new Zt(yt.layout_raster.visibility)})),paint:KE||(KE=new $i({"raster-opacity":new Zt(yt.paint_raster["raster-opacity"]),"raster-color":new Qs(yt.paint_raster["raster-color"]),"raster-color-mix":new Zt(yt.paint_raster["raster-color-mix"]),"raster-color-range":new Zt(yt.paint_raster["raster-color-range"]),"raster-hue-rotate":new Zt(yt.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new Zt(yt.paint_raster["raster-brightness-min"]),"raster-brightness-max":new Zt(yt.paint_raster["raster-brightness-max"]),"raster-saturation":new Zt(yt.paint_raster["raster-saturation"]),"raster-contrast":new Zt(yt.paint_raster["raster-contrast"]),"raster-resampling":new Zt(yt.paint_raster["raster-resampling"]),"raster-fade-duration":new Zt(yt.paint_raster["raster-fade-duration"]),"raster-emissive-strength":new Zt(yt.paint_raster["raster-emissive-strength"]),"raster-array-band":new Zt(yt.paint_raster["raster-array-band"]),"raster-elevation":new Zt(yt.paint_raster["raster-elevation"]),"raster-color-use-theme":new an({type:"string",default:"default","property-type":"data-driven"})}))},n,a,d),this.updateColorRamp(),this._curRampRange=[NaN,NaN]}getProgramIds(){return["raster"]}hasColorMap(){return!!this._transitionablePaint._values["raster-color"].value.value}tileCoverLift(){return this.paint.get("raster-elevation")}isDraped(e){return!(e&&e._source instanceof QE&&(e._source.onNorthPole||e._source.onSouthPole))&&this.paint.get("raster-elevation")===0}_handleSpecialPaintPropertyUpdate(e){e!=="raster-color"&&e!=="raster-color-range"||(this._curRampRange=[NaN,NaN],this.updateColorRamp())}updateColorRamp(e){if(!this.hasColorMap()||!this._curRampRange)return;const n=this._transitionablePaint._values["raster-color"].value.expression,[a,d]=e||this._transitionablePaint._values["raster-color-range"].value.expression.evaluate({zoom:0})||[NaN,NaN];isNaN(a)&&isNaN(d)||a===this._curRampRange[0]&&d===this._curRampRange[1]||(this.colorRamp=Uf({expression:n,evaluationKey:"rasterValue",image:this.colorRamp,clips:[{start:a,end:d}],resolution:256}),this.colorRampTexture=null,this._curRampRange=[a,d])}}let tT,nT,rT,iT,oT;class sT extends vi{constructor(e,n,a,d){super(e,{layout:tT||(tT=new $i({visibility:new Zt(yt["layout_raster-particle"].visibility)})),paint:nT||(nT=new $i({"raster-particle-array-band":new Zt(yt["paint_raster-particle"]["raster-particle-array-band"]),"raster-particle-count":new Zt(yt["paint_raster-particle"]["raster-particle-count"]),"raster-particle-color":new Qs(yt["paint_raster-particle"]["raster-particle-color"]),"raster-particle-max-speed":new Zt(yt["paint_raster-particle"]["raster-particle-max-speed"]),"raster-particle-speed-factor":new Zt(yt["paint_raster-particle"]["raster-particle-speed-factor"]),"raster-particle-fade-opacity-factor":new Zt(yt["paint_raster-particle"]["raster-particle-fade-opacity-factor"]),"raster-particle-reset-rate-factor":new Zt(yt["paint_raster-particle"]["raster-particle-reset-rate-factor"]),"raster-particle-elevation":new Zt(yt["paint_raster-particle"]["raster-particle-elevation"]),"raster-particle-color-use-theme":new an({type:"string",default:"default","property-type":"data-driven"})}))},n,a,d),this._updateColorRamp(),this.lastInvalidatedAt=fn.now()}onRemove(e){this.colorRampTexture&&this.colorRampTexture.destroy(),this.tileFramebuffer&&this.tileFramebuffer.destroy(),this.particleFramebuffer&&this.particleFramebuffer.destroy()}hasColorMap(){return!!this._transitionablePaint._values["raster-particle-color"].value.value}getProgramIds(){return["rasterParticle"]}hasOffscreenPass(){return this.visibility!=="none"}isDraped(e){return!1}_handleSpecialPaintPropertyUpdate(e){e!=="raster-particle-color"&&e!=="raster-particle-max-speed"||(this._updateColorRamp(),this._invalidateAnimationState()),e==="raster-particle-count"&&this._invalidateAnimationState()}_updateColorRamp(){if(!this.hasColorMap())return;const e=this._transitionablePaint._values["raster-particle-color"].value.expression,n=this._transitionablePaint._values["raster-particle-max-speed"].value.expression.evaluate({zoom:0});this.colorRamp=Uf({expression:e,evaluationKey:"rasterParticleSpeed",image:this.colorRamp,clips:[{start:0,end:n}],resolution:256}),this.colorRampTexture=null}_invalidateAnimationState(){this.lastInvalidatedAt=fn.now()}tileCoverLift(){return this.paint.get("raster-particle-elevation")}}class sk extends vi{constructor(e,n){super(e,{},n,null),this.implementation=e,e.slot&&(this.slot=e.slot)}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}isDraped(e){return this.implementation.renderToTile!==void 0}shouldRedrape(){return!!this.implementation.shouldRerenderTiles&&this.implementation.shouldRerenderTiles()}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){}onAdd(e){this.implementation.onAdd&&this.implementation.onAdd(e,e.painter.context.gl)}onRemove(e){this.implementation.onRemove&&this.implementation.onRemove(e,e.painter.context.gl)}}function Mb(s,e,n){const a=[0,0,1],d=Re.quat.identity([]);return Re.quat.rotateY(d,d,n?-$n(s)+Math.PI:$n(s)),Re.quat.rotateX(d,d,-$n(e)),Re.vec3.transformQuat(a,a,d),Re.vec3.normalize(a,a)}function aT(s,e){const n=qy(s.projection,s.zoom,s.width,s.height),a=function(c,p,w,T,P){const x=new Qr(w.lng-180*Zf,w.lat),C=new Qr(w.lng+180*Zf,w.lat),A=c.project(x.lng,x.lat),E=c.project(C.lng,C.lat),M=-Math.atan2(E.y-A.y,E.x-A.x),k=g.fromLngLat(w);k.y=yn(k.y,-1+Zf,1-Zf);const N=k.toLngLat(),j=c.project(N.lng,N.lat),q=g.fromLngLat(N);q.x+=Zf;const X=q.toLngLat(),W=c.project(X.lng,X.lat),J=cT(W.x-j.x,W.y-j.y,M),ne=g.fromLngLat(N);ne.y+=Zf;const he=ne.toLngLat(),we=c.project(he.lng,he.lat),be=cT(we.x-j.x,we.y-j.y,M),ve=Math.abs(J.x)/Math.abs(be.y),Be=Re.mat4.identity([]);Re.mat4.rotateZ(Be,Be,-M*(1-(P?0:T)));const Me=Re.mat4.identity([]);return Re.mat4.scale(Me,Me,[1,1-(1-ve)*T,1]),Me[4]=-be.x/be.y*T,Re.mat4.rotateZ(Me,Me,M),Re.mat4.multiply(Me,Be,Me),Me}(s.projection,0,s.center,n,e),d=lT(s);return Re.mat4.scale(a,a,[d,d,1]),a}function lT(s){const e=s.projection,n=qy(s.projection,s.zoom,s.width,s.height),a=Ab(e,s.center),d=Ab(e,Qr.convert(e.center));return Math.pow(2,a*n+(1-n)*d)}function qy(s,e,n,a,d=1/0){const c=s.range;if(!c)return 0;const p=Math.min(d,Math.max(n,a)),w=Math.log(p/1024)/Math.LN2;return Ir(c[0]+w,c[1]+w,e)}const Zf=1/4e4;function Ab(s,e){const n=yn(e.lat,-85.051129,da),a=new Qr(e.lng-180*Zf,n),d=new Qr(e.lng+180*Zf,n),c=s.project(a.lng,n),p=s.project(d.lng,n),w=g.fromLngLat(a),T=g.fromLngLat(d),P=p.x-c.x,x=p.y-c.y,C=T.x-w.x,A=T.y-w.y,E=Math.sqrt((C*C+A*A)/(P*P+x*x));return Math.log(E)/Math.LN2}function cT(s,e,n){const a=Math.cos(n),d=Math.sin(n);return{x:s*a-e*d,y:s*d+e*a}}function uT(s,e,n){Re.mat4.identity(s),Re.mat4.rotateZ(s,s,$n(e[2])),Re.mat4.rotateX(s,s,$n(e[0])),Re.mat4.rotateY(s,s,$n(e[1])),Re.mat4.scale(s,s,n),Re.mat4.multiply(s,s,[1,0,0,0,0,0,1,0,0,1,0,0,0,0,0,1])}function Zy(s,e,n,a,d,c,p,w){const T=[n[0]-e[0],n[1]-e[1],0],P=[a[0]-e[0],a[1]-e[1],0];if(Re.vec3.length(T)<1e-12||Re.vec3.length(P)<1e-12)return Re.quat.identity(s);const x=Re.vec3.cross([],T,P);Re.vec3.normalize(x,x),Re.vec3.subtract(P,a,e),T[2]=(c-d)*w,P[2]=(p-d)*w;const C=T;return Re.vec3.cross(C,T,P),Re.vec3.normalize(C,C),Re.quat.rotationTo(s,x,C)}function Ib(s,e,n=!1){const a=na(e.zoom),d=function(c,p,w){const T=p.worldSize,P=[c[12],c[13],c[14]],x=jn(P[1]/T),C=qa(P[0]/T),A=Re.mat4.identity([]),E=Ki(1,x)*T,M=Ki(1,0)*T*t(x,p.zoom),k=1/fa(T);let N=M*k;if(w){const W=qy(p.projection,p.zoom,p.width,p.height,1024);N=k*p.projection.pixelSpaceConversion(p.center.lat,T,W)}const j=_h(x,C);Re.vec3.add(j,j,Re.vec3.scale([],Re.vec3.normalize([],j),E*N*P[2]));const q=function(W){const J=[W[0],W[1],W[2]];let ne=[0,1,0];const he=Re.vec3.cross([],ne,J);return Re.vec3.cross(ne,J,he),Re.vec3.squaredLength(ne)===0&&(ne=[0,1,0],Re.vec3.cross(he,J,ne)),Re.vec3.normalize(he,he),Re.vec3.normalize(ne,ne),Re.vec3.normalize(J,J),[he[0],he[1],he[2],0,ne[0],ne[1],ne[2],0,J[0],J[1],J[2],0,W[0],W[1],W[2],1]}(j);Re.mat4.scale(A,A,[N,N,N*E]),Re.mat4.translate(A,A,[-P[0],-P[1],-P[2]]);const X=Re.mat4.multiply([],p.globeMatrix,q);return Re.mat4.multiply(X,X,A),Re.mat4.multiply(X,X,c),X}(s,e,n);if(a>0){const c=function(p,w){const T=w.worldSize,P=Ki(1,0)*T*t(w.center.lat,w.zoom)/fa(T),x=Ki(1,w.center.lat)*T,C=Re.mat4.identity([]);return Re.mat4.rotateY(C,C,$n(w.center.lng)),Re.mat4.rotateX(C,C,$n(w.center.lat)),Re.mat4.translate(C,C,[0,0,Hs]),Re.mat4.scale(C,C,[P,P,P*x]),Re.mat4.translate(C,C,[w.point.x-.5*T,w.point.y-.5*T,0]),Re.mat4.multiply(C,C,p),Re.mat4.multiply(C,w.globeMatrix,C)}(s,e);return function(p,w,T){const P=(M,k,N)=>{const j=Re.vec3.length(M),q=Re.vec3.length(k),X=Co(M,k,N);return Re.vec3.scale(X,X,1/Re.vec3.length(X)*kn(j,q,N))},x=P([p[0],p[1],p[2]],[w[0],w[1],w[2]],T),C=P([p[4],p[5],p[6]],[w[4],w[5],w[6]],T),A=P([p[8],p[9],p[10]],[w[8],w[9],w[10]],T),E=Co([p[12],p[13],p[14]],[w[12],w[13],w[14]],T);return[x[0],x[1],x[2],0,C[0],C[1],C[2],0,A[0],A[1],A[2],0,E[0],E[1],E[2],1]}(d,c,a)}return d}function hT(s,e,n,a){const d=Bn.projectAabbCorners(a,n);let c=Number.MAX_VALUE,p=-1;for(let P=0;P<d.length;++P){const x=d[P];x[0]=(.5*x[0]+.5)*e.width,x[1]=(.5-.5*x[1])*e.height,x[2]<c&&(p=P,c=x[2])}const w=P=>new Ht(d[P][0],d[P][1]);let T;switch(p){case 0:case 6:T=[w(1),w(5),w(4),w(7),w(3),w(2),w(1)];break;case 1:case 7:T=[w(0),w(4),w(5),w(6),w(2),w(3),w(0)];break;case 3:case 5:T=[w(1),w(0),w(4),w(7),w(6),w(2),w(1)];break;default:T=[w(1),w(5),w(6),w(7),w(3),w(0),w(1)]}if(ce(s,T))return c}const ak=$r([{name:"a_pos_3f",components:3,type:"Float32"}]),lk=$r([{name:"a_color_3f",components:3,type:"Float32"}]),ck=$r([{name:"a_color_4f",components:4,type:"Float32"}]),uk=$r([{name:"a_uv_2f",components:2,type:"Float32"}]),hk=$r([{name:"a_normal_3f",components:3,type:"Float32"}]),dk=$r([{name:"a_normal_matrix0",components:4,type:"Float32"},{name:"a_normal_matrix1",components:4,type:"Float32"},{name:"a_normal_matrix2",components:4,type:"Float32"},{name:"a_normal_matrix3",components:4,type:"Float32"}]),fk=$r([{name:"a_pbr",components:4,type:"Uint16"},{name:"a_heightBasedEmissiveStrength",components:3,type:"Float32"}]),dT={None:0,Model:1,Symbol:2,FillExtrusion:4,All:7};class Xy{constructor(e,n,a,d){this.message=(e?`${e}: `:"")+a,d&&(this.identifier=d),n!=null&&n.__line__&&(this.line=n.__line__)}}function fT(s,e){const n=s.indexOf("://")===-1;try{return new URL(s,n&&e?"http://example.com":void 0),!0}catch{return!1}}class pT{constructor(e,n){this.feature=e,this.instancedDataOffset=n,this.instancedDataCount=0,this.rotation=[0,0,0],this.scale=[1,1,1],this.translation=[0,0,0]}}class mT{constructor(){this.instancedDataArray=new Gd,this.instancesEvaluatedElevation=[],this.features=[],this.idToFeaturesIndex={}}}class Pb{constructor(e){this.zoom=e.zoom,this.canonical=e.canonical,this.layers=e.layers,this.layerIds=this.layers.map(n=>n.fqid),this.projection=e.projection,this.index=e.index,this.hasZoomDependentProperties=this.layers[0].isZoomDependent(),this.stateDependentLayerIds=this.layers.filter(n=>n.isStateDependent()).map(n=>n.id),this.hasPattern=!1,this.instancesPerModel={},this.validForExaggeration=0,this.maxVerticalOffset=0,this.maxScale=0,this.maxHeight=0,this.lookupDim=this.zoom>this.canonical.z?256:this.zoom>15?75:100,this.instanceCount=0,this.terrainElevationMin=0,this.terrainElevationMax=0,this.validForDEMTile={id:null,timestamp:0},this.modelUris=[],this.modelsRequested=!1,this.activeReplacements=[],this.replacementUpdateTime=0}updateFootprints(e,n){}populate(e,n,a,d){this.tileToMeter=h(a);const c=this.layers[0]._featureFilter.needGeometry;this.lookup=new Uint8Array(this.lookupDim*this.lookupDim);for(const{feature:p,id:w,index:T,sourceLayerIndex:P}of e){const x=w??(p.properties&&p.properties.hasOwnProperty("id")?p.properties.id:void 0),C=G(p,c);if(!this.layers[0]._featureFilter.filter(new qr(this.zoom),C,a))continue;const A={id:x,sourceLayerIndex:P,index:T,geometry:c?C.geometry:U(p,a,d),properties:p.properties,type:p.type,patterns:{}},E=this.addFeature(A,A.geometry,C);E&&n.featureIndex.insert(p,A.geometry,T,P,this.index,this.instancesPerModel[E].instancedDataArray.length,pn/32)}this.lookup=null}update(e,n,a,d){for(const c in this.instancesPerModel){const p=this.instancesPerModel[c];for(const w in e)p.idToFeaturesIndex.hasOwnProperty(w)&&(this.evaluate(p.features[p.idToFeaturesIndex[w]],e[w],p,!0),this.uploaded=!1)}this.maxHeight=0}updateZoomBasedPaintProperties(){if(!this.hasZoomDependentProperties)return!1;let e=!1;for(const n in this.instancesPerModel){const a=this.instancesPerModel[n];for(const d of a.features){const c=this.layers[0],p=d.feature,w=this.canonical,T=c.paint.get("model-rotation").evaluate(p,{},w),P=c.paint.get("model-scale").evaluate(p,{},w),x=c.paint.get("model-translation").evaluate(p,{},w);Re.vec3.exactEquals(d.rotation,T)&&Re.vec3.exactEquals(d.scale,P)&&Re.vec3.exactEquals(d.translation,x)||(this.evaluate(d,d.featureStates,a,!0),e=!0)}}return e}updateReplacement(e,n,a,d){if(n.updateTime===this.replacementUpdateTime)return!1;this.replacementUpdateTime=n.updateTime;const c=n.getReplacementRegionsForTile(e.toUnwrapped(),!0);if(tb(this.activeReplacements,c))return!1;this.activeReplacements=c;let p=!1;for(const w in this.instancesPerModel){const T=this.instancesPerModel[w],P=T.instancedDataArray;for(const x of T.features){const C=x.instancedDataOffset,A=x.instancedDataCount;for(let E=0;E<A;E++){const M=16*(E+C);let k=P.float32[M+0];const N=k>pn;k=N?k-pn:k;const j=Math.floor(k),q=P.float32[M+1];let X=!1;for(const W of this.activeReplacements)if(!P2(W,a,dT.Model,d)&&!(W.min.x>j||j>W.max.x||W.min.y>q||q>W.max.y)&&(X=D2(O2(j,q,e.canonical,W.footprintTileId.canonical),W.footprint),X))break;P.float32[M]=X?k+pn:k,p=p||X!==N}}}return p}isEmpty(){for(const e in this.instancesPerModel)if(this.instancesPerModel[e].instancedDataArray.length!==0)return!1;return!0}uploadPending(){return!this.uploaded}upload(e){if(!this.uploaded)for(const n in this.instancesPerModel){const a=this.instancesPerModel[n];a.instancedDataArray.length<0||a.instancedDataArray.length===0||(a.instancedDataBuffer?a.instancedDataBuffer.updateData(a.instancedDataArray):a.instancedDataBuffer=e.createVertexBuffer(a.instancedDataArray,dk.members,!0,void 0,this.instanceCount))}this.uploaded=!0}destroy(){for(const n in this.instancesPerModel){const a=this.instancesPerModel[n];a.instancedDataArray.length!==0&&a.instancedDataBuffer&&a.instancedDataBuffer.destroy()}const e=this.layers[0].modelManager;if(e&&this.modelUris)for(const n of this.modelUris)e.removeModel(n,"")}addFeature(e,n,a){const d=this.layers[0],c=d.layout.get("model-id").evaluate(a,{},this.canonical);if(!c)return nr(`modelId is not evaluated for layer ${d.id} and it is not going to get rendered.`),c;fT(c,!1)&&(this.modelUris.includes(c)||this.modelUris.push(c)),this.instancesPerModel[c]||(this.instancesPerModel[c]=new mT);const p=this.instancesPerModel[c],w=p.instancedDataArray,T=new pT(a,w.length);for(const P of n)for(const x of P){if(x.x<0||x.x>=pn||x.y<0||x.y>=pn)continue;const C=(this.lookupDim-1)/pn,A=this.lookupDim*(x.y*C|0)+x.x*C|0;if(this.lookup){if(this.lookup[A]!==0)continue;this.lookup[A]=1}this.instanceCount++;const E=w.length;w.resize(E+1),p.instancesEvaluatedElevation.push(0),w.float32[16*E]=x.x,w.float32[16*E+1]=x.y}return T.instancedDataCount=p.instancedDataArray.length-T.instancedDataOffset,T.instancedDataCount>0&&(e.id&&(p.idToFeaturesIndex[e.id]=p.features.length),p.features.push(T),this.evaluate(T,{},p,!1)),c}getModelUris(){return this.modelUris}evaluate(e,n,a,d){const c=this.layers[0],p=e.feature,w=this.canonical,T=e.rotation=c.paint.get("model-rotation").evaluate(p,n,w),P=e.scale=c.paint.get("model-scale").evaluate(p,n,w),x=e.translation=c.paint.get("model-translation").evaluate(p,n,w),C=c.paint.get("model-color").evaluate(p,n,w);C.a=c.paint.get("model-color-mix-intensity").evaluate(p,n,w);const A=[];this.maxVerticalOffset<x[2]&&(this.maxVerticalOffset=x[2]),this.maxScale=Math.max(Math.max(this.maxScale,P[0]),Math.max(P[1],P[2])),uT(A,T,P);const E=Math.round(100*C.a)+C.b/1.05;for(let M=0;M<e.instancedDataCount;++M){const k=e.instancedDataOffset+M,N=16*k,j=a.instancedDataArray.float32;let q=0;d&&(q=j[N+6]-a.instancesEvaluatedElevation[k]);const X=0|j[N+1];j[N]=(0|j[N])+C.r/1.05,j[N+1]=X+C.g/1.05,j[N+2]=E,j[N+3]=1/(w.z>10?this.tileToMeter:h(w,X)),j[N+4]=x[0],j[N+5]=x[1],j[N+6]=x[2]+q,j[N+7]=A[0],j[N+8]=A[1],j[N+9]=A[2],j[N+10]=A[4],j[N+11]=A[5],j[N+12]=A[6],j[N+13]=A[8],j[N+14]=A[9],j[N+15]=A[10],a.instancesEvaluatedElevation[k]=x[2]}}}let gT,_T;qe(Pb,"ModelBucket",{omit:["layers"]}),qe(mT,"PerModelAttributes"),qe(pT,"ModelFeature");const $p=64,Lm={CoordinateSpaceTile:1,CoordinateSpaceYUp:2,HasMapboxMeshFeatures:4,HasMeshoptCompression:8};function yT(s,e,n,a,d,c,p,w,T,P=!1){const x=n.zoom,C=n.project(a),A=t(a.lat,x),E=1/A;Re.mat4.identity(s),Re.mat4.translate(s,s,[C.x+p[0]*E,C.y+p[1]*E,p[2]]);let M=1,k=1;const N=n.worldSize;if(P){if(n.projection.name==="mercator"){let W=0;n.elevation&&(W=n.elevation.getAtPointOrZero(new g(C.x/N,C.y/N),0));const J=Re.vec4.transformMat4([],[C.x,C.y,W,1],n.projMatrix)[3]/n.cameraToCenterDistance;M=J,k=J*t(n.center.lat,x)}else if(n.projection.name==="globe"){const W=Ib(s,n),J=Re.mat4.multiply([],n.projMatrix,W),ne=[0,0,0,1];Re.vec4.transformMat4(ne,ne,J);const he=ne[3]/n.cameraToCenterDistance,we=na(x),be=n.projection.pixelsPerMeter(a.lat,N)*t(a.lat,x),ve=n.projection.pixelsPerMeter(n.center.lat,N)*t(n.center.lat,x);M=he/kn(be,u(n.center.lat),we),k=he*A/be,M*=ve,k*=ve}}else M=E;Re.mat4.scale(s,s,[M,M,k]);const j=[...s],q=e.orientation,X=[];if(uT(X,[q[0]+d[0],q[1]+d[1],q[2]+d[2]],c),Re.mat4.multiply(s,j,X),w&&n.elevation){let W=0;const J=[];if(T&&n.elevation){W=function(we,be,ve,Be,Me){const Ue=be.elevation;if(!Ue)return 0;const Ye=Bn.projectAabbCorners(ve,Be),Xe=Ki(1,Me.lat)*be.worldSize,Je=function(Pn,dn){const Cn=[0,0,1],Zn=[{corners:[0,1,3,2],dotProductWithUp:0},{corners:[1,5,2,6],dotProductWithUp:0},{corners:[0,4,1,5],dotProductWithUp:0},{corners:[2,6,3,7],dotProductWithUp:0},{corners:[4,7,5,6],dotProductWithUp:0},{corners:[0,3,4,7],dotProductWithUp:0}];for(const xr of Zn){const Cr=Pn[xr.corners[0]],Or=Pn[xr.corners[1]],Mr=Pn[xr.corners[2]],Zr=[Or[0]-Cr[0],Or[1]-Cr[1],dn*(Or[2]-Cr[2])],Bi=Re.vec3.cross(Zr,Zr,[Mr[0]-Cr[0],Mr[1]-Cr[1],dn*(Mr[2]-Cr[2])]);Re.vec3.normalize(Bi,Bi),xr.dotProductWithUp=Re.vec3.dot(Bi,Cn)}return Zn.sort((xr,Cr)=>xr.dotProductWithUp-Cr.dotProductWithUp),Zn[0].corners}(Ye,Xe),st=Ye[Je[0]],pt=Ye[Je[1]],ot=Ye[Je[2]],It=Ye[Je[3]],tn=Ue.getAtPointOrZero(new g(st[0]/be.worldSize,st[1]/be.worldSize),0),Lt=Ue.getAtPointOrZero(new g(pt[0]/be.worldSize,pt[1]/be.worldSize),0),un=Ue.getAtPointOrZero(new g(ot[0]/be.worldSize,ot[1]/be.worldSize),0),cn=Ue.getAtPointOrZero(new g(It[0]/be.worldSize,It[1]/be.worldSize),0),vn=(tn+cn)/2,Bt=(Lt+un)/2;return vn>Bt?Lt<un?Zy(we,pt,It,st,Lt,cn,tn,Xe):Zy(we,ot,st,It,un,tn,cn,Xe):tn<cn?Zy(we,st,pt,ot,tn,Lt,un,Xe):Zy(we,It,ot,pt,cn,un,Lt,Xe),Math.max(vn,Bt)}(J,n,e.aabb,s,a);const ne=Re.mat4.fromQuat([],J),he=Re.mat4.multiply([],ne,X);Re.mat4.multiply(s,j,he)}else W=n.elevation.getAtPointOrZero(new g(C.x/N,C.y/N),0);W!==0&&(s[14]+=W)}}function Kg(s,e,n=!1){s.uploaded||(s.gfxTexture=new Cb(e,s.image,n?e.gl.R8:e.gl.RGBA8,{useMipmap:s.sampler.minFilter>=e.gl.NEAREST_MIPMAP_NEAREST}),s.uploaded=!0,s.image=null)}function pk(s,e,n){s.indexBuffer=e.createIndexBuffer(s.indexArray,!1,!0),s.vertexBuffer=e.createVertexBuffer(s.vertexArray,ak.members,!1,!0),s.normalArray&&(s.normalBuffer=e.createVertexBuffer(s.normalArray,hk.members,!1,!0)),s.texcoordArray&&(s.texcoordBuffer=e.createVertexBuffer(s.texcoordArray,uk.members,!1,!0)),s.colorArray&&(s.colorBuffer=e.createVertexBuffer(s.colorArray,(s.colorArray.bytesPerElement===12?lk:ck).members,!1,!0)),s.featureArray&&(s.pbrBuffer=e.createVertexBuffer(s.featureArray,fk.members,!0)),s.segments=vo.simpleSegment(0,0,s.vertexArray.length,s.indexArray.length);const a=s.material;a.pbrMetallicRoughness.baseColorTexture&&Kg(a.pbrMetallicRoughness.baseColorTexture,e),a.pbrMetallicRoughness.metallicRoughnessTexture&&Kg(a.pbrMetallicRoughness.metallicRoughnessTexture,e),a.normalTexture&&Kg(a.normalTexture,e),a.occlusionTexture&&Kg(a.occlusionTexture,e,n),a.emissionTexture&&Kg(a.emissionTexture,e)}function Rb(s,e,n){if(s.meshes)for(const a of s.meshes)pk(a,e,n);if(s.children)for(const a of s.children)Rb(a,e,n)}function Yy(s){if(s.meshes)for(const e of s.meshes)e.indexArray.destroy(),e.vertexArray.destroy(),e.colorArray&&e.colorArray.destroy(),e.normalArray&&e.normalArray.destroy(),e.texcoordArray&&e.texcoordArray.destroy(),e.featureArray&&e.featureArray.destroy();if(s.children)for(const e of s.children)Yy(e)}function kb(s){if(s.meshes)for(const n of s.meshes)n.vertexBuffer&&(n.vertexBuffer.destroy(),n.indexBuffer.destroy(),n.normalBuffer&&n.normalBuffer.destroy(),n.texcoordBuffer&&n.texcoordBuffer.destroy(),n.colorBuffer&&n.colorBuffer.destroy(),n.pbrBuffer&&n.pbrBuffer.destroy(),n.segments.destroy(),n.material&&((e=n.material).pbrMetallicRoughness.baseColorTexture&&e.pbrMetallicRoughness.baseColorTexture.gfxTexture&&e.pbrMetallicRoughness.baseColorTexture.gfxTexture.destroy(),e.pbrMetallicRoughness.metallicRoughnessTexture&&e.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture&&e.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture.destroy(),e.normalTexture&&e.normalTexture.gfxTexture&&e.normalTexture.gfxTexture.destroy(),e.emissionTexture&&e.emissionTexture.gfxTexture&&e.emissionTexture.gfxTexture.destroy(),e.occlusionTexture&&e.occlusionTexture.gfxTexture&&e.occlusionTexture.gfxTexture.destroy()));var e;if(s.children)for(const n of s.children)kb(n)}class Om{constructor(e,n,a){this._demTile=e,this._dem=this._demTile.dem,this._scale=n,this._offset=a}static create(e,n,a){const d=a||e.findDEMTileFor(n);if(!d||!d.dem)return;const c=d.dem,p=d.tileID,w=1<<n.canonical.z-p.canonical.z;return new Om(d,c.dim/pn/w,[(n.canonical.x/w-p.canonical.x)*c.dim,(n.canonical.y/w-p.canonical.y)*c.dim])}tileCoordToPixel(e,n){const a=n*this._scale+this._offset[1],d=Math.floor(e*this._scale+this._offset[0]),c=Math.floor(a);return new Ht(d,c)}getElevationAt(e,n,a,d){const c=e*this._scale+this._offset[0],p=n*this._scale+this._offset[1],w=Math.floor(c),T=Math.floor(p),P=this._dem;return d=!!d,a?kn(kn(P.get(w,T,d),P.get(w,T+1,d),p-T),kn(P.get(w+1,T,d),P.get(w+1,T+1,d),p-T),c-w):P.get(w,T,d)}getElevationAtPixel(e,n,a){return this._dem.get(e,n,!!a)}getMeterToDEM(e){return(1<<this._demTile.tileID.canonical.z)*Ki(1,e)*this._dem.stride}}const zb=new Float32Array(262144),Vp=new Uint8Array(262144);function vT(s){let e=0;if(s.meshes)for(const n of s.meshes)e=Math.max(e,n.aabb.max[2]);if(s.children)for(const n of s.children)e=Math.max(e,vT(n));return e}function xT(s,e,n){if(s.meshes)for(const a of s.meshes){if(a.aabb.min[0]===1/0)continue;const d=Bn.applyTransform(a.aabb,s.matrix);n.insert(e,d.min[0],d.min[1],d.max[0],d.max[1])}if(s.children)for(const a of s.children)xT(a,e,n)}const bT=["","wall","door","roof","window","lamp","logo"];class wT{constructor(e){this.node=e,this.evaluatedRMEA=[[1,0,0,1],[1,0,0,1],[1,0,0,1],[1,0,0,1],[.4,1,0,1],[1,0,0,1],[1,0,0,1]],this.hiddenByReplacement=!1,this.evaluatedScale=[1,1,1],this.evaluatedColor=[],this.emissionHeightBasedParams=[],this.cameraCollisionOpacity=1,this.feature={type:"Point",id:e.id,geometry:[],properties:{height:vT(e)}},this.aabb=this._getLocalBounds(),this.state=null}_getLocalBounds(){if(!this.node.meshes)return new Bn([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);if(!this.aabb){let e=0;const n=new Bn([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);for(const a of this.node.meshes)this.node.lightMeshIndex!==e&&(a.transformedAabb=Bn.applyTransformFast(a.aabb,this.node.matrix),n.encapsulate(a.transformedAabb)),e++;this.aabb=n}return this.aabb}}class Ky{constructor(e,n,a,d,c,p,w){this.id=a,this.layers=e,this.layerIds=this.layers.map(T=>T.fqid),this.stateDependentLayerIds=this.layers.filter(T=>T.isStateDependent()).map(T=>T.id),this.modelTraits|=Lm.CoordinateSpaceTile,this.uploaded=!1,this.hasPattern=!1,d&&(this.modelTraits|=Lm.HasMapboxMeshFeatures),c&&(this.modelTraits|=Lm.HasMeshoptCompression),this.zoom=-1,this.terrainExaggeration=1,this.projection={name:"mercator"},this.replacementUpdateTime=0,this.elevationReadFromZ=255,this.brightness=p,this.dirty=!0,this.needsUpload=!1,this.nodesInfo=[];for(const T of n)this.nodesInfo.push(new wT(T)),xT(T,w.featureIndexArray.length,w.grid),w.featureIndexArray.emplaceBack(this.nodesInfo.length-1,0,w.bucketLayerIDs.length-1,0);this.states={}}updateFootprints(e,n){for(const a of this.getNodesInfo()){const d=a.node;d.footprint&&n.push({footprint:d.footprint,id:e})}}update(e){const n=Object.keys(e).length!==0;if(n&&!this.stateDependentLayers.length)return;const a=n?this.stateDependentLayers:this.layers;if(!Wr(e,this.states))for(const d of a)this.evaluate(d,e);this.states=structuredClone(e)}populate(){console.log("populate 3D model bucket")}uploadPending(){return!this.uploaded||this.needsUpload}upload(e){if(!this.needsUpload)return;const n=this.getNodesInfo();for(const a of n){const d=a.node;this.uploaded?this.updatePbrBuffer(d):Rb(d,e,!0)}for(const a of n)Yy(a.node);this.uploaded=!0,this.needsUpload=!1}updatePbrBuffer(e){let n=!1;if(!e.meshes)return n;for(const a of e.meshes)a.pbrBuffer&&(a.pbrBuffer.updateData(a.featureArray),n=!0);return n}needsReEvaluation(e,n,a){const d=e.transform.projectionOptions,c=e.style.getBrightness(),p=this.brightness!==c;if(!this.uploaded||this.dirty||d.name!==this.projection.name||Jg(a.paint.get("model-color").value,p)||Jg(a.paint.get("model-color-mix-intensity").value,p)||Jg(a.paint.get("model-roughness").value,p)||Jg(a.paint.get("model-emissive-strength").value,p)||Jg(a.paint.get("model-height-based-emissive-strength-multiplier").value,p)){this.projection=d,this.brightness=c;const w=this.getNodesInfo();for(const T of w)T.state=null;return!0}return!1}evaluateScale(e,n){if(e.transform.zoom===this.zoom)return;this.zoom=e.transform.zoom;const a=this.getNodesInfo(),d=this.id.canonical;for(const c of a){const p=c.feature;c.evaluatedScale=n.paint.get("model-scale").evaluate(p,{},d)}}evaluate(e,n){const a=this.getNodesInfo();for(const d of a){if(!d.node.meshes)continue;const c=d.feature,p=n&&n[c.id];if(Wr(p,d.state))continue;d.state=structuredClone(p);const w=d.node.meshes&&d.node.meshes[0].featureData,T=d.evaluatedColor[2],P=d.evaluatedRMEA[2],x=this.id.canonical;if(d.hasTranslucentParts=!1,w){for(let C=0;C<bT.length;C++){const A=bT[C];A.length&&(c.properties.part=A);const E=e.paint.get("model-color").evaluate(c,p,x).toRenderColor(null),M=e.paint.get("model-color-mix-intensity").evaluate(c,p,x);d.evaluatedColor[C]=[E.r,E.g,E.b,M],d.evaluatedRMEA[C][0]=e.paint.get("model-roughness").evaluate(c,p,x),d.evaluatedRMEA[C][2]=e.paint.get("model-emissive-strength").evaluate(c,p,x),d.evaluatedRMEA[C][3]=E.a,d.emissionHeightBasedParams[C]=e.paint.get("model-height-based-emissive-strength-multiplier").evaluate(c,p,x),!d.hasTranslucentParts&&E.a<1&&(d.hasTranslucentParts=!0)}delete c.properties.part,gk(d,T!==d.evaluatedColor[2]||P!==d.evaluatedRMEA[2],this.modelTraits)}else d.evaluatedRMEA[0][2]=e.paint.get("model-emissive-strength").evaluate(c,p,x);d.evaluatedScale=e.paint.get("model-scale").evaluate(c,p,x),this.updatePbrBuffer(d.node)||(this.needsUpload=!0)}this.dirty=!1}elevationUpdate(e,n,a,d){const c=e.findDEMTileFor(a);if(c&&(c.tileID.canonical!==this.terrainTile||n!==this.terrainExaggeration)){if(c.dem&&c.tileID.overscaledZ!==this.elevationReadFromZ){this.elevationReadFromZ=c.tileID.overscaledZ;const p=Om.create(e,a,c);if(!p)return;this.modelTraits&Lm.HasMapboxMeshFeatures&&this.updateDEM(e,p,a,d);for(const w of this.getNodesInfo()){const T=w.node;if(!T.footprint||!T.footprint.vertices||!T.footprint.vertices.length)continue;const P=T.footprint.vertices;let x=p.getElevationAt(P[0].x,P[0].y,!0,!0);for(let C=1;C<P.length;C++)x=Math.min(x,p.getElevationAt(P[C].x,P[C].y,!0,!0));T.elevation=x}}this.terrainTile=c.tileID.canonical,this.terrainExaggeration=n}}updateDEM(e,n,a,d){let c=n._dem._modifiedForSources[d];if(c===void 0&&(n._dem._modifiedForSources[d]=[],c=n._dem._modifiedForSources[d]),c.includes(a.canonical))return;const p=n._dem.dim;c.push(a.canonical);let w=!1;for(const T of this.getNodesInfo()){const P=T.node;if(!P.footprint||!P.footprint.grid)continue;const x=P.footprint.grid,C=n.tileCoordToPixel(x.min.x,x.min.y),A=n.tileCoordToPixel(x.max.x,x.max.y),E=Math.min(Math.min(p-A.y,C.x),Math.min(C.y,p-A.x));if(E<0)continue;const M=yn(E,2,5);let k=Math.max(0,C.x-M),N=Math.max(0,C.y-M),j=Math.min(A.x+M,p-1),q=Math.min(A.y+M,p-1);for(let ne=N;ne<=q;++ne)for(let he=k;he<=j;++he)Vp[ne*p+he]=255;let X=0,W=0;for(let ne=0;ne<x.cellsY;++ne)for(let he=0;he<x.cellsX;++he){if(!x.cells[ne*x.cellsX+he])continue;const we=n.tileCoordToPixel(x.min.x+he/x.xScale,x.min.y+ne/x.yScale),be=n.tileCoordToPixel(x.min.x+(he+1)/x.xScale,x.min.y+(ne+1)/x.yScale);for(let ve=we.y;ve<=Math.min(be.y+1,p-1);++ve)for(let Be=we.x;Be<=Math.min(be.x+1,p-1);++Be)Vp[ve*p+Be]===255&&(Vp[ve*p+Be]=0,X+=n.getElevationAtPixel(Be,ve),W++)}const J=X/W;k=Math.max(1,C.x-M),N=Math.max(1,C.y-M),j=Math.min(A.x+M,p-2),q=Math.min(A.y+M,p-2),w=!0;for(let ne=N;ne<=q;++ne)for(let he=k;he<=j;++he)Vp[ne*p+he]===0&&(zb[ne*p+he]=n._dem.set(he,ne,J));for(let ne=1;ne<M;++ne){k=Math.max(1,C.x-ne),N=Math.max(1,C.y-ne),j=Math.min(A.x+ne,p-2),q=Math.min(A.y+ne,p-2);for(let he=N;he<=q;++he)for(let we=k;we<=j;++we){const be=he*p+we;if(Vp[be]===255){let ve=0,Be=0,Me=-1,Ue=-1;for(let Ye=-1;Ye<=1;++Ye)for(let Xe=-1;Xe<=1;++Xe){const Je=(he+Ye)*p+we+Xe;if(Vp[Je]>=ne)continue;const st=zb[Je],pt=Math.abs(st);pt>Be&&(ve=st,Be=pt,Me=Xe,Ue=Ye)}if(Be>.1){const Ye=1-(ne+.5*Math.abs(Me*Ue))/M;let Xe=n._dem.get(we,he)+ve*Ye;const Je=n._dem.get(we+Me,he+Ue),st=n._dem.get(we-Me,he-Ue,!0);(Xe-Je)*(Xe-st)>0&&(Xe=(Je+st)/2),zb[be]=n._dem.set(we,he,Xe),Vp[be]=ne}}}}}w&&(n._demTile.needsDEMTextureUpload=!0,n._dem._timestamp=fn.now())}getNodesInfo(){return this.nodesInfo}destroy(){const e=this.getNodesInfo();for(const n of e)Yy(n.node),kb(n.node)}isEmpty(){return!this.nodesInfo.length}updateReplacement(e,n){if(n.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=n.updateTime;const a=n.getReplacementRegionsForTile(e.toUnwrapped()),d=this.getNodesInfo();for(let c=0;c<this.nodesInfo.length;c++){const p=d[c].node;d[c].hiddenByReplacement=!!p.footprint&&!a.find(w=>w.footprint===p.footprint)}}getHeightAtTileCoord(e,n){const a=this.getNodesInfo(),d=[],c=[0,0,0],p=Re.mat4.identity([]);for(let w=0;w<this.nodesInfo.length;w++){const T=a[w],P=T.node.meshes[0],x=P.transformedAabb;if(e<x.min[0]||n<x.min[1]||e>x.max[0]||n>x.max[1])continue;if(T.node.hidden===!0)return{height:1/0,maxHeight:T.feature.properties.height,hidden:!1,verticalScale:T.evaluatedScale[2]};Re.mat4.invert(p,T.node.matrix),c[0]=e,c[1]=n,Re.vec3.transformMat4(c,c,p);const C=(c[0]-P.aabb.min[0])/(P.aabb.max[0]-P.aabb.min[0])*$p|0,A=Math.min(63,(c[1]-P.aabb.min[1])/(P.aabb.max[1]-P.aabb.min[1])*$p|0)*$p+Math.min(63,C),E=P.heightmap[A];if(!(E<0&&T.node.footprint))return T.hiddenByReplacement?void 0:{height:E,maxHeight:T.feature.properties.height,hidden:!1,verticalScale:T.evaluatedScale[2]};if(T.node.footprint.grid.query(new Ht(e,n),new Ht(e,n),d),d.length>0)return{height:void 0,maxHeight:T.feature.properties.height,hidden:T.hiddenByReplacement,verticalScale:T.evaluatedScale[2]}}}}function Jg(s,e){return!s.isLightConstant&&e}function mk(s,e,n,a,d,c,p,w){let T=(61440&e|(61440&e)>>4)>>8,P=(3840&e|(3840&e)>>4)>>4,x=240&e|(240&e)>>4;n[3]>0&&(T=kn(T,255*n[0],n[3]),P=kn(P,255*n[1],n[3]),x=kn(x,255*n[2],n[3]));const C=T<<8|P,A=x<<8|Math.floor(255*a[3]),E=function(ne){const he=yn(ne,0,2);return Math.min(Math.round(.5*he*255),255)}(a[2])<<8|15*a[0]<<4|15*a[1],M=yn(d[0],0,1),k=yn(d[1],0,1),N=yn(d[2],0,1),j=yn(d[3],0,1);let q,X,W,J;if(M!==k&&p!==c&&k!==M){const ne=p-c;X=1/(ne*(k-M)),W=-(c+ne*M)/(ne*(k-M));const he=yn(d[4],-1,1);J=Math.pow(10,he),q=255*N<<8|255*j}else q=65535,X=0,W=1,J=1;if(s.emplaceBack(C,A,E,q,X,W,J),w){const ne=w.length;w.clear();for(let he=0;he<ne;he++)w.emplaceBack(C,A,E,q,X,W,J)}}function gk(s,e,n){const a=s.node;let d=0;const c=n&Lm.HasMeshoptCompression;for(const p of a.meshes){if(a.lights&&a.lightMeshIndex===d||!p.featureData)continue;p.featureArray=new id,p.featureArray.reserve(p.featureData.length);let w=e;for(const T of p.featureData){const P=c?65535&T:T>>16&65535,x=c?T>>16&65535:65535&T,C=(15&x)<8?15&x:0,A=s.evaluatedRMEA[C],E=s.evaluatedColor[C],M=s.emissionHeightBasedParams[C];let k;if(w&&C===2&&a.lights&&(k=new id,k.resize(10*a.lights.length)),mk(p.featureArray,P,E,A,M,p.aabb.min[2],p.aabb.max[2],k),k&&w){w=!1;const N=a.meshes[a.lightMeshIndex];N.featureArray=k,N.featureArray._trim()}}p.featureArray._trim(),d++}}function ST(s,e,n,a){const d=1<<s.z;e.lat=jn((a/pn+s.y)/d),e.lng=qa((n/pn+s.x)/d)}qe(Ky,"Tiled3dModelBucket",{omit:["layers"]}),qe(wT,"Tiled3dModelFeature");const _k={circle:class extends vi{constructor(s,e,n,a){super(s,{layout:Ft||(Ft=new $i({"circle-sort-key":new an(yt.layout_circle["circle-sort-key"]),visibility:new Zt(yt.layout_circle.visibility)})),paint:Et||(Et=new $i({"circle-radius":new an(yt.paint_circle["circle-radius"]),"circle-color":new an(yt.paint_circle["circle-color"]),"circle-blur":new an(yt.paint_circle["circle-blur"]),"circle-opacity":new an(yt.paint_circle["circle-opacity"]),"circle-translate":new Zt(yt.paint_circle["circle-translate"]),"circle-translate-anchor":new Zt(yt.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new Zt(yt.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new Zt(yt.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new an(yt.paint_circle["circle-stroke-width"]),"circle-stroke-color":new an(yt.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new an(yt.paint_circle["circle-stroke-opacity"]),"circle-emissive-strength":new Zt(yt.paint_circle["circle-emissive-strength"]),"circle-color-use-theme":new an({type:"string",default:"default","property-type":"data-driven"}),"circle-stroke-color-use-theme":new an({type:"string",default:"default","property-type":"data-driven"})}))},e,n,a)}createBucket(s){return new ue(s)}queryRadius(s){const e=s;return zt("circle-radius",this,e)+zt("circle-stroke-width",this,e)+Gt(this.paint.get("circle-translate"))}queryIntersectsFeature(s,e,n,a,d,c,p,w){const T=dt(this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),c.angle,s.pixelToTileUnitsFactor),P=this.paint.get("circle-radius").evaluate(e,n)+this.paint.get("circle-stroke-width").evaluate(e,n);return kg(s,a,c,p,w,this.paint.get("circle-pitch-alignment")==="map",this.paint.get("circle-pitch-scale")==="map",T,P)}getProgramIds(){return["circle"]}getDefaultProgramParams(s,e,n){const a=Vf(this);return{config:new lu(this,{zoom:e,lut:n}),defines:a,overrideFog:!1}}},heatmap:class extends vi{createBucket(s){return new vy(s)}constructor(s,e,n,a){super(s,{layout:xh||(xh=new $i({visibility:new Zt(yt.layout_heatmap.visibility)})),paint:Fp||(Fp=new $i({"heatmap-radius":new an(yt.paint_heatmap["heatmap-radius"]),"heatmap-weight":new an(yt.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new Zt(yt.paint_heatmap["heatmap-intensity"]),"heatmap-color":new Qs(yt.paint_heatmap["heatmap-color"]),"heatmap-opacity":new Zt(yt.paint_heatmap["heatmap-opacity"]),"heatmap-color-use-theme":new an({type:"string",default:"default","property-type":"data-driven"})}))},e,n,a),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(s){s==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=Uf({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(s){return zt("heatmap-radius",this,s)}queryIntersectsFeature(s,e,n,a,d,c,p,w){const T=this.paint.get("heatmap-radius").evaluate(e,n);return kg(s,a,c,p,w,!0,!0,new Ht(0,0),T)}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}getProgramIds(){return["heatmap","heatmapTexture"]}getDefaultProgramParams(s,e,n){return s==="heatmap"?{config:new lu(this,{zoom:e,lut:n}),overrideFog:!1}:{}}},hillshade:class extends vi{constructor(s,e,n,a){super(s,{layout:fd||(fd=new $i({visibility:new Zt(yt.layout_hillshade.visibility)})),paint:Bp||(Bp=new $i({"hillshade-illumination-direction":new Zt(yt.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new Zt(yt.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new Zt(yt.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new Zt(yt.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new Zt(yt.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new Zt(yt.paint_hillshade["hillshade-accent-color"]),"hillshade-emissive-strength":new Zt(yt.paint_hillshade["hillshade-emissive-strength"]),"hillshade-shadow-color-use-theme":new an({type:"string",default:"default","property-type":"data-driven"}),"hillshade-highlight-color-use-theme":new an({type:"string",default:"default","property-type":"data-driven"}),"hillshade-accent-color-use-theme":new an({type:"string",default:"default","property-type":"data-driven"})}))},e,n,a)}shouldRedrape(){return this.hasOffscreenPass()&&this.paint.get("hillshade-illumination-anchor")==="viewport"}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}getProgramIds(){return["hillshade","hillshadePrepare"]}getDefaultProgramParams(s,e,n){return{overrideFog:!1}}},fill:class extends vi{constructor(s,e,n,a){super(s,{layout:Wt||(Wt=new $i({"fill-sort-key":new an(yt.layout_fill["fill-sort-key"]),visibility:new Zt(yt.layout_fill.visibility),"fill-elevation-reference":new Zt(yt.layout_fill["fill-elevation-reference"])})),paint:Pt||(Pt=new $i({"fill-antialias":new Zt(yt.paint_fill["fill-antialias"]),"fill-opacity":new an(yt.paint_fill["fill-opacity"]),"fill-color":new an(yt.paint_fill["fill-color"]),"fill-outline-color":new an(yt.paint_fill["fill-outline-color"]),"fill-translate":new Zt(yt.paint_fill["fill-translate"]),"fill-translate-anchor":new Zt(yt.paint_fill["fill-translate-anchor"]),"fill-pattern":new an(yt.paint_fill["fill-pattern"]),"fill-emissive-strength":new Zt(yt.paint_fill["fill-emissive-strength"]),"fill-z-offset":new an(yt.paint_fill["fill-z-offset"]),"fill-color-use-theme":new an({type:"string",default:"default","property-type":"data-driven"}),"fill-outline-color-use-theme":new an({type:"string",default:"default","property-type":"data-driven"})}))},e,n,a)}getProgramIds(){const s=this.paint.get("fill-pattern"),e=s&&s.constantOr(1),n=[e?"fillPattern":"fill"];return this.paint.get("fill-antialias")&&n.push(e&&!this.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline"),n}getDefaultProgramParams(s,e,n){return{config:new lu(this,{zoom:e,lut:n}),overrideFog:!1}}recalculate(s,e){super.recalculate(s,e);const n=this.paint._values["fill-outline-color"];n.value.kind==="constant"&&n.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(s){return new xs(s)}queryRadius(){return Gt(this.paint.get("fill-translate"))}queryIntersectsFeature(s,e,n,a,d,c){return!s.queryGeometry.isAboveHorizon&&Ae(Yt(s.tilespaceGeometry,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),c.angle,s.pixelToTileUnitsFactor),a)}isTileClipped(){return!0}is3D(){return this.paint.get("fill-z-offset").constantOr(1)!==0}},"fill-extrusion":class extends vi{constructor(s,e,n,a){super(s,{layout:K2||(K2=new $i({visibility:new Zt(yt["layout_fill-extrusion"].visibility),"fill-extrusion-edge-radius":new Zt(yt["layout_fill-extrusion"]["fill-extrusion-edge-radius"])})),paint:J2||(J2=new $i({"fill-extrusion-opacity":new Zt(yt["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new an(yt["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new Zt(yt["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new Zt(yt["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new an(yt["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new an(yt["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new an(yt["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-height-alignment":new Zt(yt["paint_fill-extrusion"]["fill-extrusion-height-alignment"]),"fill-extrusion-base-alignment":new Zt(yt["paint_fill-extrusion"]["fill-extrusion-base-alignment"]),"fill-extrusion-vertical-gradient":new Zt(yt["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"]),"fill-extrusion-ambient-occlusion-intensity":new Zt(yt["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-intensity"]),"fill-extrusion-ambient-occlusion-radius":new Zt(yt["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-radius"]),"fill-extrusion-ambient-occlusion-wall-radius":new Zt(yt["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-wall-radius"]),"fill-extrusion-ambient-occlusion-ground-radius":new Zt(yt["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-radius"]),"fill-extrusion-ambient-occlusion-ground-attenuation":new Zt(yt["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-attenuation"]),"fill-extrusion-flood-light-color":new Zt(yt["paint_fill-extrusion"]["fill-extrusion-flood-light-color"]),"fill-extrusion-flood-light-intensity":new Zt(yt["paint_fill-extrusion"]["fill-extrusion-flood-light-intensity"]),"fill-extrusion-flood-light-wall-radius":new an(yt["paint_fill-extrusion"]["fill-extrusion-flood-light-wall-radius"]),"fill-extrusion-flood-light-ground-radius":new an(yt["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-radius"]),"fill-extrusion-flood-light-ground-attenuation":new Zt(yt["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-attenuation"]),"fill-extrusion-vertical-scale":new Zt(yt["paint_fill-extrusion"]["fill-extrusion-vertical-scale"]),"fill-extrusion-rounded-roof":new Zt(yt["paint_fill-extrusion"]["fill-extrusion-rounded-roof"]),"fill-extrusion-cutoff-fade-range":new Zt(yt["paint_fill-extrusion"]["fill-extrusion-cutoff-fade-range"]),"fill-extrusion-emissive-strength":new an(yt["paint_fill-extrusion"]["fill-extrusion-emissive-strength"]),"fill-extrusion-line-width":new an(yt["paint_fill-extrusion"]["fill-extrusion-line-width"]),"fill-extrusion-cast-shadows":new Zt(yt["paint_fill-extrusion"]["fill-extrusion-cast-shadows"]),"fill-extrusion-color-use-theme":new an({type:"string",default:"default","property-type":"data-driven"}),"fill-extrusion-flood-light-color-use-theme":new an({type:"string",default:"default","property-type":"data-driven"})}))},e,n,a),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(s){return new Cy(s)}queryRadius(){return Gt(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}hasShadowPass(){return this.paint.get("fill-extrusion-cast-shadows")}cutoffRange(){return this.paint.get("fill-extrusion-cutoff-fade-range")}canCastShadows(){return!0}getProgramIds(){return[this.paint.get("fill-extrusion-pattern").constantOr(1)?"fillExtrusionPattern":"fillExtrusion"]}queryIntersectsFeature(s,e,n,a,d,c,p,w,T){const P=dt(this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),c.angle,s.pixelToTileUnitsFactor),x=this.paint.get("fill-extrusion-height").evaluate(e,n),C=this.paint.get("fill-extrusion-base").evaluate(e,n),A=[0,0],E=w&&c.elevation,M=c.elevation?c.elevation.exaggeration():1,k=s.tile.getBucket(this);if(E&&k instanceof Cy){const W=k.centroidVertexArray,J=T+1;J<W.length&&(A[0]=W.geta_centroid_pos0(J),A[1]=W.geta_centroid_pos1(J))}if(A[0]===0&&A[1]===1)return!1;c.projection.name==="globe"&&(a=Y2([a],[new Ht(0,0),new Ht(pn,pn)],s.tileID.canonical).map(W=>W.polygon).flat());const N=E?w:null,[j,q]=function(W,J,ne,he,we,be,ve,Be,Me,Ue,Ye){return W.projection.name==="globe"?function(Xe,Je,st,pt,ot,It,tn,Lt,un,cn,vn){const Bt=[],Pn=[],dn=Xe.projection.upVectorScale(vn,Xe.center.lat,Xe.worldSize).metersToTile,Cn=[0,0,0,1],Zn=[0,0,0,1],xr=(Or,Mr,Zr,Bi)=>{Or[0]=Mr,Or[1]=Zr,Or[2]=Bi,Or[3]=1},Cr=X2();st>0&&(st+=Cr),pt+=Cr;for(const Or of Je){const Mr=[],Zr=[];for(const Bi of Or){const Mi=Bi.x+ot.x,hr=Bi.y+ot.y,Ai=Xe.projection.projectTilePoint(Mi,hr,vn),Ti=Xe.projection.upVector(vn,Bi.x,Bi.y);let Ni=st,ws=pt;if(tn){const Ss=eE(Mi,hr,st,pt,tn,Lt,un,cn);Ni+=Ss.base,ws+=Ss.top}st!==0?xr(Cn,Ai.x+Ti[0]*dn*Ni,Ai.y+Ti[1]*dn*Ni,Ai.z+Ti[2]*dn*Ni):xr(Cn,Ai.x,Ai.y,Ai.z),xr(Zn,Ai.x+Ti[0]*dn*ws,Ai.y+Ti[1]*dn*ws,Ai.z+Ti[2]*dn*ws),Re.vec3.transformMat4(Cn,Cn,It),Re.vec3.transformMat4(Zn,Zn,It),Mr.push(new Np(Cn[0],Cn[1],Cn[2])),Zr.push(new Np(Zn[0],Zn[1],Zn[2]))}Bt.push(Mr),Pn.push(Zr)}return[Bt,Pn]}(W,J,ne,he,we,be,ve,Be,Me,Ue,Ye):ve?function(Xe,Je,st,pt,ot,It,tn,Lt,un){const cn=[],vn=[],Bt=[0,0,0,1];for(const Pn of Xe){const dn=[],Cn=[];for(const Zn of Pn){const xr=Zn.x+pt.x,Cr=Zn.y+pt.y,Or=eE(xr,Cr,Je,st,It,tn,Lt,un);Bt[0]=xr,Bt[1]=Cr,Bt[2]=Or.base,Bt[3]=1,Re.vec4.transformMat4(Bt,Bt,ot),Bt[3]=Math.max(Bt[3],1e-5);const Mr=new Np(Bt[0]/Bt[3],Bt[1]/Bt[3],Bt[2]/Bt[3]);Bt[0]=xr,Bt[1]=Cr,Bt[2]=Or.top,Bt[3]=1,Re.vec4.transformMat4(Bt,Bt,ot),Bt[3]=Math.max(Bt[3],1e-5);const Zr=new Np(Bt[0]/Bt[3],Bt[1]/Bt[3],Bt[2]/Bt[3]);dn.push(Mr),Cn.push(Zr)}cn.push(dn),vn.push(Cn)}return[cn,vn]}(J,ne,he,we,be,ve,Be,Me,Ue):function(Xe,Je,st,pt,ot){const It=[],tn=[],Lt=ot[8]*Je,un=ot[9]*Je,cn=ot[10]*Je,vn=ot[11]*Je,Bt=ot[8]*st,Pn=ot[9]*st,dn=ot[10]*st,Cn=ot[11]*st;for(const Zn of Xe){const xr=[],Cr=[];for(const Or of Zn){const Mr=Or.x+pt.x,Zr=Or.y+pt.y,Bi=ot[0]*Mr+ot[4]*Zr+ot[12],Mi=ot[1]*Mr+ot[5]*Zr+ot[13],hr=ot[2]*Mr+ot[6]*Zr+ot[14],Ai=ot[3]*Mr+ot[7]*Zr+ot[15],Ti=Bi+Lt,Ni=Mi+un,ws=hr+cn,Ss=Math.max(Ai+vn,1e-5),qo=Bi+Bt,Zl=Mi+Pn,fo=hr+dn,bo=Math.max(Ai+Cn,1e-5);xr.push(new Np(Ti/Ss,Ni/Ss,ws/Ss)),Cr.push(new Np(qo/bo,Zl/bo,fo/bo))}It.push(xr),tn.push(Cr)}return[It,tn]}(J,ne,he,we,be)}(c,a,C,x,P,p,N,A,M,c.center.lat,s.tileID.canonical),X=s.queryGeometry;return function(W,J,ne){let he=1/0;Ae(ne,J)&&(he=Q2(ne,J[0]));for(let we=0;we<J.length;we++){const be=J[we],ve=W[we];for(let Be=0;Be<be.length-1;Be++){const Me=be[Be],Ue=[Me,be[Be+1],ve[Be+1],ve[Be],Me];ce(ne,Ue)&&(he=Math.min(he,Q2(ne,Ue)))}}return he!==1/0&&he}(j,q,X.isPointQuery()?X.screenBounds:X.screenGeometry)}},line:class extends vi{constructor(s,e,n,a){const d=uE();super(s,d,e,n,a),d.layout&&(this.layout=new Do(d.layout)),this.gradientVersion=0}_handleSpecialPaintPropertyUpdate(s){if(s==="line-gradient"){const e=this._transitionablePaint._values["line-gradient"].value.expression;this.stepInterpolant=e._styleExpression&&e._styleExpression.expression instanceof qc,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}widthExpression(){return this._transitionablePaint._values["line-width"].value.expression}recalculate(s,e){super.recalculate(s,e),this.paint._values["line-floorwidth"]=(()=>{if($g)return $g;const n=uE();return $g=new v3(n.paint.properties["line-width"].specification),$g.useIntegerZoom=!0,$g})().possiblyEvaluate(this._transitioningPaint._values["line-width"].value,s)}createBucket(s){return new ob(s)}getProgramIds(){return[this.paint.get("line-pattern").constantOr(1)?"linePattern":"line"]}getDefaultProgramParams(s,e,n){const a=lE(this);return{config:new lu(this,{zoom:e,lut:n}),defines:a,overrideFog:!1}}queryRadius(s){const e=s,n=hE(zt("line-width",this,e),zt("line-gap-width",this,e)),a=zt("line-offset",this,e);return n/2+Math.abs(a)+Gt(this.paint.get("line-translate"))}queryIntersectsFeature(s,e,n,a,d,c){if(s.queryGeometry.isAboveHorizon)return!1;const p=Yt(s.tilespaceGeometry,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),c.angle,s.pixelToTileUnitsFactor),w=s.pixelToTileUnitsFactor/2*hE(this.paint.get("line-width").evaluate(e,n),this.paint.get("line-gap-width").evaluate(e,n)),T=this.paint.get("line-offset").evaluate(e,n);return T&&(a=function(P,x){const C=[],A=new Ht(0,0);for(let E=0;E<P.length;E++){const M=P[E],k=[];for(let N=0;N<M.length;N++){const j=M[N],q=M[N+1],X=N===0?A:j.sub(M[N-1])._unit()._perp(),W=N===M.length-1?A:q.sub(j)._unit()._perp(),J=X._add(W)._unit();J._mult(1/(J.x*W.x+J.y*W.y)),k.push(J._mult(x)._add(j))}C.push(k)}return C}(a,T*s.pixelToTileUnitsFactor)),function(P,x,C){for(let A=0;A<x.length;A++){const E=x[A];if(P.length>=3){for(let M=0;M<E.length;M++)if(Ze(P,E[M]))return!0}if(Ee(P,E,C))return!0}return!1}(p,a,w)}isTileClipped(){return!0}isDraped(s){const e=this.layout.get("line-z-offset"),n=e.isConstant()&&!e.constantOr(0),a=this.layout.get("line-elevation-reference");return!(a==="sea"||a==="ground")&&(n||a!=="none")}},symbol:Uy,background:class extends vi{constructor(s,e,n,a){super(s,{layout:ZE||(ZE=new $i({visibility:new Zt(yt.layout_background.visibility)})),paint:XE||(XE=new $i({"background-pitch-alignment":new Zt(yt.paint_background["background-pitch-alignment"]),"background-color":new Zt(yt.paint_background["background-color"]),"background-pattern":new Zt(yt.paint_background["background-pattern"]),"background-opacity":new Zt(yt.paint_background["background-opacity"]),"background-emissive-strength":new Zt(yt.paint_background["background-emissive-strength"]),"background-color-use-theme":new an({type:"string",default:"default","property-type":"data-driven"})}))},e,n,a)}getProgramIds(){return[this.paint.get("background-pattern")?"backgroundPattern":"background"]}getDefaultProgramParams(s,e,n){return{overrideFog:!1}}is3D(){return this.paint.get("background-pitch-alignment")==="viewport"}},raster:eT,"raster-particle":sT,sky:class extends vi{constructor(s,e,n,a){super(s,{layout:rT||(rT=new $i({visibility:new Zt(yt.layout_sky.visibility)})),paint:iT||(iT=new $i({"sky-type":new Zt(yt.paint_sky["sky-type"]),"sky-atmosphere-sun":new Zt(yt.paint_sky["sky-atmosphere-sun"]),"sky-atmosphere-sun-intensity":new Zt(yt.paint_sky["sky-atmosphere-sun-intensity"]),"sky-gradient-center":new Zt(yt.paint_sky["sky-gradient-center"]),"sky-gradient-radius":new Zt(yt.paint_sky["sky-gradient-radius"]),"sky-gradient":new Qs(yt.paint_sky["sky-gradient"]),"sky-atmosphere-halo-color":new Zt(yt.paint_sky["sky-atmosphere-halo-color"]),"sky-atmosphere-color":new Zt(yt.paint_sky["sky-atmosphere-color"]),"sky-opacity":new Zt(yt.paint_sky["sky-opacity"]),"sky-gradient-use-theme":new an({type:"string",default:"default","property-type":"data-driven"}),"sky-atmosphere-halo-color-use-theme":new an({type:"string",default:"default","property-type":"data-driven"}),"sky-atmosphere-color-use-theme":new an({type:"string",default:"default","property-type":"data-driven"})}))},e,n,a),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(s){s==="sky-gradient"?this._updateColorRamp():s!=="sky-atmosphere-sun"&&s!=="sky-atmosphere-halo-color"&&s!=="sky-atmosphere-color"&&s!=="sky-atmosphere-sun-intensity"||(this._skyboxInvalidated=!0)}_updateColorRamp(){this.colorRamp=Uf({expression:this._transitionablePaint._values["sky-gradient"].value.expression,evaluationKey:"skyRadialProgress"}),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}needsSkyboxCapture(s){if(this._skyboxInvalidated||!this.skyboxTexture||!this.skyboxGeometry)return!0;if(!this.paint.get("sky-atmosphere-sun")){const e=s.style.light.properties.get("position");return this._lightPosition.azimuthal!==e.azimuthal||this._lightPosition.polar!==e.polar}return!1}getCenter(s,e){if(this.paint.get("sky-type")==="atmosphere"){const a=this.paint.get("sky-atmosphere-sun"),d=!a,c=s.style.light,p=c.properties.get("position");return d&&c.properties.get("anchor")==="viewport"&&nr("The sun direction is attached to a light with viewport anchor, lighting may behave unexpectedly."),d?Mb(p.azimuthal,90-p.polar,e):Mb(a[0],90-a[1],e)}const n=this.paint.get("sky-gradient-center");return Mb(n[0],90-n[1],e)}isSky(){return!0}markSkyboxValid(s){this._skyboxInvalidated=!1,this._lightPosition=s.style.light.properties.get("position")}hasOffscreenPass(){return!0}getProgramIds(){const s=this.paint.get("sky-type");return s==="atmosphere"?["skyboxCapture","skybox"]:s==="gradient"?["skyboxGradient"]:null}},slot:class extends vi{constructor(s,e,n,a){super(s,{paint:oT||(oT=new $i({}))},e,null)}},model:class extends vi{constructor(s,e,n,a){super(s,{layout:gT||(gT=new $i({visibility:new Zt(yt.layout_model.visibility),"model-id":new an(yt.layout_model["model-id"])})),paint:_T||(_T=new $i({"model-opacity":new an(yt.paint_model["model-opacity"]),"model-rotation":new an(yt.paint_model["model-rotation"]),"model-scale":new an(yt.paint_model["model-scale"]),"model-translation":new an(yt.paint_model["model-translation"]),"model-color":new an(yt.paint_model["model-color"]),"model-color-mix-intensity":new an(yt.paint_model["model-color-mix-intensity"]),"model-type":new Zt(yt.paint_model["model-type"]),"model-cast-shadows":new Zt(yt.paint_model["model-cast-shadows"]),"model-receive-shadows":new Zt(yt.paint_model["model-receive-shadows"]),"model-ambient-occlusion-intensity":new Zt(yt.paint_model["model-ambient-occlusion-intensity"]),"model-emissive-strength":new an(yt.paint_model["model-emissive-strength"]),"model-roughness":new an(yt.paint_model["model-roughness"]),"model-height-based-emissive-strength-multiplier":new an(yt.paint_model["model-height-based-emissive-strength-multiplier"]),"model-cutoff-fade-range":new Zt(yt.paint_model["model-cutoff-fade-range"]),"model-front-cutoff":new Zt(yt.paint_model["model-front-cutoff"]),"model-color-use-theme":new an({type:"string",default:"default","property-type":"data-driven"})}))},e,n,a),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(s){return new Pb(s)}getProgramIds(){return["model"]}is3D(){return!0}hasShadowPass(){return!0}canCastShadows(){return!0}hasLightBeamPass(){return!0}cutoffRange(){return this.paint.get("model-cutoff-fade-range")}queryRadius(s){return s instanceof Ky?pn-1:0}queryIntersectsFeature(s,e,n,a,d,c){if(!this.modelManager)return!1;const p=this.modelManager,w=s.tile.getBucket(this);if(!(w&&w instanceof Pb))return!1;for(const T in w.instancesPerModel){const P=w.instancesPerModel[T],x=e.id!==void 0?e.id:e.properties&&e.properties.hasOwnProperty("id")?e.properties.id:void 0;if(P.idToFeaturesIndex.hasOwnProperty(x)){const C=P.features[P.idToFeaturesIndex[x]],A=p.getModel(T,this.scope);if(!A)return!1;let E=Re.mat4.create();const M=new Qr(0,0),k=w.canonical;let N=Number.MAX_VALUE;for(let j=0;j<C.instancedDataCount;++j){const q=16*(C.instancedDataOffset+j),X=P.instancedDataArray.float32,W=[X[q+4],X[q+5],X[q+6]];ST(k,M,X[q],0|X[q+1]),yT(E,A,c,M,C.rotation,C.scale,W,!1,!1,!1),c.projection.name==="globe"&&(E=Ib(E,c));const J=Re.mat4.multiply([],c.projMatrix,E),ne=s.queryGeometry,he=hT(ne.isPointQuery()?ne.screenBounds:ne.screenGeometry,c,J,A.aabb);he!=null&&(N=Math.min(he,N))}return N!==Number.MAX_VALUE&&N}}return!1}_handleOverridablePaintPropertyUpdate(s,e,n){return!(!this.layout||e.isDataDriven()||n.isDataDriven()||s!=="model-color"&&s!=="model-color-mix-intensity"&&s!=="model-rotation"&&s!=="model-scale"&&s!=="model-translation"&&s!=="model-emissive-strength")}_isPropertyZoomDependent(s){const e=this._transitionablePaint._values[s];return e!=null&&e.value!=null&&e.value.expression!=null&&e.value.expression instanceof _l}isZoomDependent(){return this._isPropertyZoomDependent("model-scale")||this._isPropertyZoomDependent("model-rotation")||this._isPropertyZoomDependent("model-translation")}},clip:class extends vi{constructor(s,e,n,a){super(s,{layout:Kt||(Kt=new $i({"clip-layer-types":new Zt(yt.layout_clip["clip-layer-types"]),"clip-layer-scope":new Zt(yt.layout_clip["clip-layer-scope"])})),paint:On||(On=new $i({}))},e,n,a)}recalculate(s,e){super.recalculate(s,e)}createBucket(s){return new Vr(s)}isTileClipped(){return!0}is3D(){return!0}}};class yk{constructor(e){this._callback=e,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){this._channel=void 0,this._callback=()=>{}}}class vk{constructor(){this.tasks={},this.taskQueue=[],Ci(["process"],this),this.invoker=new yk(this.process),this.nextId=0}add(e,n){const a=this.nextId++,d=function({type:c,isSymbolTile:p,zoom:w}){return w=w||0,c==="message"?0:c!=="maybePrepare"||p?c!=="parseTile"||p?c==="parseTile"&&p?300-w:c==="maybePrepare"&&p?400-w:500:200-w:100-w}(n);if(d===0){try{e()}finally{}return null}return this.tasks[a]={fn:e,metadata:n,priority:d,id:a},this.taskQueue.push(a),this.invoker.trigger(),{cancel:()=>{delete this.tasks[a]}}}process(){try{if(this.taskQueue=this.taskQueue.filter(a=>!!this.tasks[a]),!this.taskQueue.length)return;const e=this.pick();if(e===null)return;const n=this.tasks[e];if(delete this.tasks[e],this.taskQueue.length&&this.invoker.trigger(),!n)return;n.fn()}finally{}}pick(){let e=null,n=1/0;for(let d=0;d<this.taskQueue.length;d++){const c=this.tasks[this.taskQueue[d]];c.priority<n&&(n=c.priority,e=d)}if(e===null)return null;const a=this.taskQueue[e];return this.taskQueue.splice(e,1),a}remove(){this.invoker.remove()}}class ET{constructor(e,n,a){this.target=e,this.parent=n,this.mapId=a,this.callbacks={},this.cancelCallbacks={},Ci(["receive"],this),this.target.addEventListener("message",this.receive,!1),this.scheduler=new vk}send(e,n,a,d,c=!1,p){const w=Math.round(1e18*Math.random()).toString(36).substring(0,10);a&&(a.metadata=p,this.callbacks[w]=a);const T=new Set;return this.target.postMessage({id:w,type:e,hasCallback:!!a,targetMapId:d,mustQueue:c,sourceMapId:this.mapId,data:mn(n,T)},T),{cancel:()=>{a&&delete this.callbacks[w],this.target.postMessage({id:w,type:"<cancel>",targetMapId:d,sourceMapId:this.mapId})}}}receive(e){const n=e.data,a=n.id;if(a&&(!n.targetMapId||this.mapId===n.targetMapId))if(n.type==="<cancel>"){const d=this.cancelCallbacks[a];delete this.cancelCallbacks[a],d&&d.cancel()}else if(n.mustQueue||as()){const d=this.callbacks[a],c=this.scheduler.add(()=>this.processTask(a,n),d&&d.metadata||{type:"message"});c&&(this.cancelCallbacks[a]=c)}else this.processTask(a,n)}processTask(e,n){if(delete this.cancelCallbacks[e],n.type==="<response>"){const a=this.callbacks[e];delete this.callbacks[e],a&&(n.error?a(An(n.error)):a(null,An(n.data)))}else{const a=new Set,d=n.hasCallback?(p,w)=>{this.target.postMessage({id:e,type:"<response>",sourceMapId:this.mapId,error:p?mn(p):null,data:mn(w,a)},a)}:()=>{},c=An(n.data);if(this.parent[n.type])this.parent[n.type](n.sourceMapId,c,d);else if(this.parent.getWorkerSource){const p=n.type.split(".");this.parent.getWorkerSource(n.sourceMapId,p[0],c.source,c.scope)[p[1]](c,d)}else d(new Error(`Could not find function ${n.type}`))}}remove(){this.scheduler.remove(),this.target.removeEventListener("message",this.receive,!1)}}var Qg={workerUrl:"",workerClass:null,workerParams:void 0};const Lb="mapboxgl_preloaded_worker_pool";class Up{constructor(){this.active={}}acquire(e,n=Up.workerCount){if(!this.workers)for(this.workers=[];this.workers.length<n;)this.workers.push(Qg.workerClass!=null?new Qg.workerClass:new self.Worker(Qg.workerUrl,Qg.workerParams));return this.active[e]=!0,this.workers.slice()}release(e){delete this.active[e],this.workers&&this.numActive()===0&&(this.workers.forEach(n=>{n.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[Lb]}numActive(){return Object.keys(this.active).length}}Up.workerCount=2;class Dm{constructor(e,n,a="Worker",d=Up.workerCount){this.workerPool=e,this.actors=[],this.currentActor=0,this.id=oi();const c=this.workerPool.acquire(this.id,d);for(let p=0;p<c.length;p++){const w=new Dm.Actor(c[p],n,this.id);w.name=`${a} ${p}`,this.actors.push(w)}this.ready=!1,this.broadcast("checkIfReady",null,()=>{this.ready=!0})}broadcast(e,n,a){_i(this.actors,(d,c)=>{d.send(e,n,c)},a=a||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach(e=>{e.remove()}),this.actors=[],this.workerPool.release(this.id)}}let e_,Ob;function Jy(){return e_||(e_=new Up),e_}Dm.Actor=ET;const Db=new ir(0,0,0);var Qy=(s=>(s[s.PATH_RULE_UNSPECIFIED=0]="PATH_RULE_UNSPECIFIED",s[s.PATH_RULE_NON_ZERO=1]="PATH_RULE_NON_ZERO",s[s.PATH_RULE_EVEN_ODD=2]="PATH_RULE_EVEN_ODD",s))(Qy||{}),ev=(s=>(s[s.LINE_CAP_UNSPECIFIED=0]="LINE_CAP_UNSPECIFIED",s[s.LINE_CAP_BUTT=1]="LINE_CAP_BUTT",s[s.LINE_CAP_ROUND=2]="LINE_CAP_ROUND",s[s.LINE_CAP_SQUARE=3]="LINE_CAP_SQUARE",s))(ev||{}),t_=(s=>(s[s.LINE_JOIN_UNSPECIFIED=0]="LINE_JOIN_UNSPECIFIED",s[s.LINE_JOIN_MITER=1]="LINE_JOIN_MITER",s[s.LINE_JOIN_MITER_CLIP=2]="LINE_JOIN_MITER_CLIP",s[s.LINE_JOIN_ROUND=3]="LINE_JOIN_ROUND",s[s.LINE_JOIN_BEVEL=4]="LINE_JOIN_BEVEL",s))(t_||{}),TT=(s=>(s[s.PAINT_ORDER_UNSPECIFIED=0]="PAINT_ORDER_UNSPECIFIED",s[s.PAINT_ORDER_FILL_AND_STROKE=1]="PAINT_ORDER_FILL_AND_STROKE",s[s.PAINT_ORDER_STROKE_AND_FILL=2]="PAINT_ORDER_STROKE_AND_FILL",s))(TT||{}),Fm=(s=>(s[s.PATH_COMMAND_UNSPECIFIED=0]="PATH_COMMAND_UNSPECIFIED",s[s.PATH_COMMAND_MOVE=1]="PATH_COMMAND_MOVE",s[s.PATH_COMMAND_LINE=2]="PATH_COMMAND_LINE",s[s.PATH_COMMAND_QUAD=3]="PATH_COMMAND_QUAD",s[s.PATH_COMMAND_CUBIC=4]="PATH_COMMAND_CUBIC",s[s.PATH_COMMAND_CLOSE=5]="PATH_COMMAND_CLOSE",s))(Fm||{}),CT=(s=>(s[s.MASK_TYPE_UNSPECIFIED=0]="MASK_TYPE_UNSPECIFIED",s[s.MASK_TYPE_LUMINANCE=1]="MASK_TYPE_LUMINANCE",s[s.MASK_TYPE_ALPHA=2]="MASK_TYPE_ALPHA",s))(CT||{});function xk(s,e,n){s===1&&e.icons.push(function(a,d){return function(c){if(c.usvg_tree.height||(c.usvg_tree.height=c.usvg_tree.width),!c.metadata)return c;const{metadata:p}=c;if(p.content_area){const{content_area:w}=p;w.top==null&&(w.top=w.left),w.width==null&&(w.width=c.usvg_tree.width),w.height==null&&(w.height=w.width)}return p.stretch_x&&p.stretch_x.length&&MT(p,"x"),p.stretch_y&&p.stretch_y.length&&MT(p,"y"),c}(a.readFields(bk,{name:void 0},d))}(n,n.readVarint()+n.pos))}function MT(s,e){const n=[],a=s[`stretch_${e}`];let d=null;for(let c=0;c<a.length;c++)d===null?d=n.length===0?a[0]:n[n.length-1][1]+a[c]:(n.push([d,d+a[c]]),d=null);s[`stretch_${e}_areas`]=n}function bk(s,e,n){s===1?e.name=n.readString():s===2?e.metadata=function(a,d){return a.readFields(wk,{stretch_x:null,stretch_y:null,stretch_x_areas:null,stretch_y_areas:null,variables:[]},d)}(n,n.readVarint()+n.pos):s===3&&(e.usvg_tree=function(a,d){return a.readFields(Tk,{width:20,children:[],linear_gradients:[],radial_gradients:[],clip_paths:[],masks:[]},d)}(n,n.readVarint()+n.pos),e.data="usvg_tree")}function wk(s,e,n){s===1?e.stretch_x=n.readPackedVarint():s===2?e.stretch_y=n.readPackedVarint():s===3?e.content_area=function(a,d){return a.readFields(Sk,{left:0},d)}(n,n.readVarint()+n.pos):s===4&&e.variables.push(function(a,d){return a.readFields(Ek,{name:void 0},d)}(n,n.readVarint()+n.pos))}function Sk(s,e,n){s===1?e.left=n.readVarint():s===2?e.width=n.readVarint():s===3?e.top=n.readVarint():s===4&&(e.height=n.readVarint())}function Ek(s,e,n){s===1?e.name=n.readString():s===2&&(e.rgb_color=rv(n.readVarint()),e.value="rgb_color")}function Tk(s,e,n){s===1?e.width=e.height=n.readVarint():s===2?e.height=n.readVarint():s===3?e.children.push(tv(n,n.readVarint()+n.pos)):s===4?e.linear_gradients.push(function(a,d){return a.readFields(kk,{spread_method:1,stops:[],x1:0,y1:0,x2:1,y2:0},d)}(n,n.readVarint()+n.pos)):s===5?e.radial_gradients.push(function(a,d){return a.readFields(Lk,{spread_method:1,stops:[],cx:.5,cy:.5,r:.5,fx:.5,fy:.5,fr:0},d)}(n,n.readVarint()+n.pos)):s===7?e.clip_paths.push(function(a,d){return a.readFields(Ok,{children:[]},d)}(n,n.readVarint()+n.pos)):s===8&&e.masks.push(function(a,d){const c=a.readFields(Dk,{left:0,width:20,mask_type:1,children:[]},d);return c.height==null&&(c.height=c.width),c.top==null&&(c.top=c.left),c}(n,n.readVarint()+n.pos))}function tv(s,e){return s.readFields(Ck,{},e)}function Ck(s,e,n){s===1?(e.group=function(a,d){return a.readFields(Mk,{opacity:255,children:[]},d)}(n,n.readVarint()+n.pos),e.node="group"):s===2&&(e.path=function(a,d){return a.readFields(Ik,{paint_order:1,commands:[],step:1,diffs:[],rule:1},d)}(n,n.readVarint()+n.pos),e.node="path")}function Mk(s,e,n){s===1?e.transform=nv(n,n.readVarint()+n.pos):s===2?e.opacity=n.readVarint():s===5?e.clip_path_idx=n.readVarint():s===6?e.mask_idx=n.readVarint():s===7&&e.children.push(tv(n,n.readVarint()+n.pos))}function nv(s,e){return s.readFields(Ak,{sx:1,ky:0,kx:0,sy:1,tx:0,ty:0},e)}function Ak(s,e,n){s===1?e.sx=n.readFloat():s===2?e.ky=n.readFloat():s===3?e.kx=n.readFloat():s===4?e.sy=n.readFloat():s===5?e.tx=n.readFloat():s===6&&(e.ty=n.readFloat())}function Ik(s,e,n){s===1?e.fill=function(a,d){return a.readFields(Pk,{rgb_color:Db,paint:"rgb_color",opacity:255},d)}(n,n.readVarint()+n.pos):s===2?e.stroke=function(a,d){return a.readFields(Rk,{rgb_color:Db,paint:"rgb_color",dasharray:[],dashoffset:0,miterlimit:4,opacity:255,width:1,linecap:1,linejoin:1},d)}(n,n.readVarint()+n.pos):s===3?e.paint_order=n.readVarint():s===5?n.readPackedVarint(e.commands):s===6?e.step=n.readFloat():s===7?n.readPackedSVarint(e.diffs):s===8&&(e.rule=n.readVarint())}function Pk(s,e,n){s===1?(e.rgb_color=rv(n.readVarint()),e.paint="rgb_color"):s===2?(e.linear_gradient_idx=n.readVarint(),e.paint="linear_gradient_idx"):s===3?(e.radial_gradient_idx=n.readVarint(),e.paint="radial_gradient_idx"):s===5&&(e.opacity=n.readVarint())}function rv(s){return new ir((s>>16&255)/255,(s>>8&255)/255,(255&s)/255,1)}function Rk(s,e,n){s===1?(e.rgb_color=rv(n.readVarint()),e.paint="rgb_color"):s===2?(e.linear_gradient_idx=n.readVarint(),e.paint="linear_gradient_idx"):s===3?(e.radial_gradient_idx=n.readVarint(),e.paint="radial_gradient_idx"):s===5?n.readPackedFloat(e.dasharray):s===6?e.dashoffset=n.readFloat():s===7?e.miterlimit=n.readFloat():s===8?e.opacity=n.readVarint():s===9?e.width=n.readFloat():s===10?e.linecap=n.readVarint():s===11&&(e.linejoin=n.readVarint())}function kk(s,e,n){s===1?e.transform=nv(n,n.readVarint()+n.pos):s===2?e.spread_method=n.readVarint():s===3?e.stops.push(AT(n,n.readVarint()+n.pos)):s===4?e.x1=n.readFloat():s===5?e.y1=n.readFloat():s===6?e.x2=n.readFloat():s===7&&(e.y2=n.readFloat())}function AT(s,e){return s.readFields(zk,{offset:0,opacity:255,rgb_color:Db},e)}function zk(s,e,n){s===1?e.offset=n.readFloat():s===2?e.opacity=n.readVarint():s===3&&(e.rgb_color=rv(n.readVarint()))}function Lk(s,e,n){s===1?e.transform=nv(n,n.readVarint()+n.pos):s===2?e.spread_method=n.readVarint():s===3?e.stops.push(AT(n,n.readVarint()+n.pos)):s===4?e.cx=n.readFloat():s===5?e.cy=n.readFloat():s===6?e.r=n.readFloat():s===7?e.fx=n.readFloat():s===8?e.fy=n.readFloat():s===9&&(e.fr=n.readFloat())}function Ok(s,e,n){s===1?e.transform=nv(n,n.readVarint()+n.pos):s===2?e.clip_path_idx=n.readVarint():s===3&&e.children.push(tv(n,n.readVarint()+n.pos))}function Dk(s,e,n){s===1?e.left=e.top=n.readFloat():s===2?e.width=e.height=n.readFloat():s===3?e.top=n.readFloat():s===4?e.height=n.readFloat():s===5?e.mask_type=n.readVarint():s===6?e.mask_idx=n.readVarint():s===7&&e.children.push(tv(n,n.readVarint()+n.pos))}class Fk{static calculate(e,n){const a=new Map,d=new Map;if(Object.keys(e).length===0)return a;n.forEach(c=>{d.set(c.name,c.rgb_color||new ir(0,0,0))});for(const[c,p]of Object.entries(e))d.has(c)?a.set(d.get(c).toStringPremultipliedAlpha(),p):console.warn(`Ignoring unknown image variable "${c}"`);return a}}function Bm(s,e=255,n){const a=e/255,d=s.toStringPremultipliedAlpha(),c=n.has(d)?n.get(d).clone():s.clone();return c.a=a,c.toString()}function Fb(s,e){if(!Jt()){const n=document.createElement("canvas");return n.width=s,n.height=e,n}return new OffscreenCanvas(s,e)}function Bk(s,e){const n=Fk.calculate(e.params,s.metadata?s.metadata.variables:[]),a=s.usvg_tree,d=a.width,c=a.height,p=e.transform?e.transform:new DOMMatrix,w=Math.max(1,Math.round(d*p.a)),T=Math.max(1,Math.round(c*p.d)),P=new DOMMatrix([w/d,0,0,T/c,0,0]),x=Fb(w,T).getContext("2d");return Bb(x,P,a,a,n),x.getImageData(0,0,w,T)}function Bb(s,e,n,a,d){for(const c of a.children)IT(s,e,n,c,d)}function IT(s,e,n,a,d){a.group?(s.save(),function(c,p,w,T,P){const x=T.mask_idx!=null?w.masks[T.mask_idx]:null,C=T.clip_path_idx!=null?w.clip_paths[T.clip_path_idx]:null;if(T.transform&&(p=n_(T.transform).preMultiplySelf(p)),!function(M,k,N){return M.opacity!==255||k||N}(T,C!=null,x!=null))return void Bb(c,p,w,T,P);const A=Fb(c.canvas.width,c.canvas.height),E=A.getContext("2d");C&&LT(E,p,w,C),Bb(E,p,w,T,P),x&&OT(E,p,w,x,P),c.globalAlpha=T.opacity/255,c.drawImage(A,0,0)}(s,e,n,a.group,d),s.restore()):a.path&&(s.save(),function(c,p,w,T,P){const x=DT(T);c.setTransform(p),T.paint_order===TT.PAINT_ORDER_FILL_AND_STROKE?(PT(c,w,T,x,P),RT(c,w,T,x,P)):(RT(c,w,T,x,P),PT(c,w,T,x,P))}(s,e,n,a.path,d),s.restore())}function PT(s,e,n,a,d){const c=n.fill;if(!c)return;const p=c.opacity/255;switch(c.paint){case"rgb_color":s.fillStyle=Bm(c.rgb_color,c.opacity,d);break;case"linear_gradient_idx":s.fillStyle=kT(s,e.linear_gradients[c.linear_gradient_idx],p,d);break;case"radial_gradient_idx":s.fillStyle=zT(s,e.radial_gradients[c.radial_gradient_idx],p,d)}let w;switch(n.rule){case Qy.PATH_RULE_NON_ZERO:w="nonzero";break;case Qy.PATH_RULE_EVEN_ODD:w="evenodd"}s.fill(a,w)}function RT(s,e,n,a,d){const c=n.stroke;if(!c)return;s.lineWidth=c.width,s.miterLimit=c.miterlimit,s.setLineDash(c.dasharray),s.lineDashOffset=c.dashoffset;const p=c.opacity/255;switch(c.paint){case"rgb_color":s.strokeStyle=Bm(c.rgb_color,c.opacity,d);break;case"linear_gradient_idx":s.strokeStyle=kT(s,e.linear_gradients[c.linear_gradient_idx],p,d);break;case"radial_gradient_idx":s.strokeStyle=zT(s,e.radial_gradients[c.radial_gradient_idx],p,d)}switch(c.linejoin){case t_.LINE_JOIN_MITER_CLIP:case t_.LINE_JOIN_MITER:s.lineJoin="miter";break;case t_.LINE_JOIN_ROUND:s.lineJoin="round";break;case t_.LINE_JOIN_BEVEL:s.lineJoin="bevel"}switch(c.linecap){case ev.LINE_CAP_BUTT:s.lineCap="butt";break;case ev.LINE_CAP_ROUND:s.lineCap="round";break;case ev.LINE_CAP_SQUARE:s.lineCap="square"}s.stroke(a)}function kT(s,e,n,a){if(e.stops.length===1){const A=e.stops[0];return Bm(A.rgb_color,A.opacity*n,a)}const d=n_(e.transform),{x1:c,y1:p,x2:w,y2:T}=e,P=d.transformPoint(new DOMPoint(c,p)),x=d.transformPoint(new DOMPoint(w,T)),C=s.createLinearGradient(P.x,P.y,x.x,x.y);for(const A of e.stops)C.addColorStop(A.offset,Bm(A.rgb_color,A.opacity*n,a));return C}function zT(s,e,n,a){if(e.stops.length===1){const A=e.stops[0];return Bm(A.rgb_color,A.opacity*n,a)}const d=n_(e.transform),{fx:c,fy:p,cx:w,cy:T}=e,P=d.transformPoint(new DOMPoint(c,p)),x=d.transformPoint(new DOMPoint(w,T)),C=s.createRadialGradient(P.x,P.y,0,x.x,x.y,e.r*((d.a+d.d)/2));for(const A of e.stops)C.addColorStop(A.offset,Bm(A.rgb_color,A.opacity*n,a));return C}function LT(s,e,n,a){const d=n_(a.transform).preMultiplySelf(e),c=a.clip_path_idx!=null?n.clip_paths[a.clip_path_idx]:null;c&&LT(s,d,n,c);const p=new Path2D;let w;function T(P,x){if(P.path){const C=P.path;p.addPath(DT(C),x),C.rule===Qy.PATH_RULE_EVEN_ODD&&(w="evenodd")}else if(P.group){const C=P.group.transform?n_(P.group.transform).preMultiplySelf(x):x;for(const A of P.group.children)T(A,C)}}for(const P of a.children)T(P,d);s.clip(p,w)}function OT(s,e,n,a,d){if(a.children.length===0)return;const c=a.mask_idx!=null?n.masks[a.mask_idx]:null;c&&OT(s,e,n,c,d);const p=s.canvas.width,w=s.canvas.height,T=Fb(p,w),P=T.getContext("2d"),x=a.width,C=a.height,A=a.left,E=a.top,M=new Path2D,k=new Path2D;k.rect(A,E,x,C),M.addPath(k,e),P.clip(M);for(const q of a.children)IT(P,e,n,q,d);const N=P.getImageData(0,0,p,w),j=N.data;if(a.mask_type===CT.MASK_TYPE_LUMINANCE)for(let q=0;q<j.length;q+=4)j[q+3]=j[q+3]/255*(.2126*j[q]+.7152*j[q+1]+.0722*j[q+2]);P.putImageData(N,0,0),s.globalCompositeOperation="destination-in",s.drawImage(T,0,0)}function n_(s){return s?new DOMMatrix([s.sx,s.ky,s.kx,s.sy,s.tx,s.ty]):new DOMMatrix}function DT(s){const e=new Path2D,n=s.step;let a=s.diffs[0]*n,d=s.diffs[1]*n;e.moveTo(a,d);for(let c=0,p=2;c<s.commands.length;c++)switch(s.commands[c]){case Fm.PATH_COMMAND_MOVE:a+=s.diffs[p++]*n,d+=s.diffs[p++]*n,e.moveTo(a,d);break;case Fm.PATH_COMMAND_LINE:a+=s.diffs[p++]*n,d+=s.diffs[p++]*n,e.lineTo(a,d);break;case Fm.PATH_COMMAND_QUAD:{const w=a+s.diffs[p++]*n,T=d+s.diffs[p++]*n;a=w+s.diffs[p++]*n,d=T+s.diffs[p++]*n,e.quadraticCurveTo(w,T,a,d);break}case Fm.PATH_COMMAND_CUBIC:{const w=a+s.diffs[p++]*n,T=d+s.diffs[p++]*n,P=w+s.diffs[p++]*n,x=T+s.diffs[p++]*n;a=P+s.diffs[p++]*n,d=x+s.diffs[p++]*n,e.bezierCurveTo(w,T,P,x,a,d);break}case Fm.PATH_COMMAND_CLOSE:e.closePath()}return e}class Nb{constructor(e){this.capacity=e,this.cache=new Map}get(e){if(!this.cache.has(e))return;const n=this.cache.get(e);return this.cache.delete(e),this.cache.set(e,n),n}put(e,n){this.cache.has(e)?this.cache.delete(e):this.cache.size===this.capacity&&this.cache.delete(this.cache.keys().next().value),this.cache.set(e,n)}delete(e){this.cache.delete(e)}}class jb{constructor(){this.cacheMap=new Map,this.cacheDependenciesMap=new Map}static _getImage(e){return new ma(e,e.data)}getFromCache(e,n,a){return this.cacheMap.has(a)||this.cacheMap.set(a,new Nb(150)),this.cacheMap.get(a).get(Wo(e.serialize(),n))}setInCache(e,n,a,d){this.cacheDependenciesMap.has(d)||this.cacheDependenciesMap.set(d,new Map),this.cacheMap.has(d)||this.cacheMap.set(d,new Nb(150));const c=this.cacheDependenciesMap.get(d);c.get(Wo(e.id,a))||c.set(Wo(e.id,a),new Set);const p=this.cacheMap.get(d),w=e.serialize();c.get(Wo(e.id,a)).add(w),p.put(Wo(e.serialize(),a),n)}removeImagesFromCacheByIds(e,n,a=""){if(!this.cacheMap.has(a)||!this.cacheDependenciesMap.has(a))return;const d=this.cacheMap.get(a),c=this.cacheDependenciesMap.get(a);for(const p of e)if(c.has(Wo(p,n))){for(const w of c.get(Wo(p,n)))d.delete(w);c.delete(Wo(p,n))}}rasterize(e,n,a,d,c=Bk){const p=this.getFromCache(e,a,d);if(p)return p.clone();const w=c(n.icon,e.options),T=jb._getImage(w);return this.setInCache(e,T,a,d),T.clone()}}class FT{constructor(e){this.size=e,this.minimums=[],this.maximums=[],this.leaves=[]}getElevation(e,n){const a=this.toIdx(e,n);return{min:this.minimums[a],max:this.maximums[a]}}isLeaf(e,n){return this.leaves[this.toIdx(e,n)]}toIdx(e,n){return n*this.size+e}}function BT(s,e,n,a){let d=0,c=Number.MAX_VALUE;for(let p=0;p<3;p++)if(Math.abs(a[p])<1e-15){if(n[p]<s[p]||n[p]>e[p])return null}else{const w=1/a[p];let T=(s[p]-n[p])*w,P=(e[p]-n[p])*w;if(T>P){const x=T;T=P,P=x}if(T>d&&(d=T),P<c&&(c=P),d>c)return null}return d}function NT(s,e,n,a,d,c,p,w,T,P,x){const C=a-s,A=d-e,E=c-n,M=p-s,k=w-e,N=T-n,j=x[1]*N-x[2]*k,q=x[2]*M-x[0]*N,X=x[0]*k-x[1]*M,W=C*j+A*q+E*X;if(Math.abs(W)<1e-15)return null;const J=1/W,ne=P[0]-s,he=P[1]-e,we=P[2]-n,be=(ne*j+he*q+we*X)*J;if(be<0||be>1)return null;const ve=he*E-we*A,Be=we*C-ne*E,Me=ne*A-he*C,Ue=(x[0]*ve+x[1]*Be+x[2]*Me)*J;return Ue<0||be+Ue>1?null:(M*ve+k*Be+N*Me)*J}function jT(s,e,n){return(s-e)/(n-e)}function $T(s,e,n,a,d,c,p,w,T){const P=1<<n,x=c-a,C=p-d,A=(s+1)/P*x+a,E=(e+0)/P*C+d,M=(e+1)/P*C+d;w[0]=(s+0)/P*x+a,w[1]=E,T[0]=A,T[1]=M}class VT{constructor(e){if(this.maximums=[],this.minimums=[],this.leaves=[],this.childOffsets=[],this.nodeCount=0,this.dem=e,this._siblingOffset=[[0,0],[1,0],[0,1],[1,1]],!this.dem)return;const n=function(c){const p=Math.ceil(Math.log2(c.dim/8)),w=[];let T=Math.ceil(Math.pow(2,p));const P=1/T,x=(E,M,k,N,j)=>{const q=N?1:0,X=(E+1)*k-q,W=M*k,J=(M+1)*k-q;j[0]=E*k,j[1]=W,j[2]=X,j[3]=J};let C=new FT(T);const A=[];for(let E=0;E<T*T;E++){x(E%T,Math.floor(E/T),P,!1,A);const M=Xf(A[0],A[1],c),k=Xf(A[2],A[1],c),N=Xf(A[2],A[3],c),j=Xf(A[0],A[3],c);C.minimums.push(Math.min(M,k,N,j)),C.maximums.push(Math.max(M,k,N,j)),C.leaves.push(1)}for(w.push(C),T/=2;T>=1;T/=2){const E=w[w.length-1];C=new FT(T);for(let M=0;M<T*T;M++){x(M%T,Math.floor(M/T),2,!0,A);const k=E.getElevation(A[0],A[1]),N=E.getElevation(A[2],A[1]),j=E.getElevation(A[2],A[3]),q=E.getElevation(A[0],A[3]),X=E.isLeaf(A[0],A[1]),W=E.isLeaf(A[2],A[1]),J=E.isLeaf(A[2],A[3]),ne=E.isLeaf(A[0],A[3]),he=Math.min(k.min,N.min,j.min,q.min),we=Math.max(k.max,N.max,j.max,q.max),be=X&&W&&J&&ne;C.maximums.push(we),C.minimums.push(he),C.leaves.push(we-he<=5&&be?1:0)}w.push(C)}return w}(this.dem),a=n.length-1,d=n[a];this._addNode(d.minimums[0],d.maximums[0],d.leaves[0]),this._construct(n,0,0,a,0)}raycastRoot(e,n,a,d,c,p,w=1){return BT([e,n,-100],[a,d,this.maximums[0]*w],c,p)}raycast(e,n,a,d,c,p,w=1){if(!this.nodeCount)return null;const T=this.raycastRoot(e,n,a,d,c,p,w);if(T==null)return null;const P=[],x=[],C=[],A=[],E=[{idx:0,t:T,nodex:0,nodey:0,depth:0}];for(;E.length>0;){const{idx:M,t:k,nodex:N,nodey:j,depth:q}=E.pop();if(this.leaves[M]){$T(N,j,q,e,n,a,d,C,A);const W=1<<q,J=(N+0)/W,ne=(N+1)/W,he=(j+0)/W,we=(j+1)/W,be=Xf(J,he,this.dem)*w,ve=Xf(ne,he,this.dem)*w,Be=Xf(ne,we,this.dem)*w,Me=Xf(J,we,this.dem)*w,Ue=NT(C[0],C[1],be,A[0],C[1],ve,A[0],A[1],Be,c,p),Ye=NT(A[0],A[1],Be,C[0],A[1],Me,C[0],C[1],be,c,p),Xe=Math.min(Ue!==null?Ue:Number.MAX_VALUE,Ye!==null?Ye:Number.MAX_VALUE);if(Xe!==Number.MAX_VALUE)return Xe;{const Je=Re.vec3.scaleAndAdd([],c,p,k);if(UT(be,ve,Me,Be,jT(Je[0],C[0],A[0]),jT(Je[1],C[1],A[1]))>=Je[2])return k}continue}let X=0;for(let W=0;W<this._siblingOffset.length;W++){$T((N<<1)+this._siblingOffset[W][0],(j<<1)+this._siblingOffset[W][1],q+1,e,n,a,d,C,A),C[2]=-100,A[2]=this.maximums[this.childOffsets[M]+W]*w;const J=BT(C,A,c,p);if(J!=null){const ne=J;P[W]=ne;let he=!1;for(let we=0;we<X&&!he;we++)ne>=P[x[we]]&&(x.splice(we,0,W),he=!0);he||(x[X]=W),X++}}for(let W=0;W<X;W++){const J=x[W];E.push({idx:this.childOffsets[M]+J,t:P[J],nodex:(N<<1)+this._siblingOffset[J][0],nodey:(j<<1)+this._siblingOffset[J][1],depth:q+1})}}return null}_addNode(e,n,a){return this.minimums.push(e),this.maximums.push(n),this.leaves.push(a),this.childOffsets.push(0),this.nodeCount++}_construct(e,n,a,d,c){if(e[d].isLeaf(n,a)===1)return;this.childOffsets[c]||(this.childOffsets[c]=this.nodeCount);const p=d-1,w=e[p];let T=0,P=0;for(let x=0;x<this._siblingOffset.length;x++){const C=2*n+this._siblingOffset[x][0],A=2*a+this._siblingOffset[x][1],E=w.getElevation(C,A),M=w.isLeaf(C,A),k=this._addNode(E.min,E.max,M);M&&(T|=1<<x),P||(P=k)}for(let x=0;x<this._siblingOffset.length;x++)T&1<<x||this._construct(e,2*n+this._siblingOffset[x][0],2*a+this._siblingOffset[x][1],p,P+x)}}function UT(s,e,n,a,d,c){return kn(kn(s,n,c),kn(e,a,c),d)}function Xf(s,e,n){const a=n.dim,d=yn(s*a-.5,0,a-1),c=yn(e*a-.5,0,a-1),p=Math.floor(d),w=Math.floor(c),T=Math.min(p+1,a-1),P=Math.min(w+1,a-1);return UT(n.get(p,w),n.get(T,w),n.get(p,P),n.get(T,P),d-p,c-w)}const Nk={mapbox:[6553.6,25.6,.1,1e4],terrarium:[256,1,1/256,32768]};function jk(s,e,n){return(256*s*256+256*e+n)/10-1e4}function $k(s,e,n){return 256*s+e+n/256-32768}class iv{get tree(){return this._tree||this._buildQuadTree(),this._tree}constructor(e,n,a,d=!1){if(this.uid=e,n.height!==n.width)throw new RangeError("DEM tiles must be square");if(a&&a!=="mapbox"&&a!=="terrarium")return void nr(`"${a}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=n.height;const c=this.dim=n.height-2,p=new Uint32Array(n.data.buffer);if(this.pixels=new Uint8Array(n.data.buffer),this.floatView=new Float32Array(n.data.buffer),this.borderReady=d,this._modifiedForSources={},!d){for(let T=0;T<c;T++)p[this._idx(-1,T)]=p[this._idx(0,T)],p[this._idx(c,T)]=p[this._idx(c-1,T)],p[this._idx(T,-1)]=p[this._idx(T,0)],p[this._idx(T,c)]=p[this._idx(T,c-1)];p[this._idx(-1,-1)]=p[this._idx(0,0)],p[this._idx(c,-1)]=p[this._idx(c-1,0)],p[this._idx(-1,c)]=p[this._idx(0,c-1)],p[this._idx(c,c)]=p[this._idx(c-1,c-1)]}const w=a==="terrarium"?$k:jk;for(let T=0;T<p.length;++T){const P=4*T;this.floatView[T]=w(this.pixels[P],this.pixels[P+1],this.pixels[P+2])}this._timestamp=fn.now()}_buildQuadTree(){this._tree=new VT(this)}get(e,n,a=!1){a&&(e=yn(e,-1,this.dim),n=yn(n,-1,this.dim));const d=this._idx(e,n);return this.floatView[d]}set(e,n,a){const d=this._idx(e,n),c=this.floatView[d];return this.floatView[d]=a,a-c}static getUnpackVector(e){return Nk[e]}_idx(e,n){if(e<-1||e>=this.dim+1||n<-1||n>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(n+1)*this.stride+(e+1)}static pack(e,n){const a=[0,0,0,0],d=iv.getUnpackVector(n);let c=Math.floor((e+d[3])/d[2]);return a[2]=c%256,c=Math.floor(c/256),a[1]=c%256,c=Math.floor(c/256),a[0]=c,a}getPixels(){return new Og({width:this.stride,height:this.stride},this.pixels)}backfillBorder(e,n,a){if(this.dim!==e.dim)throw new Error("dem dimension mismatch");let d=n*this.dim,c=n*this.dim+this.dim,p=a*this.dim,w=a*this.dim+this.dim;switch(n){case-1:d=c-1;break;case 1:c=d+1}switch(a){case-1:p=w-1;break;case 1:w=p+1}const T=-n*this.dim,P=-a*this.dim;for(let x=p;x<w;x++)for(let C=d;C<c;C++){const A=4*this._idx(C,x),E=4*this._idx(C+T,x+P);this.pixels[A+0]=e.pixels[E+0],this.pixels[A+1]=e.pixels[E+1],this.pixels[A+2]=e.pixels[E+2],this.pixels[A+3]=e.pixels[E+3]}}onDeserialize(){this._tree&&(this._tree.dem=this)}}function Vk(s,e,n){s===1?e.headerLength=n.readFixed32():s===2?e.x=n.readVarint():s===3?e.y=n.readVarint():s===4?e.z=n.readVarint():s===5&&e.layers.push(function(a,d){return a.readFields(qk,{version:0,name:"",units:"",tileSize:0,buffer:0,pixelFormat:0,dataIndex:[]},d)}(n,n.readVarint()+n.pos))}function Uk(s,e,n){s===1?(e.delta_filter=function(a,d){return a.readFields(Hk,{blockSize:0},d)}(n,n.readVarint()+n.pos),e.filter="delta_filter"):s===2?(n.readVarint(),e.filter="zigzag_filter"):s===3?(n.readVarint(),e.filter="bitshuffle_filter"):s===4&&(n.readVarint(),e.filter="byteshuffle_filter")}function Hk(s,e,n){s===1&&(e.blockSize=n.readVarint())}function Wk(s,e,n){s===1?(n.readVarint(),e.codec="gzip_data"):s===2?(n.readVarint(),e.codec="jpeg_image"):s===3?(n.readVarint(),e.codec="webp_image"):s===4&&(n.readVarint(),e.codec="png_image")}function Gk(s,e,n){let a=0,d=0;s===1?e.firstByte=n.readFixed64():s===2?e.lastByte=n.readFixed64():s===3?e.filters.push(function(c,p){return c.readFields(Uk,{},p)}(n,n.readVarint()+n.pos)):s===4?e.codec=function(c,p){return c.readFields(Wk,{},p)}(n,n.readVarint()+n.pos):s===5?d=n.readFloat():s===6?a=n.readFloat():s===7?e.bands.push(n.readString()):s===8?e.offset=n.readDouble():s===9&&(e.scale=n.readDouble()),e.offset===0&&(e.offset=d),e.scale===0&&(e.scale=a)}function qk(s,e,n){s===1?e.version=n.readVarint():s===2?e.name=n.readString():s===3?e.units=n.readString():s===4?e.tileSize=n.readVarint():s===5?e.buffer=n.readVarint():s===6?e.pixelFormat=n.readVarint():s===7&&e.dataIndex.push(function(a,d){return a.readFields(Gk,{firstByte:0,lastByte:0,filters:[],codec:null,offset:0,scale:0,bands:[]},d)}(n,n.readVarint()+n.pos))}function Zk(s,e,n){if(s===2)(function(a,d,c){a.readFields(Xk,c,d)})(n,n.readVarint()+n.pos,e);else if(s===3)throw new Error("Not implemented")}function Xk(s,e,n){if(s===1){let a=0;const d=n.readVarint()+n.pos;for(;n.pos<d;)e[a++]=n.readVarint()}}function Yk(s,e){if(e.length!==4)throw new Error(`Expected data of dimension 4 but got ${e.length}.`);let n=e[3];for(let a=2;a>=1;a--){const d=a===1?1:0,c=a===2?1:0;for(let p=0;p<e[0];p++){const w=e[1]*p;for(let T=d;T<e[1];T++){const P=e[2]*(T+w);for(let x=c;x<e[2];x++){const C=e[3]*(x+P);for(let A=0;A<e[3];A++){const E=C+A;s[E]+=s[E-n]}}}}n*=e[a]}return s}function Kk(s){for(let e=0,n=s.length;e<n;e++)s[e]=s[e]>>>1^-(1&s[e]);return s}function Jk(s,e){switch(e){case"uint32":return s;case"uint16":for(let n=0;n<s.length;n+=2){const a=s[n],d=s[n+1];s[n]=(240&a)>>4|(61440&a)>>8|(240&d)<<4|61440&d,s[n+1]=15&a|(3840&a)>>4|(15&d)<<8|(3840&d)<<4}return s;case"uint8":for(let n=0;n<s.length;n+=4){const a=s[n],d=s[n+1],c=s[n+2],p=s[n+3];s[n+0]=(192&a)>>6|(192&d)>>4|(192&c)>>2|192&p,s[n+1]=(48&a)>>4|(48&d)>>2|48&c|(48&p)<<2,s[n+2]=(12&a)>>2|12&d|(12&c)<<2|(12&p)<<4,s[n+3]=3&a|(3&d)<<2|(3&c)<<4|(3&p)<<6}return s;default:throw new Error(`Invalid pixel format, "${e}"`)}}qe(iv,"DEMData"),qe(VT,"DemMinMaxQuadTree",{omit:["dem"]});var du=Uint8Array,r_=Uint16Array,Qk=Int32Array,HT=new du([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),WT=new du([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),ez=new du([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),GT=function(s,e){for(var n=new r_(31),a=0;a<31;++a)n[a]=e+=1<<s[a-1];var d=new Qk(n[30]);for(a=1;a<30;++a)for(var c=n[a];c<n[a+1];++c)d[c]=c-n[a]<<5|a;return{b:n,r:d}},qT=GT(HT,2),ZT=qT.b,tz=qT.r;ZT[28]=258,tz[258]=28;for(var nz=GT(WT,0).b,XT=new r_(32768),bs=0;bs<32768;++bs){var Nm=(43690&bs)>>1|(21845&bs)<<1;XT[bs]=((65280&(Nm=(61680&(Nm=(52428&Nm)>>2|(13107&Nm)<<2))>>4|(3855&Nm)<<4))>>8|(255&Nm)<<8)>>1}var i_=function(s,e,n){for(var a=s.length,d=0,c=new r_(e);d<a;++d)s[d]&&++c[s[d]-1];var p,w=new r_(e);for(d=1;d<e;++d)w[d]=w[d-1]+c[d-1]<<1;p=new r_(1<<e);var T=15-e;for(d=0;d<a;++d)if(s[d])for(var P=d<<4|s[d],x=e-s[d],C=w[s[d]-1]++<<x,A=C|(1<<x)-1;C<=A;++C)p[XT[C]>>T]=P;return p},o_=new du(288);for(bs=0;bs<144;++bs)o_[bs]=8;for(bs=144;bs<256;++bs)o_[bs]=9;for(bs=256;bs<280;++bs)o_[bs]=7;for(bs=280;bs<288;++bs)o_[bs]=8;var YT=new du(32);for(bs=0;bs<32;++bs)YT[bs]=5;var rz=i_(o_,9),iz=i_(YT,5),$b=function(s){for(var e=s[0],n=1;n<s.length;++n)s[n]>e&&(e=s[n]);return e},Eh=function(s,e,n){var a=e/8|0;return(s[a]|s[a+1]<<8)>>(7&e)&n},Vb=function(s,e){var n=e/8|0;return(s[n]|s[n+1]<<8|s[n+2]<<16)>>(7&e)},oz=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],Th=function(s,e,n){var a=new Error(e||oz[s]);if(a.code=s,Error.captureStackTrace&&Error.captureStackTrace(a,Th),!n)throw a;return a},sz=new du(0),az=typeof TextDecoder<"u"&&new TextDecoder;try{az.decode(sz,{stream:!0})}catch{}const lz={gzip_data:"gzip"};class $u extends Error{constructor(e){super(e),this.name="MRTError"}}const cz={0:"uint32",1:"uint32",2:"uint16",3:"uint8"},KT={uint32:1,uint16:2,uint8:4},uz={uint32:Uint32Array,uint16:Uint16Array,uint8:Uint8Array};let Ub;class Hb{constructor(e=5){this.x=NaN,this.y=NaN,this.z=NaN,this.layers={},this._cacheSize=e}getLayer(e){const n=this.layers[e];if(!n)throw new $u(`Layer '${e}' not found`);return n}getHeaderLength(e){const n=new Uint8Array(e),a=new DataView(e);if(n[0]!==13)throw new $u("File is not a valid MRT.");return a.getUint32(1,!0)}parseHeader(e){const n=new Uint8Array(e),a=this.getHeaderLength(e);if(n.length<a)throw new $u(`Expected header with length >= ${a} but got buffer of length ${n.length}`);const d=function(c,p){return c.readFields(Vk,{headerLength:0,x:0,y:0,z:0,layers:[]},void 0)}(new Ub(n.subarray(0,a)));if(!isNaN(this.x)&&(this.x!==d.x||this.y!==d.y||this.z!==d.z))throw new $u(`Invalid attempt to parse header ${d.z}/${d.x}/${d.y} for tile ${this.z}/${this.x}/${this.y}`);this.x=d.x,this.y=d.y,this.z=d.z;for(const c of d.layers)this.layers[c.name]=new hz(c,{cacheSize:this._cacheSize});return this}createDecodingTask(e){const n=[],a=this.getLayer(e.layerName);for(let d of e.blockIndices){const c=a.dataIndex[d],p=c.firstByte-e.firstByte,w=c.lastByte-e.firstByte;if(a._blocksInProgress.has(d))continue;const T={layerName:a.name,firstByte:p,lastByte:w,pixelFormat:a.pixelFormat,blockIndex:d,blockShape:[c.bands.length].concat(a.bandShape),buffer:a.buffer,codec:c.codec.codec,filters:c.filters.map(P=>P.filter)};a._blocksInProgress.add(d),n.push(T)}return new JT(n,()=>{n.forEach(d=>a._blocksInProgress.delete(d.blockIndex))},(d,c)=>{if(n.forEach(p=>a._blocksInProgress.delete(p.blockIndex)),d)throw d;c.forEach(p=>{this.getLayer(p.layerName).processDecodedData(p)})})}}class hz{constructor({version:e,name:n,units:a,tileSize:d,pixelFormat:c,buffer:p,dataIndex:w},T){if(this.version=e,this.version!==1)throw new $u(`Cannot parse raster layer encoded with MRT version ${e}`);this.name=n,this.units=a,this.tileSize=d,this.buffer=p,this.pixelFormat=cz[c],this.dataIndex=w,this.bandShape=[d+2*p,d+2*p,KT[this.pixelFormat]],this._decodedBlocks=new Nb(T?T.cacheSize:5),this._blocksInProgress=new Set}get dimension(){return KT[this.pixelFormat]}get cacheSize(){return this._decodedBlocks.capacity}getBandList(){return this.dataIndex.map(({bands:e})=>e).flat()}processDecodedData(e){const n=e.blockIndex.toString();this._decodedBlocks.get(n)||this._decodedBlocks.put(n,e.data)}getBlockForBand(e){let n=0;switch(typeof e){case"string":for(const[a,d]of this.dataIndex.entries()){for(const[c,p]of d.bands.entries())if(p===e)return{bandIndex:n+c,blockIndex:a,blockBandIndex:c};n+=d.bands.length}break;case"number":for(const[a,d]of this.dataIndex.entries()){if(e>=n&&e<n+d.bands.length)return{bandIndex:e,blockIndex:a,blockBandIndex:e-n};n+=d.bands.length}break;default:throw new $u(`Invalid band \`${JSON.stringify(e)}\`. Expected string or integer.`)}throw new $u(`Band not found: ${JSON.stringify(e)}`)}getDataRange(e){let n=1/0,a=-1/0;const d=[],c=new Set;for(const p of e){const{blockIndex:w}=this.getBlockForBand(p);if(w<0)throw new $u(`Invalid band: ${JSON.stringify(p)}`);const T=this.dataIndex[w];d.includes(w)||d.push(w),c.add(w),n=Math.min(n,T.firstByte),a=Math.max(a,T.lastByte)}if(c.size>this.cacheSize)throw new $u(`Number of blocks to decode (${c.size}) exceeds cache size (${this.cacheSize}).`);return{layerName:this.name,firstByte:n,lastByte:a,blockIndices:d}}hasBand(e){const{blockIndex:n}=this.getBlockForBand(e);return n>=0}hasDataForBand(e){const{blockIndex:n}=this.getBlockForBand(e);return n>=0&&!!this._decodedBlocks.get(n.toString())}getBandView(e){const{blockIndex:n,blockBandIndex:a}=this.getBlockForBand(e),d=this._decodedBlocks.get(n.toString());if(!d)throw new $u(`Data for band ${JSON.stringify(e)} of layer "${this.name}" not decoded.`);const c=this.dataIndex[n],p=this.bandShape.reduce((P,x)=>P*x,1),w=a*p,T=d.subarray(w,w+p);return{data:T,bytes:new Uint8Array(T.buffer).subarray(T.byteOffset,T.byteOffset+T.byteLength),tileSize:this.tileSize,buffer:this.buffer,pixelFormat:this.pixelFormat,dimension:this.dimension,offset:c.offset,scale:c.scale}}}Hb.setPbf=function(s){Ub=s};class JT{constructor(e,n,a){this.tasks=e,this._onCancel=n,this._onComplete=a,this._finalized=!1}cancel(){this._finalized||(this._onCancel(),this._finalized=!0)}complete(e,n){this._finalized||(this._onComplete(e,n),this._finalized=!0)}}Hb.performDecoding=function(s,e){const n=new Uint8Array(s);return Promise.all(e.tasks.map(a=>{const{layerName:d,firstByte:c,lastByte:p,pixelFormat:w,blockShape:T,blockIndex:P,filters:x,codec:C}=a,A=n.subarray(c,p+1),E=new Uint32Array(T[0]*T[1]*T[2]);let M;if(C!=="gzip_data")throw new $u(`Unhandled codec: ${C}`);return M=function(k,N){if(!globalThis.DecompressionStream&&N==="gzip_data")return Promise.resolve(((W=function(he){he[0]==31&&he[1]==139&&he[2]==8||Th(6,"invalid gzip data");var we=he[3],be=10;4&we&&(be+=2+(he[10]|he[11]<<8));for(var ve=(we>>3&1)+(we>>4&1);ve>0;ve-=!he[be++]);return be+(2&we)}(X=k))+8>X.length&&Th(6,"invalid gzip data"),function(he,we,be,ve){var Be=he.length;if(!Be||we.f&&!we.l)return be||new du(0);var Me=!be,Ue=Me||we.i!=2,Ye=we.i;Me&&(be=new du(3*Be));var Xe,Je,st=function(cf){var Jf=be.length;if(cf>Jf){var Qf=new du(Math.max(2*Jf,cf));Qf.set(be),be=Qf}},pt=we.f||0,ot=we.p||0,It=we.b||0,tn=we.l,Lt=we.d,un=we.m,cn=we.n,vn=8*Be;do{if(!tn){pt=Eh(he,ot,1);var Bt=Eh(he,ot+1,3);if(ot+=3,!Bt){var Pn=he[(hr=4+((ot+7)/8|0))-4]|he[hr-3]<<8,dn=hr+Pn;if(dn>Be){Ye&&Th(0);break}Ue&&st(It+Pn),be.set(he.subarray(hr,dn),It),we.b=It+=Pn,we.p=ot=8*dn,we.f=pt;continue}if(Bt==1)tn=rz,Lt=iz,un=9,cn=5;else if(Bt==2){var Cn=Eh(he,ot,31)+257,Zn=Eh(he,ot+10,15)+4,xr=Cn+Eh(he,ot+5,31)+1;ot+=14;for(var Cr=new du(xr),Or=new du(19),Mr=0;Mr<Zn;++Mr)Or[ez[Mr]]=Eh(he,ot+3*Mr,7);ot+=3*Zn;var Zr=$b(Or),Bi=(1<<Zr)-1,Mi=i_(Or,Zr);for(Mr=0;Mr<xr;){var hr,Ai=Mi[Eh(he,ot,Bi)];if(ot+=15&Ai,(hr=Ai>>4)<16)Cr[Mr++]=hr;else{var Ti=0,Ni=0;for(hr==16?(Ni=3+Eh(he,ot,3),ot+=2,Ti=Cr[Mr-1]):hr==17?(Ni=3+Eh(he,ot,7),ot+=3):hr==18&&(Ni=11+Eh(he,ot,127),ot+=7);Ni--;)Cr[Mr++]=Ti}}var ws=Cr.subarray(0,Cn),Ss=Cr.subarray(Cn);un=$b(ws),cn=$b(Ss),tn=i_(ws,un),Lt=i_(Ss,cn)}else Th(1);if(ot>vn){Ye&&Th(0);break}}Ue&&st(It+131072);for(var qo=(1<<un)-1,Zl=(1<<cn)-1,fo=ot;;fo=ot){var bo=(Ti=tn[Vb(he,ot)&qo])>>4;if((ot+=15&Ti)>vn){Ye&&Th(0);break}if(Ti||Th(2),bo<256)be[It++]=bo;else{if(bo==256){fo=ot,tn=null;break}var Tl=bo-254;bo>264&&(Tl=Eh(he,ot,(1<<(js=HT[Mr=bo-257]))-1)+ZT[Mr],ot+=js);var Es=Lt[Vb(he,ot)&Zl],fc=Es>>4;if(Es||Th(3),ot+=15&Es,Ss=nz[fc],fc>3){var js=WT[fc];Ss+=Vb(he,ot)&(1<<js)-1,ot+=js}if(ot>vn){Ye&&Th(0);break}Ue&&st(It+131072);var gd=It+Tl;if(It<Ss){var Yf=0-Ss,Kf=Math.min(Ss,gd);for(Yf+It<0&&Th(3);It<Kf;++It)be[It]=(void 0)[Yf+It]}for(;It<gd;++It)be[It]=be[It-Ss]}}we.l=tn,we.p=fo,we.b=It,we.f=pt,tn&&(pt=1,we.m=un,we.d=Lt,we.n=cn)}while(!pt);return It!=be.length&&Me?(Xe=be,((Je=It)==null||Je>Xe.length)&&(Je=Xe.length),new du(Xe.subarray(0,Je))):be.subarray(0,It)}(X.subarray(W,-8),{i:2},new du(((j=X)[(q=j.length)-4]|j[q-3]<<8|j[q-2]<<16|j[q-1]<<24)>>>0))));var j,q,X,W;const J=lz[N];if(!J)throw new Error(`Unhandled codec: ${N}`);const ne=new globalThis.DecompressionStream(J);return new Response(new Blob([k]).stream().pipeThrough(ne)).arrayBuffer().then(he=>new Uint8Array(he))}(A,C).then(k=>(function(N,j){N.readFields(Zk,j)}(new Ub(k),E),new uz[w](E.buffer))),M.then(k=>{for(let N=x.length-1;N>=0;N--)switch(x[N]){case"delta_filter":Yk(k,T);break;case"zigzag_filter":Kk(k);break;case"bitshuffle_filter":Jk(k,w);break;default:throw new $u(`Unhandled filter "${x[N]}"`)}return{layerName:d,blockIndex:P,data:k}}).catch(k=>{throw k})}))},qe(JT,"MRTDecodingBatch",{omit:["_onCancel","_onComplete"]});let s_,Wb,Ch,jm,Gb,$m=null;function QT(){return as()&&self.worker&&self.worker.dracoUrl?self.worker.dracoUrl:Wb||Se.DRACO_URL}function eC(){if(as()&&self.worker&&self.worker.meshoptUrl)return self.worker.meshoptUrl;if(jm)return jm;const s=new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,3,2,0,0,5,3,1,0,1,12,1,0,10,22,2,12,0,65,0,65,0,65,0,252,10,0,0,11,7,0,65,0,253,15,26,11]);if(typeof WebAssembly!="object")throw new Error("WebAssembly not supported, cannot instantiate meshoptimizer");return jm=WebAssembly.validate(s)?Se.MESHOPT_SIMD_URL:Se.MESHOPT_URL,jm}const ov={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},dz={5120:"DT_INT8",5121:"DT_UINT8",5122:"DT_INT16",5123:"DT_UINT16",5125:"DT_UINT32",5126:"DT_FLOAT32"},a_={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16};function tC(s,e,n){const a=n.json.bufferViews.length,d=n.buffers.length;e.bufferView=a,n.json.bufferViews[a]={buffer:d,byteLength:s.byteLength},n.buffers[d]=s}const qb="KHR_draco_mesh_compression";function fz(s,e){const n=s.extensions&&s.extensions[qb];if(!n)return;const a=new Ch.Decoder,d=oC(e,n.bufferView),c=new Ch.Mesh;if(!a.DecodeArrayToMesh(d,d.byteLength,c))throw new Error("Failed to decode Draco mesh");const p=e.json.accessors[s.indices],w=ov[p.componentType],T=p.count*w.BYTES_PER_ELEMENT,P=Ch._malloc(T);w===Uint16Array?a.GetTrianglesUInt16Array(c,T,P):a.GetTrianglesUInt32Array(c,T,P),tC(Ch.memory.buffer.slice(P,P+T),p,e),Ch._free(P);for(const x of Object.keys(n.attributes)){const C=a.GetAttributeByUniqueId(c,n.attributes[x]),A=e.json.accessors[s.attributes[x]],E=dz[A.componentType],M=A.count*a_[A.type]*ov[A.componentType].BYTES_PER_ELEMENT,k=Ch._malloc(M);a.GetAttributeDataArrayForAllPoints(c,C,Ch[E],M,k),tC(Ch.memory.buffer.slice(k,k+M),A,e),Ch._free(k)}a.destroy(),c.destroy(),delete s.extensions[qb]}const sv="EXT_meshopt_compression";function pz(s,e){if(!s.extensions||!s.extensions[sv])return;const n=s.extensions[sv],a=new Uint8Array(e.buffers[n.buffer],n.byteOffset||0,n.byteLength||0),d=new Uint8Array(n.count*n.byteStride);Gb.decodeGltfBuffer(d,n.count,n.byteStride,a,n.mode,n.filter),s.buffer=e.buffers.length,s.byteOffset=0,e.buffers[s.buffer]=d.buffer,delete s.extensions[sv]}const nC=1179937895,rC=new TextDecoder("utf8");function iC(s,e){return new URL(s,e).href}function mz(s,e,n,a){return fetch(iC(s.uri,a)).then(d=>d.arrayBuffer()).then(d=>{e.buffers[n]=d})}function oC(s,e){const n=s.json.bufferViews[e];return new Uint8Array(s.buffers[n.buffer],n.byteOffset||0,n.byteLength)}function gz(s,e,n,a){if(s.uri){const d=iC(s.uri,a);return fetch(d).then(c=>c.blob()).then(c=>createImageBitmap(c)).then(c=>{e.images[n]=c})}if(s.bufferView!==void 0){const d=oC(e,s.bufferView),c=new Blob([d],{type:s.mimeType});return createImageBitmap(c).then(p=>{e.images[n]=p})}}function sC(s,e=0,n){const a={json:null,images:[],buffers:[]};if(new Uint32Array(s,e,1)[0]===nC){const x=new Uint32Array(s,e);let C=2;const A=(x[C++]>>2)-3,E=x[C++]>>2;if(C++,a.json=JSON.parse(rC.decode(x.subarray(C,C+E))),C+=E,C<A){const M=x[C++];C++;const k=e+(C<<2);a.buffers[0]=s.slice(k,k+M)}}else a.json=JSON.parse(rC.decode(new Uint8Array(s,e)));const{buffers:d,images:c,meshes:p,extensionsUsed:w,bufferViews:T}=a.json;let P=Promise.resolve();if(d){const x=[];for(let C=0;C<d.length;C++){const A=d[C];A.uri?x.push(mz(A,a,C,n)):a.buffers[C]||(a.buffers[C]=null)}P=Promise.all(x)}return P.then(()=>{const x=[],C=w&&w.includes(qb),A=w&&w.includes(sv);if(C&&x.push(function(){if(!Ch)return s_??(s_=function(E){let M,k=null;function N(){M=new Uint8Array(k.buffer)}function j(){throw new Error("Unexpected Draco error.")}const q={a:{a:j,d:function(X,W,J){return M.copyWithin(X,W,W+J)},c:function(X){const W=M.length,J=Math.max(X>>>0,Math.ceil(1.2*W)),ne=Math.ceil((J-W)/65536);try{return k.grow(ne),N(),!0}catch{return!1}},b:j}};return(WebAssembly.instantiateStreaming?WebAssembly.instantiateStreaming(E,q):E.then(X=>X.arrayBuffer()).then(X=>WebAssembly.instantiate(X,q))).then(X=>{const{Rb:W,Qb:J,P:ne,T:he,X:we,Ja:be,La:ve,Qa:Be,Va:Me,Wa:Ue,eb:Ye,jb:Xe,f:Je,e:st,yb:pt,zb:ot,Ab:It,Bb:tn,Db:Lt,Gb:un}=X.instance.exports;k=st;const cn=(()=>{let vn=0,Bt=0,Pn=0,dn=0;return Cn=>{Pn&&(W(dn),W(vn),Bt+=Pn,Pn=vn=0),vn||(Bt+=128,vn=J(Bt));const Zn=Cn.length+7&-8;let xr=vn;Zn>=Bt&&(Pn=Zn,xr=dn=J(Zn));for(let Cr=0;Cr<Cn.length;Cr++)M[xr+Cr]=Cn[Cr];return xr}})();return N(),Je(),{memory:st,_free:W,_malloc:J,Mesh:class{constructor(){this.ptr=ne()}destroy(){he(this.ptr)}},Decoder:class{constructor(){this.ptr=be()}destroy(){Xe(this.ptr)}DecodeArrayToMesh(vn,Bt,Pn){const dn=cn(vn),Cn=ve(this.ptr,dn,Bt,Pn.ptr);return!!we(Cn)}GetAttributeByUniqueId(vn,Bt){return{ptr:Be(this.ptr,vn.ptr,Bt)}}GetTrianglesUInt16Array(vn,Bt,Pn){Me(this.ptr,vn.ptr,Bt,Pn)}GetTrianglesUInt32Array(vn,Bt,Pn){Ue(this.ptr,vn.ptr,Bt,Pn)}GetAttributeDataArrayForAllPoints(vn,Bt,Pn,dn,Cn){Ye(this.ptr,vn.ptr,Bt.ptr,Pn,dn,Cn)}},DT_INT8:pt(),DT_UINT8:ot(),DT_INT16:It(),DT_UINT16:tn(),DT_UINT32:Lt(),DT_FLOAT32:un()}})}(fetch(QT())),s_.then(E=>{Ch=E,s_=void 0}))}()),A&&x.push(function(){if(Gb)return;const E=function(M){let k;const N=WebAssembly.instantiateStreaming(M,{}).then(X=>{k=X.instance,k.exports.__wasm_call_ctors()}),j={NONE:"",OCTAHEDRAL:"meshopt_decodeFilterOct",QUATERNION:"meshopt_decodeFilterQuat",EXPONENTIAL:"meshopt_decodeFilterExp"},q={ATTRIBUTES:"meshopt_decodeVertexBuffer",TRIANGLES:"meshopt_decodeIndexBuffer",INDICES:"meshopt_decodeIndexSequence"};return{ready:N,supported:!0,decodeGltfBuffer(X,W,J,ne,he,we){(function(be,ve,Be,Me,Ue,Ye,Xe){const Je=be.exports.sbrk,st=Me+3&-4,pt=Je(st*Ue),ot=Je(Ye.length),It=new Uint8Array(be.exports.memory.buffer);It.set(Ye,ot);const tn=ve(pt,Me,Ue,ot,Ye.length);if(tn===0&&Xe&&Xe(pt,st,Ue),Be.set(It.subarray(pt,pt+Me*Ue)),Je(pt-Je(0)),tn!==0)throw new Error(`Malformed buffer data: ${tn}`)})(k,k.exports[q[he]],X,W,J,ne,k.exports[j[we]])}}}(fetch(eC()));return E.ready.then(()=>{Gb=E})}()),c)for(let E=0;E<c.length;E++)x.push(gz(c[E],a,E,n));return(x.length?Promise.all(x):Promise.resolve()).then(()=>{if(C&&p)for(const{primitives:E}of p)for(const M of E)fz(M,a);if(A&&p&&T)for(const E of T)pz(E,a);return a})})}function Hp(s,e){const n=s.json.bufferViews[e.bufferView],a=ov[e.componentType];return new a(s.buffers[n.buffer],(e.byteOffset||0)+(n.byteOffset||0),e.count*(n.byteStride&&n.byteStride!==a_[e.type]*a.BYTES_PER_ELEMENT?n.byteStride/a.BYTES_PER_ELEMENT:a_[e.type]))}function Zb(s,e,n,a){const d=ov[e.componentType],c=function(x){switch(x){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:return 1}}(d),p=s.json.bufferViews[e.bufferView],w=p.byteStride?p.byteStride/d.BYTES_PER_ELEMENT:a_[e.type],T=n.float32,P=T.length/n.capacity;for(let x=0,C=0;x<e.count*w;x+=w,C+=P)for(let A=0;A<P;A++)T[C+A]=a[x+A]*c;n._trim()}function _z(s,e,n){const a=s.indices,d=s.attributes,c={};c.indexArray=new Ns;const p=e.json.accessors[a],w=p.count/3;c.indexArray.reserve(w);const T=Hp(e,p);for(let A=0;A<w;A++)c.indexArray.emplaceBack(T[3*A],T[3*A+1],T[3*A+2]);c.indexArray._trim(),c.vertexArray=new Vl;const P=e.json.accessors[d.POSITION];c.vertexArray.reserve(P.count);const x=Hp(e,P);for(let A=0;A<P.count;A++)c.vertexArray.emplaceBack(x[3*A],x[3*A+1],x[3*A+2]);if(c.vertexArray._trim(),c.aabb=new Bn(P.min,P.max),c.centroid=function(A,E){const M=[0,0,0],k=A.length;if(k>0){for(let N=0;N<k;N++){const j=3*A[N];M[0]+=E[j],M[1]+=E[j+1],M[2]+=E[j+2]}M[0]/=k,M[1]/=k,M[2]/=k}return M}(T,x),d.COLOR_0!==void 0){const A=e.json.accessors[d.COLOR_0],E=a_[A.type],M=Hp(e,A);c.colorArray=E===3?new Vl:new xl,c.colorArray.resize(A.count),Zb(e,A,c.colorArray,M)}if(d.NORMAL!==void 0){c.normalArray=new Vl;const A=e.json.accessors[d.NORMAL];c.normalArray.resize(A.count);const E=Hp(e,A);Zb(e,A,c.normalArray,E)}if(d.TEXCOORD_0!==void 0&&n.length>0){c.texcoordArray=new Pc;const A=e.json.accessors[d.TEXCOORD_0];c.texcoordArray.resize(A.count);const E=Hp(e,A);Zb(e,A,c.texcoordArray,E)}if(d._FEATURE_ID_RGBA4444!==void 0){const A=e.json.accessors[d._FEATURE_ID_RGBA4444];e.json.extensionsUsed&&e.json.extensionsUsed.includes("EXT_meshopt_compression")&&(c.featureData=Hp(e,A))}d._FEATURE_RGBA4444!==void 0&&(c.featureData=new Uint32Array(Hp(e,e.json.accessors[d._FEATURE_RGBA4444]).buffer));const C=s.material;return c.material=function(A,E){const{emissiveFactor:M=[0,0,0],alphaMode:k="OPAQUE",alphaCutoff:N=.5,normalTexture:j,occlusionTexture:q,emissiveTexture:X,doubleSided:W}=A,{baseColorFactor:J=[1,1,1,1],metallicFactor:ne=1,roughnessFactor:he=1,baseColorTexture:we,metallicRoughnessTexture:be}=A.pbrMetallicRoughness||{},ve=q?E[q.index]:void 0;if(q&&q.extensions&&q.extensions.KHR_texture_transform&&ve){const Be=q.extensions.KHR_texture_transform;ve.offsetScale=[Be.offset[0],Be.offset[1],Be.scale[0],Be.scale[1]]}return{pbrMetallicRoughness:{baseColorFactor:new ir(...J),metallicFactor:ne,roughnessFactor:he,baseColorTexture:we?E[we.index]:void 0,metallicRoughnessTexture:be?E[be.index]:void 0},doubleSided:W,emissiveFactor:M,alphaMode:k,alphaCutoff:N,normalTexture:j?E[j.index]:void 0,occlusionTexture:ve,emissionTexture:X?E[X.index]:void 0,defined:A.defined===void 0}}(C!==void 0?e.json.materials[C]:{defined:!1},n),c}function aC(s,e,n){const{matrix:a,rotation:d,translation:c,scale:p,mesh:w,extras:T,children:P}=s,x={};if(x.matrix=a||Re.mat4.fromRotationTranslationScale([],d||[0,0,0,1],c||[0,0,0],p||[1,1,1]),w!==void 0){x.meshes=n[w];const C=x.anchor=[0,0];for(const A of x.meshes){const{min:E,max:M}=A.aabb;C[0]+=E[0]+M[0],C[1]+=E[1]+M[1]}C[0]=Math.floor(C[0]/x.meshes.length/2),C[1]=Math.floor(C[1]/x.meshes.length/2)}if(T&&(T.id&&(x.id=T.id),T.lights&&(x.lights=function(C){if(!C.length)return[];const A=function(j){const q=atob(j),X=new Uint8Array(q.length);for(let W=0;W<q.length;W++)X[W]=q.codePointAt(W);return X}(C),E=[],M=A.length/24,k=new Uint16Array(A.buffer),N=new Float32Array(A.buffer);for(let j=0;j<M;j++){const q=k[2*j*6]/30,X=k[2*j*6+1]/30,W=k[2*j*6+10]/100,J=N[6*j+1],ne=N[6*j+2],he=N[6*j+3],we=N[6*j+4],be=he-J,ve=we-ne,Be=Math.hypot(be,ve);E.push({pos:[J+.5*be,ne+.5*ve,X],normal:[ve/Be,-be/Be,0],width:Be,height:q,depth:W,points:[J,ne,he,we]})}return E}(T.lights))),P){const C=[];for(const A of P)C.push(aC(e.json.nodes[A],e,n));x.children=C}return x}function yz(s){if(s.vertices.length===0||s.indices.length===0)return null;const e=new br(s.vertices,s.indices,8,256),[n,a]=[e.min.clone(),e.max.clone()];return{vertices:s.vertices,indices:s.indices,grid:e,min:n,max:a}}function vz(s){if(!s.extras||!s.extras.ground)return null;const e=s.extras.ground;if(!e||!Array.isArray(e)||e.length===0)return null;const n=e[0];if(!n||!Array.isArray(n)||n.length===0)return null;const a=[];for(const p of n){if(!Array.isArray(p)||p.length!==2)continue;const w=p[0],T=p[1];typeof w=="number"&&typeof T=="number"&&a.push(new Ht(w,T))}if(a.length<3)return null;a.length>1&&a[a.length-1].equals(a[0])&&a.pop();let d=0;for(let p=0;p<a.length;p++){const w=a[p],T=a[(p+1)%a.length],P=a[(p+2)%a.length];d+=(w.x-T.x)*(P.y-T.y)-(P.x-T.x)*(w.y-T.y)}d>0&&a.reverse();const c=Hf(a.flatMap(p=>[p.x,p.y]),[]);return c.length===0?null:{vertices:a,indices:c}}function xz(s,e){const n=[],a=[];let d=0;const c=[];for(const p of s){d=n.length;const w=p.vertexArray.float32,T=p.indexArray.uint16;for(let P=0;P<p.vertexArray.length;P++)c[0]=w[3*P+0],c[1]=w[3*P+1],c[2]=w[3*P+2],Re.vec3.transformMat4(c,c,e),n.push(new Ht(c[0],c[1]));for(let P=0;P<3*p.indexArray.length;P++)a.push(T[P]+d)}if(a.length%3!=0)return null;for(let p=0;p<a.length;p+=3){const w=n[a[p+0]],T=n[a[p+1]],P=n[a[p+2]];(w.x-T.x)*(P.y-T.y)-(P.x-T.x)*(w.y-T.y)>0&&([a[p+1],a[p+2]]=[a[p+2],a[p+1]])}return{vertices:n,indices:a}}function lC(s){const e=function(T,P){const x=[],C=WebGL2RenderingContext;if(T.json.textures)for(const A of T.json.textures){const E={magFilter:C.LINEAR,minFilter:C.NEAREST,wrapS:C.REPEAT,wrapT:C.REPEAT};A.sampler!==void 0&&Object.assign(E,T.json.samplers[A.sampler]),x.push({image:P[A.source],sampler:E,uploaded:!1})}return x}(s,s.images),n=function(T,P){const x=[];for(const C of T.json.meshes){const A=[];for(const E of C.primitives)A.push(_z(E,T,P));x.push(A)}return x}(s,e),{scenes:a,scene:d,nodes:c}=s.json,p=a?a[d||0].nodes:c,w=[];for(const T of p)w.push(aC(c[T],s,n));return function(T,P,x){const C={},A=new Set;for(let E=0;E<T.length;E++){const M=x[P[E]];if(!M.extras)continue;const k=M.extras["mapbox:footprint:version"],N=M.extras["mapbox:footprint:id"];(k||N)&&A.add(E),k==="1.0.0"&&N&&(C[N]=E)}for(let E=0;E<T.length;E++){if(A.has(E))continue;const M=T[E],k=x[P[E]];if(!k.extras)continue;let N=null;M.id in C&&(N=xz(T[C[M.id]].meshes,M.matrix)),N||(N=vz(k)),N&&(M.footprint=yz(N))}if(A.size>0){const E=Array.from(A.values()).sort((M,k)=>M-k);for(let M=E.length-1;M>=0;M--)T.splice(E[M],1)}}(w,p,s.json.nodes),w}function bz(s){s.heightmap=new Float32Array(4096),s.heightmap.fill(-1);const e=s.vertexArray.float32,n=s.aabb.min[0]-1,a=s.aabb.min[1]-1,d=$p/(s.aabb.max[0]-n+2),c=$p/(s.aabb.max[1]-a+2);for(let p=0;p<e.length;p+=3){const w=e[p+2],T=(e[p+0]-n)*d|0,P=(e[p+1]-a)*c|0;w>s.heightmap[P*$p+T]&&(s.heightmap[P*$p+T]=w)}}function wz(s,e){const n={};n.indexArray=new Ns,n.indexArray.reserve(4*s.length),n.vertexArray=new Vl,n.vertexArray.reserve(10*s.length),n.colorArray=new xl,n.vertexArray.reserve(10*s.length);let a=0;for(const p of s){const w=Math.min(10,Math.max(4,1.3*p.height))*e,T=[-p.normal[1],p.normal[0],0],P=Math.min(.29,.1*p.width/p.depth),x=p.width-2*p.depth*e*(P+.01),C=Re.vec3.scaleAndAdd([],p.pos,T,x/2),A=Re.vec3.scaleAndAdd([],p.pos,T,-x/2),E=[C[0],C[1],C[2]+p.height],M=[A[0],A[1],A[2]+p.height],k=Re.vec3.scaleAndAdd([],p.normal,T,P);Re.vec3.scale(k,k,w);const N=Re.vec3.scaleAndAdd([],p.normal,T,-P);Re.vec3.scale(N,N,w),Re.vec3.add(k,C,k),Re.vec3.add(N,A,N),C[2]+=.1,A[2]+=.1,n.vertexArray.emplaceBack(k[0],k[1],k[2]),n.vertexArray.emplaceBack(N[0],N[1],N[2]),n.vertexArray.emplaceBack(C[0],C[1],C[2]),n.vertexArray.emplaceBack(A[0],A[1],A[2]),n.vertexArray.emplaceBack(E[0],E[1],E[2]),n.vertexArray.emplaceBack(M[0],M[1],M[2]),n.vertexArray.emplaceBack(C[0],C[1],C[2]),n.vertexArray.emplaceBack(A[0],A[1],A[2]),n.vertexArray.emplaceBack(k[0],k[1],k[2]),n.vertexArray.emplaceBack(N[0],N[1],N[2]);const j=x/w/2;n.colorArray.emplaceBack(-j-P,-1,j,.8),n.colorArray.emplaceBack(j+P,-1,j,.8),n.colorArray.emplaceBack(-j,0,j,1.3),n.colorArray.emplaceBack(j,0,j,1.3),n.colorArray.emplaceBack(j+P,-.8,j,.7),n.colorArray.emplaceBack(j+P,-.8,j,.7),n.colorArray.emplaceBack(0,0,j,1.3),n.colorArray.emplaceBack(0,0,j,1.3),n.colorArray.emplaceBack(j+P,-1.2,j,.8),n.colorArray.emplaceBack(j+P,-1.2,j,.8),n.indexArray.emplaceBack(6+a,4+a,8+a),n.indexArray.emplaceBack(7+a,9+a,5+a),n.indexArray.emplaceBack(0+a,1+a,2+a),n.indexArray.emplaceBack(1+a,3+a,2+a),a+=10}const d={defined:!0,emissiveFactor:[0,0,0]},c={};return c.baseColorFactor=ir.white,d.pbrMetallicRoughness=c,n.material=d,n.aabb=new Bn([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),n}class cC{constructor(e){this._stringToNumber={},this._numberToString=[];for(let n=0;n<e.length;n++){const a=e[n];this._stringToNumber[a]=n,this._numberToString[n]=a}}encode(e){return this._stringToNumber[e]}decode(e){return this._numberToString[e]}}const Sz=["id","tile","layer","source","sourceLayer","state"];class Vm{constructor(e,n,a,d,c){this.type="Feature",this._vectorTileFeature=e,this._z=n,this._x=a,this._y=d,this.properties=e.properties,this.id=c}clone(){const e=new Vm(this._vectorTileFeature,this._z,this._x,this._y,this.id);return this.state&&(e.state={...this.state}),this.layer&&(e.layer={...this.layer}),this.source&&(e.source=this.source),this.sourceLayer&&(e.sourceLayer=this.sourceLayer),e}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._x,this._y,this._z).geometry),this._geometry}set geometry(e){this._geometry=e}toJSON(){const e={type:"Feature",state:void 0,geometry:this.geometry,properties:this.properties};for(const n of Sz)this[n]!==void 0&&(e[n]=this[n]);return e}}class uC{constructor(e,n){this.tileID=e,this.x=e.canonical.x,this.y=e.canonical.y,this.z=e.canonical.z,this.grid=new ae(pn,16,0),this.featureIndexArray=new fm,this.promoteId=n,this.is3DTile=!1,this.serializedLayersCache=new Map}insert(e,n,a,d,c,p=0,w=0){const T=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(a,d,c,p);const P=this.grid;for(let x=0;x<n.length;x++){const C=n[x],A=[1/0,1/0,-1/0,-1/0];for(let E=0;E<C.length;E++){const M=C[E];A[0]=Math.min(A[0],M.x),A[1]=Math.min(A[1],M.y),A[2]=Math.max(A[2],M.x),A[3]=Math.max(A[3],M.y)}w!==0&&(A[0]-=w,A[1]-=w,A[2]+=w,A[3]+=w),A[0]<pn&&A[1]<pn&&A[2]>=0&&A[3]>=0&&P.insert(T,A[0],A[1],A[2],A[3])}}loadVTLayers(){if(!this.vtLayers){this.vtLayers=new Am.VectorTile(new Iy(this.rawTileData)).layers,this.sourceLayerCoder=new cC(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"]),this.vtFeatures={};for(const e in this.vtLayers)this.vtFeatures[e]=[]}return this.vtLayers}query(e,n){const{tilespaceGeometry:a,transform:d,tileTransform:c,pixelPosMatrix:p,availableImages:w}=n;this.loadVTLayers(),this.serializedLayersCache.clear();const T=a.bufferedTilespaceBounds,P=this.grid.query(T.min.x,T.min.y,T.max.x,T.max.y,(E,M,k,N)=>ft(a.bufferedTilespaceGeometry,E,M,k,N));P.sort(Ez);let x=null;d.elevation&&P.length>0&&(x=Om.create(d.elevation,this.tileID));const C={};let A;for(let E=0;E<P.length;E++){const M=P[E];if(M===A)continue;A=M;const k=this.featureIndexArray.get(M);let N=null;this.is3DTile?this.loadMatchingModelFeature(C,k,e,a,d):this.loadMatchingFeature(C,k,e,w,(j,q,X,W=0)=>(N||(N=U(j,this.tileID.canonical,c)),q.queryIntersectsFeature(a,j,X,N,this.z,d,p,x,W)))}return C}loadMatchingFeature(e,n,a,d,c){const{featureIndex:p,bucketIndex:w,sourceLayerIndex:T,layoutVertexArrayOffset:P}=n,x=this.bucketLayerIDs[w],C=a.layers,A=Object.keys(C);if(A.length&&!function(j,q){for(let X=0;X<j.length;X++)if(q.indexOf(j[X])>=0)return!0;return!1}(A,x))return;const E=a.sourceCache,M=this.sourceLayerCoder.decode(T),k=this.vtLayers[M].feature(p),N=this.getId(k,M);for(let j=0;j<x.length;j++){const q=x[j];if(!C[q])continue;const{styleLayer:X,targets:W}=C[q];let J={};N!==void 0&&(J=E.getFeatureState(X.sourceLayer,N));const ne=!c||c(k,X,J,P);if(!ne)continue;const he=new Vm(k,this.z,this.x,this.y,N);he.tile=this.tileID.canonical,he.state=J;let we=this.serializedLayersCache.get(q);we||(we=X.serialize(),we.id=q,this.serializedLayersCache.set(q,we)),he.source=we.source,he.sourceLayer=we["source-layer"],he.layer=Lr({},we),he.layer.paint=hC(we.paint,X.paint,k,J,d),he.layer.layout=hC(we.layout,X.layout,k,J,d);let be=!1;for(const ve of W){this.updateFeatureProperties(he,ve);const{filter:Be}=ve;if(Be){if(k.properties=he.properties,Be.needGeometry){const Me=G(k,!0);if(!Be.filter(new qr(this.tileID.overscaledZ),Me,this.tileID.canonical))continue}else if(!Be.filter(new qr(this.tileID.overscaledZ),k))continue}be=!0,ve.targetId&&this.addFeatureVariant(he,ve)}be&&this.appendToResult(e,q,p,he,ne)}}loadMatchingModelFeature(e,n,a,d,c){const p=this.bucketLayerIDs[0][0],w=a.layers;if(!w[p])return;const{styleLayer:T,targets:P}=w[p];if(T.type!=="model")return;const x=d.tile,C=n.featureIndex,A=x.getBucket(T);if(!(A&&A instanceof Ky))return;const E=function(we,be,ve,Be){const Me=we.getNodesInfo()[be];if(Me.hiddenByReplacement||!Me.node.meshes)return;let Ue=Number.MAX_VALUE;const Ye=Me.node,Xe=ve.tile,Je=Be.calculatePosMatrix(Xe.tileID.toUnwrapped(),Be.worldSize),st=Me.evaluatedScale;let pt=0;Be.elevation&&Ye.elevation&&(pt=Ye.elevation*Be.elevation.exaggeration()),Re.mat4.translate(Je,Je,[(Ye.anchor?Ye.anchor[0]:0)*(st[0]-1),(Ye.anchor?Ye.anchor[1]:0)*(st[1]-1),pt]),Re.mat4.scale(Je,Je,st);const ot=ve.queryGeometry,It=ot.isPointQuery()?ot.screenBounds:ot.screenGeometry,tn=function(un){const cn=Re.mat4.multiply([],Je,un.matrix);Re.mat4.multiply(cn,Be.expandedFarZProjMatrix,cn);for(let vn=0;vn<un.meshes.length;++vn){const Bt=un.meshes[vn];if(vn===un.lightMeshIndex)continue;const Pn=hT(It,Be,cn,Bt.aabb);Pn!=null&&(Ue=Math.min(Pn,Ue))}if(un.children)for(const vn of un.children)tn(vn)};if(tn(Ye),Ue===Number.MAX_VALUE)return;const Lt=new Qr(0,0);return ST(Xe.tileID.canonical,Lt,Me.node.anchor[0],Me.node.anchor[1]),{intersectionZ:Ue,position:Lt,feature:Me.feature}}(A,C,d,c);if(!E)return;const{z:M,x:k,y:N}=x.tileID.canonical,{feature:j,intersectionZ:q,position:X}=E;let W={};j.id!==void 0&&(W=a.sourceCache.getFeatureState(T.sourceLayer,j.id));const J=new Vm({},M,k,N,j.id);J.tile=this.tileID.canonical,J.state=W,J.properties=j.properties,J.geometry={type:"Point",coordinates:[X.lng,X.lat]};let ne=this.serializedLayersCache.get(p);ne||(ne=T.serialize(),ne.id=p,this.serializedLayersCache.set(p,ne)),J.source=ne.source,J.sourceLayer=ne["source-layer"],J.layer=Lr({},ne);let he=!1;for(const we of P){this.updateFeatureProperties(J,we);const{filter:be}=we;if(be){if(j.properties=J.properties,be.needGeometry){if(!be.filter(new qr(this.tileID.overscaledZ),j,this.tileID.canonical))continue}else if(!be.filter(new qr(this.tileID.overscaledZ),j))continue}he=!0,we.targetId&&this.addFeatureVariant(J,we)}he&&this.appendToResult(e,p,C,J,q)}updateFeatureProperties(e,n,a){if(n.properties){const d={};for(const c in n.properties){const p=n.properties[c].evaluate({zoom:this.z},e._vectorTileFeature,e.state,e.tile,a);p!=null&&(d[c]=p)}e.properties=d}}addFeatureVariant(e,n,a){const d={target:n.target,namespace:n.namespace};n.properties&&(d.properties=e.properties),e.variants=e.variants||{},e.variants[n.targetId]=e.variants[n.targetId]||[],e.variants[n.targetId].push(d)}appendToResult(e,n,a,d,c){let p=e[n];p===void 0&&(p=e[n]=[]),p.push({featureIndex:a,feature:d,intersectionZ:c})}lookupSymbolFeatures(e,n,a,d,c){const p={};this.loadVTLayers();for(const w of e)this.loadMatchingFeature(p,{bucketIndex:n,sourceLayerIndex:a,featureIndex:w,layoutVertexArrayOffset:0},d,c);return p}loadFeature(e){const{featureIndex:n,sourceLayerIndex:a}=e;this.loadVTLayers();const d=this.sourceLayerCoder.decode(a),c=this.vtFeatures[d];if(c[n])return c[n];const p=this.vtLayers[d].feature(n);return c[n]=p,p}hasLayer(e){for(const n of this.bucketLayerIDs)for(const a of n)if(e===a)return!0;return!1}getId(e,n){let a=e.id;if(this.promoteId){const d=typeof this.promoteId=="string"?this.promoteId:this.promoteId[n];d!=null&&(a=e.properties[d]),typeof a=="boolean"&&(a=Number(a))}return a}}function hC(s,e,n,a,d){return dr(s,(c,p)=>{const w=e instanceof Do?e.get(p):null;return w&&w.evaluate?w.evaluate(n,a,d):w})}function Ez(s,e){return e-s}qe(uC,"FeatureIndex",{omit:["rawTileData","sourceLayerCoder"]});const dC=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class Xb{static from(e){if(!(e instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[n,a]=new Uint8Array(e,0,2);if(n!==219)throw new Error("Data does not appear to be in a KDBush format.");const d=a>>4;if(d!==1)throw new Error(`Got v${d} data when expected v1.`);const c=dC[15&a];if(!c)throw new Error("Unrecognized array type.");const[p]=new Uint16Array(e,2,1),[w]=new Uint32Array(e,4,1);return new Xb(w,p,c,e)}constructor(e,n=64,a=Float64Array,d){if(isNaN(e)||e<0)throw new Error(`Unpexpected numItems value: ${e}.`);this.numItems=+e,this.nodeSize=Math.min(Math.max(+n,2),65535),this.ArrayType=a,this.IndexArrayType=e<65536?Uint16Array:Uint32Array;const c=dC.indexOf(this.ArrayType),p=2*e*this.ArrayType.BYTES_PER_ELEMENT,w=e*this.IndexArrayType.BYTES_PER_ELEMENT,T=(8-w%8)%8;if(c<0)throw new Error(`Unexpected typed array class: ${a}.`);d&&d instanceof ArrayBuffer?(this.data=d,this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+w+T,2*e),this._pos=2*e,this._finished=!0):(this.data=new ArrayBuffer(8+p+w+T),this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+w+T,2*e),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+c]),new Uint16Array(this.data,2,1)[0]=n,new Uint32Array(this.data,4,1)[0]=e)}add(e,n){const a=this._pos>>1;return this.ids[a]=a,this.coords[this._pos++]=e,this.coords[this._pos++]=n,a}finish(){const e=this._pos>>1;if(e!==this.numItems)throw new Error(`Added ${e} items when expected ${this.numItems}.`);return Yb(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(e,n,a,d){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:c,coords:p,nodeSize:w}=this,T=[0,c.length-1,0],P=[];for(;T.length;){const x=T.pop()||0,C=T.pop()||0,A=T.pop()||0;if(C-A<=w){for(let N=A;N<=C;N++){const j=p[2*N],q=p[2*N+1];j>=e&&j<=a&&q>=n&&q<=d&&P.push(c[N])}continue}const E=A+C>>1,M=p[2*E],k=p[2*E+1];M>=e&&M<=a&&k>=n&&k<=d&&P.push(c[E]),(x===0?e<=M:n<=k)&&(T.push(A),T.push(E-1),T.push(1-x)),(x===0?a>=M:d>=k)&&(T.push(E+1),T.push(C),T.push(1-x))}return P}within(e,n,a){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:d,coords:c,nodeSize:p}=this,w=[0,d.length-1,0],T=[],P=a*a;for(;w.length;){const x=w.pop()||0,C=w.pop()||0,A=w.pop()||0;if(C-A<=p){for(let N=A;N<=C;N++)pC(c[2*N],c[2*N+1],e,n)<=P&&T.push(d[N]);continue}const E=A+C>>1,M=c[2*E],k=c[2*E+1];pC(M,k,e,n)<=P&&T.push(d[E]),(x===0?e-a<=M:n-a<=k)&&(w.push(A),w.push(E-1),w.push(1-x)),(x===0?e+a>=M:n+a>=k)&&(w.push(E+1),w.push(C),w.push(1-x))}return T}}function Yb(s,e,n,a,d,c){if(d-a<=n)return;const p=a+d>>1;fC(s,e,p,a,d,c),Yb(s,e,n,a,p-1,1-c),Yb(s,e,n,p+1,d,1-c)}function fC(s,e,n,a,d,c){for(;d>a;){if(d-a>600){const P=d-a+1,x=n-a+1,C=Math.log(P),A=.5*Math.exp(2*C/3),E=.5*Math.sqrt(C*A*(P-A)/P)*(x-P/2<0?-1:1);fC(s,e,n,Math.max(a,Math.floor(n-x*A/P+E)),Math.min(d,Math.floor(n+(P-x)*A/P+E)),c)}const p=e[2*n+c];let w=a,T=d;for(l_(s,e,a,n),e[2*d+c]>p&&l_(s,e,a,d);w<T;){for(l_(s,e,w,T),w++,T--;e[2*w+c]<p;)w++;for(;e[2*T+c]>p;)T--}e[2*a+c]===p?l_(s,e,a,T):(T++,l_(s,e,T,d)),T<=n&&(a=T+1),n<=T&&(d=T-1)}}function l_(s,e,n,a){Kb(s,n,a),Kb(e,2*n,2*a),Kb(e,2*n+1,2*a+1)}function Kb(s,e,n){const a=s[e];s[e]=s[n],s[n]=a}function pC(s,e,n,a){const d=s-n,c=e-a;return d*d+c*c}r.$=ah,r.A=Oo,r.B=2,r.C=AE,r.D=Dm,r.E=go,r.F=pb,r.G=class extends Xy{},r.H=ll,r.I=jb,r.J=ia,r.K=Aa,r.L=Ea,r.M=ha,r.N=to,r.O=Xh,r.P=Ht,r.Q=vl,r.R=lo,r.S=Lu,r.T=Cb,r.U=Ta,r.V=Xy,r.W=Sa,r.X=Ll,r.Y=nc,r.Z=Ko,r._=Da,r.a=function(s){return Se.API_CDN_URL_REGEX.test(s)},r.a$=Vm,r.a0=ys,r.a1=eo,r.a2=function(s){const e=s.value;let n=[];if(!e)return n;const a=ll(e);return a!=="string"?(n=n.concat([new Xy(s.key,e,`string expected, "${a}" found`)]),n):(fT(e,!0)||(n=n.concat([new Xy(s.key,e,`invalid url "${e}"`)])),n)},r.a3=yt,r.a4=vs,r.a5=$i,r.a6=Zt,r.a7=class{constructor(s){this.specification=s}possiblyEvaluate(s,e){return io(s.expression.evaluate(e))}interpolate(s,e,n){return{x:kn(s.x,e.x,n),y:kn(s.y,e.y,n),z:kn(s.z,e.z,n),azimuthal:kn(s.azimuthal,e.azimuthal,n),polar:kn(s.polar,e.polar,n)}}},r.a8=qr,r.a9=_l,r.aA=ql,r.aB=class{constructor(s){this.entries={},this.scheduler=s}request(s,e,n,a){const d=this.entries[s]=this.entries[s]||{callbacks:[]};if(d.result){const[c,p]=d.result;return this.scheduler?this.scheduler.add(()=>{a(c,p)},e):a(c,p),()=>{}}return d.callbacks.push(a),d.cancel||(d.cancel=n((c,p)=>{d.result=[c,p];for(const w of d.callbacks)this.scheduler?this.scheduler.add(()=>{w(c,p)},e):w(c,p);setTimeout(()=>delete this.entries[s],3e3)})),()=>{d.result||(d.callbacks=d.callbacks.filter(c=>c!==a),d.callbacks.length||(d.cancel(),delete this.entries[s]))}}},r.aC=Wo,r.aD=function(s,e,n){const a=JSON.stringify(s.request);return s.data&&(this.deduped.entries[a]={result:[null,s.data]}),this.deduped.request(a,{type:"parseTile",isSymbolTile:s.isSymbolTile,zoom:s.tileZoom},d=>{const c=Yo(s.request,(p,w,T,P)=>{p?d(p):w&&d(null,{vectorTile:n?void 0:new Am.VectorTile(new Iy(w)),rawData:w,cacheControl:T,expires:P})});return()=>{c.cancel(),d()}},e)},r.aE=function(s){zr++,zr>In&&(s.getActor().send("enforceCacheSizeLimit",Rn),zr=0)},r.aF=function(s){return s<=1?1:Math.pow(2,Math.floor(Math.log(s)/Math.LN2))},r.aG=ln,r.aH=eT,r.aI=sT,r.aJ=QE,r.aK=function(s,e){const n=document.createElement("video");n.muted=!0,n.onloadstart=function(){e(null,n)};for(let a=0;a<s.length;a++){const d=document.createElement("source");tl(s[a])||(n.crossOrigin="Anonymous"),d.src=s[a],n.appendChild(d)}return{cancel:()=>{}}},r.aL=Hy,r.aM=function(s){return fetch(s).then(e=>e.arrayBuffer()).then(e=>sC(e,0,s))},r.aN=lC,r.aO=class{constructor(s,e,n,a){this.id=s,this.position=e!=null?new Qr(e[0],e[1]):new Qr(0,0),this.orientation=n??[0,0,0],this.nodes=a,this.uploaded=!1,this.aabb=new Bn([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),this.matrix=[]}_applyTransformations(s,e){if(Re.mat4.multiply(s.matrix,e,s.matrix),s.meshes)for(const n of s.meshes){const a=Bn.applyTransformFast(n.aabb,s.matrix);this.aabb.encapsulate(a)}if(s.children)for(const n of s.children)this._applyTransformations(n,s.matrix)}computeBoundsAndApplyParent(){const s=Re.mat4.identity([]);for(const e of this.nodes)this._applyTransformations(e,s)}computeModelMatrix(s,e,n,a,d,c,p=!1){yT(this.matrix,this,s.transform,this.position,e,n,a,d,c,p)}upload(s){if(!this.uploaded){for(const e of this.nodes)Rb(e,s);for(const e of this.nodes)Yy(e);this.uploaded=!0}}destroy(){for(const s of this.nodes)kb(s)}},r.aP=Ci,r.aQ=Gg,r.aR=qa,r.aS=jn,r.aT=Fo,r.aU=Ns,r.aV=oi,r.aW=Pp,r.aX=Vy,r.aY=function(){Yi.isLoading()||Yi.isLoaded()||Ps()!=="deferred"||Ma()},r.aZ=lh,r.a_=G,r.aa=g,r.ab=Re,r.ac=Ir,r.ad=Do,r.ae=na,r.af=kn,r.ag=pn,r.ah=Po,r.ai=$n,r.aj=ir,r.ak=class{constructor(s){this.specification=s}possiblyEvaluate(s,e){return function([n,a]){const d=io([1,n,a]);return{x:d.x,y:d.y,z:d.z}}(s.expression.evaluate(e))}interpolate(s,e,n){return{x:kn(s.x,e.x,n),y:kn(s.y,e.y,n),z:kn(s.z,e.z,n)}}},r.al=function(s,e,n=0,a=!0){const d=new Ht(n,n),c=s.sub(d),p=e.add(d),w=[c,new Ht(p.x,c.y),p,new Ht(c.x,p.y)];return a&&w.push(c.clone()),w},r.am=function(s,e){const n=[];for(let a=0;a<s.length;a++){const d=ui(a-1,-1,s.length-1),c=ui(a+1,-1,s.length-1),p=s[a],w=s[c],T=s[d].sub(p).unit(),P=w.sub(p).unit(),x=P.angleWithSep(T.x,T.y),C=T.add(P).unit().mult(-1*e/Math.sin(x/2));n.push(p.add(C))}return n},r.an=NE,r.ao=ft,r.ap=function(s,e,n=0){return Re.vec3.fromValues(((e.x-n)*s.scale-s.x)*pn,(e.y*s.scale-s.y)*pn,Nu(e.z,e.y))},r.aq=pr,r.ar=iE,r.as=function(s){let e=1/0,n=1/0,a=-1/0,d=-1/0;for(const c of s)e=Math.min(e,c.x),n=Math.min(n,c.y),a=Math.max(a,c.x),d=Math.max(d,c.y);return{min:new Ht(e,n),max:new Ht(a,d)}},r.at=Bu,r.au=Ze,r.av=S,r.aw=yn,r.ax=Hs,r.ay=function(s,e){const n={};for(let a=0;a<e.length;a++){const d=e[a];d in s&&(n[d]=s[d])}return n},r.az=uu,r.b=function(s){return Se.API_FONTS_REGEX.test(s)},r.b$=qy,r.b0=ls,r.b1=ob,r.b2=xs,r.b3=U,r.b4=Ia,r.b5=rd,r.b6=Dr,r.b7=vo,r.b8=Hf,r.b9=Sb,r.bA=D2,r.bB=_b,r.bC=OE,r.bD=fb,r.bE=Xb,r.bF=ui,r.bG=Ts,r.bH=Ki,r.bI=function(s,e,n){s[4*e+0]=n[0],s[4*e+1]=n[1],s[4*e+2]=n[2],s[4*e+3]=n[3]},r.bJ=ad,r.bK=Wl,r.bL=jf,r.bM=xo,r.bN=Hl,r.bO=Qr,r.bP=HE,r.bQ=gn,r.bR=Er,r.bS=lT,r.bT=_n,r.bU=ki,r.bV=function(s,e,n,a,d,c,p,w,T){if(T.name==="globe")return ki(s,e,new _n(n,a,d),!1);const P=Gg({z:n,x:a,y:d},T);return new Bn([(c+P.x/P.scale)*e,e*(P.y/P.scale),p],[(c+P.x2/P.scale)*e,e*(P.y2/P.scale),w])},r.bW=function(s,e,n){let a=0;for(let d=0;d<2;++d)s[d]>0&&(a+=(s[d]-0)*(s[d]-0)),e[d]<0&&(a+=(0-e[d])*(0-e[d]));return a},r.bX=da,r.bY=ud,r.bZ=function(s){const e=Re.mat4.identity(new Float64Array(16));Re.mat4.multiply(e,s.pixelMatrix,s.globeMatrix);const n=[0,Sl,0],a=[0,Ra,0];return Re.vec3.transformMat4(n,n,e),Re.vec3.transformMat4(a,a,e),[n[0]>0&&n[0]<=s.width&&n[1]>0&&n[1]<=s.height&&!zc(s,new Qr(s.center.lat,90)),a[0]>0&&a[0]<=s.width&&a[1]>0&&a[1]<=s.height&&!zc(s,new Qr(s.center.lat,-90))]},r.b_=function(s,e){const{scale:n}=s.tileTransform,a=n*pn/(s.tileSize*Math.pow(2,e.zoom-s.tileID.overscaledZ+s.tileID.canonical.z));return Re.mat2.scale(new Float32Array(4),e.inverseAdjustmentMatrix,[a,a])},r.ba=function(s,e){const n=na(e.zoom);if(n===0)return ns(s);const a=mi(s),d=Yr(a),c=Bu(a.getWest())*e.worldSize,p=Bu(a.getEast())*e.worldSize,w=ql(a.getNorth())*e.worldSize,T=ql(a.getSouth())*e.worldSize,P=[c,w,0],x=[p,w,0],C=[c,T,0],A=[p,T,0],E=Re.mat4.invert([],e.globeMatrix);return Re.vec3.transformMat4(P,P,E),Re.vec3.transformMat4(x,x,E),Re.vec3.transformMat4(C,C,E),Re.vec3.transformMat4(A,A,E),d[0]=Co(d[0],C,n),d[1]=Co(d[1],A,n),d[2]=Co(d[2],x,n),d[3]=Co(d[3],P,n),Bn.fromPoints(d)},r.bb=Gs,r.bc=ho,r.bd=Co,r.be=yo,r.bf=Yn,r.bg=Hb,r.bh=Iy,r.bi=Yo,r.bj=function(s){const e=[];for(const n in s)e.push(s[n]);return e},r.bk=function(s,e){const n=[];for(const a in s)a in e||n.push(a);return n},r.bl=_i,r.bm=["type","source","source-layer","minzoom","maxzoom","filter","layout"],r.bn=Wr,r.bo=function(s,e){const{x:n,y:a}=s.point,d=pa(n,a,s.worldSize/s._pixelsPerMercatorPixel,0,0);return Re.mat4.multiply(d,d,El(ns(e)))},r.bp=Im,r.bq=hu,r.br=Ay,r.bs=function(s,e,n,a,d){const c=5*e+2;s.float32[c+0]=n,s.float32[c+1]=a,s.float32[c+2]=d},r.bt=$y,r.bu=ME,r.bv=ce,r.bw=za,r.bx=P2,r.by=dT,r.bz=O2,r.c=$e,r.c$=(s,e,n,a,d,c,p,w)=>{const T=s.transform,P=T.pitch<15?oE(.07,.7,yn((14-T.zoom)/5,0,1)):.07,x=n.paint.get("line-trim-color-use-theme").constantOr("default")==="none";return{u_matrix:aE(s,e,n,a),u_texsize:e.imageAtlasTexture?e.imageAtlasTexture.size:[0,0],u_pixels_to_tile_units:T.calculatePixelsToTileUnitsMatrix(e),u_device_pixel_ratio:d,u_width_scale:c,u_floor_width_scale:p,u_image:0,u_tile_units_to_pixels:sE(e,T),u_units_to_pixels:[1/T.pixelsToGLUnits[0],1/T.pixelsToGLUnits[1]],u_alpha_discard_threshold:0,u_trim_offset:w,u_trim_fade_range:n.paint.get("line-trim-fade-range"),u_trim_color:n.paint.get("line-trim-color").toRenderColor(x?null:n.lut).toArray01(),u_emissive_strength:n.paint.get("line-emissive-strength"),u_zbias_factor:P,u_tile_to_meter:h(e.tileID.canonical,0)}},r.c0=aT,r.c1=function(s){const e=aT(s,!0);return Re.mat2.invert([],[e[0],e[1],e[4],e[5]])},r.c2=Oi,r.c3=function(s){const{x:e,y:n}=s.point,{lng:a,lat:d}=s._center;return pa(e,n,s.worldSize,a,d)},r.c4=Gr,r.c5=xn,r.c6=tf,r.c7=function(s){const e=Math.round((s+45+360)%360/90)%4;return gi[e]},r.c8=45,r.c9=of,r.cA=class extends wl{constructor(s){super(s),this.current=gm}set(s,e,n){if(this.fetchUniformLocation(s,e)){for(let a=0;a<9;a++)if(n[a]!==this.current[a]){this.current=n,this.gl.uniformMatrix3fv(this.location,!1,n);break}}}},r.cB=Pr,r.cC=function(s,e,n){const a=na(n.zoom),d=s.style.map._antialias,c=e.options.extStandardDerivativesForceOff||s.terrain&&s.terrain.exaggeration()>0;return a===0&&!d&&!c},r.cD=function(s){const e=s.pixelsPerMeter,n=e/Ki(1,s.center.lat),a=Re.mat4.identity(new Float64Array(16));return Re.mat4.translate(a,a,[s.point.x,s.point.y,0]),Re.mat4.scale(a,a,[n,n,e]),Float32Array.from(a)},r.cE=mi,r.cF=function(s){const e=da-5;s=yn(s,-80.051129,e)/e*90;const n=Math.pow(Math.abs(Math.sin($n(s))),3);return Math.round(n*(nf.length-1))},r.cG=function(s,e,n,a){const d=e.getNorth(),c=e.getSouth(),p=e.getWest(),w=e.getEast(),T=1<<s.z,P=w-p,x=d-c,C=P/Fu,A=-x/nf[n],E=[0,C,0,A,0,0,d,p,0];if(s.z>0){const M=180/a;Re.mat3.multiply(E,E,[M/P+1,0,0,0,M/x+1,0,-.5*M/C,.5*M/A,1])}return E[2]=T,E[5]=s.x,E[8]=s.y,E},r.cH=ns,r.cI=function(s,e,n){const a=Re.mat4.identity(new Float64Array(16)),d=(e/(1<<s)-.5)*Math.PI*2;return Re.mat4.rotateY(a,n.globeMatrix,d),Float32Array.from(a)},r.cJ=class{isDataAvailableAtPoint(s){const e=this._source();if(this.isUsingMockSource()||!e||s.y<0||s.y>1)return!1;const n=e.getSource().maxzoom,a=1<<n,d=Math.floor(s.x),c=Math.floor((s.x-d)*a),p=Math.floor(s.y*a),w=this.findDEMTileFor(new ln(n,d,n,c,p));return!(!w||!w.dem)}getAtPointOrZero(s,e=0){return this.getAtPoint(s,e)||0}getAtPoint(s,e,n=!0){if(this.isUsingMockSource())return null;e==null&&(e=null);const a=this._source();if(!a||s.y<0||s.y>1)return e;const d=a.getSource().maxzoom,c=1<<d,p=Math.floor(s.x),w=s.x-p,T=new ln(d,p,d,Math.floor(w*c),Math.floor(s.y*c)),P=this.findDEMTileFor(T);if(!P||!P.dem)return e;const x=P.dem,C=1<<P.tileID.canonical.z,A=(w*C-P.tileID.canonical.x)*x.dim,E=(s.y*C-P.tileID.canonical.y)*x.dim,M=Math.floor(A),k=Math.floor(E);return(n?this.exaggeration():1)*kn(kn(x.get(M,k),x.get(M,k+1),E-k),kn(x.get(M+1,k),x.get(M+1,k+1),E-k),A-M)}getAtTileOffset(s,e,n){const a=1<<s.canonical.z;return this.getAtPointOrZero(new g(s.wrap+(s.canonical.x+e/pn)/a,(s.canonical.y+n/pn)/a))}getAtTileOffsetFunc(s,e,n,a){return d=>{const c=this.getAtTileOffset(s,d.x,d.y),p=a.upVector(s.canonical,d.x,d.y),w=a.upVectorScale(s.canonical,e,n).metersToTile;return Re.vec3.scale(p,p,c*w),p}}getForTilePoints(s,e,n,a){if(this.isUsingMockSource())return!1;const d=Om.create(this,s,a);return!!d&&(e.forEach(c=>{c[2]=this.exaggeration()*d.getElevationAt(c[0],c[1],n)}),!0)}getMinMaxForTile(s){if(this.isUsingMockSource())return null;const e=this.findDEMTileFor(s);if(!e||!e.dem)return null;const n=e.dem.tree,a=e.tileID,d=1<<s.canonical.z-a.canonical.z;let c=s.canonical.x/d-a.canonical.x,p=s.canonical.y/d-a.canonical.y,w=0;for(let T=0;T<s.canonical.z-a.canonical.z&&!n.leaves[w];T++){c*=2,p*=2;const P=2*Math.floor(p)+Math.floor(c);w=n.childOffsets[w]+P,c%=1,p%=1}return{min:this.exaggeration()*n.minimums[w],max:this.exaggeration()*n.maximums[w]}}getMinElevationBelowMSL(){throw new Error("Pure virtual method called.")}raycast(s,e,n){throw new Error("Pure virtual method called.")}pointCoordinate(s){throw new Error("Pure virtual method called.")}_source(){throw new Error("Pure virtual method called.")}isUsingMockSource(){throw new Error("Pure virtual method called.")}exaggeration(){throw new Error("Pure virtual method called.")}findDEMTileFor(s){throw new Error("Pure virtual method called.")}get visibleDemTiles(){throw new Error("Getter must be implemented in subclass.")}getMinMaxForVisibleTiles(){const s=this.visibleDemTiles;if(s.length===0)return null;let e=!1,n=Number.MAX_VALUE,a=Number.MIN_VALUE;for(const d of s){const c=this.getMinMaxForTile(d.tileID);c&&(n=Math.min(n,c.min),a=Math.max(a,c.max),e=!0)}return e?{min:n,max:a}:null}},r.cK=Og,r.cL=ii,r.cM=function(s,e){return[Math.pow(s[0],2.2)*e,Math.pow(s[1],2.2)*e,Math.pow(s[2],2.2)*e]},r.cN=kc,r.cO=de,r.cP=oe,r.cQ=256,r.cR=function(s,e){const n=[0,0,0],a=Gs(ns(e.canonical));return Re.vec3.transformMat4(n,n,a),Re.vec3.transformMat4(n,n,s),n},r.cS=s=>({u_camera_to_center_distance:new xo(s),u_extrude_scale:new ea(s),u_device_pixel_ratio:new xo(s),u_matrix:new ad(s),u_inv_rot_matrix:new ad(s),u_merc_center:new Wl(s),u_tile_id:new jf(s),u_zoom_transition:new xo(s),u_up_dir:new jf(s),u_emissive_strength:new xo(s)}),r.cT=s=>({u_matrix:new ad(s),u_pixels_to_tile_units:new ea(s),u_device_pixel_ratio:new xo(s),u_width_scale:new xo(s),u_floor_width_scale:new xo(s),u_units_to_pixels:new Wl(s),u_dash_image:new Hl(s),u_gradient_image:new Hl(s),u_image_height:new xo(s),u_texsize:new Wl(s),u_tile_units_to_pixels:new xo(s),u_alpha_discard_threshold:new xo(s),u_trim_offset:new Wl(s),u_trim_fade_range:new Wl(s),u_trim_color:new Qd(s),u_emissive_strength:new xo(s),u_zbias_factor:new xo(s),u_tile_to_meter:new xo(s)}),r.cU=s=>({u_matrix:new ad(s),u_texsize:new Wl(s),u_pixels_to_tile_units:new ea(s),u_device_pixel_ratio:new xo(s),u_width_scale:new xo(s),u_floor_width_scale:new xo(s),u_image:new Hl(s),u_units_to_pixels:new Wl(s),u_tile_units_to_pixels:new xo(s),u_alpha_discard_threshold:new xo(s),u_trim_offset:new Wl(s),u_trim_fade_range:new Wl(s),u_trim_color:new Qd(s),u_emissive_strength:new xo(s),u_zbias_factor:new xo(s),u_tile_to_meter:new xo(s)}),r.cV=Ud,r.cW=M3,r.cX=A3,r.cY=Vf,r.cZ=(s,e,n,a,d,c)=>{const p=s.transform,w=p.projection.name==="globe";let T;if(c.paint.get("circle-pitch-alignment")==="map")if(w){const x=kc(p.zoom,e.canonical)*p._pixelsPerMercatorPixel;T=Float32Array.from([x,0,0,x])}else T=p.calculatePixelsToTileUnitsMatrix(n);else T=new Float32Array([p.pixelsToGLUnits[0],0,0,p.pixelsToGLUnits[1]]);const P={u_camera_to_center_distance:s.transform.getCameraToCenterDistance(p.projection),u_matrix:s.translatePosMatrix(e.projMatrix,n,c.paint.get("circle-translate"),c.paint.get("circle-translate-anchor")),u_device_pixel_ratio:fn.devicePixelRatio,u_extrude_scale:T,u_inv_rot_matrix:Dp,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0],u_emissive_strength:c.paint.get("circle-emissive-strength")};if(w){P.u_inv_rot_matrix=a,P.u_merc_center=d,P.u_tile_id=[e.canonical.x,e.canonical.y,1<<e.canonical.z],P.u_zoom_transition=na(p.zoom);const x=d[0]*pn,C=d[1]*pn;P.u_up_dir=p.projection.upVector(new _n(0,0,0),x,C)}return P},r.c_=lE,r.ca=Qd,r.cb=function(s,e,n){const a=Math.sqrt(s*s+e*e+n*n),d=a>0?Math.acos(n/a)*pi:0;let c=s!==0||e!==0?Math.atan2(-e,-s)*pi+90:0;return c<0&&(c+=360),[a,c,d]},r.cc=h,r.cd=Bn,r.ce=io,r.cf=function(s){return[Math.pow(s[0],1/2.2),Math.pow(s[1],1/2.2),Math.pow(s[2],1/2.2)]},r.cg=function(s,e){return s.readFields(xk,{icons:[]},e)},r.ch=function(s){return s({pluginStatus:jr,pluginURL:ri}),no.on("pluginStateChange",s),s},r.ci=Jy,r.cj=Rm,r.ck=mb,r.cl=zo,r.cm=Fi,r.cn=En,r.co=xa,r.cp=Zi,r.cq=function(s){const e=s.indexOf(hc);return e>=0?s.slice(0,e):s},r.cr=function(s){return s.indexOf(hc)>=0},r.cs=function(s){const e=s.indexOf(hc);return e>=0?s.slice(e+1):""},r.ct=function(s){const e=[],n=s.id;return n===void 0&&e.push({message:`layers.${n}: missing required property "id"`}),s.render===void 0&&e.push({message:`layers.${n}: missing required method "render"`}),s.renderingMode&&s.renderingMode!=="2d"&&s.renderingMode!=="3d"&&e.push({message:`layers.${n}: property "renderingMode" must be either "2d" or "3d"`}),e},r.cu=function(s,e,n,a){return s.type==="custom"?new sk(s,e):new _k[s.type](s,e,n,a)},r.cv=wo,r.cw=class extends Vm{constructor(s,e){super(s._vectorTileFeature,s._z,s._x,s._y,s.id),s.state&&(this.state={...s.state}),this.target=e.target,this.namespace=e.namespace,e.properties&&(this.properties=e.properties),this.target&&("featuresetId"in this.target&&!this.target.importId||"layerId"in this.target)&&(this.source=s.source,this.sourceLayer=s.sourceLayer,this.layer=s.layer)}toJSON(){const s=super.toJSON();return s.target=this.target,s.namespace=this.namespace,s}},r.cx=no,r.cy=$o,r.cz=ef,r.d=function(s){return Se.API_TILEJSON_REGEX.test(s)},r.d$=dr,r.d0=(s,e,n,a,d,c,p,w,T)=>{const P=s.transform,x=P.calculatePixelsToTileUnitsMatrix(e),C=n.paint.get("line-trim-color-use-theme").constantOr("default")==="none",A=P.pitch<15?oE(.07,.7,yn((14-P.zoom)/5,0,1)):.07;return{u_matrix:aE(s,e,n,a),u_pixels_to_tile_units:x,u_device_pixel_ratio:c,u_width_scale:p,u_floor_width_scale:w,u_units_to_pixels:[1/P.pixelsToGLUnits[0],1/P.pixelsToGLUnits[1]],u_dash_image:0,u_gradient_image:1,u_image_height:d,u_texsize:cE(n)&&e.lineAtlasTexture?e.lineAtlasTexture.size:[0,0],u_tile_units_to_pixels:sE(e,s.transform),u_alpha_discard_threshold:0,u_trim_offset:T,u_trim_fade_range:n.paint.get("line-trim-fade-range"),u_trim_color:n.paint.get("line-trim-color").toRenderColor(C?null:n.lut).toArray01(),u_emissive_strength:n.paint.get("line-emissive-strength"),u_zbias_factor:A,u_tile_to_meter:h(e.tileID.canonical,0)}},r.d1=qi,r.d2=Uf,r.d3=X2,r.d4=tr,r.d5=Cy,r.d6=Wf,r.d7=450,r.d8=7,r.d9=ok,r.dA=Un,r.dB=o,r.dC=_h,r.dD=function([s,e,n]){const a=Math.hypot(s,e,n),d=Math.atan2(s,n),c=.5*Math.PI-Math.acos(-e/a);return new Qr(Gr(d),Gr(c))},r.dE=Ab,r.dF=function(s){const e=s.navigator?s.navigator.userAgent:null;return!!function(n){if(Ao==null){const a=n.navigator?n.navigator.userAgent:null;Ao=!!n.safari||!(!a||!(/\b(iPad|iPhone|iPod)\b/.test(a)||a.match("Safari")&&!a.match("Chrome")))}return Ao}(s)&&e&&(e.match("Version/15.4")||e.match("Version/15.5")||e.match(/CPU (OS|iPhone OS) (15_4|15_5) like Mac OS X/))},r.dG=function(s,e){Rn=s,In=e},r.dH=zc,r.dI=qs,r.dJ=function(s){const e=[0,0,0],n=Re.mat4.identity(new Float64Array(16));return Re.mat4.multiply(n,s.pixelMatrix,s.globeMatrix),Re.vec3.transformMat4(e,e,n),new Ht(e[0],e[1])},r.dK=function(s,e,n=!1){if(jr===bi||jr===di||jr===Ii)throw new Error("setRTLTextPlugin cannot be called multiple times.");ri=fn.resolveURL(s),jr=bi,Jr=e,Pi(),n||Ma()},r.dL=Ps,r.dM=function(){Jy().acquire(Lb)},r.dN=function(){const s=e_;s&&(s.isPreloaded()&&s.numActive()===1?(s.release(Lb),e_=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},r.dO=Up,r.dP=function(s){const e=Br();if(!e)return;const n=e.delete(zn);s&&n.catch(s).then(()=>s())},r.dQ=Qg,r.dR=QT,r.dS=function(s){Wb=fn.resolveURL(s),$m||($m=new Dm(Jy(),new go)),$m.broadcast("setDracoUrl",Wb)},r.dT=eC,r.dU=function(s){jm=fn.resolveURL(s),$m||($m=new Dm(Jy(),new go)),$m.broadcast("setMeshoptUrl",jm)},r.dV=qe,r.dW=ju,r.dX=Sh,r.dY=cC,r.dZ=uC,r.d_=tE,r.da=$r,r.db=qd,r.dc=256,r.dd=El,r.de=Vl,r.df=su,r.dg=Df,r.dh=function(s,e,n,a,d){return yn((s-e)/(n-e)*(d-a)+a,a,d)},r.di=Dl,r.dj=t,r.dk=class{constructor(s,e,n,a){this.context=s,this.format=a,this.size=n,this.texture=s.gl.createTexture();const[d,c,p]=this.size,{gl:w}=s;w.bindTexture(w.TEXTURE_3D,this.texture),s.pixelStoreUnpackFlipY.set(!1),s.pixelStoreUnpack.set(1),s.pixelStoreUnpackPremultiplyAlpha.set(!1),w.texImage3D(w.TEXTURE_3D,0,this.format,d,c,p,0,Eb(this.format),Tb(this.format),e.data)}bind(s,e){const{context:n}=this,{gl:a}=n;a.bindTexture(a.TEXTURE_3D,this.texture),s!==this.minFilter&&(a.texParameteri(a.TEXTURE_3D,a.TEXTURE_MAG_FILTER,s),a.texParameteri(a.TEXTURE_3D,a.TEXTURE_MIN_FILTER,s),this.minFilter=s),e!==this.wrapS&&(a.texParameteri(a.TEXTURE_3D,a.TEXTURE_WRAP_S,e),a.texParameteri(a.TEXTURE_3D,a.TEXTURE_WRAP_T,e),this.wrapS=e)}destroy(){const{gl:s}=this.context;s.deleteTexture(this.texture),this.texture=null}},r.dl=Ib,r.dm=[1,1,1],r.dn=Om,r.dp=Lm,r.dq=Bs,r.dr=Pc,r.ds=yh,r.dt=dh,r.du=Ff,r.dv=class{constructor(){this._updateTime=0,this._sourceIds=[],this._activeRegions=[],this._prevRegions=[],this._globalClipBounds={min:new Ht(1/0,1/0),max:new Ht(-1/0,-1/0)}}clear(){this._activeRegions.length>0&&++this._updateTime,this._activeRegions=[],this._prevRegions=[]}get updateTime(){return this._updateTime}getReplacementRegionsForTile(s,e=!1){const n=k2(new Ht(0,0),new Ht(pn,pn),s),a=[];if(e&&!eb(n,this._globalClipBounds))return a;for(const d of this._activeRegions){if(d.hiddenByOverlap||!eb(n,d))continue;const c=e3(d.min,d.max,s);a.push({min:c.min,max:c.max,sourceId:this._sourceIds[d.priority],footprint:d.footprint,footprintTileId:d.tileId,order:d.order,clipMask:d.clipMask,clipScope:d.clipScope})}return a}setSources(s){this._setSources(s.map(e=>({getSourceId:()=>e.cache.id,getFootprints:()=>{const n=[];for(const a of e.cache.getVisibleCoordinates()){const d=e.cache.getTile(a).buckets[e.layer];d&&d.updateFootprints(a.toUnwrapped(),n)}return n},getOrder:()=>e.order,getClipMask:()=>e.clipMask,getClipScope:()=>e.clipScope})))}_addSource(s){const e=s.getFootprints();if(e.length===0)return;const n=s.getOrder(),a=s.getClipMask(),d=s.getClipScope();for(const c of e){if(!c.footprint)continue;const p=k2(c.footprint.min,c.footprint.max,c.id);this._activeRegions.push({min:p.min,max:p.max,hiddenByOverlap:!1,priority:this._sourceIds.length,tileId:c.id,footprint:c.footprint,order:n,clipMask:a,clipScope:d})}this._sourceIds.push(s.getSourceId())}_computeReplacement(){this._activeRegions.sort((e,n)=>e.priority-n.priority||Ey(e.min,n.min)||Ey(e.max,n.max)||e.order-n.order||e.clipMask-n.clipMask||function(a,d){const c=(p,w)=>p+w;return a.length-d.length||a.reduce(c,"").localeCompare(d.reduce(c,""))}(e.clipScope,n.clipScope));let s=this._activeRegions.length!==this._prevRegions.length;if(!s){let e=0;for(;!s&&e!==this._activeRegions.length;){const n=this._activeRegions[e],a=this._prevRegions[e];s=n.priority!==a.priority||!R2(n,a)||n.order!==a.order||n.clipMask!==a.clipMask||!Wr(n.clipScope,a.clipScope),++e}}if(s){++this._updateTime;for(const n of this._activeRegions)n.order!==Sy&&(this._globalClipBounds.min.x=Math.min(this._globalClipBounds.min.x,n.min.x),this._globalClipBounds.min.y=Math.min(this._globalClipBounds.min.y,n.min.y),this._globalClipBounds.max.x=Math.max(this._globalClipBounds.max.x,n.max.x),this._globalClipBounds.max.y=Math.max(this._globalClipBounds.max.y,n.max.y));const e=n=>{const a=this._activeRegions;if(n>=a.length)return n;const d=a[n].priority;for(;n<a.length&&a[n].priority===d;)++n;return n};if(this._sourceIds.length>1){let n=0,a=e(n);for(;n!==a;){let d=n;const c=n;for(;d!==a;){const p=this._activeRegions[d];p.hiddenByOverlap=!1;for(let w=0;w<c;w++){const T=this._activeRegions[w];if(!T.hiddenByOverlap&&p.order===Sy&&eb(p,T)&&(p.hiddenByOverlap=L2(p.footprint,p.tileId,T.footprint,T.tileId),p.hiddenByOverlap))break}++d}n=a,a=e(n)}}}}_setSources(s){[this._prevRegions,this._activeRegions]=[this._activeRegions,[]],this._sourceIds=[];for(let e=s.length-1;e>=0;e--)this._addSource(s[e]);this._computeReplacement()}},r.dw=class{constructor(s){this._createGrid(s),this._createPoles(s)}destroy(){this._poleIndexBuffer.destroy(),this._gridBuffer.destroy(),this._gridIndexBuffer.destroy(),this._poleNorthVertexBuffer.destroy(),this._poleSouthVertexBuffer.destroy();for(const s of this._poleSegments)s.destroy();for(const s of this._gridSegments)s.withSkirts.destroy(),s.withoutSkirts.destroy()}_fillGridMeshWithLods(s,e){const n=new Ia,a=new Ns,d=[],c=s+1+2,p=e[0]+1,w=e[0]+1+(1+e.length),T=(P,x,C)=>{let A=P===c-1?P-2:P===0?P:P-1;return A+=C?24575:0,[A,x]};for(let P=0;P<c;++P)n.emplaceBack(...T(P,0,!0));for(let P=0;P<p;++P)for(let x=0;x<c;++x)n.emplaceBack(...T(x,P,(x===0||x===c-1)&&!0));for(let P=0;P<e.length;++P){const x=e[P];for(let C=0;C<c;++C)n.emplaceBack(...T(C,x,!0))}for(let P=0;P<e.length;++P){const x=a.length,C=e[P]+1+2,A=new Ns;for(let k=0;k<C-1;k++){const N=k===C-2,j=N?c*(w-e.length+P-k):c;for(let q=0;q<c-1;q++){const X=k*c+q;k===0||N||q===0||q===c-2?(A.emplaceBack(X+1,X,X+j),A.emplaceBack(X+j,X+j+1,X+1)):(a.emplaceBack(X+1,X,X+j),a.emplaceBack(X+j,X+j+1,X+1))}}const E=vo.simpleSegment(0,x,n.length,a.length-x);for(let k=0;k<A.uint16.length;k+=3)a.emplaceBack(A.uint16[k],A.uint16[k+1],A.uint16[k+2]);const M=vo.simpleSegment(0,x,n.length,a.length-x);d.push({withoutSkirts:E,withSkirts:M})}return{vertices:n,indices:a,segments:d}}_createGrid(s){const e=this._fillGridMeshWithLods(Fu,nf);this._gridSegments=e.segments,this._gridBuffer=s.createVertexBuffer(e.vertices,Dr.members),this._gridIndexBuffer=s.createIndexBuffer(e.indices,!0)}_createPoles(s){const e=new Ns;for(let p=0;p<=Fu;p++)e.emplaceBack(0,p+1,p+2);this._poleIndexBuffer=s.createIndexBuffer(e,!0);const n=new su,a=new su,d=new su,c=new su;this._poleSegments=[];for(let p=0,w=0;p<tf;p++){const T=360/(1<<p);n.emplaceBack(0,-Hs,0,.5,0),a.emplaceBack(0,-Hs,0,.5,1),d.emplaceBack(0,-Hs,0,.5,.5),c.emplaceBack(0,-Hs,0,.5,.5);for(let P=0;P<=Fu;P++){let x=P/Fu,C=0;const A=kn(0,T,x),[E,M,k]=ka(vh,dd,A,Hs);n.emplaceBack(E,M,k,x,C),a.emplaceBack(E,M,k,x,1-C);const N=$n(A);x=.5+.5*Math.sin(N),C=.5+.5*Math.cos(N),d.emplaceBack(E,M,k,x,C),c.emplaceBack(E,M,k,x,1-C)}this._poleSegments.push(vo.simpleSegment(w,0,66,64)),w+=66}this._poleNorthVertexBuffer=s.createVertexBuffer(n,Fn,!1),this._poleSouthVertexBuffer=s.createVertexBuffer(a,Fn,!1),this._texturedPoleNorthVertexBuffer=s.createVertexBuffer(d,Fn,!1),this._texturedPoleSouthVertexBuffer=s.createVertexBuffer(c,Fn,!1)}getGridBuffers(s,e){return[this._gridBuffer,this._gridIndexBuffer,e?this._gridSegments[s].withSkirts:this._gridSegments[s].withoutSkirts]}getPoleBuffers(s,e){return[e?this._texturedPoleNorthVertexBuffer:this._poleNorthVertexBuffer,e?this._texturedPoleSouthVertexBuffer:this._poleSouthVertexBuffer,this._poleIndexBuffer,this._poleSegments[s]]}},r.dx=Sy,r.dy=ci,r.dz=function(){return!!document.fullscreenElement||!!document.webkitFullscreenElement},r.e=Se,r.e0=sa,r.e1=IE,r.e2=function(s,e,n,a,d,c,p,w,T,P,x=1,C,A){s.createArrays(),s.tilePixelRatio=pn/(512*s.overscaling),s.compareText={},s.iconsNeedLinear=!1;const E=s.layers[0].layout,M=s.layers[0]._unevaluatedLayout._values,k={};k.scaleFactor=x,k.textSizeScaleRange=E.get("text-size-scale-range"),k.iconSizeScaleRange=E.get("icon-size-scale-range");const[N,j]=k.textSizeScaleRange,[q,X]=k.iconSizeScaleRange;if(k.textScaleFactor=yn(k.scaleFactor,N,j),k.iconScaleFactor=yn(k.scaleFactor,q,X),s.textSizeData.kind==="composite"){const{minZoom:he,maxZoom:we}=s.textSizeData;k.compositeTextSizes=[M["text-size"].possiblyEvaluate(new qr(he),w),M["text-size"].possiblyEvaluate(new qr(we),w)]}if(s.iconSizeData.kind==="composite"){const{minZoom:he,maxZoom:we}=s.iconSizeData;k.compositeIconSizes=[M["icon-size"].possiblyEvaluate(new qr(he),w),M["icon-size"].possiblyEvaluate(new qr(we),w)]}k.layoutTextSize=M["text-size"].possiblyEvaluate(new qr(T+1),w),k.layoutIconSize=M["icon-size"].possiblyEvaluate(new qr(T+1),w),k.textMaxSize=M["text-size"].possiblyEvaluate(new qr(18),w);const W=E.get("text-rotation-alignment")==="map"&&E.get("symbol-placement")!=="point",J=E.get("text-size");let ne=!1;for(const he of s.features)if(he.icon&&he.icon.nameSecondary){ne=!0;break}for(const he of s.features){const we=E.get("text-font").evaluate(he,{},w).join(","),be=J.evaluate(he,{},w)*k.textScaleFactor,ve=k.layoutTextSize.evaluate(he,{},w)*k.textScaleFactor,Be=(k.layoutIconSize.evaluate(he,{},w),{horizontal:{},vertical:void 0}),Me=he.text;let Ue,Ye=[0,0];if(Me){const pt=Me.toString(),ot=E.get("text-letter-spacing").evaluate(he,{},w)*za,It=E.get("text-line-height").evaluate(he,{},w)*za,tn=qn(pt)?ot:0,Lt=E.get("text-anchor").evaluate(he,{},w),un=E.get("text-variable-anchor");if(!un){const dn=E.get("text-radial-offset").evaluate(he,{},w);Ye=dn?OE(Lt,[dn*za,gb]):E.get("text-offset").evaluate(he,{},w).map(Cn=>Cn*za)}let cn=W?"center":E.get("text-justify").evaluate(he,{},w);const vn=E.get("symbol-placement")==="point",Bt=vn?E.get("text-max-width").evaluate(he,{},w)*za:1/0,Pn=dn=>{s.allowVerticalPlacement&&Qn(pt)&&(Be.vertical=db(Me,e,n,d,we,Bt,It,Lt,dn,tn,Ye,hu.vertical,!0,ve,be))};if(!W&&un){const dn=cn==="auto"?un.map(Zn=>_b(Zn)):[cn];let Cn=!1;for(let Zn=0;Zn<dn.length;Zn++){const xr=dn[Zn];if(!Be.horizontal[xr])if(Cn)Be.horizontal[xr]=Be.horizontal[0];else{const Cr=db(Me,e,n,d,we,Bt,It,"center",xr,tn,Ye,hu.horizontal,!1,ve,be);Cr&&(Be.horizontal[xr]=Cr,Cn=Cr.positionedLines.length===1)}}Pn("left")}else{if(cn==="auto"&&(cn=_b(Lt)),vn||E.get("text-writing-mode").indexOf("horizontal")>=0||!Qn(pt)){const dn=db(Me,e,n,d,we,Bt,It,Lt,cn,tn,Ye,hu.horizontal,!1,ve,be);dn&&(Be.horizontal[cn]=dn)}Pn(vn?"left":cn)}}let Xe=!1,Je=!1;if(he.icon&&he.icon.namePrimary){const pt=My(s.iconSizeData,M["icon-size"],w,s.zoom,he)*k.iconScaleFactor*C,ot=he.icon.getPrimary().scaleSelf(pt).serialize(),It=a[ot];It&&(Ue=N3(d[ot],he.icon.nameSecondary?d[he.icon.getSecondary().scaleSelf(pt).serialize()]:void 0,E.get("icon-offset").evaluate(he,{},w),E.get("icon-anchor").evaluate(he,{},w)),Xe=It.sdf,Je=It.usvg,s.sdfIcons===void 0?s.sdfIcons=It.sdf:s.sdfIcons!==It.sdf&&nr("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(It.pixelRatio!==s.pixelRatio||E.get("icon-rotate").constantOr(1)!==0)&&(s.iconsNeedLinear=!0))}const st=FE(Be.horizontal)||Be.vertical;s.iconsInText||(s.iconsInText=!!st&&st.iconsInText),(st||Ue)&&G3(s,he,Be,Ue,a,k,ve,0,Ye,Xe,Je,p,w,P,A,ne)}c&&s.generateCollisionDebugBuffers(T,s.collisionBoxArray,k.textScaleFactor)},r.e3=Am,r.e4=iv,r.e5=Ar,r.e6=C2,r.e7=mE,r.e8=H,r.e9=function(s){let e=0;if(new Uint32Array(s,0,1)[0]!==nC){const n=new Uint32Array(s,0,7),[,,a,d,c,p]=n;e=n.byteLength+d+c+p+c,(a!==s.byteLength||e>=s.byteLength)&&nr("Invalid b3dm header information.")}return sC(s,e)},r.ea=function(s,e){const n=lC(s);for(const a of n){for(const d of a.meshes)bz(d);a.lights&&(a.lightMeshIndex=a.meshes.length,a.meshes.push(wz(a.lights,e)))}return n},r.eb=Ky,r.ec=ET,r.ed=Yi,r.ee=function(s){ti(),lr!=null&&lr.then(e=>{e.keys().then(n=>{for(let a=0;a<n.length-s;a++)e.delete(n[a])})})},r.f=function(s){return s.indexOf("mapbox:")===0},r.g=function(s,e){return $o(Lr(s,{method:"GET"}),e)},r.h=He,r.i=function(s){return Se.API_STYLE_REGEX.test(s)&&!$e(s)},r.j=function(s){return decodeURIComponent(atob(s).split("").map(e=>"%"+("00"+e.charCodeAt(0).toString(16)).slice(-2)).join(""))},r.k=function(s){return btoa(encodeURIComponent(s).replace(/%([0-9A-F]{2})/g,(e,n)=>String.fromCharCode(+("0x"+n))))},r.l=Lr,r.m=po,r.n=function(s,e){return $o(Lr(s,{type:"json"}),e)},r.o=Cs,r.p=function(s,e){return $o(Lr(s,{method:"POST"}),e)},r.q=fn,r.r=ma,r.s=function(s){try{const e=self[s];return e.setItem("_mapbox_test_",1),e.removeItem("_mapbox_test_"),!0}catch{return!1}},r.t=Jt,r.u=function(){return function s(e){return e?(e^Math.random()*(16>>e/4)).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,s)}()},r.v=function(s){return!!s&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(s)},r.w=nr,r.x=function(){return Ob||(Ob=new Up),Ob},r.y=As,r.z=hi}),z(["./shared"],function(r){function H(bt){const oe=bt?bt.url.toString():void 0;return oe?performance.getEntriesByName(oe):[]}function Z(bt){if(typeof bt=="number"||typeof bt=="boolean"||typeof bt=="string"||bt==null)return JSON.stringify(bt);if(Array.isArray(bt)){let de="[";for(const Se of bt)de+=`${Z(Se)},`;return`${de}]`}let oe="{";for(const de of Object.keys(bt).sort())oe+=`${de}:${Z(bt[de])},`;return`${oe}}`}function K(bt){let oe="";for(const de of r.bm)oe+=`/${Z(bt[de])}`;return oe}class te{constructor(oe){this.keyCache={},this._layers={},this._layerConfigs={},oe&&this.replace(oe)}replace(oe,de){this._layerConfigs={},this._layers={},this.update(oe,[],de)}update(oe,de,Se){this._options=Se;for(const $e of oe)this._layerConfigs[$e.id]=$e,(this._layers[$e.id]=r.cu($e,this.scope,null,this._options)).compileFilter(Se),this.keyCache[$e.id]&&delete this.keyCache[$e.id];for(const $e of de)delete this.keyCache[$e],delete this._layerConfigs[$e],delete this._layers[$e];this.familiesBySource={};const He=function($e,et){const _t={};for(let mt=0;mt<$e.length;mt++){const wt=$e[mt];let Tt=et&&et[wt.id];!Tt&&(Tt=K(wt),wt.type==="line"&&wt.paint)&&function fn(on){return typeof on=="string"&&on==="line-progress"||(Array.isArray(on)?on.some(fn):!(!on||typeof on!="object")&&Object.values(on).some(fn))}(wt.paint["line-width"])&&(Tt+=`/${Z(wt.paint["line-width"])}`),et&&(et[wt.id]=Tt);let Jt=_t[Tt];Jt||(Jt=_t[Tt]=[]),Jt.push(wt)}const Ke=[];for(const mt in _t)Ke.push(_t[mt]);return Ke}(r.bj(this._layerConfigs),this.keyCache);for(const $e of He){const et=$e.map(Jt=>this._layers[Jt.id]),_t=et[0];if(_t.visibility==="none")continue;const Ke=_t.source||"";let mt=this.familiesBySource[Ke];mt||(mt=this.familiesBySource[Ke]={});const wt=_t.sourceLayer||"_geojsonTileLayer";let Tt=mt[wt];Tt||(Tt=mt[wt]=[]),Tt.push(et)}}}const le=1*r.dX;class Te{constructor(oe){const de={},Se=[];for(const _t in oe){const Ke=oe[_t],mt=de[_t]={};for(const wt in Ke.glyphs){const Tt=Ke.glyphs[+wt];if(!Tt||Tt.bitmap.width===0||Tt.bitmap.height===0)continue;const Jt=Tt.metrics.localGlyph?le:1,fn={x:0,y:0,w:Tt.bitmap.width+2*Jt,h:Tt.bitmap.height+2*Jt};Se.push(fn),mt[wt]=fn}}const{w:He,h:$e}=r.C(Se),et=new r.dW({width:He||1,height:$e||1});for(const _t in oe){const Ke=oe[_t];for(const mt in Ke.glyphs){const wt=Ke.glyphs[+mt];if(!wt||wt.bitmap.width===0||wt.bitmap.height===0)continue;const Tt=de[_t][mt],Jt=wt.metrics.localGlyph?le:1;r.dW.copy(wt.bitmap,et,{x:0,y:0},{x:Tt.x+Jt,y:Tt.y+Jt},wt.bitmap)}}this.image=et,this.positions=de}}r.dV(Te,"GlyphAtlas");class pe{constructor(oe){this.tileID=new r.aG(oe.tileID.overscaledZ,oe.tileID.wrap,oe.tileID.canonical.z,oe.tileID.canonical.x,oe.tileID.canonical.y),this.tileZoom=oe.tileZoom,this.uid=oe.uid,this.zoom=oe.zoom,this.lut=oe.lut,this.canonical=oe.tileID.canonical,this.pixelRatio=oe.pixelRatio,this.tileSize=oe.tileSize,this.source=oe.source,this.scope=oe.scope,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=oe.showCollisionBoxes,this.collectResourceTiming=!!oe.request&&oe.request.collectResourceTiming,this.promoteId=oe.promoteId,this.isSymbolTile=oe.isSymbolTile,this.tileTransform=r.aQ(oe.tileID.canonical,oe.projection),this.projection=oe.projection,this.worldview=oe.worldview,this.localizableLayerIds=oe.localizableLayerIds,this.brightness=oe.brightness,this.extraShadowCaster=!!oe.extraShadowCaster,this.tessellationStep=oe.tessellationStep,this.scaleFactor=oe.scaleFactor}parse(oe,de,Se,He,$e){this.status="parsing",this.data=oe,this.collisionBoxArray=new r.aW;const et=new r.dY(Object.keys(oe.layers).sort()),_t=new r.dZ(this.tileID,this.promoteId);_t.bucketLayerIDs=[];const Ke={},mt=new r.d_(256,256),wt={featureIndex:_t,iconDependencies:{},patternDependencies:{},glyphDependencies:{},lineAtlas:mt,availableImages:Se,brightness:this.brightness,scaleFactor:this.scaleFactor},Tt=de.familiesBySource[this.source];for(const In in Tt){const kr=oe.layers[In];if(!kr)continue;let lr=!1,Hn=!1,Br=!1;for(const po of Tt[In])po[0].type==="symbol"?lr=!0:Hn=!0,po[0].is3D()&&po[0].type!=="model"&&(Br=!0);if(this.extraShadowCaster&&!Br||this.isSymbolTile===!0&&!lr||this.isSymbolTile===!1&&!Hn)continue;kr.version===1&&r.w(`Vector tile source "${this.source}" layer "${In}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const ti=et.encode(In),zr=[];for(let po=0,so=0;po<kr.length;po++){const ao=kr.feature(po),zs=_t.getId(ao,In);if(this.localizableLayerIds&&this.localizableLayerIds.has(In)){const cs=ao.properties?ao.properties.worldview:null;if(this.worldview&&typeof cs=="string")if(cs==="all")ao.properties.$localized=!0;else{if(!cs.split(",").includes(this.worldview))continue;ao.properties.$localized=!0,ao.properties.worldview=this.worldview}}zr.push({feature:ao,id:zs,index:so,sourceLayerIndex:ti}),so++}for(const po of Tt[In]){const so=po[0];(!this.extraShadowCaster||so.is3D()&&so.type!=="model")&&(this.isSymbolTile!==void 0&&so.type==="symbol"!==this.isSymbolTile||so.minzoom&&this.zoom<Math.floor(so.minzoom)||so.maxzoom&&this.zoom>=so.maxzoom||so.visibility!=="none"&&(ge(po,this.zoom,wt.brightness,Se),(Ke[so.id]=so.createBucket({index:_t.bucketLayerIDs.length,layers:po,zoom:this.zoom,lut:this.lut,canonical:this.canonical,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:ti,sourceID:this.source,projection:this.projection.spec,tessellationStep:this.tessellationStep})).populate(zr,wt,this.tileID.canonical,this.tileTransform),_t.bucketLayerIDs.push(po.map(ao=>r.aC(ao.id,ao.scope)))))}}let Jt,fn,on,En;mt.trim();const zn={type:"maybePrepare",isSymbolTile:this.isSymbolTile,zoom:this.zoom},Rn=()=>{if(Jt)return this.status="done",$e(Jt);if(this.extraShadowCaster)this.status="done",$e(null,{buckets:r.bj(Ke).filter(In=>!In.isEmpty()),featureIndex:_t,collisionBoxArray:null,glyphAtlasImage:null,lineAtlas:null,imageAtlas:null,brightness:wt.brightness,glyphMap:null,iconMap:null,glyphPositions:null});else if(fn&&on&&En){const In=new Te(fn),kr=new r.e1(on,En,this.lut);for(const lr in Ke){const Hn=Ke[lr];Hn instanceof r.aX?(ge(Hn.layers,this.zoom,wt.brightness,Se),r.e2(Hn,fn,In.positions,on,kr.iconPositions,this.showCollisionBoxes,Se,this.tileID.canonical,this.tileZoom,this.projection,this.scaleFactor,this.pixelRatio,this.brightness)):Hn.hasPattern&&(Hn instanceof r.b1||Hn instanceof r.b2||Hn instanceof r.d5)&&(ge(Hn.layers,this.zoom,wt.brightness,Se),Hn.addFeatures(wt,this.tileID.canonical,kr.patternPositions,Se,this.tileTransform,this.brightness))}this.status="done",$e(null,{buckets:r.bj(Ke).filter(lr=>!lr.isEmpty()),featureIndex:_t,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:In.image,lineAtlas:mt,imageAtlas:kr,brightness:wt.brightness})}};if(!this.extraShadowCaster){const In=r.d$(wt.glyphDependencies,Hn=>Object.keys(Hn).map(Number));Object.keys(In).length?He.send("getGlyphs",{uid:this.uid,stacks:In,scope:this.scope},(Hn,Br)=>{Jt||(Jt=Hn,fn=Br,Rn())},void 0,!1,zn):fn={};const kr=Object.keys(wt.iconDependencies);kr.length?He.send("getImages",{icons:kr,source:this.source,scope:this.scope,tileID:this.tileID,type:"icons"},(Hn,Br)=>{if(Jt)return;Jt=Hn;const ti={};Object.values(Br).some(zr=>zr.usvg)?this.rasterize(He,ti,Br,wt.iconDependencies,()=>{on=ti,Rn()}):(this.fillImageMap(ti,wt.iconDependencies,Br),on=ti,Rn())},void 0,!1,zn):on={};const lr=Object.keys(wt.patternDependencies);lr.length?He.send("getImages",{icons:lr,source:this.source,scope:this.scope,tileID:this.tileID,type:"patterns"},(Hn,Br)=>{if(!Jt){Jt=Hn;const ti={};Object.values(Br).some(zr=>zr.usvg)?this.rasterize(He,ti,Br,wt.patternDependencies,()=>{En=ti,Rn()}):(this.fillImageMap(ti,wt.patternDependencies,Br),En=ti,Rn())}},void 0,!1,zn):En={}}Rn()}fillImageMap(oe,de,Se){for(const He in Se){const $e=de[He]||[];for(const et of $e)Se[et.id].usvg||(oe[et.serialize()]=Se[et.id])}}getImageTaskQueue(oe,de,Se){const He={};for(const $e in de){const et=Se[$e]||[];for(const _t of et){const Ke=_t.serialize();de[_t.id].usvg?He[Ke]||(He[Ke]=_t):oe[Ke]=de[_t.id]}}return He}rasterize(oe,de,Se,He,$e){const et=this.getImageTaskQueue(de,Se,He);this.rasterizeTask=oe.send("rasterizeImages",{scope:this.scope,imageTasks:et},(_t,Ke)=>{if(!_t)for(const mt in Ke){const{id:wt}=r.e0.deserializeFromString(mt);de[mt]=Object.assign({},Se[wt],{data:Ke[mt]})}$e()})}cancelRasterize(){this.rasterizeTask&&this.rasterizeTask.cancel()}}function ge(bt,oe,de,Se){const He=new r.a8(oe,{brightness:de});for(const $e of bt)$e.recalculate(He,Se)}class fe extends r.E{constructor(oe,de,Se,He,$e,et){super(),this.actor=oe,this.layerIndex=de,this.availableImages=Se,this.loadVectorData=$e||r.aD,this.loading={},this.loaded={},this.deduped=new r.aB(oe.scheduler),this.isSpriteLoaded=He,this.scheduler=oe.scheduler,this.brightness=et}loadTile(oe,de){const Se=oe.uid,He=oe&&oe.request,$e=He&&He.collectResourceTiming,et=this.loading[Se]=new pe(oe);et.abort=this.loadVectorData(oe,(_t,Ke)=>{const mt=!this.loading[Se];if(delete this.loading[Se],et.cancelRasterize(),mt||_t||!Ke)return et.status="done",mt||(this.loaded[Se]=et),de(_t);const wt=Ke.rawData,Tt={};Ke.expires&&(Tt.expires=Ke.expires),Ke.cacheControl&&(Tt.cacheControl=Ke.cacheControl),et.vectorTile=Ke.vectorTile||new r.e3.VectorTile(new r.bh(wt));const Jt=()=>{et.parse(et.vectorTile,this.layerIndex,this.availableImages,this.actor,(fn,on)=>{if(fn||!on)return de(fn);const En={};if($e){const zn=H(He);zn.length>0&&(En.resourceTiming=JSON.parse(JSON.stringify(zn)))}de(null,r.l({rawTileData:wt.slice(0)},on,Tt,En))})};this.isSpriteLoaded?Jt():this.once("isSpriteLoaded",()=>{this.scheduler?this.scheduler.add(Jt,{type:"parseTile",isSymbolTile:oe.isSymbolTile,zoom:oe.tileZoom}):Jt()}),this.loaded=this.loaded||{},this.loaded[Se]=et})}reloadTile(oe,de){const Se=this.loaded,He=oe.uid;if(Se&&Se[He]){const $e=Se[He];$e.scaleFactor=oe.scaleFactor,$e.showCollisionBoxes=oe.showCollisionBoxes,$e.projection=oe.projection,$e.brightness=oe.brightness,$e.tileTransform=r.aQ(oe.tileID.canonical,oe.projection),$e.extraShadowCaster=oe.extraShadowCaster,$e.lut=oe.lut;const et=(_t,Ke)=>{const mt=$e.reloadCallback;mt&&(delete $e.reloadCallback,$e.parse($e.vectorTile,this.layerIndex,this.availableImages,this.actor,mt)),de(_t,Ke)};$e.status==="parsing"?$e.reloadCallback=et:$e.status==="done"&&($e.vectorTile?$e.parse($e.vectorTile,this.layerIndex,this.availableImages,this.actor,et):et())}else de(null,void 0)}abortTile(oe,de){const Se=oe.uid,He=this.loading[Se];He&&(He.abort&&He.abort(),delete this.loading[Se]),de()}removeTile(oe,de){const Se=this.loaded,He=oe.uid;Se&&Se[He]&&delete Se[He],de()}}class me{loadTile(oe,de){const{uid:Se,encoding:He,rawImageData:$e,padding:et}=oe,_t=ImageBitmap&&$e instanceof ImageBitmap?this.getImageData($e,et):$e;de(null,new r.e4(Se,_t,He,et<1))}getImageData(oe,de){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(oe.width,oe.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d",{willReadFrequently:!0})),this.offscreenCanvas.width=oe.width,this.offscreenCanvas.height=oe.height,this.offscreenCanvasContext.drawImage(oe,0,0,oe.width,oe.height);const Se=this.offscreenCanvasContext.getImageData(-de,-de,oe.width+2*de,oe.height+2*de);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),Se}}r.bg.setPbf(r.bh);class _e{decodeRasterArray({task:oe,buffer:de},Se){r.bg.performDecoding(de,oe).then(He=>{Se(null,He)},He=>{Se(He)})}}const Ie=r.e3.VectorTileFeature.prototype.toGeoJSON;class Ne{constructor(oe){this._feature=oe,this.extent=r.ag,this.type=oe.type,this.properties=oe.tags,"id"in oe&&!isNaN(oe.id)&&(this.id=parseInt(oe.id,10))}loadGeometry(){if(this._feature.type===1){const oe=[];for(const de of this._feature.geometry)oe.push([new r.P(de[0],de[1])]);return oe}{const oe=[];for(const de of this._feature.geometry){const Se=[];for(const He of de)Se.push(new r.P(He[0],He[1]));oe.push(Se)}return oe}}toGeoJSON(oe,de,Se){return Ie.call(this,oe,de,Se)}}class nt{constructor(oe){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=r.ag,this.length=oe.length,this._features=oe}feature(oe){return new Ne(this._features[oe])}}const Le=64/4096,Pe=128;class rt{constructor(){this.features=new Map}clear(){this.features.clear()}load(oe=[],de){for(const Se of oe){const He=Se.id;if(He==null)continue;let $e=this.features.get(He);$e&&this.updateCache($e,de),Se.geometry?($e=Qe(Se),this.updateCache($e,de),this.features.set(He,$e)):this.features.delete(He),this.updateCache($e,de)}}updateCache(oe,de){for(const{canonical:Se,uid:He}of Object.values(de)){const{z:$e,x:et,y:_t}=Se;at(oe,Math.pow(2,$e),et,_t)&&delete de[He]}}getTile(oe,de,Se){const He=Math.pow(2,oe),$e=[];for(const et of this.features.values())at(et,He,de,Se)&&$e.push(Nt(et,He,de,Se));return{features:$e}}getFeatures(){return[...this.features.values()]}}function at({minX:bt,minY:oe,maxX:de,maxY:Se},He,$e,et){return bt<($e+1+Le)/He&&oe<(et+1+Le)/He&&de>($e-Le)/He&&Se>(et-Le)/He}function Qe(bt){const{id:oe,geometry:de,properties:Se}=bt;if(!de)return;if(de.type==="GeometryCollection")throw new Error("GeometryCollection not supported in dynamic mode.");const{type:He,coordinates:$e}=de,et={id:oe,type:1,geometry:[],tags:Se,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0},_t=et.geometry;if(He==="Point")lt($e,_t,et);else if(He==="MultiPoint")for(const Ke of $e)lt(Ke,_t,et);else if(He==="LineString")et.type=2,Ct($e,_t,et);else if(He==="MultiLineString")et.type=2,Rt($e,_t,et);else if(He==="Polygon")et.type=3,Rt($e,_t,et,!0);else{if(He!=="MultiPolygon")throw new Error("Input data is not a valid GeoJSON object.");et.type=3;for(const Ke of $e)Rt(Ke,_t,et,!0)}return et}function lt([bt,oe],de,Se){const He=r.at(bt);let $e=r.aA(oe);$e=$e<0?0:$e>1?1:$e,de.push(He,$e),Se.minX=Math.min(Se.minX,He),Se.minY=Math.min(Se.minY,$e),Se.maxX=Math.max(Se.maxX,He),Se.maxY=Math.max(Se.maxY,$e)}function Ct(bt,oe,de,Se=!1,He=!1){const $e=[];for(const et of bt)lt(et,$e,de);oe.push($e),Se&&function(et,_t){let Ke=0;for(let mt=0,wt=et.length,Tt=wt-2;mt<wt;Tt=mt,mt+=2)Ke+=(et[mt]-et[Tt])*(et[mt+1]+et[Tt+1]);if(Ke>0===_t)for(let mt=0,wt=et.length;mt<wt/2;mt+=2){const Tt=et[mt],Jt=et[mt+1];et[mt]=et[wt-2-mt],et[mt+1]=et[wt-1-mt],et[wt-2-mt]=Tt,et[wt-1-mt]=Jt}}($e,He)}function Rt(bt,oe,de,Se=!1){for(let He=0;He<bt.length;He++)Ct(bt[He],oe,de,Se,He===0)}function Nt(bt,oe,de,Se){const{id:He,type:$e,geometry:et,tags:_t}=bt,Ke=[];if($e===1)(function(mt,wt,Tt,Jt,fn){for(let on=0;on<mt.length;on+=2){const En=Math.round(r.ag*(mt[on+0]*wt-Tt)),zn=Math.round(r.ag*(mt[on+1]*wt-Jt));fn.push([En,zn])}})(et,oe,de,Se,Ke);else for(const mt of et)At(mt,oe,de,Se,Ke);return{id:He,type:$e,geometry:Ke,tags:_t}}function At(bt,oe,de,Se,He){const et=r.ag+Pe;let _t;for(let Ke=0;Ke<bt.length-2;Ke+=2){let mt=Math.round(r.ag*(bt[Ke+0]*oe-de)),wt=Math.round(r.ag*(bt[Ke+1]*oe-Se)),Tt=Math.round(r.ag*(bt[Ke+2]*oe-de)),Jt=Math.round(r.ag*(bt[Ke+3]*oe-Se));const fn=Tt-mt,on=Jt-wt;mt<-128&&Tt<-128||(mt<-128?(wt+=Math.round(on*((-128-mt)/fn)),mt=-128):Tt<-128&&(Jt=wt+Math.round(on*((-128-mt)/fn)),Tt=-128),wt<-128&&Jt<-128||(wt<-128?(mt+=Math.round(fn*((-128-wt)/on)),wt=-128):Jt<-128&&(Tt=mt+Math.round(fn*((-128-wt)/on)),Jt=-128),mt>=et&&Tt>=et||(mt>=et?(wt+=Math.round(on*((et-mt)/fn)),mt=et):Tt>=et&&(Jt=wt+Math.round(on*((et-mt)/fn)),Tt=et),wt>=et&&Jt>=et||(wt>=et?(mt+=Math.round(fn*((et-wt)/on)),wt=et):Jt>=et&&(Tt=mt+Math.round(fn*((et-wt)/on)),Jt=et),_t&&mt===_t[_t.length-1][0]&&wt===_t[_t.length-1][1]||(_t=[[mt,wt]],He.push(_t)),_t.push([Tt,Jt])))))}}var xt,gt,ht,vt={exports:{}},Ve=function(){if(ht)return vt.exports;ht=1;var bt=r.e7(),oe=function(){if(gt)return xt;gt=1;var wt=r.e5(),Tt=r.e6().VectorTileFeature;function Jt(on,En){this.options=En||{},this.features=on,this.length=on.length}function fn(on,En){this.id=typeof on.id=="number"?on.id:void 0,this.type=on.type,this.rawGeometry=on.type===1?[on.geometry]:on.geometry,this.properties=on.tags,this.extent=En||4096}return xt=Jt,Jt.prototype.feature=function(on){return new fn(this.features[on],this.options.extent)},fn.prototype.loadGeometry=function(){var on=this.rawGeometry;this.geometry=[];for(var En=0;En<on.length;En++){for(var zn=on[En],Rn=[],In=0;In<zn.length;In++)Rn.push(new wt(zn[In][0],zn[In][1]));this.geometry.push(Rn)}return this.geometry},fn.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var on=this.geometry,En=1/0,zn=-1/0,Rn=1/0,In=-1/0,kr=0;kr<on.length;kr++)for(var lr=on[kr],Hn=0;Hn<lr.length;Hn++){var Br=lr[Hn];En=Math.min(En,Br.x),zn=Math.max(zn,Br.x),Rn=Math.min(Rn,Br.y),In=Math.max(In,Br.y)}return[En,Rn,zn,In]},fn.prototype.toGeoJSON=Tt.prototype.toGeoJSON,xt}();function de(wt){var Tt=new bt;return function(Jt,fn){for(var on in Jt.layers)fn.writeMessage(3,Se,Jt.layers[on])}(wt,Tt),Tt.finish()}function Se(wt,Tt){var Jt;Tt.writeVarintField(15,wt.version||1),Tt.writeStringField(1,wt.name||""),Tt.writeVarintField(5,wt.extent||4096);var fn={keys:[],values:[],keycache:{},valuecache:{}};for(Jt=0;Jt<wt.length;Jt++)fn.feature=wt.feature(Jt),Tt.writeMessage(2,He,fn);var on=fn.keys;for(Jt=0;Jt<on.length;Jt++)Tt.writeStringField(3,on[Jt]);var En=fn.values;for(Jt=0;Jt<En.length;Jt++)Tt.writeMessage(4,mt,En[Jt])}function He(wt,Tt){var Jt=wt.feature;Jt.id!==void 0&&Tt.writeVarintField(1,Jt.id),Tt.writeMessage(2,$e,wt),Tt.writeVarintField(3,Jt.type),Tt.writeMessage(4,Ke,Jt)}function $e(wt,Tt){var Jt=wt.feature,fn=wt.keys,on=wt.values,En=wt.keycache,zn=wt.valuecache;for(var Rn in Jt.properties){var In=Jt.properties[Rn],kr=En[Rn];if(In!==null){kr===void 0&&(fn.push(Rn),En[Rn]=kr=fn.length-1),Tt.writeVarint(kr);var lr=typeof In;lr!=="string"&&lr!=="boolean"&&lr!=="number"&&(In=JSON.stringify(In));var Hn=lr+":"+In,Br=zn[Hn];Br===void 0&&(on.push(In),zn[Hn]=Br=on.length-1),Tt.writeVarint(Br)}}}function et(wt,Tt){return(Tt<<3)+(7&wt)}function _t(wt){return wt<<1^wt>>31}function Ke(wt,Tt){for(var Jt=wt.loadGeometry(),fn=wt.type,on=0,En=0,zn=Jt.length,Rn=0;Rn<zn;Rn++){var In=Jt[Rn],kr=1;fn===1&&(kr=In.length),Tt.writeVarint(et(1,kr));for(var lr=fn===3?In.length-1:In.length,Hn=0;Hn<lr;Hn++){Hn===1&&fn!==1&&Tt.writeVarint(et(2,lr-1));var Br=In[Hn].x-on,ti=In[Hn].y-En;Tt.writeVarint(_t(Br)),Tt.writeVarint(_t(ti)),on+=Br,En+=ti}fn===3&&Tt.writeVarint(et(7,1))}}function mt(wt,Tt){var Jt=typeof wt;Jt==="string"?Tt.writeStringField(1,wt):Jt==="boolean"?Tt.writeBooleanField(7,wt):Jt==="number"&&(wt%1!=0?Tt.writeDoubleField(3,wt):wt<0?Tt.writeSVarintField(6,wt):Tt.writeVarintField(5,wt))}return vt.exports=de,vt.exports.fromVectorTileJs=de,vt.exports.fromGeojsonVt=function(wt,Tt){Tt=Tt||{};var Jt={};for(var fn in wt)Jt[fn]=new oe(wt[fn].features,Tt),Jt[fn].name=fn,Jt[fn].version=Tt.version,Jt[fn].extent=Tt.extent;return de({layers:Jt})},vt.exports.GeoJSONWrapper=oe,vt.exports}(),je=r.e8(Ve);const it={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:bt=>bt},Mt=Math.fround||(Ot=new Float32Array(1),bt=>(Ot[0]=+bt,Ot[0]));var Ot;const sn=3,hn=5,Tn=6;class Ut{constructor(oe){this.options=Object.assign(Object.create(it),oe),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(oe){const{log:de,minZoom:Se,maxZoom:He}=this.options;de&&console.time("total time");const $e=`prepare ${oe.length} points`;de&&console.time($e),this.points=oe;const et=[];for(let Ke=0;Ke<oe.length;Ke++){const mt=oe[Ke];if(!mt.geometry)continue;const[wt,Tt]=mt.geometry.coordinates,Jt=Mt(Hr(wt)),fn=Mt(Nr(Tt));et.push(Jt,fn,1/0,Ke,-1,1),this.options.reduce&&et.push(0)}let _t=this.trees[He+1]=this._createTree(et);de&&console.timeEnd($e);for(let Ke=He;Ke>=Se;Ke--){const mt=+Date.now();_t=this.trees[Ke]=this._createTree(this._cluster(_t,Ke)),de&&console.log("z%d: %d clusters in %dms",Ke,_t.numItems,+Date.now()-mt)}return de&&console.timeEnd("total time"),this}getClusters(oe,de){let Se=((oe[0]+180)%360+360)%360-180;const He=Math.max(-90,Math.min(90,oe[1]));let $e=oe[2]===180?180:((oe[2]+180)%360+360)%360-180;const et=Math.max(-90,Math.min(90,oe[3]));if(oe[2]-oe[0]>=360)Se=-180,$e=180;else if(Se>$e){const Tt=this.getClusters([Se,He,180,et],de),Jt=this.getClusters([-180,He,$e,et],de);return Tt.concat(Jt)}const _t=this.trees[this._limitZoom(de)],Ke=_t.range(Hr(Se),Nr(et),Hr($e),Nr(He)),mt=_t.data,wt=[];for(const Tt of Ke){const Jt=this.stride*Tt;wt.push(mt[Jt+hn]>1?bn(mt,Jt,this.clusterProps):this.points[mt[Jt+sn]])}return wt}getChildren(oe){const de=this._getOriginId(oe),Se=this._getOriginZoom(oe),He="No cluster with the specified id.",$e=this.trees[Se];if(!$e)throw new Error(He);const et=$e.data;if(de*this.stride>=et.length)throw new Error(He);const _t=this.options.radius/(this.options.extent*Math.pow(2,Se-1)),Ke=$e.within(et[de*this.stride],et[de*this.stride+1],_t),mt=[];for(const wt of Ke){const Tt=wt*this.stride;et[Tt+4]===oe&&mt.push(et[Tt+hn]>1?bn(et,Tt,this.clusterProps):this.points[et[Tt+sn]])}if(mt.length===0)throw new Error(He);return mt}getLeaves(oe,de,Se){const He=[];return this._appendLeaves(He,oe,de=de||10,Se=Se||0,0),He}getTile(oe,de,Se){const He=this.trees[this._limitZoom(oe)],$e=Math.pow(2,oe),{extent:et,radius:_t}=this.options,Ke=_t/et,mt=(Se-Ke)/$e,wt=(Se+1+Ke)/$e,Tt={features:[]};return this._addTileFeatures(He.range((de-Ke)/$e,mt,(de+1+Ke)/$e,wt),He.data,de,Se,$e,Tt),de===0&&this._addTileFeatures(He.range(1-Ke/$e,mt,1,wt),He.data,$e,Se,$e,Tt),de===$e-1&&this._addTileFeatures(He.range(0,mt,Ke/$e,wt),He.data,-1,Se,$e,Tt),Tt.features.length?Tt:null}getClusterExpansionZoom(oe){let de=this._getOriginZoom(oe)-1;for(;de<=this.options.maxZoom;){const Se=this.getChildren(oe);if(de++,Se.length!==1)break;oe=Se[0].properties.cluster_id}return de}_appendLeaves(oe,de,Se,He,$e){const et=this.getChildren(de);for(const _t of et){const Ke=_t.properties;if(Ke&&Ke.cluster?$e+Ke.point_count<=He?$e+=Ke.point_count:$e=this._appendLeaves(oe,Ke.cluster_id,Se,He,$e):$e<He?$e++:oe.push(_t),oe.length===Se)break}return $e}_createTree(oe){const de=new r.bE(oe.length/this.stride|0,this.options.nodeSize,Float32Array);for(let Se=0;Se<oe.length;Se+=this.stride)de.add(oe[Se],oe[Se+1]);return de.finish(),de.data=oe,de}_addTileFeatures(oe,de,Se,He,$e,et){for(const _t of oe){const Ke=_t*this.stride,mt=de[Ke+hn]>1;let wt,Tt,Jt;if(mt)wt=Re(de,Ke,this.clusterProps),Tt=de[Ke],Jt=de[Ke+1];else{const En=this.points[de[Ke+sn]];wt=En.properties;const[zn,Rn]=En.geometry.coordinates;Tt=Hr(zn),Jt=Nr(Rn)}const fn={type:1,geometry:[[Math.round(this.options.extent*(Tt*$e-Se)),Math.round(this.options.extent*(Jt*$e-He))]],tags:wt};let on;on=mt||this.options.generateId?de[Ke+sn]:this.points[de[Ke+sn]].id,on!==void 0&&(fn.id=on),et.features.push(fn)}}_limitZoom(oe){return Math.max(this.options.minZoom,Math.min(Math.floor(+oe),this.options.maxZoom+1))}_cluster(oe,de){const{radius:Se,extent:He,reduce:$e,minPoints:et}=this.options,_t=Se/(He*Math.pow(2,de)),Ke=oe.data,mt=[],wt=this.stride;for(let Tt=0;Tt<Ke.length;Tt+=wt){if(Ke[Tt+2]<=de)continue;Ke[Tt+2]=de;const Jt=Ke[Tt],fn=Ke[Tt+1],on=oe.within(Ke[Tt],Ke[Tt+1],_t),En=Ke[Tt+hn];let zn=En;for(const Rn of on){const In=Rn*wt;Ke[In+2]>de&&(zn+=Ke[In+hn])}if(zn>En&&zn>=et){let Rn,In=Jt*En,kr=fn*En,lr=-1;const Hn=(Tt/wt<<5)+(de+1)+this.points.length;for(const Br of on){const ti=Br*wt;if(Ke[ti+2]<=de)continue;Ke[ti+2]=de;const zr=Ke[ti+hn];In+=Ke[ti]*zr,kr+=Ke[ti+1]*zr,Ke[ti+4]=Hn,$e&&(Rn||(Rn=this._map(Ke,Tt,!0),lr=this.clusterProps.length,this.clusterProps.push(Rn)),$e(Rn,this._map(Ke,ti)))}Ke[Tt+4]=Hn,mt.push(In/zn,kr/zn,1/0,Hn,-1,zn),$e&&mt.push(lr)}else{for(let Rn=0;Rn<wt;Rn++)mt.push(Ke[Tt+Rn]);if(zn>1)for(const Rn of on){const In=Rn*wt;if(!(Ke[In+2]<=de)){Ke[In+2]=de;for(let kr=0;kr<wt;kr++)mt.push(Ke[In+kr])}}}}return mt}_getOriginId(oe){return oe-this.points.length>>5}_getOriginZoom(oe){return(oe-this.points.length)%32}_map(oe,de,Se){if(oe[de+hn]>1){const et=this.clusterProps[oe[de+Tn]];return Se?Object.assign({},et):et}const He=this.points[oe[de+sn]].properties,$e=this.options.map(He);return Se&&$e===He?Object.assign({},$e):$e}}function bn(bt,oe,de){return{type:"Feature",id:bt[oe+sn],properties:Re(bt,oe,de),geometry:{type:"Point",coordinates:[(Se=bt[oe],360*(Se-.5)),Ar(bt[oe+1])]}};var Se}function Re(bt,oe,de){const Se=bt[oe+hn],He=Se>=1e4?`${Math.round(Se/1e3)}k`:Se>=1e3?Math.round(Se/100)/10+"k":Se,$e=bt[oe+Tn],et=$e===-1?{}:Object.assign({},de[$e]);return Object.assign(et,{cluster:!0,cluster_id:bt[oe+sn],point_count:Se,point_count_abbreviated:He})}function Hr(bt){return bt/360+.5}function Nr(bt){const oe=Math.sin(bt*Math.PI/180),de=.5-.25*Math.log((1+oe)/(1-oe))/Math.PI;return de<0?0:de>1?1:de}function Ar(bt){const oe=(180-360*bt)*Math.PI/180;return 360*Math.atan(Math.exp(oe))/Math.PI-90}function Ht(bt,oe,de,Se){let He=Se;const $e=oe+(de-oe>>1);let et,_t=de-oe;const Ke=bt[oe],mt=bt[oe+1],wt=bt[de],Tt=bt[de+1];for(let Jt=oe+3;Jt<de;Jt+=3){const fn=Wr(bt[Jt],bt[Jt+1],Ke,mt,wt,Tt);if(fn>He)et=Jt,He=fn;else if(fn===He){const on=Math.abs(Jt-$e);on<_t&&(et=Jt,_t=on)}}He>Se&&(et-oe>3&&Ht(bt,oe,et,Se),bt[et+2]=He,de-et>3&&Ht(bt,et,de,Se))}function Wr(bt,oe,de,Se,He,$e){let et=He-de,_t=$e-Se;if(et!==0||_t!==0){const Ke=((bt-de)*et+(oe-Se)*_t)/(et*et+_t*_t);Ke>1?(de=He,Se=$e):Ke>0&&(de+=et*Ke,Se+=_t*Ke)}return et=bt-de,_t=oe-Se,et*et+_t*_t}function ar(bt,oe,de,Se){const He={id:bt??null,type:oe,geometry:de,tags:Se,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};if(oe==="Point"||oe==="MultiPoint"||oe==="LineString")pi(He,de);else if(oe==="Polygon")pi(He,de[0]);else if(oe==="MultiLineString")for(const $e of de)pi(He,$e);else if(oe==="MultiPolygon")for(const $e of de)pi(He,$e[0]);return He}function pi(bt,oe){for(let de=0;de<oe.length;de+=3)bt.minX=Math.min(bt.minX,oe[de]),bt.minY=Math.min(bt.minY,oe[de+1]),bt.maxX=Math.max(bt.maxX,oe[de]),bt.maxY=Math.max(bt.maxY,oe[de+1])}function $n(bt,oe,de,Se){if(!oe.geometry)return;const He=oe.geometry.coordinates;if(He&&He.length===0)return;const $e=oe.geometry.type,et=Math.pow(de.tolerance/((1<<de.maxZoom)*de.extent),2);let _t=[],Ke=oe.id;if(de.promoteId?Ke=oe.properties[de.promoteId]:de.generateId&&(Ke=Se||0),$e==="Point")Gr(He,_t);else if($e==="MultiPoint")for(const mt of He)Gr(mt,_t);else if($e==="LineString")gi(He,_t,et,!1);else if($e==="MultiLineString"){if(de.lineMetrics){for(const mt of He)_t=[],gi(mt,_t,et,!1),bt.push(ar(Ke,"LineString",_t,oe.properties));return}Pr(He,_t,et,!1)}else if($e==="Polygon")Pr(He,_t,et,!0);else{if($e!=="MultiPolygon"){if($e==="GeometryCollection"){for(const mt of oe.geometry.geometries)$n(bt,{id:Ke,geometry:mt,properties:oe.properties},de,Se);return}throw new Error("Input data is not a valid GeoJSON object.")}for(const mt of He){const wt=[];Pr(mt,wt,et,!0),_t.push(wt)}}bt.push(ar(Ke,$e,_t,oe.properties))}function Gr(bt,oe){oe.push(ci(bt[0]),Un(bt[1]),0)}function gi(bt,oe,de,Se){let He,$e,et=0;for(let Ke=0;Ke<bt.length;Ke++){const mt=ci(bt[Ke][0]),wt=Un(bt[Ke][1]);oe.push(mt,wt,0),Ke>0&&(et+=Se?(He*wt-mt*$e)/2:Math.sqrt(Math.pow(mt-He,2)+Math.pow(wt-$e,2))),He=mt,$e=wt}const _t=oe.length-3;oe[2]=1,Ht(oe,0,_t,de),oe[_t+2]=1,oe.size=Math.abs(et),oe.start=0,oe.end=oe.size}function Pr(bt,oe,de,Se){for(let He=0;He<bt.length;He++){const $e=[];gi(bt[He],$e,de,Se),oe.push($e)}}function ci(bt){return bt/360+.5}function Un(bt){const oe=Math.sin(bt*Math.PI/180),de=.5-.25*Math.log((1+oe)/(1-oe))/Math.PI;return de<0?0:de>1?1:de}function yn(bt,oe,de,Se,He,$e,et,_t){if(Se/=oe,$e>=(de/=oe)&&et<Se)return bt;if(et<de||$e>=Se)return null;const Ke=[];for(const mt of bt){const wt=mt.geometry;let Tt=mt.type;const Jt=He===0?mt.minX:mt.minY,fn=He===0?mt.maxX:mt.maxY;if(Jt>=de&&fn<Se){Ke.push(mt);continue}if(fn<de||Jt>=Se)continue;let on=[];if(Tt==="Point"||Tt==="MultiPoint")Ir(wt,on,de,Se,He);else if(Tt==="LineString")ui(wt,on,de,Se,He,!1,_t.lineMetrics);else if(Tt==="MultiLineString")Lr(wt,on,de,Se,He,!1);else if(Tt==="Polygon")Lr(wt,on,de,Se,He,!0);else if(Tt==="MultiPolygon")for(const En of wt){const zn=[];Lr(En,zn,de,Se,He,!0),zn.length&&on.push(zn)}if(on.length){if(_t.lineMetrics&&Tt==="LineString"){for(const En of on)Ke.push(ar(mt.id,Tt,En,mt.tags));continue}Tt!=="LineString"&&Tt!=="MultiLineString"||(on.length===1?(Tt="LineString",on=on[0]):Tt="MultiLineString"),Tt!=="Point"&&Tt!=="MultiPoint"||(Tt=on.length===3?"Point":"MultiPoint"),Ke.push(ar(mt.id,Tt,on,mt.tags))}}return Ke.length?Ke:null}function Ir(bt,oe,de,Se,He){for(let $e=0;$e<bt.length;$e+=3){const et=bt[$e+He];et>=de&&et<=Se&&yi(oe,bt[$e],bt[$e+1],bt[$e+2])}}function ui(bt,oe,de,Se,He,$e,et){let _t=_i(bt);const Ke=He===0?oi:qi;let mt,wt,Tt=bt.start;for(let zn=0;zn<bt.length-3;zn+=3){const Rn=bt[zn],In=bt[zn+1],kr=bt[zn+2],lr=bt[zn+3],Hn=bt[zn+4],Br=He===0?Rn:In,ti=He===0?lr:Hn;let zr=!1;et&&(mt=Math.sqrt(Math.pow(Rn-lr,2)+Math.pow(In-Hn,2))),Br<de?ti>de&&(wt=Ke(_t,Rn,In,lr,Hn,de),et&&(_t.start=Tt+mt*wt)):Br>Se?ti<Se&&(wt=Ke(_t,Rn,In,lr,Hn,Se),et&&(_t.start=Tt+mt*wt)):yi(_t,Rn,In,kr),ti<de&&Br>=de&&(wt=Ke(_t,Rn,In,lr,Hn,de),zr=!0),ti>Se&&Br<=Se&&(wt=Ke(_t,Rn,In,lr,Hn,Se),zr=!0),!$e&&zr&&(et&&(_t.end=Tt+mt*wt),oe.push(_t),_t=_i(bt)),et&&(Tt+=mt)}let Jt=bt.length-3;const fn=bt[Jt],on=bt[Jt+1],En=He===0?fn:on;En>=de&&En<=Se&&yi(_t,fn,on,bt[Jt+2]),Jt=_t.length-3,$e&&Jt>=3&&(_t[Jt]!==_t[0]||_t[Jt+1]!==_t[1])&&yi(_t,_t[0],_t[1],_t[2]),_t.length&&oe.push(_t)}function _i(bt){const oe=[];return oe.size=bt.size,oe.start=bt.start,oe.end=bt.end,oe}function Lr(bt,oe,de,Se,He,$e){for(const et of bt)ui(et,oe,de,Se,He,$e,!1)}function yi(bt,oe,de,Se){bt.push(oe,de,Se)}function oi(bt,oe,de,Se,He,$e){const et=($e-oe)/(Se-oe);return yi(bt,$e,de+(He-de)*et,1),et}function qi(bt,oe,de,Se,He,$e){const et=($e-de)/(He-de);return yi(bt,oe+(Se-oe)*et,$e,1),et}function Ci(bt,oe){const de=[];for(let Se=0;Se<bt.length;Se++){const He=bt[Se],$e=He.type;let et;if($e==="Point"||$e==="MultiPoint"||$e==="LineString")et=mr(He.geometry,oe);else if($e==="MultiLineString"||$e==="Polygon"){et=[];for(const _t of He.geometry)et.push(mr(_t,oe))}else if($e==="MultiPolygon"){et=[];for(const _t of He.geometry){const Ke=[];for(const mt of _t)Ke.push(mr(mt,oe));et.push(Ke)}}de.push(ar(He.id,$e,et,He.tags))}return de}function mr(bt,oe){const de=[];de.size=bt.size,bt.start!==void 0&&(de.start=bt.start,de.end=bt.end);for(let Se=0;Se<bt.length;Se+=3)de.push(bt[Se]+oe,bt[Se+1],bt[Se+2]);return de}function dr(bt,oe){if(bt.transformed)return bt;const de=1<<bt.z,Se=bt.x,He=bt.y;for(const $e of bt.features){const et=$e.geometry,_t=$e.type;if($e.geometry=[],_t===1)for(let Ke=0;Ke<et.length;Ke+=2)$e.geometry.push(wo(et[Ke],et[Ke+1],oe,de,Se,He));else for(let Ke=0;Ke<et.length;Ke++){const mt=[];for(let wt=0;wt<et[Ke].length;wt+=2)mt.push(wo(et[Ke][wt],et[Ke][wt+1],oe,de,Se,He));$e.geometry.push(mt)}}return bt.transformed=!0,bt}function wo(bt,oe,de,Se,He,$e){return[Math.round(de*(bt*Se-He)),Math.round(de*(oe*Se-$e))]}function Zi(bt,oe,de,Se,He){const $e=oe===He.maxZoom?0:He.tolerance/((1<<oe)*He.extent),et={features:[],numPoints:0,numSimplified:0,numFeatures:bt.length,source:null,x:de,y:Se,z:oe,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0};for(const _t of bt)ko(et,_t,$e,He);return et}function ko(bt,oe,de,Se){const He=oe.geometry,$e=oe.type,et=[];if(bt.minX=Math.min(bt.minX,oe.minX),bt.minY=Math.min(bt.minY,oe.minY),bt.maxX=Math.max(bt.maxX,oe.maxX),bt.maxY=Math.max(bt.maxY,oe.maxY),$e==="Point"||$e==="MultiPoint")for(let _t=0;_t<He.length;_t+=3)et.push(He[_t],He[_t+1]),bt.numPoints++,bt.numSimplified++;else if($e==="LineString")nr(et,He,bt,de,!1,!1);else if($e==="MultiLineString"||$e==="Polygon")for(let _t=0;_t<He.length;_t++)nr(et,He[_t],bt,de,$e==="Polygon",_t===0);else if($e==="MultiPolygon")for(let _t=0;_t<He.length;_t++){const Ke=He[_t];for(let mt=0;mt<Ke.length;mt++)nr(et,Ke[mt],bt,de,!0,mt===0)}if(et.length){let _t=oe.tags||null;if($e==="LineString"&&Se.lineMetrics){_t={};for(const mt in oe.tags)_t[mt]=oe.tags[mt];_t.mapbox_clip_start=He.start/He.size,_t.mapbox_clip_end=He.end/He.size}const Ke={geometry:et,type:$e==="Polygon"||$e==="MultiPolygon"?3:$e==="LineString"||$e==="MultiLineString"?2:1,tags:_t};oe.id!==null&&(Ke.id=oe.id),bt.features.push(Ke)}}function nr(bt,oe,de,Se,He,$e){const et=Se*Se;if(Se>0&&oe.size<(He?et:Se))return void(de.numPoints+=oe.length/3);const _t=[];for(let Ke=0;Ke<oe.length;Ke+=3)(Se===0||oe[Ke+2]>et)&&(de.numSimplified++,_t.push(oe[Ke],oe[Ke+1])),de.numPoints++;He&&function(Ke,mt){let wt=0;for(let Tt=0,Jt=Ke.length,fn=Jt-2;Tt<Jt;fn=Tt,Tt+=2)wt+=(Ke[Tt]-Ke[fn])*(Ke[Tt+1]+Ke[fn+1]);if(wt>0===mt)for(let Tt=0,Jt=Ke.length;Tt<Jt/2;Tt+=2){const fn=Ke[Tt],on=Ke[Tt+1];Ke[Tt]=Ke[Jt-2-Tt],Ke[Tt+1]=Ke[Jt-1-Tt],Ke[Jt-2-Tt]=fn,Ke[Jt-1-Tt]=on}}(_t,$e),bt.push(_t)}const ss={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0};class Vs{constructor(oe,de){const Se=(de=this.options=function($e,et){for(const _t in et)$e[_t]=et[_t];return $e}(Object.create(ss),de)).debug;if(Se&&console.time("preprocess data"),de.maxZoom<0||de.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(de.promoteId&&de.generateId)throw new Error("promoteId and generateId cannot be used together.");let He=function($e,et){const _t=[];if($e.type==="FeatureCollection")for(let Ke=0;Ke<$e.features.length;Ke++)$n(_t,$e.features[Ke],et,Ke);else $n(_t,$e.type==="Feature"?$e:{geometry:$e},et);return _t}(oe,de);this.tiles={},this.tileCoords=[],Se&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",de.indexMaxZoom,de.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),He=function($e,et){const _t=et.buffer/et.extent;let Ke=$e;const mt=yn($e,1,-1-_t,_t,0,-1,2,et),wt=yn($e,1,1-_t,2+_t,0,-1,2,et);return(mt||wt)&&(Ke=yn($e,1,-_t,1+_t,0,-1,2,et)||[],mt&&(Ke=Ci(mt,1).concat(Ke)),wt&&(Ke=Ke.concat(Ci(wt,-1)))),Ke}(He,de),He.length&&this.splitTile(He,0,0,0),Se&&(He.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}splitTile(oe,de,Se,He,$e,et,_t){const Ke=[oe,de,Se,He],mt=this.options,wt=mt.debug;for(;Ke.length;){He=Ke.pop(),Se=Ke.pop(),de=Ke.pop(),oe=Ke.pop();const Tt=1<<de,Jt=io(de,Se,He);let fn=this.tiles[Jt];if(!fn&&(wt>1&&console.time("creation"),fn=this.tiles[Jt]=Zi(oe,de,Se,He,mt),this.tileCoords.push({z:de,x:Se,y:He}),wt)){wt>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",de,Se,He,fn.numFeatures,fn.numPoints,fn.numSimplified),console.timeEnd("creation"));const zr=`z${de}`;this.stats[zr]=(this.stats[zr]||0)+1,this.total++}if(fn.source=oe,$e==null){if(de===mt.indexMaxZoom||fn.numPoints<=mt.indexMaxPoints)continue}else{if(de===mt.maxZoom||de===$e)continue;if($e!=null){const zr=$e-de;if(Se!==et>>zr||He!==_t>>zr)continue}}if(fn.source=null,oe.length===0)continue;wt>1&&console.time("clipping");const on=.5*mt.buffer/mt.extent,En=.5-on,zn=.5+on,Rn=1+on;let In=null,kr=null,lr=null,Hn=null,Br=yn(oe,Tt,Se-on,Se+zn,0,fn.minX,fn.maxX,mt),ti=yn(oe,Tt,Se+En,Se+Rn,0,fn.minX,fn.maxX,mt);oe=null,Br&&(In=yn(Br,Tt,He-on,He+zn,1,fn.minY,fn.maxY,mt),kr=yn(Br,Tt,He+En,He+Rn,1,fn.minY,fn.maxY,mt),Br=null),ti&&(lr=yn(ti,Tt,He-on,He+zn,1,fn.minY,fn.maxY,mt),Hn=yn(ti,Tt,He+En,He+Rn,1,fn.minY,fn.maxY,mt),ti=null),wt>1&&console.timeEnd("clipping"),Ke.push(In||[],de+1,2*Se,2*He),Ke.push(kr||[],de+1,2*Se,2*He+1),Ke.push(lr||[],de+1,2*Se+1,2*He),Ke.push(Hn||[],de+1,2*Se+1,2*He+1)}}getTile(oe,de,Se){oe=+oe,de=+de,Se=+Se;const He=this.options,{extent:$e,debug:et}=He;if(oe<0||oe>24)return null;const _t=1<<oe,Ke=io(oe,de=de+_t&_t-1,Se);if(this.tiles[Ke])return dr(this.tiles[Ke],$e);et>1&&console.log("drilling down to z%d-%d-%d",oe,de,Se);let mt,wt=oe,Tt=de,Jt=Se;for(;!mt&&wt>0;)wt--,Tt>>=1,Jt>>=1,mt=this.tiles[io(wt,Tt,Jt)];return mt&&mt.source?(et>1&&(console.log("found parent tile z%d-%d-%d",wt,Tt,Jt),console.time("drilling down")),this.splitTile(mt.source,wt,Tt,Jt,oe,de,Se),et>1&&console.timeEnd("drilling down"),this.tiles[Ke]?dr(this.tiles[Ke],$e):null):null}}function io(bt,oe,de){return 32*((1<<bt)*de+oe)+bt}function as(bt,oe){const de=bt.tileID.canonical;if(!this._geoJSONIndex)return void oe(null,null);const Se=this._geoJSONIndex.getTile(de.z,de.x,de.y);if(!Se)return void oe(null,null);const He=new nt(Se.features);let $e=je(He);$e.byteOffset===0&&$e.byteLength===$e.buffer.byteLength||($e=new Uint8Array($e)),oe(null,{vectorTile:He,rawData:$e.buffer})}class ls extends fe{constructor(oe,de,Se,He,$e,et){super(oe,de,Se,He,as,et),$e&&(this.loadGeoJSON=$e),this._dynamicIndex=new rt}loadData(oe,de){const Se=oe&&oe.request,He=Se&&Se.collectResourceTiming;this.loadGeoJSON(oe,($e,et)=>{if($e||!et)return de($e);if(typeof et!="object")return de(new Error(`Input data given to '${oe.source}' is not a valid GeoJSON object.`));{try{if(oe.filter){const Ke=r.U(oe.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(Ke.result==="error")throw new Error(Ke.value.map(mt=>`${mt.key}: ${mt.message}`).join(", "));et.features=et.features.filter(mt=>Ke.value.evaluate({zoom:0},mt))}oe.dynamic?(et.type==="Feature"&&(et={type:"FeatureCollection",features:[et]}),oe.append||(this._dynamicIndex.clear(),this.loaded={}),this._dynamicIndex.load(et.features,this.loaded),oe.cluster&&(et.features=this._dynamicIndex.getFeatures())):this.loaded={},this._geoJSONIndex=oe.cluster?new Ut(function({superclusterOptions:Ke,clusterProperties:mt}){if(!mt||!Ke)return Ke;const wt={},Tt={},Jt={accumulated:null,zoom:0},fn={properties:null},on=Object.keys(mt);for(const En of on){const[zn,Rn]=mt[En],In=r.U(Rn),kr=r.U(typeof zn=="string"?[zn,["accumulated"],["get",En]]:zn);wt[En]=In.value,Tt[En]=kr.value}return Ke.map=En=>{fn.properties=En;const zn={};for(const Rn of on)zn[Rn]=wt[Rn].evaluate(Jt,fn);return zn},Ke.reduce=(En,zn)=>{fn.properties=zn;for(const Rn of on)Jt.accumulated=En[Rn],En[Rn]=Tt[Rn].evaluate(Jt,fn)},Ke}(oe)).load(et.features):oe.dynamic?this._dynamicIndex:function(Ke,mt){return new Vs(Ke,mt)}(et,oe.geojsonVtOptions)}catch(Ke){return de(Ke)}const _t={};if(He){const Ke=H(Se);Ke&&(_t.resourceTiming={},_t.resourceTiming[oe.source]=JSON.parse(JSON.stringify(Ke)))}de(null,_t)}})}reloadTile(oe,de){const Se=this.loaded;return Se&&Se[oe.uid]?oe.partial?de(null,void 0):super.reloadTile(oe,de):this.loadTile(oe,de)}loadGeoJSON(oe,de){if(oe.request)r.n(oe.request,de);else{if(typeof oe.data!="string")return de(new Error(`Input data given to '${oe.source}' is not a valid GeoJSON object.`));try{return de(null,JSON.parse(oe.data))}catch{return de(new Error(`Input data given to '${oe.source}' is not a valid GeoJSON object.`))}}}getClusterExpansionZoom(oe,de){try{de(null,this._geoJSONIndex.getClusterExpansionZoom(oe.clusterId))}catch(Se){de(Se)}}getClusterChildren(oe,de){try{de(null,this._geoJSONIndex.getChildren(oe.clusterId))}catch(Se){de(Se)}}getClusterLeaves(oe,de){try{de(null,this._geoJSONIndex.getLeaves(oe.clusterId,oe.limit,oe.offset))}catch(Se){de(Se)}}}class Ao{constructor(oe,de){this.tileID=new r.aG(oe.tileID.overscaledZ,oe.tileID.wrap,oe.tileID.canonical.z,oe.tileID.canonical.x,oe.tileID.canonical.y),this.tileZoom=oe.tileZoom,this.uid=oe.uid,this.zoom=oe.zoom,this.canonical=oe.tileID.canonical,this.pixelRatio=oe.pixelRatio,this.tileSize=oe.tileSize,this.source=oe.source,this.overscaling=this.tileID.overscaleFactor(),this.projection=oe.projection,this.brightness=de}parse(oe,de,Se,He){this.status="parsing";const $e=new r.aG(Se.tileID.overscaledZ,Se.tileID.wrap,Se.tileID.canonical.z,Se.tileID.canonical.x,Se.tileID.canonical.y),et=[],_t=de.familiesBySource[Se.source],Ke=new r.dZ($e,Se.promoteId);return Ke.bucketLayerIDs=[],Ke.is3DTile=!0,r.e9(oe).then(mt=>{if(!mt)return He(new Error("Could not parse tile"));const wt=r.ea(mt,1/r.cc(Se.tileID.canonical)),Tt=mt.json.extensionsUsed&&mt.json.extensionsUsed.includes("MAPBOX_mesh_features")||mt.json.asset.extras&&mt.json.asset.extras.MAPBOX_mesh_features,Jt=mt.json.extensionsUsed&&mt.json.extensionsUsed.includes("EXT_meshopt_compression"),fn=new r.a8(this.zoom,{brightness:this.brightness});for(const on in _t)for(const En of _t[on]){const zn=En[0];Ke.bucketLayerIDs.push(En.map(In=>r.aC(In.id,In.scope))),zn.recalculate(fn,[]);const Rn=new r.eb(En,wt,$e,Tt,Jt,this.brightness,Ke);Tt||(Rn.needsUpload=!0),et.push(Rn),Rn.evaluate(zn)}this.status="done",He(null,{buckets:et,featureIndex:Ke,collisionBoxArray:null,glyphAtlasImage:null,lineAtlas:null,imageAtlas:null,brightness:null})}).catch(mt=>He(new Error(mt.message)))}}class Ts{constructor(oe,de,Se,He,$e,et){this.actor=oe,this.layerIndex=de,this.availableImages=Se,this.brightness=et,this.loading={},this.loaded={}}loadTile(oe,de){const Se=oe.uid,He=this.loading[Se]=new Ao(oe,this.brightness);r.bi(oe.request,($e,et)=>{const _t=!this.loading[Se];return delete this.loading[Se],_t||$e?(He.status="done",_t||(this.loaded[Se]=He),de($e)):et&&et.byteLength!==0?void He.parse(et,this.layerIndex,oe,(Ke,mt)=>{He.status="done",this.loaded=this.loaded||{},this.loaded[Se]=He,Ke||!mt?de(Ke):de(null,mt)}):(He.status="done",this.loaded[Se]=He,de())})}reloadTile(oe,de){const Se=this.loaded,He=oe.uid;if(Se&&Se[He]){const $e=Se[He];$e.projection=oe.projection,$e.brightness=oe.brightness;const et=(_t,Ke)=>{$e.reloadCallback&&(delete $e.reloadCallback,this.loadTile(oe,de)),de(_t,Ke)};$e.status==="parsing"?$e.reloadCallback=et:$e.status==="done"&&this.loadTile(oe,de)}}abortTile(oe,de){const Se=oe.uid;this.loading[Se]&&delete this.loading[Se],de()}removeTile(oe,de){const Se=this.loaded,He=oe.uid;Se&&Se[He]&&delete Se[He],de()}}class oo{constructor(oe){this.self=oe,this.actor=new r.ec(oe,this),this.layerIndexes={},this.availableImages={},this.isSpriteLoaded={},this.imageRasterizer=new r.I,this.projections={},this.defaultProjection=r.bP({name:"mercator"}),this.workerSourceTypes={vector:fe,geojson:ls,"batched-model":Ts},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=(de,Se)=>{if(this.workerSourceTypes[de])throw new Error(`Worker source with name "${de}" already registered.`);this.workerSourceTypes[de]=Se},this.self.registerRTLTextPlugin=de=>{if(r.ed.isParsed())throw new Error("RTL text plugin already registered.");r.ed.applyArabicShaping=de.applyArabicShaping,r.ed.processBidirectionalText=de.processBidirectionalText,r.ed.processStyledBidirectionalText=de.processStyledBidirectionalText}}clearCaches(oe,de,Se){delete this.layerIndexes[oe],delete this.availableImages[oe],delete this.workerSources[oe],delete this.demWorkerSources[oe],delete this.rasterArrayWorkerSource,Se()}checkIfReady(oe,de,Se){Se()}setReferrer(oe,de){this.referrer=de}spriteLoaded(oe,{scope:de,isLoaded:Se}){if(this.isSpriteLoaded[oe]||(this.isSpriteLoaded[oe]={}),this.isSpriteLoaded[oe][de]=Se,this.workerSources[oe]&&this.workerSources[oe][de])for(const He in this.workerSources[oe][de]){const $e=this.workerSources[oe][de][He];for(const et in $e){const _t=$e[et];_t instanceof fe&&(_t.isSpriteLoaded=Se,_t.fire(new r.z("isSpriteLoaded")))}}}setImages(oe,{scope:de,images:Se},He){if(this.availableImages[oe]||(this.availableImages[oe]={}),this.availableImages[oe][de]=Se,this.workerSources[oe]&&this.workerSources[oe][de]){for(const $e in this.workerSources[oe][de]){const et=this.workerSources[oe][de][$e];for(const _t in et)et[_t].availableImages=Se}He()}else He()}setProjection(oe,de){this.projections[oe]=r.bP(de)}setBrightness(oe,de,Se){this.brightness=de,Se()}setLayers(oe,de,Se){this.getLayerIndex(oe,de.scope).replace(de.layers,de.options),Se()}updateLayers(oe,de,Se){this.getLayerIndex(oe,de.scope).update(de.layers,de.removedIds,de.options),Se()}loadTile(oe,de,Se){de.projection=this.projections[oe]||this.defaultProjection,this.getWorkerSource(oe,de.type,de.source,de.scope).loadTile(de,Se)}loadDEMTile(oe,de,Se){this.getDEMWorkerSource(oe,de.source,de.scope).loadTile(de,Se)}decodeRasterArray(oe,de,Se){this.getRasterArrayWorkerSource().decodeRasterArray(de,Se)}reloadTile(oe,de,Se){de.projection=this.projections[oe]||this.defaultProjection,this.getWorkerSource(oe,de.type,de.source,de.scope).reloadTile(de,Se)}abortTile(oe,de,Se){this.getWorkerSource(oe,de.type,de.source,de.scope).abortTile(de,Se)}removeTile(oe,de,Se){this.getWorkerSource(oe,de.type,de.source,de.scope).removeTile(de,Se)}removeSource(oe,de,Se){if(!(this.workerSources[oe]&&this.workerSources[oe][de.scope]&&this.workerSources[oe][de.scope][de.type]&&this.workerSources[oe][de.scope][de.type][de.source]))return;const He=this.workerSources[oe][de.scope][de.type][de.source];delete this.workerSources[oe][de.scope][de.type][de.source],He.removeSource!==void 0?He.removeSource(de,Se):Se()}loadWorkerSource(oe,de,Se){try{this.self.importScripts(de.url),Se()}catch(He){Se(He.toString())}}syncRTLPluginState(oe,de,Se){try{r.ed.setState(de);const He=r.ed.getPluginURL();if(r.ed.isLoaded()&&!r.ed.isParsed()&&He!=null){this.self.importScripts(He);const $e=r.ed.isParsed();Se($e?void 0:new Error(`RTL Text Plugin failed to import scripts from ${He}`),$e)}}catch(He){Se(He.toString())}}setDracoUrl(oe,de){this.dracoUrl=de}getAvailableImages(oe,de){this.availableImages[oe]||(this.availableImages[oe]={});let Se=this.availableImages[oe][de];return Se||(Se=[]),Se}getLayerIndex(oe,de){this.layerIndexes[oe]||(this.layerIndexes[oe]={});let Se=this.layerIndexes[oe][de];return Se||(Se=this.layerIndexes[oe][de]=new te,Se.scope=de),Se}getWorkerSource(oe,de,Se,He){return this.workerSources[oe]||(this.workerSources[oe]={}),this.workerSources[oe][He]||(this.workerSources[oe][He]={}),this.workerSources[oe][He][de]||(this.workerSources[oe][He][de]={}),this.isSpriteLoaded[oe]||(this.isSpriteLoaded[oe]={}),this.workerSources[oe][He][de][Se]||(this.workerSources[oe][He][de][Se]=new this.workerSourceTypes[de]({send:($e,et,_t,Ke,mt,wt)=>{this.actor.send($e,et,_t,oe,mt,wt)},scheduler:this.actor.scheduler},this.getLayerIndex(oe,He),this.getAvailableImages(oe,He),this.isSpriteLoaded[oe][He],void 0,this.brightness)),this.workerSources[oe][He][de][Se]}rasterizeImages(oe,de,Se){const{imageTasks:He,scope:$e}=de,et={};for(const _t in He){const{image:Ke,imageIdWithOptions:mt}=He[_t];et[_t]=this.imageRasterizer.rasterize(mt,Ke,$e,oe)}Se(void 0,et)}removeRasterizedImages(oe,de,Se){const{imageIds:He,scope:$e}=de;this.imageRasterizer.removeImagesFromCacheByIds(He,$e,oe),Se()}getDEMWorkerSource(oe,de,Se){return this.demWorkerSources[oe]||(this.demWorkerSources[oe]={}),this.demWorkerSources[oe][Se]||(this.demWorkerSources[oe][Se]={}),this.demWorkerSources[oe][Se][de]||(this.demWorkerSources[oe][Se][de]=new me),this.demWorkerSources[oe][Se][de]}getRasterArrayWorkerSource(){return this.rasterArrayWorkerSource||(this.rasterArrayWorkerSource=new _e),this.rasterArrayWorkerSource}enforceCacheSizeLimit(oe,de){r.ee(de)}getWorkerPerformanceMetrics(oe,de,Se){Se(void 0,void 0)}}return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope&&(self.worker=new oo(self)),oo}),z(["./shared"],function(r){var H="3.9.2";const Z={create:"create",load:"load",fullLoad:"fullLoad"},K={mark(u){performance.mark(u)},measure(u,t,o){performance.measure(u,t,o)}};function te(u){const t=u.name.split("?")[0];return r.a(t)&&t.includes("mapbox-gl.js")?"javascript":r.a(t)&&t.includes("mapbox-gl.css")?"css":r.b(t)?"fontRange":r.c(t)?"sprite":r.i(t)?"style":r.d(t)?"tilejson":"other"}var le,Te={},pe=function(){if(le)return Te;function u(h){return!t(h)}function t(h){return typeof window>"u"||typeof document>"u"?"not a browser":function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var v,S,I=new Blob([""],{type:"text/javascript"}),L=URL.createObjectURL(I);try{S=new Worker(L),v=!0}catch{v=!1}return S&&S.terminate(),URL.revokeObjectURL(L),v}()?function(){var v=document.createElement("canvas");v.width=v.height=1;var S=v.getContext("2d");if(!S)return!1;var I=S.getImageData(0,0,1,1);return I&&I.width===v.width}()?(o[g=h&&h.failIfMajorPerformanceCaveat]===void 0&&(o[g]=function(v){var S,I=function(L){var D=document.createElement("canvas"),B=Object.create(u.webGLContextAttributes);return B.failIfMajorPerformanceCaveat=L,D.getContext("webgl2",B)}(v);if(!I)return!1;try{S=I.createShader(I.VERTEX_SHADER)}catch{return!1}return!(!S||I.isContextLost())&&(I.shaderSource(S,"void main() {}"),I.compileShader(S),I.getShaderParameter(S,I.COMPILE_STATUS)===!0)}(g)),o[g]?document.documentMode?"insufficient ECMAScript 6 support":void 0:"insufficient WebGL2 support"):"insufficient Canvas/getImageData support":"insufficient worker support";var g}le=1,Te.supported=u,Te.notSupportedReason=t;var o={};return u.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0},Te}();function ge(u,t,o){const h=document.createElement(u);return t!=null&&(h.className=t),o&&o.appendChild(h),h}function fe(u,t,o){const h=document.createElementNS("http://www.w3.org/2000/svg",u);for(const g of Object.keys(t))h.setAttributeNS(null,g,String(t[g]));return o&&o.appendChild(h),h}const me=typeof document<"u"?document.documentElement&&document.documentElement.style:null,_e=me&&me.userSelect!==void 0?"userSelect":"WebkitUserSelect";let Ie;function Ne(){me&&_e&&(Ie=me[_e],me[_e]="none")}function nt(){me&&_e&&(me[_e]=Ie)}function Le(u){u.preventDefault(),u.stopPropagation(),window.removeEventListener("click",Le,!0)}function Pe(){window.addEventListener("click",Le,!0),window.setTimeout(()=>{window.removeEventListener("click",Le,!0)},0)}function rt(u,t){const o=u.getBoundingClientRect();return lt(u,o,t)}function at(u,t){const o=u.getBoundingClientRect(),h=[];for(let g=0;g<t.length;g++)h.push(lt(u,o,t[g]));return h}function Qe(u){return window.InstallTrigger!==void 0&&u.button===2&&u.ctrlKey&&window.navigator.platform.toUpperCase().indexOf("MAC")>=0?0:u.button}function lt(u,t,o){const h=u.offsetWidth===t.width?1:u.offsetWidth/t.width;return new r.P((o.clientX-t.left)*h,(o.clientY-t.top)*h)}const Ct="01",Rt="NO_ACCESS_TOKEN";class Nt{constructor(t,o,h){this._transformRequestFn=t,this._customAccessToken=o,this._silenceAuthErrors=!!h,this._createSkuToken()}_createSkuToken(){const t=function(){let o="";for(let h=0;h<10;h++)o+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",Ct,o].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=t.token,this._skuTokenExpiresAt=t.tokenExpiresAt}_isSkuTokenExpired(){return Date.now()>this._skuTokenExpiresAt}transformRequest(t,o){return this._transformRequestFn&&this._transformRequestFn(t,o)||{url:t}}normalizeStyleURL(t,o){if(!r.f(t))return t;const h=xt(t);return h.params.push(`sdk=js-${H}`),h.path=`/styles/v1${h.path}`,this._makeAPIURL(h,this._customAccessToken||o)}normalizeGlyphsURL(t,o){if(!r.f(t))return t;const h=xt(t);return h.path=`/fonts/v1${h.path}`,this._makeAPIURL(h,this._customAccessToken||o)}normalizeModelURL(t,o){if(!r.f(t))return t;const h=xt(t);return h.path=`/models/v1${h.path}`,this._makeAPIURL(h,this._customAccessToken||o)}normalizeSourceURL(t,o,h,g){if(!r.f(t))return t;const v=xt(t);return v.path=`/v4/${v.authority}.json`,v.params.push("secure"),h&&v.params.push(`language=${h}`),g&&v.params.push(`worldview=${g}`),this._makeAPIURL(v,this._customAccessToken||o)}normalizeIconsetURL(t,o){const h=xt(t);return r.f(t)?(h.path=`/styles/v1${h.path}/iconset.pbf`,this._makeAPIURL(h,this._customAccessToken||o)):gt(h)}normalizeSpriteURL(t,o,h,g){const v=xt(t);return r.f(t)?(v.path=`/styles/v1${v.path}/sprite${o}${h}`,this._makeAPIURL(v,this._customAccessToken||g)):(v.path+=`${o}${h}`,gt(v))}normalizeTileURL(t,o,h){if(this._isSkuTokenExpired()&&this._createSkuToken(),t&&!r.f(t))return t;const g=xt(t);g.path=g.path.replace(/(\.(png|jpg)\d*)(?=$)/,`${o||h&&g.authority!=="raster"&&h===512?"@2x":""}${r.m.supported?".webp":"$1"}`),g.authority==="raster"?g.path=`/${r.e.RASTER_URL_PREFIX}${g.path}`:g.authority==="rasterarrays"?g.path=`/${r.e.RASTERARRAYS_URL_PREFIX}${g.path}`:g.authority==="3dtiles"?g.path=`/${r.e.TILES3D_URL_PREFIX}${g.path}`:(g.path=g.path.replace(/^.+\/v4\//,"/"),g.path=`/${r.e.TILE_URL_VERSION}${g.path}`);const v=this._customAccessToken||function(S){for(const I of S){const L=I.match(/^access_token=(.*)$/);if(L)return L[1]}return null}(g.params)||r.e.ACCESS_TOKEN;return r.e.REQUIRE_ACCESS_TOKEN&&v&&this._skuToken&&g.params.push(`sku=${this._skuToken}`),this._makeAPIURL(g,v)}canonicalizeTileURL(t,o){const h=xt(t);if(!h.path.match(/^(\/v4\/|\/(raster|rasterarrays)\/v1\/)/)||!h.path.match(/\.[\w]+$/))return t;let g="mapbox://";h.path.match(/^\/raster\/v1\//)?g+=`raster/${h.path.replace(`/${r.e.RASTER_URL_PREFIX}/`,"")}`:h.path.match(/^\/rasterarrays\/v1\//)?g+=`rasterarrays/${h.path.replace(`/${r.e.RASTERARRAYS_URL_PREFIX}/`,"")}`:g+=`tiles/${h.path.replace(`/${r.e.TILE_URL_VERSION}/`,"")}`;let v=h.params;return o&&(v=v.filter(S=>!S.match(/^access_token=/))),v.length&&(g+=`?${v.join("&")}`),g}canonicalizeTileset(t,o){const h=!!o&&r.f(o),g=[];for(const v of t.tiles||[])r.h(v)?g.push(this.canonicalizeTileURL(v,h)):g.push(v);return g}_makeAPIURL(t,o){const h="See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes",g=xt(r.e.API_URL);if(t.protocol=g.protocol,t.authority=g.authority,t.protocol==="http"){const v=t.params.indexOf("secure");v>=0&&t.params.splice(v,1)}if(g.path!=="/"&&(t.path=`${g.path}${t.path}`),!r.e.REQUIRE_ACCESS_TOKEN)return gt(t);if(o=o||r.e.ACCESS_TOKEN,!this._silenceAuthErrors){if(!o)throw new Error(`An API access token is required to use Mapbox GL. ${h}`);if(o[0]==="s")throw new Error(`Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). ${h}`)}return t.params=t.params.filter(v=>v.indexOf("access_token")===-1),t.params.push(`access_token=${o||""}`),gt(t)}}const At=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function xt(u){const t=u.match(At);if(!t)throw new Error("Unable to parse URL object");return{protocol:t[1],authority:t[2],path:t[3]||"/",params:t[4]?t[4].split("&"):[]}}function gt(u){const t=u.params.length?`?${u.params.join("&")}`:"";return`${u.protocol}://${u.authority}${u.path}${t}`}const ht="mapbox.eventData";function vt(u){if(!u)return null;const t=u.split(".");if(!t||t.length!==3)return null;try{return JSON.parse(r.j(t[1]))}catch{return null}}class Ve{constructor(t){this.type=t,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null}getStorageKey(t){const o=vt(r.e.ACCESS_TOKEN);let h="";return h=o&&o.u?r.k(o.u):r.e.ACCESS_TOKEN||"",t?`${ht}.${t}:${h}`:`${ht}:${h}`}fetchEventData(){const t=r.s("localStorage"),o=this.getStorageKey(),h=this.getStorageKey("uuid");if(t)try{const g=localStorage.getItem(o);g&&(this.eventData=JSON.parse(g));const v=localStorage.getItem(h);v&&(this.anonId=v)}catch{r.w("Unable to read from LocalStorage")}}saveEventData(){const t=r.s("localStorage"),o=this.getStorageKey(),h=this.getStorageKey("uuid"),g=this.anonId;if(t&&g)try{localStorage.setItem(h,g),Object.keys(this.eventData).length>=1&&localStorage.setItem(o,JSON.stringify(this.eventData))}catch{r.w("Unable to write to LocalStorage")}}processRequests(t){}postEvent(t,o,h,g){if(!r.e.EVENTS_URL)return;const v=xt(r.e.EVENTS_URL);v.params.push(`access_token=${g||r.e.ACCESS_TOKEN||""}`);const S={event:this.type,created:new Date(t).toISOString()},I=o?r.l(S,o):S,L={url:gt(v),headers:{"Content-Type":"text/plain"},body:JSON.stringify([I])};this.pendingRequest=r.p(L,D=>{this.pendingRequest=null,h(D),this.saveEventData(),this.processRequests(g)})}queueRequest(t,o){this.queue.push(t),this.processRequests(o)}}const je=new class extends Ve{constructor(u){super("appUserTurnstile"),this._customAccessToken=u}postTurnstileEvent(u,t){r.e.EVENTS_URL&&r.e.ACCESS_TOKEN&&Array.isArray(u)&&u.some(o=>r.f(o)||r.h(o))&&this.queueRequest(Date.now(),t)}processRequests(u){if(this.pendingRequest||this.queue.length===0)return;this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();const t=vt(r.e.ACCESS_TOKEN),o=t?t.u:r.e.ACCESS_TOKEN;let h=o!==this.eventData.tokenU;r.v(this.anonId)||(this.anonId=r.u(),h=!0);const g=this.queue.shift();if(this.eventData.lastSuccess){const v=new Date(this.eventData.lastSuccess),S=new Date(g),I=(g-this.eventData.lastSuccess)/864e5;h=h||I>=1||I<-1||v.getDate()!==S.getDate()}else h=!0;h?this.postEvent(g,{sdkIdentifier:"mapbox-gl-js",sdkVersion:H,skuId:Ct,"enabled.telemetry":!1,userId:this.anonId},v=>{v||(this.eventData.lastSuccess=g,this.eventData.tokenU=o)},u):this.processRequests()}},it=je.postTurnstileEvent.bind(je),Mt=new class extends Ve{constructor(){super("map.load"),this.success={},this.skuToken=""}postMapLoadEvent(u,t,o,h){this.skuToken=t,this.errorCb=h,r.e.EVENTS_URL&&(o||r.e.ACCESS_TOKEN?this.queueRequest({id:u,timestamp:Date.now()},o):this.errorCb(new Error(Rt)))}processRequests(u){if(this.pendingRequest||this.queue.length===0)return;const{id:t,timestamp:o}=this.queue.shift();t&&this.success[t]||(this.anonId||this.fetchEventData(),r.v(this.anonId)||(this.anonId=r.u()),this.postEvent(o,{sdkIdentifier:"mapbox-gl-js",sdkVersion:H,skuId:Ct,skuToken:this.skuToken,userId:this.anonId},h=>{h?this.errorCb(h):t&&(this.success[t]=!0)},u))}remove(){this.errorCb=null}},Ot=Mt.postMapLoadEvent.bind(Mt),sn=new class extends Ve{constructor(){super("style.load"),this.eventIdPerMapInstanceMap=new Map,this.mapInstanceIdMap=new WeakMap}getMapInstanceId(u){let t=this.mapInstanceIdMap.get(u);return t||(t=r.u(),this.mapInstanceIdMap.set(u,t)),t}getEventId(u){const t=this.eventIdPerMapInstanceMap.get(u)||0;return this.eventIdPerMapInstanceMap.set(u,t+1),t}postStyleLoadEvent(u,t){const{map:o,style:h,importedStyles:g}=t;if(!r.e.EVENTS_URL||!u&&!r.e.ACCESS_TOKEN)return;const v=this.getMapInstanceId(o),S={mapInstanceId:v,eventId:this.getEventId(v),style:h};g.length&&(S.importedStyles=g),this.queueRequest({timestamp:Date.now(),payload:S},u)}processRequests(u){if(this.pendingRequest||this.queue.length===0)return;const{timestamp:t,payload:o}=this.queue.shift();this.postEvent(t,o,()=>{},u)}},hn=sn.postStyleLoadEvent.bind(sn),Tn=new class extends Ve{constructor(){super("gljs.performance")}postPerformanceEvent(u,t){r.e.EVENTS_URL&&(u||r.e.ACCESS_TOKEN)&&this.queueRequest({timestamp:Date.now(),performanceData:t},u)}processRequests(u){if(this.pendingRequest||this.queue.length===0)return;const{timestamp:t,performanceData:o}=this.queue.shift(),h=function(g){const v=performance.getEntriesByType("resource"),S=performance.getEntriesByType("mark"),I=function(G){const re={};if(G){for(const Q in G)if(Q!=="other")for(const ue of G[Q]){const ce=`${Q}ResolveRangeMin`,ye=`${Q}ResolveRangeMax`,Ae=`${Q}RequestCount`,Ee=`${Q}RequestCachedCount`;re[ce]=Math.min(re[ce]||1/0,ue.startTime),re[ye]=Math.max(re[ye]||-1/0,ue.responseEnd);const Fe=ze=>{re[ze]===void 0&&(re[ze]=0),++re[ze]};ue.transferSize!==void 0&&ue.transferSize===0&&Fe(Ee),Fe(Ae)}}return re}(function(G,re){const Q={};if(G)for(const ue of G){const ce=re(ue);Q[ce]===void 0&&(Q[ce]=[]),Q[ce].push(ue)}return Q}(v,te)),L=window.devicePixelRatio,D=navigator.connection||navigator.mozConnection||navigator.webkitConnection,B=D?D.effectiveType:void 0,V={counters:[],metadata:[],attributes:[]},U=(G,re,Q)=>{Q!=null&&G.push({name:re,value:Q.toString()})};for(const G in I)U(V.counters,G,I[G]);if(g.interactionRange[0]!==1/0&&g.interactionRange[1]!==-1/0&&(U(V.counters,"interactionRangeMin",g.interactionRange[0]),U(V.counters,"interactionRangeMax",g.interactionRange[1])),S)for(const G of Object.keys(Z)){const re=Z[G],Q=S.find(ue=>ue.name===re);Q&&U(V.counters,re,Q.startTime)}return U(V.counters,"visibilityHidden",g.visibilityHidden),U(V.attributes,"style",function(G){if(G)for(const re of G){const Q=re.name.split("?")[0];if(r.i(Q)){const ue=Q.split("/").slice(-2);if(ue.length===2)return`mapbox://styles/${ue[0]}/${ue[1]}`}}}(v)),U(V.attributes,"terrainEnabled",g.terrainEnabled?"true":"false"),U(V.attributes,"fogEnabled",g.fogEnabled?"true":"false"),U(V.attributes,"projection",g.projection),U(V.attributes,"zoom",g.zoom),U(V.metadata,"devicePixelRatio",L),U(V.metadata,"connectionEffectiveType",B),U(V.metadata,"navigatorUserAgent",navigator.userAgent),U(V.metadata,"screenWidth",window.screen.width),U(V.metadata,"screenHeight",window.screen.height),U(V.metadata,"windowWidth",window.innerWidth),U(V.metadata,"windowHeight",window.innerHeight),U(V.metadata,"mapWidth",g.width/L),U(V.metadata,"mapHeight",g.height/L),U(V.metadata,"webglRenderer",g.renderer),U(V.metadata,"webglVendor",g.vendor),U(V.metadata,"sdkVersion",H),U(V.metadata,"sdkIdentifier","mapbox-gl-js"),V}(o);for(const g of h.metadata);for(const g of h.counters);for(const g of h.attributes);this.postEvent(t,h,()=>{},u)}},Ut=Tn.postPerformanceEvent.bind(Tn),bn=new class extends Ve{constructor(){super("map.auth"),this.success={},this.skuToken=""}getSession(u,t,o,h){if(!r.e.API_URL||!r.e.SESSION_PATH)return;const g=xt(r.e.API_URL+r.e.SESSION_PATH);g.params.push(`sku=${t||""}`),g.params.push(`access_token=${h||r.e.ACCESS_TOKEN||""}`);const v={url:gt(g),headers:{"Content-Type":"text/plain"}};this.pendingRequest=r.g(v,S=>{this.pendingRequest=null,o(S),this.saveEventData(),this.processRequests(h)})}getSessionAPI(u,t,o,h){this.skuToken=t,this.errorCb=h,r.e.SESSION_PATH&&r.e.API_URL&&(o||r.e.ACCESS_TOKEN?this.queueRequest({id:u,timestamp:Date.now()},o):this.errorCb(new Error(Rt)))}processRequests(u){if(this.pendingRequest||this.queue.length===0)return;const{id:t,timestamp:o}=this.queue.shift();t&&this.success[t]||this.getSession(o,this.skuToken,h=>{h?this.errorCb(h):t&&(this.success[t]=!0)},u)}remove(){this.errorCb=null}},Re=bn.getSessionAPI.bind(bn),Hr=new Set;function Nr(u,t){t?Hr.add(u):Hr.delete(u)}class Ar{constructor(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps=new Set,this._updatedImages=new Set}isDirty(){return this._changed}setDirty(){this._changed=!0}getUpdatedSourceCaches(){return this._updatedSourceCaches}updateSourceCache(t,o){this._updatedSourceCaches[t]=o,this.setDirty()}discardSourceCacheUpdate(t){delete this._updatedSourceCaches[t]}updateLayer(t){const o=t.scope;this._updatedLayers[o]=this._updatedLayers[o]||new Set,this._updatedLayers[o].add(t.id),this.setDirty()}removeLayer(t){const o=t.scope;this._removedLayers[o]=this._removedLayers[o]||{},this._updatedLayers[o]=this._updatedLayers[o]||new Set,this._removedLayers[o][t.id]=t,this._updatedLayers[o].delete(t.id),this._updatedPaintProps.delete(t.fqid),this.setDirty()}getRemovedLayer(t){return this._removedLayers[t.scope]?this._removedLayers[t.scope][t.id]:null}discardLayerRemoval(t){this._removedLayers[t.scope]&&delete this._removedLayers[t.scope][t.id]}getLayerUpdatesByScope(){const t={};for(const o in this._updatedLayers)t[o]=t[o]||{},t[o].updatedIds=Array.from(this._updatedLayers[o].values());for(const o in this._removedLayers)t[o]=t[o]||{},t[o].removedIds=Object.keys(this._removedLayers[o]);return t}getUpdatedPaintProperties(){return this._updatedPaintProps}updatePaintProperties(t){this._updatedPaintProps.add(t.fqid),this.setDirty()}getUpdatedImages(){return Array.from(this._updatedImages.values())}updateImage(t){this._updatedImages.add(t),this.setDirty()}resetUpdatedImages(){this._updatedImages.clear()}reset(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps.clear(),this._updatedImages.clear()}}function Ht(u){const{userImage:t}=u;return!!(t&&t.render&&t.render())&&(u.data.replace(new Uint8Array(t.data.buffer)),!0)}class Wr extends r.E{constructor(t){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded={},this.requestors=[],this.patterns={},this.atlasImage={},this.atlasTexture={},this.dirty=!0,this.spriteFormat=t,t!=="raster"&&r.t()&&(this.imageRasterizerDispatcher=new r.D(r.x(),this,"Image Rasterizer Worker",1))}get imageRasterizer(){return this._imageRasterizer||(this._imageRasterizer=new r.I),this._imageRasterizer}createScope(t){this.images[t]={},this.loaded[t]=!1,this.updatedImages[t]={},this.patterns[t]={},this.callbackDispatchedThisFrame[t]={},this.atlasImage[t]=new r.r({width:1,height:1})}isLoaded(){for(const t in this.loaded)if(!this.loaded[t])return!1;return!0}setLoaded(t,o){if(this.loaded[o]!==t&&(this.loaded[o]=t,t)){for(const{ids:h,callback:g}of this.requestors)this._notify(h,o,g);this.requestors=[]}}hasImage(t,o){return!!this.getImage(t,o)}getImage(t,o){return this.images[o][t]}addImage(t,o,h){this._validate(t,h)&&(this.images[o][t]=h)}_validate(t,o){let h=!0;return this._validateStretch(o.stretchX,o.data&&o.data.width)||(this.fire(new r.y(new Error(`Image "${t}" has invalid "stretchX" value`))),h=!1),this._validateStretch(o.stretchY,o.data&&o.data.height)||(this.fire(new r.y(new Error(`Image "${t}" has invalid "stretchY" value`))),h=!1),this._validateContent(o.content,o)||(this.fire(new r.y(new Error(`Image "${t}" has invalid "content" value`))),h=!1),h}_validateStretch(t,o){if(!t)return!0;let h=0;for(const g of t){if(g[0]<h||g[1]<g[0]||o<g[1])return!1;h=g[1]}return!0}_validateContent(t,o){return t?t.length!==4||!o.usvg&&(t[0]<0||o.data.width<t[0]||t[1]<0||o.data.height<t[1]||t[2]<0||o.data.width<t[2]||t[3]<0||o.data.height<t[3])?!1:!(t[2]<t[0]||t[3]<t[1]):!0}updateImage(t,o,h){h.version=this.images[o][t].version+1,this.images[o][t]=h,this.updatedImages[o][t]=!0,this.removeFromImageRasterizerCache(t,o)}removeFromImageRasterizerCache(t,o){this.spriteFormat!=="raster"&&(r.t()?this.imageRasterizerDispatcher.getActor().send("removeRasterizedImages",{imageIds:[t],scope:o}):this.imageRasterizer.removeImagesFromCacheByIds([t],o))}removeImage(t,o){const h=this.images[o][t];delete this.images[o][t],delete this.patterns[o][t],this.removeFromImageRasterizerCache(t,o),h.userImage&&h.userImage.onRemove&&h.userImage.onRemove()}listImages(t){return Object.keys(this.images[t])}getImages(t,o,h){let g=!0;const v=!!this.loaded[o];if(!v)for(const S of t)this.images[o][S]||(g=!1);v||g?this._notify(t,o,h):this.requestors.push({ids:t,scope:o,callback:h})}rasterizeImages({scope:t,imageTasks:o},h){const g={};for(const v in o){const S=o[v],I=this.getImage(S.id,t);I&&(g[v]={image:I,imageIdWithOptions:S})}r.t()?this.imageRasterizerDispatcher.getActor().send("rasterizeImages",{imageTasks:g,scope:t},h):this.rasterizeImagesInMainThread({imageTasks:g,scope:t},h)}rasterizeImagesInMainThread(t,o){const{imageTasks:h,scope:g}=t,v={};for(const S in h){const{image:I,imageIdWithOptions:L}=h[S];v[S]=this.imageRasterizer.rasterize(L,I,g,"")}o(void 0,v)}getUpdatedImages(t){return this.updatedImages[t]}_notify(t,o,h){const g={};for(const v of t){this.images[o][v]||this.fire(new r.z("styleimagemissing",{id:v}));const S=this.images[o][v];S?g[v]={data:S.usvg?null:S.data.clone(),pixelRatio:S.pixelRatio,sdf:S.sdf,usvg:S.usvg,version:S.version,stretchX:S.stretchX,stretchY:S.stretchY,content:S.content,hasRenderCallback:!!(S.userImage&&S.userImage.render)}:r.w(`Image "${v}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}h(null,g)}getPixelSize(t){const{width:o,height:h}=this.atlasImage[t];return{width:o,height:h}}getPattern(t,o,h){const g=this.patterns[o][t],v=this.getImage(t,o);if(!v)return null;if(g&&g.position.version===v.version)return g.position;if(g)g.position.version=v.version;else{v.usvg&&!v.data&&(v.data=this.imageRasterizer.rasterize(r.A.from(t).getPrimary(),v,o,""));const S={w:v.data.width+2*r.B,h:v.data.height+2*r.B,x:0,y:0},I=new r.F(S,v,r.B);this.patterns[o][t]={bin:S,position:I}}return this._updatePatternAtlas(o,h),this.patterns[o][t].position}bind(t,o){const h=t.gl;let g=this.atlasTexture[o];g?this.dirty&&(g.update(this.atlasImage[o]),this.dirty=!1):(g=new r.T(t,this.atlasImage[o],h.RGBA8),this.atlasTexture[o]=g),g.bind(h.LINEAR,h.CLAMP_TO_EDGE)}_updatePatternAtlas(t,o){const h=[];for(const I in this.patterns[t])h.push(this.patterns[t][I].bin);const{w:g,h:v}=r.C(h),S=this.atlasImage[t];S.resize({width:g||1,height:v||1});for(const I in this.patterns[t]){const{bin:L,position:D}=this.patterns[t][I];let B=D.padding;const V=L.x+B,U=L.y+B,G=this.images[t][I].data,re=G.width,Q=G.height;B=B>1?B-1:B,r.r.copy(G,S,{x:0,y:0},{x:V,y:U},{width:re,height:Q},o),r.r.copy(G,S,{x:0,y:Q-B},{x:V,y:U-B},{width:re,height:B},o),r.r.copy(G,S,{x:0,y:0},{x:V,y:U+Q},{width:re,height:B},o),r.r.copy(G,S,{x:re-B,y:0},{x:V-B,y:U},{width:B,height:Q},o),r.r.copy(G,S,{x:0,y:0},{x:V+re,y:U},{width:B,height:Q},o),r.r.copy(G,S,{x:re-B,y:Q-B},{x:V-B,y:U-B},{width:B,height:B},o),r.r.copy(G,S,{x:0,y:Q-B},{x:V+re,y:U-B},{width:B,height:B},o),r.r.copy(G,S,{x:0,y:0},{x:V+re,y:U+Q},{width:B,height:B},o),r.r.copy(G,S,{x:re-B,y:0},{x:V-B,y:U+Q},{width:B,height:B},o)}this.dirty=!0}beginFrame(){for(const t in this.images)this.callbackDispatchedThisFrame[t]={}}dispatchRenderCallbacks(t,o){for(const h of t){if(this.callbackDispatchedThisFrame[o][h])continue;this.callbackDispatchedThisFrame[o][h]=!0;const g=this.images[o][h];Ht(g)&&this.updateImage(h,o,g)}}}function ar(u){const t=u.key,o=u.value,h=u.valueSpec||{},g=u.objectElementValidators||{},v=u.style,S=u.styleSpec;let I=[];const L=r.H(o);if(L!=="object")return[new r.V(t,o,`object expected, ${L} found`)];for(const D in o){const B=D.split(".")[0];let V;g[B]?V=g[B]:h[B]?V=nr:g["*"]?V=g["*"]:h["*"]&&(V=nr),V?I=I.concat(V({key:(t&&`${t}.`)+D,value:o[D],valueSpec:h[B]||h["*"],style:v,styleSpec:S,object:o,objectKey:D},o)):I.push(new r.G(t,o[D],`unknown property "${D}"`))}for(const D in h)g[D]||h[D].required&&h[D].default===void 0&&o[D]===void 0&&I.push(new r.V(t,o,`missing required property "${D}"`));return I}function pi(u){const t=u.value,o=u.valueSpec,h=u.style,g=u.styleSpec,v=u.key,S=u.arrayElementValidator||nr;if(r.H(t)!=="array")return[new r.V(v,t,`array expected, ${r.H(t)} found`)];if(o.length&&t.length!==o.length)return[new r.V(v,t,`array length ${o.length} expected, length ${t.length} found`)];if(o["min-length"]&&t.length<o["min-length"])return[new r.V(v,t,`array length at least ${o["min-length"]} expected, length ${t.length} found`)];let I={type:o.value,values:o.values,minimum:o.minimum,maximum:o.maximum,function:void 0};g.$version<7&&(I.function=o.function),r.H(o.value)==="object"&&(I=o.value);let L=[];for(let D=0;D<t.length;D++)L=L.concat(S({array:t,arrayIndex:D,value:t[D],valueSpec:I,style:h,styleSpec:g,key:`${v}[${D}]`},!0));return L}function $n(u){const t=u.key,o=u.value,h=u.valueSpec;let g=r.H(o);if(g==="number"&&o!=o&&(g="NaN"),g!=="number")return[new r.V(t,o,`number expected, ${g} found`)];if("minimum"in h){let v=h.minimum;if(r.H(h.minimum)==="array"&&(v=h.minimum[u.arrayIndex]),o<v)return[new r.V(t,o,`${o} is less than the minimum value ${v}`)]}if("maximum"in h){let v=h.maximum;if(r.H(h.maximum)==="array"&&(v=h.maximum[u.arrayIndex]),o>v)return[new r.V(t,o,`${o} is greater than the maximum value ${v}`)]}return[]}function Gr(u){const t=u.valueSpec,o=r.K(u.value.type);let h,g,v,S={};const I=o!=="categorical"&&u.value.property===void 0,L=!I,D=r.H(u.value.stops)==="array"&&r.H(u.value.stops[0])==="array"&&r.H(u.value.stops[0][0])==="object",B=ar({key:u.key,value:u.value,valueSpec:u.styleSpec.function,style:u.style,styleSpec:u.styleSpec,objectElementValidators:{stops:function(G){if(o==="identity")return[new r.V(G.key,G.value,'identity function may not have a "stops" property')];let re=[];const Q=G.value;return re=re.concat(pi({key:G.key,value:Q,valueSpec:G.valueSpec,style:G.style,styleSpec:G.styleSpec,arrayElementValidator:V})),r.H(Q)==="array"&&Q.length===0&&re.push(new r.V(G.key,Q,"array must have at least one stop")),re},default:function(G){return nr({key:G.key,value:G.value,valueSpec:t,style:G.style,styleSpec:G.styleSpec})}}});return o==="identity"&&I&&B.push(new r.V(u.key,u.value,'missing required property "property"')),o==="identity"||u.value.stops||B.push(new r.V(u.key,u.value,'missing required property "stops"')),o==="exponential"&&u.valueSpec.expression&&!r.L(u.valueSpec)&&B.push(new r.V(u.key,u.value,"exponential functions not supported")),u.styleSpec.$version>=8&&(L&&!r.M(u.valueSpec)?B.push(new r.V(u.key,u.value,"property functions not supported")):I&&!r.N(u.valueSpec)&&B.push(new r.V(u.key,u.value,"zoom functions not supported"))),o!=="categorical"&&!D||u.value.property!==void 0||B.push(new r.V(u.key,u.value,'"property" property is required')),B;function V(G){let re=[];const Q=G.value,ue=G.key;if(r.H(Q)!=="array")return[new r.V(ue,Q,`array expected, ${r.H(Q)} found`)];if(Q.length!==2)return[new r.V(ue,Q,`array length 2 expected, length ${Q.length} found`)];if(D){if(r.H(Q[0])!=="object")return[new r.V(ue,Q,`object expected, ${r.H(Q[0])} found`)];if(Q[0].zoom===void 0)return[new r.V(ue,Q,"object stop key must have zoom")];if(Q[0].value===void 0)return[new r.V(ue,Q,"object stop key must have value")];const ce=r.K(Q[0].zoom);if(typeof ce!="number")return[new r.V(ue,Q[0].zoom,"stop zoom values must be numbers")];if(v&&v>ce)return[new r.V(ue,Q[0].zoom,"stop zoom values must appear in ascending order")];ce!==v&&(v=ce,g=void 0,S={}),re=re.concat(ar({key:`${ue}[0]`,value:Q[0],valueSpec:{zoom:{}},style:G.style,styleSpec:G.styleSpec,objectElementValidators:{zoom:$n,value:U}}))}else re=re.concat(U({key:`${ue}[0]`,value:Q[0],valueSpec:{},style:G.style,styleSpec:G.styleSpec},Q));return r.O(r.Q(Q[1]))?re.concat([new r.V(`${ue}[1]`,Q[1],"expressions are not allowed in function stops.")]):re.concat(nr({key:`${ue}[1]`,value:Q[1],valueSpec:t,style:G.style,styleSpec:G.styleSpec}))}function U(G,re){const Q=r.H(G.value),ue=r.K(G.value),ce=G.value!==null?G.value:re;if(h){if(Q!==h)return[new r.V(G.key,ce,`${Q} stop domain type must match previous stop domain type ${h}`)]}else h=Q;if(Q!=="number"&&Q!=="string"&&Q!=="boolean"&&typeof ue!="number"&&typeof ue!="string"&&typeof ue!="boolean")return[new r.V(G.key,ce,"stop domain value must be a number, string, or boolean")];if(Q!=="number"&&o!=="categorical"){let ye=`number expected, ${Q} found`;return r.M(t)&&o===void 0&&(ye+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new r.V(G.key,ce,ye)]}return o!=="categorical"||Q!=="number"||typeof ue=="number"&&isFinite(ue)&&Math.floor(ue)===ue?o!=="categorical"&&Q==="number"&&typeof ue=="number"&&typeof g=="number"&&g!==void 0&&ue<g?[new r.V(G.key,ce,"stop domain values must appear in ascending order")]:(g=ue,o==="categorical"&&ue in S?[new r.V(G.key,ce,"stop domain values must be unique")]:(S[ue]=!0,[])):[new r.V(G.key,ce,`integer expected, found ${String(ue)}`)]}}function gi(u){const t=(u.expressionContext==="property"?r.S:r.U)(r.Q(u.value),u.valueSpec);if(t.result==="error")return t.value.map(h=>new r.V(`${u.key}${h.key}`,u.value,h.message));const o=t.value.expression||t.value._styleExpression.expression;if(u.expressionContext==="property"&&u.propertyKey==="text-font"&&!o.outputDefined())return[new r.V(u.key,u.value,`Invalid data expression for "${u.propertyKey}". Output values must be contained as literals within the expression.`)];if(u.expressionContext==="property"&&u.propertyType==="layout"&&!r.W(o))return[new r.V(u.key,u.value,'"feature-state" data expressions are not supported with layout properties.')];if(u.expressionContext==="filter")return Pr(o,u);if(u.expressionContext&&u.expressionContext.indexOf("cluster")===0){if(!r.X(o,["zoom","feature-state"]))return[new r.V(u.key,u.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(u.expressionContext==="cluster-initial"&&!r.Y(o))return[new r.V(u.key,u.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function Pr(u,t){const o=new Set(["zoom","feature-state","pitch","distance-from-center"]);if(t.valueSpec&&t.valueSpec.expression)for(const g of t.valueSpec.expression.parameters)o.delete(g);if(o.size===0)return[];const h=[];return u instanceof r.Z&&o.has(u.name)?[new r.V(t.key,t.value,`["${u.name}"] expression is not supported in a filter for a ${t.object.type} layer with id: ${t.object.id}`)]:(u.eachChild(g=>{h.push(...Pr(g,t))}),h)}function ci(u){const t=u.key,o=u.value,h=u.valueSpec,g=[];return Array.isArray(h.values)?h.values.indexOf(r.K(o))===-1&&g.push(new r.V(t,o,`expected one of [${h.values.join(", ")}], ${JSON.stringify(o)} found`)):Object.keys(h.values).indexOf(r.K(o))===-1&&g.push(new r.V(t,o,`expected one of [${Object.keys(h.values).join(", ")}], ${JSON.stringify(o)} found`)),g}function Un(u){return r.$(r.Q(u.value))?gi(r.J({},u,{expressionContext:"filter",valueSpec:u.styleSpec[`filter_${u.layerType||"fill"}`]})):yn(u)}function yn(u){const t=u.value,o=u.key;if(r.H(t)!=="array")return[new r.V(o,t,`array expected, ${r.H(t)} found`)];const h=u.styleSpec;let g,v=[];if(t.length<1)return[new r.V(o,t,"filter array must have at least 1 element")];switch(v=v.concat(ci({key:`${o}[0]`,value:t[0],valueSpec:h.filter_operator,style:u.style,styleSpec:u.styleSpec})),r.K(t[0])){case"<":case"<=":case">":case">=":t.length>=2&&r.K(t[1])==="$type"&&v.push(new r.V(o,t,`"$type" cannot be use with operator "${t[0]}"`));case"==":case"!=":t.length!==3&&v.push(new r.V(o,t,`filter array for operator "${t[0]}" must have 3 elements`));case"in":case"!in":t.length>=2&&(g=r.H(t[1]),g!=="string"&&v.push(new r.V(`${o}[1]`,t[1],`string expected, ${g} found`)));for(let S=2;S<t.length;S++)g=r.H(t[S]),r.K(t[1])==="$type"?v=v.concat(ci({key:`${o}[${S}]`,value:t[S],valueSpec:h.geometry_type,style:u.style,styleSpec:u.styleSpec})):g!=="string"&&g!=="number"&&g!=="boolean"&&v.push(new r.V(`${o}[${S}]`,t[S],`string, number, or boolean expected, ${g} found`));break;case"any":case"all":case"none":for(let S=1;S<t.length;S++)v=v.concat(yn({key:`${o}[${S}]`,value:t[S],style:u.style,styleSpec:u.styleSpec}));break;case"has":case"!has":g=r.H(t[1]),t.length!==2?v.push(new r.V(o,t,`filter array for "${t[0]}" operator must have 2 elements`)):g!=="string"&&v.push(new r.V(`${o}[1]`,t[1],`string expected, ${g} found`))}return v}function Ir(u,t){const o=u.key,h=u.style,g=u.layer,v=u.styleSpec,S=u.value,I=u.objectKey,L=v[`${t}_${u.layerType}`];if(!L)return[];const D=I.match(/^(.*)-use-theme$/);if(t==="paint"&&D&&L[D[1]])return nr({key:o,value:S,valueSpec:{type:"string"},style:h,styleSpec:v});const B=I.match(/^(.*)-transition$/);if(t==="paint"&&B&&L[B[1]]&&L[B[1]].transition)return nr({key:o,value:S,valueSpec:v.transition,style:h,styleSpec:v});const V=u.valueSpec||L[I];if(!V)return[new r.G(o,S,`unknown property "${I}"`)];let U;if(r.H(S)==="string"&&r.M(V)&&!V.tokens&&(U=/^{([^}]+)}$/.exec(S))){const re=`\`{ "type": "identity", "property": ${U?JSON.stringify(U[1]):'"_"'} }\``;return[new r.V(o,S,`"${I}" does not support interpolation syntax
Use an identity property function instead: ${re}.`)]}const G=[];if(u.layerType==="symbol")I!=="text-field"||!h||h.glyphs||h.imports||G.push(new r.V(o,S,'use of "text-field" requires a style "glyphs" property')),I==="text-font"&&r.a0(r.Q(S))&&r.K(S.type)==="identity"&&G.push(new r.V(o,S,'"text-font" does not support identity functions'));else if(u.layerType==="model"&&t==="paint"&&g&&g.layout&&g.layout.hasOwnProperty("model-id")&&r.M(V)&&(r.a1(V)||r.N(V))){const re=r.S(r.Q(S),V),Q=re.value.expression||re.value._styleExpression.expression;Q&&!r.X(Q,["measure-light"])&&(I==="model-emissive-strength"&&r.Y(Q)&&r.W(Q)||G.push(new r.V(o,S,`${I} does not support measure-light expressions when the model layer source is vector tile or GeoJSON.`)))}return G.concat(nr({key:u.key,value:S,valueSpec:V,style:h,styleSpec:v,expressionContext:"property",propertyType:t,propertyKey:I}))}function ui(u){return Ir(u,"paint")}function _i(u){return Ir(u,"layout")}function Lr(u){let t=[];const o=u.value,h=u.key,g=u.style,v=u.styleSpec;o.type||o.ref||t.push(new r.V(h,o,'either "type" or "ref" is required'));let S=r.K(o.type);const I=r.K(o.ref);if(o.id){const L=r.K(o.id);for(let D=0;D<u.arrayIndex;D++){const B=g.layers[D];r.K(B.id)===L&&t.push(new r.V(h,o.id,`duplicate layer id "${o.id}", previously used at line ${B.id.__line__}`))}}if("ref"in o){let L;["type","source","source-layer","filter","layout"].forEach(D=>{D in o&&t.push(new r.V(h,o[D],`"${D}" is prohibited for ref layers`))}),g.layers.forEach(D=>{r.K(D.id)===I&&(L=D)}),L?L.ref?t.push(new r.V(h,o.ref,"ref cannot reference another ref layer")):S=r.K(L.type):typeof I=="string"&&t.push(new r.V(h,o.ref,`ref layer "${I}" not found`))}else if(S!=="background"&&S!=="sky"&&S!=="slot")if(o.source){const L=g.sources&&g.sources[o.source],D=L&&r.K(L.type);L?D==="vector"&&S==="raster"?t.push(new r.V(h,o.source,`layer "${o.id}" requires a raster source`)):D==="raster"&&S!=="raster"?t.push(new r.V(h,o.source,`layer "${o.id}" requires a vector source`)):D!=="vector"||o["source-layer"]?D==="raster-dem"&&S!=="hillshade"?t.push(new r.V(h,o.source,"raster-dem source can only be used with layer type 'hillshade'.")):D!=="raster-array"||["raster","raster-particle"].includes(S)?S!=="line"||!o.paint||!o.paint["line-gradient"]&&!o.paint["line-trim-offset"]||D==="geojson"&&L.lineMetrics?S==="raster-particle"&&D!=="raster-array"&&t.push(new r.V(h,o.source,`layer "${o.id}" requires a 'raster-array' source.`)):t.push(new r.V(h,o,`layer "${o.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):t.push(new r.V(h,o.source,"raster-array source can only be used with layer type 'raster'.")):t.push(new r.V(h,o,`layer "${o.id}" must specify a "source-layer"`)):t.push(new r.V(h,o.source,`source "${o.source}" not found`))}else t.push(new r.V(h,o,'missing required property "source"'));return t=t.concat(ar({key:h,value:o,valueSpec:v.layer,style:u.style,styleSpec:u.styleSpec,objectElementValidators:{"*":()=>[],type:()=>nr({key:`${h}.type`,value:o.type,valueSpec:v.layer.type,style:u.style,styleSpec:u.styleSpec,object:o,objectKey:"type"}),filter:L=>Un(r.J({layerType:S},L)),layout:L=>ar({layer:o,key:L.key,value:L.value,valueSpec:{},style:L.style,styleSpec:L.styleSpec,objectElementValidators:{"*":D=>_i(r.J({layerType:S},D))}}),paint:L=>ar({layer:o,key:L.key,value:L.value,valueSpec:{},style:L.style,styleSpec:L.styleSpec,objectElementValidators:{"*":D=>ui(r.J({layerType:S,layer:o},D))}})}})),t}function yi(u){const t=u.value,o=u.key,h=r.H(t);return h!=="string"?[new r.V(o,t,`string expected, ${h} found`)]:[]}const oi={promoteId:function({key:u,value:t}){if(r.H(t)==="string")return yi({key:u,value:t});{const o=[];for(const h in t)o.push(...yi({key:`${u}.${h}`,value:t[h]}));return o}}};function qi(u){const t=u.value,o=u.key,h=u.styleSpec,g=u.style;if(!t.type)return[new r.V(o,t,'"type" is required')];const v=r.K(t.type);let S=[];switch(["vector","raster","raster-dem","raster-array"].includes(v)&&(t.url||t.tiles||S.push(new r.G(o,t,'Either "url" or "tiles" is required.'))),v){case"vector":case"raster":case"raster-dem":case"raster-array":return S=S.concat(ar({key:o,value:t,valueSpec:h[`source_${v.replace("-","_")}`],style:u.style,styleSpec:h,objectElementValidators:oi})),S;case"geojson":if(S=ar({key:o,value:t,valueSpec:h.source_geojson,style:g,styleSpec:h,objectElementValidators:oi}),t.cluster)for(const I in t.clusterProperties){const[L,D]=t.clusterProperties[I],B=typeof L=="string"?[L,["accumulated"],["get",I]]:L;S.push(...gi({key:`${o}.${I}.map`,value:D,expressionContext:"cluster-map"})),S.push(...gi({key:`${o}.${I}.reduce`,value:B,expressionContext:"cluster-reduce"}))}return S;case"video":return ar({key:o,value:t,valueSpec:h.source_video,style:g,styleSpec:h});case"image":return ar({key:o,value:t,valueSpec:h.source_image,style:g,styleSpec:h});case"canvas":return[new r.V(o,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return ci({key:`${o}.type`,value:t.type,valueSpec:{values:Ci(h)},style:g,styleSpec:h})}}function Ci(u){return u.source.reduce((t,o)=>{const h=u[o];return h.type.type==="enum"&&(t=t.concat(Object.keys(h.type.values))),t},[])}function mr(u){const t=u.value,o=u.styleSpec,h=o.light,g=u.style;let v=[];const S=r.H(t);if(t===void 0)return v;if(S!=="object")return v=v.concat([new r.V("light",t,`object expected, ${S} found`)]),v;for(const I in t){const L=I.match(/^(.*)-transition$/),D=I.match(/^(.*)-use-theme$/);v=v.concat(D&&h[D[1]]?nr({key:I,value:t[I],valueSpec:{type:"string"},style:g,styleSpec:o}):L&&h[L[1]]&&h[L[1]].transition?nr({key:I,value:t[I],valueSpec:o.transition,style:g,styleSpec:o}):h[I]?nr({key:I,value:t[I],valueSpec:h[I],style:g,styleSpec:o}):[new r.V(I,t[I],`unknown property "${I}"`)])}return v}function dr(u){const t=u.value;let o=[];if(!t)return o;const h=r.H(t);if(h!=="object")return o=o.concat([new r.V("light-3d",t,`object expected, ${h} found`)]),o;const g=u.styleSpec,v=g["light-3d"],S=u.key,I=u.style,L=u.style.lights;for(const V of["type","id"])if(!(V in t))return o=o.concat([new r.V("light-3d",t,`missing property ${V} on light`)]),o;if(t.type&&L)for(let V=0;V<u.arrayIndex;V++){const U=r.K(t.type),G=L[V];r.K(G.type)===U&&o.push(new r.V(S,t.id,`duplicate light type "${t.type}", previously defined at line ${G.id.__line__}`))}const D=`properties_light_${t.type}`;if(!(D in g))return o=o.concat([new r.V("light-3d",t,`Invalid light type ${t.type}`)]),o;const B=g[D];for(const V in t)if(V==="properties"){const U=t[V],G=r.H(U);if(G!=="object")return o=o.concat([new r.V("properties",U,`object expected, ${G} found`)]),o;for(const re in U)o=o.concat(B[re]?nr({key:re,value:U[re],valueSpec:B[re],style:I,styleSpec:g}):[new r.G(u.key,U[re],`unknown property "${re}"`)])}else{const U=V.match(/^(.*)-transition$/),G=V.match(/^(.*)-use-theme$/);o=o.concat(G&&v[G[1]]?nr({key:V,value:t[V],valueSpec:{type:"string"},style:I,styleSpec:g}):U&&v[U[1]]&&v[U[1]].transition?nr({key:V,value:t[V],valueSpec:g.transition,style:I,styleSpec:g}):v[V]?nr({key:V,value:t[V],valueSpec:v[V],style:I,styleSpec:g}):[new r.G(V,t[V],`unknown property "${V}"`)])}return o}function wo(u){const t=u.value,o=u.key,h=u.style,g=u.styleSpec,v=g.terrain;let S=[];const I=r.H(t);if(t===void 0||I==="null")return S;if(I!=="object")return S=S.concat([new r.V("terrain",t,`object expected, ${I} found`)]),S;for(const L in t){const D=L.match(/^(.*)-transition$/),B=L.match(/^(.*)-use-theme$/);S=S.concat(B&&v[B[1]]?nr({key:L,value:t[L],valueSpec:{type:"string"},style:h,styleSpec:g}):D&&v[D[1]]&&v[D[1]].transition?nr({key:L,value:t[L],valueSpec:g.transition,style:h,styleSpec:g}):v[L]?nr({key:L,value:t[L],valueSpec:v[L],style:h,styleSpec:g}):[new r.G(L,t[L],`unknown property "${L}"`)])}if(t.source){const L=h.sources&&h.sources[t.source],D=L&&r.K(L.type);L?D!=="raster-dem"&&S.push(new r.V(o,t.source,`terrain cannot be used with a source of type ${String(D)}, it only be used with a "raster-dem" source type`)):S.push(new r.V(o,t.source,`source "${t.source}" not found`))}else S.push(new r.V(o,t,'terrain is missing required property "source"'));return S}function Zi(u){const t=u.value,o=u.style,h=u.styleSpec,g=h.fog;let v=[];const S=r.H(t);if(t===void 0)return v;if(S!=="object")return v=v.concat([new r.V("fog",t,`object expected, ${S} found`)]),v;for(const I in t){const L=I.match(/^(.*)-transition$/),D=I.match(/^(.*)-use-theme$/);v=v.concat(D&&g[D[1]]?nr({key:I,value:t[I],valueSpec:{type:"string"},style:o,styleSpec:h}):L&&g[L[1]]&&g[L[1]].transition?nr({key:I,value:t[I],valueSpec:h.transition,style:o,styleSpec:h}):g[I]?nr({key:I,value:t[I],valueSpec:g[I],style:o,styleSpec:h}):[new r.G(I,t[I],`unknown property "${I}"`)])}return v}const ko={"*":()=>[],array:pi,boolean:function(u){const t=u.value,o=u.key,h=r.H(t);return h!=="boolean"?[new r.V(o,t,`boolean expected, ${h} found`)]:[]},number:$n,color:function(u){const t=u.key,o=u.value,h=r.H(o);return h!=="string"?[new r.V(t,o,`color expected, ${h} found`)]:r._.parseCSSColor(o)===null?[new r.V(t,o,`color expected, "${o}" found`)]:[]},enum:ci,filter:Un,function:Gr,layer:Lr,object:ar,source:qi,model:r.a2,light:mr,"light-3d":dr,terrain:wo,fog:Zi,string:yi,formatted:function(u){return yi(u).length===0?[]:gi(u)},resolvedImage:function(u){return yi(u).length===0?[]:gi(u)},projection:function(u){const t=u.value,o=u.styleSpec,h=o.projection,g=u.style;let v=[];const S=r.H(t);if(S==="object")for(const I in t)v=v.concat(nr({key:I,value:t[I],valueSpec:h[I],style:g,styleSpec:o}));else S!=="string"&&(v=v.concat([new r.V("projection",t,`object or string expected, ${S} found`)]));return v},import:function(u){const{value:t,styleSpec:o}=u,{data:h,...g}=t;Object.defineProperty(g,"__line__",{value:t.__line__,enumerable:!1});let v=ar(r.J({},u,{value:g,valueSpec:o.import}));return r.K(g.id)===""&&v.push(new r.V(`${u.key}.id`,g,"import id can't be an empty string")),h&&(v=v.concat(Vs(h,o,{key:`${u.key}.data`}))),v}};function nr(u,t=!1){const o=u.value,h=u.valueSpec,g=u.styleSpec;if(h.expression&&r.a0(r.K(o)))return Gr(u);if(h.expression&&r.O(r.Q(o)))return gi(u);if(h.type&&ko[h.type]){const v=ko[h.type](u);return t===!0&&v.length>0&&r.H(u.value)==="array"?gi(u):v}return ar(r.J({},u,{valueSpec:h.type?g[h.type]:h}))}function ss(u){const t=u.value,o=u.key,h=yi(u);return h.length||(t.indexOf("{fontstack}")===-1&&h.push(new r.V(o,t,'"glyphs" url must include a "{fontstack}" token')),t.indexOf("{range}")===-1&&h.push(new r.V(o,t,'"glyphs" url must include a "{range}" token'))),h}function Vs(u,t=r.a3,o={}){return nr({key:o.key||"",value:u,valueSpec:t.$root,styleSpec:t,style:u,objectElementValidators:{glyphs:ss,"*":()=>[]}})}function io(u,t=r.a3){return _t(Vs(u,t))}const as=u=>_t(qi(u)),ls=u=>_t(mr(u)),Ao=u=>_t(dr(u)),Ts=u=>_t(wo(u)),oo=u=>_t(Zi(u)),bt=u=>_t(function(t){const o=t.value,h=t.style,g=t.styleSpec,v=g.snow;let S=[];const I=r.H(o);if(o===void 0)return S;if(I!=="object")return S=S.concat([new r.V("snow",o,`object expected, ${I} found`)]),S;for(const L in o){const D=L.match(/^(.*)-transition$/);S=S.concat(D&&v[D[1]]&&v[D[1]].transition?nr({key:L,value:o[L],valueSpec:g.transition,style:h,styleSpec:g}):v[L]?nr({key:L,value:o[L],valueSpec:v[L],style:h,styleSpec:g}):[new r.G(L,o[L],`unknown property "${L}"`)])}return S}(u)),oe=u=>_t(function(t){const o=t.value,h=t.style,g=t.styleSpec,v=g.rain;let S=[];const I=r.H(o);if(o===void 0)return S;if(I!=="object")return S=S.concat([new r.V("rain",o,`object expected, ${I} found`)]),S;for(const L in o){const D=L.match(/^(.*)-transition$/);S=S.concat(D&&v[D[1]]&&v[D[1]].transition?nr({key:L,value:o[L],valueSpec:g.transition,style:h,styleSpec:g}):v[L]?nr({key:L,value:o[L],valueSpec:v[L],style:h,styleSpec:g}):[new r.G(L,o[L],`unknown property "${L}"`)])}return S}(u)),de=u=>_t(Lr(u)),Se=u=>_t(Un(u)),He=u=>_t(ui(u)),$e=u=>_t(_i(u)),et=u=>_t(r.a2(u));function _t(u){return u.slice().sort((t,o)=>t.line&&o.line?t.line-o.line:0)}function Ke(u,t){let o=!1;if(t&&t.length)for(const h of t)h instanceof r.G?r.w(h.message):(u.fire(new r.y(new Error(h.message))),o=!0);return o}let mt;class wt extends r.E{constructor(t,o="flat"){super(),this._transitionable=new r.a4(mt||(mt=new r.a5({anchor:new r.a6(r.a3.light.anchor),position:new r.a7(r.a3.light.position),color:new r.a6(r.a3.light.color),intensity:new r.a6(r.a3.light.intensity)}))),this.setLight(t,o),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(t,o,h={}){this._validate(ls,t,h)||(this._transitionable.setTransitionOrValue(t),this.id=o)}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}_validate(t,o,h){return(!h||h.validate!==!1)&&Ke(this,t.call(io,r.l({value:o,style:{glyphs:!0,sprite:!0},styleSpec:r.a3})))}}let Tt=class extends r.E{constructor(u,t,o,h){super(),this.scope=o,this._transitionable=new r.a4(new r.a5({source:new r.a6(r.a3.terrain.source),exaggeration:new r.a6(r.a3.terrain.exaggeration)}),o,h),this._transitionable.setTransitionOrValue(u,h),this._transitioning=this._transitionable.untransitioned(),this.drapeRenderMode=t}get(){return this._transitionable.serialize()}set(u,t){this._transitionable.setTransitionOrValue(u,t)}updateTransitions(u){this._transitioning=this._transitionable.transitioned(u,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(u){this.properties=this._transitioning.possiblyEvaluate(u)}getExaggeration(u){return this._transitioning.possiblyEvaluate(new r.a8(u)).get("exaggeration")}getAttenuationRange(){if(!this.isZoomDependent())return null;const u=this._transitionable._values.exaggeration;if(!u)return null;const t=u.value.expression;if(!t)return null;let o=-1,h=-1,g=1;for(const v of t.zoomStops)g=t.evaluate(new r.a8(v)),g>.01?(o=v,h=-1):h=v;return g<.01&&o>0&&h>o?[o,h]:null}isZoomDependent(){const u=this._transitionable._values.exaggeration;return u!=null&&u.value!=null&&u.value.expression!=null&&u.value.expression instanceof r.a9}};const Jt=45,fn=65,on=.05;function En(u,t,o,h){const g=r.ac(Jt,fn,o),[v,S]=zn(u,h);let I=1-Math.min(1,Math.exp((t-v)/(S-v)*-6));return I*=I*I,I=Math.min(1,1.00747*I),I*g*u.alpha}function zn(u,t){const o=.5/Math.tan(.5*t);return[u.range[0]+o,u.range[1]+o]}function Rn(u,t,o,h,g){const v=r.ab.vec3.transformMat4([],[t,o,h],g.mercatorFogMatrix);return En(u,r.ab.vec3.length(v),g.pitch,g._fov)}function In(u,t,o,h,g,v,S){const I=[[o,h,0],[g,h,0],[g,v,0],[o,v,0]];let L=Number.MAX_VALUE,D=-Number.MAX_VALUE;for(const B of I){const V=r.ab.vec3.transformMat4([],B,t),U=r.ab.vec3.length(V);L=Math.min(L,U),D=Math.max(D,U)}return[En(u,L,S.pitch,S._fov),En(u,D,S.pitch,S._fov)]}class kr extends r.E{constructor(t,o,h,g){super();const v=new r.a5({range:new r.a6(r.a3.fog.range),color:new r.a6(r.a3.fog.color),"color-use-theme":new r.a6({type:"string","property-type":"data-constant",default:"default"}),"high-color":new r.a6(r.a3.fog["high-color"]),"high-color-use-theme":new r.a6({type:"string","property-type":"data-constant",default:"default"}),"space-color":new r.a6(r.a3.fog["space-color"]),"space-color-use-theme":new r.a6({type:"string","property-type":"data-constant",default:"default"}),"horizon-blend":new r.a6(r.a3.fog["horizon-blend"]),"star-intensity":new r.a6(r.a3.fog["star-intensity"]),"vertical-range":new r.a6(r.a3.fog["vertical-range"])});this._transitionable=new r.a4(v,h,new Map(g)),this.set(t,g),this._transitioning=this._transitionable.untransitioned(),this._transform=o,this.properties=new r.ad(v),this.scope=h}get state(){const t=this._transform,o=t.projection.name==="globe",h=r.ae(t.zoom),g=this.properties.get("range"),v=[.5,3];return{range:o?[r.af(v[0],g[0],h),r.af(v[1],g[1],h)]:g,horizonBlend:this.properties.get("horizon-blend"),alpha:this.properties.get("color").a}}get(){return this._transitionable.serialize()}set(t,o,h={}){if(this._validate(oo,t,h))return;const g=r.l({},t);for(const v of Object.keys(r.a3.fog))g[v]===void 0&&(g[v]=r.a3.fog[v].default);this._options=g,this._transitionable.setTransitionOrValue(this._options,o)}getOpacity(t){if(!this._transform.projection.supportsFog)return 0;const o=this.properties&&this.properties.get("color")||1;return(this._transform.projection.name==="globe"?1:r.ac(Jt,fn,t))*o.a}getOpacityAtLatLng(t,o){return this._transform.projection.supportsFog?function(h,g,v){const S=r.aa.fromLngLat(g),I=v.elevation?v.elevation.getAtPointOrZero(S):0;return Rn(h,S.x,S.y,I,v)}(this.state,t,o):0}getOpacityForTile(t){if(!this._transform.projection.supportsFog)return[1,1];const o=this._transform.calculateFogTileMatrix(t.toUnwrapped());return In(this.state,o,0,0,r.ag,r.ag,this._transform)}getOpacityForBounds(t,o,h,g,v){return this._transform.projection.supportsFog?In(this.state,t,o,h,g,v,this._transform):[1,1]}getFovAdjustedRange(t){return this._transform.projection.supportsFog?zn(this.state,t):[0,1]}isVisibleOnFrustum(t){if(!this._transform.projection.supportsFog)return!1;const o=[4,5,6,7];for(const h of o){const g=t.points[h];let v;if(g[2]>=0)v=g;else{const S=t.points[h-4];v=r.ah(S,g,S[2]/(S[2]-g[2]))}if(Rn(this.state,v[0],v[1],0,this._transform)>=on)return!0}return!1}updateConfig(t){this._transitionable.setTransitionOrValue(this._options,new Map(t))}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}_validate(t,o,h){return(!h||h.validate!==!1)&&Ke(this,t.call(io,r.l({value:o,style:{glyphs:!0,sprite:!0},styleSpec:r.a3})))}}let lr,Hn,Br,ti,zr=class extends r.E{constructor(u,t,o,h){super();const g=lr||(lr=new r.a5({density:new r.a6(r.a3.snow.density),intensity:new r.a6(r.a3.snow.intensity),color:new r.a6(r.a3.snow.color),opacity:new r.a6(r.a3.snow.opacity),vignette:new r.a6(r.a3.snow.vignette),"vignette-color":new r.a6(r.a3.snow["vignette-color"]),"center-thinning":new r.a6(r.a3.snow["center-thinning"]),direction:new r.a6(r.a3.snow.direction),"flake-size":new r.a6(r.a3.snow["flake-size"])}));this._transitionable=new r.a4(g,o,new Map(h)),this.set(u,h),this._transitioning=this._transitionable.untransitioned(),this.properties=new r.ad(g),this.scope=o}get state(){const u=this.properties.get("opacity"),t=this.properties.get("color"),o=this.properties.get("direction"),h=r.ai(o[0]),g=-Math.max(r.ai(o[1]),.01),v=[Math.cos(h)*Math.cos(g),Math.sin(h)*Math.cos(g),Math.sin(g)],S=this.properties.get("vignette"),I=this.properties.get("vignette-color");return I.a=S,{density:this.properties.get("density"),intensity:this.properties.get("intensity"),color:new r.aj(t.r,t.g,t.b,t.a*u),direction:v,centerThinning:this.properties.get("center-thinning"),flakeSize:this.properties.get("flake-size"),vignetteColor:I}}get(){return this._transitionable.serialize()}set(u,t,o={}){if(this._validate(bt,u,o))return;const h=r.l({},u);for(const g of Object.keys(r.a3.snow))h[g]===void 0&&(h[g]=r.a3.snow[g].default);this._options=h,this._transitionable.setTransitionOrValue(this._options,t)}updateConfig(u){this._transitionable.setTransitionOrValue(this._options,new Map(u))}updateTransitions(u){this._transitioning=this._transitionable.transitioned(u,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(u){this.properties=this._transitioning.possiblyEvaluate(u)}_validate(u,t,o){return(!o||o.validate!==!1)&&Ke(this,u.call(io,r.l({value:t,style:{glyphs:!0,sprite:!0},styleSpec:r.a3})))}},po=class extends r.E{constructor(u,t,o,h){super();const g=Hn||(Hn=new r.a5({density:new r.a6(r.a3.rain.density),intensity:new r.a6(r.a3.rain.intensity),color:new r.a6(r.a3.rain.color),opacity:new r.a6(r.a3.rain.opacity),vignette:new r.a6(r.a3.rain.vignette),"vignette-color":new r.a6(r.a3.rain["vignette-color"]),"center-thinning":new r.a6(r.a3.rain["center-thinning"]),direction:new r.a6(r.a3.rain.direction),"droplet-size":new r.a6(r.a3.rain["droplet-size"]),"distortion-strength":new r.a6(r.a3.rain["distortion-strength"])}));this._transitionable=new r.a4(g,o,new Map(h)),this.set(u,h),this._transitioning=this._transitionable.untransitioned(),this.properties=new r.ad(g),this.scope=o}get state(){const u=this.properties.get("opacity"),t=this.properties.get("color"),o=this.properties.get("direction"),h=r.ai(o[0]),g=-Math.max(r.ai(o[1]),.01),v=[Math.cos(h)*Math.cos(g),Math.sin(h)*Math.cos(g),Math.sin(g)],S=this.properties.get("vignette-color");return S.a=this.properties.get("vignette"),{density:this.properties.get("density"),intensity:this.properties.get("intensity"),color:new r.aj(t.r,t.g,t.b,t.a*u),direction:v,centerThinning:this.properties.get("center-thinning"),dropletSize:this.properties.get("droplet-size"),distortionStrength:this.properties.get("distortion-strength"),vignetteColor:S}}get(){return this._transitionable.serialize()}set(u,t,o={}){if(this._validate(oe,u,o))return;const h=r.l({},u);for(const g of Object.keys(r.a3.rain))h[g]===void 0&&(h[g]=r.a3.rain[g].default);this._options=h,this._transitionable.setTransitionOrValue(this._options,t)}updateConfig(u){this._transitionable.setTransitionOrValue(this._options,new Map(u))}updateTransitions(u){this._transitioning=this._transitionable.transitioned(u,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(u){this.properties=this._transitioning.possiblyEvaluate(u)}_validate(u,t,o){return(!o||o.validate!==!1)&&Ke(this,u.call(io,r.l({value:t,style:{glyphs:!0,sprite:!0},styleSpec:r.a3})))}};class so extends r.E{constructor(t,o,h,g){super(),this.scope=h,this._options=t,this.properties=new r.ad(o),this._transitionable=new r.a4(o,h,new Map(g)),this._transitionable.setTransitionOrValue(t.properties),this._transitioning=this._transitionable.untransitioned()}updateConfig(t){this._transitionable.setTransitionOrValue(this._options.properties,new Map(t))}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}get(){return this._options.properties=this._transitionable.serialize(),this._options}set(t,o){this._options=t,this._transitionable.setTransitionOrValue(t.properties,o)}shadowsEnabled(){return!!this.properties&&this.properties.get("cast-shadows")===!0}}class ao{constructor(t,o,h,g){this.screenBounds=t,this.cameraPoint=o,this._screenRaycastCache={},this._cameraRaycastCache={},this.isAboveHorizon=h,this.screenGeometry=this.bufferedScreenGeometry(0),this.screenGeometryMercator=this._bufferedScreenMercator(0,g)}static createFromScreenPoints(t,o){let h,g;if(t instanceof r.P||typeof t[0]=="number"){const v=r.P.convert(t);h=[v],g=o.isPointAboveHorizon(v)}else{const v=r.P.convert(t[0]),S=r.P.convert(t[1]);h=[v,S],g=r.al(v,S).every(I=>o.isPointAboveHorizon(I))}return new ao(h,o.getCameraPoint(),g,o)}isPointQuery(){return this.screenBounds.length===1}bufferedScreenGeometry(t){return r.al(this.screenBounds[0],this.screenBounds.length===1?this.screenBounds[0]:this.screenBounds[1],t)}bufferedCameraGeometry(t){const o=this.screenBounds[0],h=this.screenBounds.length===1?this.screenBounds[0].add(new r.P(1,1)):this.screenBounds[1],g=r.al(o,h,0,!1);return this.cameraPoint.y>h.y&&(this.cameraPoint.x>o.x&&this.cameraPoint.x<h.x?g.splice(3,0,this.cameraPoint):this.cameraPoint.x>=h.x?g[2]=this.cameraPoint:this.cameraPoint.x<=o.x&&(g[3]=this.cameraPoint)),r.am(g,t)}bufferedCameraGeometryGlobe(t){const o=this.screenBounds[0],h=this.screenBounds.length===1?this.screenBounds[0].add(new r.P(1,1)):this.screenBounds[1],g=r.al(o,h,t),v=this.cameraPoint.clone();switch(3*((v.y>o.y)+(v.y>h.y))+((v.x>o.x)+(v.x>h.x))){case 0:g[0]=v,g[4]=v.clone();break;case 1:g.splice(1,0,v);break;case 2:g[1]=v;break;case 3:g.splice(4,0,v);break;case 5:g.splice(2,0,v);break;case 6:g[3]=v;break;case 7:g.splice(3,0,v);break;case 8:g[2]=v}return g}containsTile(t,o,h,g=0){const v=t.queryPadding/o._pixelsPerMercatorPixel+1,S=h?this._bufferedCameraMercator(v,o):this._bufferedScreenMercator(v,o);let I=t.tileID.wrap+(S.unwrapped?g:0);const L=S.polygon.map(ue=>r.an(t.tileTransform,ue,I));if(!r.ao(L,0,0,r.ag,r.ag))return;I=t.tileID.wrap+(this.screenGeometryMercator.unwrapped?g:0);const D=this.screenGeometryMercator.polygon.map(ue=>r.ap(t.tileTransform,ue,I)),B=D.map(ue=>new r.P(ue[0],ue[1])),V=o.getFreeCameraOptions().position||new r.aa(0,0,0),U=r.ap(t.tileTransform,V,I),G=D.map(ue=>{const ce=r.ab.vec3.sub(ue,ue,U);return r.ab.vec3.normalize(ce,ce),new r.aq(U,ce)}),re=r.ar(t,1,o.zoom)*o._pixelsPerMercatorPixel;return{queryGeometry:this,tilespaceGeometry:B,tilespaceRays:G,bufferedTilespaceGeometry:L,bufferedTilespaceBounds:(Q=r.as(L),Q.min.x=r.aw(Q.min.x,0,r.ag),Q.min.y=r.aw(Q.min.y,0,r.ag),Q.max.x=r.aw(Q.max.x,0,r.ag),Q.max.y=r.aw(Q.max.y,0,r.ag),Q),tile:t,tileID:t.tileID,pixelToTileUnitsFactor:re};var Q}_bufferedScreenMercator(t,o){const h=Al(t);if(this._screenRaycastCache[h])return this._screenRaycastCache[h];{let g;return g=o.projection.name==="globe"?this._projectAndResample(this.bufferedScreenGeometry(t),o):{polygon:this.bufferedScreenGeometry(t).map(v=>o.pointCoordinate3D(v)),unwrapped:!0},this._screenRaycastCache[h]=g,g}}_bufferedCameraMercator(t,o){const h=Al(t);if(this._cameraRaycastCache[h])return this._cameraRaycastCache[h];{let g;return g=o.projection.name==="globe"?this._projectAndResample(this.bufferedCameraGeometryGlobe(t),o):{polygon:this.bufferedCameraGeometry(t).map(v=>o.pointCoordinate3D(v)),unwrapped:!0},this._cameraRaycastCache[h]=g,g}}_projectAndResample(t,o){const h=function(v,S){const I=r.ab.mat4.multiply([],S.pixelMatrix,S.globeMatrix),L=[0,-r.ax,0,1],D=[0,r.ax,0,1],B=[0,0,0,1];r.ab.vec4.transformMat4(L,L,I),r.ab.vec4.transformMat4(D,D,I),r.ab.vec4.transformMat4(B,B,I);const V=new r.P(L[0]/L[3],L[1]/L[3]),U=new r.P(D[0]/D[3],D[1]/D[3]),G=r.au(v,V)&&L[3]<B[3],re=r.au(v,U)&&D[3]<B[3];if(!G&&!re)return null;const Q=function(Oe,ke,Ge){for(let Ze=1;Ze<Oe.length;Ze++){const ft=cs(ke.pointCoordinate3D(Oe[Ze-1]).x),ct=cs(ke.pointCoordinate3D(Oe[Ze]).x);if(Ge<0){if(ft<ct)return{idx:Ze,t:-ft/(ct-1-ft)}}else if(ct<ft)return{idx:Ze,t:(1-ft)/(ct+1-ft)}}return null}(v,S,G?-1:1);if(!Q)return null;const{idx:ue,t:ce}=Q;let ye=ue>1?zs(v.slice(0,ue),S):[],Ae=ue<v.length?zs(v.slice(ue),S):[];ye=ye.map(Oe=>new r.P(cs(Oe.x),Oe.y)),Ae=Ae.map(Oe=>new r.P(cs(Oe.x),Oe.y));const Ee=[...ye];Ee.length===0&&Ee.push(Ae[Ae.length-1]);const Fe=r.af(Ee[Ee.length-1].y,(Ae.length===0?ye[0]:Ae[0]).y,ce);let ze;return ze=G?[new r.P(0,Fe),new r.P(0,0),new r.P(1,0),new r.P(1,Fe)]:[new r.P(1,Fe),new r.P(1,1),new r.P(0,1),new r.P(0,Fe)],Ee.push(...ze),Ae.length===0?Ee.push(ye[0]):Ee.push(...Ae),{polygon:Ee.map(Oe=>new r.aa(Oe.x,Oe.y)),unwrapped:!1}}(t,o);if(h)return h;const g=function(v,S){let I=!1,L=-1/0,D=0;for(let V=0;V<v.length-1;V++)v[V].x>L&&(L=v[V].x,D=V);for(let V=0;V<v.length-1;V++){const U=(D+V)%(v.length-1),G=v[U],re=v[U+1];Math.abs(G.x-re.x)>.5&&(G.x<re.x?(G.x+=1,U===0&&(v[v.length-1].x+=1)):(re.x+=1,U+1===v.length-1&&(v[0].x+=1)),I=!0)}const B=r.at(S.center.lng);return I&&B<Math.abs(B-1)&&v.forEach(V=>{V.x-=1}),{polygon:v,unwrapped:I}}(zs(t,o).map(v=>new r.P(cs(v.x),v.y)),o);return{polygon:g.polygon.map(v=>new r.aa(v.x,v.y)),unwrapped:g.unwrapped}}}function zs(u,t){return r.av(u,o=>{const h=t.pointCoordinate3D(o);o.x=h.x,o.y=h.y},1/256)}function cs(u){return u<0?1+u%1:u%1}function Al(u){return 100*u|0}function Xs(u,t,o,h,g){const v=function(I,L){if(I)return g(I);if(L){if(u.url&&L.tiles&&u.tiles&&delete u.tiles,L.variants){if(!Array.isArray(L.variants))return g(new Error("variants must be an array"));for(const B of L.variants){if(B==null||typeof B!="object"||B.constructor!==Object)return g(new Error("variant must be an object"));if(!Array.isArray(B.capabilities))return g(new Error("capabilities must be an array"));if(B.capabilities.length===1&&B.capabilities[0]==="meshopt"){L=r.l(L,B);break}}}const D=r.ay(r.l({},L,u),["tilejson","tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding","vector_layers","raster_layers","worldview_options","worldview_default","worldview"]);D.tiles=t.canonicalizeTileset(D,u.url),g(null,D)}},S=function(I,L,D){if(!I)return null;if(!L&&!D)return I;D=D||I.worldview_default;const B=Object.values(I.language||{});if(B.length===0)return null;const V=Object.values(I.worldview||{});if(V.length===0)return null;const U=B.every(re=>re===L),G=V.every(re=>re===D);return U&&G?I:L in(I.language_options||{})||D in(I.worldview_options||{})?null:I.language_options&&I.worldview_options?I:null}(u.data,o,h);return S?r.q.frame(()=>v(null,S)):u.url?r.n(t.transformRequest(t.normalizeSourceURL(u.url,null,o,h),r.R.Source),v):r.q.frame(()=>{const{data:I,...L}=u;v(null,L)})}class lo{constructor(t,o,h){this.bounds=r.az.convert(this.validateBounds(t)),this.minzoom=o||0,this.maxzoom=h||24}validateBounds(t){return Array.isArray(t)&&t.length===4?[Math.max(-180,t[0]),Math.max(-90,t[1]),Math.min(180,t[2]),Math.min(90,t[3])]:[-180,-90,180,90]}contains(t){const o=Math.pow(2,t.z),h=Math.floor(r.at(this.bounds.getWest())*o),g=Math.floor(r.aA(this.bounds.getNorth())*o),v=Math.ceil(r.at(this.bounds.getEast())*o),S=Math.ceil(r.aA(this.bounds.getSouth())*o);return t.x>=h&&t.x<v&&t.y>=g&&t.y<S}}class Il extends r.E{constructor(t,o,h,g){if(super(),this.id=t,this.dispatcher=h,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,r.l(this,r.ay(o,["url","scheme","tileSize","promoteId"])),this._options=r.l({type:"vector"},o),this._collectResourceTiming=!!o.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(g),this._tileWorkers={},this._deduped=new r.aB}load(t){this._loaded=!1,this.fire(new r.z("dataloading",{dataType:"source"}));const o=Array.isArray(this.map._language)?this.map._language.join():this.map._language,h=this.map.getWorldview();this._tileJSONRequest=Xs(this._options,this.map._requestManager,o,h,(g,v)=>{if(this._tileJSONRequest=null,this._loaded=!0,g)o&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${o}`),h&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${h}`),this.fire(new r.y(g));else if(v){if(r.l(this,v),this.hasWorldviews=!!v.worldview_options,v.worldview_default&&(this.worldviewDefault=v.worldview_default),v.vector_layers){this.vectorLayers=v.vector_layers,this.vectorLayerIds=[],this.localizableLayerIds=new Set;for(const S of v.vector_layers)this.vectorLayerIds.push(S.id),v.worldview&&v.worldview[S.source]&&this.localizableLayerIds.add(S.id)}v.bounds&&(this.tileBounds=new lo(v.bounds,this.minzoom,this.maxzoom)),it(v.tiles,this.map._requestManager._customAccessToken),this.fire(new r.z("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new r.z("data",{dataType:"source",sourceDataType:"content"}))}t&&t(g)})}loaded(){return this._loaded}hasTile(t){return!this.tileBounds||this.tileBounds.contains(t.canonical)}onAdd(t){this.map=t,this.load()}reload(){this.cancelTileJSONRequest();const t=r.aC(this.id,this.scope);this.load(()=>this.map.style.clearSource(t))}setTiles(t){return this._options.tiles=t,this.reload(),this}setUrl(t){return this.url=t,this._options.url=t,this.reload(),this}onRemove(t){this.cancelTileJSONRequest()}serialize(){return r.l({},this._options)}loadTile(t,o){const h=t.tileID.canonical.url(this.tiles,this.scheme),g=this.map._requestManager.normalizeTileURL(h),v=this.map._requestManager.transformRequest(g,r.R.Tile),S=this.map.style?this.map.style.getLut(this.scope):null,I=S?{image:S.image.clone()}:null,L={request:v,data:void 0,uid:t.uid,tileID:t.tileID,tileZoom:t.tileZoom,zoom:t.tileID.overscaledZ,maxZoom:this.maxzoom,lut:I,tileSize:this.tileSize*t.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,pixelRatio:r.q.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,isSymbolTile:t.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0,extraShadowCaster:t.isExtraShadowCaster,tessellationStep:this.map._tessellationStep,scaleFactor:this.map.getScaleFactor()};if(this.hasWorldviews&&r.f(h)&&(L.worldview=this.map.getWorldview()||this.worldviewDefault,L.localizableLayerIds=this.localizableLayerIds),L.request.collectResourceTiming=this._collectResourceTiming,t.actor&&t.state!=="expired")t.state==="loading"?t.reloadCallback=o:t.request=t.actor.send("reloadTile",L,D.bind(this));else if(t.actor=this._tileWorkers[g]=this._tileWorkers[g]||this.dispatcher.getActor(),this.dispatcher.ready)t.request=t.actor.send("loadTile",L,D.bind(this),void 0,!0);else{const B=r.aD.call({deduped:this._deduped},L,(V,U)=>{V||!U?D.call(this,V):(L.data={cacheControl:U.cacheControl,expires:U.expires,rawData:U.rawData.slice(0)},t.actor&&t.actor.send("loadTile",L,D.bind(this),void 0,!0))},!0);t.request={cancel:B}}function D(B,V){return delete t.request,t.aborted?o(null):B&&B.status!==404?o(B):(V&&V.resourceTiming&&(t.resourceTiming=V.resourceTiming),this.map._refreshExpiredTiles&&V&&t.setExpiryData(V),t.loadVectorData(V,this.map.painter),r.aE(this.dispatcher),o(null),void(t.reloadCallback&&(this.loadTile(t,t.reloadCallback),t.reloadCallback=null)))}}abortTile(t){t.request&&(t.request.cancel(),delete t.request),t.actor&&t.actor.send("abortTile",{uid:t.uid,type:this.type,source:this.id,scope:this.scope})}unloadTile(t,o){t.actor&&t.actor.send("removeTile",{uid:t.uid,type:this.type,source:this.id,scope:this.scope}),t.destroy()}hasTransition(){return!1}afterUpdate(){this._tileWorkers={}}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}class zo extends r.E{constructor(t,o,h,g){super(),this.id=t,this.dispatcher=h,this.setEventedParent(g),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=r.l({type:"raster"},o),r.l(this,r.ay(o,["url","scheme","tileSize"]))}load(t){this._loaded=!1,this.fire(new r.z("dataloading",{dataType:"source"})),this._tileJSONRequest=Xs(this._options,this.map._requestManager,null,null,(o,h)=>{this._tileJSONRequest=null,this._loaded=!0,o?this.fire(new r.y(o)):h&&(r.l(this,h),h.raster_layers&&(this.rasterLayers=h.raster_layers,this.rasterLayerIds=this.rasterLayers.map(g=>g.id)),h.bounds&&(this.tileBounds=new lo(h.bounds,this.minzoom,this.maxzoom)),it(h.tiles),this.fire(new r.z("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new r.z("data",{dataType:"source",sourceDataType:"content"}))),t&&t(o)})}loaded(){return this._loaded}onAdd(t){this.map=t,this.load()}reload(){this.cancelTileJSONRequest();const t=r.aC(this.id,this.scope);this.load(()=>this.map.style.clearSource(t))}setTiles(t){return this._options.tiles=t,this.reload(),this}setUrl(t){return this.url=t,this._options.url=t,this.reload(),this}onRemove(t){this.cancelTileJSONRequest()}serialize(){return r.l({},this._options)}hasTile(t){return!this.tileBounds||this.tileBounds.contains(t.canonical)}loadTile(t,o){const h=r.q.devicePixelRatio>=2,g=this.map._requestManager.normalizeTileURL(t.tileID.canonical.url(this.tiles,this.scheme),h,this.tileSize);t.request=r.o(this.map._requestManager.transformRequest(g,r.R.Tile),(v,S,I,L)=>(delete t.request,t.aborted?(t.state="unloaded",o(null)):v?(t.state="errored",o(v)):S?(this.map._refreshExpiredTiles&&t.setExpiryData({cacheControl:I,expires:L}),t.setTexture(S,this.map.painter),t.state="loaded",r.aE(this.dispatcher),void o(null)):o(null)))}abortTile(t,o){t.request&&(t.request.cancel(),delete t.request),o&&o()}unloadTile(t,o){t.texture&&t.texture instanceof r.T?(t.destroy(!0),t.texture&&t.texture instanceof r.T&&this.map.painter.saveTileTexture(t.texture)):t.destroy(),o&&o()}hasTransition(){return!1}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}class $o extends zo{constructor(t,o,h,g){super(t,o,h,g),this.type="raster-array",this.maxzoom=22,this._options=r.l({type:"raster-array"},o)}triggerRepaint(t){const o=this.map.painter._terrain,h=this.map.style.getSourceCache(this.id);o&&o.enabled&&h&&o._clearRenderCacheForTile(h.id,t.tileID),this.map.triggerRepaint()}loadTile(t,o){const h=this.map._requestManager.normalizeTileURL(t.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize),g=this.map._requestManager.transformRequest(h,r.R.Tile);t.requestParams=g,t.actor||(t.actor=this.dispatcher.getActor()),t.request=t.fetchHeader(void 0,(v,S,I,L)=>{if(delete t.request,t.aborted)return t.state="unloaded",o(null);if(v)return v.code===20?void 0:(t.state="errored",o(v));this.map._refreshExpiredTiles&&t.setExpiryData({cacheControl:I,expires:L}),t.state="empty",o(null)})}unloadTile(t,o){const h=t.texture;h&&h instanceof r.T?(t.destroy(!0),this.map.painter.saveTileTexture(h)):(t.destroy(),t.flushQueues(),t._isHeaderLoaded=!1,delete t._mrt,delete t.textureDescriptor),t.fbo&&(t.fbo.destroy(),delete t.fbo),delete t.request,delete t.requestParams,delete t.neighboringTiles,t.state="unloaded"}prepareTile(t,o,h){t._isHeaderLoaded&&(t.state!=="empty"&&(t.state="reloading"),t.fetchBand(o,h,(g,v)=>{if(g)return t.state="errored",this.fire(new r.y(g)),void this.triggerRepaint(t);v&&(t.setTexture(v,this.map.painter),t.state="loaded",this.triggerRepaint(t))}))}getInitialBand(t){if(!this.rasterLayers)return 0;const o=this.rasterLayers.find(({id:v})=>v===t),h=o&&o.fields,g=h&&h.bands&&h.bands;return g?g[0]:0}getTextureDescriptor(t,o,h){if(!t)return;const g=o.sourceLayer||this.rasterLayerIds&&this.rasterLayerIds[0];if(!g)return;let v=null;o instanceof r.aH?v=o.paint.get("raster-array-band"):o instanceof r.aI&&(v=o.paint.get("raster-particle-array-band"));const S=v||this.getInitialBand(g);if(S!=null)if(t.textureDescriptor){if(!t.updateNeeded(g,S)||h)return Object.assign({},t.textureDescriptor,{texture:t.texture})}else this.prepareTile(t,g,S)}}const Yo={vector:Il,raster:zo,"raster-dem":class extends zo{constructor(u,t,o,h){super(u,t,o,h),this.type="raster-dem",this.maxzoom=22,this._options=r.l({type:"raster-dem"},t),this.encoding=t.encoding||"mapbox"}loadTile(u,t){const o=this.map._requestManager.normalizeTileURL(u.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize);function h(g,v){g&&(u.state="errored",t(g)),v&&(u.dem=v,u.dem.onDeserialize(),u.needsHillshadePrepare=!0,u.needsDEMTextureUpload=!0,u.state="loaded",t(null))}u.request=r.o(this.map._requestManager.transformRequest(o,r.R.Tile),(function(g,v,S,I){if(delete u.request,u.aborted)u.state="unloaded",t(null);else if(g)u.state="errored",t(g);else if(v){this.map._refreshExpiredTiles&&u.setExpiryData({cacheControl:S,expires:I});const L=ImageBitmap&&v instanceof ImageBitmap&&r.t(),D=1-(v.width-r.aF(v.width))/2;D<1||u.neighboringTiles||(u.neighboringTiles=this._getNeighboringTiles(u.tileID));const B=L?v:r.q.getImageData(v,D),V={uid:u.uid,coord:u.tileID,source:this.id,scope:this.scope,rawImageData:B,encoding:this.encoding,padding:D};u.actor&&u.state!=="expired"||(u.actor=this.dispatcher.getActor(),u.actor.send("loadDEMTile",V,h.bind(this),void 0,!0))}}).bind(this))}_getNeighboringTiles(u){const t=u.canonical,o=Math.pow(2,t.z),h=(t.x-1+o)%o,g=t.x===0?u.wrap-1:u.wrap,v=(t.x+1+o)%o,S=t.x+1===o?u.wrap+1:u.wrap,I={};return I[new r.aG(u.overscaledZ,g,t.z,h,t.y).key]={backfilled:!1},I[new r.aG(u.overscaledZ,S,t.z,v,t.y).key]={backfilled:!1},t.y>0&&(I[new r.aG(u.overscaledZ,g,t.z,h,t.y-1).key]={backfilled:!1},I[new r.aG(u.overscaledZ,u.wrap,t.z,t.x,t.y-1).key]={backfilled:!1},I[new r.aG(u.overscaledZ,S,t.z,v,t.y-1).key]={backfilled:!1}),t.y+1<o&&(I[new r.aG(u.overscaledZ,g,t.z,h,t.y+1).key]={backfilled:!1},I[new r.aG(u.overscaledZ,u.wrap,t.z,t.x,t.y+1).key]={backfilled:!1},I[new r.aG(u.overscaledZ,S,t.z,v,t.y+1).key]={backfilled:!1}),I}},"raster-array":$o,geojson:class extends r.E{constructor(u,t,o,h){super(),this.id=u,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._loaded=!1,this.actor=o.getActor(),this.setEventedParent(h),this._data=t.data,this._options=r.l({},t),this._collectResourceTiming=t.collectResourceTiming,t.maxzoom!==void 0&&(this.maxzoom=t.maxzoom),t.minzoom!==void 0&&(this.minzoom=t.minzoom),t.type&&(this.type=t.type),t.attribution&&(this.attribution=t.attribution),this.promoteId=t.promoteId;const g=r.ag/this.tileSize;this.workerOptions=r.l({source:this.id,scope:this.scope,cluster:t.cluster||!1,geojsonVtOptions:{buffer:(t.buffer!==void 0?t.buffer:128)*g,tolerance:(t.tolerance!==void 0?t.tolerance:.375)*g,extent:r.ag,maxZoom:this.maxzoom,lineMetrics:t.lineMetrics||!1,generateId:t.generateId||!1},superclusterOptions:{maxZoom:t.clusterMaxZoom!==void 0?t.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,t.clusterMinPoints||2),extent:r.ag,radius:(t.clusterRadius!==void 0?t.clusterRadius:50)*g,log:!1,generateId:t.generateId||!1},clusterProperties:t.clusterProperties,filter:t.filter,dynamic:t.dynamic},t.workerOptions)}onAdd(u){this.map=u,this.setData(this._data)}setData(u){return this._data=u,this._updateWorkerData(),this}updateData(u){if(!this._options.dynamic)return this.fire(new r.y(new Error("Can't call updateData on a GeoJSON source with dynamic set to false.")));if(typeof u!="string"&&(u.type==="Feature"&&(u={type:"FeatureCollection",features:[u]}),u.type!=="FeatureCollection"))return this.fire(new r.y(new Error("Data to update should be a feature or a feature collection.")));if(this._coalesce&&typeof u!="string"&&typeof this._data!="string"&&this._data.type==="FeatureCollection"){const t=new Map;for(const o of this._data.features)t.set(o.id,o);for(const o of u.features)t.set(o.id,o);this._data.features=[...t.values()]}else this._data=u;return this._updateWorkerData(!0),this}getClusterExpansionZoom(u,t){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:u,source:this.id,scope:this.scope},t),this}getClusterChildren(u,t){return this.actor.send("geojson.getClusterChildren",{clusterId:u,source:this.id,scope:this.scope},t),this}getClusterLeaves(u,t,o,h){return this.actor.send("geojson.getClusterLeaves",{source:this.id,scope:this.scope,clusterId:u,limit:t,offset:o},h),this}_updateWorkerData(u=!1){if(this._pendingLoad)return void(this._coalesce=!0);this.fire(new r.z("dataloading",{dataType:"source"})),this._loaded=!1;const t=r.l({append:u},this.workerOptions);t.scope=this.scope;const o=this._data;typeof o=="string"?(t.request=this.map._requestManager.transformRequest(r.q.resolveURL(o),r.R.Source),t.request.collectResourceTiming=this._collectResourceTiming):t.data=JSON.stringify(o),this._pendingLoad=this.actor.send(`${this.type}.loadData`,t,(h,g)=>{if(this._loaded=!0,this._pendingLoad=null,h)this.fire(new r.y(h));else{const v={dataType:"source",sourceDataType:this._metadataFired?"content":"metadata"};this._collectResourceTiming&&g&&g.resourceTiming&&g.resourceTiming[this.id]&&(v.resourceTiming=g.resourceTiming[this.id]),u&&(this._partialReload=!0),this.fire(new r.z("data",v)),this._partialReload=!1,this._metadataFired=!0}this._coalesce&&(this._updateWorkerData(u),this._coalesce=!1)})}loaded(){return this._loaded}loadTile(u,t){const o=u.actor?"reloadTile":"loadTile";u.actor=this.actor;const h=this.map.style?this.map.style.getLut(this.scope):null,g=h?{image:h.image.clone()}:null,v=this._partialReload,S={type:this.type,uid:u.uid,tileID:u.tileID,tileZoom:u.tileZoom,zoom:u.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,lut:g,scope:this.scope,pixelRatio:r.q.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,brightness:this.map.style&&this.map.style.getBrightness()||0,scaleFactor:this.map.getScaleFactor(),partial:v};u.request=this.actor.send(o,S,(I,L)=>v&&!L?(u.state="loaded",t(null)):(delete u.request,u.destroy(),u.aborted?t(null):I?t(I):(u.loadVectorData(L,this.map.painter,o==="reloadTile"),t(null))),void 0,o==="loadTile")}abortTile(u){u.request&&(u.request.cancel(),delete u.request),u.aborted=!0}unloadTile(u,t){this.actor.send("removeTile",{uid:u.uid,type:this.type,source:this.id,scope:this.scope}),u.destroy()}onRemove(u){this._pendingLoad&&this._pendingLoad.cancel()}serialize(){return r.l({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}},video:class extends r.aJ{constructor(u,t,o,h){super(u,t,o,h),this.roundZoom=!0,this.type="video",this.options=t}load(){this._loaded=!1;const u=this.options;this.urls=[];for(const t of u.urls)this.urls.push(this.map._requestManager.transformRequest(t,r.R.Source).url);r.aK(this.urls,(t,o)=>{this._loaded=!0,t?this.fire(new r.y(t)):o&&(this.video=o,this.video.loop=!0,this.video.setAttribute("playsinline",""),this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(u){if(this.video){const t=this.video.seekable;u<t.start(0)||u>t.end(0)?this.fire(new r.y(new r.V(`sources.${this.id}`,null,`Playback for this video can be set only between the ${t.start(0)} and ${t.end(0)}-second mark.`))):this.video.currentTime=u}}getVideo(){return this.video}onAdd(u){this.map||(this.map=u,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const u=this.map.painter.context,t=u.gl;this.texture?this.video.paused||(this.texture.bind(t.LINEAR,t.CLAMP_TO_EDGE),t.texSubImage2D(t.TEXTURE_2D,0,0,0,t.RGBA,t.UNSIGNED_BYTE,this.video)):(this.texture=new r.T(u,this.video,t.RGBA8),this.texture.bind(t.LINEAR,t.CLAMP_TO_EDGE),this.width=this.video.videoWidth,this.height=this.video.videoHeight),this._prepareData(u)}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}},image:r.aJ,model:class extends r.E{constructor(u,t,o,h){super(),this.id=u,this.type="model",this.models=[],this._loaded=!1,this._options=t}load(){const u=[];for(const t in this._options.models){const o=this._options.models[t],h=r.aM(this.map._requestManager.transformRequest(o.uri,r.R.Model).url).then(g=>{if(!g)return;const v=r.aN(g),S=new r.aO(t,o.position,o.orientation,v);S.computeBoundsAndApplyParent(),this.models.push(S)}).catch(g=>{this.fire(new r.y(new Error(`Could not load model ${t} from ${o.uri}: ${g.message}`)))});u.push(h)}return Promise.allSettled(u).then(()=>{this._loaded=!0,this.fire(new r.z("data",{dataType:"source",sourceDataType:"metadata"}))}).catch(t=>{this.fire(new r.y(new Error(`Could not load models: ${t.message}`)))})}onAdd(u){this.map=u,this.load()}hasTransition(){return!1}loaded(){return this._loaded}getModels(){return this.models}loadTile(u,t){}serialize(){return{type:"model"}}},"batched-model":class extends r.E{constructor(u,t,o,h){super(),this.type="batched-model",this.id=u,this.tileSize=512,this._options=t,this.tiles=this._options.tiles,this.maxzoom=t.maxzoom||19,this.minzoom=t.minzoom||0,this.roundZoom=!0,this.usedInConflation=!0,this.dispatcher=o,this.reparseOverscaled=!1,this.scheme="xyz",this._loaded=!1,this.setEventedParent(h)}onAdd(u){this.map=u,this.load()}load(u){this._loaded=!1,this.fire(new r.z("dataloading",{dataType:"source"}));const t=Array.isArray(this.map._language)?this.map._language.join():this.map._language,o=this.map.getWorldview();this._tileJSONRequest=Xs(this._options,this.map._requestManager,t,o,(h,g)=>{this._tileJSONRequest=null,this._loaded=!0,h?(t&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${t}`),o&&o.length!==2&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${o}`),this.fire(new r.y(h))):g&&(r.l(this,g),g.bounds&&(this.tileBounds=new lo(g.bounds,this.minzoom,this.maxzoom)),it(g.tiles,this.map._requestManager._customAccessToken),this.fire(new r.z("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new r.z("data",{dataType:"source",sourceDataType:"content"}))),u&&u(h)})}hasTransition(){return!1}hasTile(u){return!this.tileBounds||this.tileBounds.contains(u.canonical)}loaded(){return this._loaded}loadTile(u,t){const o=this.map._requestManager.normalizeTileURL(u.tileID.canonical.url(this.tiles,this.scheme)),h={request:this.map._requestManager.transformRequest(o,r.R.Tile),data:void 0,uid:u.uid,tileID:u.tileID,tileZoom:u.tileZoom,zoom:u.tileID.overscaledZ,tileSize:this.tileSize*u.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,showCollisionBoxes:this.map.showCollisionBoxes,isSymbolTile:u.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0,lut:null,maxZoom:null,promoteId:null,pixelRatio:null,scaleFactor:null};if(u.actor&&u.state!=="expired")if(u.state==="loading")u.reloadCallback=t;else{if(u.buckets){const v=Object.values(u.buckets);for(const S of v)S.dirty=!0;return void(u.state="loaded")}u.request=u.actor.send("reloadTile",h,g.bind(this))}else u.actor=this.dispatcher.getActor(),u.request=u.actor.send("loadTile",h,g.bind(this),void 0,!0);function g(v,S){return u.aborted?t(null):v&&v.status!==404?t(v):(this.map._refreshExpiredTiles&&S&&u.setExpiryData(S),u.loadModelData(S,this.map.painter),u.state="loaded",void t(null))}}serialize(){return r.l({},this._options)}},canvas:class extends r.aJ{constructor(u,t,o,h){super(u,t,o,h),t.coordinates?Array.isArray(t.coordinates)&&t.coordinates.length===4&&!t.coordinates.some(g=>!Array.isArray(g)||g.length!==2||g.some(v=>typeof v!="number"))||this.fire(new r.y(new r.V(`sources.${u}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new r.y(new r.V(`sources.${u}`,null,'missing required property "coordinates"'))),t.animate&&typeof t.animate!="boolean"&&this.fire(new r.y(new r.V(`sources.${u}`,null,'optional "animate" property must be a boolean value'))),t.canvas?typeof t.canvas=="string"||t.canvas instanceof HTMLCanvasElement||this.fire(new r.y(new r.V(`sources.${u}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new r.y(new r.V(`sources.${u}`,null,'missing required property "canvas"'))),this.options=t,this.animate=t.animate===void 0||t.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new r.y(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(u){this.map=u,this.load(),this.canvas&&this.animate&&this.play()}onRemove(u){this.pause()}prepare(){let u=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,u=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,u=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const t=this.map.painter.context;this.texture?!u&&!this._playing||this.texture instanceof r.aL||this.texture.update(this.canvas,{premultiply:!0}):this.texture=new r.T(t,this.canvas,t.gl.RGBA8,{premultiply:!0}),this._prepareData(t)}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const u of[this.canvas.width,this.canvas.height])if(isNaN(u)||u<=0)return!0;return!1}},custom:class extends r.E{constructor(u,t,o,h){super(),this.id=u,this.type="custom",this._dataType="raster",this._dispatcher=o,this._implementation=t,this.setEventedParent(h),this.scheme="xyz",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this._loaded=!1,this.roundZoom=!0,this._implementation||this.fire(new r.y(new Error(`Missing implementation for ${this.id} custom source`))),this._implementation.loadTile||this.fire(new r.y(new Error(`Missing loadTile implementation for ${this.id} custom source`))),this._implementation.bounds&&(this.tileBounds=new lo(this._implementation.bounds,this.minzoom,this.maxzoom)),t.update=this._update.bind(this),t.clearTiles=this._clearTiles.bind(this),t.coveringTiles=this._coveringTiles.bind(this),r.l(this,r.ay(t,["dataType","scheme","minzoom","maxzoom","tileSize","attribution","minTileCacheSize","maxTileCacheSize"]))}serialize(){return r.ay(this,["type","scheme","minzoom","maxzoom","tileSize","attribution"])}load(){this._loaded=!0,this.fire(new r.z("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new r.z("data",{dataType:"source",sourceDataType:"content"}))}loaded(){return this._loaded}onAdd(u){this.map=u,this._loaded=!1,this.fire(new r.z("dataloading",{dataType:"source"})),this._implementation.onAdd&&this._implementation.onAdd(u),this.load()}onRemove(u){this._implementation.onRemove&&this._implementation.onRemove(u)}hasTile(u){if(this._implementation.hasTile){const{x:t,y:o,z:h}=u.canonical;return this._implementation.hasTile({x:t,y:o,z:h})}return!this.tileBounds||this.tileBounds.contains(u.canonical)}loadTile(u,t){const{x:o,y:h,z:g}=u.tileID.canonical,v=new AbortController;u.request=Promise.resolve(this._implementation.loadTile({x:o,y:h,z:g},{signal:v.signal})).then((function(S){return delete u.request,u.aborted?(u.state="unloaded",t(null)):S===void 0?(u.state="errored",t(null)):S===null?(this.loadTileData(u,{width:this.tileSize,height:this.tileSize,data:null}),u.state="loaded",t(null)):function(I){return I instanceof ImageData||I instanceof HTMLCanvasElement||I instanceof ImageBitmap||I instanceof HTMLImageElement}(S)?(this.loadTileData(u,S),u.state="loaded",void t(null)):(u.state="errored",t(new Error(`Can't infer data type for ${this.id}, only raster data supported at the moment`)))}).bind(this)).catch(S=>{S.code!==20&&(u.state="errored",t(S))}),u.request.cancel=()=>v.abort()}loadTileData(u,t){u.setTexture(t,this.map.painter)}unloadTile(u,t){if(u.texture&&u.texture instanceof r.T?(u.destroy(!0),u.texture&&u.texture instanceof r.T&&this.map.painter.saveTileTexture(u.texture)):u.destroy(),this._implementation.unloadTile){const{x:o,y:h,z:g}=u.tileID.canonical;this._implementation.unloadTile({x:o,y:h,z:g})}t&&t()}abortTile(u,t){u.request&&u.request.cancel&&(u.request.cancel(),delete u.request),t&&t()}hasTransition(){return!1}_coveringTiles(){return this.map.transform.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,roundZoom:this.roundZoom}).map(u=>({x:u.canonical.x,y:u.canonical.y,z:u.canonical.z}))}_clearTiles(){const u=r.aC(this.id,this.scope);this.map.style.clearSource(u)}_update(){this.fire(new r.z("data",{dataType:"source",sourceDataType:"content"}))}}},tl=function(u,t,o,h){const g=new Yo[t.type](u,t,o,h);if(g.id!==u)throw new Error(`Expected Source id to be ${u} instead of ${g.id}`);return r.aP(["load","abort","unload","serialize","prepare"],g),g};function ya(u,t,o,h,g=!1){const v=t.sourceCache.transform,S=t.sourceCache.tilesIn(u,t.has3DLayers,g);S.sort(Cs);const I=[];for(const L of S){const D=L.tile.queryRenderedFeatures(t,L,o,h,v,g);Object.keys(D).length&&I.push({wrappedTileID:L.tile.tileID.wrapped().key,queryResults:D})}return I.length===0?{}:function(L){const D={},B={};for(const V of L){const U=V.queryResults,G=V.wrappedTileID,re=B[G]=B[G]||{};for(const Q in U){const ue=U[Q],ce=re[Q]=re[Q]||{},ye=D[Q]=D[Q]||[];for(const Ae of ue)ce[Ae.featureIndex]||(ce[Ae.featureIndex]=!0,ye.push(Ae))}}return D}(I)}function co(u,t,o,h,g){const v={},S=h.queryRenderedSymbols(u),I=[];for(const L of Object.keys(S).map(Number))I.push(g[L]);I.sort(Cs);for(const L of I){const D=L.featureIndex.lookupSymbolFeatures(S[L.bucketInstanceId],L.bucketIndex,L.sourceLayerIndex,t,o);for(const B in D){const V=v[B]=v[B]||[],U=D[B];U.sort((G,re)=>{const Q=L.featureSortOrder;if(Q){const ue=Q.indexOf(G.featureIndex);return Q.indexOf(re.featureIndex)-ue}return re.featureIndex-G.featureIndex});for(const G of U)V.push(G)}}return v}function So(u,t){const o=u.getRenderableIds().map(v=>u.getTileByID(v)),h=[],g={};for(let v=0;v<o.length;v++){const S=o[v],I=S.tileID.canonical.key;g[I]||(g[I]=!0,S.querySourceFeatures(h,t))}return h}function Cs(u,t){const o=u.tileID,h=t.tileID;return o.overscaledZ-h.overscaledZ||o.canonical.y-h.canonical.y||o.wrap-h.wrap||o.canonical.x-h.canonical.x}function Ms(u,t){const o={};if(!t)return o;for(const h of u){const g=h.layerIds.map(v=>t.getLayer(v)).filter(Boolean);if(g.length!==0){h.layers=g,h.stateDependentLayerIds&&(h.stateDependentLayers=h.stateDependentLayerIds.map(v=>g.filter(S=>S.id===v)[0]));for(const v of g)o[v.fqid]=h}}return o}const Vo=32,us=33,mo=new Uint16Array(8184);for(let u=0;u<2046;u++){let t=u+2,o=0,h=0,g=0,v=0,S=0,I=0;for(1&t?g=v=S=Vo:o=h=I=Vo;(t>>=1)>1;){const D=o+g>>1,B=h+v>>1;1&t?(g=o,v=h,o=S,h=I):(o=g,h=v,g=S,v=I),S=D,I=B}const L=4*u;mo[L+0]=o,mo[L+1]=h,mo[L+2]=g,mo[L+3]=v}const Io=new Uint16Array(2178),Uo=new Uint8Array(1089),va=new Uint16Array(1089);function xa(u){return u===0?-.03125:u===32?.03125:0}const hi={type:2,extent:r.ag,loadGeometry:()=>[[new r.P(0,0),new r.P(r.ag+1,0),new r.P(r.ag+1,r.ag+1),new r.P(0,r.ag+1),new r.P(0,0)]]};class As{constructor(t,o,h,g,v){this.tileID=t,this.uid=r.aV(),this.uses=0,this.tileSize=o,this.tileZoom=h,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.isRaster=v,g&&g.style&&(this._lastUpdatedBrightness=g.style.getBrightness()),this.expiredRequestCount=0,this.state="loading",g&&g.transform&&(this.projection=g.transform.projection)}registerFadeDuration(t){const o=t+this.timeAdded;o<r.q.now()||this.fadeEndTime&&o<this.fadeEndTime||(this.fadeEndTime=o)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}get tileTransform(){return this._tileTransform||(this._tileTransform=r.aQ(this.tileID.canonical,this.projection)),this._tileTransform}loadVectorData(t,o,h){if(this.unloadVectorData(),this.state="loaded",t){t.featureIndex&&(this.latestFeatureIndex=t.featureIndex,t.rawTileData?(this.latestRawTileData=t.rawTileData,this.latestFeatureIndex.rawTileData=t.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=t.collisionBoxArray,this.buckets=Ms(t.buckets,o.style),this.hasSymbolBuckets=!1;for(const g in this.buckets){const v=this.buckets[g];if(v instanceof r.aX){if(this.hasSymbolBuckets=!0,!h)break;v.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const g in this.buckets){const v=this.buckets[g];if(v instanceof r.aX&&v.hasRTLText){this.hasRTLText=!0,r.aY();break}}this.queryPadding=0;for(const g in this.buckets){const v=this.buckets[g],S=o.style.getOwnLayer(g);if(!S)continue;const I=S.queryRadius(v);this.queryPadding=Math.max(this.queryPadding,I)}t.imageAtlas&&(this.imageAtlas=t.imageAtlas),t.glyphAtlasImage&&(this.glyphAtlasImage=t.glyphAtlasImage),t.lineAtlas&&(this.lineAtlas=t.lineAtlas),this._lastUpdatedBrightness=t.brightness}else this.collisionBoxArray=new r.aW}unloadVectorData(){if(this.hasData()){for(const t in this.buckets)this.buckets[t].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.lineAtlasTexture&&this.lineAtlasTexture.destroy(),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),this.latestFeatureIndex=null,this.state="unloaded"}}loadModelData(t,o,h){t&&(t.resourceTiming&&(this.resourceTiming=t.resourceTiming),this.buckets={...this.buckets,...Ms(t.buckets,o.style)},t.featureIndex&&(this.latestFeatureIndex=t.featureIndex))}getBucket(t){return this.buckets[t.fqid]}upload(t){for(const g in this.buckets){const v=this.buckets[g];v.uploadPending()&&v.upload(t)}const o=t.gl,h=this.imageAtlas;if(h&&!h.uploaded){const g=!!Object.keys(h.patternPositions).length;this.imageAtlasTexture=new r.T(t,h.image,o.RGBA8,{useMipmap:g}),this.imageAtlas.uploaded=!0}this.glyphAtlasImage&&(this.glyphAtlasTexture=new r.T(t,this.glyphAtlasImage,o.R8),this.glyphAtlasImage=null),this.lineAtlas&&!this.lineAtlas.uploaded&&(this.lineAtlasTexture=new r.T(t,this.lineAtlas.image,o.R8),this.lineAtlas.uploaded=!0)}prepare(t,o,h){if(this.imageAtlas&&this.imageAtlasTexture&&this.imageAtlas.patchUpdatedImages(t,this.imageAtlasTexture,h),!o||!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData)return;const g=o.style.getBrightness();(this._lastUpdatedBrightness||g)&&(this._lastUpdatedBrightness&&g&&Math.abs(this._lastUpdatedBrightness-g)<.001||(this.updateBuckets(o,this._lastUpdatedBrightness!==g),this._lastUpdatedBrightness=g))}queryRenderedFeatures(t,o,h,g,v,S){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData&&!this.latestFeatureIndex.is3DTile)return{};const I=function(L,D){const B=r.ab.mat4.fromScaling([],[.5*L.width,.5*-L.height,1]);return r.ab.mat4.translate(B,B,[1,-1,0]),r.ab.mat4.multiply(B,B,L.calculateProjMatrix(D.toUnwrapped())),Float32Array.from(B)}(v,this.tileID);return this.latestFeatureIndex.query(t,{tilespaceGeometry:o,pixelPosMatrix:I,transform:g,availableImages:h,tileTransform:this.tileTransform})}querySourceFeatures(t,o){const h=this.latestFeatureIndex;if(!h||!h.rawTileData)return;const g=h.loadVTLayers(),v=o?o.sourceLayer:"",S=g._geojsonTileLayer||g[v];if(!S)return;const I=r.aZ(o&&o.filter),{z:L,x:D,y:B}=this.tileID.canonical,V={z:L,x:D,y:B};for(let U=0;U<S.length;U++){const G=S.feature(U);if(I.needGeometry){const ue=r.a_(G,!0);if(!I.filter(new r.a8(this.tileID.overscaledZ),ue,this.tileID.canonical))continue}else if(!I.filter(new r.a8(this.tileID.overscaledZ),G))continue;const re=h.getId(G,v),Q=new r.a$(G,L,D,B,re);Q.tile=V,t.push(Q)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return!!this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(t){const o=this.expirationTime;if(t.cacheControl){const h=r.b0(t.cacheControl);h["max-age"]&&(this.expirationTime=Date.now()+1e3*h["max-age"])}else t.expires&&(this.expirationTime=new Date(t.expires).getTime());if(this.expirationTime){const h=Date.now();let g=!1;if(this.expirationTime>h)g=!1;else if(o)if(this.expirationTime<o)g=!0;else{const v=this.expirationTime-o;v?this.expirationTime=h+Math.max(v,3e4):g=!0}else g=!0;g?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}refreshFeatureState(t){this.latestFeatureIndex&&(this.latestFeatureIndex.rawTileData||this.latestFeatureIndex.is3DTile)&&t&&this.updateBuckets(t)}updateBuckets(t,o){if(!this.latestFeatureIndex||!t.style)return;const h=this.latestFeatureIndex.loadVTLayers(),g=t.style.listImages(),v=t.style.getBrightness();for(const S in this.buckets){if(!t.style.hasLayer(S))continue;const I=this.buckets[S],L=I.layers[0],D=L.sourceLayer||"_geojsonTileLayer",B=h[D],V=t.style.getSourceCache(L.source,L.scope);let U={};V&&(U=V._state.getState(D,void 0));const G=this.imageAtlas&&this.imageAtlas.patternPositions||{},re=Object.keys(U).length>0&&!o;(re&&I.stateDependentLayers.length!==0||o)&&I.update(U,B,g,G,re?I.stateDependentLayers:I.layers,o,v),(I instanceof r.b1||I instanceof r.b2)&&t._terrain&&t._terrain.enabled&&V&&I.programConfigurations.needsUpload&&t._terrain._clearRenderCacheForTile(V.id,this.tileID);const Q=t&&t.style&&t.style.getOwnLayer(S);Q&&(this.queryPadding=Math.max(this.queryPadding,Q.queryRadius(I)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<r.q.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(t){this.symbolFadeHoldUntil=r.q.now()+t}setTexture(t,o){const h=o.context,g=h.gl;this.texture=this.texture||o.getTileTexture(t.width),this.texture&&this.texture instanceof r.T?this.texture.update(t):(this.texture=new r.T(h,t,g.RGBA8,{useMipmap:!0}),this.texture.bind(g.LINEAR,g.CLAMP_TO_EDGE))}setDependencies(t,o){const h={};for(const g of o)h[g]=!0;this.dependencies[t]=h}hasDependency(t,o){for(const h of t){const g=this.dependencies[h];if(g){for(const v of o)if(g[v])return!0}}return!1}clearQueryDebugViz(){}_makeDebugTileBoundsBuffers(t,o){if(!o||o.name==="mercator"||this._tileDebugBuffer)return;const h=r.b3(hi,this.tileID.canonical,this.tileTransform)[0],g=new r.b4,v=new r.b5;for(let S=0;S<h.length;S++){const{x:I,y:L}=h[S];g.emplaceBack(I,L),v.emplaceBack(S)}v.emplaceBack(0),this._tileDebugIndexBuffer=t.createIndexBuffer(v),this._tileDebugBuffer=t.createVertexBuffer(g,r.b6.members),this._tileDebugSegments=r.b7.simpleSegment(0,0,g.length,v.length)}_makeTileBoundsBuffers(t,o){if(this._tileBoundsBuffer||!o||o.name==="mercator")return;const h=r.b3(hi,this.tileID.canonical,this.tileTransform)[0];let g,v;if(this.isRaster){const S=function(I,L){const D=r.aQ(I,L),B=Math.pow(2,I.z);for(let ue=0;ue<us;ue++)for(let ce=0;ce<us;ce++){const ye=r.aR((I.x+(ce+xa(ce))/Vo)/B),Ae=r.aS((I.y+(ue+xa(ue))/Vo)/B),Ee=L.project(ye,Ae),Fe=ue*us+ce;Io[2*Fe+0]=Math.round((Ee.x*D.scale-D.x)*r.ag),Io[2*Fe+1]=Math.round((Ee.y*D.scale-D.y)*r.ag)}Uo.fill(0),va.fill(0);for(let ue=2045;ue>=0;ue--){const ce=4*ue,ye=mo[ce+0],Ae=mo[ce+1],Ee=mo[ce+2],Fe=mo[ce+3],ze=ye+Ee>>1,Oe=Ae+Fe>>1,ke=ze+Oe-Ae,Ge=Oe+ye-ze,Ze=Ae*us+ye,ft=Fe*us+Ee,ct=Oe*us+ze,We=Math.hypot((Io[2*Ze+0]+Io[2*ft+0])/2-Io[2*ct+0],(Io[2*Ze+1]+Io[2*ft+1])/2-Io[2*ct+1])>=16;Uo[ct]=Uo[ct]||(We?1:0),ue<1022&&(Uo[ct]=Uo[ct]||Uo[(Ae+Ge>>1)*us+(ye+ke>>1)]||Uo[(Fe+Ge>>1)*us+(Ee+ke>>1)])}const V=new r.aT,U=new r.aU;let G=0;function re(ue,ce){const ye=ce*us+ue;return va[ye]===0&&(V.emplaceBack(Io[2*ye+0],Io[2*ye+1],ue*r.ag/Vo,ce*r.ag/Vo),va[ye]=++G),va[ye]-1}function Q(ue,ce,ye,Ae,Ee,Fe){const ze=ue+ye>>1,Oe=ce+Ae>>1;if(Math.abs(ue-Ee)+Math.abs(ce-Fe)>1&&Uo[Oe*us+ze])Q(Ee,Fe,ue,ce,ze,Oe),Q(ye,Ae,Ee,Fe,ze,Oe);else{const ke=re(ue,ce),Ge=re(ye,Ae),Ze=re(Ee,Fe);U.emplaceBack(ke,Ge,Ze)}}return Q(0,0,Vo,Vo,Vo,0),Q(Vo,Vo,0,0,0,Vo),{vertices:V,indices:U}}(this.tileID.canonical,o);g=S.vertices,v=S.indices}else{g=new r.aT,v=new r.aU;for(const{x:I,y:L}of h)g.emplaceBack(I,L,0,0);const S=r.b8(g.int16,void 0,4);for(let I=0;I<S.length;I+=3)v.emplaceBack(S[I],S[I+1],S[I+2])}this._tileBoundsBuffer=t.createVertexBuffer(g,r.b9.members),this._tileBoundsIndexBuffer=t.createIndexBuffer(v),this._tileBoundsSegments=r.b7.simpleSegment(0,0,g.length,v.length)}_makeGlobeTileDebugBuffers(t,o){const h=o.projection;if(!h||h.name!=="globe"||o.freezeTileCoverage)return;const g=this.tileID.canonical,v=r.ba(g,o),S=r.bb(v),I=r.ae(o.zoom);let L;I>0&&(L=r.ab.mat4.invert(new Float64Array(16),o.globeMatrix)),this._makeGlobeTileDebugBorderBuffer(t,g,o,S,L,I),this._makeGlobeTileDebugTextBuffer(t,g,o,S,L,I)}_globePoint(t,o,h,g,v,S,I){let L=r.bc(t,o,h);if(S){const D=1<<h.z,B=r.at(g.center.lng),V=r.aA(g.center.lat),U=(h.x+.5)/D-B;let G=0;U>.5?G=-1:U<-.5&&(G=1);let re=(t/r.ag+h.x)/D+G,Q=(o/r.ag+h.y)/D;re=(re-B)*g._pixelsPerMercatorPixel+B,Q=(Q-V)*g._pixelsPerMercatorPixel+V;const ue=[re*g.worldSize,Q*g.worldSize,0];r.ab.vec3.transformMat4(ue,ue,S),L=r.bd(L,ue,I)}return r.ab.vec3.transformMat4(L,L,v)}_makeGlobeTileDebugBorderBuffer(t,o,h,g,v,S){const I=new r.b4,L=new r.b5,D=new r.be,B=(U,G,re,Q,ue)=>{const ce=(re-U)/(ue-1),ye=(Q-G)/(ue-1),Ae=I.length;for(let Ee=0;Ee<ue;Ee++){const Fe=U+Ee*ce,ze=G+Ee*ye;I.emplaceBack(Fe,ze);const Oe=this._globePoint(Fe,ze,o,h,g,v,S);D.emplaceBack(Oe[0],Oe[1],Oe[2]),L.emplaceBack(Ae+Ee)}},V=r.ag;B(0,0,V,0,16),B(V,0,V,V,16),B(V,V,0,V,16),B(0,V,0,0,16),this._tileDebugIndexBuffer=t.createIndexBuffer(L),this._tileDebugBuffer=t.createVertexBuffer(I,r.b6.members),this._globeTileDebugBorderBuffer=t.createVertexBuffer(D,r.bf.members),this._tileDebugSegments=r.b7.simpleSegment(0,0,I.length,L.length)}_makeGlobeTileDebugTextBuffer(t,o,h,g,v,S){const I=r.ag/4,L=new r.b4,D=new r.aU,B=new r.be,V=25;D.reserve(32),L.reserve(V),B.reserve(V);const U=(G,re)=>V*G+re;for(let G=0;G<V;G++){const re=G*I;for(let Q=0;Q<V;Q++){const ue=Q*I;L.emplaceBack(ue,re);const ce=this._globePoint(ue,re,o,h,g,v,S);B.emplaceBack(ce[0],ce[1],ce[2])}}for(let G=0;G<4;G++)for(let re=0;re<4;re++){const Q=U(G,re),ue=U(G,re+1),ce=U(G+1,re),ye=U(G+1,re+1);D.emplaceBack(Q,ue,ce),D.emplaceBack(ce,ue,ye)}this._tileDebugTextIndexBuffer=t.createIndexBuffer(D),this._tileDebugTextBuffer=t.createVertexBuffer(L,r.b6.members),this._globeTileDebugTextBuffer=t.createVertexBuffer(B,r.bf.members),this._tileDebugTextSegments=r.b7.simpleSegment(0,0,V,32)}destroy(t=!1){for(const o in this.buckets)this.buckets[o].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&(this.imageAtlasTexture.destroy(),delete this.imageAtlasTexture),this.glyphAtlasTexture&&(this.glyphAtlasTexture.destroy(),delete this.glyphAtlasTexture),this.lineAtlasTexture&&(this.lineAtlasTexture.destroy(),delete this.lineAtlasTexture),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),!t&&this.texture&&this.texture instanceof r.T&&(this.texture.destroy(),delete this.texture),this.hillshadeFBO&&(this.hillshadeFBO.destroy(),delete this.hillshadeFBO),this.dem&&delete this.dem,this.neighboringTiles&&delete this.neighboringTiles,this.demTexture&&(this.demTexture.destroy(),delete this.demTexture),this.rasterParticleState&&(this.rasterParticleState.destroy(),delete this.rasterParticleState),this.latestFeatureIndex=null,this.state="unloaded"}}r.bg.setPbf(r.bh);class nl extends As{constructor(t,o,h,g,v){super(t,o,h,g,v),this._workQueue=[],this._fetchQueue=[],this._isHeaderLoaded=!1}setTexture(t,o){const h=o.context,g=h.gl;this.texture=this.texture||o.getTileTexture(t.width),this.texture&&this.texture instanceof r.T?this.texture.update(t,{premultiply:!1}):this.texture=new r.T(h,t,g.RGBA8,{premultiply:!1})}flushQueues(){for(;this._workQueue.length;)this._workQueue.pop()();for(;this._fetchQueue.length;)this._fetchQueue.pop()()}fetchHeader(t=16384,o){const h=this._mrt=new r.bg(30),g=Object.assign({},this.requestParams,{headers:{Range:"bytes=0-"+(t-1)}});return this.entireBuffer=null,this.request=r.bi(g,(v,S,I,L)=>{if(v)o(v);else try{const D=h.getHeaderLength(S);if(D>t)return void(this.request=this.fetchHeader(D,o));h.parseHeader(S),this._isHeaderLoaded=!0;let B=0;for(const V of Object.values(h.layers))B=Math.max(B,V.dataIndex[V.dataIndex.length-1].last_byte);S.byteLength>=B&&(this.entireBuffer=S),o(null,this.entireBuffer||S,I,L)}catch(D){o(D)}}),this.request}fetchBand(t,o,h){const g=this._mrt;if(!this._isHeaderLoaded||!g)return void h(new Error("Tile header is not ready"));const v=this.actor;if(!v)return void h(new Error("Can't fetch tile band without an actor"));let S;const I=(V,U)=>{S.complete(V,U),V?h(V):(this.updateTextureDescriptor(t,o),h(null,this.textureDescriptor&&this.textureDescriptor.img))},L=(V,U)=>{if(V)return h(V);const G=v.send("decodeRasterArray",{buffer:U,task:S},I,void 0,!0);this._workQueue.push(()=>{G&&G.cancel(),S.cancel()})},D=g.getLayer(t);if(!D)return void h(new Error(`Unknown sourceLayer "${t}"`));if(D.hasDataForBand(o))return this.updateTextureDescriptor(t,o),void h(null,this.textureDescriptor?this.textureDescriptor.img:null);const B=D.getDataRange([o]);if(S=g.createDecodingTask(B),!S||S.tasks.length)if(this.flushQueues(),this.entireBuffer)L(null,this.entireBuffer.slice(B.firstByte,B.lastByte+1));else{const V=Object.assign({},this.requestParams,{headers:{Range:`bytes=${B.firstByte}-${B.lastByte}`}}),U=r.bi(V,L);this._fetchQueue.push(()=>{U.cancel(),S.cancel()})}else h(null)}updateNeeded(t,o){return(!this.textureDescriptor||this.textureDescriptor.band!==o||this.textureDescriptor.layer!==t)&&this.state!=="errored"}updateTextureDescriptor(t,o){if(!this._mrt)return;const h=this._mrt.getLayer(t);if(!h||!h.hasBand(o)||!h.hasDataForBand(o))return;const{bytes:g,tileSize:v,buffer:S,offset:I,scale:L}=h.getBandView(o),D=v+2*S,B={data:g,width:D,height:D},V=this.texture;V&&V instanceof r.T&&V.update(B,{premultiply:!1}),this.textureDescriptor={layer:t,band:o,img:B,buffer:S,offset:I,tileSize:v,format:h.pixelFormat,mix:[L,256*L,65536*L,16777216*L]}}}class Oa{constructor(t,o){this.max=t,this.onRemove=o,this.reset()}reset(){for(const t in this.data)for(const o of this.data[t])o.timeout&&clearTimeout(o.timeout),this.onRemove(o.value);return this.data={},this.order=[],this}add(t,o,h){const g=t.wrapped().key;this.data[g]===void 0&&(this.data[g]=[]);const v={value:o,timeout:void 0};if(h!==void 0&&(v.timeout=setTimeout(()=>{this.remove(t,v)},h)),this.data[g].push(v),this.order.push(g),this.order.length>this.max){const S=this._getAndRemoveByKey(this.order[0]);S&&this.onRemove(S)}return this}has(t){return t.wrapped().key in this.data}getAndRemove(t){return this.has(t)?this._getAndRemoveByKey(t.wrapped().key):null}_getAndRemoveByKey(t){const o=this.data[t].shift();return o.timeout&&clearTimeout(o.timeout),this.data[t].length===0&&delete this.data[t],this.order.splice(this.order.indexOf(t),1),o.value}getByKey(t){const o=this.data[t];return o?o[0].value:null}get(t){return this.has(t)?this.data[t.wrapped().key][0].value:null}remove(t,o){if(!this.has(t))return this;const h=t.wrapped().key,g=o===void 0?0:this.data[h].indexOf(o),v=this.data[h][g];return this.data[h].splice(g,1),v.timeout&&clearTimeout(v.timeout),this.data[h].length===0&&delete this.data[h],this.onRemove(v.value),this.order.splice(this.order.indexOf(h),1),this}setMaxSize(t){for(this.max=t;this.order.length>this.max;){const o=this._getAndRemoveByKey(this.order[0]);o&&this.onRemove(o)}return this}filter(t){const o=[];for(const h in this.data)for(const g of this.data[h])t(g.value)||o.push(g);for(const h of o)this.remove(h.value.tileID,h)}}class go{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(t,o,h){const g=String(o);if(this.stateChanges[t]=this.stateChanges[t]||{},this.stateChanges[t][g]=this.stateChanges[t][g]||{},r.l(this.stateChanges[t][g],h),this.deletedStates[t]===null){this.deletedStates[t]={};for(const v in this.state[t])v!==g&&(this.deletedStates[t][v]=null)}else if(this.deletedStates[t]&&this.deletedStates[t][g]===null){this.deletedStates[t][g]={};for(const v in this.state[t][g])h[v]||(this.deletedStates[t][g][v]=null)}else for(const v in h)this.deletedStates[t]&&this.deletedStates[t][g]&&this.deletedStates[t][g][v]===null&&delete this.deletedStates[t][g][v]}removeFeatureState(t,o,h){if(this.deletedStates[t]===null)return;const g=String(o);if(this.deletedStates[t]=this.deletedStates[t]||{},h&&o!==void 0)this.deletedStates[t][g]!==null&&(this.deletedStates[t][g]=this.deletedStates[t][g]||{},this.deletedStates[t][g][h]=null);else if(o!==void 0)if(this.stateChanges[t]&&this.stateChanges[t][g])for(h in this.deletedStates[t][g]={},this.stateChanges[t][g])this.deletedStates[t][g][h]=null;else this.deletedStates[t][g]=null;else this.deletedStates[t]=null}getState(t,o){const h=this.state[t]||{},g=this.stateChanges[t]||{},v=this.deletedStates[t];if(v===null)return{};if(o!==void 0){const I=String(o),L=r.l({},h[I],g[I]);if(v){const D=v[o];if(D===null)return{};for(const B in D)delete L[B]}return L}const S=r.l({},h,g);if(v)for(const I in v)delete S[I];return S}initializeTileState(t,o){t.refreshFeatureState(o)}coalesceChanges(t,o){const h={};for(const g in this.stateChanges){this.state[g]=this.state[g]||{};const v={};for(const S in this.stateChanges[g])this.state[g][S]||(this.state[g][S]={}),r.l(this.state[g][S],this.stateChanges[g][S]),v[S]=this.state[g][S];h[g]=v}for(const g in this.deletedStates){this.state[g]=this.state[g]||{};const v={};if(this.deletedStates[g]===null)for(const S in this.state[g])v[S]={},this.state[g][S]={};else for(const S in this.deletedStates[g]){if(this.deletedStates[g][S]===null)this.state[g][S]={};else if(this.state[g][S])for(const I of Object.keys(this.deletedStates[g][S]))delete this.state[g][S][I];v[S]=this.state[g][S]}h[g]=h[g]||{},r.l(h[g],v)}if(this.stateChanges={},this.deletedStates={},Object.keys(h).length!==0)for(const g in t)t[g].refreshFeatureState(o)}}class Ls extends r.E{constructor(t,o,h){super(),this.id=t,this._onlySymbols=h,o.on("data",g=>{g.dataType==="source"&&g.sourceDataType==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&g.dataType==="source"&&g.sourceDataType==="content"&&(this.reload(),this.transform&&this.update(this.transform))}),o.on("error",()=>{this._sourceErrored=!0}),this._source=o,this._tiles={},this._cache=new Oa(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._minTileCacheSize=o.minTileCacheSize,this._maxTileCacheSize=o.maxTileCacheSize,this._loadedParentTiles={},this.castsShadows=!1,this.tileCoverLift=0,this._coveredTiles={},this._shadowCasterTiles={},this._state=new go,this._isRaster=this._source.type==="raster"||this._source.type==="raster-dem"||this._source.type==="raster-array"||this._source.type==="custom"&&this._source._dataType==="raster"}onAdd(t){this.map=t,this._minTileCacheSize=this._minTileCacheSize===void 0&&t?t._minTileCacheSize:this._minTileCacheSize,this._maxTileCacheSize=this._maxTileCacheSize===void 0&&t?t._maxTileCacheSize:this._maxTileCacheSize}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(const t in this._tiles){const o=this._tiles[t];if(o.state!=="loaded"&&o.state!=="errored")return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const t=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,t&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(t,o){return t.isSymbolTile=this._onlySymbols,t.isExtraShadowCaster=this._shadowCasterTiles[t.tileID.key],this._source.loadTile(t,o)}_unloadTile(t){if(this._source.unloadTile)return this._source.unloadTile(t)}_abortTile(t){if(this._source.abortTile)return this._source.abortTile(t)}serialize(){return this._source.serialize()}prepare(t){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const o in this._tiles){const h=this._tiles[o];h.upload(t),h.prepare(this.map.style.imageManager,this.map?this.map.painter:null,this._source.scope)}}getIds(){return r.bj(this._tiles).map(t=>t.tileID).sort(Ys).map(t=>t.key)}getRenderableIds(t,o){const h=[];for(const g in this._tiles)this._isIdRenderable(+g,t,o)&&h.push(this._tiles[g]);return t?h.sort((g,v)=>{const S=g.tileID,I=v.tileID,L=new r.P(S.canonical.x,S.canonical.y)._rotate(this.transform.angle),D=new r.P(I.canonical.x,I.canonical.y)._rotate(this.transform.angle);return S.overscaledZ-I.overscaledZ||D.y-L.y||D.x-L.x}).map(g=>g.tileID.key):h.map(g=>g.tileID).sort(Ys).map(g=>g.key)}hasRenderableParent(t){const o=this.findLoadedParent(t,0);return!!o&&this._isIdRenderable(o.tileID.key)}_isIdRenderable(t,o,h){return this._tiles[t]&&this._tiles[t].hasData()&&!this._coveredTiles[t]&&(o||!this._tiles[t].holdingForFade())&&(h||!this._shadowCasterTiles[t])}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const t in this._tiles)this._tiles[t].state!=="errored"&&this._reloadTile(+t,"reloading")}}_reloadTile(t,o){const h=this._tiles[t];h&&(h.state!=="loading"&&(h.state=o),this._loadTile(h,this._tileLoaded.bind(this,h,t,o)))}_tileLoaded(t,o,h,g){if(g)if(t.state="errored",g.status!==404)this._source.fire(new r.y(g,{tile:t}));else{if(this._source.fire(new r.z("data",{dataType:"source",sourceDataType:"error",sourceId:this._source.id,tile:t})),!(t.tileID.key in this._loadedParentTiles))return;if(this._source.type==="raster-dem"&&this.usedForTerrain&&this.map.painter.terrain){const v=this.map.painter.terrain;this.update(this.transform,v.getScaledDemTileSize(),!0),v.resetTileLookupCache(this.id)}else this.update(this.transform)}else t.timeAdded=r.q.now(),h==="expired"&&(t.refreshedUponExpiration=!0),this._setTileReloadTimer(o,t),this._source.type==="raster-dem"&&t.dem&&this._backfillDEM(t),this._state.initializeTileState(t,this.map?this.map.painter:null),this._source.fire(new r.z("data",{dataType:"source",tile:t,coord:t.tileID,sourceCacheId:this.id}))}_backfillDEM(t){const o=this.getRenderableIds();for(let g=0;g<o.length;g++){const v=o[g];if(t.neighboringTiles&&t.neighboringTiles[v]){const S=this.getTileByID(v);h(t,S),h(S,t)}}function h(g,v){if(!g.dem||g.dem.borderReady)return;g.needsHillshadePrepare=!0,g.needsDEMTextureUpload=!0;let S=v.tileID.canonical.x-g.tileID.canonical.x;const I=v.tileID.canonical.y-g.tileID.canonical.y,L=Math.pow(2,g.tileID.canonical.z),D=v.tileID.key;S===0&&I===0||Math.abs(I)>1||(Math.abs(S)>1&&(Math.abs(S+L)===1?S+=L:Math.abs(S-L)===1&&(S-=L)),v.dem&&g.dem&&(g.dem.backfillBorder(v.dem,S,I),g.neighboringTiles&&g.neighboringTiles[D]&&(g.neighboringTiles[D].backfilled=!0)))}}getTile(t){return this.getTileByID(t.key)}getTileByID(t){return this._tiles[t]}_retainLoadedChildren(t,o,h,g){for(const v in this._tiles){let S=this._tiles[v];if(g[v]||!S.hasData()||S.tileID.overscaledZ<=o||S.tileID.overscaledZ>h)continue;let I=S.tileID;for(;S&&S.tileID.overscaledZ>o+1;){const D=S.tileID.scaledTo(S.tileID.overscaledZ-1);S=this._tiles[D.key],S&&S.hasData()&&(I=D)}let L=I;for(;L.overscaledZ>o;)if(L=L.scaledTo(L.overscaledZ-1),t[L.key]){g[I.key]=I;break}}}findLoadedParent(t,o){if(t.key in this._loadedParentTiles){const h=this._loadedParentTiles[t.key];return h&&h.tileID.overscaledZ>=o?h:null}for(let h=t.overscaledZ-1;h>=o;h--){const g=t.scaledTo(h),v=this._getLoadedTile(g);if(v)return v}}_getLoadedTile(t){const o=this._tiles[t.key];return o&&o.hasData()?o:this._cache.getByKey(this._source.reparseOverscaled?t.wrapped().key:t.canonical.key)}updateCacheSize(t,o){o=o||this._source.tileSize;const h=Math.ceil(t.width/o)+1,g=Math.ceil(t.height/o)+1,v=Math.floor(h*g*5),S=typeof this._minTileCacheSize=="number"?Math.max(this._minTileCacheSize,v):v,I=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,S):S;this._cache.setMaxSize(I)}handleWrapJump(t){const o=Math.round((t-(this._prevLng===void 0?t:this._prevLng))/360);if(this._prevLng=t,o){const h={};for(const g in this._tiles){const v=this._tiles[g];v.tileID=v.tileID.unwrapTo(v.tileID.wrap+o),h[v.tileID.key]=v}this._tiles=h;for(const g in this._timers)clearTimeout(this._timers[g]),delete this._timers[g];for(const g in this._tiles)this._setTileReloadTimer(+g,this._tiles[g])}}update(t,o,h,g){if(this.transform=t,!this._sourceLoaded||this._paused||this.transform.freezeTileCoverage||this.usedForTerrain&&!h)return;this.updateCacheSize(t,o),this.transform.projection.name!=="globe"&&this.handleWrapJump(this.transform.center.lng),this._shadowCasterTiles={},this._coveredTiles={};const v=this._source.type==="batched-model";let S,I=this._source.maxzoom;const L=this.map&&this.map.painter?this.map.painter._terrain:null;if(L&&L.sourceCache===this&&L.attenuationRange()){const V=L.attenuationRange()[0],U=Math.floor(V)-Math.log2(L.getDemUpscale());I>U&&(I=U)}if(this.used||this.usedForTerrain){if(this._source.tileID)S=t.getVisibleUnwrappedCoordinates(this._source.tileID).map(V=>new r.aG(V.canonical.z,V.wrap,V.canonical.z,V.canonical.x,V.canonical.y));else if(this.tileCoverLift!==0){const V=t.clone();V.tileCoverLift=this.tileCoverLift,S=V.coveringTiles({tileSize:o||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:I,roundZoom:this._source.roundZoom&&!h,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain,calculateQuadrantVisibility:v}),this._source.minzoom<=1&&t.projection.name==="globe"&&(S.push(new r.aG(1,0,1,0,0)),S.push(new r.aG(1,0,1,1,0)),S.push(new r.aG(1,0,1,0,1)),S.push(new r.aG(1,0,1,1,1)))}else if(S=t.coveringTiles({tileSize:o||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:I,roundZoom:this._source.roundZoom&&!h,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain,calculateQuadrantVisibility:v}),this._source.hasTile){const V=this._source.hasTile.bind(this._source);S=S.filter(U=>V(U))}}else S=[];if(S.length>0&&this.castsShadows&&g&&this.transform.projection.name!=="globe"&&!this.usedForTerrain&&!Da(this._source.type)){const V=t.coveringZoomLevel({tileSize:o||this._source.tileSize,roundZoom:this._source.roundZoom&&!h}),U=Math.min(V,this._source.maxzoom);if(v){const G=t.extendTileCover(S,U);for(const re of G)S.push(re)}else{const G=t.extendTileCover(S,U,g);for(const re of G)this._shadowCasterTiles[re.key]=!0,S.push(re)}}const D=this._updateRetainedTiles(S);if(Da(this._source.type)&&S.length!==0){const V={},U={},G=Object.keys(D);for(const Q of G){const ue=D[Q],ce=this._tiles[Q];if(!ce||ce.fadeEndTime&&ce.fadeEndTime<=r.q.now())continue;const ye=this.findLoadedParent(ue,Math.max(ue.overscaledZ-Ls.maxOverzooming,this._source.minzoom));ye&&(this._addTile(ye.tileID),V[ye.tileID.key]=ye.tileID),U[Q]=ue}const re=S[S.length-1].overscaledZ;for(const Q in this._tiles){const ue=this._tiles[Q];if(D[Q]||!ue.hasData())continue;let ce=ue.tileID;for(;ce.overscaledZ>re;){ce=ce.scaledTo(ce.overscaledZ-1);const ye=this._tiles[ce.key];if(ye&&ye.hasData()&&U[ce.key]){D[Q]=ue.tileID;break}}}for(const Q in V)D[Q]||(this._coveredTiles[Q]=!0,D[Q]=V[Q])}for(const V in D)this._tiles[V].clearFadeHold();const B=r.bk(this._tiles,D);for(const V of B){const U=this._tiles[V];U.hasSymbolBuckets&&!U.holdingForFade()?U.setHoldDuration(this.map._fadeDuration):U.hasSymbolBuckets&&!U.symbolFadeFinished()||this._removeTile(+V)}this._updateLoadedParentTileCache(),this._onlySymbols&&this._source.afterUpdate&&this._source.afterUpdate()}releaseSymbolFadeTiles(){for(const t in this._tiles)this._tiles[t].holdingForFade()&&this._removeTile(+t)}_updateRetainedTiles(t){const o={};if(t.length===0)return o;const h={},g=t.reduce((D,B)=>Math.min(D,B.overscaledZ),1/0),v=t[0].overscaledZ,S=Math.max(v-Ls.maxOverzooming,this._source.minzoom),I=Math.max(v+Ls.maxUnderzooming,this._source.minzoom),L={};for(const D of t){const B=this._addTile(D);o[D.key]=D,B.hasData()||g<this._source.maxzoom&&(L[D.key]=D)}this._retainLoadedChildren(L,g,I,o);for(const D of t){let B=this._tiles[D.key];if(B.hasData())continue;if(D.canonical.z>=this._source.maxzoom){const U=D.children(this._source.maxzoom)[0],G=this.getTile(U);if(G&&G.hasData()){o[U.key]=U;continue}}else{const U=D.children(this._source.maxzoom);if(o[U[0].key]&&o[U[1].key]&&o[U[2].key]&&o[U[3].key])continue}let V=B.wasRequested();for(let U=D.overscaledZ-1;U>=S;--U){const G=D.scaledTo(U);if(h[G.key]||(h[G.key]=!0,B=this.getTile(G),!B&&V&&(B=this._addTile(G)),B&&(o[G.key]=G,V=B.wasRequested(),B.hasData())))break}}return o}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const t in this._tiles){const o=[];let h,g=this._tiles[t].tileID;for(;g.overscaledZ>0;){if(g.key in this._loadedParentTiles){h=this._loadedParentTiles[g.key];break}o.push(g.key);const v=g.scaledTo(g.overscaledZ-1);if(h=this._getLoadedTile(v),h)break;g=v}for(const v of o)this._loadedParentTiles[v]=h}}_addTile(t){let o=this._tiles[t.key];if(o)return o.isExtraShadowCaster!==!0||this._shadowCasterTiles[t.key]||this._reloadTile(t.key,"reloading"),o;o=this._cache.getAndRemove(t),o&&(this._setTileReloadTimer(t.key,o),o.tileID=t,this._state.initializeTileState(o,this.map?this.map.painter:null),this._cacheTimers[t.key]&&(clearTimeout(this._cacheTimers[t.key]),delete this._cacheTimers[t.key],this._setTileReloadTimer(t.key,o)));const h=!!o;if(!h){const g=this.map?this.map.painter:null,v=this._source.tileSize*t.overscaleFactor();o=this._source.type==="raster-array"?new nl(t,v,this.transform.tileZoom,g,this._isRaster):new As(t,v,this.transform.tileZoom,g,this._isRaster),this._loadTile(o,this._tileLoaded.bind(this,o,t.key,o.state))}return o?(o.uses++,this._tiles[t.key]=o,h||this._source.fire(new r.z("dataloading",{tile:o,coord:o.tileID,dataType:"source"})),o):null}_setTileReloadTimer(t,o){t in this._timers&&(clearTimeout(this._timers[t]),delete this._timers[t]);const h=o.getExpiryTimeout();h&&(this._timers[t]=setTimeout(()=>{this._reloadTile(t,"expired"),delete this._timers[t]},h))}_removeTile(t){const o=this._tiles[t];o&&(o.uses--,delete this._tiles[t],this._timers[t]&&(clearTimeout(this._timers[t]),delete this._timers[t]),o.uses>0||(o.hasData()&&o.state!=="reloading"||o.state==="empty"?this._cache.add(o.tileID,o,o.getExpiryTimeout()):(o.aborted=!0,this._abortTile(o),this._unloadTile(o))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const t in this._tiles)this._removeTile(+t);this._source._clear&&this._source._clear(),this._cache.reset(),this.map&&this.usedForTerrain&&this.map.painter.terrain&&this.map.painter.terrain.resetTileLookupCache(this.id)}tilesIn(t,o,h){const g=[],v=this.transform;if(!v)return g;const S=v.projection.name==="globe",I=r.at(v.center.lng);for(const L in this._tiles){const D=this._tiles[L];if(h&&D.clearQueryDebugViz(),D.holdingForFade())continue;let B;if(S){const V=D.tileID.canonical;if(V.z===0){const U=[Math.abs(r.aw(I,...ir(V,-1))-I),Math.abs(r.aw(I,...ir(V,1))-I)];B=[0,2*U.indexOf(Math.min(...U))-1]}else{const U=[Math.abs(r.aw(I,...ir(V,-1))-I),Math.abs(r.aw(I,...ir(V,0))-I),Math.abs(r.aw(I,...ir(V,1))-I)];B=[U.indexOf(Math.min(...U))-1]}}else B=[0];for(const V of B){const U=t.containsTile(D,v,o,V);U&&g.push(U)}}return g}getShadowCasterCoordinates(){return this._getRenderableCoordinates(!1,!0)}getVisibleCoordinates(t){return this._getRenderableCoordinates(t)}_getRenderableCoordinates(t,o){const h=this.getRenderableIds(t,o).map(v=>this._tiles[v].tileID),g=this.transform.projection.name==="globe";for(const v of h)v.projMatrix=this.transform.calculateProjMatrix(v.toUnwrapped()),v.expandedProjMatrix=g?this.transform.calculateProjMatrix(v.toUnwrapped(),!1,!0):v.projMatrix;return h}sortCoordinatesByDistance(t){const o=t.slice(),h=this.transform._camera.position,g=this.transform._camera.forward(),v={};for(const S of o){const I=1/(1<<S.canonical.z);v[S.key]=((S.canonical.x+.5)*I+S.wrap-h[0])*g[0]+((S.canonical.y+.5)*I-h[1])*g[1]-h[2]*g[2]}return o.sort((S,I)=>v[S.key]-v[I.key]),o}hasTransition(){if(this._source.hasTransition())return!0;if(Da(this._source.type))for(const t in this._tiles){const o=this._tiles[t];if(o.fadeEndTime!==void 0&&o.fadeEndTime>=r.q.now())return!0}return!1}setFeatureState(t,o,h){this._state.updateState(t=t||"_geojsonTileLayer",o,h)}removeFeatureState(t,o,h){this._state.removeFeatureState(t=t||"_geojsonTileLayer",o,h)}getFeatureState(t,o){return this._state.getState(t=t||"_geojsonTileLayer",o)}setDependencies(t,o,h){const g=this._tiles[t];g&&g.setDependencies(o,h)}reloadTilesForDependencies(t,o){for(const h in this._tiles)this._tiles[h].hasDependency(t,o)&&this._reloadTile(+h,"reloading");this._cache.filter(h=>!h.hasDependency(t,o))}_preloadTiles(t,o){if(!this._sourceLoaded){const L=()=>{this._sourceLoaded&&(this._source.off("data",L),this._preloadTiles(t,o))};return void this._source.on("data",L)}const h=new Map,g=Array.isArray(t)?t:[t],v=this.map.painter.terrain,S=this.usedForTerrain&&v?v.getScaledDemTileSize():this._source.tileSize;for(const L of g){const D=L.coveringTiles({tileSize:S,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!this.usedForTerrain,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain});for(const B of D)h.set(B.key,B);this.usedForTerrain&&L.updateElevation(!1)}const I=Array.from(h.values());r.bl(I,(L,D)=>{const B=new As(L,this._source.tileSize*L.overscaleFactor(),this.transform.tileZoom,this.map.painter,this._isRaster);this._loadTile(B,V=>{this._source.type==="raster-dem"&&B.dem&&this._backfillDEM(B),D(V,B)})},o)}}function Ys(u,t){const o=Math.abs(2*u.wrap)-+(u.wrap<0),h=Math.abs(2*t.wrap)-+(t.wrap<0);return u.overscaledZ-t.overscaledZ||h-o||t.canonical.y-u.canonical.y||t.canonical.x-u.canonical.x}function Da(u){return u==="raster"||u==="image"||u==="video"||u==="custom"}function ir(u,t){const o=1<<u.z;return[u.x/o+t,(u.x+1)/o+t]}Ls.maxOverzooming=10,Ls.maxUnderzooming=3;class hs{constructor(t){this.style=t,this.layersGotHidden=!1,this.layers=[]}processLayersChanged(){this.layers=[];const t=!1,o=!1;for(const h in this.style._mergedLayers){const g=this.style._mergedLayers[h];if(g.type==="fill-extrusion")this.layers.push({layer:g,visible:t,visibilityChanged:o});else if(g.type==="model"){const v=this.style.getLayerSource(g);v&&v.type==="batched-model"&&this.layers.push({layer:g,visible:t,visibilityChanged:o})}}}onNewFrame(t){this.layersGotHidden=!1;for(const o of this.layers){const h=o.layer;let g=!1;h.type==="fill-extrusion"?g=!h.isHidden(t)&&h.paint.get("fill-extrusion-opacity")>0:h.type==="model"&&(g=!h.isHidden(t)&&h.paint.get("model-opacity").constantOr(1)>0),this.layersGotHidden=this.layersGotHidden||!g&&o.visible,o.visible=g}}updateZOffset(t,o){this.currentBuildingBuckets=[];for(const g of this.layers){const v=g.layer,S=this.style.getLayerSourceCache(v);let I=1;v.type==="fill-extrusion"&&(I=g.visible?v.paint.get("fill-extrusion-vertical-scale"):0);let L=S?S.getTile(o):null;if(!L&&S&&o.canonical.z>S.getSource().minzoom){let D=o.scaledTo(Math.min(S.getSource().maxzoom,o.overscaledZ-1));for(;D.overscaledZ>=S.getSource().minzoom&&(L=S.getTile(D),!L&&D.overscaledZ!==0);)D=D.scaledTo(D.overscaledZ-1)}this.currentBuildingBuckets.push({bucket:L?L.getBucket(v):null,tileID:L?L.tileID:o,verticalScale:I})}t.hasAnyZOffset=!1;let h=!1;for(let g=0;g<t.symbolInstances.length;g++){const v=t.symbolInstances.get(g),S=v.zOffset,I=this._getHeightAtTileOffset(o,v.tileAnchorX,v.tileAnchorY);v.zOffset=I!==Number.NEGATIVE_INFINITY?I:S,h||S===v.zOffset||(h=!0),t.hasAnyZOffset||v.zOffset===0||(t.hasAnyZOffset=!0)}h&&(t.zOffsetBuffersNeedUpload=!0,t.zOffsetSortDirty=!0)}_mapCoordToOverlappingTile(t,o,h,g){let v=o,S=h;if(t.canonical.z!==g.canonical.z){const I=g.canonical,L=1/(1<<t.canonical.z-I.z);v=(o+t.canonical.x*r.ag)*L-I.x*r.ag|0,S=(h+t.canonical.y*r.ag)*L-I.y*r.ag|0}return{tileX:v,tileY:S}}_getHeightAtTileOffset(t,o,h){let g,v;for(let S=0;S<this.layers.length;++S){if(this.layers[S].layer.type!=="fill-extrusion")continue;const{bucket:I,tileID:L,verticalScale:D}=this.currentBuildingBuckets[S];if(!I)continue;const{tileX:B,tileY:V}=this._mapCoordToOverlappingTile(t,o,h,L),U=I.getHeightAtTileCoord(B,V);U&&U.height!==void 0&&(U.hidden?g=U.height:v=Math.max(U.height*D,v||0))}if(v!==void 0)return v;for(let S=0;S<this.layers.length;++S){const I=this.layers[S];if(I.layer.type!=="model"||!I.visible)continue;const{bucket:L,tileID:D}=this.currentBuildingBuckets[S];if(!L)continue;const{tileX:B,tileY:V}=this._mapCoordToOverlappingTile(t,o,h,D),U=L.getHeightAtTileCoord(B,V);if(U&&!U.hidden)return U.height===void 0&&g!==void 0?Math.min(U.maxHeight,g)*U.verticalScale:U.height?U.height*U.verticalScale:Number.NEGATIVE_INFINITY}return this.layersGotHidden?0:Number.NEGATIVE_INFINITY}}function kn(u,t){const o={};for(const h in u)h!=="ref"&&(o[h]=u[h]);return r.bm.forEach(h=>{h in t&&(o[h]=t[h])}),o}function Po(u){u=u.slice();const t=Object.create(null);for(let o=0;o<u.length;o++)t[u[o].id]=u[o];for(let o=0;o<u.length;o++)"ref"in u[o]&&(u[o]=kn(u[o],t[u[o].ref]));return u}const yr={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setSlot:"setSlot",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight",setTerrain:"setTerrain",setFog:"setFog",setSnow:"setSnow",setRain:"setRain",setCamera:"setCamera",setLights:"setLights",setProjection:"setProjection",addImport:"addImport",removeImport:"removeImport",updateImport:"updateImport"};function ia(u,t,o){o.push({command:yr.addSource,args:[u,t[u]]})}function Eo(u,t,o){t.push({command:yr.removeSource,args:[u]}),o[u]=!0}function Fa(u,t,o,h){Eo(u,o,h),ia(u,t,o)}function Kn(u,t,o){let h;for(h in u[o])if(u[o].hasOwnProperty(h)&&h!=="data"&&!r.bn(u[o][h],t[o][h]))return!1;for(h in t[o])if(t[o].hasOwnProperty(h)&&h!=="data"&&!r.bn(u[o][h],t[o][h]))return!1;return!0}function qt(u,t,o,h,g,v){let S;for(S in t=t||{},u=u||{})u.hasOwnProperty(S)&&(r.bn(u[S],t[S])||o.push({command:v,args:[h,S,t[S],g]}));for(S in t)t.hasOwnProperty(S)&&!u.hasOwnProperty(S)&&(r.bn(u[S],t[S])||o.push({command:v,args:[h,S,t[S],g]}))}function Jn(u){return u.id}function Xn(u,t){return u[t.id]=t,u}class ni{constructor(t,o){this.reset(t,o)}reset(t,o){this.points=t||[],this._distances=[0];for(let h=1;h<this.points.length;h++)this._distances[h]=this._distances[h-1]+this.points[h].dist(this.points[h-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(o||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(t){if(this.points.length===1)return this.points[0];t=r.aw(t,0,1);let o=1,h=this._distances[o];const g=t*this.paddedLength+this.padding;for(;h<g&&o<this._distances.length;)h=this._distances[++o];const v=o-1,S=this._distances[v],I=h-S,L=I>0?(g-S)/I:0;return this.points[v].mult(1-L).add(this.points[o].mult(L))}}class ba{constructor(t,o,h){const g=this.boxCells=[],v=this.circleCells=[];this.xCellCount=Math.ceil(t/h),this.yCellCount=Math.ceil(o/h);for(let S=0;S<this.xCellCount*this.yCellCount;S++)g.push([]),v.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=t,this.height=o,this.xScale=this.xCellCount/t,this.yScale=this.yCellCount/o,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(t,o,h,g,v){this._forEachCell(o,h,g,v,this._insertBoxCell,this.boxUid++),this.boxKeys.push(t),this.bboxes.push(o),this.bboxes.push(h),this.bboxes.push(g),this.bboxes.push(v)}insertCircle(t,o,h,g){this._forEachCell(o-g,h-g,o+g,h+g,this._insertCircleCell,this.circleUid++),this.circleKeys.push(t),this.circles.push(o),this.circles.push(h),this.circles.push(g)}_insertBoxCell(t,o,h,g,v,S){this.boxCells[v].push(S)}_insertCircleCell(t,o,h,g,v,S){this.circleCells[v].push(S)}_query(t,o,h,g,v,S){if(h<0||t>this.width||g<0||o>this.height)return!v&&[];const I=[];if(t<=0&&o<=0&&this.width<=h&&this.height<=g){if(v)return!0;for(let L=0;L<this.boxKeys.length;L++)I.push({key:this.boxKeys[L],x1:this.bboxes[4*L],y1:this.bboxes[4*L+1],x2:this.bboxes[4*L+2],y2:this.bboxes[4*L+3]});for(let L=0;L<this.circleKeys.length;L++){const D=this.circles[3*L],B=this.circles[3*L+1],V=this.circles[3*L+2];I.push({key:this.circleKeys[L],x1:D-V,y1:B-V,x2:D+V,y2:B+V})}return S?I.filter(S):I}return this._forEachCell(t,o,h,g,this._queryCell,I,{hitTest:v,seenUids:{box:{},circle:{}}},S),v?I.length>0:I}_queryCircle(t,o,h,g,v){const S=t-h,I=t+h,L=o-h,D=o+h;if(I<0||S>this.width||D<0||L>this.height)return!g&&[];const B=[];return this._forEachCell(S,L,I,D,this._queryCellCircle,B,{hitTest:g,circle:{x:t,y:o,radius:h},seenUids:{box:{},circle:{}}},v),g?B.length>0:B}query(t,o,h,g,v){return this._query(t,o,h,g,!1,v)}hitTest(t,o,h,g,v){return this._query(t,o,h,g,!0,v)}hitTestCircle(t,o,h,g){return this._queryCircle(t,o,h,!0,g)}_queryCell(t,o,h,g,v,S,I,L){const D=I.seenUids,B=this.boxCells[v];if(B!==null){const U=this.bboxes;for(const G of B)if(!D.box[G]){D.box[G]=!0;const re=4*G;if(t<=U[re+2]&&o<=U[re+3]&&h>=U[re+0]&&g>=U[re+1]&&(!L||L(this.boxKeys[G]))){if(I.hitTest)return S.push(!0),!0;S.push({key:this.boxKeys[G],x1:U[re],y1:U[re+1],x2:U[re+2],y2:U[re+3]})}}}const V=this.circleCells[v];if(V!==null){const U=this.circles;for(const G of V)if(!D.circle[G]){D.circle[G]=!0;const re=3*G;if(this._circleAndRectCollide(U[re],U[re+1],U[re+2],t,o,h,g)&&(!L||L(this.circleKeys[G]))){if(I.hitTest)return S.push(!0),!0;{const Q=U[re],ue=U[re+1],ce=U[re+2];S.push({key:this.circleKeys[G],x1:Q-ce,y1:ue-ce,x2:Q+ce,y2:ue+ce})}}}}}_queryCellCircle(t,o,h,g,v,S,I,L){const D=I.circle,B=I.seenUids,V=this.boxCells[v];if(V!==null){const G=this.bboxes;for(const re of V)if(!B.box[re]){B.box[re]=!0;const Q=4*re;if(this._circleAndRectCollide(D.x,D.y,D.radius,G[Q+0],G[Q+1],G[Q+2],G[Q+3])&&(!L||L(this.boxKeys[re])))return S.push(!0),!0}}const U=this.circleCells[v];if(U!==null){const G=this.circles;for(const re of U)if(!B.circle[re]){B.circle[re]=!0;const Q=3*re;if(this._circlesCollide(G[Q],G[Q+1],G[Q+2],D.x,D.y,D.radius)&&(!L||L(this.circleKeys[re])))return S.push(!0),!0}}}_forEachCell(t,o,h,g,v,S,I,L){const D=this._convertToXCellCoord(t),B=this._convertToYCellCoord(o),V=this._convertToXCellCoord(h),U=this._convertToYCellCoord(g);for(let G=D;G<=V;G++)for(let re=B;re<=U;re++)if(v.call(this,t,o,h,g,this.xCellCount*re+G,S,I,L))return}_convertToXCellCoord(t){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(t*this.xScale)))}_convertToYCellCoord(t){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(t*this.yScale)))}_circlesCollide(t,o,h,g,v,S){const I=g-t,L=v-o,D=h+S;return D*D>I*I+L*L}_circleAndRectCollide(t,o,h,g,v,S,I){const L=(S-g)/2,D=Math.abs(t-(g+L));if(D>L+h)return!1;const B=(I-v)/2,V=Math.abs(o-(v+B));if(V>B+h)return!1;if(D<=L||V<=B)return!0;const U=D-L,G=V-B;return U*U+G*G<=h*h}}const wr={unknown:0,flipRequired:1,flipNotRequired:2},rl=Math.tan(85*Math.PI/180);function ds(u,t,o,h,g,v,S){const I=r.ab.mat4.create();if(o)if(v.name==="globe"){const L=r.bo(g,t);r.ab.mat4.multiply(I,I,L)}else{const L=r.ab.mat2.invert([],S);I[0]=L[0],I[1]=L[1],I[4]=L[2],I[5]=L[3],h||r.ab.mat4.rotateZ(I,I,g.angle)}else r.ab.mat4.multiply(I,g.labelPlaneMatrix,u);return I}function oa(u,t,o,h,g,v,S){const I=ds(u,t,o,h,g,v,S);return v.name==="globe"&&o||(I[2]=I[6]=I[10]=I[14]=0),I}function Lo(u,t,o,h,g,v,S){if(o){if(v.name==="globe"){const I=ds(u,t,o,h,g,v,S);return r.ab.mat4.invert(I,I),r.ab.mat4.multiply(I,u,I),I}{const I=r.ab.mat4.clone(u),L=r.ab.mat4.identity([]);return L[0]=S[0],L[1]=S[1],L[4]=S[2],L[5]=S[3],r.ab.mat4.multiply(I,I,L),h||r.ab.mat4.rotateZ(I,I,-g.angle),I}}return g.glCoordMatrix}function wi(u,t,o,h){const g=[u,t,o,1];o?r.ab.vec4.transformMat4(g,g,h):sl(g,g,h);const v=g[3];return g[0]/=v,g[1]/=v,g[2]/=v,g}function Pd(u,t){return Math.min(.5+u/t*.5,1.5)}function il(u,t){const o=u[0]/u[3],h=u[1]/u[3];return o>=-t[0]&&o<=t[0]&&h>=-t[1]&&h<=t[1]}function Yl(u,t,o,h,g,v,S,I,L,D){const B=o.transform,V=h?u.textSizeData:u.iconSizeData,U=r.bp(V,o.transform.zoom),G=B.projection.name==="globe",re=[256/o.width*2+1,256/o.height*2+1],Q=h?u.text.dynamicLayoutVertexArray:u.icon.dynamicLayoutVertexArray;Q.clear();let ue=null;G&&(ue=h?u.text.globeExtVertexArray:u.icon.globeExtVertexArray);const ce=u.lineVertexArray,ye=h?u.text.placedSymbolArray:u.icon.placedSymbolArray,Ae=o.transform.width/o.transform.height;let Ee,Fe=!1;for(let ze=0;ze<ye.length;ze++){const Oe=ye.get(ze),{numGlyphs:ke,writingMode:Ge}=Oe;if(Ge!==r.bq.vertical||Fe||Ee===r.bq.horizontal||(Fe=!0),Ee=Ge,(Oe.hidden||Ge===r.bq.vertical)&&!Fe){ol(ke,Q);continue}Fe=!1;const Ze=new r.P(Oe.tileAnchorX,Oe.tileAnchorY);let{x:ft,y:ct,z:We}=B.projection.projectTilePoint(Ze.x,Ze.y,D.canonical);if(L){const[kt,_n,gn]=L(Ze);ft+=kt,ct+=_n,We+=gn}const tt=[ft,ct,We,1];if(r.ab.vec4.transformMat4(tt,tt,t),!il(tt,re)){ol(ke,Q);continue}const zt=tt[3],Gt=Pd(o.transform.getCameraToCenterDistance(B.projection),zt),Yt=r.br(V,U,Oe),dt=S?Yt/Gt:Yt*Gt,Ft=wi(ft,ct,We,g);if(Ft[3]<=0){ol(ke,Q);continue}let Et={};const rn=S?null:L,Vt=Os(Oe,dt,!1,I,t,g,v,u.glyphOffsetArray,ce,Q,ue,Ft,Ze,Et,Ae,rn,B.projection,D,S);Fe=Vt.useVertical,rn&&Vt.needsFlipping&&(Et={}),(Vt.notEnoughRoom||Fe||Vt.needsFlipping&&Os(Oe,dt,!0,I,t,g,v,u.glyphOffsetArray,ce,Q,ue,Ft,Ze,Et,Ae,rn,B.projection,D,S).notEnoughRoom)&&ol(ke,Q)}h?(u.text.dynamicLayoutVertexBuffer.updateData(Q),ue&&u.text.globeExtVertexBuffer&&u.text.globeExtVertexBuffer.updateData(ue)):(u.icon.dynamicLayoutVertexBuffer.updateData(Q),ue&&u.icon.globeExtVertexBuffer&&u.icon.globeExtVertexBuffer.updateData(ue))}function Kl(u,t,o,h,g,v,S,I,L,D,B,V,U,G,re,Q){const{lineStartIndex:ue,glyphStartIndex:ce,segment:ye}=I,Ae=ce+I.numGlyphs,Ee=ue+I.lineLength,Fe=t.getoffsetX(ce),ze=t.getoffsetX(Ae-1),Oe=Oo(u*Fe,o,h,g,v,S,ye,ue,Ee,L,D,B,V,U,!0,G,re,Q);if(!Oe)return null;const ke=Oo(u*ze,o,h,g,v,S,ye,ue,Ee,L,D,B,V,U,!0,G,re,Q);return ke?{first:Oe,last:ke}:null}function Eu(u,t,o,h){return u===r.bq.horizontal&&Math.abs(h)>Math.abs(o)?{useVertical:!0}:u===r.bq.vertical?h>0?{needsFlipping:!0}:null:t!==wr.unknown&&function(g,v){return g===0||Math.abs(v/g)>rl}(o,h)?t===wr.flipRequired?{needsFlipping:!0}:null:o<0?{needsFlipping:!0}:null}function Os(u,t,o,h,g,v,S,I,L,D,B,V,U,G,re,Q,ue,ce,ye){const Ae=t/24,Ee=u.lineOffsetX*Ae,Fe=u.lineOffsetY*Ae,{lineStartIndex:ze,glyphStartIndex:Oe,numGlyphs:ke,segment:Ge,writingMode:Ze,flipState:ft}=u,ct=ze+u.lineLength,We=tt=>{if(B){const[dt,Ft,Et]=tt.up,rn=D.length;r.bs(B,rn+0,dt,Ft,Et),r.bs(B,rn+1,dt,Ft,Et),r.bs(B,rn+2,dt,Ft,Et),r.bs(B,rn+3,dt,Ft,Et)}const[zt,Gt,Yt]=tt.point;r.bt(D,zt,Gt,Yt,tt.angle)};if(ke>1){const tt=Kl(Ae,I,Ee,Fe,o,V,U,u,L,v,G,Q,!1,ue,ce,ye);if(!tt)return{notEnoughRoom:!0};if(h&&!o){let[zt,Gt,Yt]=tt.first.point,[dt,Ft,Et]=tt.last.point;[zt,Gt]=wi(zt,Gt,Yt,S),[dt,Ft]=wi(dt,Ft,Et,S);const rn=Eu(Ze,ft,(dt-zt)*re,Ft-Gt);if(u.flipState=rn&&rn.needsFlipping?wr.flipRequired:wr.flipNotRequired,rn)return rn}We(tt.first);for(let zt=Oe+1;zt<Oe+ke-1;zt++){const Gt=Oo(Ae*I.getoffsetX(zt),Ee,Fe,o,V,U,Ge,ze,ct,L,v,G,Q,!1,!1,ue,ce,ye);if(!Gt)return D.length-=4*(zt-Oe),{notEnoughRoom:!0};We(Gt)}We(tt.last)}else{if(h&&!o){const zt=wi(U.x,U.y,0,g),Gt=ze+Ge+1,Yt=new r.P(L.getx(Gt),L.gety(Gt)),dt=wi(Yt.x,Yt.y,0,g),Ft=dt[3]>0?dt:sa(U,Yt,zt,1,g,void 0,ue,ce.canonical),Et=Eu(Ze,ft,(Ft[0]-zt[0])*re,Ft[1]-zt[1]);if(u.flipState=Et&&Et.needsFlipping?wr.flipRequired:wr.flipNotRequired,Et)return Et}const tt=Oo(Ae*I.getoffsetX(Oe),Ee,Fe,o,V,U,Ge,ze,ct,L,v,G,Q,!1,!1,ue,ce,ye);if(!tt)return{notEnoughRoom:!0};We(tt)}return{}}function fs(u,t,o,h,g){const{x:v,y:S,z:I}=h.projectTilePoint(u.x,u.y,t);if(!g)return wi(v,S,I,o);const[L,D,B]=g(u);return wi(v+L,S+D,I+B,o)}function sa(u,t,o,h,g,v,S,I){const L=fs(u.sub(t)._unit()._add(u),I,g,S,v);return r.ab.vec3.sub(L,o,L),r.ab.vec3.normalize(L,L),r.ab.vec3.scaleAndAdd(L,o,L,h)}function Oo(u,t,o,h,g,v,S,I,L,D,B,V,U,G,re,Q,ue,ce){const ye=h?u-t:u+t;let Ae=ye>0?1:-1,Ee=0;h&&(Ae*=-1,Ee=Math.PI),Ae<0&&(Ee+=Math.PI);let Fe=I+S+(Ae>0?0:1)|0,ze=g,Oe=g,ke=0,Ge=0;const Ze=Math.abs(ye),ft=[],ct=[];let We=v,tt=We;const zt=()=>sa(tt,We,Oe,Ze-ke+1,B,U,Q,ue.canonical);for(;ke+Ge<=Ze;){if(Fe+=Ae,Fe<I||Fe>=L)return null;if(Oe=ze,tt=We,ft.push(Oe),G&&ct.push(tt),We=new r.P(D.getx(Fe),D.gety(Fe)),ze=V[Fe],!ze){const _n=fs(We,ue.canonical,B,Q,U);ze=_n[3]>0?V[Fe]=_n:zt()}ke+=Ge,Ge=r.ab.vec3.distance(Oe,ze)}re&&U&&(V[Fe]&&(ze=zt(),Ge=r.ab.vec3.distance(Oe,ze)),V[Fe]=ze);const Gt=(Ze-ke)/Ge,Yt=We.sub(tt)._mult(Gt)._add(tt),dt=r.ab.vec3.sub([],ze,Oe),Ft=r.ab.vec3.scaleAndAdd([],Oe,dt,Gt);let Et=[0,0,1],rn=dt[0],Vt=dt[1];if(ce&&(Et=Q.upVector(ue.canonical,Yt.x,Yt.y),Et[0]!==0||Et[1]!==0||Et[2]!==1)){const _n=[Et[2],0,-Et[0]],gn=r.ab.vec3.cross([],Et,_n);r.ab.vec3.normalize(_n,_n),r.ab.vec3.normalize(gn,gn),rn=r.ab.vec3.dot(dt,_n),Vt=r.ab.vec3.dot(dt,gn)}if(o){const _n=r.ab.vec3.cross([],Et,dt);r.ab.vec3.normalize(_n,_n),r.ab.vec3.scaleAndAdd(Ft,Ft,_n,o*Ae)}const kt=Ee+Math.atan2(Vt,rn);return ft.push(Ft),G&&ct.push(Yt),{point:Ft,angle:kt,path:ft,tilePath:ct,up:Et}}function ol(u,t){const o=t.length,h=o+4*u;t.resize(h),t.float32.fill(-1/0,4*o,4*h)}function sl(u,t,o){const h=t[0],g=t[1];return u[0]=o[0]*h+o[4]*g+o[12],u[1]=o[1]*h+o[5]*g+o[13],u[3]=o[3]*h+o[7]*g+o[15],u}const zi=100;class To{constructor(t,o,h=new ba(t.width+200,t.height+200,25),g=new ba(t.width+200,t.height+200,25)){this.transform=t,this.grid=h,this.ignoredGrid=g,this.pitchfactor=Math.cos(t._pitch)*t.cameraToCenterDistance,this.screenRightBoundary=t.width+zi,this.screenBottomBoundary=t.height+zi,this.gridRightBoundary=t.width+200,this.gridBottomBoundary=t.height+200,this.fogState=o}placeCollisionBox(t,o,h,g,v,S,I,L){let D=h.projectedAnchorX,B=h.projectedAnchorY,V=h.projectedAnchorZ;const U=h.elevation,G=h.tileID,re=t.getProjection();if(U&&G){const[ze,Oe,ke]=re.upVector(G.canonical,h.tileAnchorX,h.tileAnchorY),Ge=re.upVectorScale(G.canonical,this.transform.center.lat,this.transform.worldSize).metersToTile;D+=ze*U*Ge,B+=Oe*U*Ge,V+=ke*U*Ge}const Q=this.projectAndGetPerspectiveRatio(I,D,B,V,h.tileID,re.name==="globe"||!!U||this.transform.pitch>0,re),ue=S*Q.perspectiveRatio,ce=(h.x1*o+g.x-h.padding)*ue+Q.point.x,ye=(h.y1*o+g.y-h.padding)*ue+Q.point.y,Ae=(h.x2*o+g.x+h.padding)*ue+Q.point.x,Ee=(h.y2*o+g.y+h.padding)*ue+Q.point.y,Fe=Q.perspectiveRatio<=.55||Q.occluded;return!this.isInsideGrid(ce,ye,Ae,Ee)||!v&&this.grid.hitTest(ce,ye,Ae,Ee,L)||Fe?{box:[],offscreen:!1,occluded:Q.occluded}:{box:[ce,ye,Ae,Ee],offscreen:this.isOffscreen(ce,ye,Ae,Ee),occluded:!1}}placeCollisionCircles(t,o,h,g,v,S,I,L,D,B,V,U,G,re,Q){const ue=[],ce=this.transform.elevation,ye=t.getProjection(),Ae=ce?ce.getAtTileOffsetFunc(Q,this.transform.center.lat,this.transform.worldSize,ye):null,Ee=new r.P(h.tileAnchorX,h.tileAnchorY);let{x:Fe,y:ze,z:Oe}=ye.projectTilePoint(Ee.x,Ee.y,Q.canonical);if(Ae){const[Yt,dt,Ft]=Ae(Ee);Fe+=Yt,ze+=dt,Oe+=Ft}const ke=ye.name==="globe",Ge=this.projectAndGetPerspectiveRatio(I,Fe,ze,Oe,Q,ke||!!ce||this.transform.pitch>0,ye),{perspectiveRatio:Ze}=Ge,ft=(V?S/Ze:S*Ze)/r.bw,ct=wi(Fe,ze,Oe,L),We=Ge.signedDistanceFromCamera>0?Kl(ft,v,h.lineOffsetX*ft,h.lineOffsetY*ft,!1,ct,Ee,h,g,L,{},ce&&!V?Ae:null,V&&!!ce,ye,Q,V):null;let tt=!1,zt=!1,Gt=!0;if(We&&!Ge.occluded){const Yt=.5*G*Ze+re,dt=new r.P(-100,-100),Ft=new r.P(this.screenRightBoundary,this.screenBottomBoundary),Et=new ni,{first:rn,last:Vt}=We,kt=rn.path.length;let _n=[];for(let xn=kt-1;xn>=1;xn--)_n.push(rn.path[xn]);for(let xn=1;xn<Vt.path.length;xn++)_n.push(Vt.path[xn]);const gn=2.5*Yt;D&&(_n=_n.map(([xn,tr,Ln],Fn)=>(Ae&&!ke&&(Ln=Ae(Fn<kt-1?rn.tilePath[kt-1-Fn]:Vt.tilePath[Fn-kt+2])[2]),wi(xn,tr,Ln,D))),_n.some(xn=>xn[3]<=0)&&(_n=[]));let ln=[];if(_n.length>0){let xn=1/0,tr=-1/0,Ln=1/0,Fn=-1/0;for(const Yn of _n)xn=Math.min(xn,Yn[0]),Ln=Math.min(Ln,Yn[1]),tr=Math.max(tr,Yn[0]),Fn=Math.max(Fn,Yn[1]);tr>=dt.x&&xn<=Ft.x&&Fn>=dt.y&&Ln<=Ft.y&&(ln=[_n.map(Yn=>new r.P(Yn[0],Yn[1]))],(xn<dt.x||tr>Ft.x||Ln<dt.y||Fn>Ft.y)&&(ln=r.bu(ln,dt.x,dt.y,Ft.x,Ft.y)))}for(const xn of ln){Et.reset(xn,.25*Yt);let tr=0;tr=Et.length<=.5*Yt?1:Math.ceil(Et.paddedLength/gn)+1;for(let Ln=0;Ln<tr;Ln++){const Fn=Ln/Math.max(tr-1,1),Yn=Et.lerp(Fn),Dr=Yn.x+zi,pr=Yn.y+zi;ue.push(Dr,pr,Yt,0);const Oi=Dr-Yt,Si=pr-Yt,si=Dr+Yt,Fr=pr+Yt;if(Gt=Gt&&this.isOffscreen(Oi,Si,si,Fr),zt=zt||this.isInsideGrid(Oi,Si,si,Fr),!o&&this.grid.hitTestCircle(Dr,pr,Yt,U)&&(tt=!0,!B))return{circles:[],offscreen:!1,collisionDetected:tt,occluded:!1}}}}return{circles:!B&&tt||!zt?[]:ue,offscreen:Gt,collisionDetected:tt,occluded:Ge.occluded}}queryRenderedSymbols(t){if(t.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const o=[];let h=1/0,g=1/0,v=-1/0,S=-1/0;for(const B of t){const V=new r.P(B.x+zi,B.y+zi);h=Math.min(h,V.x),g=Math.min(g,V.y),v=Math.max(v,V.x),S=Math.max(S,V.y),o.push(V)}const I=this.grid.query(h,g,v,S).concat(this.ignoredGrid.query(h,g,v,S)),L={},D={};for(const B of I){const V=B.key;if(L[V.bucketInstanceId]===void 0&&(L[V.bucketInstanceId]={}),L[V.bucketInstanceId][V.featureIndex])continue;const U=[new r.P(B.x1,B.y1),new r.P(B.x2,B.y1),new r.P(B.x2,B.y2),new r.P(B.x1,B.y2)];r.bv(o,U)&&(L[V.bucketInstanceId][V.featureIndex]=!0,D[V.bucketInstanceId]===void 0&&(D[V.bucketInstanceId]=[]),D[V.bucketInstanceId].push(V.featureIndex))}return D}insertCollisionBox(t,o,h,g,v){(o?this.ignoredGrid:this.grid).insert({bucketInstanceId:h,featureIndex:g,collisionGroupID:v},t[0],t[1],t[2],t[3])}insertCollisionCircles(t,o,h,g,v){const S=o?this.ignoredGrid:this.grid,I={bucketInstanceId:h,featureIndex:g,collisionGroupID:v};for(let L=0;L<t.length;L+=4)S.insertCircle(I,t[L],t[L+1],t[L+2])}projectAndGetPerspectiveRatio(t,o,h,g,v,S,I){const L=[o,h,g,1];let D=!1;g||this.transform.pitch>0?(r.ab.vec4.transformMat4(L,L,t),this.fogState&&v&&I.name!=="globe"&&(D=function(U,G,re,Q,ue,ce){const ye=ce.calculateFogTileMatrix(ue),Ae=[G,re,Q];return r.ab.vec3.transformMat4(Ae,Ae,ye),En(U,r.ab.vec3.length(Ae),ce.pitch,ce._fov)}(this.fogState,o,h,g,v.toUnwrapped(),this.transform)>.9)):sl(L,L,t);const B=L[3];return{point:new r.P((L[0]/B+1)/2*this.transform.width+zi,(-L[1]/B+1)/2*this.transform.height+zi),perspectiveRatio:Math.min(.5+this.transform.getCameraToCenterDistance(I)/B*.5,1.5),signedDistanceFromCamera:B,occluded:S&&L[2]>B||D}}isOffscreen(t,o,h,g){return h<zi||t>=this.screenRightBoundary||g<zi||o>this.screenBottomBoundary}isInsideGrid(t,o,h,g){return h>=0&&t<this.gridRightBoundary&&g>=0&&o<this.gridBottomBoundary}getViewportMatrix(){const t=r.ab.mat4.identity([]);return r.ab.mat4.translate(t,t,[-100,-100,0]),t}}function Is(u,t,o){const h=t.createTileMatrix(u,u.worldSize,o.toUnwrapped());return r.ab.mat4.multiply(new Float32Array(16),u.projMatrix,h)}function _o(u,t,o){if(t.projection.name===o.projection.name)return u.projMatrix;const h=o.clone();return h.setProjection(t.projection),Is(h,t.getProjection(),u)}function Jl(u,t,o){return t.name===o.projection.name?u.projMatrix:Is(o,t,u)}class wa{constructor(t,o,h,g){this.opacity=t?Math.max(0,Math.min(1,t.opacity+(t.placed?o:-o))):g&&h?1:0,this.placed=h}isHidden(){return this.opacity===0&&!this.placed}}class Ba{constructor(t,o,h,g,v,S=!1){this.text=new wa(t?t.text:null,o,h,v),this.icon=new wa(t?t.icon:null,o,g,v),this.clipped=S}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class al{constructor(t,o,h,g=!1){this.text=t,this.icon=o,this.skipFade=h,this.clipped=g}}class ll{constructor(){this.invProjMatrix=r.ab.mat4.create(),this.viewportMatrix=r.ab.mat4.create(),this.circles=[]}}class Oh{constructor(t,o,h,g,v){this.bucketInstanceId=t,this.featureIndex=o,this.sourceLayerIndex=h,this.bucketIndex=g,this.tileID=v}}class Na{constructor(t){this.crossSourceCollisions=t,this.maxGroupID=0,this.collisionGroups={}}get(t){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[t]){const o=++this.maxGroupID;this.collisionGroups[t]={ID:o,predicate:h=>h.collisionGroupID===o}}return this.collisionGroups[t]}}function Rd(u,t,o,h,g){const{horizontalAlign:v,verticalAlign:S}=r.bD(u),I=-(v-.5)*t,L=-(S-.5)*o,D=r.bC(u,h);return new r.P(I+D[0]*g,L+D[1]*g)}function Ku(u,t,o,h,g){const v=new r.P(u,t);return o&&v._rotate(h?g:-g),v}class Ko{constructor(t,o,h,g,v,S){this.transform=t.clone(),this.projection=t.projection.name,this.collisionIndex=new To(this.transform,v),this.buildingIndex=S,this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=o,this.retainedQueryData={},this.collisionGroups=new Na(h),this.collisionCircleArrays={},this.prevPlacement=g,g&&(g.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(t,o,h,g,v=1){const S=h.getBucket(o),I=h.latestFeatureIndex;if(!S||!I||o.fqid!==S.layerIds[0])return;const L=S.layers[0].layout,D=S.layers[0].paint,B=h.collisionBoxArray,V=Math.pow(2,this.transform.zoom-h.tileID.overscaledZ),U=h.tileSize/r.ag,G=h.tileID.toUnwrapped();this.transform.setProjection(S.projection);const re=(Q=h.tileID,ue=S.getProjection(),ce=this.transform,ue.name===this.projection?ce.calculateProjMatrix(Q.toUnwrapped()):Is(ce,ue,Q));var Q,ue,ce;const ye=L.get("text-pitch-alignment")==="map",Ae=L.get("text-rotation-alignment")==="map";o.compileFilter(o.options);const Ee=o.dynamicFilter(),Fe=o.dynamicFilterNeedsFeature(),ze=this.transform.calculatePixelsToTileUnitsMatrix(h),Oe=oa(re,h.tileID.canonical,ye,Ae,this.transform,S.getProjection(),ze);let ke=null;if(ye){const Yt=Lo(re,h.tileID.canonical,ye,Ae,this.transform,S.getProjection(),ze);ke=r.ab.mat4.multiply([],this.transform.labelPlaneMatrix,Yt)}let Ge=null;Ee&&h.latestFeatureIndex&&(Ge={unwrappedTileID:G,dynamicFilter:Ee,dynamicFilterNeedsFeature:Fe}),this.retainedQueryData[S.bucketInstanceId]=new Oh(S.bucketInstanceId,I,S.sourceLayerIndex,S.index,h.tileID);const[Ze,ft]=S.layers[0].layout.get("text-size-scale-range"),ct=r.aw(v,Ze,ft),[We,tt]=L.get("icon-size-scale-range"),zt=r.aw(v,We,tt),Gt={bucket:S,layout:L,paint:D,posMatrix:re,textLabelPlaneMatrix:Oe,labelToScreenMatrix:ke,clippingData:Ge,scale:V,textPixelRatio:U,holdingForFade:h.holdingForFade(),collisionBoxArray:B,partiallyEvaluatedTextSize:r.bp(S.textSizeData,this.transform.zoom,ct),partiallyEvaluatedIconSize:r.bp(S.iconSizeData,this.transform.zoom,zt),collisionGroup:this.collisionGroups.get(S.sourceID),latestFeatureIndex:h.latestFeatureIndex};if(g)for(const Yt of S.sortKeyRanges){const{sortKey:dt,symbolInstanceStart:Ft,symbolInstanceEnd:Et}=Yt;t.push({sortKey:dt,symbolInstanceStart:Ft,symbolInstanceEnd:Et,parameters:Gt})}else t.push({symbolInstanceStart:0,symbolInstanceEnd:S.symbolInstances.length,parameters:Gt})}attemptAnchorPlacement(t,o,h,g,v,S,I,L,D,B,V,U,G,re,Q,ue,ce,ye){const{textOffset0:Ae,textOffset1:Ee,crossTileID:Fe}=U,ze=[Ae,Ee],Oe=Rd(t,h,g,ze,v),ke=this.collisionIndex.placeCollisionBox(re,v,o,Ku(Oe.x,Oe.y,S,I,this.transform.angle),V,L,D,B.predicate);if(ue){const Ge=re.getSymbolInstanceIconSize(ye,this.transform.zoom,U.placedIconSymbolIndex);if(this.collisionIndex.placeCollisionBox(re,Ge,ue,Ku(Oe.x,Oe.y,S,I,this.transform.angle),V,L,D,B.predicate).box.length===0)return}if(ke.box.length>0){let Ge;return this.prevPlacement&&this.prevPlacement.variableOffsets[Fe]&&this.prevPlacement.placements[Fe]&&this.prevPlacement.placements[Fe].text&&(Ge=this.prevPlacement.variableOffsets[Fe].anchor),this.variableOffsets[Fe]={textOffset:ze,width:h,height:g,anchor:t,textScale:v,prevAnchor:Ge},this.markUsedJustification(re,t,U,Q),re.allowVerticalPlacement&&(this.markUsedOrientation(re,Q,U),this.placedOrientations[Fe]=Q),{shift:Oe,placedGlyphBoxes:ke}}}placeLayerBucketPart(t,o,h,g,v=1){const{bucket:S,layout:I,paint:L,posMatrix:D,textLabelPlaneMatrix:B,labelToScreenMatrix:V,clippingData:U,textPixelRatio:G,holdingForFade:re,collisionBoxArray:Q,partiallyEvaluatedTextSize:ue,partiallyEvaluatedIconSize:ce,collisionGroup:ye,latestFeatureIndex:Ae}=t.parameters,Ee=I.get("text-optional"),Fe=I.get("icon-optional"),ze=I.get("text-allow-overlap"),Oe=I.get("icon-allow-overlap"),ke=I.get("text-rotation-alignment")==="map",Ge=I.get("text-pitch-alignment")==="map",Ze=I.get("symbol-z-elevate"),ft=L.get("symbol-z-offset"),ct=I.get("symbol-elevation-reference")==="sea",[We,tt]=I.get("text-size-scale-range"),[zt,Gt]=I.get("icon-size-scale-range"),Yt=r.aw(v,We,tt),dt=r.aw(v,zt,Gt);this.transform.setProjection(S.projection);let Ft=ze&&(Oe||!S.hasIconData()||Fe),Et=Oe&&(ze||!S.hasTextData()||Ee);const rn=!ft.isConstant();!S.collisionArrays&&Q&&S.deserializeCollisionBoxes(Q),h&&g&&S.updateCollisionDebugBuffers(this.transform.zoom,Q,Yt,dt);const Vt=(kt,_n,gn)=>{const{crossTileID:ln,numVerticalGlyphVertices:xn}=kt;let tr=null;if(U&&U.dynamicFilterNeedsFeature||rn){const ki=this.retainedQueryData[S.bucketInstanceId];tr=Ae.loadFeature({featureIndex:kt.featureIndex,bucketIndex:ki.bucketIndex,sourceLayerIndex:ki.sourceLayerIndex,layoutVertexArrayOffset:0})}if(U&&!(0,U.dynamicFilter)({zoom:this.transform.zoom,pitch:this.transform.pitch},tr,this.retainedQueryData[S.bucketInstanceId].tileID.canonical,new r.P(kt.tileAnchorX,kt.tileAnchorY),this.transform.calculateDistanceTileData(U.unwrappedTileID)))return this.placements[ln]=new al(!1,!1,!1,!0),void o.add(ln);const Ln=ft.evaluate(tr,{});if(o.has(ln))return;if(re)return void(this.placements[ln]=new al(!1,!1,!1));let Fn=!1,Yn=!1,Dr=!0,pr=!1,Oi=!1,Si=null,si={box:null,offscreen:null,occluded:null},Fr={box:null,offscreen:null,occluded:null},ur=null,Er=null,Bn=null,ii=0,Ji=0,ts=0;gn.textFeatureIndex?ii=gn.textFeatureIndex:kt.useRuntimeCollisionCircles&&(ii=kt.featureIndex),gn.verticalTextFeatureIndex&&(Ji=gn.verticalTextFeatureIndex);const Za=ki=>{ki.tileID=this.retainedQueryData[S.bucketInstanceId].tileID;const mi=this.transform.elevation;ki.elevation=ct?Ln:Ln+(mi?mi.getAtTileOffset(ki.tileID,ki.tileAnchorX,ki.tileAnchorY):0),ki.elevation+=kt.zOffset},Bo=gn.textBox;if(Bo){Za(Bo);const ki=Yr=>{let ho=r.bq.horizontal;if(S.allowVerticalPlacement&&!Yr&&this.prevPlacement){const Go=this.prevPlacement.placedOrientations[ln];Go&&(this.placedOrientations[ln]=Go,ho=Go,this.markUsedOrientation(S,ho,kt))}return ho},mi=(Yr,ho)=>{if(S.allowVerticalPlacement&&xn>0&&gn.verticalTextBox){for(const Go of S.writingModes)if(Go===r.bq.vertical?(si=ho(),Fr=si):si=Yr(),si&&si.box&&si.box.length)break}else si=Yr()};if(I.get("text-variable-anchor")){let Yr=I.get("text-variable-anchor");if(this.prevPlacement&&this.prevPlacement.variableOffsets[ln]){const Ei=this.prevPlacement.variableOffsets[ln];Yr.indexOf(Ei.anchor)>0&&(Yr=Yr.filter(Gs=>Gs!==Ei.anchor),Yr.unshift(Ei.anchor))}const ho=(Ei,Gs,El)=>{const fa=S.getSymbolInstanceTextSize(ue,kt,this.transform.zoom,_n),kc=(Ei.x2-Ei.x1)*fa+2*Ei.padding,pa=(Ei.y2-Ei.y1)*fa+2*Ei.padding,na=kt.hasIconTextFit&&!Oe?Gs:null;na&&Za(na);let qs={box:[],offscreen:!1,occluded:!1};const zc=ze?2*Yr.length:Yr.length;for(let Wi=0;Wi<zc;++Wi){const vh=this.attemptAnchorPlacement(Yr[Wi%Yr.length],Ei,kc,pa,fa,ke,Ge,G,D,ye,Wi>=Yr.length,kt,_n,S,El,na,ue,ce);if(vh&&(qs=vh.placedGlyphBoxes,qs&&qs.box&&qs.box.length)){Fn=!0,Si=vh.shift;break}}return qs};mi(()=>ho(Bo,gn.iconBox,r.bq.horizontal),()=>{const Ei=gn.verticalTextBox;return Ei&&Za(Ei),S.allowVerticalPlacement&&!(si&&si.box&&si.box.length)&&xn>0&&Ei?ho(Ei,gn.verticalIconBox,r.bq.vertical):{box:null,offscreen:null,occluded:null}}),si&&(Fn=si.box,Dr=si.offscreen,pr=si.occluded);const Go=ki(!(!si||!si.box));if(!Fn&&this.prevPlacement){const Ei=this.prevPlacement.variableOffsets[ln];Ei&&(this.variableOffsets[ln]=Ei,this.markUsedJustification(S,Ei.anchor,kt,Go))}}else{const Yr=(ho,Go)=>{const Ei=S.getSymbolInstanceTextSize(ue,kt,this.transform.zoom,_n,v),Gs=this.collisionIndex.placeCollisionBox(S,Ei,ho,new r.P(0,0),ze,G,D,ye.predicate);return Gs&&Gs.box&&Gs.box.length&&(this.markUsedOrientation(S,Go,kt),this.placedOrientations[ln]=Go),Gs};mi(()=>Yr(Bo,r.bq.horizontal),()=>{const ho=gn.verticalTextBox;return S.allowVerticalPlacement&&xn>0&&ho?(Za(ho),Yr(ho,r.bq.vertical)):{box:null,offscreen:null,occluded:null}}),ki(!!(si&&si.box&&si.box.length))}}if(ur=si,Fn=ur&&ur.box&&ur.box.length>0,Dr=ur&&ur.offscreen,pr=ur&&ur.occluded,kt.useRuntimeCollisionCircles){const ki=S.text.placedSymbolArray.get(kt.centerJustifiedTextSymbolIndex>=0?kt.centerJustifiedTextSymbolIndex:kt.verticalPlacedTextSymbolIndex),mi=r.br(S.textSizeData,ue,ki),Yr=I.get("text-padding");Er=this.collisionIndex.placeCollisionCircles(S,ze,ki,S.lineVertexArray,S.glyphOffsetArray,mi,D,B,V,h,Ge,ye.predicate,kt.collisionCircleDiameter*mi/r.bw,Yr,this.retainedQueryData[S.bucketInstanceId].tileID),Fn=ze||Er.circles.length>0&&!Er.collisionDetected,Dr=Dr&&Er.offscreen,pr=Er.occluded}if(gn.iconFeatureIndex&&(ts=gn.iconFeatureIndex),gn.iconBox){const ki=mi=>{Za(mi);const Yr=kt.hasIconTextFit&&Si?Ku(Si.x,Si.y,ke,Ge,this.transform.angle):new r.P(0,0),ho=S.getSymbolInstanceIconSize(ce,this.transform.zoom,kt.placedIconSymbolIndex);return this.collisionIndex.placeCollisionBox(S,ho,mi,Yr,Oe,G,D,ye.predicate)};Fr&&Fr.box&&Fr.box.length&&gn.verticalIconBox?(Bn=ki(gn.verticalIconBox),Yn=Bn.box.length>0):(Bn=ki(gn.iconBox),Yn=Bn.box.length>0),Dr=Dr&&Bn.offscreen,Oi=Bn.occluded}const ns=Ee||kt.numHorizontalGlyphVertices===0&&xn===0,Co=Fe||kt.numIconVertices===0;if(ns||Co?Co?ns||(Yn=Yn&&Fn):Fn=Yn&&Fn:Yn=Fn=Yn&&Fn,Fn&&ur&&ur.box&&this.collisionIndex.insertCollisionBox(ur.box,I.get("text-ignore-placement"),S.bucketInstanceId,Fr&&Fr.box&&Ji?Ji:ii,ye.ID),Yn&&Bn&&this.collisionIndex.insertCollisionBox(Bn.box,I.get("icon-ignore-placement"),S.bucketInstanceId,ts,ye.ID),Er&&(Fn&&this.collisionIndex.insertCollisionCircles(Er.circles,I.get("text-ignore-placement"),S.bucketInstanceId,ii,ye.ID),h)){const ki=S.bucketInstanceId;let mi=this.collisionCircleArrays[ki];mi===void 0&&(mi=this.collisionCircleArrays[ki]=new ll);for(let Yr=0;Yr<Er.circles.length;Yr+=4)mi.circles.push(Er.circles[Yr+0]),mi.circles.push(Er.circles[Yr+1]),mi.circles.push(Er.circles[Yr+2]),mi.circles.push(Er.collisionDetected?1:0)}const Vi=S.projection.name!=="globe";Ft=Ft&&(Vi||!pr),Et=Et&&(Vi||!Oi),this.placements[ln]=new al(Fn||Ft,Yn||Et,Dr||S.justReloaded),o.add(ln)};if(Ze&&this.buildingIndex&&(this.buildingIndex.updateZOffset(S,this.retainedQueryData[S.bucketInstanceId].tileID),S.updateZOffset()),S.sortFeaturesByY){const kt=S.getSortedSymbolIndexes(this.transform.angle);for(let _n=kt.length-1;_n>=0;--_n){const gn=kt[_n];Vt(S.symbolInstances.get(gn),gn,S.collisionArrays[gn])}S.hasAnyZOffset&&r.w(`${S.layerIds[0]} layer symbol-z-elevate: symbols are not sorted by elevation if symbol-z-order is evaluated to viewport-y`)}else if(S.hasAnyZOffset){const kt=S.getSortedIndexesByZOffset();for(let _n=0;_n<kt.length;++_n){const gn=kt[_n];Vt(S.symbolInstances.get(gn),gn,S.collisionArrays[gn])}}else for(let kt=t.symbolInstanceStart;kt<t.symbolInstanceEnd;kt++)Vt(S.symbolInstances.get(kt),kt,S.collisionArrays[kt]);if(h&&S.bucketInstanceId in this.collisionCircleArrays){const kt=this.collisionCircleArrays[S.bucketInstanceId];r.ab.mat4.invert(kt.invProjMatrix,D),kt.viewportMatrix=this.collisionIndex.getViewportMatrix()}S.justReloaded=!1}markUsedJustification(t,o,h,g){const{leftJustifiedTextSymbolIndex:v,centerJustifiedTextSymbolIndex:S,rightJustifiedTextSymbolIndex:I,verticalPlacedTextSymbolIndex:L,crossTileID:D}=h,B=r.bB(o),V=g===r.bq.vertical?L:B==="left"?v:B==="center"?S:B==="right"?I:-1;v>=0&&(t.text.placedSymbolArray.get(v).crossTileID=V>=0&&v!==V?0:D),S>=0&&(t.text.placedSymbolArray.get(S).crossTileID=V>=0&&S!==V?0:D),I>=0&&(t.text.placedSymbolArray.get(I).crossTileID=V>=0&&I!==V?0:D),L>=0&&(t.text.placedSymbolArray.get(L).crossTileID=V>=0&&L!==V?0:D)}markUsedOrientation(t,o,h){const g=o===r.bq.horizontal||o===r.bq.horizontalOnly?o:0,v=o===r.bq.vertical?o:0,{leftJustifiedTextSymbolIndex:S,centerJustifiedTextSymbolIndex:I,rightJustifiedTextSymbolIndex:L,verticalPlacedTextSymbolIndex:D}=h,B=t.text.placedSymbolArray;S>=0&&(B.get(S).placedOrientation=g),I>=0&&(B.get(I).placedOrientation=g),L>=0&&(B.get(L).placedOrientation=g),D>=0&&(B.get(D).placedOrientation=v)}commit(t){this.commitTime=t,this.zoomAtLastRecencyCheck=this.transform.zoom;const o=this.prevPlacement;let h=!1;this.prevZoomAdjustment=o?o.zoomAdjustment(this.transform.zoom):0;const g=o?o.symbolFadeChange(t):1,v=o?o.opacities:{},S=o?o.variableOffsets:{},I=o?o.placedOrientations:{};for(const L in this.placements){const D=this.placements[L],B=v[L];B?(this.opacities[L]=new Ba(B,g,D.text,D.icon,null,D.clipped),h=h||D.text!==B.text.placed||D.icon!==B.icon.placed):(this.opacities[L]=new Ba(null,g,D.text,D.icon,D.skipFade,D.clipped),h=h||D.text||D.icon)}for(const L in v){const D=v[L];if(!this.opacities[L]){const B=new Ba(D,g,!1,!1);B.isHidden()||(this.opacities[L]=B,h=h||D.text.placed||D.icon.placed)}}for(const L in S)this.variableOffsets[L]||!this.opacities[L]||this.opacities[L].isHidden()||(this.variableOffsets[L]=S[L]);for(const L in I)this.placedOrientations[L]||!this.opacities[L]||this.opacities[L].isHidden()||(this.placedOrientations[L]=I[L]);h?this.lastPlacementChangeTime=t:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=o?o.lastPlacementChangeTime:t)}updateLayerOpacities(t,o,h,g){const v=new Set;for(const S of o){const I=S.getBucket(t);I&&S.latestFeatureIndex&&t.fqid===I.layerIds[0]&&(this.updateBucketOpacities(I,v,S,S.collisionBoxArray,h,g,S.tileID,t.scope),I.layers[0].layout.get("symbol-z-elevate")&&this.buildingIndex&&(this.buildingIndex.updateZOffset(I,S.tileID),I.updateZOffset()))}}updateBucketOpacities(t,o,h,g,v,S,I,L){t.hasTextData()&&t.text.opacityVertexArray.clear(),t.hasIconData()&&t.icon.opacityVertexArray.clear(),t.hasIconCollisionBoxData()&&t.iconCollisionBox.collisionVertexArray.clear(),t.hasTextCollisionBoxData()&&t.textCollisionBox.collisionVertexArray.clear();const D=t.layers[0].layout,B=t.layers[0].paint,V=!!t.layers[0].dynamicFilter(),U=new Ba(null,0,!1,!1,!0),G=D.get("text-allow-overlap"),re=D.get("icon-allow-overlap"),Q=D.get("text-variable-anchor"),ue=D.get("text-rotation-alignment")==="map",ce=D.get("text-pitch-alignment")==="map",ye=B.get("symbol-z-offset"),Ae=D.get("symbol-elevation-reference")==="sea",Ee=!ye.isConstant(),Fe=new Ba(null,0,G&&(re||!t.hasIconData()||D.get("icon-optional")),re&&(G||!t.hasTextData()||D.get("text-optional")),!0);!t.collisionArrays&&g&&(t.hasIconCollisionBoxData()||t.hasTextCollisionBoxData())&&t.deserializeCollisionBoxes(g);const ze=(ke,Ge,Ze)=>{for(let ft=0;ft<Ge/4;ft++)ke.opacityVertexArray.emplaceBack(Ze)};let Oe=0;S&&t.updateReplacement(I,S);for(let ke=0;ke<t.symbolInstances.length;ke++){const Ge=t.symbolInstances.get(ke),{numHorizontalGlyphVertices:Ze,numVerticalGlyphVertices:ft,crossTileID:ct,numIconVertices:We,tileAnchorX:tt,tileAnchorY:zt}=Ge;let Gt=null;const Yt=this.retainedQueryData[t.bucketInstanceId];Ee&&Ge&&Yt&&(Gt=h.latestFeatureIndex.loadFeature({featureIndex:Ge.featureIndex,bucketIndex:Yt.bucketIndex,sourceLayerIndex:Yt.sourceLayerIndex,layoutVertexArrayOffset:0}));const dt=ye.evaluate(Gt,{}),Ft=o.has(ct);let Et=this.opacities[ct];Ft?Et=U:Et||(Et=Fe,this.opacities[ct]=Et),o.add(ct);const rn=Ze>0||ft>0,Vt=We>0,kt=this.placedOrientations[ct],_n=kt===r.bq.vertical,gn=kt===r.bq.horizontal||kt===r.bq.horizontalOnly;!rn&&!Vt||Et.isHidden()||Oe++;let ln=!1;if((rn||Vt)&&S)for(const xn of t.activeReplacements){if(r.bx(xn,v,r.by.Symbol,L)||xn.min.x>tt||tt>xn.max.x||xn.min.y>zt||zt>xn.max.y)continue;const tr=r.bz(tt,zt,I.canonical,xn.footprintTileId.canonical);if(ln=r.bA(tr,xn.footprint),ln)break}if(rn){const xn=ln?cl:zd(Et.text);ze(t.text,Ze,_n?cl:xn),ze(t.text,ft,gn?cl:xn);const tr=Et.text.isHidden(),{leftJustifiedTextSymbolIndex:Ln,centerJustifiedTextSymbolIndex:Fn,rightJustifiedTextSymbolIndex:Yn,verticalPlacedTextSymbolIndex:Dr}=Ge,pr=t.text.placedSymbolArray,Oi=tr||_n?1:0;Ln>=0&&(pr.get(Ln).hidden=Oi),Fn>=0&&(pr.get(Fn).hidden=Oi),Yn>=0&&(pr.get(Yn).hidden=Oi),Dr>=0&&(pr.get(Dr).hidden=tr||gn?1:0);const Si=this.variableOffsets[ct];Si&&this.markUsedJustification(t,Si.anchor,Ge,kt);const si=this.placedOrientations[ct];si&&(this.markUsedJustification(t,"left",Ge,si),this.markUsedOrientation(t,si,Ge))}if(Vt){const xn=ln?cl:zd(Et.icon),{placedIconSymbolIndex:tr,verticalPlacedIconSymbolIndex:Ln}=Ge,Fn=t.icon.placedSymbolArray,Yn=Et.icon.isHidden()?1:0;tr>=0&&(ze(t.icon,We,_n?cl:xn),Fn.get(tr).hidden=Yn),Ln>=0&&(ze(t.icon,Ge.numVerticalIconVertices,gn?cl:xn),Fn.get(Ln).hidden=Yn)}if(t.hasIconCollisionBoxData()||t.hasTextCollisionBoxData()){const xn=t.collisionArrays[ke];if(xn){let tr=new r.P(0,0),Ln=!0;if(xn.textBox||xn.verticalTextBox){if(Q){const Yn=this.variableOffsets[ct];Yn?(tr=Rd(Yn.anchor,Yn.width,Yn.height,Yn.textOffset,Yn.textScale),ue&&tr._rotate(ce?this.transform.angle:-this.transform.angle)):Ln=!1}V&&(Ln=!Et.clipped),xn.textBox&&_c(t.textCollisionBox.collisionVertexArray,Et.text.placed,!Ln||_n,dt,Ae,tr.x,tr.y),xn.verticalTextBox&&_c(t.textCollisionBox.collisionVertexArray,Et.text.placed,!Ln||gn,dt,Ae,tr.x,tr.y)}const Fn=Ln&&!!(!gn&&xn.verticalIconBox);xn.iconBox&&_c(t.iconCollisionBox.collisionVertexArray,Et.icon.placed,Fn,dt,Ae,Ge.hasIconTextFit?tr.x:0,Ge.hasIconTextFit?tr.y:0),xn.verticalIconBox&&_c(t.iconCollisionBox.collisionVertexArray,Et.icon.placed,!Fn,dt,Ae,Ge.hasIconTextFit?tr.x:0,Ge.hasIconTextFit?tr.y:0)}}}if(t.fullyClipped=Oe===0,t.sortFeatures(this.transform.angle),this.retainedQueryData[t.bucketInstanceId]&&(this.retainedQueryData[t.bucketInstanceId].featureSortOrder=t.featureSortOrder),t.hasTextData()&&t.text.opacityVertexBuffer&&t.text.opacityVertexBuffer.updateData(t.text.opacityVertexArray),t.hasIconData()&&t.icon.opacityVertexBuffer&&t.icon.opacityVertexBuffer.updateData(t.icon.opacityVertexArray),t.hasIconCollisionBoxData()&&t.iconCollisionBox.collisionVertexBuffer&&t.iconCollisionBox.collisionVertexBuffer.updateData(t.iconCollisionBox.collisionVertexArray),t.hasTextCollisionBoxData()&&t.textCollisionBox.collisionVertexBuffer&&t.textCollisionBox.collisionVertexBuffer.updateData(t.textCollisionBox.collisionVertexArray),t.bucketInstanceId in this.collisionCircleArrays){const ke=this.collisionCircleArrays[t.bucketInstanceId];t.placementInvProjMatrix=ke.invProjMatrix,t.placementViewportMatrix=ke.viewportMatrix,t.collisionCircleArray=ke.circles,delete this.collisionCircleArrays[t.bucketInstanceId]}}symbolFadeChange(t){return this.fadeDuration===0?1:(t-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(t){return Math.max(0,(this.transform.zoom-t)/1.5)}hasTransitions(t){return this.stale||t-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(t,o){const h=this.zoomAtLastRecencyCheck===o?1-this.zoomAdjustment(o):1;return this.zoomAtLastRecencyCheck=o,this.commitTime+this.fadeDuration*h>t}setStale(){this.stale=!0}}function _c(u,t,o,h,g,v,S){u.emplaceBack(t?1:0,o?1:0,v||0,S||0,h,g?1:0),u.emplaceBack(t?1:0,o?1:0,v||0,S||0,h,g?1:0),u.emplaceBack(t?1:0,o?1:0,v||0,S||0,h,g?1:0),u.emplaceBack(t?1:0,o?1:0,v||0,S||0,h,g?1:0)}const Dh=Math.pow(2,25),kd=Math.pow(2,24),Ju=Math.pow(2,17),Sp=Math.pow(2,16),Ep=Math.pow(2,9),Tu=Math.pow(2,8),Cu=Math.pow(2,1);function zd(u){if(u.opacity===0&&!u.placed)return 0;if(u.opacity===1&&u.placed)return 4294967295;const t=u.placed?1:0,o=Math.floor(127*u.opacity);return o*Dh+t*kd+o*Ju+t*Sp+o*Ep+t*Tu+o*Cu+t}const cl=0;class Uc{constructor(t){this._sortAcrossTiles=t.layout.get("symbol-z-order")!=="viewport-y"&&t.layout.get("symbol-sort-key").constantOr(1)!==void 0,this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs=new Set,this._bucketParts=[]}continuePlacement(t,o,h,g,v,S){const I=this._bucketParts;for(;this._currentTileIndex<t.length;)if(o.getBucketParts(I,g,t[this._currentTileIndex],this._sortAcrossTiles,S),this._currentTileIndex++,v())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,I.sort((L,D)=>L.sortKey-D.sortKey));this._currentPartIndex<I.length;){const L=I[this._currentPartIndex];if(o.placeLayerBucketPart(L,this._seenCrossTileIDs,h,L.symbolInstanceStart===0,S),this._currentPartIndex++,v())return!0}return!1}}class ja{constructor(t,o,h,g,v,S,I,L,D){this.placement=new Ko(t,v,S,I,L,D),this._currentPlacementIndex=o.length-1,this._forceFullPlacement=h,this._showCollisionBoxes=g,this._done=!1}isDone(){return this._done}continuePlacement(t,o,h,g,v){const S=r.q.now(),I=()=>{const L=r.q.now()-S;return!this._forceFullPlacement&&L>2};for(;this._currentPlacementIndex>=0;){const L=o[t[this._currentPlacementIndex]],D=this.placement.collisionIndex.transform.zoom;if(L.type==="symbol"&&(!L.minzoom||L.minzoom<=D)&&(!L.maxzoom||L.maxzoom>D)){const B=L,V=B.layout.get("symbol-z-elevate"),U=B.layout.get("symbol-sort-key").constantOr(1)!==void 0,G=B.layout.get("symbol-z-order"),re=G==="viewport-y"||G==="auto"&&!(G!=="viewport-y"&&U),Q=B.layout.get("text-allow-overlap")||B.layout.get("icon-allow-overlap")||B.layout.get("text-ignore-placement")||B.layout.get("icon-ignore-placement"),ue=re&&Q,ce=this._inProgressLayer=this._inProgressLayer||new Uc(B),ye=r.aC(L.source,L.scope);if(ce.continuePlacement(V||ue?g[ye]:h[ye],this.placement,this._showCollisionBoxes,L,I,v))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(t){return this.placement.commit(t),this.placement}}const Pl=512/r.ag/2;class Fh{constructor(t,o,h){this.tileID=t,this.bucketInstanceId=h,this.index=new r.bE(o.length,16,Int32Array),this.keys=[],this.crossTileIDs=[];const g=t.canonical.x*r.ag,v=t.canonical.y*r.ag;for(let S=0;S<o.length;S++){const{key:I,crossTileID:L,tileAnchorX:D,tileAnchorY:B}=o.get(S),V=Math.floor((g+D)*Pl),U=Math.floor((v+B)*Pl);this.index.add(V,U),this.keys.push(I),this.crossTileIDs.push(L)}this.index.finish()}findMatches(t,o,h){const g=this.tileID.canonical.z<o.canonical.z?1:Math.pow(2,this.tileID.canonical.z-o.canonical.z),v=Pl/Math.pow(2,o.canonical.z-this.tileID.canonical.z),S=o.canonical.x*r.ag,I=o.canonical.y*r.ag;for(let L=0;L<t.length;L++){const D=t.get(L);if(D.crossTileID)continue;const{key:B,tileAnchorX:V,tileAnchorY:U}=D,G=Math.floor((S+V)*v),re=Math.floor((I+U)*v),Q=this.index.range(G-g,re-g,G+g,re+g);for(const ue of Q){const ce=this.crossTileIDs[ue];if(this.keys[ue]===B&&!h.has(ce)){h.add(ce),D.crossTileID=ce;break}}}}}class Tp{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class Cf{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(t){const o=Math.round((t-this.lng)/360);if(o!==0)for(const h in this.indexes){const g=this.indexes[h],v={};for(const S in g){const I=g[S];I.tileID=I.tileID.unwrapTo(I.tileID.wrap+o),v[I.tileID.key]=I}this.indexes[h]=v}this.lng=t}addBucket(t,o,h){if(this.indexes[t.overscaledZ]&&this.indexes[t.overscaledZ][t.key]){if(this.indexes[t.overscaledZ][t.key].bucketInstanceId===o.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(t.overscaledZ,this.indexes[t.overscaledZ][t.key])}for(let v=0;v<o.symbolInstances.length;v++)o.symbolInstances.get(v).crossTileID=0;this.usedCrossTileIDs[t.overscaledZ]||(this.usedCrossTileIDs[t.overscaledZ]=new Set);const g=this.usedCrossTileIDs[t.overscaledZ];for(const v in this.indexes){const S=this.indexes[v];if(Number(v)>t.overscaledZ)for(const I in S){const L=S[I];L.tileID.isChildOf(t)&&L.findMatches(o.symbolInstances,t,g)}else{const I=S[t.scaledTo(Number(v)).key];I&&I.findMatches(o.symbolInstances,t,g)}}for(let v=0;v<o.symbolInstances.length;v++){const S=o.symbolInstances.get(v);S.crossTileID||(S.crossTileID=h.generate(),g.add(S.crossTileID))}return this.indexes[t.overscaledZ]===void 0&&(this.indexes[t.overscaledZ]={}),this.indexes[t.overscaledZ][t.key]=new Fh(t,o.symbolInstances,o.bucketInstanceId),!0}removeBucketCrossTileIDs(t,o){for(const h of o.crossTileIDs)this.usedCrossTileIDs[t].delete(h)}removeStaleBuckets(t){let o=!1;for(const h in this.indexes){const g=this.indexes[h];for(const v in g)t[g[v].bucketInstanceId]||(this.removeBucketCrossTileIDs(h,g[v]),delete g[v],o=!0)}return o}}class Mf{constructor(){this.layerIndexes={},this.crossTileIDs=new Tp,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(t,o,h,g){let v=this.layerIndexes[t.fqid];v===void 0&&(v=this.layerIndexes[t.fqid]=new Cf);let S=!1;const I={};g.name!=="globe"&&v.handleWrapJump(h);for(const L of o){const D=L.getBucket(t);D&&t.fqid===D.layerIds[0]&&(D.bucketInstanceId||(D.bucketInstanceId=++this.maxBucketInstanceId),v.addBucket(L.tileID,D,this.crossTileIDs)&&(S=!0),I[D.bucketInstanceId]=!0)}return v.removeStaleBuckets(I)&&(S=!0),S}pruneUnusedLayers(t){const o={};t.forEach(h=>{o[h]=!0});for(const h in this.layerIndexes)o[h]||delete this.layerIndexes[h]}}const Mu=771;class Sr{constructor(t,o,h,g){this.blendFunction=t,this.blendColor=o,this.mask=h,this.blendEquation=g}}Sr.Replace=[1,0,1,0],Sr.disabled=new Sr(Sr.Replace,r.aj.transparent,[!1,!1,!1,!1]),Sr.unblended=new Sr(Sr.Replace,r.aj.transparent,[!0,!0,!0,!0]),Sr.alphaBlended=new Sr([1,Mu,1,Mu],r.aj.transparent,[!0,!0,!0,!0]),Sr.alphaBlendedNonPremultiplied=new Sr([770,Mu,770,Mu],r.aj.transparent,[!0,!0,!0,!0]),Sr.multiply=new Sr([774,0,774,0],r.aj.transparent,[!0,!0,!0,!0]);class Dn{constructor(t,o,h){this.func=t,this.mask=o,this.range=h}}Dn.ReadOnly=!1,Dn.ReadWrite=!0,Dn.disabled=new Dn(519,Dn.ReadOnly,[0,1]);const Bh=7680;class or{constructor(t,o,h,g,v,S){this.test=t,this.ref=o,this.mask=h,this.fail=g,this.depthFail=v,this.pass=S}}or.disabled=new or({func:519,mask:0},0,0,Bh,Bh,Bh);const aa=1029,$a=2305;class Wn{constructor(t,o,h){this.enable=t,this.mode=o,this.frontFace=h}}function Nh(u,t){const o=r.bG(u,3);r.ab.mat4.fromQuat(u,t),r.bI(u,3,o)}function Qu(u,t){const o=r.ab.quat.identity([]);return r.ab.quat.rotateZ(o,o,-t),r.ab.quat.rotateX(o,o,-u),o}function Hc(u,t){const o=[u[0],u[1],0],h=[t[0],t[1],0];if(r.ab.vec3.length(o)>=1e-15){const S=r.ab.vec3.normalize([],o);r.ab.vec3.scale(h,S,r.ab.vec3.dot(h,S)),t[0]=h[0],t[1]=h[1]}const g=r.ab.vec3.cross([],t,u);if(r.ab.vec3.len(g)<1e-15)return null;const v=Math.atan2(-g[1],g[0]);return Qu(Math.atan2(Math.sqrt(u[0]*u[0]+u[1]*u[1]),-u[2]),v)}Wn.disabled=new Wn(!1,aa,$a),Wn.backCCW=new Wn(!0,aa,$a),Wn.backCW=new Wn(!0,aa,2304),Wn.frontCW=new Wn(!0,1028,2304),Wn.frontCCW=new Wn(!0,1028,$a);class yc{constructor(t,o){this.position=t,this.orientation=o}get position(){return this._position}set position(t){if(t){const o=t instanceof r.aa?t:new r.aa(t[0],t[1],t[2]);this._renderWorldCopies&&(o.x=r.bF(o.x,0,1)),this._position=o}else this._position=null}lookAtPoint(t,o){if(this.orientation=null,!this.position)return;const h=this.position,g=this._elevation?this._elevation.getAtPointOrZero(r.aa.fromLngLat(t)):0,v=r.aa.fromLngLat(t,g),S=[v.x-h.x,v.y-h.y,v.z-h.z];o||(o=[0,0,1]),o[2]=Math.abs(o[2]),this.orientation=Hc(S,o)}setPitchBearing(t,o){this.orientation=Qu(r.ai(t),r.ai(-o))}}class Ql{constructor(t,o){this._transform=r.ab.mat4.identity([]),this.orientation=o,this.position=t}get mercatorPosition(){const t=this.position;return new r.aa(t[0],t[1],t[2])}get position(){const t=r.bG(this._transform,3);return[t[0],t[1],t[2]]}set position(t){var o;t&&r.bI(this._transform,3,[(o=t)[0],o[1],o[2],1])}get orientation(){return this._orientation}set orientation(t){this._orientation=t||r.ab.quat.identity([]),t&&Nh(this._transform,this._orientation)}getPitchBearing(){const t=this.forward(),o=this.right();return{bearing:Math.atan2(-o[1],o[0]),pitch:Math.atan2(Math.sqrt(t[0]*t[0]+t[1]*t[1]),-t[2])}}setPitchBearing(t,o){this._orientation=Qu(t,o),Nh(this._transform,this._orientation)}forward(){const t=r.bG(this._transform,2);return[-t[0],-t[1],-t[2]]}up(){const t=r.bG(this._transform,1);return[-t[0],-t[1],-t[2]]}right(){const t=r.bG(this._transform,0);return[t[0],t[1],t[2]]}getCameraToWorld(t,o){const h=new Float64Array(16);return r.ab.mat4.invert(h,this.getWorldToCamera(t,o)),h}getCameraToWorldMercator(){return this._transform}getWorldToCameraPosition(t,o,h){const g=this.position;r.ab.vec3.scale(g,g,-t);const v=new Float64Array(16);return r.ab.mat4.fromScaling(v,[h,h,h]),r.ab.mat4.translate(v,v,g),v[10]*=o,v}getWorldToCamera(t,o){const h=new Float64Array(16),g=new Float64Array(4),v=this.position;return r.ab.quat.conjugate(g,this._orientation),r.ab.vec3.scale(v,v,-t),r.ab.mat4.fromQuat(h,g),r.ab.mat4.translate(h,h,v),h[1]*=-1,h[5]*=-1,h[9]*=-1,h[13]*=-1,h[8]*=o,h[9]*=o,h[10]*=o,h[11]*=o,h}getCameraToClipPerspective(t,o,h,g){const v=new Float64Array(16);return r.ab.mat4.perspective(v,t,o,h,g),v}getCameraToClipOrthographic(t,o,h,g,v,S){const I=new Float64Array(16);return r.ab.mat4.ortho(I,t,o,h,g,v,S),I}getDistanceToElevation(t,o=!1){const h=t===0?0:r.bH(t,o?r.aS(this.position[1]):this.position[1]),g=this.forward();return(h-this.position[2])/g[2]}clone(){return new Ql([...this.position],[...this.orientation])}}const ps={BaseColor:5,MetallicRoughness:6,Normal:7,Occlusion:8,Emission:9,LUT:10,ShadowMap0:11};class ms{constructor(t=0,o=0,h=0,g=0){if(isNaN(t)||t<0||isNaN(o)||o<0||isNaN(h)||h<0||isNaN(g)||g<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=t,this.bottom=o,this.left=h,this.right=g}interpolate(t,o,h){return o.top!=null&&t.top!=null&&(this.top=r.af(t.top,o.top,h)),o.bottom!=null&&t.bottom!=null&&(this.bottom=r.af(t.bottom,o.bottom,h)),o.left!=null&&t.left!=null&&(this.left=r.af(t.left,o.left,h)),o.right!=null&&t.right!=null&&(this.right=r.af(t.right,o.right,h)),this}getCenter(t,o){const h=r.aw((this.left+t-this.right)/2,0,t),g=r.aw((this.top+o-this.bottom)/2,0,o);return new r.P(h,g)}equals(t){return this.top===t.top&&this.bottom===t.bottom&&this.left===t.left&&this.right===t.right}clone(){return new ms(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}const eh=(u,t,o)=>(1-o)*u+o*t,pn=u=>u*u*u*u*u;class jh{constructor(t,o,h,g,v,S,I){this.tileSize=512,this._renderWorldCopies=v===void 0||v,this._minZoom=t||0,this._maxZoom=o||22,this._minPitch=h??0,this._maxPitch=g??60,this.setProjection(S),this.setMaxBounds(I),this.width=0,this.height=0,this._center=new r.bO(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._nearZ=0,this._farZ=0,this._unmodified=!0,this._edgeInsets=new ms,this._projMatrixCache={},this._alignedProjMatrixCache={},this._fogTileMatrixCache={},this._expandedProjMatrixCache={},this._distanceTileDataCache={},this._camera=new Ql,this._centerAltitude=0,this._averageElevation=0,this.cameraElevationReference="ground",this._pixelsPerMercatorPixel=1,this.globeRadius=0,this.globeCenterInViewSpace=[0,0,0],this._tileCoverLift=0,this.freezeTileCoverage=!1,this._horizonShift=.1,this._orthographicProjectionAtLowPitch=!1}clone(){const t=new jh(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies,this.getProjection());return t._elevation=this._elevation,t._centerAltitude=this._centerAltitude,t._centerAltitudeValidForExaggeration=this._centerAltitudeValidForExaggeration,t.tileSize=this.tileSize,t.mercatorFromTransition=this.mercatorFromTransition,t.width=this.width,t.height=this.height,t.cameraElevationReference=this.cameraElevationReference,t._center=this._center,t._setZoom(this.zoom),t._seaLevelZoom=this._seaLevelZoom,t.angle=this.angle,t._fov=this._fov,t._pitch=this._pitch,t._nearZ=this._nearZ,t._farZ=this._farZ,t._averageElevation=this._averageElevation,t._orthographicProjectionAtLowPitch=this._orthographicProjectionAtLowPitch,t._unmodified=this._unmodified,t._edgeInsets=this._edgeInsets.clone(),t._camera=this._camera.clone(),t._calcMatrices(),t.freezeTileCoverage=this.freezeTileCoverage,t.frustumCorners=this.frustumCorners,t}get isOrthographic(){return this.projection.name!=="globe"&&this._orthographicProjectionAtLowPitch&&this.pitch<15}get elevation(){return this._elevation}set elevation(t){this._elevation!==t&&(this._elevation=t,this._updateCameraOnTerrain(),this._calcMatrices())}get depthOcclusionForSymbolsAndCircles(){return this.projection.name!=="globe"&&!this.isOrthographic}updateElevation(t,o=!1){const h=this._elevation&&this._elevation.exaggeration()!==this._centerAltitudeValidForExaggeration;(this._seaLevelZoom==null||h)&&this._updateCameraOnTerrain(),(t||h)&&this._constrainCamera(o),this._calcMatrices()}getProjection(){return r.ay(this.projection,["name","center","parallels"])}setProjection(t){this.projectionOptions=t||{name:"mercator"};const o=this.projection?this.getProjection():void 0;this.projection=r.bP(this.projectionOptions);const h=this.getProjection(),g=!r.bn(o,h);return g&&this._calcMatrices(),this.mercatorFromTransition=!1,g}setOrthographicProjectionAtLowPitch(t){return this._orthographicProjectionAtLowPitch!==t&&(this._orthographicProjectionAtLowPitch=t,this._calcMatrices(),!0)}setMercatorFromTransition(){const t=this.projection.name;this.mercatorFromTransition=!0,this.projectionOptions={name:"mercator"},this.projection=r.bP({name:"mercator"});const o=t!==this.projection.name;return o&&this._calcMatrices(),o}get minZoom(){return this._minZoom}set minZoom(t){this._minZoom!==t&&(this._minZoom=t,this.zoom=Math.max(this.zoom,t))}get maxZoom(){return this._maxZoom}set maxZoom(t){this._maxZoom!==t&&(this._maxZoom=t,this.zoom=Math.min(this.zoom,t))}get minPitch(){return this._minPitch}set minPitch(t){this._minPitch!==t&&(this._minPitch=t,this.pitch=Math.max(this.pitch,t))}get maxPitch(){return this._maxPitch}set maxPitch(t){this._maxPitch!==t&&(this._maxPitch=t,this.pitch=Math.min(this.pitch,t))}get renderWorldCopies(){return this._renderWorldCopies&&this.projection.supportsWorldCopies===!0}set renderWorldCopies(t){t===void 0?t=!0:t===null&&(t=!1),this._renderWorldCopies=t}get worldSize(){return this.tileSize*this.scale}get cameraWorldSizeForFog(){const t=Math.max(this._camera.getDistanceToElevation(this._averageElevation),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(t))}get cameraWorldSize(){const t=Math.max(this._camera.getDistanceToElevation(this._averageElevation,!0),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(t))}get pixelsPerMeter(){return this.projection.pixelsPerMeter(this.center.lat,this.worldSize)}get cameraPixelsPerMeter(){return r.bH(1,this.center.lat)*this.cameraWorldSizeForFog}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new r.P(this.width,this.height)}get bearing(){return r.bF(this.rotation,-180,180)}set bearing(t){this.rotation=t}get rotation(){return-this.angle/Math.PI*180}set rotation(t){const o=-t*Math.PI/180;this.angle!==o&&(this._unmodified=!1,this.angle=o,this._calcMatrices(),this.rotationMatrix=r.ab.mat2.create(),r.ab.mat2.rotate(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(t){const o=r.aw(t,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==o&&(this._unmodified=!1,this._pitch=o,this._calcMatrices())}get aspect(){return this.width/this.height}get fov(){return this._fov/Math.PI*180}get fovX(){return this._fov}get fovY(){const t=1/Math.tan(.5*this.fovX);return 2*Math.atan(1/this.aspect/t)}set fov(t){t=Math.max(.01,Math.min(60,t)),this._fov!==t&&(this._unmodified=!1,this._fov=r.ai(t),this._calcMatrices())}get averageElevation(){return this._averageElevation}set averageElevation(t){this._averageElevation=t,this._calcFogMatrices(),this._distanceTileDataCache={}}get zoom(){return this._zoom}set zoom(t){const o=Math.min(Math.max(t,this.minZoom),this.maxZoom);this._zoom!==o&&(this._unmodified=!1,this._setZoom(o),this._updateSeaLevelZoom(),this._constrain(),this._calcMatrices())}_setZoom(t){this._zoom=t,this.scale=this.zoomScale(t),this.tileZoom=Math.floor(t),this.zoomFraction=t-this.tileZoom}get tileCoverLift(){return this._tileCoverLift}set tileCoverLift(t){this._tileCoverLift!==t&&(this._tileCoverLift=t)}_updateCameraOnTerrain(){const t=this.elevation?this.elevation.getAtPoint(this.locationCoordinate(this.center),Number.NEGATIVE_INFINITY):Number.NEGATIVE_INFINITY,o=this.elevation&&t===Number.NEGATIVE_INFINITY&&this.elevation.visibleDemTiles.length>0&&this.elevation.exaggeration()>0&&this._centerAltitudeValidForExaggeration;if(!this._elevation||t===Number.NEGATIVE_INFINITY&&(!o||!this._centerAltitude))return this._centerAltitude=0,this._seaLevelZoom=null,void(this._centerAltitudeValidForExaggeration=void 0);const h=this._elevation;o||this._centerAltitude&&this._centerAltitudeValidForExaggeration&&h.exaggeration()&&this._centerAltitudeValidForExaggeration!==h.exaggeration()?(this._centerAltitude=this._centerAltitude/this._centerAltitudeValidForExaggeration*h.exaggeration(),this._centerAltitudeValidForExaggeration=h.exaggeration()):(this._centerAltitude=t||0,this._centerAltitudeValidForExaggeration=h.exaggeration()),this._updateSeaLevelZoom()}_updateSeaLevelZoom(){this._centerAltitudeValidForExaggeration!==void 0&&(this._seaLevelZoom=this._zoomFromMercatorZ((this.pixelsPerMeter*this._centerAltitude+this.cameraToCenterDistance)/this.worldSize))}sampleAverageElevation(){if(!this._elevation)return 0;const t=this._elevation,o=[[.5,.2],[.3,.5],[.5,.5],[.7,.5],[.5,.8]],h=this.horizonLineFromTop();let g=0,v=0;for(let S=0;S<o.length;S++){const I=new r.P(o[S][0]*this.width,h+o[S][1]*(this.height-h)),L=t.pointCoordinate(I);if(!L)continue;const D=1/Math.hypot(L[0]-this._camera.position[0],L[1]-this._camera.position[1]);g+=L[3]*D,v+=D}return v===0?NaN:g/v}get center(){return this._center}set center(t){t.lat===this._center.lat&&t.lng===this._center.lng||(this._unmodified=!1,this._center=t,this._terrainEnabled()&&(this.cameraElevationReference==="ground"?this._updateCameraOnTerrain():this._updateZoomFromElevation()),this._constrain(),this._calcMatrices())}_updateZoomFromElevation(){if(this._seaLevelZoom==null||!this._elevation)return;const t=this._seaLevelZoom,o=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center)),h=this.pixelsPerMeter/this.worldSize*o,g=this._mercatorZfromZoom(t),v=this._mercatorZfromZoom(this._maxZoom),S=Math.max(g-h,v);this._setZoom(this._zoomFromMercatorZ(S))}get padding(){return this._edgeInsets.toJSON()}set padding(t){this._edgeInsets.equals(t)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,t,1),this._calcMatrices())}computeZoomRelativeTo(t){const o=this.rayIntersectionCoordinate(this.pointRayIntersection(this.centerPoint,t.toAltitude()));let h;h=t.z<this._camera.position[2]?[o.x,o.y,o.z]:[t.x,t.y,t.z];const g=r.ab.vec3.length(r.ab.vec3.sub([],this._camera.position,h));return r.aw(this._zoomFromMercatorZ(g),this._minZoom,this._maxZoom)}setFreeCameraOptions(t){if(!this.height||!t.position&&!t.orientation)return;this._updateCameraState();let o=!1;if(t.orientation&&!r.ab.quat.exactEquals(t.orientation,this._camera.orientation)&&(o=this._setCameraOrientation(t.orientation)),t.position){const h=[t.position.x,t.position.y,t.position.z];r.ab.vec3.exactEquals(h,this._camera.position)||(this._setCameraPosition(h),o=!0)}o&&(this._updateStateFromCamera(),this.recenterOnTerrain())}getFreeCameraOptions(){this._updateCameraState();const t=this._camera.position,o=new yc;return o.position=new r.aa(t[0],t[1],t[2]),o.orientation=this._camera.orientation,o._elevation=this.elevation,o._renderWorldCopies=this.renderWorldCopies,o}_setCameraOrientation(t){if(!r.ab.quat.length(t))return!1;r.ab.quat.normalize(t,t);const o=r.ab.vec3.transformQuat([],[0,0,-1],t),h=r.ab.vec3.transformQuat([],[0,-1,0],t);if(h[2]<0)return!1;const g=Hc(o,h);return!!g&&(this._camera.orientation=g,!0)}_setCameraPosition(t){const o=this.zoomScale(this.minZoom)*this.tileSize,h=this.zoomScale(this.maxZoom)*this.tileSize,g=this.cameraToCenterDistance;t[2]=r.aw(t[2],g/h,g/o),this._camera.position=t}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}get fovAboveCenter(){return this._fov*(.5+this.centerOffset.y/this.height)}isPaddingEqual(t){return this._edgeInsets.equals(t)}interpolatePadding(t,o,h){this._unmodified=!1,this._edgeInsets.interpolate(t,o,h),this._constrain(),this._calcMatrices()}coveringZoomLevel(t){const o=(t.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/t.tileSize));return Math.max(0,o)}getVisibleUnwrappedCoordinates(t){const o=[new r.bQ(0,t)];if(this.renderWorldCopies){const h=this.pointCoordinate(new r.P(0,0)),g=this.pointCoordinate(new r.P(this.width,0)),v=this.pointCoordinate(new r.P(this.width,this.height)),S=this.pointCoordinate(new r.P(0,this.height)),I=Math.floor(Math.min(h.x,g.x,v.x,S.x)),L=Math.floor(Math.max(h.x,g.x,v.x,S.x)),D=1;for(let B=I-D;B<=L+D;B++)B!==0&&o.push(new r.bQ(B,t))}return o}isLODDisabled(t){return(!t||this.pitch<=60)&&this._edgeInsets.top<=this._edgeInsets.bottom&&!this._elevation&&!this.projection.isReprojectedInTileSpace}extendTileCover(t,o,h){let g=[];const v=h!==void 0,S=!v;if(S&&this.zoom<o||v&&h[0]===0&&h[1]===0)return g;const I=new Set,L=(B,V,U,G,re)=>{const Q=r.c5(V,B,U,G,re);I.has(Q)||(g.push(new r.aG(B,V,U,G,re)),I.add(Q))};for(let B=0;B<t.length;B++){const V=t[B];if(S&&V.canonical.z!==o)continue;const U=V.canonical,G=V.overscaledZ,re=V.wrap,Q=1<<U.z,ue=U.x+1<Q,ce=U.x>0,ye=U.y+1<Q,Ae=U.y>0,Ee=V.wrap-(ce?0:1),Fe=V.wrap+(ue?0:1),ze=ce?U.x-1:Q-1,Oe=ue?U.x+1:0;if(v)h[0]<0?(L(G,Fe,U.z,Oe,U.y),h[1]<0&&ye&&(L(G,re,U.z,U.x,U.y+1),L(G,Fe,U.z,Oe,U.y+1)),h[1]>0&&Ae&&(L(G,re,U.z,U.x,U.y-1),L(G,Fe,U.z,Oe,U.y-1))):h[0]>0?(L(G,Ee,U.z,ze,U.y),h[1]<0&&ye&&(L(G,re,U.z,U.x,U.y+1),L(G,Ee,U.z,ze,U.y+1)),h[1]>0&&Ae&&(L(G,re,U.z,U.x,U.y-1),L(G,Ee,U.z,ze,U.y-1))):h[1]<0&&ye?L(G,re,U.z,U.x,U.y+1):Ae&&L(G,re,U.z,U.x,U.y-1);else{const ke=V.visibleQuadrants;1&ke&&(L(G,Ee,U.z,ze,U.y),Ae&&(L(G,re,U.z,U.x,U.y-1),L(G,Ee,U.z,ze,U.y-1))),2&ke&&(L(G,Fe,U.z,Oe,U.y),Ae&&(L(G,re,U.z,U.x,U.y-1),L(G,Fe,U.z,Oe,U.y-1))),4&ke&&(L(G,Ee,U.z,ze,U.y),ye&&(L(G,re,U.z,U.x,U.y+1),L(G,Ee,U.z,ze,U.y+1))),8&ke&&(L(G,Fe,U.z,Oe,U.y),ye&&(L(G,re,U.z,U.x,U.y+1),L(G,Fe,U.z,Oe,U.y+1)))}}const D=[];for(const B of g)g.some(V=>B.isChildOf(V))||D.push(B);if(g=D.filter(B=>!t.some(V=>!!(B.overscaledZ<o&&V.isChildOf(B))||B.equals(V)||B.isChildOf(V))),S){const B=1<<o,V=this.projection.name==="globe"?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),U=[B*V.x,B*V.y],G=4,re=G*G;g=g.filter(Q=>{const ue=Q.canonical.x+.5-U[0],ce=Q.canonical.y+.5-U[1];return ue*ue+ce*ce<re})}return g}coveringTiles(t){let o=this.coveringZoomLevel(t);const h=o,g=this.elevation&&this.elevation.exaggeration(),v=g&&!t.isTerrainDEM,S=this.projection.name==="mercator";if(t.minzoom!==void 0&&o<t.minzoom)return[];t.maxzoom!==void 0&&o>t.maxzoom&&(o=t.maxzoom);const I=this.locationCoordinate(this.center),L=this.center.lat,D=1<<o,B=[D*I.x,D*I.y,0],V=this.projection.name==="globe",U=!V,G=r.bR.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,o,U),re=V?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),Q=D*r.bH(1,this.center.lat),ue=this._camera.position[2]/r.bH(1,this.center.lat),ce=[D*re.x,D*re.y,ue*(U?1:Q)],ye=V||g,Ae=this.cameraToCenterDistance/t.tileSize*(t.roundZoom?1:.502),Ee=this.isLODDisabled(!0)?o:0;let Fe;if(this._elevation&&t.isTerrainDEM)Fe=1e4*this._elevation.exaggeration();else if(this._elevation){const dt=this._elevation.getMinMaxForVisibleTiles();Fe=dt?dt.max:this._centerAltitude}else Fe=this._centerAltitude;const ze=t.isTerrainDEM?-Fe:this._elevation?this._elevation.getMinElevationBelowMSL():0,Oe=this.projection.isReprojectedInTileSpace?r.bS(this):1,ke=dt=>{const Et=new r.aa(dt.x+25e-6,dt.y,dt.z),rn=new r.aa(dt.x,dt.y+25e-6,dt.z),Vt=dt.toLngLat(),kt=Et.toLngLat(),_n=rn.toLngLat(),gn=this.locationCoordinate(Vt),ln=this.locationCoordinate(kt),xn=this.locationCoordinate(_n),tr=Math.hypot(ln.x-gn.x,ln.y-gn.y),Ln=Math.hypot(xn.x-gn.x,xn.y-gn.y);return Math.sqrt(tr*Ln)*Oe/25e-6},Ge=dt=>{const Ft=Fe,Et=ze;return{aabb:r.bV(this,D,0,0,0,dt,Et,Ft,this.projection),zoom:0,x:0,y:0,minZ:Et,maxZ:Ft,wrap:dt,fullyVisible:!1}},Ze=[];let ft=[];const ct=o,We=t.reparseOverscaled?h:o,tt=(ue-this._centerAltitude)*Q,zt=dt=>{if(!this._elevation||!dt.tileID||!S)return;const Ft=this._elevation.getMinMaxForTile(dt.tileID),Et=dt.aabb;Ft?(Et.min[2]=Ft.min,Et.max[2]=Ft.max,Et.center[2]=(Et.min[2]+Et.max[2])/2):(dt.shouldSplit=Yt(dt),dt.shouldSplit||(Et.min[2]=Et.max[2]=Et.center[2]=this._centerAltitude))},Gt=(dt,Ft)=>{if(.707*Ft<dt)return 1;const Et=Ft/dt;return Et/(1.4144271570014144+(Math.pow(1.1,Et-1.4144271570014144+1)-1)/(1.1-1)-1)},Yt=dt=>{if(dt.zoom<Ee)return!0;if(dt.zoom===ct)return!1;if(dt.shouldSplit!=null)return dt.shouldSplit;const Ft=dt.aabb.distanceX(ce),Et=dt.aabb.distanceY(ce);let rn=tt,Vt=1;if(V){rn=dt.aabb.distanceZ(ce);const Ln=Math.pow(2,dt.zoom),Fn=r.aS((dt.y+1)/Ln),Yn=r.aS(dt.y/Ln),Dr=Math.min(Math.max(L,Fn),Yn),pr=r.c9(Dr)/r.c9(L);if(Vt=Dr===L?1/Math.max(1,this._mercatorScaleRatio-.3):Math.min(1,pr/this._mercatorScaleRatio),this.zoom<=r.c6&&dt.zoom===ct-1&&pr>=.9)return!0}else if(v&&(rn=dt.aabb.distanceZ(ce)*Q),this.projection.isReprojectedInTileSpace&&h<=5){const Ln=Math.pow(2,dt.zoom),Fn=ke(new r.aa((dt.x+.5)/Ln,(dt.y+.5)/Ln));Vt=Fn>.85?1:Fn}if(!S){const Ln=Math.sqrt(Ft*Ft+Et*Et+rn*rn);let Fn=(1<<ct-dt.zoom)*Ae*Vt;return Fn*=Gt(Math.max(rn,tt),Ln),Ln<Fn}let kt=Number.MAX_VALUE,_n=0;const gn=dt.aabb.getCorners(),ln=[];for(const Ln of gn){r.ab.vec3.sub(ln,Ln,ce),V||(v?ln[2]*=Q:ln[2]=tt);const Fn=r.ab.vec3.dot(ln,this._camera.forward());Fn<kt&&(kt=Fn,_n=Math.abs(ln[2]))}let xn=(1<<ct-dt.zoom)*Ae*Vt;if(xn*=Gt(Math.max(_n,tt),kt),kt<xn)return!0;const tr=dt.aabb.closestPoint(B);return tr[0]===B[0]&&tr[1]===B[1]};if(this.renderWorldCopies)for(let dt=1;dt<=3;dt++)Ze.push(Ge(-dt)),Ze.push(Ge(dt));for(Ze.push(Ge(0));Ze.length>0;){const dt=Ze.pop(),Ft=dt.x,Et=dt.y;let rn=dt.fullyVisible;const Vt=()=>this.projection.name==="globe"&&(dt.y===0||dt.y===(1<<dt.zoom)-1);if(!rn){let kt=ye?dt.aabb.intersects(G):dt.aabb.intersectsFlat(G);if(kt===0&&Vt()){const _n=new r.bT(dt.zoom,Ft,Et);kt=r.bU(this,D,_n,!0).intersects(G)}if(kt===0)continue;rn=kt===2}if(dt.zoom!==ct&&Yt(dt))for(let kt=0;kt<4;kt++){const _n=(Ft<<1)+kt%2,gn=(Et<<1)+(kt>>1),ln={aabb:S?dt.aabb.quadrant(kt):r.bV(this,D,dt.zoom+1,_n,gn,dt.wrap,dt.minZ,dt.maxZ,this.projection),zoom:dt.zoom+1,x:_n,y:gn,wrap:dt.wrap,fullyVisible:rn,tileID:void 0,shouldSplit:void 0,minZ:dt.minZ,maxZ:dt.maxZ};v&&!V&&(ln.tileID=new r.aG(dt.zoom+1===ct?We:dt.zoom+1,dt.wrap,dt.zoom+1,_n,gn),zt(ln)),Ze.push(ln)}else{const kt=dt.zoom===ct?We:dt.zoom;if(t.minzoom&&t.minzoom>kt)continue;let _n=0;if(!rn){let tr=ye?dt.aabb.intersectsPrecise(G):dt.aabb.intersectsPreciseFlat(G);if(tr===0&&Vt()){const Ln=new r.bT(dt.zoom,Ft,Et);tr=r.bU(this,D,Ln,!0).intersectsPrecise(G)}if(tr===0)continue;if(t.calculateQuadrantVisibility)if(G.containsPoint(dt.aabb.center))_n=15;else for(let Ln=0;Ln<4;Ln++)dt.aabb.quadrant(Ln).intersects(G)!==0&&(_n|=1<<Ln)}const gn=B[0]-(.5+Ft+(dt.wrap<<dt.zoom))*(1<<o-dt.zoom),ln=B[1]-.5-Et,xn=dt.tileID?dt.tileID:new r.aG(kt,dt.wrap,dt.zoom,Ft,Et);t.calculateQuadrantVisibility&&(xn.visibleQuadrants=_n),ft.push({tileID:xn,distanceSq:gn*gn+ln*ln})}}if(this.fogCullDistSq){const dt=this.fogCullDistSq,Ft=this.horizonLineFromTop();ft=ft.filter(Et=>{const rn=[0,0,0,1],Vt=[r.ag,r.ag,0,1],kt=this.calculateFogTileMatrix(Et.tileID.toUnwrapped());r.ab.vec4.transformMat4(rn,rn,kt),r.ab.vec4.transformMat4(Vt,Vt,kt);const _n=r.ab.vec4.min([],rn,Vt),gn=r.ab.vec4.max([],rn,Vt),ln=r.bW(_n,gn);if(ln===0)return!0;let xn=!1;const tr=this._elevation;if(tr&&ln>dt&&Ft!==0){const Ln=this.calculateProjMatrix(Et.tileID.toUnwrapped());let Fn;t.isTerrainDEM||(Fn=tr.getMinMaxForTile(Et.tileID)),Fn||(Fn={min:ze,max:Fe});const Yn=r.c7(this.rotation),Dr=[Yn[0]*r.ag,Yn[1]*r.ag,Fn.max];r.ab.vec3.transformMat4(Dr,Dr,Ln),xn=(1-Dr[1])*this.height*.5<Ft}return ln<dt||xn})}return ft.sort((dt,Ft)=>dt.distanceSq-Ft.distanceSq).map(dt=>dt.tileID)}resize(t,o){this.width=t,this.height=o,this.pixelsToGLUnits=[2/t,-2/o],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(t){return Math.pow(2,t)}scaleZoom(t){return Math.log(t)/Math.LN2}project(t){const o=r.aw(t.lat,-r.bX,r.bX),h=this.projection.project(t.lng,o);return new r.P(h.x*this.worldSize,h.y*this.worldSize)}unproject(t){return this.projection.unproject(t.x/this.worldSize,t.y/this.worldSize)}get point(){return this.project(this.center)}get pointMerc(){return this.point._div(this.worldSize)}get pixelsPerMeterRatio(){return this.pixelsPerMeter/r.bH(1,this.center.lat)/this.worldSize}setLocationAtPoint(t,o){let h,g;const v=this.centerPoint;if(this.projection.name==="globe"){const I=this.worldSize;h=(o.x-v.x)/I,g=(o.y-v.y)/I}else{const I=this.pointCoordinate(o),L=this.pointCoordinate(v);h=I.x-L.x,g=I.y-L.y}const S=this.locationCoordinate(t);this.setLocation(new r.aa(S.x-h,S.y-g))}setLocation(t){this.center=this.coordinateLocation(t),this.projection.wrap&&(this.center=this.center.wrap())}locationPoint(t){return this.projection.locationPoint(this,t)}locationPoint3D(t){return this.projection.locationPoint(this,t,!0)}pointLocation(t){return this.coordinateLocation(this.pointCoordinate(t))}pointLocation3D(t){return this.coordinateLocation(this.pointCoordinate3D(t))}locationCoordinate(t,o){const h=o?r.bH(o,t.lat):void 0,g=this.projection.project(t.lng,t.lat);return new r.aa(g.x,g.y,h)}coordinateLocation(t){return this.projection.unproject(t.x,t.y)}pointRayIntersection(t,o){const h=o??this._centerAltitude,g=[t.x,t.y,0,1],v=[t.x,t.y,1,1];r.ab.vec4.transformMat4(g,g,this.pixelMatrixInverse),r.ab.vec4.transformMat4(v,v,this.pixelMatrixInverse);const S=v[3];r.ab.vec4.scale(g,g,1/g[3]),r.ab.vec4.scale(v,v,1/S);const I=g[2],L=v[2];return{p0:g,p1:v,t:I===L?0:(h-I)/(L-I)}}screenPointToMercatorRay(t){const o=[t.x,t.y,0,1],h=[t.x,t.y,1,1];return r.ab.vec4.transformMat4(o,o,this.pixelMatrixInverse),r.ab.vec4.transformMat4(h,h,this.pixelMatrixInverse),r.ab.vec4.scale(o,o,1/o[3]),r.ab.vec4.scale(h,h,1/h[3]),o[2]=r.bH(o[2],this._center.lat)*this.worldSize,h[2]=r.bH(h[2],this._center.lat)*this.worldSize,r.ab.vec4.scale(o,o,1/this.worldSize),r.ab.vec4.scale(h,h,1/this.worldSize),new r.aq([o[0],o[1],o[2]],r.ab.vec3.normalize([],r.ab.vec3.sub([],h,o)))}rayIntersectionCoordinate(t){const{p0:o,p1:h,t:g}=t,v=r.bH(o[2],this._center.lat),S=r.bH(h[2],this._center.lat);return new r.aa(r.af(o[0],h[0],g)/this.worldSize,r.af(o[1],h[1],g)/this.worldSize,r.af(v,S,g))}pointCoordinate(t,o=this._centerAltitude){return this.projection.pointCoordinate(this,t.x,t.y,o)}pointCoordinate3D(t){if(!this.elevation)return this.pointCoordinate(t);let o=this.projection.pointCoordinate3D(this,t.x,t.y);if(o)return new r.aa(o[0],o[1],o[2]);let h=0,g=this.horizonLineFromTop();if(t.y>g)return this.pointCoordinate(t);const v=.02*g,S=t.clone();for(let I=0;I<10&&g-h>v;I++){S.y=r.af(h,g,.66);const L=this.projection.pointCoordinate3D(this,S.x,S.y);L?(g=S.y,o=L):h=S.y}return o?new r.aa(o[0],o[1],o[2]):this.pointCoordinate(t)}isPointAboveHorizon(t){return this.projection.isPointAboveHorizon(this,t)}isPointOnSurface(t){if(t.y<0||t.y>this.height||t.x<0||t.x>this.width)return!1;if(this.elevation||this.zoom>=r.bY)return!this.isPointAboveHorizon(t);const o=this.pointCoordinate(t);return o.y>=0&&o.y<=1}_coordinatePoint(t,o){const h=o&&this.elevation?this.elevation.getAtPointOrZero(t,this._centerAltitude):this._centerAltitude,g=[t.x*this.worldSize,t.y*this.worldSize,h+t.toAltitude(),1];return r.ab.vec4.transformMat4(g,g,this.pixelMatrix),g[3]>0?new r.P(g[0]/g[3],g[1]/g[3]):new r.P(Number.MAX_VALUE,Number.MAX_VALUE)}_getBoundsNonRectangular(){const{top:t,left:o}=this._edgeInsets,h=this.height-this._edgeInsets.bottom,g=this.width-this._edgeInsets.right,v=this.pointLocation3D(new r.P(o,t)),S=this.pointLocation3D(new r.P(g,t)),I=this.pointLocation3D(new r.P(g,h)),L=this.pointLocation3D(new r.P(o,h));let D=Math.min(v.lng,S.lng,I.lng,L.lng),B=Math.max(v.lng,S.lng,I.lng,L.lng),V=Math.min(v.lat,S.lat,I.lat,L.lat),U=Math.max(v.lat,S.lat,I.lat,L.lat);const G=Math.pow(2,-this.zoom)/16*270,re=this.projection.name==="globe"?1:4,Q=(ue,ce,ye,Ae,Ee)=>{const Fe=(ue+ye)/2,ze=(ce+Ae)/2,Oe=new r.P(Fe,ze),{lng:ke,lat:Ge}=this.pointLocation3D(Oe),Ze=Math.max(0,D-ke,V-Ge,ke-B,Ge-U);D=Math.min(D,ke),B=Math.max(B,ke),V=Math.min(V,Ge),U=Math.max(U,Ge),(Ee<re||Ze>G)&&(Q(ue,ce,Fe,ze,Ee+1),Q(Fe,ze,ye,Ae,Ee+1))};if(Q(o,t,g,t,1),Q(g,t,g,h,1),Q(g,h,o,h,1),Q(o,h,o,t,1),this.projection.name==="globe"){const[ue,ce]=r.bZ(this);ue?(U=90,B=180,D=-180):ce&&(V=-90,B=180,D=-180)}return new r.az(new r.bO(D,V),new r.bO(B,U))}_getBoundsRectangular(t,o){const{top:h,left:g}=this._edgeInsets,v=this.height-this._edgeInsets.bottom,S=this.width-this._edgeInsets.right,I=new r.P(g,h),L=new r.P(S,h),D=new r.P(S,v),B=new r.P(g,v);let V=this.pointCoordinate(I,t),U=this.pointCoordinate(L,t);const G=this.pointCoordinate(D,o),re=this.pointCoordinate(B,o),Q=(ue,ce)=>(ce.y-ue.y)/(ce.x-ue.x);return V.y>1&&U.y>=0?V=new r.aa((1-re.y)/Q(re,V)+re.x,1):V.y<0&&U.y<=1&&(V=new r.aa(-re.y/Q(re,V)+re.x,0)),U.y>1&&V.y>=0?U=new r.aa((1-G.y)/Q(G,U)+G.x,1):U.y<0&&V.y<=1&&(U=new r.aa(-G.y/Q(G,U)+G.x,0)),new r.az().extend(this.coordinateLocation(V)).extend(this.coordinateLocation(U)).extend(this.coordinateLocation(re)).extend(this.coordinateLocation(G))}_getBoundsRectangularTerrain(){const t=this.elevation;if(!t.visibleDemTiles.length||t.isUsingMockSource())return this._getBoundsRectangular(0,0);const o=t.visibleDemTiles.reduce((h,g)=>{if(g.dem){const v=g.dem.tree;h.min=Math.min(h.min,v.minimums[0]),h.max=Math.max(h.max,v.maximums[0])}return h},{min:Number.MAX_VALUE,max:0});return this._getBoundsRectangular(o.min*t.exaggeration(),o.max*t.exaggeration())}getBounds(){return this.projection.name==="mercator"||this.projection.name==="equirectangular"?this._terrainEnabled()?this._getBoundsRectangularTerrain():this._getBoundsRectangular(0,0):this._getBoundsNonRectangular()}horizonLineFromTop(t=!0){const o=this.height/2/Math.tan(this._fov/2)/Math.tan(Math.max(this._pitch,.1))-this.centerOffset.y,h=this.height/2-o*(1-this._horizonShift);return t?Math.max(0,h):h}getMaxBounds(){return this.maxBounds}setMaxBounds(t){this.maxBounds=t,this.minLat=-r.bX,this.maxLat=r.bX,this.minLng=-180,this.maxLng=180,t&&(this.minLat=t.getSouth(),this.maxLat=t.getNorth(),this.minLng=t.getWest(),this.maxLng=t.getEast(),this.maxLng<this.minLng&&(this.maxLng+=360)),this.worldMinX=r.at(this.minLng)*this.tileSize,this.worldMaxX=r.at(this.maxLng)*this.tileSize,this.worldMinY=r.aA(this.maxLat)*this.tileSize,this.worldMaxY=r.aA(this.minLat)*this.tileSize,this._constrain()}calculatePosMatrix(t,o){return this.projection.createTileMatrix(this,o,t)}calculateDistanceTileData(t){const o=t.key,h=this._distanceTileDataCache;if(h[o])return h[o];const g=t.canonical,v=1/this.height,S=this.cameraWorldSize,I=S/this.zoomScale(g.z),L=(g.x+Math.pow(2,g.z)*t.wrap)*I,D=g.y*I,B=this.point;B.x*=S/this.worldSize,B.y*=S/this.worldSize;const V=this.angle,U=Math.sin(-V),G=-Math.cos(-V);return h[o]={bearing:[U,G],center:[(B.x-L)*v,(B.y-D)*v],scale:I/r.ag*v},h[o]}calculateFogTileMatrix(t){const o=t.key,h=this._fogTileMatrixCache;if(h[o])return h[o];const g=this.projection.createTileMatrix(this,this.cameraWorldSizeForFog,t);return r.ab.mat4.multiply(g,this.worldToFogMatrix,g),h[o]=new Float32Array(g),h[o]}calculateProjMatrix(t,o=!1,h=!1){const g=t.key;let v;if(v=h?this._expandedProjMatrixCache:o?this._alignedProjMatrixCache:this._projMatrixCache,v[g])return v[g];const S=this.calculatePosMatrix(t,this.worldSize);let I;return I=this.projection.isReprojectedInTileSpace?this.mercatorMatrix:h?this.expandedFarZProjMatrix:o?this.alignedProjMatrix:this.projMatrix,r.ab.mat4.multiply(S,I,S),v[g]=new Float32Array(S),v[g]}calculatePixelsToTileUnitsMatrix(t){const o=t.tileID.key,h=this._pixelsToTileUnitsCache;if(h[o])return h[o];const g=r.b_(t,this);return h[o]=g,h[o]}customLayerMatrix(){return this.mercatorMatrix.slice()}globeToMercatorMatrix(){if(this.projection.name==="globe"){const t=1/this.worldSize,o=r.ab.mat4.fromScaling([],[t,t,t]);return r.ab.mat4.multiply(o,o,this.globeMatrix),o}}recenterOnTerrain(){if(!this._elevation||this.projection.name==="globe")return;const t=this._elevation;this._updateCameraState();const o=r.bH(1,this._center.lat)*this.worldSize,h=this._computeCameraPosition(o),g=this._camera.forward(),v=r.bH(1,this._center.lat);h[2]/=v,g[2]/=v,r.ab.vec3.normalize(g,g);const S=t.raycast(h,g,t.exaggeration());if(S){const I=r.ab.vec3.scaleAndAdd([],h,g,S),L=new r.aa(I[0],I[1],r.bH(I[2],r.aS(I[1]))),D=(L.z+r.ab.vec3.length([L.x-h[0],L.y-h[1],L.z-h[2]*v]))*this._pixelsPerMercatorPixel;this._seaLevelZoom=this._zoomFromMercatorZ(D),this._centerAltitude=L.toAltitude(),this._center=this.coordinateLocation(L),this._updateZoomFromElevation(),this._constrain(),this._calcMatrices()}}_constrainCamera(t=!1){if(!this._elevation)return;const o=this._elevation,h=r.bH(1,this._center.lat)*this.worldSize,g=this._computeCameraPosition(h),v=o.getAtPointOrZero(new r.aa(...g)),S=this.pixelsPerMeter/this.worldSize*v,I=this._minimumHeightOverTerrain(),L=g[2]-S;if(L<=I)if(L<0||t){const D=this.locationCoordinate(this._center,this._centerAltitude),B=[g[0],g[1],D.z-g[2]],V=r.ab.vec3.length(B);B[2]-=(I-L)/this._pixelsPerMercatorPixel;const U=r.ab.vec3.length(B);if(U===0)return;r.ab.vec3.scale(B,B,V/U*this._pixelsPerMercatorPixel),this._camera.position=[g[0],g[1],D.z*this._pixelsPerMercatorPixel-B[2]],this._updateStateFromCamera()}else this._isCameraConstrained=!0}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;const t=this.projection.name==="globe"||this.mercatorFromTransition;if(this.projection.isReprojectedInTileSpace||t){const U=this.center;return U.lat=r.aw(U.lat,this.minLat,this.maxLat),(this.maxBounds||!this.renderWorldCopies&&!t)&&(U.lng=r.aw(U.lng,this.minLng,this.maxLng)),this.center=U,void(this._constraining=!1)}const o=this._unmodified,{x:h,y:g}=this.point;let v=0,S=h,I=g;const L=this.width/2,D=this.height/2,B=this.worldMinY*this.scale,V=this.worldMaxY*this.scale;if(g-D<B&&(I=B+D),g+D>V&&(I=V-D),V-B<this.height&&(v=Math.max(v,this.height/(V-B)),I=(V+B)/2),this.maxBounds||!this._renderWorldCopies||!this.projection.wrap){const U=this.worldMinX*this.scale,G=this.worldMaxX*this.scale,re=this.worldSize/2-(U+G)/2;S=(h+re+this.worldSize)%this.worldSize-re,S-L<U&&(S=U+L),S+L>G&&(S=G-L),G-U<this.width&&(v=Math.max(v,this.width/(G-U)),S=(G+U)/2)}S===h&&I===g||(this.center=this.unproject(new r.P(S,I))),v&&(this.zoom+=this.scaleZoom(v)),this._constrainCamera(),this._unmodified=o,this._constraining=!1}_minZoomForBounds(){let t=Math.max(0,this.scaleZoom(this.height/(this.worldMaxY-this.worldMinY)));return this.maxBounds&&(t=Math.max(t,this.scaleZoom(this.width/(this.worldMaxX-this.worldMinX)))),t}_maxCameraBoundsDistance(){return this._mercatorZfromZoom(this._minZoomForBounds())}_calcMatrices(){if(!this.height)return;const t=this.centerOffset,o=this.projection.name==="globe",h=this.pixelsPerMeter;this.projection.name==="globe"&&(this._mercatorScaleRatio=r.bH(1,this.center.lat)/r.bH(1,r.c8));const g=r.b$(this.projection,this.zoom,this.width,this.height,1024);this._pixelsPerMercatorPixel=this.projection.pixelSpaceConversion(this.center.lat,this.worldSize,g),this.cameraToCenterDistance=.5/Math.tan(.5*this._fov)*this.height*this._pixelsPerMercatorPixel,this._updateCameraState(),this._farZ=this.projection.farthestPixelDistance(this),this._nearZ=this.height/50;const v=this.projection.zAxisUnit==="meters"?h:1,S=this._camera.getWorldToCamera(this.worldSize,v);let I;const L=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,this._farZ);if(L[8]=2*-t.x/this.width,L[9]=2*t.y/this.height,this.isOrthographic){let Ge=.5*this.height/Math.tan(this._fov/2)*1*Math.tan(.5*this._fov),Ze=Ge*this.aspect,ft=-Ze,ct=-Ge;Ze-=t.x,ft-=t.x,Ge+=t.y,ct+=t.y,I=this._camera.getCameraToClipOrthographic(ft,Ze,ct,Ge,this._nearZ,this._farZ),((We,tt,zt,Gt)=>{for(let Yt=0;Yt<16;Yt++)We[Yt]=eh(tt[Yt],zt[Yt],Gt)})(I,I,L,pn(this.pitch>=15?1:this.pitch/15))}else I=L;const D=r.ab.mat4.mul([],L,S);let B=r.ab.mat4.mul([],I,S);if(this.projection.isReprojectedInTileSpace){const Ge=this.locationCoordinate(this.center),Ze=r.ab.mat4.identity([]);r.ab.mat4.translate(Ze,Ze,[Ge.x*this.worldSize,Ge.y*this.worldSize,0]),r.ab.mat4.multiply(Ze,Ze,r.c0(this)),r.ab.mat4.translate(Ze,Ze,[-Ge.x*this.worldSize,-Ge.y*this.worldSize,0]),r.ab.mat4.multiply(B,B,Ze),r.ab.mat4.multiply(D,D,Ze),this.inverseAdjustmentMatrix=r.c1(this)}else this.inverseAdjustmentMatrix=[1,0,0,1];if(this.mercatorMatrix=r.ab.mat4.scale([],B,[this.worldSize,this.worldSize,this.worldSize/v,1]),this.projMatrix=B,this.invProjMatrix=r.ab.mat4.invert(new Float64Array(16),this.projMatrix),o){const Ge=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,1/0);Ge[8]=2*-t.x/this.width,Ge[9]=2*t.y/this.height,this.expandedFarZProjMatrix=r.ab.mat4.mul([],Ge,S)}else this.expandedFarZProjMatrix=this.projMatrix;const V=r.ab.mat4.invert([],I);this.frustumCorners=r.c2.fromInvProjectionMatrix(V,this.horizonLineFromTop(),this.height),this.cameraFrustum=r.bR.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,0,!o);const U=new Float32Array(16);r.ab.mat4.identity(U),r.ab.mat4.scale(U,U,[1,-1,1]),r.ab.mat4.rotateX(U,U,this._pitch),r.ab.mat4.rotateZ(U,U,this.angle);const G=r.ab.mat4.perspective(new Float32Array(16),this._fov,this.width/this.height,this._nearZ,this._farZ);this.starsProjMatrix=r.ab.mat4.clone(G);const re=(Math.PI/2-this._pitch)*(this.height/this._fov)*this._horizonShift;G[8]=2*-t.x/this.width,G[9]=2*(t.y+re)/this.height,this.skyboxMatrix=r.ab.mat4.multiply(U,G,U);const Q=this.point,ue=Q.x,ce=Q.y,ye=this.width%2/2,Ae=this.height%2/2,Ee=Math.cos(this.angle),Fe=Math.sin(this.angle),ze=ue-Math.round(ue)+Ee*ye+Fe*Ae,Oe=ce-Math.round(ce)+Ee*Ae+Fe*ye,ke=new Float64Array(B);if(r.ab.mat4.translate(ke,ke,[ze>.5?ze-1:ze,Oe>.5?Oe-1:Oe,0]),this.alignedProjMatrix=ke,B=r.ab.mat4.create(),r.ab.mat4.scale(B,B,[this.width/2,-this.height/2,1]),r.ab.mat4.translate(B,B,[1,-1,0]),this.labelPlaneMatrix=B,B=r.ab.mat4.create(),r.ab.mat4.scale(B,B,[1,-1,1]),r.ab.mat4.translate(B,B,[-1,-1,0]),r.ab.mat4.scale(B,B,[2/this.width,2/this.height,1]),this.glCoordMatrix=B,this.pixelMatrix=r.ab.mat4.multiply(new Float64Array(16),this.labelPlaneMatrix,D),this._calcFogMatrices(),this._distanceTileDataCache={},B=r.ab.mat4.invert(new Float64Array(16),this.pixelMatrix),!B)throw new Error("failed to invert matrix");if(this.pixelMatrixInverse=B,this.projection.name==="globe"||this.mercatorFromTransition){this.globeMatrix=r.c3(this);const Ge=[this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]];this.globeCenterInViewSpace=r.ab.vec3.transformMat4(Ge,Ge,S),this.globeRadius=this.worldSize/2/Math.PI-1}else this.globeMatrix=B;this._projMatrixCache={},this._alignedProjMatrixCache={},this._pixelsToTileUnitsCache={},this._expandedProjMatrixCache={}}_calcFogMatrices(){this._fogTileMatrixCache={};const t=this.cameraWorldSizeForFog,o=this.cameraPixelsPerMeter,h=this._camera.position,g=1/this.height/this._pixelsPerMercatorPixel,v=[t,t,o];r.ab.vec3.scale(v,v,g),r.ab.vec3.scale(h,h,-1),r.ab.vec3.multiply(h,h,v);const S=r.ab.mat4.create();r.ab.mat4.translate(S,S,h),r.ab.mat4.scale(S,S,v),this.mercatorFogMatrix=S,this.worldToFogMatrix=this._camera.getWorldToCameraPosition(t,o,g)}_computeCameraPosition(t){const o=(t=t||this.pixelsPerMeter)/this.pixelsPerMeter,h=this._camera.forward(),g=this.point,v=this._mercatorZfromZoom(this._seaLevelZoom?this._seaLevelZoom:this._zoom)*o-t/this.worldSize*this._centerAltitude;return[g.x/this.worldSize-h[0]*v,g.y/this.worldSize-h[1]*v,t/this.worldSize*this._centerAltitude-h[2]*v]}_updateCameraState(){this.height&&(this._camera.setPitchBearing(this._pitch,this.angle),this._camera.position=this._computeCameraPosition())}_translateCameraConstrained(t){const o=this._maxCameraBoundsDistance()*Math.cos(this._pitch),h=this._camera.position[2],g=t[2];let v=1;this.projection.wrap&&(this.center=this.center.wrap()),g>0&&(v=Math.min((o-h)/g,1)),this._camera.position=r.ab.vec3.scaleAndAdd([],this._camera.position,t,v),this._updateStateFromCamera()}_updateStateFromCamera(){const t=this._camera.position,o=this._camera.forward(),{pitch:h,bearing:g}=this._camera.getPitchBearing(),v=r.bH(this._centerAltitude,this.center.lat)*this._pixelsPerMercatorPixel,S=this._mercatorZfromZoom(this._maxZoom)*Math.cos(r.ai(this._maxPitch)),I=Math.max((t[2]-v)/Math.cos(h),S),L=this._zoomFromMercatorZ(I);r.ab.vec3.scaleAndAdd(t,t,o,I),this._pitch=r.aw(h,r.ai(this.minPitch),r.ai(this.maxPitch)),this.angle=r.bF(g,-Math.PI,Math.PI),this._setZoom(r.aw(L,this._minZoom,this._maxZoom)),this._updateSeaLevelZoom(),this._center=this.coordinateLocation(new r.aa(t[0],t[1],t[2])),this._unmodified=!1,this._constrain(),this._calcMatrices()}_worldSizeFromZoom(t){return Math.pow(2,t)*this.tileSize}_mercatorZfromZoom(t){return this.cameraToCenterDistance/this._worldSizeFromZoom(t)}_minimumHeightOverTerrain(){const t=Math.min(this._seaLevelZoom!=null?this._seaLevelZoom:this._zoom,this._maxZoom)+4;return this._mercatorZfromZoom(t)}_zoomFromMercatorZ(t){return this.scaleZoom(this.cameraToCenterDistance/(t*this.tileSize))}zoomFromMercatorZAdjusted(t){let o=0,h=r.bY,g=0,v=1/0;for(;h-o>1e-6&&h>o;){const S=o+.5*(h-o),I=this.tileSize*Math.pow(2,S),L=this.getCameraToCenterDistance(this.projection,S,I),D=this.scaleZoom(L/(t*this.tileSize)),B=Math.abs(S-D);B<v&&(v=B,g=S),S<D?o=S:h=S}return g}_terrainEnabled(){return!(!this._elevation||!this.projection.supportsTerrain&&(r.w("Terrain is not yet supported with alternate projections. Use mercator or globe to enable terrain."),1))}anyCornerOffEdge(t,o){const h=Math.min(t.x,o.x),g=Math.max(t.x,o.x),v=Math.min(t.y,o.y),S=Math.max(t.y,o.y);if(v<this.horizonLineFromTop(!1))return!0;if(this.projection.name!=="mercator")return!1;const I=[new r.P(h,v),new r.P(g,S),new r.P(h,S),new r.P(g,v)],L=this.renderWorldCopies?-3:0,D=this.renderWorldCopies?4:1;for(const B of I){const V=this.pointRayIntersection(B);if(V.t<0)return!0;const U=this.rayIntersectionCoordinate(V);if(U.x<L||U.y<0||U.x>D||U.y>1)return!0}return!1}isHorizonVisible(){return this.pitch+r.c4(this.fovAboveCenter)>88||this.anyCornerOffEdge(new r.P(0,0),new r.P(this.width,this.height))}zoomDeltaToMovement(t,o){const h=r.ab.vec3.length(r.ab.vec3.sub([],this._camera.position,t)),g=this._zoomFromMercatorZ(h)+o;return h-this._mercatorZfromZoom(g)}getCameraPoint(){if(this.projection.name==="globe"){const t=function([o,h,g],v){const S=[o,h,g,1];r.ab.vec4.transformMat4(S,S,v);const I=S[3]=Math.max(S[3],1e-6);return S[0]/=I,S[1]/=I,S[2]/=I,S}([this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]],this.pixelMatrix);return new r.P(t[0],t[1])}{const t=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new r.P(0,t))}}getCameraToCenterDistance(t,o=this.zoom,h=this.worldSize){const g=r.b$(t,o,this.width,this.height,1024),v=t.pixelSpaceConversion(this.center.lat,h,g);let S=.5/Math.tan(.5*this._fov)*this.height*v;return this.isOrthographic&&(S=eh(1,S,pn(this.pitch>=15?1:this.pitch/15))),S}getWorldToCameraMatrix(){const t=this._camera.getWorldToCamera(this.worldSize,this.projection.zAxisUnit==="meters"?this.pixelsPerMeter:1);return this.projection.name==="globe"&&r.ab.mat4.multiply(t,t,this.globeMatrix),t}getFrustum(t){return r.bR.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,t,this.projection.zAxisUnit==="meters")}}const ul=(u,t)=>{if(t>0&&u.terrain&&r.w("Cutoff is currently disabled on terrain"),t<=0||u.terrain)return{shouldRenderCutoff:!1,uniformValues:{u_cutoff_params:[0,0,0,1]}};const o=u.transform,h=Math.max(Math.abs(o._zoom-(u.minCutoffZoom-1)),1),g=o.isLODDisabled(!1)?r.ac(60,45,o.pitch):r.ac(30,15,o.pitch),v=o._farZ-o._nearZ,S=t*o.height,I=((1-(L=g))*o.cameraToCenterDistance+L*(o._farZ+S))*h;var L;return{shouldRenderCutoff:g<1,uniformValues:{u_cutoff_params:[o._nearZ,o._farZ,(I-o._nearZ)/v,(I-S-o._nearZ)/v]}}},Jo={cascadeCount:2,normalOffset:3,shadowMapResolution:2048};class Wc{constructor(t,o){this.aabb=t,this.lastCascade=o}}class hl{add(t,o){const h=this.receivers[t.key];h!==void 0?(h.aabb.min[0]=Math.min(h.aabb.min[0],o.min[0]),h.aabb.min[1]=Math.min(h.aabb.min[1],o.min[1]),h.aabb.min[2]=Math.min(h.aabb.min[2],o.min[2]),h.aabb.max[0]=Math.max(h.aabb.max[0],o.max[0]),h.aabb.max[1]=Math.max(h.aabb.max[1],o.max[1]),h.aabb.max[2]=Math.max(h.aabb.max[2],o.max[2])):this.receivers[t.key]=new Wc(o,null)}clear(){this.receivers={}}get(t){return this.receivers[t.key]}computeRequiredCascades(t,o,h){const g=r.cd.fromPoints(t.points);let v=0;for(const S in this.receivers){const I=this.receivers[S];if(!I||!g.intersectsAabb(I.aabb))continue;I.aabb.min=g.closestPoint(I.aabb.min),I.aabb.max=g.closestPoint(I.aabb.max);const L=I.aabb.getCorners();for(let D=0;D<h.length;D++){let B=!0;for(const V of L){const U=[V[0]*o,V[1]*o,V[2]];if(r.ab.vec3.transformMat4(U,U,h[D].matrix),U[0]<-1||U[0]>1||U[1]<-1||U[1]>1){B=!1;break}}if(I.lastCascade=D,v=Math.max(v,D),B)break}}return v+1}}class Rl{constructor(t){this.painter=t,this._enabled=!1,this._shadowLayerCount=0,this._numCascadesToRender=0,this._cascades=[],this._groundShadowTiles=[],this._receivers=new hl,this._depthMode=new Dn(t.context.gl.LEQUAL,Dn.ReadWrite,[0,1]),this._uniformValues={u_light_matrix_0:new Float32Array(16),u_light_matrix_1:new Float32Array(16),u_shadow_intensity:0,u_fade_range:[0,0],u_shadow_normal_offset:[1,1,1],u_shadow_texel_size:1,u_shadow_map_resolution:1,u_shadow_direction:[0,0,1],u_shadow_bias:[36e-5,.0012,.012],u_shadowmap_0:0,u_shadowmap_1:0},this._forceDisable=!1,this.useNormalOffset=!1,t.tp.registerParameter(this,["Shadows"],"_forceDisable",{label:"forceDisable"},()=>{this.painter.style.map.triggerRepaint()}),t.tp.registerParameter(Jo,["Shadows"],"cascadeCount",{min:1,max:2,step:1}),t.tp.registerParameter(Jo,["Shadows"],"normalOffset",{min:0,max:10,step:.05}),t.tp.registerParameter(Jo,["Shadows"],"shadowMapResolution",{min:32,max:2048,step:32}),t.tp.registerBinding(this,["Shadows"],"_numCascadesToRender",{readonly:!0,label:"numCascadesToRender"})}destroy(){for(const t of this._cascades)t.texture.destroy(),t.framebuffer.destroy();this._cascades=[]}updateShadowParameters(t,o){const h=this.painter;if(this._enabled=!1,this._shadowLayerCount=0,this._receivers.clear(),!o||!o.properties)return;const g=o.properties.get("shadow-intensity");if(!o.shadowsEnabled()||g<=0||(this._shadowLayerCount=h.style.order.reduce((re,Q)=>{const ue=h.style._mergedLayers[Q];return re+(ue.hasShadowPass()&&!ue.isHidden(t.zoom)?1:0)},0),this._enabled=this._shadowLayerCount>0,!this.enabled))return;const v=h.context,S=Jo.shadowMapResolution,I=Jo.shadowMapResolution;if(this._cascades.length===0||Jo.shadowMapResolution!==this._cascades[0].texture.size[0]){this._cascades=[];for(let re=0;re<Jo.cascadeCount;++re){const Q=h._shadowMapDebug,ue=v.gl,ce=v.createFramebuffer(S,I,Q,"texture"),ye=new r.T(v,{width:S,height:I,data:null},ue.DEPTH_COMPONENT16);if(ce.depthAttachment.set(ye.texture),Q){const Ae=new r.T(v,{width:S,height:I,data:null},ue.RGBA8);ce.colorAttachment.set(Ae.texture)}this._cascades.push({framebuffer:ce,texture:ye,matrix:[],far:0,boundingSphereRadius:0,frustum:new r.bR,scale:0})}}this.shadowDirection=gs(o);let L=0;if(t.elevation){const re=t.elevation,Q=[1e4,-1e4];re.visibleDemTiles.filter(ue=>ue.dem).forEach(ue=>{const ce=ue.dem.tree;Q[0]=Math.min(Q[0],ce.minimums[0]),Q[1]=Math.max(Q[1],ce.maximums[0])}),Q[0]!==1e4&&(L=(Q[1]-Q[0])*re.exaggeration())}const D=1.5*t.cameraToCenterDistance,B=3*D,V=new Float64Array(16);for(let re=0;re<this._cascades.length;++re){const Q=this._cascades[re];let ue=t.height/50,ce=1;Jo.cascadeCount===1?ce=B:re===0?ce=D:(ue=D,ce=B);const[ye,Ae]=vc(t,this.shadowDirection,ue,ce,Jo.shadowMapResolution,L);Q.scale=t.scale,Q.matrix=ye,Q.boundingSphereRadius=Ae,r.ab.mat4.invert(V,Q.matrix),Q.frustum=r.bR.fromInvProjectionMatrix(V,1,0,!0),Q.far=ce}const U=this._cascades.length-1;this._uniformValues.u_fade_range=[.75*this._cascades[U].far,this._cascades[U].far],this._uniformValues.u_shadow_intensity=g,this._uniformValues.u_shadow_direction=[this.shadowDirection[0],this.shadowDirection[1],this.shadowDirection[2]],this._uniformValues.u_shadow_texel_size=1/Jo.shadowMapResolution,this._uniformValues.u_shadow_map_resolution=Jo.shadowMapResolution,this._uniformValues.u_shadowmap_0=ps.ShadowMap0,this._uniformValues.u_shadowmap_1=ps.ShadowMap0+1,this._groundShadowTiles=h.transform.coveringTiles({tileSize:512,renderWorldCopies:!0});const G=h.transform.elevation;for(const re of this._groundShadowTiles){let Q={min:0,max:0};if(G){const ue=G.getMinMaxForTile(re);ue&&(Q=ue)}this.addShadowReceiver(re.toUnwrapped(),Q.min,Q.max)}}get enabled(){return this._enabled&&!this._forceDisable}set enabled(t){this._enabled=t}drawShadowPass(t,o){if(!this.enabled)return;const h=this.painter,g=h.context;this._numCascadesToRender=this._receivers.computeRequiredCascades(h.transform.getFrustum(0),h.transform.worldSize,this._cascades),g.viewport.set([0,0,Jo.shadowMapResolution,Jo.shadowMapResolution]);for(let v=0;v<this._numCascadesToRender;++v){h.currentShadowCascade=v,g.bindFramebuffer.set(this._cascades[v].framebuffer.framebuffer),g.clear({color:r.aj.white,depth:1});for(const S of t.order){const I=t._mergedLayers[S];if(!I.hasShadowPass()||I.isHidden(h.transform.zoom))continue;const L=t.getLayerSourceCache(I),D=L?o[L.id]:void 0;(I.type==="model"||D&&D.length)&&h.renderLayer(h,L,I,D)}}h.currentShadowCascade=0}drawGroundShadows(){if(!this.enabled)return;const t=this.painter,o=t.style,h=t.context,g=o.directionalLight,v=o.ambientLight;if(!g||!v)return;const S=[],I=ul(t,t.longestCutoffRange);I.shouldRenderCutoff&&S.push("RENDER_CUTOFF"),S.push("RENDER_SHADOWS","DEPTH_TEXTURE"),this.useNormalOffset&&S.push("NORMAL_OFFSET");const L=Gc(o,g,v),D=new Dn(h.gl.LEQUAL,Dn.ReadOnly,t.depthRangeFor3D);for(const B of this._groundShadowTiles){const V=B.toUnwrapped(),U=t.isTileAffectedByFog(B),G=t.getOrCreateProgram("groundShadow",{defines:S,overrideFog:U});this.setupShadows(V,G),t.uploadCommonUniforms(h,G,V,null,I);const re={u_matrix:t.transform.calculateProjMatrix(V),u_ground_shadow_factor:L};G.draw(t,h.gl.TRIANGLES,D,or.disabled,Sr.multiply,Wn.disabled,re,"ground_shadow",t.tileExtentBuffer,t.quadTriangleIndexBuffer,t.tileExtentSegments,{},t.transform.zoom,null,null)}}getShadowPassColorMode(){return this.painter._shadowMapDebug?Sr.unblended:Sr.disabled}getShadowPassDepthMode(){return this._depthMode}getShadowCastingLayerCount(){return this._shadowLayerCount}calculateShadowPassMatrixFromTile(t){const o=this.painter.transform,h=o.calculatePosMatrix(t,o.worldSize);return r.ab.mat4.multiply(h,this._cascades[this.painter.currentShadowCascade].matrix,h),Float32Array.from(h)}calculateShadowPassMatrixFromMatrix(t){return r.ab.mat4.multiply(t,this._cascades[this.painter.currentShadowCascade].matrix,t),Float32Array.from(t)}setupShadows(t,o,h,g=0){if(!this.enabled)return;const v=this.painter.transform,S=this.painter.context,I=S.gl,L=this._uniformValues,D=new Float64Array(16),B=v.calculatePosMatrix(t,v.worldSize);for(let V=0;V<this._cascades.length;V++)r.ab.mat4.multiply(D,this._cascades[V].matrix,B),L[V===0?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(D),S.activeTexture.set(I.TEXTURE0+ps.ShadowMap0+V),this._cascades[V].texture.bind(I.NEAREST,I.CLAMP_TO_EDGE);if(this.useNormalOffset=!!h,this.useNormalOffset){const V=r.cc(t.canonical),U=2/v.tileSize*r.ag/Jo.shadowMapResolution,G=U*this._cascades[0].boundingSphereRadius,re=U*this._cascades[this._cascades.length-1].boundingSphereRadius,Q=(h==="vector-tile"?1:3)/Math.pow(2,g-t.canonical.z-(1-v.zoom+Math.floor(v.zoom)));L.u_shadow_normal_offset=[V,G*Q,re*Q],L.u_shadow_bias=[6e-5,.0012,.012]}else L.u_shadow_bias=[36e-5,.0012,.012];o.setShadowUniformValues(S,L)}setupShadowsFromMatrix(t,o,h=!1){if(!this.enabled)return;const g=this.painter.context,v=g.gl,S=this._uniformValues,I=new Float64Array(16);for(let L=0;L<Jo.cascadeCount;L++)r.ab.mat4.multiply(I,this._cascades[L].matrix,t),S[L===0?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(I),g.activeTexture.set(v.TEXTURE0+ps.ShadowMap0+L),this._cascades[L].texture.bind(v.NEAREST,v.CLAMP_TO_EDGE);if(this.useNormalOffset=h,h){const L=Jo.normalOffset;S.u_shadow_normal_offset=[1,L,L],S.u_shadow_bias=[6e-5,.0012,.012]}else S.u_shadow_bias=[36e-5,.0012,.012];o.setShadowUniformValues(g,S)}getShadowUniformValues(){return this._uniformValues}getCurrentCascadeFrustum(){return this._cascades[this.painter.currentShadowCascade].frustum}computeSimplifiedTileShadowVolume(t,o,h,g){if(g[2]>=0)return{};const v=function(L,D,B){const V=B/(1<<L.canonical.z);return new r.cd([L.canonical.x*V+L.wrap*B,L.canonical.y*V+L.wrap*B,0],[(L.canonical.x+1)*V+L.wrap*B,(L.canonical.y+1)*V+L.wrap*B,D])}(t,o,h).getCorners(),S=o/-g[2];g[0]<0?(r.ab.vec3.add(v[0],v[0],[g[0]*S,0,0]),r.ab.vec3.add(v[3],v[3],[g[0]*S,0,0])):g[0]>0&&(r.ab.vec3.add(v[1],v[1],[g[0]*S,0,0]),r.ab.vec3.add(v[2],v[2],[g[0]*S,0,0])),g[1]<0?(r.ab.vec3.add(v[0],v[0],[0,g[1]*S,0]),r.ab.vec3.add(v[1],v[1],[0,g[1]*S,0])):g[1]>0&&(r.ab.vec3.add(v[2],v[2],[0,g[1]*S,0]),r.ab.vec3.add(v[3],v[3],[0,g[1]*S,0]));const I={};return I.vertices=v,I.planes=[dl(v[1],v[0],v[4]),dl(v[2],v[1],v[5]),dl(v[3],v[2],v[6]),dl(v[0],v[3],v[7])],I}addShadowReceiver(t,o,h){this._receivers.add(t,r.cd.fromTileIdAndHeight(t,o,h))}getMaxCascadeForTile(t){const o=this._receivers.get(t);return o&&o.lastCascade?o.lastCascade:0}}function dl(u,t,o){const h=r.ab.vec3.sub([],o,t),g=r.ab.vec3.sub([],u,t),v=r.ab.vec3.cross([],h,g),S=r.ab.vec3.length(v);return S===0?[0,0,1,0]:(r.ab.vec3.scale(v,v,1/S),[v[0],v[1],v[2],-r.ab.vec3.dot(v,t)])}function gs(u){const t=u.properties.get("direction"),o=r.cb(t.x,t.y,t.z);o[2]=r.aw(o[2],0,75);const h=r.ce([o[0],o[1],o[2]]);return r.ab.vec3.fromValues(h.x,h.y,h.z)}function Gc(u,t,o){const h=t.properties.get("color-use-theme")==="none",g=t.properties.get("color"),v=t.properties.get("intensity"),S=t.properties.get("direction"),I=[S.x,S.y,S.z],L=o.properties.get("color-use-theme")==="none",D=o.properties.get("color"),B=o.properties.get("intensity"),V=Math.max(r.ab.vec3.dot([0,0,1],I),0),U=[0,0,0];r.ab.vec3.scale(U,D.toRenderColor(L?null:u.getLut(t.scope)).toArray01Linear().slice(0,3),B);const G=[0,0,0];return r.ab.vec3.scale(G,g.toRenderColor(h?null:u.getLut(o.scope)).toArray01Linear().slice(0,3),V*v),r.cf([U[0]>0?U[0]/(U[0]+G[0]):0,U[1]>0?U[1]/(U[1]+G[1]):0,U[2]>0?U[2]/(U[2]+G[2]):0])}function vc(u,t,o,h,g,v){const S=u.zoom,I=u.scale,L=u.worldSize,D=1/L,B=u.aspect,V=Math.sqrt(1+B*B)*Math.tan(.5*u.fovX),U=V*V,G=h-o,re=h+o;let Q,ue;U>G/re?(Q=h,ue=h*V):(Q=.5*re*(1+U),ue=.5*Math.sqrt(G*G+2*(h*h+o*o)*U+re*re*U*U));const ce=u.projection.pixelsPerMeter(u.center.lat,L),ye=u._camera.getCameraToWorldMercator(),Ae=[0,0,-Q*D];r.ab.vec3.transformMat4(Ae,Ae,ye);let Ee=ue*D;const Fe=u._edgeInsets;if(!(Fe.left===0&&Fe.top===0&&Fe.right===0&&Fe.bottom===0||Fe.left===Fe.right&&Fe.top===Fe.bottom)){const rn=u._camera.getWorldToCamera(u.worldSize,u.projection.zAxisUnit==="meters"?ce:1),Vt=u._camera.getCameraToClipPerspective(u._fov,u.width/u.height,o,h);Vt[8]=2*-u.centerOffset.x/u.width,Vt[9]=2*u.centerOffset.y/u.height;const kt=new Float64Array(16);r.ab.mat4.mul(kt,Vt,rn);const _n=new Float64Array(16);r.ab.mat4.invert(_n,kt);const gn=r.bR.fromInvProjectionMatrix(_n,L,S,!0);for(const ln of gn.points){const xn=((ze=ln)[0]/=I,ze[1]/=I,ze[2]=r.bH(ze[2],u._center.lat),ze);Ee=Math.max(Ee,r.ab.vec3.len(r.ab.vec3.subtract([],Ae,xn)))}}var ze;Ee*=g/(g-1);const Oe=Math.acos(t[2]),ke=Math.atan2(-t[0],-t[1]),Ge=new Ql;Ge.position=Ae,Ge.setPitchBearing(Oe,ke);const Ze=Ge.getWorldToCamera(L,ce),ft=Ee*L,ct=Math.min(u._mercatorZfromZoom(17)*L*-2,-2*ft),We=Ge.getCameraToClipOrthographic(-ft,ft,-ft,ft,ct,(ft+v*ce)/t[2]),tt=new Float64Array(16);r.ab.mat4.multiply(tt,We,Ze);const zt=r.ab.vec3.fromValues(Math.floor(1e6*Ae[0])/1e6*L,Math.floor(1e6*Ae[1])/1e6*L,0),Gt=.5*g,Yt=[0,0,0];r.ab.vec3.transformMat4(Yt,zt,tt),r.ab.vec3.scale(Yt,Yt,Gt);const dt=[Math.floor(Yt[0]),Math.floor(Yt[1]),Math.floor(Yt[2])],Ft=[0,0,0];r.ab.vec3.sub(Ft,Yt,dt),r.ab.vec3.scale(Ft,Ft,-1/Gt);const Et=new Float64Array(16);return r.ab.mat4.identity(Et),r.ab.mat4.translate(Et,Et,Ft),r.ab.mat4.multiply(tt,Et,tt),[tt,ft]}class $h extends r.E{constructor(t){super(),this.requestManager=t,this.models={"":{}},this.numModelsLoading={}}loadModel(t,o){return r.aM(this.requestManager.transformRequest(o,r.R.Model).url).then(h=>{if(!h)return;const g=r.aN(h),v=new r.aO(t,void 0,void 0,g);return v.computeBoundsAndApplyParent(),v}).catch(h=>{if(h&&h.status===404)return null;this.fire(new r.y(new Error(`Could not load model ${t} from ${o}: ${h.message}`)))})}load(t,o){this.models[o]||(this.models[o]={});const h=Object.keys(t);this.numModelsLoading[o]=(this.numModelsLoading[o]||0)+h.length;const g=[];for(const v of h)g.push(this.loadModel(v,t[v]));Promise.allSettled(g).then(v=>{for(let S=0;S<v.length;S++){const{status:I,value:L}=v[S];I==="fulfilled"&&L&&(this.models[o][h[S]]={model:L,numReferences:1})}this.numModelsLoading[o]-=h.length,this.fire(new r.z("data",{dataType:"style"}))}).catch(v=>{this.fire(new r.y(new Error(`Could not load models: ${v.message}`)))})}isLoaded(){for(const t in this.numModelsLoading)if(this.numModelsLoading[t]>0)return!1;return!0}hasModel(t,o){return!!this.getModel(t,o)}getModel(t,o){return this.models[o]||(this.models[o]={}),this.models[o][t]?this.models[o][t].model:void 0}addModel(t,o,h){this.models[h]||(this.models[h]={}),this.hasModel(t,h)&&this.models[h][t].numReferences++,this.load({[t]:this.requestManager.normalizeModelURL(o)},h)}addModels(t,o){this.models[o]||(this.models[o]={});const h={};for(const g in t)this.models[o][g]={},h[g]=this.requestManager.normalizeModelURL(t[g]);this.load(h,o)}addModelsFromBucket(t,o){this.models[o]||(this.models[o]={});const h={};for(const g of t)this.hasModel(g,o)?this.models[o][g].numReferences++:h[g]=this.requestManager.normalizeModelURL(g);this.load(h,o)}removeModel(t,o){if(this.models[o]&&this.models[o][t]&&(this.models[o][t].numReferences--,this.models[o][t].numReferences===0)){const h=this.models[o][t].model;delete this.models[o][t],h.destroy()}}listModels(t){return this.models[t]||(this.models[t]={}),Object.keys(this.models[t])}upload(t,o){this.models[o]||(this.models[o]={});for(const h in this.models[o])this.models[o][h].model&&this.models[o][h].model.upload(t.context)}}const Ld=new r.a5({data:new r.a6(r.a3.colorTheme.data)}),Vh={"mbx-indoor-active-floorplans":{default:["literal",[]]},"mbx-indoor-underground":{default:["literal",!1]},"mbx-indoor-loaded-levels":{default:["literal",[]]},"mbx-indoor-level-height":{default:["literal",{}]},"mbx-indoor-level-base":{default:["literal",{}]},"mbx-indoor-level-selected":{default:["literal",{}]},"mbx-indoor-level-overlapped":{default:["literal",{}]}};function Od(u){return u=u||{},Object.assign(u,Vh)}class Af extends r.E{constructor(t){super(),this.mergeFloors=!0,this._scope=void 0,this._queryFeatureSetId=void 0,this._buildingEntryFeatureSetId=void 0,this._selectedFloorplan=void 0,this._indoorData=void 0,this._selectedLevel=void 0,this._floorplanStates={},r.aP(["_onLoad","_onMove","_checkFloorplanVisible"],this),this._map=t,this._checkFloorplanVisible(!0),this._map.on("load",this._onLoad),this._map.on("move",this._onMove)}destroy(){this._map.indoor.off("load",this._onLoad),this._map.indoor.off("move",this._onMove),this._map=void 0}_onLoad(){this._map.style.forEachFragmentStyle(t=>{t.stylesheet.indoor&&(this._queryFeatureSetId?this.fire(new r.y(new Error("Multiple indoor map styles detected, simultaneous usage is not allowed currently."))):(this._queryFeatureSetId=t.stylesheet.indoor.floorplanFeaturesetId,this._buildingEntryFeatureSetId=t.stylesheet.indoor.buildingFeaturesetId,this._scope=t.scope))}),this._queryFeatureSetId&&this._buildingEntryFeatureSetId&&this._map.addInteraction("mbx-indoor-buildingclick",{type:"click",target:{featuresetId:this._buildingEntryFeatureSetId,importId:this._scope},handler:t=>(t.feature&&t.feature.properties.floorplan&&this.selectFloorplan(t.feature.properties.floorplan),!0)}),this._checkFloorplanVisible(!0)}_onMove(){this._checkFloorplanVisible(!1)}_checkFloorplanVisible(t){if(!this._queryFeatureSetId||!this._map.isStyleLoaded()||this._map.transform.zoom<13)return;this._indoorData&&!function(S,I){const[L,D]=S,{center:B,radius:V}=I,[U,G]=B,re=Math.abs(L-U);return Math.sqrt((re>180?360-re:re)**2+(D-G)**2)<=V}([this._map.getCenter().lng,this._map.getCenter().lat],this._indoorData.circumCircle)&&(this._indoorData=void 0,this._selectedFloorplan=void 0,this._map.setConfigProperty(this._scope,"mbx-indoor-underground",!1),this._map.setConfigProperty(this._scope,"mbx-indoor-active-floorplans",["literal",[]]),this.fire(new r.z("floorplangone")));const o={target:{featuresetId:this._queryFeatureSetId,importId:this._scope}},h=new r.P(this._map.transform.width/2,this._map.transform.height/2),g=[new r.P(0,0),new r.P(this._map.transform.width,this._map.transform.height)],v=this._map.queryRenderedFeatures(t?g:h,o);v.length>0&&(this._selectedFloorplan&&v[0].properties.id===this._selectedFloorplan.properties.id||(this._selectedFloorplan=v[0],this._floorplanSelected(!1)))}_floorplanSelected(t){this._indoorData=JSON.parse(this._selectedFloorplan.properties["indoor-data"]),this._indoorData.id=this._selectedFloorplan.properties.id,this._indoorData.circumCircle=function(v){const[[S,I],[L,D]]=v,B=(L-S+360)%360,V=B>180?360-B:B;return{center:[(S+V/2+360)%360,(I+D)/2],radius:Math.sqrt(V**2+(D-I)**2)/2}}(this._indoorData.extent),this._floorplanStates[this._indoorData.id]||(this._floorplanStates[this._indoorData.id]={});const o=this._floorplanStates[this._indoorData.id].selectedBuilding,h=this._floorplanStates[this._indoorData.id].selectedLevel;let g;if(this._map.setConfigProperty(this._scope,"mbx-indoor-active-floorplans",this._indoorData.floorplanIDs),this._selectedLevel)for(const v of this._indoorData.levels)v.id===this._selectedLevel.id&&(g=v.id);if(this.fire(new r.z("floorplanselected",{buildings:this._indoorData.buildings,levels:this._indoorData.levels,selectedLevelId:g})),o){const v=this._indoorData.buildings.find(S=>S.id===o);this._buildingSelected(v,!1)}else this._indoorData.buildings.length>0&&this._buildingSelected(this._indoorData.buildings[0],!1);if(h){const v=this._indoorData.levels.find(S=>S.id===h);this._updateLevels(v,t)}else t&&this._indoorData["default-levels"].length>0&&this.selectLevel(this._indoorData["default-levels"][0])}_buildingSelected(t,o){o&&t&&t.extent&&this._map.fitBounds(t.extent,{pitch:this._map.getPitch(),bearing:this._map.getBearing()}),this._floorplanStates[this._indoorData.id].selectedBuilding=t?t.id:void 0;const h=this._indoorData.levels.filter(g=>t.levels.includes(g.id));this.fire(new r.z("buildingselected",{buildingId:t.id,levels:h}))}_levelSelected(t){if(t==="overview")this._updateLevels(void 0,!0);else{const o=this._indoorData.levels.find(h=>h.id===t);this._updateLevels(o,!0)}this.fire(new r.z("levelselected",{levelId:t==="overview"?void 0:t}))}_updateLevels(t,o){if(!t)return this._map.setConfigProperty(this._scope,"mbx-indoor-loaded-levels",["literal",[]]),this._map.setConfigProperty(this._scope,"mbx-indoor-underground",!1),this._floorplanStates[this._indoorData.id].selectedLevel=void 0,void(o&&this._indoorData.extent&&this._map.fitBounds(this._indoorData.extent,{pitch:this._map.getPitch(),bearing:this._map.getBearing()}));function h(D){const B=D.indexOf("/floor/");if(B===-1)return D;const V=B+7,U=D.indexOf("/",V);return U===-1?D.slice(V):D.slice(V,U)}this._selectedLevel=t,this._floorplanStates[this._indoorData.id].selectedLevel=t?t.id:void 0;const g=[],v={},S={},I={},L={};for(const D of this._indoorData.levels)if(g.push(D.id),v[D.id]=D.height,S[D.id]=D.base,t){if(this.mergeFloors){const B=h(t.id),V=h(D.id);I[D.id]=V===B?"true":"false"}else I[D.id]=D.id===t.id?"true":"false";L[D.id]=D.base<t.base?"true":"false"}else L[D.id]=!0;if(this._map.setConfigProperty(this._scope,"mbx-indoor-loaded-levels",["literal",g]),this._map.setConfigProperty(this._scope,"mbx-indoor-level-height",["literal",v]),this._map.setConfigProperty(this._scope,"mbx-indoor-level-base",["literal",S]),this._map.setConfigProperty(this._scope,"mbx-indoor-level-selected",["literal",I]),this._map.setConfigProperty(this._scope,"mbx-indoor-level-overlapped",["literal",L]),t&&(this._map.setConfigProperty(this._scope,"mbx-indoor-underground",!!t.isUnderground),o&&t.extent)){const D=this._map.cameraForBounds(t.extent,{pitch:this._map.getPitch(),bearing:this._map.getBearing()}),B=this._map.getZoom(),V=D.zoom?Math.abs(B-D.zoom):0;this._map.fitBounds(t.extent,V>=1?{pitch:this._map.getPitch(),bearing:this._map.getBearing()}:{pitch:this._map.getPitch(),bearing:this._map.getBearing(),zoom:B})}}selectFloorplan(t){const o={target:{featuresetId:this._queryFeatureSetId,importId:this._scope}},h=[new r.P(0,0),new r.P(this._map.transform.width,this._map.transform.height)],g=this._map.queryRenderedFeatures(h,o);if(g.length>0){for(const v of g)if(JSON.parse(v.properties["indoor-data"]).floorplanIDs.includes(t)){this._selectedFloorplan=v,this._floorplanSelected(!0);break}}}selectBuilding(t){const o=this._indoorData.buildings.find(h=>h.id===t);this._buildingSelected(o,!0)}selectLevel(t){this._levelSelected(t)}}function If(u){if(!u.metadata||!u.metadata.content_area)return;const{left:t,top:o,width:h,height:g}=u.metadata.content_area;return[t,o,t+h,o+g]}const ec=(u,t)=>Ke(u,t&&t.filter(o=>o.identifier!=="source.canvas")),Cp=r.ay(yr,["addLayer","removeLayer","setLights","setPaintProperty","setLayoutProperty","setSlot","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setTerrain","setFog","setSnow","setRain","setProjection","setCamera","addImport","removeImport","updateImport"]),Pf=r.ay(yr,["setCenter","setZoom","setBearing","setPitch"]),la=new Set(["background","sky","slot","custom"]),xc={version:8,layers:[],sources:{}},Uh={duration:300,delay:0};class Va extends r.E{constructor(t,o={}){super(),this.map=t,this.scope=o.scope||"",this.globalId=null,this.fragments=[],this.importDepth=o.importDepth||0,this.importsCache=o.importsCache||new Map,this.resolvedImports=o.resolvedImports||new Set,this.transition=r.l({},Uh),this._buildingIndex=new hs(this),this.crossTileSymbolIndex=new Mf,this._mergedOrder=[],this._drapedFirstOrder=[],this._mergedLayers={},this._mergedSourceCaches={},this._mergedOtherSourceCaches={},this._mergedSymbolSourceCaches={},this._clipLayerPresent=!1,this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this._changes=o.styleChanges||new Ar,this.dispatcher=o.dispatcher?o.dispatcher:new r.D(r.ci(),this),o.imageManager?this.imageManager=o.imageManager:(this.imageManager=new Wr(this.map._spriteFormat),this.imageManager.setEventedParent(this)),this.imageManager.createScope(this.scope),this.glyphManager=o.glyphManager?o.glyphManager:new r.cj(t._requestManager,o.localFontFamily?r.ck.all:o.localIdeographFontFamily?r.ck.ideographs:r.ck.none,o.localFontFamily||o.localIdeographFontFamily),o.modelManager?this.modelManager=o.modelManager:(this.modelManager=new $h(t._requestManager),this.modelManager.setEventedParent(this)),this._layers={},this._sourceCaches={},this._otherSourceCaches={},this._symbolSourceCaches={},this._loaded=!1,this._precompileDone=!1,this._shouldPrecompile=!1,this._availableImages=[],this._order=[],this._markersNeedUpdate=!1,this.options=o.configOptions?o.configOptions:new Map,this._configDependentLayers=o.configDependentLayers?o.configDependentLayers:new Set,this._config=o.config,this._styleColorTheme={lut:null,lutLoading:!1,lutLoadingCorrelationID:0,colorTheme:null,colorThemeOverride:o.colorThemeOverride},this._styleColorThemeForScope={},this._initialConfig=o.initialConfig,this.dispatcher.broadcast("setReferrer",r.cl());const h=this;this._rtlTextPluginCallback=Va.registerForPluginStateChange(g=>{h.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:g.pluginStatus,pluginURL:g.pluginURL},(v,S)=>{if(r.cm(v),S&&S.every(I=>I))for(const I in h._sourceCaches){const L=h._sourceCaches[I],D=L.getSource().type;D!=="vector"&&D!=="geojson"||L.reload()}})}),this.on("data",g=>{if(g.dataType!=="source"||g.sourceDataType!=="metadata")return;const v=this.getOwnSource(g.sourceId);if(v&&v.vectorLayerIds)for(const S in this._layers){const I=this._layers[S];I.source===v.id&&this._validateLayer(I)}})}load(t){return t?(typeof t=="string"?this.loadURL(t):this.loadJSON(t),this):this}_getGlobalId(t){if(!t)return null;if(typeof t=="string"){if(r.f(t))return t;const o=r.cn(t);if(!o.startsWith("http"))try{return new URL(o,location.href).toString()}catch{return o}return o}return`json://${r.co(JSON.stringify(t))}`}_diffStyle(t,o,h){this.globalId=this._getGlobalId(t);const g=(v,S)=>{try{S(null,this.setState(v,h))}catch(I){S(I,!1)}};if(typeof t=="string"){const v=this.map._requestManager.normalizeStyleURL(t),S=this.map._requestManager.transformRequest(v,r.R.Style);r.n(S,(I,L)=>{I?this.fire(new r.y(I)):L&&g(L,o)})}else typeof t=="object"&&g(t,o)}loadURL(t,o={}){this.fire(new r.z("dataloading",{dataType:"style"}));const h=typeof o.validate=="boolean"?o.validate:!r.f(t);this.globalId=this._getGlobalId(t),t=this.map._requestManager.normalizeStyleURL(t,o.accessToken),this.resolvedImports.add(t);const g=this.importsCache.get(t);if(g)return this._load(g,h);const v=this.map._requestManager.transformRequest(t,r.R.Style);this._request=r.n(v,(S,I)=>{if(this._request=null,S)this.fire(new r.y(S));else if(I)return this.importsCache.set(t,I),this._load(I,h)})}loadJSON(t,o={}){this.fire(new r.z("dataloading",{dataType:"style"})),this.globalId=this._getGlobalId(t),this._request=r.q.frame(()=>{this._request=null,this._load(t,o.validate!==!1)})}loadEmpty(){this.fire(new r.z("dataloading",{dataType:"style"})),this._load(xc,!1)}_loadImports(t,o,h){if(this.importDepth>=4)return r.w("Style doesn't support nesting deeper than 5"),Promise.resolve();const g=[];for(const v of t){const S=this._createFragmentStyle(v),I=new Promise(B=>{S.once("style.import.load",B),S.once("error",B)}).then(()=>this.mergeAll());if(g.push(I),this.resolvedImports.has(v.url)){S.loadEmpty();continue}const L=v.data||this.importsCache.get(v.url);L?(S.loadJSON(L,{validate:o}),this._isInternalStyle(L)&&(S.globalId=null)):v.url?S.loadURL(v.url,{validate:o}):S.loadEmpty();const D={style:S,id:v.id,config:v.config};if(h){const B=this.fragments.findIndex(({id:V})=>V===h);this.fragments=this.fragments.slice(0,B).concat(D).concat(this.fragments.slice(B))}else this.fragments.push(D)}return Promise.allSettled(g)}getImportGlobalIds(t=this,o=new Set){for(const h of t.fragments)h.style.globalId&&o.add(h.style.globalId),this.getImportGlobalIds(h.style,o);return[...o.values()]}_createFragmentStyle(t){const o=this.scope?r.aC(t.id,this.scope):t.id;let h;const g=this._initialConfig&&this._initialConfig[o];(t.config||g)&&(h=r.l({},t.config,g));const v=new Va(this.map,{scope:o,styleChanges:this._changes,importDepth:this.importDepth+1,importsCache:this.importsCache,resolvedImports:new Set(this.resolvedImports),dispatcher:this.dispatcher,imageManager:this.imageManager,glyphManager:this.glyphManager,modelManager:this.modelManager,config:h,configOptions:this.options,colorThemeOverride:t["color-theme"],configDependentLayers:this._configDependentLayers});return v.setEventedParent(this.map,{style:v}),v}_reloadImports(){this.mergeAll(),this._updateMapProjection(),this.updateConfigDependencies(),this.map._triggerCameraUpdate(this.camera),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options}),this._shouldPrecompile=this.map._precompilePrograms&&this.isRootStyle()}_isInternalStyle(t){return this.isRootStyle()&&(t.fragment||!!t.schema&&t.fragment!==!1)}_load(t,o){const h=t.indoor?Od(t.schema):t.schema;if(this._isInternalStyle(t)){const S=r.l({},xc,{imports:[{id:"basemap",data:t,url:""}]});return void this._load(S,o)}if(this.updateConfig(this._config,h),o&&ec(this,io(t)))return;this._loaded=!0,this.stylesheet=r.cp(t);const g=()=>{for(const D in t.sources)this.addSource(D,t.sources[D],{validate:!1,isInitialLoad:!0});t.sprite?this._loadIconset(t.sprite):(this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0})),this.glyphManager.setURL(t.glyphs,this.scope);const S=Po(this.stylesheet.layers);if(this._order=S.map(D=>D.id),this.stylesheet.light&&r.w("The `light` root property is deprecated, prefer using `lights` with `flat` light type instead."),this.stylesheet.lights)if(this.stylesheet.lights.length===1&&this.stylesheet.lights[0].type==="flat"){const D=this.stylesheet.lights[0];this.light=new wt(D.properties,D.id)}else this.setLights(this.stylesheet.lights);this.light||(this.light=new wt(this.stylesheet.light)),this._layers={};for(const D of S){const B=r.cu(D,this.scope,this._styleColorTheme.lut,this.options);B.configDependencies.size!==0&&this._configDependentLayers.add(B.fqid),B.setEventedParent(this,{layer:{id:B.id}}),this._layers[B.id]=B;const V=this.getOwnLayerSourceCache(B),U=!!this.directionalLight&&this.directionalLight.shadowsEnabled();V&&B.canCastShadows()&&U&&(V.castsShadows=!0)}this.stylesheet.featuresets&&this.setFeaturesetSelectors(this.stylesheet.featuresets),this.stylesheet.models&&this.modelManager.addModels(this.stylesheet.models,this.scope);const I=this.stylesheet.terrain;I&&(this.checkCanvasFingerprintNoise(),this.disableElevatedTerrain||this.terrainSetForDrapingOnly()||this._createTerrain(I,1)),this.stylesheet.fog&&this._createFog(this.stylesheet.fog),this.stylesheet.snow&&this._createSnow(this.stylesheet.snow),this.stylesheet.rain&&this._createRain(this.stylesheet.rain),this.stylesheet.transition&&this.setTransition(this.stylesheet.transition),this.fire(new r.z("data",{dataType:"style"}));const L=this.isRootStyle();t.imports?this._loadImports(t.imports,o).then(()=>{this._reloadImports(),this.fire(new r.z(L?"style.load":"style.import.load"))}):(this._reloadImports(),this.fire(new r.z(L?"style.load":"style.import.load")))};this._styleColorTheme.colorTheme=this.stylesheet["color-theme"];const v=this._styleColorTheme.colorThemeOverride?this._styleColorTheme.colorThemeOverride:this._styleColorTheme.colorTheme;if(v){const S=this._evaluateColorThemeData(v);this._loadColorTheme(S).then(()=>{g()}).catch(I=>{r.w(`Couldn't load color theme from the stylesheet: ${I}`),g()})}else this._styleColorTheme.lut=null,g()}isRootStyle(){return this.importDepth===0}mergeAll(){let t,o,h,g,v,S,I,L,D,B;const V={};this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle(U=>{if(U.stylesheet){if(U.light!=null&&(t=U.light),U.stylesheet.lights)for(const G of U.stylesheet.lights)G.type==="ambient"&&U.ambientLight!=null&&(o=U.ambientLight),G.type==="directional"&&U.directionalLight!=null&&(h=U.directionalLight);g=this._prioritizeTerrain(g,U.terrain,U.stylesheet.terrain),U.stylesheet.fog&&U.fog!=null&&(v=U.fog),U.stylesheet.snow&&U.snow!=null&&(S=U.snow),U.stylesheet.rain&&U.rain!=null&&(I=U.rain),U.stylesheet.camera!=null&&(B=U.stylesheet.camera),U.stylesheet.projection!=null&&(L=U.stylesheet.projection),U.stylesheet.transition!=null&&(D=U.stylesheet.transition),V[U.scope]=U._styleColorTheme}}),this.light=t,this.ambientLight=o,this.directionalLight=h,this.fog=v,this.snow=S,this.rain=I,this._styleColorThemeForScope=V,g===null?delete this.terrain:this.terrain=g,this.camera=B||{"camera-projection":"perspective"},this.projection=L||{name:"mercator"},this.transition=r.l({},Uh,D),this.mergeSources(),this.mergeLayers()}forEachFragmentStyle(t){const o=h=>{for(const g of h.fragments)o(g.style);t(h)};o(this)}_prioritizeTerrain(t,o,h){const g=t&&t.drapeRenderMode===0;return h===null?o&&o.drapeRenderMode===0?o:g?t:null:o!=null&&(!t||g||o&&o.drapeRenderMode===1)?o:t}mergeTerrain(){let t;this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle(o=>{t=this._prioritizeTerrain(t,o.terrain,o.stylesheet.terrain)}),t===null?delete this.terrain:this.terrain=t}mergeProjection(){let t;this.forEachFragmentStyle(o=>{o.stylesheet.projection!=null&&(t=o.stylesheet.projection)}),this.projection=t||{name:"mercator"}}mergeSources(){const t={},o={},h={};this.forEachFragmentStyle(g=>{for(const v in g._sourceCaches){const S=r.aC(v,g.scope);t[S]=g._sourceCaches[v]}for(const v in g._otherSourceCaches){const S=r.aC(v,g.scope);o[S]=g._otherSourceCaches[v]}for(const v in g._symbolSourceCaches){const S=r.aC(v,g.scope);h[S]=g._symbolSourceCaches[v]}}),this._mergedSourceCaches=t,this._mergedOtherSourceCaches=o,this._mergedSymbolSourceCaches=h}mergeLayers(){const t={},o=[],h={};this._mergedSlots=[],this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this.forEachFragmentStyle(v=>{for(const S of v._order){const I=v._layers[S];if(I.type==="slot"){const L=r.cq(S);if(t[L])continue;t[L]=[]}I.slot&&t[I.slot]?t[I.slot].push(I):o.push(I)}}),this._mergedOrder=[];const g=(v=[])=>{for(const S of v)if(S.type==="slot"){const I=r.cq(S.id);t[I]&&g(t[I]),this._mergedSlots.push(I)}else{const I=r.aC(S.id,S.scope);this._mergedOrder.push(I),h[I]=S,S.is3D()&&(this._has3DLayers=!0),S.type==="circle"&&(this._hasCircleLayers=!0),S.type==="symbol"&&(this._hasSymbolLayers=!0),S.type==="clip"&&(this._clipLayerPresent=!0)}};g(o),this._mergedOrder.sort((v,S)=>{const I=h[v],L=h[S];return I.hasInitialOcclusionOpacityProperties?L.is3D()?1:0:I.is3D()&&L.hasInitialOcclusionOpacityProperties?-1:0}),this._mergedLayers=h,this.updateDrapeFirstLayers(),this._buildingIndex.processLayersChanged()}terrainSetForDrapingOnly(){return!!this.terrain&&this.terrain.drapeRenderMode===0}getCamera(){return this.stylesheet.camera}setCamera(t){return this.stylesheet.camera=r.l({},this.stylesheet.camera,t),this.camera=this.stylesheet.camera,this}_evaluateColorThemeData(t){return t.data?function(o,h,g){const v=r.l({},h);for(const I of Object.keys(r.a3.colorTheme))v[I]===void 0&&(v[I]=r.a3.colorTheme[I].default);const S=new r.a4(Ld,o,new Map(g));return S.setTransitionOrValue(v,g),S.untransitioned().possiblyEvaluate(new r.a8(0))}(this.scope,t,this.options).get("data"):null}_loadColorTheme(t){this._styleColorTheme.lutLoading=!0,this._styleColorTheme.lutLoadingCorrelationID+=1;const o=this._styleColorTheme.lutLoadingCorrelationID;return new Promise((h,g)=>{const v="data:image/png;base64,";if(!t||t.length===0)return this._styleColorTheme.lut=null,this._styleColorTheme.lutLoading=!1,void h();let S=t;S.startsWith(v)||(S=v+S);const I="mapbox-reserved-lut",L=new Image;L.src=S,L.onerror=()=>{this._styleColorTheme.lutLoading=!1,g(new Error("Failed to load image data"))},L.onload=()=>{if(this._styleColorTheme.lutLoadingCorrelationID!==o)return void h();this._styleColorTheme.lutLoading=!1;const{width:D,height:B,data:V}=r.q.getImageData(L);if(B>32)return void g(new Error("The height of the image must be less than or equal to 32 pixels."));if(D!==B*B)return void g(new Error("The width of the image must be equal to the height squared."));this.getImage(I)&&this.removeImage(I),this.addImage(I,{data:new r.r({width:D,height:B},V),pixelRatio:1,sdf:!1,usvg:!1,version:0});const U=this.imageManager.getImage(I,this.scope);U?(this._styleColorTheme.lut={image:U.data,data:t},h()):g(new Error("Missing LUT image."))}})}getLut(t){const o=this._styleColorThemeForScope[t];return o?o.lut:null}setProjection(t){t?this.stylesheet.projection=t:delete this.stylesheet.projection,this.mergeProjection(),this._updateMapProjection()}applyProjectionUpdate(){this._loaded&&(this.dispatcher.broadcast("setProjection",this.map.transform.projectionOptions),this.map.transform.projection.requiresDraping?(this.getTerrain()||this.stylesheet.terrain)&&!this.disableElevatedTerrain||this.setTerrainForDraping():this.terrainSetForDrapingOnly()&&this.setTerrain(null,0))}_updateMapProjection(){this.isRootStyle()&&(this.map._useExplicitProjection?this.applyProjectionUpdate():this.map._prioritizeAndUpdateProjection(null,this.projection))}_loadSprite(t){this._spriteRequest=function(o,h,g){let v,S,I;const L=r.q.devicePixelRatio>1?"@2x":"";let D=r.n(h.transformRequest(h.normalizeSpriteURL(o,L,".json"),r.R.SpriteJSON),(U,G)=>{D=null,I||(I=U,v=G,V())}),B=r.o(h.transformRequest(h.normalizeSpriteURL(o,L,".png"),r.R.SpriteImage),(U,G)=>{B=null,I||(I=U,S=G,V())});function V(){if(I)g(I);else if(v&&S){const U=r.q.getImageData(S),G={};for(const re in v){const{width:Q,height:ue,x:ce,y:ye,sdf:Ae,pixelRatio:Ee,stretchX:Fe,stretchY:ze,content:Oe}=v[re],ke=new r.r({width:Q,height:ue});r.r.copy(U,ke,{x:ce,y:ye},{x:0,y:0},{width:Q,height:ue},null),G[re]={data:ke,pixelRatio:Ee,sdf:Ae,stretchX:Fe,stretchY:ze,content:Oe,usvg:!1}}g(null,G)}}return{cancel(){D&&(D.cancel(),D=null),B&&(B.cancel(),B=null)}}}(t,this.map._requestManager,(o,h)=>{if(this._spriteRequest=null,o)this.fire(new r.y(o));else if(h)for(const g in h)this.imageManager.addImage(g,this.scope,h[g]);this.imageManager.setLoaded(!0,this.scope),this._availableImages=this.imageManager.listImages(this.scope),this.dispatcher.broadcast("setImages",{scope:this.scope,images:this._availableImages}),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0}),this.fire(new r.z("data",{dataType:"style"}))})}_loadIconset(t){if(!r.f(t)&&this.map._spriteFormat!=="icon_set"||this.map._spriteFormat==="raster")return void this._loadSprite(t);const o=this.map._spriteFormat==="auto";var h,g;this._spriteRequest=(g=(v,S)=>{if(this._spriteRequest=null,v)o?this._loadSprite(t):this.fire(new r.y(v));else if(S)for(const I in S)this.imageManager.addImage(I,this.scope,S[I]);this.imageManager.setLoaded(!0,this.scope),this._availableImages=this.imageManager.listImages(this.scope),this.dispatcher.broadcast("setImages",{scope:this.scope,images:this._availableImages}),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0}),this.fire(new r.z("data",{dataType:"style"}))},r.bi((h=this.map._requestManager).transformRequest(h.normalizeIconsetURL(t),r.R.Iconset),(v,S)=>{if(v)return void g(v);const I={},L=r.cg(new r.bh(S));for(const D of L.icons){const B={version:1,pixelRatio:r.q.devicePixelRatio,content:If(D),stretchX:D.metadata?D.metadata.stretch_x_areas:void 0,stretchY:D.metadata?D.metadata.stretch_y_areas:void 0,sdf:!1,usvg:!0,icon:D};I[D.name]=B}g(null,I)}))}_validateLayer(t){const o=this.getOwnSource(t.source);if(!o)return;const h=t.sourceLayer;h&&(o.type==="geojson"||o.vectorLayerIds&&o.vectorLayerIds.indexOf(h)===-1)&&this.fire(new r.y(new Error(`Source layer "${h}" does not exist on source "${o.id}" as specified by style layer "${t.id}"`)))}loaded(){if(!this._loaded||Object.keys(this._changes.getUpdatedSourceCaches()).length)return!1;for(const t in this._sourceCaches)if(!this._sourceCaches[t].loaded())return!1;if(!this.imageManager.isLoaded()||!this.modelManager.isLoaded()||this._styleColorTheme.lutLoading)return!1;for(const{style:t}of this.fragments)if(!t.loaded())return!1;return!0}_serializeImports(){if(this.stylesheet.imports)return this.stylesheet.imports.map((t,o)=>{const h=this.fragments[o];return h&&h.style&&(t.data=h.style.serialize()),t})}_serializeSources(){const t={};for(const o in this._sourceCaches){const h=this._sourceCaches[o].getSource();t[h.id]||(t[h.id]=h.serialize())}return t}_serializeLayers(t){const o=[];for(const h of t){const g=this._layers[h];g&&g.type!=="custom"&&o.push(g.serialize())}return o}hasLightTransitions(){return!(!this.light||!this.light.hasTransition())||!(!this.ambientLight||!this.ambientLight.hasTransition())||!(!this.directionalLight||!this.directionalLight.hasTransition())}hasFogTransition(){return!!this.fog&&this.fog.hasTransition()}hasSnowTransition(){return!!this.snow&&this.snow.hasTransition()}hasRainTransition(){return!!this.rain&&this.rain.hasTransition()}hasTransitions(){if(this.hasLightTransitions()||this.hasFogTransition()||this.hasSnowTransition()||this.hasRainTransition())return!0;for(const t in this._sourceCaches)if(this._sourceCaches[t].hasTransition())return!0;for(const t in this._layers)if(this._layers[t].hasTransition())return!0;return!1}get order(){return this.terrain?this._drapedFirstOrder:this._mergedOrder}_getOrder(t){return t?this.order:this._mergedOrder}isLayerDraped(t){return!!this.terrain&&t.isDraped(this.getLayerSourceCache(t))}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading")}_checkLayer(t){const o=this.getOwnLayer(t);if(o)return o;this.fire(new r.y(new Error(`The layer '${t}' does not exist in the map's style.`)))}_checkSource(t){const o=this.getOwnSource(t);if(o)return o;this.fire(new r.y(new Error(`The source '${t}' does not exist in the map's style.`)))}precompilePrograms(t,o){const h=this.map.painter;if(h)for(let g=t.minzoom||0;g<(t.maxzoom||25.5);g++){const v=t.getProgramIds();if(v)for(const S of v){const I=t.getDefaultProgramParams(S,o.zoom,this._styleColorTheme.lut);I&&(h.style=this,this.fog&&(h._fogVisible=!0,I.overrideFog=!0,h.getOrCreateProgram(S,I)),h._fogVisible=!1,I.overrideFog=!1,h.getOrCreateProgram(S,I),(this.stylesheet.terrain||this.stylesheet.projection&&this.stylesheet.projection.name==="globe")&&(I.overrideRtt=!0,h.getOrCreateProgram(S,I)))}}}update(t){if(!this._loaded)return;this.ambientLight&&this.ambientLight.recalculate(t),this.directionalLight&&this.directionalLight.recalculate(t);const o=this.calculateLightsBrightness();t.brightness=o||0,o!==this._brightness&&(this._brightness=o,this.dispatcher.broadcast("setBrightness",o));const h=this._changes.isDirty();let g=!1;if(this._changes.isDirty()){const S=this._changes.getLayerUpdatesByScope();for(const I in S){const{updatedIds:L,removedIds:D}=S[I];(L||D)&&(this._updateWorkerLayers(I,L,D),g=!0)}this.updateSourceCaches(),this._updateTilesForChangedImages(),this.updateLayers(t),this.light&&this.light.updateTransitions(t),this.ambientLight&&this.ambientLight.updateTransitions(t),this.directionalLight&&this.directionalLight.updateTransitions(t),this.fog&&this.fog.updateTransitions(t),this.snow&&this.snow.updateTransitions(t),this.rain&&this.rain.updateTransitions(t),this._changes.reset()}const v={};for(const S in this._mergedSourceCaches){const I=this._mergedSourceCaches[S];v[S]=I.used,I.used=!1,I.tileCoverLift=0}for(const S of this._mergedOrder){const I=this._mergedLayers[S];if(I.recalculate(t,this._availableImages),!I.isHidden(t.zoom)){const L=this.getLayerSourceCache(I);L&&(L.used=!0,L.tileCoverLift=Math.max(L.tileCoverLift,I.tileCoverLift()))}!this._precompileDone&&this._shouldPrecompile&&("requestIdleCallback"in window?requestIdleCallback(()=>{this.precompilePrograms(I,t)}):this.precompilePrograms(I,t))}this._shouldPrecompile&&(this._precompileDone=!0),this.terrain&&g&&this.mergeLayers();for(const S in v){const I=this._mergedSourceCaches[S];v[S]!==I.used&&I.getSource().fire(new r.z("data",{sourceDataType:"visibility",dataType:"source",sourceId:I.getSource().id}))}this.light&&this.light.recalculate(t),this.terrain&&this.terrain.recalculate(t),this.fog&&this.fog.recalculate(t),this.snow&&this.snow.recalculate(t),this.rain&&this.rain.recalculate(t),this.z=t.zoom,this._markersNeedUpdate&&(this._updateMarkersOpacity(),this._markersNeedUpdate=!1),h&&this.fire(new r.z("data",{dataType:"style"}))}_updateTilesForChangedImages(){const t=this._changes.getUpdatedImages();if(t.length){for(const o in this._sourceCaches)this._sourceCaches[o].reloadTilesForDependencies(["icons","patterns"],t);this._changes.resetUpdatedImages()}}_updateWorkerLayers(t,o,h){const g=this.getFragmentStyle(t);g&&this.dispatcher.broadcast("updateLayers",{layers:o?g._serializeLayers(o):[],scope:t,removedIds:h||[],options:g.options})}setState(t,o){if(this._checkLoaded(),ec(this,io(t)))return!1;(t=r.cp(t)).layers=Po(t.layers);const h=function(S,I){if(!S)return[{command:yr.setStyle,args:[I]}];let L=[];try{if(!r.bn(S.version,I.version))return[{command:yr.setStyle,args:[I]}];if(r.bn(S.center,I.center)||L.push({command:yr.setCenter,args:[I.center]}),r.bn(S.zoom,I.zoom)||L.push({command:yr.setZoom,args:[I.zoom]}),r.bn(S.bearing,I.bearing)||L.push({command:yr.setBearing,args:[I.bearing]}),r.bn(S.pitch,I.pitch)||L.push({command:yr.setPitch,args:[I.pitch]}),r.bn(S.sprite,I.sprite)||L.push({command:yr.setSprite,args:[I.sprite]}),r.bn(S.glyphs,I.glyphs)||L.push({command:yr.setGlyphs,args:[I.glyphs]}),r.bn(S.imports,I.imports)||function(G=[],re=[],Q){re=re||[];const ue=(G=G||[]).map(Jn),ce=re.map(Jn),ye=G.reduce(Xn,{}),Ae=re.reduce(Xn,{}),Ee=ue.slice();let Fe,ze,Oe,ke;for(Fe=0,ze=0;Fe<ue.length;Fe++)Oe=ue[Fe],Ae.hasOwnProperty(Oe)?ze++:(Q.push({command:yr.removeImport,args:[Oe]}),Ee.splice(Ee.indexOf(Oe,ze),1));for(Fe=0,ze=0;Fe<ce.length;Fe++)Oe=ce[ce.length-1-Fe],Ee[Ee.length-1-Fe]!==Oe&&(ye.hasOwnProperty(Oe)?(Q.push({command:yr.removeImport,args:[Oe]}),Ee.splice(Ee.lastIndexOf(Oe,Ee.length-ze),1)):ze++,ke=Ee[Ee.length-Fe],Q.push({command:yr.addImport,args:[Ae[Oe],ke]}),Ee.splice(Ee.length-Fe,0,Oe));for(const Ge of re){const Ze=ye[Ge.id];Ze&&!r.bn(Ze,Ge)&&Q.push({command:yr.updateImport,args:[Ge.id,Ge]})}}(S.imports,I.imports,L),r.bn(S.transition,I.transition)||L.push({command:yr.setTransition,args:[I.transition]}),r.bn(S.light,I.light)||L.push({command:yr.setLight,args:[I.light]}),r.bn(S.fog,I.fog)||L.push({command:yr.setFog,args:[I.fog]}),r.bn(S.snow,I.snow)||L.push({command:yr.setSnow,args:[I.snow]}),r.bn(S.rain,I.rain)||L.push({command:yr.setRain,args:[I.rain]}),r.bn(S.projection,I.projection)||L.push({command:yr.setProjection,args:[I.projection]}),r.bn(S.lights,I.lights)||L.push({command:yr.setLights,args:[I.lights]}),r.bn(S.camera,I.camera)||L.push({command:yr.setCamera,args:[I.camera]}),!r.bn(S["color-theme"],I["color-theme"]))return[{command:yr.setStyle,args:[I]}];const D={},B=[];(function(G,re,Q,ue){let ce;for(ce in re=re||{},G=G||{})G.hasOwnProperty(ce)&&(re.hasOwnProperty(ce)||Eo(ce,Q,ue));for(ce in re){if(!re.hasOwnProperty(ce))continue;const ye=re[ce];G.hasOwnProperty(ce)?r.bn(G[ce],ye)||(G[ce].type==="geojson"&&ye.type==="geojson"&&Kn(G,re,ce)?Q.push({command:yr.setGeoJSONSourceData,args:[ce,ye.data]}):Fa(ce,re,Q,ue)):ia(ce,re,Q)}})(S.sources,I.sources,B,D);const V=[];S.layers&&S.layers.forEach(G=>{G.source&&D[G.source]?L.push({command:yr.removeLayer,args:[G.id]}):V.push(G)});let U=S.terrain;U&&D[U.source]&&(L.push({command:yr.setTerrain,args:[void 0]}),U=void 0),L=L.concat(B),r.bn(U,I.terrain)||L.push({command:yr.setTerrain,args:[I.terrain]}),function(G,re,Q){re=re||[];const ue=(G=G||[]).map(Jn),ce=re.map(Jn),ye=G.reduce(Xn,{}),Ae=re.reduce(Xn,{}),Ee=ue.slice(),Fe=Object.create(null);let ze,Oe,ke,Ge,Ze,ft,ct;for(ze=0,Oe=0;ze<ue.length;ze++)ke=ue[ze],Ae.hasOwnProperty(ke)?Oe++:(Q.push({command:yr.removeLayer,args:[ke]}),Ee.splice(Ee.indexOf(ke,Oe),1));for(ze=0,Oe=0;ze<ce.length;ze++)ke=ce[ce.length-1-ze],Ee[Ee.length-1-ze]!==ke&&(ye.hasOwnProperty(ke)?(Q.push({command:yr.removeLayer,args:[ke]}),Ee.splice(Ee.lastIndexOf(ke,Ee.length-Oe),1)):Oe++,ft=Ee[Ee.length-ze],Q.push({command:yr.addLayer,args:[Ae[ke],ft]}),Ee.splice(Ee.length-ze,0,ke),Fe[ke]=!0);for(ze=0;ze<ce.length;ze++)if(ke=ce[ze],Ge=ye[ke],Ze=Ae[ke],!Fe[ke]&&!r.bn(Ge,Ze))if(r.bn(Ge.source,Ze.source)&&r.bn(Ge["source-layer"],Ze["source-layer"])&&r.bn(Ge.type,Ze.type)){for(ct in qt(Ge.layout,Ze.layout,Q,ke,null,yr.setLayoutProperty),qt(Ge.paint,Ze.paint,Q,ke,null,yr.setPaintProperty),r.bn(Ge.slot,Ze.slot)||Q.push({command:yr.setSlot,args:[ke,Ze.slot]}),r.bn(Ge.filter,Ze.filter)||Q.push({command:yr.setFilter,args:[ke,Ze.filter]}),r.bn(Ge.minzoom,Ze.minzoom)&&r.bn(Ge.maxzoom,Ze.maxzoom)||Q.push({command:yr.setLayerZoomRange,args:[ke,Ze.minzoom,Ze.maxzoom]}),Ge)Ge.hasOwnProperty(ct)&&ct!=="layout"&&ct!=="paint"&&ct!=="filter"&&ct!=="metadata"&&ct!=="minzoom"&&ct!=="maxzoom"&&ct!=="slot"&&(ct.indexOf("paint.")===0?qt(Ge[ct],Ze[ct],Q,ke,ct.slice(6),yr.setPaintProperty):r.bn(Ge[ct],Ze[ct])||Q.push({command:yr.setLayerProperty,args:[ke,ct,Ze[ct]]}));for(ct in Ze)Ze.hasOwnProperty(ct)&&!Ge.hasOwnProperty(ct)&&ct!=="layout"&&ct!=="paint"&&ct!=="filter"&&ct!=="metadata"&&ct!=="minzoom"&&ct!=="maxzoom"&&ct!=="slot"&&(ct.indexOf("paint.")===0?qt(Ge[ct],Ze[ct],Q,ke,ct.slice(6),yr.setPaintProperty):r.bn(Ge[ct],Ze[ct])||Q.push({command:yr.setLayerProperty,args:[ke,ct,Ze[ct]]}))}else Q.push({command:yr.removeLayer,args:[ke]}),ft=Ee[Ee.lastIndexOf(ke)+1],Q.push({command:yr.addLayer,args:[Ze,ft]})}(V,I.layers,L)}catch(D){console.warn("Unable to compute style diff:",D),L=[{command:yr.setStyle,args:[I]}]}return L}(this.serialize(),t).filter(S=>!(S.command in Pf));if(h.length===0)return!1;const g=h.filter(S=>!(S.command in Cp));if(g.length>0)throw new Error(`Unimplemented: ${g.map(S=>S.command).join(", ")}.`);const v=[];return h.forEach(S=>{v.push(this[S.command].apply(this,S.args))}),o&&Promise.all(v).then(o),this.stylesheet=t,this.mergeAll(),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options}),!0}addImage(t,o){return this.getImage(t)?this.fire(new r.y(new Error("An image with this name already exists."))):(this.imageManager.addImage(t,this.scope,o),this._afterImageUpdated(t),this)}updateImage(t,o,h=!1){this.imageManager.updateImage(t,this.scope,o),h&&this._afterImageUpdated(t)}getImage(t){return this.imageManager.getImage(t,this.scope)}removeImage(t){return this.getImage(t)?(this.imageManager.removeImage(t,this.scope),this._afterImageUpdated(t),this):this.fire(new r.y(new Error("No image with this name exists.")))}_afterImageUpdated(t){this._availableImages=this.imageManager.listImages(this.scope),this._changes.updateImage(t),this.dispatcher.broadcast("setImages",{scope:this.scope,images:this._availableImages}),this.fire(new r.z("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this._availableImages.slice()}addModel(t,o,h={}){return this._checkLoaded(),this._validate(et,`models.${t}`,o,null,h)||(this.modelManager.addModel(t,o,this.scope),this._changes.setDirty()),this}hasModel(t){return this.modelManager.hasModel(t,this.scope)}removeModel(t){return this.hasModel(t)?(this.modelManager.removeModel(t,this.scope),this):this.fire(new r.y(new Error("No model with this ID exists.")))}listModels(){return this._checkLoaded(),this.modelManager.listModels(this.scope)}addSource(t,o,h={}){if(this._checkLoaded(),this.getOwnSource(t)!==void 0)throw new Error(`There is already a source with ID "${t}".`);if(!o.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(o).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(o.type)>=0&&this._validate(as,`sources.${t}`,o,null,h))return;this.map&&this.map._collectResourceTiming&&(o.collectResourceTiming=!0);const g=tl(t,o,this.dispatcher,this);g.scope=this.scope,g.setEventedParent(this,()=>({isSourceLoaded:this._isSourceCacheLoaded(g.id),source:g.serialize(),sourceId:g.id}));const v=S=>{const I=(S?"symbol:":"other:")+g.id,L=r.aC(I,this.scope),D=this._sourceCaches[I]=new Ls(L,g,S);(S?this._symbolSourceCaches:this._otherSourceCaches)[g.id]=D,D.onAdd(this.map)};v(!1),o.type!=="vector"&&o.type!=="geojson"||v(!0),g.onAdd&&g.onAdd(this.map),h.isInitialLoad||(this.mergeSources(),this._changes.setDirty())}removeSource(t){this._checkLoaded();const o=this.getOwnSource(t);if(!o)throw new Error("There is no source with this ID");for(const g in this._layers)if(this._layers[g].source===t)return this.fire(new r.y(new Error(`Source "${t}" cannot be removed while layer "${g}" is using it.`)));if(this.terrain&&this.terrain.scope===this.scope&&this.terrain.get().source===t)return this.fire(new r.y(new Error(`Source "${t}" cannot be removed while terrain is using it.`)));const h=this.getOwnSourceCaches(t);for(const g of h){const v=r.cq(g.id);delete this._sourceCaches[v],this._changes.discardSourceCacheUpdate(g.id),g.fire(new r.z("data",{sourceDataType:"metadata",dataType:"source",sourceId:g.getSource().id})),g.setEventedParent(null),g.clearTiles()}return delete this._otherSourceCaches[t],delete this._symbolSourceCaches[t],this.mergeSources(),o.setEventedParent(null),o.onRemove&&o.onRemove(this.map),this._changes.setDirty(),this}setGeoJSONSourceData(t,o){this._checkLoaded(),this.getOwnSource(t).setData(o),this._changes.setDirty()}getOwnSource(t){const o=this.getOwnSourceCache(t);return o&&o.getSource()}getOwnSources(){const t=[];for(const o in this._otherSourceCaches){const h=this.getOwnSourceCache(o);h&&t.push(h.getSource())}return t}areTilesLoaded(){const t=this._mergedSourceCaches;for(const o in t){const h=t[o]._tiles;for(const g in h){const v=h[g];if(v.state!=="loaded"&&v.state!=="errored")return!1}}return!0}setLights(t){if(this._checkLoaded(),!t)return delete this.ambientLight,void delete this.directionalLight;const o=this._getTransitionParameters();for(const g of t){if(this._validate(Ao,"lights",g))return;switch(g.type){case"ambient":if(this.ambientLight){const v=this.ambientLight;v.set(g),v.updateTransitions(o)}else this.ambientLight=new so(g,Br||(Br=new r.a5({color:new r.a6(r.a3.properties_light_ambient.color),"color-use-theme":new r.a6({type:"string",default:"default","property-type":"data-constant"}),intensity:new r.a6(r.a3.properties_light_ambient.intensity)})),this.scope,this.options);break;case"directional":if(this.directionalLight){const v=this.directionalLight;v.set(g),v.updateTransitions(o)}else this.directionalLight=new so(g,ti||(ti=new r.a5({direction:new r.ak(r.a3.properties_light_directional.direction),color:new r.a6(r.a3.properties_light_directional.color),"color-use-theme":new r.a6({type:"string",default:"default","property-type":"data-constant"}),intensity:new r.a6(r.a3.properties_light_directional.intensity),"cast-shadows":new r.a6(r.a3.properties_light_directional["cast-shadows"]),"shadow-quality":new r.a6(r.a3.properties_light_directional["shadow-quality"]),"shadow-intensity":new r.a6(r.a3.properties_light_directional["shadow-intensity"])})),this.scope,this.options)}}const h=new r.a8(this.z||0,o);this.ambientLight&&this.ambientLight.recalculate(h),this.directionalLight&&this.directionalLight.recalculate(h),this._brightness=this.calculateLightsBrightness(),this.dispatcher.broadcast("setBrightness",this._brightness)}calculateLightsBrightness(){const t=this.directionalLight,o=this.ambientLight;if(!t||!o)return;const h=U=>.2126*(U[0]<=.03928?U[0]/12.92:Math.pow((U[0]+.055)/1.055,2.4))+.7152*(U[1]<=.03928?U[1]/12.92:Math.pow((U[1]+.055)/1.055,2.4))+.0722*(U[2]<=.03928?U[2]/12.92:Math.pow((U[2]+.055)/1.055,2.4)),g=t.properties.get("color").toRenderColor(null).toArray01(),v=t.properties.get("intensity"),S=t.properties.get("direction"),I=1-r.cb(S.x,S.y,S.z)[2]/90,L=h(g)*v*I,D=o.properties.get("color").toRenderColor(null).toArray01(),B=o.properties.get("intensity"),V=h(D)*B;return Number(((L+V)/2).toFixed(6))}getBrightness(){return this._brightness}getLights(){if(!this.enable3dLights())return null;const t=[];return this.directionalLight&&t.push(this.directionalLight.get()),this.ambientLight&&t.push(this.ambientLight.get()),t}enable3dLights(){return!!this.ambientLight&&!!this.directionalLight}getFragmentStyle(t){if(!t)return this;if(r.cr(t)){const o=r.cs(t),h=this.fragments.find(({id:v})=>v===o);if(!h)throw new Error(`Style import '${t}' not found`);const g=r.cq(t);return h.style.getFragmentStyle(g)}{const o=this.fragments.find(({id:h})=>h===t);if(!o)throw new Error(`Style import '${t}' not found`);return o.style}}setFeaturesetSelectors(t){if(!t)return;const o={},h=(g,v="")=>`${g}::${v}`;this.featuresetSelectors={};for(const g in t){const v=this.featuresetSelectors[g]=[];for(const S of t[g].selectors){if(S.featureNamespace){const L=this.getOwnLayer(S.layer);if(!L){r.w(`Layer is undefined for selector: ${S.layer}`);continue}const D=h(L.source,L.sourceLayer);if(D in o&&o[D]!==S.featureNamespace){r.w(`"featureNamespace ${S.featureNamespace} of featureset ${g}'s selector is not associated to the same source, skip this selector`);continue}o[D]=S.featureNamespace}let I;if(S.properties)for(const L in S.properties){const D=r.U(S.properties[L]);D.result==="success"&&(I=I||{},I[L]=D.value)}v.push({layerId:S.layer,namespace:S.featureNamespace,properties:I})}}}getFeaturesetDescriptors(t){const o=this.getFragmentStyle(t);if(!o||!o.stylesheet.featuresets)return[];const h=[];for(const g in o.stylesheet.featuresets)h.push({featuresetId:g,importId:o.scope?o.scope:void 0});return h}getFeaturesetLayers(t,o){const h=this.getFragmentStyle(o),g=h.stylesheet.featuresets;if(!g||!g[t])return this.fire(new r.y(new Error(`The featureset '${t}' does not exist in the map's style and cannot be queried.`))),[];const v=[];for(const S of g[t].selectors){const I=h.getOwnLayer(S.layer);I&&v.push(I)}return v}getConfigProperty(t,o){const h=this.getFragmentStyle(t);if(!h)return null;const g=r.aC(o,h.scope),v=h.options.get(g),S=v?v.value||v.default:null;return S?S.serialize():null}setConfigProperty(t,o,h){const g=this.getFragmentStyle(t);if(!g)return;const v=g.stylesheet.indoor?Od(g.stylesheet.schema):g.stylesheet.schema;if(!v||!v[o])return;const S=r.U(h);if(S.result!=="success")return void ec(this,S.value);const I=S.value.expression,L=r.aC(o,g.scope),D=g.options.get(L);if(!D)return;let B;const{minValue:V,maxValue:U,stepValue:G,type:re,values:Q}=v[o],ue=r.U(v[o].default);ue.result==="success"&&(B=ue.value.expression),B?(this.options.set(L,{...D,value:I,default:B,minValue:V,maxValue:U,stepValue:G,type:re,values:Q}),this.updateConfigDependencies(o)):this.fire(new r.y(new Error(`No schema defined for the config option "${o}" in the "${t}" fragment.`)))}getConfig(t){const o=this.getFragmentStyle(t);if(!o)return null;const h=o.stylesheet.schema;if(!h)return null;const g={};for(const v in h){const S=r.aC(v,o.scope),I=o.options.get(S),L=I?I.value||I.default:null;g[v]=L?L.serialize():null}return g}setConfig(t,o){const h=this.getFragmentStyle(t);h&&(h.updateConfig(o,h.stylesheet.schema),this.updateConfigDependencies())}getSchema(t){const o=this.getFragmentStyle(t);return o?o.stylesheet.schema:null}setSchema(t,o){const h=this.getFragmentStyle(t);h&&(h.stylesheet.schema=o,h.updateConfig(h._config,o),this.updateConfigDependencies())}updateConfig(t,o){if(this._config=t,t||o)if(o)for(const h in o){let g,v;const S=r.U(o[h].default);if(S.result==="success"&&(g=S.value.expression),t&&t[h]!==void 0){const U=r.U(t[h]);U.result==="success"&&(v=U.value.expression)}const{minValue:I,maxValue:L,stepValue:D,type:B,values:V}=o[h];if(g){const U=r.aC(h,this.scope);this.options.set(U,{default:g,value:v,minValue:I,maxValue:L,stepValue:D,type:B,values:V})}else this.fire(new r.y(new Error(`No schema defined for config option "${h}".`)))}else this.fire(new r.y(new Error("Attempting to set config for a style without schema.")))}updateConfigDependencies(t){for(const o of this._configDependentLayers){const h=this.getLayer(o);if(h){if(t&&!h.configDependencies.has(t))continue;h.possiblyEvaluateVisibility(),this._updateLayer(h)}}this.ambientLight&&this.ambientLight.updateConfig(this.options),this.directionalLight&&this.directionalLight.updateConfig(this.options),this.fog&&this.fog.updateConfig(this.options),this.snow&&this.snow.updateConfig(this.options),this.rain&&this.rain.updateConfig(this.options),this.forEachFragmentStyle(o=>{const h=o._styleColorTheme.colorThemeOverride?o._styleColorTheme.colorThemeOverride:o._styleColorTheme.colorTheme;if(h){const g=o._evaluateColorThemeData(h);(!o._styleColorTheme.lut&&g!==""||o._styleColorTheme.lut&&g!==o._styleColorTheme.lut.data)&&o.setColorTheme(h)}}),this._changes.setDirty()}addLayer(t,o,h={}){this._checkLoaded();const g=t.id;if(this._layers[g])return void this.fire(new r.y(new Error(`Layer with id "${g}" already exists on this map`)));let v;if(t.type==="custom"){if(ec(this,r.ct(t)))return;v=r.cu(t,this.scope,this._styleColorTheme.lut,this.options)}else{if(typeof t.source=="object"&&(this.addSource(g,t.source),t=r.cp(t),t=r.l(t,{source:g})),this._validate(de,`layers.${g}`,t,{arrayIndex:-1},h))return;v=r.cu(t,this.scope,this._styleColorTheme.lut,this.options),this._validateLayer(v),v.setEventedParent(this,{layer:{id:g}})}v.configDependencies.size!==0&&this._configDependentLayers.add(v.fqid);let S=this._order.length;if(o){const B=this._order.indexOf(o);if(B===-1)return void this.fire(new r.y(new Error(`Layer with id "${o}" does not exist on this map.`)));v.slot===this._layers[o].slot?S=B:r.w(`Layer with id "${o}" has a different slot. Layers can only be rearranged within the same slot.`)}this._order.splice(S,0,g),this._layerOrderChanged=!0,this._layers[g]=v;const I=this.getOwnLayerSourceCache(v),L=!!this.directionalLight&&this.directionalLight.shadowsEnabled();I&&v.canCastShadows()&&L&&(I.castsShadows=!0);const D=this._changes.getRemovedLayer(v);if(D&&v.source&&I&&v.type!=="custom"){this._changes.discardLayerRemoval(v);const B=r.aC(v.source,v.scope);D.type!==v.type?this._changes.updateSourceCache(B,"clear"):(this._changes.updateSourceCache(B,"reload"),I.pause())}this._updateLayer(v),v.onAdd&&v.onAdd(this.map),v.scope=this.scope,this.mergeLayers()}moveLayer(t,o){this._checkLoaded();const h=this._checkLayer(t);if(!h||t===o)return;const g=this._order.indexOf(t);this._order.splice(g,1);let v=this._order.length;if(o){const S=this._order.indexOf(o);if(S===-1)return void this.fire(new r.y(new Error(`Layer with id "${o}" does not exist on this map.`)));h.slot===this._layers[o].slot?v=S:r.w(`Layer with id "${o}" has a different slot. Layers can only be rearranged within the same slot.`)}this._order.splice(v,0,t),this._changes.setDirty(),this._layerOrderChanged=!0,this.mergeLayers()}removeLayer(t){this._checkLoaded();const o=this._checkLayer(t);if(!o)return;o.setEventedParent(null);const h=this._order.indexOf(t);this._order.splice(h,1),delete this._layers[t],this._changes.setDirty(),this._layerOrderChanged=!0,this._configDependentLayers.delete(o.fqid),this._changes.removeLayer(o);const g=this.getOwnLayerSourceCache(o);if(g&&g.castsShadows){let v=!1;for(const S in this._layers)if(this._layers[S].source===o.source&&this._layers[S].canCastShadows()){v=!0;break}g.castsShadows=v}o.onRemove&&o.onRemove(this.map),this.mergeLayers()}getOwnLayer(t){return this._layers[t]}hasLayer(t){return t in this._mergedLayers}hasLayerType(t){for(const o in this._layers)if(this._layers[o].type===t)return!0;return!1}setLayerZoomRange(t,o,h){this._checkLoaded();const g=this._checkLayer(t);g&&(g.minzoom===o&&g.maxzoom===h||(o!=null&&(g.minzoom=o),h!=null&&(g.maxzoom=h),this._updateLayer(g)))}getSlots(){return this._checkLoaded(),this._mergedSlots}setSlot(t,o){this._checkLoaded();const h=this._checkLayer(t);h&&h.slot!==o&&(h.slot=o,this._updateLayer(h))}setFilter(t,o,h={}){this._checkLoaded();const g=this._checkLayer(t);if(g&&!r.bn(g.filter,o))return o==null?(g.filter=void 0,void this._updateLayer(g)):void(this._validate(Se,`layers.${g.id}.filter`,o,{layerType:g.type},h)||(g.filter=r.cp(o),this._updateLayer(g)))}getFilter(t){const o=this._checkLayer(t);if(o)return r.cp(o.filter)}setLayoutProperty(t,o,h,g={}){this._checkLoaded();const v=this._checkLayer(t);if(v&&!r.bn(v.getLayoutProperty(o),h)){if(h!=null&&(!g||g.validate!==!1)&&ec(v,$e.call(io,{key:`layers.${t}.layout.${o}`,layerType:v.type,objectKey:o,value:h,styleSpec:r.a3,style:{glyphs:!0,sprite:!0}})))return;v.setLayoutProperty(o,h),v.configDependencies.size!==0&&this._configDependentLayers.add(v.fqid),this._updateLayer(v)}}getLayoutProperty(t,o){const h=this._checkLayer(t);if(h)return h.getLayoutProperty(o)}setPaintProperty(t,o,h,g={}){this._checkLoaded();const v=this._checkLayer(t);if(!v||r.bn(v.getPaintProperty(o),h)||h!=null&&(!g||g.validate!==!1)&&ec(v,He.call(io,{key:`layers.${t}.paint.${o}`,layerType:v.type,objectKey:o,value:h,styleSpec:r.a3})))return;const S=v.setPaintProperty(o,h);v.configDependencies.size!==0&&this._configDependentLayers.add(v.fqid),S&&this._updateLayer(v),this._changes.updatePaintProperties(v)}getPaintProperty(t,o){const h=this._checkLayer(t);if(h)return h.getPaintProperty(o)}setFeatureState(t,o){if(this._checkLoaded(),"target"in t){if("featuresetId"in t.target){const{featuresetId:L,importId:D}=t.target,B=this.getFragmentStyle(D),V=B.getFeaturesetLayers(L);for(const{source:U,sourceLayer:G}of V)B.setFeatureState({id:t.id,source:U,sourceLayer:G},o)}else if("layerId"in t.target){const{layerId:L}=t.target,D=this.getLayer(L);this.setFeatureState({id:t.id,source:D.source,sourceLayer:D.sourceLayer},o)}return}const h=t.source,g=t.sourceLayer,v=this._checkSource(h);if(!v)return;const S=v.type;if(S==="geojson"&&g)return void this.fire(new r.y(new Error("GeoJSON sources cannot have a sourceLayer parameter.")));if(S==="vector"&&!g)return void this.fire(new r.y(new Error("The sourceLayer parameter must be provided for vector source types.")));t.id===void 0&&this.fire(new r.y(new Error("The feature id parameter must be provided.")));const I=this.getOwnSourceCaches(h);for(const L of I)L.setFeatureState(g,t.id,o)}removeFeatureState(t,o){if(this._checkLoaded(),"target"in t){if("featuresetId"in t.target){const{featuresetId:L,importId:D}=t.target,B=this.getFragmentStyle(D),V=B.getFeaturesetLayers(L);for(const{source:U,sourceLayer:G}of V)B.removeFeatureState({id:t.id,source:U,sourceLayer:G},o)}else if("layerId"in t.target){const{layerId:L}=t.target,D=this.getLayer(L);this.removeFeatureState({id:t.id,source:D.source,sourceLayer:D.sourceLayer},o)}return}const h=t.source,g=this._checkSource(h);if(!g)return;const v=g.type,S=v==="vector"?t.sourceLayer:void 0;if(v==="vector"&&!S)return void this.fire(new r.y(new Error("The sourceLayer parameter must be provided for vector source types.")));if(o&&typeof t.id!="string"&&typeof t.id!="number")return void this.fire(new r.y(new Error("A feature id is required to remove its specific state property.")));const I=this.getOwnSourceCaches(h);for(const L of I)L.removeFeatureState(S,t.id,o)}getFeatureState(t){if(this._checkLoaded(),"target"in t){let v;if("featuresetId"in t.target){const{featuresetId:S,importId:I}=t.target,L=this.getFragmentStyle(I),D=L.getFeaturesetLayers(S);for(const{source:B,sourceLayer:V}of D){const U=L.getFeatureState({id:t.id,source:B,sourceLayer:V});if(U&&!v)v=U;else if(!r.bn(v,U))return void this.fire(new r.y(new Error("The same feature id exists in multiple sources in the featureset, but their feature states are not consistent through the sources.")))}}else if("layerId"in t.target){const{layerId:S}=t.target,I=this.getLayer(S);v=this.getFeatureState({id:t.id,source:I.source,sourceLayer:I.sourceLayer})}return v}const o=t.source,h=t.sourceLayer,g=this._checkSource(o);if(g){if(g.type!=="vector"||h)return t.id===void 0&&this.fire(new r.y(new Error("The feature id parameter must be provided."))),this.getOwnSourceCaches(o)[0].getFeatureState(h,t.id);this.fire(new r.y(new Error("The sourceLayer parameter must be provided for vector source types.")))}}setTransition(t){return this.stylesheet.transition=r.l({},this.stylesheet.transition,t),this.transition=this.stylesheet.transition,this}getTransition(){return r.l({},this.stylesheet.transition)}serialize(){this._checkLoaded();const t=this.getTerrain(),o=t&&this.terrain&&this.terrain.scope===this.scope?t:this.stylesheet.terrain;return r.cv({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,fragment:this.stylesheet.fragment,imports:this._serializeImports(),schema:this.stylesheet.schema,camera:this.stylesheet.camera,light:this.stylesheet.light,lights:this.stylesheet.lights,terrain:o,fog:this.stylesheet.fog,snow:this.stylesheet.snow,rain:this.stylesheet.rain,center:this.stylesheet.center,"color-theme":this.stylesheet["color-theme"],zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,projection:this.stylesheet.projection,sources:this._serializeSources(),layers:this._serializeLayers(this._order)},h=>h!==void 0)}_updateFilteredLayers(t){for(const o of Object.values(this._mergedLayers))t(o)&&this._updateLayer(o)}_updateLayer(t){this._changes.updateLayer(t);const o=this.getLayerSourceCache(t),h=r.aC(t.source,t.scope),g=this._changes.getUpdatedSourceCaches();t.source&&!g[h]&&o&&o.getSource().type!=="raster"&&(this._changes.updateSourceCache(h,"reload"),o.pause()),t.invalidateCompiledFilter()}_flattenAndSortRenderedFeatures(t){const o=I=>this._mergedLayers[I].is3D(),h=this.order,g={},v=[];for(let I=h.length-1;I>=0;I--){const L=h[I];if(o(L)){g[L]=I;for(const D of t){const B=D[L];if(B)for(const V of B)v.push(V)}}}v.sort((I,L)=>L.intersectionZ-I.intersectionZ);const S=[];for(let I=h.length-1;I>=0;I--){const L=h[I];if(o(L))for(let D=v.length-1;D>=0;D--){const B=v[D].feature;if(B.layer&&g[B.layer.id]<I)break;S.push(B),v.pop()}else for(const D of t){const B=D[L];if(B)for(const V of B)S.push(V.feature)}}return S}queryRenderedFeatures(t,o,h){let g;o&&!Array.isArray(o)&&o.filter&&(this._validate(Se,"queryRenderedFeatures.filter",o.filter,null,o),g=r.aZ(o.filter));const v={},S=B=>{if(la.has(B.type))return;const V=this.getOwnLayerSourceCache(B),U=v[V.id]=v[V.id]||{sourceCache:V,layers:{},has3DLayers:!1};B.is3D()&&(U.has3DLayers=!0),U.layers[B.fqid]=U.layers[B.fqid]||{styleLayer:B,targets:[]},U.layers[B.fqid].targets.push({filter:g})};if(o&&o.layers){if(!Array.isArray(o.layers))return this.fire(new r.y(new Error("parameters.layers must be an Array."))),[];for(const B of o.layers){const V=this._layers[B];if(!V)return this.fire(new r.y(new Error(`The layer '${B}' does not exist in the map's style and cannot be queried for features.`))),[];S(V)}}else for(const B in this._layers)S(this._layers[B]);const I=this._queryRenderedFeatures(t,v,h),L=this._flattenAndSortRenderedFeatures(I),D=[];for(const B of L)r.cs(B.layer.id)===this.scope&&D.push(B);return D}queryRenderedFeatureset(t,o,h){let g;o&&!Array.isArray(o)&&o.filter&&(this._validate(Se,"queryRenderedFeatures.filter",o.filter,null,o),g=r.aZ(o.filter));const v="mock",S=[];if(o&&o.target)S.push({...o,targetId:v,filter:g});else{const D=this.getFeaturesetDescriptors();for(const B of D)S.push({targetId:v,filter:g,target:B});for(const{style:B}of this.fragments){const V=B.getFeaturesetDescriptors();for(const U of V)S.push({targetId:v,filter:g,target:U})}}const I=this.queryRenderedTargets(t,S,h),L=[];for(const D of I)for(const B of D.variants[v])L.push(new r.cw(D,B));return L}queryRenderedTargets(t,o,h){const g={},v=(I,L,D,B)=>{const V=g[L.id]=g[L.id]||{sourceCache:L,layers:{},has3DLayers:!1};V.layers[I.fqid]=V.layers[I.fqid]||{styleLayer:I,targets:[]},I.is3D()&&(V.has3DLayers=!0),V.layers[I.fqid].targets.push(B?{...D,namespace:B.namespace,properties:B.properties}:D)};for(const I of o)if("featuresetId"in I.target){const{featuresetId:L,importId:D}=I.target,B=this.getFragmentStyle(D),V=B.featuresetSelectors[L];if(!V){this.fire(new r.y(new Error(`The featureset '${L}' does not exist in the map's style and cannot be queried for features.`)));continue}for(const U of V){const G=B.getOwnLayer(U.layerId);G&&!la.has(G.type)&&v(G,B.getOwnLayerSourceCache(G),I,U)}}else if("layerId"in I.target){const{layerId:L}=I.target,D=this.getLayer(L);if(!D||la.has(D.type))continue;v(D,this.getLayerSourceCache(D),I)}const S=this._queryRenderedFeatures(t,g,h);return this._flattenAndSortRenderedFeatures(S)}_queryRenderedFeatures(t,o,h){const g=[],v=!!this.map._showQueryGeometry,S=ao.createFromScreenPoints(t,h);for(const I in o){const L=ya(S,o[I],this._availableImages,h,v);Object.keys(L).length&&g.push(L)}if(this.placement)for(const I in o){if(!o[I].sourceCache._onlySymbols)continue;const L=co(S.screenGeometry,o[I],this._availableImages,this.placement.collisionIndex,this.placement.retainedQueryData);Object.keys(L).length&&g.push(L)}return g}querySourceFeatures(t,o){const h=o&&o.filter;h&&this._validate(Se,"querySourceFeatures.filter",h,null,o);let g=[];const v=this.getOwnSourceCaches(t);for(const S of v)g=g.concat(So(S,o));return g}addSourceType(t,o,h){return Va.getSourceType(t)?h(new Error(`A source type called "${t}" already exists.`)):(Va.setSourceType(t,o),o.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:t,url:o.workerSourceURL},h):h(null,null))}getFlatLight(){return this.light.getLight()}setFlatLight(t,o,h={}){this._checkLoaded();const g=this.light.getLight();let v=!1;for(const I in t)if(!r.bn(t[I],g[I])){v=!0;break}if(!v)return;const S=this._getTransitionParameters();this.light.setLight(t,o,h),this.light.updateTransitions(S)}getTerrain(){return this.terrain&&this.terrain.drapeRenderMode===1?this.terrain.get():null}setTerrainForDraping(){this.setTerrain({source:"",exaggeration:0},0)}checkCanvasFingerprintNoise(){this.disableElevatedTerrain===void 0&&(this.disableElevatedTerrain=r.q.hasCanvasFingerprintNoise(),this.disableElevatedTerrain&&r.w("Terrain and hillshade are disabled because of Canvas2D limitations when fingerprinting protection is enabled (e.g. in private browsing mode)."))}setTerrain(t,o=1){if(this._checkLoaded(),!t)return this.terrainSetForDrapingOnly()||(delete this.terrain,this.map.transform.projection.requiresDraping&&this.setTerrainForDraping()),o===0&&delete this.terrain,t===null?this.stylesheet.terrain=null:delete this.stylesheet.terrain,this._force3DLayerUpdate(),void(this._markersNeedUpdate=!0);this.checkCanvasFingerprintNoise();let h=t;const g=t.source==null;if(o===1){if(this.disableElevatedTerrain)return;if(typeof h.source=="object"){const I="terrain-dem-src";this.addSource(I,h.source),h=r.cp(h),h=r.l(h,{source:I})}const v=r.l({},h),S={};if(this.terrain&&g){v.source=this.terrain.get().source;const I=this.terrain?this.getFragmentStyle(this.terrain.scope):null;I&&(S.style=I.serialize())}if(this._validate(Ts,"terrain",v,S))return}if(!this.terrain||this.terrain.scope!==this.scope&&!g||this.terrain&&o!==this.terrain.drapeRenderMode){if(!h)return;this._createTerrain(h,o),this.fire(new r.z("data",{dataType:"style"}))}else{const v=this.terrain,S=v.get();for(const I of Object.keys(r.a3.terrain))!h.hasOwnProperty(I)&&r.a3.terrain[I].default&&(h[I]=r.a3.terrain[I].default);for(const I in t)if(!r.bn(t[I],S[I])){v.set(t,this.options),this.stylesheet.terrain=t;const L=this._getTransitionParameters({duration:0});v.updateTransitions(L),this.fire(new r.z("data",{dataType:"style"}));break}}this.mergeTerrain(),this.updateDrapeFirstLayers(),this._markersNeedUpdate=!0}_createFog(t){const o=this.fog=new kr(t,this.map.transform,this.scope,this.options);this.stylesheet.fog=o.get();const h=this._getTransitionParameters({duration:0});o.updateTransitions(h)}_createSnow(t){const o=this.snow=new zr(t,this.map.transform,this.scope,this.options);this.stylesheet.snow=o.get();const h=this._getTransitionParameters({duration:0});o.updateTransitions(h)}_createRain(t){const o=this.rain=new po(t,this.map.transform,this.scope,this.options);this.stylesheet.rain=o.get();const h=this._getTransitionParameters({duration:0});o.updateTransitions(h)}_updateMarkersOpacity(){this.map._markers.length!==0&&this.map._requestDomTask(()=>{for(const t of this.map._markers)t._evaluateOpacity()})}getFog(){return this.fog?this.fog.get():null}setFog(t){if(this._checkLoaded(),!t)return delete this.fog,delete this.stylesheet.fog,void(this._markersNeedUpdate=!0);if(this.fog){const o=this.fog;if(!r.bn(o.get(),t)){o.set(t,this.options),this.stylesheet.fog=o.get();const h=this._getTransitionParameters({duration:0});o.updateTransitions(h)}}else this._createFog(t);this._markersNeedUpdate=!0}getSnow(){return this.snow?this.snow.get():null}setSnow(t){if(this._checkLoaded(),!t)return delete this.snow,void delete this.stylesheet.snow;if(this.snow){const o=this.snow;if(!r.bn(o.get(),t)){o.set(t,this.options),this.stylesheet.snow=o.get();const h=this._getTransitionParameters({duration:0});o.updateTransitions(h)}}else this._createSnow(t);this._markersNeedUpdate=!0}getRain(){return this.rain?this.rain.get():null}setRain(t){if(this._checkLoaded(),!t)return delete this.rain,void delete this.stylesheet.rain;if(this.rain){const o=this.rain;if(!r.bn(o.get(),t)){o.set(t,this.options),this.stylesheet.rain=o.get();const h=this._getTransitionParameters({duration:0});o.updateTransitions(h)}}else this._createRain(t);this._markersNeedUpdate=!0}_reloadColorTheme(){const t=()=>{for(const g in this._layers)this._layers[g].lut=this._styleColorTheme.lut;for(const g in this._sourceCaches)this._sourceCaches[g].clearTiles()},o=this._styleColorTheme.colorThemeOverride?this._styleColorTheme.colorThemeOverride:this._styleColorTheme.colorTheme;if(!o)return this._styleColorTheme.lut=null,void t();const h=this._evaluateColorThemeData(o);this._loadColorTheme(h).then(()=>{this.fire(new r.z("colorthemeset")),t()}).catch(g=>{r.w(`Couldn't set color theme: ${g}`)})}setColorTheme(t){this._checkLoaded(),this._styleColorTheme.colorThemeOverride&&r.w("Note: setColorTheme is called on a style with a color-theme override, the passed color-theme won't be visible."),this._styleColorTheme.colorTheme=t,this._reloadColorTheme()}setImportColorTheme(t,o){const h=this.getFragmentStyle(t);h&&(h._styleColorTheme.colorThemeOverride=o,h._reloadColorTheme())}_getTransitionParameters(t){return{now:r.q.now(),transition:r.l(this.transition,t)}}updateDrapeFirstLayers(){if(!this.terrain)return;const t=[],o=[];for(const h of this._mergedOrder)this.isLayerDraped(this._mergedLayers[h])?t.push(h):o.push(h);this._drapedFirstOrder=[],this._drapedFirstOrder.push(...t),this._drapedFirstOrder.push(...o)}_createTerrain(t,o){const h=this.terrain=new Tt(t,o,this.scope,this.options);o===1&&(this.stylesheet.terrain=t),this.mergeTerrain(),this.updateDrapeFirstLayers(),this._force3DLayerUpdate();const g=this._getTransitionParameters({duration:0});h.updateTransitions(g)}_force3DLayerUpdate(){for(const t in this._layers){const o=this._layers[t];o.type==="fill-extrusion"&&this._updateLayer(o)}}_forceSymbolLayerUpdate(){for(const t in this._layers){const o=this._layers[t];o.type==="symbol"&&this._updateLayer(o)}}_validate(t,o,h,g,v={}){if(v&&v.validate===!1)return!1;const S=r.l({},this.serialize());return ec(this,t.call(io,r.l({key:o,style:S,value:h,styleSpec:r.a3},g)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),r.cx.off("pluginStateChange",this._rtlTextPluginCallback);for(const t in this._mergedLayers)this._mergedLayers[t].setEventedParent(null);for(const t in this._mergedSourceCaches)this._mergedSourceCaches[t].clearTiles(),this._mergedSourceCaches[t].setEventedParent(null);this.setEventedParent(null),delete this.fog,delete this.snow,delete this.rain,delete this.terrain,delete this.ambientLight,delete this.directionalLight,this.isRootStyle()&&(this.imageManager.setEventedParent(null),this.modelManager.setEventedParent(null),this.dispatcher.remove())}clearSource(t){const o=this.getSourceCaches(t);for(const h of o)h.clearTiles()}clearSources(){for(const t in this._mergedSourceCaches)this._mergedSourceCaches[t].clearTiles()}reloadSource(t){const o=this.getSourceCaches(t);for(const h of o)h.resume(),h.reload()}reloadSources(){for(const t of this.getSources())t.reload&&t.reload()}updateSources(t){let o;this.directionalLight&&(o=gs(this.directionalLight));for(const h in this._mergedSourceCaches)this._mergedSourceCaches[h].update(t,void 0,void 0,o)}_generateCollisionBoxes(){for(const t in this._sourceCaches){const o=this._sourceCaches[t];o.resume(),o.reload()}}_updatePlacement(t,o,h,g,v,S,I=!1){let L=!1,D=!1;const B={},V={};for(const U of this._mergedOrder){const G=this._mergedLayers[U];if(G.type!=="symbol")continue;const re=r.aC(G.source,G.scope);let Q=B[re];if(!Q){const ce=this.getLayerSourceCache(G);if(!ce)continue;const ye=ce.getRenderableIds(!0).map(Ae=>ce.getTileByID(Ae));V[re]=ye.slice(),Q=B[re]=ye.sort((Ae,Ee)=>Ee.tileID.overscaledZ-Ae.tileID.overscaledZ||(Ae.tileID.isLessThan(Ee.tileID)?-1:1))}const ue=this.crossTileSymbolIndex.addLayer(G,Q,o.center.lng,o.projection);L=L||ue}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._mergedOrder),I=I||this._layerOrderChanged||g===0,this._layerOrderChanged&&this.fire(new r.z("neworder")),(I||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(r.q.now(),o.zoom))&&(this.pauseablePlacement=new ja(o,this._mergedOrder,I,h,g,v,this.placement,this.fog&&o.projection.supportsFog?this.fog.state:null,this._buildingIndex),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._mergedOrder,this._mergedLayers,B,V,this.map.painter.scaleFactor),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(r.q.now()),D=!0),L&&this.pauseablePlacement.placement.setStale()),D||L){this._buildingIndex.onNewFrame(o.zoom);for(let U=0;U<this._mergedOrder.length;U++){const G=this._mergedLayers[this._mergedOrder[U]];if(G.type!=="symbol")continue;const re=this.isLayerClipped(G);this.placement.updateLayerOpacities(G,B[r.aC(G.source,G.scope)],U,re?S:null)}}return{needsRerender:!this.pauseablePlacement.isDone()||this.placement.hasTransitions(r.q.now())}}_releaseSymbolFadeTiles(){for(const t in this._sourceCaches)this._sourceCaches[t].releaseSymbolFadeTiles()}addImport(t,o){this._checkLoaded();const h=this.stylesheet.imports=this.stylesheet.imports||[];if(h.findIndex(({id:v})=>v===t.id)!==-1)return void this.fire(new r.y(new Error(`Import with id '${t.id}' already exists in the map's style.`)));if(!o)return h.push(t),this._loadImports([t],!0);const g=h.findIndex(({id:v})=>v===o);return g===-1&&this.fire(new r.y(new Error(`Import with id "${o}" does not exist on this map.`))),this.stylesheet.imports=h.slice(0,g).concat(t).concat(h.slice(g)),this._loadImports([t],!0,o)}updateImport(t,o){this._checkLoaded();const h=this.stylesheet.imports||[],g=this.getImportIndex(t);return g===-1?this:typeof o=="string"?(this.setImportUrl(t,o),this):(o.url&&o.url!==h[g].url&&this.setImportUrl(t,o.url),r.bn(o.config,h[g].config)||this.setImportConfig(t,o.config),r.bn(o.data,h[g].data)||this.setImportData(t,o.data),this)}moveImport(t,o){this._checkLoaded();let h=this.stylesheet.imports||[];const g=this.getImportIndex(t);if(g===-1)return this;const v=this.getImportIndex(o);if(v===-1)return this;const S=h[g],I=this.fragments[g];return h=h.filter(({id:L})=>L!==t),this.fragments=this.fragments.filter(({id:L})=>L!==t),this.stylesheet.imports=h.slice(0,v).concat(S).concat(h.slice(v)),this.fragments=this.fragments.slice(0,v).concat(I).concat(this.fragments.slice(v)),this.mergeLayers(),this}setImportUrl(t,o){this._checkLoaded();const h=this.stylesheet.imports||[],g=this.getImportIndex(t);if(g===-1)return this;h[g].url=o;const v=this.fragments[g];return v.style=this._createFragmentStyle(h[g]),v.style.on("style.import.load",()=>this.mergeAll()),v.style.loadURL(o),this}setImportData(t,o){this._checkLoaded();const h=this.getImportIndex(t),g=this.stylesheet.imports||[];return h===-1?this:o?(this.fragments[h].style.setState(o),this._reloadImports(),this):(delete g[h].data,this.setImportUrl(t,g[h].url))}setImportConfig(t,o){this._checkLoaded();const h=this.getImportIndex(t),g=this.stylesheet.imports||[];if(h===-1)return this;o?g[h].config=o:delete g[h].config;const v=this.fragments[h],S=v.style.stylesheet&&v.style.stylesheet.schema;return v.config=o,v.style.updateConfig(o,S),this.updateConfigDependencies(),this}removeImport(t){this._checkLoaded();const o=this.stylesheet.imports||[],h=this.getImportIndex(t);h!==-1&&(o.splice(h,1),this.fragments[h].style._remove(),this.fragments.splice(h,1),this._reloadImports())}getImportIndex(t){const o=(this.stylesheet.imports||[]).findIndex(h=>h.id===t);return o===-1&&this.fire(new r.y(new Error(`Import '${t}' does not exist in the map's style and cannot be updated.`))),o}getLayer(t){return this._mergedLayers[t]}getSources(){const t=[];for(const o in this._mergedOtherSourceCaches){const h=this._mergedOtherSourceCaches[o];h&&t.push(h.getSource())}return t}getSource(t,o){const h=this.getSourceCache(t,o);return h&&h.getSource()}getLayerSource(t){const o=this.getLayerSourceCache(t);return o&&o.getSource()}getSourceCache(t,o){const h=r.aC(t,o);return this._mergedOtherSourceCaches[h]}getLayerSourceCache(t){const o=r.aC(t.source,t.scope);return t.type==="symbol"?this._mergedSymbolSourceCaches[o]:this._mergedOtherSourceCaches[o]}getSourceCaches(t){if(t==null)return Object.values(this._mergedSourceCaches);const o=[];return this._mergedOtherSourceCaches[t]&&o.push(this._mergedOtherSourceCaches[t]),this._mergedSymbolSourceCaches[t]&&o.push(this._mergedSymbolSourceCaches[t]),o}updateSourceCaches(){const t=this._changes.getUpdatedSourceCaches();for(const o in t){const h=t[o];h==="reload"?this.reloadSource(o):h==="clear"&&this.clearSource(o)}}updateLayers(t){const o=this._changes.getUpdatedPaintProperties();for(const h of o){const g=this.getLayer(h);g&&g.updateTransitions(t)}}getImages(t,o,h){this.imageManager.getImages(o.icons,o.scope,h),this._updateTilesForChangedImages();const g=v=>{v&&v.setDependencies(o.tileID.key,o.type,o.icons)};g(this._otherSourceCaches[o.source]),g(this._symbolSourceCaches[o.source])}rasterizeImages(t,o,h){this.imageManager.rasterizeImages(o,h)}getGlyphs(t,o,h){this.glyphManager.getGlyphs(o.stacks,o.scope,h)}getResource(t,o,h){return r.cy(o,h)}getOwnSourceCache(t){return this._otherSourceCaches[t]}getOwnLayerSourceCache(t){return t.type==="symbol"?this._symbolSourceCaches[t.source]:this._otherSourceCaches[t.source]}getOwnSourceCaches(t){const o=[];return this._otherSourceCaches[t]&&o.push(this._otherSourceCaches[t]),this._symbolSourceCaches[t]&&o.push(this._symbolSourceCaches[t]),o}_isSourceCacheLoaded(t){const o=this.getOwnSourceCaches(t);return o.length===0?(this.fire(new r.y(new Error(`There is no source with ID '${t}'`))),!1):o.every(h=>h.loaded())}has3DLayers(){return this._has3DLayers}hasSymbolLayers(){return this._hasSymbolLayers}hasCircleLayers(){return this._hasCircleLayers}isLayerClipped(t,o){if(!this._clipLayerPresent&&t.type!=="fill-extrusion")return!1;const h=t.type==="fill-extrusion"&&t.sourceLayer==="building";if(t.is3D()){if(h||o&&o.type==="batched-model"||t.type==="model")return!0}else if(t.type==="symbol")return!0;return!1}_clearWorkerCaches(){this.dispatcher.broadcast("clearCaches")}destroy(){this._clearWorkerCaches(),this.fragments.forEach(t=>{t.style._remove()}),this.terrainSetForDrapingOnly()&&(delete this.terrain,delete this.stylesheet.terrain)}}Va.getSourceType=function(u){return Yo[u]},Va.setSourceType=function(u,t){Yo[u]=t},Va.registerForPluginStateChange=r.ch;var Ua=`
#define EPSILON 0.0000001
#define PI 3.141592653589793
#ifdef RENDER_CUTOFF
float cutoff_opacity(vec4 cutoff_params,float depth) {float near=cutoff_params.x;float far=cutoff_params.y;float cutoffStart=cutoff_params.z;float cutoffEnd=cutoff_params.w;float linearDepth=(depth-near)/(far-near);return clamp((linearDepth-cutoffStart)/(cutoffEnd-cutoffStart),0.0,1.0);}
#endif`,fl=`
out vec4 glFragColor;highp float unpack_depth(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}highp vec4 pack_depth(highp float ndc_z) {highp float depth=ndc_z*0.5+0.5;const highp vec4 bit_shift=vec4(255.0*255.0*255.0,255.0*255.0,255.0,1.0);const highp vec4 bit_mask =vec4(0.0,1.0/255.0,1.0/255.0,1.0/255.0);highp vec4 res=fract(depth*bit_shift);res-=res.xxyz*bit_mask;return res;}
#ifdef INDICATOR_CUTOUT
uniform vec3 u_indicator_cutout_centers;uniform vec4 u_indicator_cutout_params;
#endif
vec4 applyCutout(vec4 color,float height) {
#ifdef INDICATOR_CUTOUT
float verticalFadeRange=u_indicator_cutout_centers.z*0.25;float holeMinOpacity=mix(1.0,u_indicator_cutout_params.x,smoothstep(u_indicator_cutout_centers.z,u_indicator_cutout_centers.z+verticalFadeRange,height));float holeRadius=max(u_indicator_cutout_params.y,0.0);float holeAspectRatio=u_indicator_cutout_params.z;float fadeStart=u_indicator_cutout_params.w;float distA=distance(vec2(gl_FragCoord.x,gl_FragCoord.y*holeAspectRatio),vec2(u_indicator_cutout_centers[0],u_indicator_cutout_centers[1]*holeAspectRatio));return color*min(smoothstep(fadeStart,holeRadius,distA)+holeMinOpacity,1.0);
#else
return color;
#endif
}
#ifdef DEBUG_WIREFRAME
#define HANDLE_WIREFRAME_DEBUG \\
glFragColor=vec4(0.7,0.0,0.0,0.7); \\
gl_FragDepth=gl_FragCoord.z-0.0001;
#else
#define HANDLE_WIREFRAME_DEBUG
#endif
#ifdef RENDER_CUTOFF
uniform highp vec4 u_cutoff_params;in float v_cutoff_opacity;
#endif
vec4 textureLodCustom(sampler2D image,highp vec2 pos,highp vec2 lod_coord) {highp vec2 size=vec2(textureSize(image,0));highp vec2 dx=dFdx(lod_coord.xy*size);highp vec2 dy=dFdy(lod_coord.xy*size);highp float delta_max_sqr=max(dot(dx,dx),dot(dy,dy));highp float lod=0.5*log2(delta_max_sqr);return textureLod(image,pos,lod);}vec4 applyLUT(highp sampler3D lut,vec4 col) {vec3 size=vec3(textureSize(lut,0));vec3 uvw=(col.rbg*float(size-1.0)+0.5)/size;return vec4(texture(lut,uvw).rgb,col.a);}vec3 applyLUT(highp sampler3D lut,vec3 col) {return applyLUT(lut,vec4(col,1.0)).rgb;}`,Au=`
#define EXTENT 8192.0
#define RAD_TO_DEG 180.0/PI
#define DEG_TO_RAD PI/180.0
#define GLOBE_RADIUS EXTENT/PI/2.0
float wrap(float n,float min,float max) {float d=max-min;float w=mod(mod(n-min,d)+d,d)+min;return (w==min) ? max : w;}
#ifdef PROJECTION_GLOBE_VIEW
vec3 mercator_tile_position(mat4 matrix,vec2 tile_anchor,vec3 tile_id,vec2 mercator_center) {
#ifndef PROJECTED_POS_ON_VIEWPORT
float tiles=tile_id.z;vec2 mercator=(tile_anchor/EXTENT+tile_id.xy)/tiles;mercator-=mercator_center;mercator.x=wrap(mercator.x,-0.5,0.5);vec4 mercator_tile=vec4(mercator.xy*EXTENT,EXTENT/(2.0*PI),1.0);mercator_tile=matrix*mercator_tile;return mercator_tile.xyz;
#else
return vec3(0.0);
#endif
}vec3 mix_globe_mercator(vec3 globe,vec3 mercator,float t) {return mix(globe,mercator,t);}mat3 globe_mercator_surface_vectors(vec3 pos_normal,vec3 up_dir,float zoom_transition) {vec3 normal=zoom_transition==0.0 ? pos_normal : normalize(mix(pos_normal,up_dir,zoom_transition));vec3 xAxis=normalize(vec3(normal.z,0.0,-normal.x));vec3 yAxis=normalize(cross(normal,xAxis));return mat3(xAxis,yAxis,normal);}
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(
unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const vec2 units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (units_to_pixels*pos+offset)/pattern_size;}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {return get_pattern_pos(pixel_coord_upper,pixel_coord_lower,pattern_size,vec2(tile_units_to_pixels),pos);}float mercatorXfromLng(float lng) {return (180.0+lng)/360.0;}float mercatorYfromLat(float lat) {return (180.0-(RAD_TO_DEG*log(tan(PI/4.0+lat/2.0*DEG_TO_RAD))))/360.0;}vec3 latLngToECEF(vec2 latLng) {latLng=DEG_TO_RAD*latLng;float cosLat=cos(latLng[0]);float sinLat=sin(latLng[0]);float cosLng=cos(latLng[1]);float sinLng=sin(latLng[1]);float sx=cosLat*sinLng*GLOBE_RADIUS;float sy=-sinLat*GLOBE_RADIUS;float sz=cosLat*cosLng*GLOBE_RADIUS;return vec3(sx,sy,sz);}
#ifdef RENDER_CUTOFF
uniform vec4 u_cutoff_params;out float v_cutoff_opacity;
#endif
const vec4 AWAY=vec4(-1000.0,-1000.0,-1000.0,1);const float skirtOffset=24575.0;vec3 decomposeToPosAndSkirt(vec2 posWithComposedSkirt)
{float skirt=float(posWithComposedSkirt.x >=skirtOffset);vec2 pos=posWithComposedSkirt-vec2(skirt*skirtOffset,0.0);return vec3(pos,skirt);}`,Hh="in highp vec3 a_pos_3f;uniform lowp mat4 u_matrix;out highp vec3 v_uv;void main() {const mat3 half_neg_pi_around_x=mat3(1.0,0.0, 0.0,0.0,0.0,-1.0,0.0,1.0, 0.0);v_uv=half_neg_pi_around_x*a_pos_3f;vec4 pos=u_matrix*vec4(a_pos_3f,1.0);gl_Position=pos.xyww;}",Iu=`
#define ELEVATION_SCALE 7.0
#define ELEVATION_OFFSET 450.0
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_tl_up;uniform vec3 u_tile_tr_up;uniform vec3 u_tile_br_up;uniform vec3 u_tile_bl_up;uniform float u_tile_up_scale;vec3 elevationVector(vec2 pos) {vec2 uv=pos/EXTENT;vec3 up=normalize(mix(
mix(u_tile_tl_up,u_tile_tr_up,uv.xxx),mix(u_tile_bl_up,u_tile_br_up,uv.xxx),uv.yyy));return up*u_tile_up_scale;}
#else
vec3 elevationVector(vec2 pos) { return vec3(0,0,1); }
#endif
#ifdef TERRAIN
uniform highp sampler2D u_dem;uniform highp sampler2D u_dem_prev;uniform vec2 u_dem_tl;uniform vec2 u_dem_tl_prev;uniform float u_dem_scale;uniform float u_dem_scale_prev;uniform float u_dem_size;uniform float u_dem_lerp;uniform float u_exaggeration;uniform float u_meter_to_dem;uniform mat4 u_label_plane_matrix_inv;vec4 tileUvToDemSample(vec2 uv,float dem_size,float dem_scale,vec2 dem_tl) {vec2 pos=dem_size*(uv*dem_scale+dem_tl)+1.0;vec2 f=fract(pos);return vec4((pos-f+0.5)/(dem_size+2.0),f);}float currentElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale+u_dem_tl)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem,pos).r;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale,u_dem_tl);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(dd,0)).r;float bl=texture(u_dem,pos+vec2(0,dd)).r;float br=texture(u_dem,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}float prevElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale_prev+u_dem_tl_prev)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem_prev,pos).r;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale_prev,u_dem_tl_prev);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem_prev,pos).r;float tr=texture(u_dem_prev,pos+vec2(dd,0)).r;float bl=texture(u_dem_prev,pos+vec2(0,dd)).r;float br=texture(u_dem_prev,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}
#ifdef TERRAIN_VERTEX_MORPHING
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
float nextElevation=currentElevation(apos);float prevElevation=prevElevation(apos);return mix(prevElevation,nextElevation,u_dem_lerp);}
#else
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
return currentElevation(apos);}
#endif
vec4 fourSample(vec2 pos,vec2 off) {float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(off.x,0.0)).r;float bl=texture(u_dem,pos+vec2(0.0,off.y)).r;float br=texture(u_dem,pos+off).r;return vec4(tl,tr,bl,br);}float flatElevation(vec2 pack) {vec2 apos=floor(pack/8.0);vec2 span=10.0*(pack-apos*8.0);vec2 uvTex=(apos-vec2(1.0,1.0))/8190.0;float size=u_dem_size+2.0;float dd=1.0/size;vec2 pos=u_dem_size*(uvTex*u_dem_scale+u_dem_tl)+1.0;vec2 f=fract(pos);pos=(pos-f+0.5)*dd;vec4 h=fourSample(pos,vec2(dd));float z=mix(mix(h.x,h.y,f.x),mix(h.z,h.w,f.x),f.y);vec2 w=floor(0.5*(span*u_meter_to_dem-1.0));vec2 d=dd*w;h=fourSample(pos-d,2.0*d+vec2(dd));vec4 diff=abs(h.xzxy-h.ywzw);vec2 slope=min(vec2(0.25),u_meter_to_dem*0.5*(diff.xz+diff.yw)/(2.0*w+vec2(1.0)));vec2 fix=slope*span;float base=z+max(fix.x,fix.y);return u_exaggeration*base;}float elevationFromUint16(float word) {return u_exaggeration*(word/ELEVATION_SCALE-ELEVATION_OFFSET);}
#else
float elevation(vec2 pos) { return 0.0; }
#endif
#ifdef DEPTH_OCCLUSION
uniform highp sampler2D u_depth;uniform highp vec2 u_depth_size_inv;uniform highp vec2 u_depth_range_unpack;uniform highp float u_occluder_half_size;uniform highp float u_occlusion_depth_offset;
#ifdef DEPTH_D24
float unpack_depth(float depth) {return depth*u_depth_range_unpack.x+u_depth_range_unpack.y;}vec4 unpack_depth4(vec4 depth) {return depth*u_depth_range_unpack.x+vec4(u_depth_range_unpack.y);}
#else
highp float unpack_depth_rgba(vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}
#endif
bool isOccluded(vec4 frag) {vec3 coord=frag.xyz/frag.w;
#ifdef DEPTH_D24
float depth=unpack_depth(texture(u_depth,(coord.xy+1.0)*0.5).r);
#else
float depth=unpack_depth_rgba(texture(u_depth,(coord.xy+1.0)*0.5));
#endif
return coord.z+u_occlusion_depth_offset > depth;}highp vec4 getCornerDepths(vec2 coord) {highp vec3 df=vec3(u_occluder_half_size*u_depth_size_inv,0.0);highp vec2 uv=0.5*coord.xy+0.5;
#ifdef DEPTH_D24
highp vec4 depth=vec4(
texture(u_depth,uv-df.xz).r,texture(u_depth,uv+df.xz).r,texture(u_depth,uv-df.zy).r,texture(u_depth,uv+df.zy).r
);depth=unpack_depth4(depth);
#else
highp vec4 depth=vec4(
unpack_depth_rgba(texture(u_depth,uv-df.xz)),unpack_depth_rgba(texture(u_depth,uv+df.xz)),unpack_depth_rgba(texture(u_depth,uv-df.zy)),unpack_depth_rgba(texture(u_depth,uv+df.zy))
);
#endif
return depth;}highp float occlusionFadeMultiSample(vec4 frag) {highp vec3 coord=frag.xyz/frag.w;highp vec2 uv=0.5*coord.xy+0.5;int NX=3;int NY=4;highp vec2 df=u_occluder_half_size*u_depth_size_inv;highp vec2 oneStep=2.0*u_occluder_half_size*u_depth_size_inv/vec2(NX-1,NY-1);highp float res=0.0;for (int y=0; y < NY;++y) {for (int x=0; x < NX;++x) {
#ifdef DEPTH_D24
highp float depth=unpack_depth(texture(u_depth,uv-df+vec2(float(x)*oneStep.x,float(y)*oneStep.y)).r);
#else
highp float depth=unpack_depth_rgba(texture(u_depth,uv-df+vec2(float(x)*oneStep.x,float(y)*oneStep.y)));
#endif
res+=1.0-clamp(300.0*(coord.z+u_occlusion_depth_offset-depth),0.0,1.0);}}res=clamp(2.0*res/float(NX*NY)-0.5,0.0,1.0);return res;}highp float occlusionFade(vec4 frag) {highp vec3 coord=frag.xyz/frag.w;highp vec4 depth=getCornerDepths(coord.xy);return dot(vec4(0.25),vec4(1.0)-clamp(300.0*(vec4(coord.z+u_occlusion_depth_offset)-depth),0.0,1.0));}
#else
bool isOccluded(vec4 frag) { return false; }highp float occlusionFade(vec4 frag) { return 1.0; }highp float occlusionFadeMultiSample(vec4 frag) { return 1.0; }
#endif//DEPTH_OCCLUSION`,kl=`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump mat4 u_fog_matrix;out vec3 v_fog_pos;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}vec3 fog_position(vec3 pos) {return (u_fog_matrix*vec4(pos,1.0)).xyz;}vec3 fog_position(vec2 pos) {return fog_position(vec3(pos,0.0));}float fog(vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));return opacity*fog_horizon_blending(pos/depth);}
#endif`,pl=`highp vec3 hash(highp vec2 p) {highp vec3 p3=fract(p.xyx*vec3(443.8975,397.2973,491.1871));p3+=dot(p3,p3.yxz+19.19);return fract((p3.xxy+p3.yzz)*p3.zyx);}vec3 dither(vec3 color,highp vec2 seed) {vec3 rnd=hash(seed)+hash(seed+0.59374)-0.5;return color+rnd/255.0;}
#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump vec2 u_fog_vertical_limit;uniform mediump float u_fog_temporal_offset;in vec3 v_fog_pos;uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform highp vec2 u_viewport;uniform float u_globe_transition;uniform int u_is_globe;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}float globe_glow_progress() {highp vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float sdf=length(closest_point-u_globe_pos)/u_globe_radius;return sdf+PI*0.5;}float fog_opacity(vec3 pos) {float depth=length(pos);return fog_opacity(fog_range(depth));}vec3 fog_apply(vec3 color,vec3 pos,float opacity_limit) {float depth=length(pos);float opacity;if (u_is_globe==1) {float glow_progress=globe_glow_progress();float t=mix(glow_progress,depth,u_globe_transition);opacity=fog_opacity(fog_range(t));} else {opacity=fog_opacity(fog_range(depth));opacity*=fog_horizon_blending(pos/depth);}return mix(color,u_fog_color.rgb,min(opacity,opacity_limit));}vec3 fog_apply(vec3 color,vec3 pos) {return fog_apply(color,pos,1.0);}vec4 fog_apply_from_vert(vec4 color,float fog_opac) {float alpha=EPSILON+color.a;color.rgb=mix(color.rgb/alpha,u_fog_color.rgb,fog_opac)*alpha;return color;}vec3 fog_apply_sky_gradient(vec3 camera_ray,vec3 sky_color) {float horizon_blend=fog_horizon_blending(normalize(camera_ray));return mix(sky_color,u_fog_color.rgb,horizon_blend);}vec4 fog_apply_premultiplied(vec4 color,vec3 pos) {float alpha=EPSILON+color.a;color.rgb=fog_apply(color.rgb/alpha,pos)*alpha;return color;}vec4 fog_apply_premultiplied(vec4 color,vec3 pos,float heightMeters) {float verticalProgress=(u_fog_vertical_limit.x > 0.0 || u_fog_vertical_limit.y > 0.0) ? smoothstep(u_fog_vertical_limit.x,u_fog_vertical_limit.y,heightMeters) : 0.0;float opacityLimit=1.0-smoothstep(0.9,1.0,fog_opacity(pos));return mix(fog_apply_premultiplied(color,pos),color,min(verticalProgress,opacityLimit));}vec3 fog_dither(vec3 color) {
#ifdef FOG_DITHERING
vec2 dither_seed=gl_FragCoord.xy+u_fog_temporal_offset;return dither(color,dither_seed);
#else
return color;
#endif
}vec4 fog_dither(vec4 color) {return vec4(fog_dither(color.rgb),color.a);}
#endif`,tc=`#ifdef RASTER_ARRAY
uniform highp sampler2D u_image0;uniform sampler2D u_image1;const vec4 NODATA=vec4(1);ivec4 _raTexLinearCoord(highp vec2 texCoord,highp vec2 texResolution,out highp vec2 fxy) {texCoord=texCoord*texResolution-0.5;fxy=fract(texCoord);texCoord-=fxy;return ivec4(texCoord.xxyy+vec2(1.5,0.5).xyxy);}vec2 _raTexLinearMix(highp vec2 fxy,highp vec4 colorMix,highp float colorOffset,highp vec4 t00,highp vec4 t10,highp vec4 t01,highp vec4 t11) {vec2 c00=t00==NODATA ? vec2(0) : vec2(colorOffset+dot(t00,colorMix),1);vec2 c10=t10==NODATA ? vec2(0) : vec2(colorOffset+dot(t10,colorMix),1);vec2 c01=t01==NODATA ? vec2(0) : vec2(colorOffset+dot(t01,colorMix),1);vec2 c11=t11==NODATA ? vec2(0) : vec2(colorOffset+dot(t11,colorMix),1);return mix(mix(c01,c11,fxy.x),mix(c00,c10,fxy.x),fxy.y);}vec2 raTexture2D_image0_linear(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec2 fxy;ivec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texelFetch(u_image0,c.yz,0),texelFetch(u_image0,c.xz,0),texelFetch(u_image0,c.yw,0),texelFetch(u_image0,c.xw,0)
);}vec2 raTexture2D_image1_linear(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec2 fxy;ivec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texelFetch(u_image1,c.yz,0),texelFetch(u_image1,c.xz,0),texelFetch(u_image1,c.yw,0),texelFetch(u_image1,c.xw,0)
);}vec2 raTexture2D_image0_nearest(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec4 t=texelFetch(u_image0,ivec2(texCoord*texResolution),0);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}vec2 raTexture2D_image1_nearest(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec4 t=texelFetch(u_image1,ivec2(texCoord*texResolution),0);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}
#endif`,th=`#ifdef RASTER_ARRAY
uniform sampler2D u_velocity;uniform mediump vec2 u_velocity_res;uniform mediump float u_max_speed;const vec4 NO_DATA=vec4(1);const vec2 INVALID_VELOCITY=vec2(-1);uniform highp vec2 u_uv_offset;uniform highp float u_data_offset;uniform highp vec2 u_data_scale;ivec4 rasterArrayLinearCoord(highp vec2 texCoord,highp vec2 texResolution,out highp vec2 fxy) {texCoord=texCoord*texResolution-0.5;fxy=fract(texCoord);texCoord-=fxy;return ivec4(texCoord.xxyy+vec2(1.5,0.5).xyxy);}highp vec2 lookup_velocity(highp vec2 uv) {uv=u_uv_offset.x+u_uv_offset.y*uv;highp vec2 fxy;ivec4 c=rasterArrayLinearCoord(uv,u_velocity_res,fxy);highp vec4 tl=texelFetch(u_velocity,c.yz,0);highp vec4 tr=texelFetch(u_velocity,c.xz,0);highp vec4 bl=texelFetch(u_velocity,c.yw,0);highp vec4 br=texelFetch(u_velocity,c.xw,0);if (tl==NO_DATA) {return INVALID_VELOCITY;}if (tr==NO_DATA) {return INVALID_VELOCITY;}if (bl==NO_DATA) {return INVALID_VELOCITY;}if (br==NO_DATA) {return INVALID_VELOCITY;}highp vec4 t=mix(mix(bl,br,fxy.x),mix(tl,tr,fxy.x),fxy.y);highp vec2 velocity=u_data_offset+vec2(dot(t.rg,u_data_scale),dot(t.ba,u_data_scale));velocity.y=-velocity.y;velocity/=max(u_max_speed,length(velocity));return velocity;}
#endif
uniform highp float u_particle_pos_scale;uniform highp vec2 u_particle_pos_offset;highp vec4 pack_pos_to_rgba(highp vec2 p) {highp vec2 v=(p+u_particle_pos_offset)/u_particle_pos_scale;highp vec4 r=vec4(v.x,fract(v.x*255.0),v.y,fract(v.y*255.0));return vec4(r.x-r.y/255.0,r.y,r.z-r.w/255.0,r.w);}highp vec2 unpack_pos_from_rgba(highp vec4 v) {v=floor(v*255.0+0.5)/255.0;highp vec2 p=vec2(v.x+(v.y/255.0),v.z+(v.w/255.0));return u_particle_pos_scale*p-u_particle_pos_offset;}`,bc=`#ifdef RENDER_SHADOWS
uniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_normal_offset;vec3 shadow_normal_offset(vec3 normal) {float tileInMeters=u_shadow_normal_offset[0];vec3 n=vec3(-normal.xy,tileInMeters*normal.z);float dotScale=min(1.0-dot(normal,u_shadow_direction),1.0)*0.5+0.5;return n*dotScale;}vec3 shadow_normal_offset_model(vec3 normal) {vec3 transformed_normal=vec3(-normal.xy,normal.z);float NDotL=dot(normalize(transformed_normal),u_shadow_direction);float dotScale=min(1.0-NDotL,1.0)*0.5+0.5;return normal*dotScale;}float shadow_normal_offset_multiplier0() {return u_shadow_normal_offset[1];}float shadow_normal_offset_multiplier1() {return u_shadow_normal_offset[2];}
#endif//RENDER_SHADOWS`,nc=`#ifdef RENDER_SHADOWS
#ifdef DEPTH_TEXTURE
uniform highp sampler2D u_shadowmap_0;uniform highp sampler2D u_shadowmap_1;
#else
uniform sampler2D u_shadowmap_0;uniform sampler2D u_shadowmap_1;
#endif
uniform float u_shadow_intensity;uniform float u_shadow_map_resolution;uniform float u_shadow_texel_size;uniform highp vec3 u_shadow_normal_offset;uniform vec2 u_fade_range;uniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_bias;highp float shadow_sample_1(highp vec2 uv,highp float compare) {highp float shadow_depth;
#ifdef DEPTH_TEXTURE
shadow_depth=texture(u_shadowmap_1,uv).r;
#else
shadow_depth=unpack_depth(texture(u_shadowmap_1,uv))*0.5+0.5;
#endif
return step(shadow_depth,compare);}highp float shadow_sample_0(highp vec2 uv,highp float compare) {highp float shadow_depth;
#ifdef DEPTH_TEXTURE
shadow_depth=texture(u_shadowmap_0,uv).r;
#else
shadow_depth=unpack_depth(texture(u_shadowmap_0,uv))*0.5+0.5;
#endif
return step(shadow_depth,compare);}float shadow_occlusion_1(highp vec4 pos,highp float bias) {highp vec2 uv=pos.xy;return shadow_sample_1(uv,pos.z-bias);}float shadow_occlusion_0(highp vec4 pos,highp float bias) {highp float compare0=pos.z-bias;
#ifdef TEXTURE_GATHER
highp vec2 uv=pos.xy;highp vec4 samples=textureGather(u_shadowmap_0,uv,0);lowp vec4 stepSamples=step(samples,vec4(compare0));
#else
highp vec2 uv00=pos.xy-vec2(0.5*u_shadow_texel_size);highp vec2 uv10=uv00+vec2(u_shadow_texel_size,0.0);highp vec2 uv01=uv00+vec2(0.0,u_shadow_texel_size);highp vec2 uv11=uv01+vec2(u_shadow_texel_size,0.0);lowp vec4 stepSamples=vec4(
shadow_sample_0(uv01,compare0),shadow_sample_0(uv11,compare0),shadow_sample_0(uv10,compare0),shadow_sample_0(uv00,compare0)
);
#endif
vec2 f=fract(pos.xy*u_shadow_map_resolution-vec2(0.5));lowp vec2 lerpx=mix(stepSamples.wx,stepSamples.zy,f.xx);return mix(lerpx.x,lerpx.y,f.y);}float shadow_occlusion(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth,highp float bias) {
#ifdef SHADOWS_SINGLE_CASCADE
light_view_pos0.xyz/=light_view_pos0.w;vec2 abs_bounds=abs(light_view_pos0.xy);if (abs_bounds.x >=1.0 || abs_bounds.y >=1.0) {return 0.0;}light_view_pos0.xyz=light_view_pos0.xyz*0.5+0.5;return shadow_occlusion_0(light_view_pos0,bias);
#else
light_view_pos0.xyz/=light_view_pos0.w;light_view_pos1.xyz/=light_view_pos1.w;vec4 uv=vec4(light_view_pos0.xy,light_view_pos1.xy);vec4 abs_bounds=abs(uv);if (abs_bounds.x < 1.0 && abs_bounds.y < 1.0) {light_view_pos0.xyz=light_view_pos0.xyz*0.5+0.5;return shadow_occlusion_0(light_view_pos0,bias);}if (abs_bounds.z >=1.0 || abs_bounds.w >=1.0) {return 0.0;}light_view_pos1.xyz=light_view_pos1.xyz*0.5+0.5;float occlusion1=shadow_occlusion_1(light_view_pos1,bias);return mix(occlusion1,0.0,smoothstep(u_fade_range.x,u_fade_range.y,view_depth));
#endif
}highp float calculate_shadow_bias(float NDotL) {
#ifdef NORMAL_OFFSET
return 0.5*u_shadow_bias.x;
#else
return 0.5*(u_shadow_bias.x+clamp(u_shadow_bias.y*tan(acos(NDotL)),0.0,u_shadow_bias.z));
#endif
}float shadowed_light_factor_normal(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=calculate_shadow_bias(NDotL);float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor_normal_opacity(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth,float shadow_opacity) {float NDotL=dot(N,u_shadow_direction);float bias=calculate_shadow_bias(NDotL);float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias)*shadow_opacity;return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor_normal_unbiased(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}highp vec2 compute_receiver_plane_depth_bias(highp vec3 pos_dx,highp vec3 pos_dy)
{highp vec2 biasUV=vec2(
pos_dy.y*pos_dx.z-pos_dx.y*pos_dy.z,pos_dx.x*pos_dy.z-pos_dy.x*pos_dx.z);biasUV*=1.0/((pos_dx.x*pos_dy.y)-(pos_dx.y*pos_dy.x));return biasUV;}float shadowed_light_factor_plane_bias(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {highp vec3 light_view_pos0_xyz=light_view_pos0.xyz/light_view_pos0.w*0.5+0.5;highp vec3 light_view_pos0_ddx=dFdx(light_view_pos0_xyz);highp vec3 light_view_pos0_ddy=dFdy(light_view_pos0_xyz);highp vec2 plane_depth_bias=compute_receiver_plane_depth_bias(light_view_pos0_ddx,light_view_pos0_ddy);highp float bias=dot(vec2(u_shadow_texel_size,u_shadow_texel_size),plane_depth_bias)+0.0001;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return 1.0-(u_shadow_intensity*occlusion);}float shadowed_light_factor(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return 1.0-(u_shadow_intensity*occlusion);}float shadow_occlusion(float ndotl,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=calculate_shadow_bias(ndotl);return shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);}
#endif`;const Sa=[];rc(Ua,Sa),rc(Au,Sa),rc(fl,Sa);const zl={"_prelude_fog.vertex.glsl":kl,"_prelude_terrain.vertex.glsl":Iu,"_prelude_shadow.vertex.glsl":bc,"_prelude_fog.fragment.glsl":pl,"_prelude_shadow.fragment.glsl":nc,"_prelude_lighting.glsl":`
#ifdef LIGHTING_3D_MODE
uniform mediump vec3 u_lighting_ambient_color;uniform mediump vec3 u_lighting_directional_dir;uniform mediump vec3 u_lighting_directional_color;uniform mediump vec3 u_ground_radiance;float calculate_ambient_directional_factor(vec3 normal) {float NdotL=dot(normal,u_lighting_directional_dir);const float factor_reduction_max=0.3;float dir_luminance=dot(u_lighting_directional_color,vec3(0.2126,0.7152,0.0722));float directional_factor_min=1.0-factor_reduction_max*min(dir_luminance,1.0);float ambient_directional_factor=mix(directional_factor_min,1.0,min((NdotL+1.0),1.0));const float vertical_factor_min=0.92;float vertical_factor=mix(vertical_factor_min,1.0,normal.z*0.5+0.5);return vertical_factor*ambient_directional_factor;}vec3 linearProduct(vec3 srgbIn,vec3 k) {return srgbIn*pow(k,vec3(1./2.2));}vec3 apply_lighting(vec3 color,vec3 normal,float dir_factor) {float ambient_directional_factor=calculate_ambient_directional_factor(normal);vec3 ambient_contrib=ambient_directional_factor*u_lighting_ambient_color;vec3 directional_contrib=u_lighting_directional_color*dir_factor;return linearProduct(color,ambient_contrib+directional_contrib);}vec4 apply_lighting(vec4 color,vec3 normal,float dir_factor) {return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting(vec3 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return apply_lighting(color.rgb,normal,dir_factor);}vec4 apply_lighting(vec4 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting_ground(vec3 color) {return color*u_ground_radiance;}vec4 apply_lighting_ground(vec4 color) {return vec4(apply_lighting_ground(color.rgb),color.a);}float calculate_NdotL(vec3 normal) {const float ext=0.70710678118;return (clamp(dot(normal,u_lighting_directional_dir),-ext,1.0)+ext)/(1.0+ext);}vec4 apply_lighting_with_emission_ground(vec4 color,float emissive_strength) {return mix(apply_lighting_ground(color),color,emissive_strength);}vec3 compute_flood_lighting(vec3 flood_light_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=flood_light_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);float occlusion_ramp=smoothstep(0.0,0.2,1.0-occlusion);return mix(fully_occluded_color,flood_light_color,occlusion_ramp);}vec3 compute_emissive_draped(vec3 unlit_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=unlit_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);return mix(fully_occluded_color,unlit_color,1.0-occlusion);}
#endif//LIGHTING_3D_MODE`,"_prelude_raster_array.glsl":tc,"_prelude_raster_particle.glsl":th},Ll={};gr("",Iu),gr(pl,kl),gr(nc,bc),gr(tc,""),gr(th,"");const wc=gr(fl,Au),nh=Ua;var Wh={background:gr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec4 u_color;uniform float u_opacity;
#ifdef LIGHTING_3D_MODE
in vec4 v_color;
#endif
void main() {vec4 out_color;
#ifdef LIGHTING_3D_MODE
out_color=v_color;
#else
out_color=u_color;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_lighting.glsl"
in vec2 a_pos;uniform mat4 u_matrix;
#ifdef LIGHTING_3D_MODE
uniform mediump vec4 u_color;out vec4 v_color;uniform float u_emissive_strength;
#endif
void main() {gl_Position=u_matrix*vec4(a_pos,0,1);
#ifdef LIGHTING_3D_MODE
v_color=apply_lighting_with_emission_ground(u_color,u_emissive_strength);
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),backgroundPattern:gr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_pattern_tl;uniform vec2 u_pattern_br;uniform vec2 u_texsize;uniform float u_opacity;uniform float u_emissive_strength;uniform sampler2D u_image;in highp vec2 v_pos;void main() {highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(u_pattern_tl/u_texsize,u_pattern_br/u_texsize,imagecoord);vec4 out_color=textureLodCustom(u_image,pos,v_pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_pattern_size;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec2 u_pattern_units_to_pixels;in vec2 a_pos;out highp vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_pattern_size,u_pattern_units_to_pixels,a_pos);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),circle:gr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
in vec3 v_data;in float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
uniform float u_emissive_strength;void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float blur_positive=blur < 0.0 ? 0.0 : 1.0;lowp float antialiasblur=v_data.z;float extrude_length=length(extrude)+antialiasblur*(1.0-blur_positive);float antialiased_blur=-max(abs(blur),antialiasblur);float opacity_t=smoothstep((1.0-blur_positive)*antialiased_blur,blur_positive*antialiased_blur,extrude_length-1.0)-smoothstep(0.0,antialiasblur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(
antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width)
);vec4 out_color=mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_apply_premultiplied(out_color,v_fog_pos);
#endif
glFragColor=out_color*(v_visibility*opacity_t);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define NUM_VISIBILITY_RINGS 2
#define INV_SQRT2 0.70710678
#define ELEVATION_BIAS 0.0001
#define NUM_SAMPLES_PER_RING 16
uniform mat4 u_matrix;uniform mat2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
out vec3 v_data;out float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
vec2 calc_offset(vec2 extrusion,float radius,float stroke_width, float view_scale) {return extrusion*(radius+stroke_width)*u_extrude_scale*view_scale;}float cantilevered_elevation(vec2 pos,float radius,float stroke_width,float view_scale) {vec2 c1=pos+calc_offset(vec2(-1,-1),radius,stroke_width,view_scale);vec2 c2=pos+calc_offset(vec2(1,-1),radius,stroke_width,view_scale);vec2 c3=pos+calc_offset(vec2(1,1),radius,stroke_width,view_scale);vec2 c4=pos+calc_offset(vec2(-1,1),radius,stroke_width,view_scale);float h1=elevation(c1)+ELEVATION_BIAS;float h2=elevation(c2)+ELEVATION_BIAS;float h3=elevation(c3)+ELEVATION_BIAS;float h4=elevation(c4)+ELEVATION_BIAS;return max(h4,max(h3,max(h1,h2)));}float circle_elevation(vec2 pos) {
#if defined(TERRAIN)
return elevation(pos)+ELEVATION_BIAS;
#else
return 0.0;
#endif
}vec4 project_vertex(vec2 extrusion,vec4 world_center,vec4 projected_center,float radius,float stroke_width, float view_scale,mat3 surface_vectors) {vec2 sample_offset=calc_offset(extrusion,radius,stroke_width,view_scale);
#ifdef PITCH_WITH_MAP
#ifdef PROJECTION_GLOBE_VIEW
return u_matrix*( world_center+vec4(sample_offset.x*surface_vectors[0]+sample_offset.y*surface_vectors[1],0) );
#else
return u_matrix*( world_center+vec4(sample_offset,0,0) );
#endif
#else
return projected_center+vec4(sample_offset,0,0);
#endif
}float get_sample_step() {
#ifdef PITCH_WITH_MAP
return 2.0*PI/float(NUM_SAMPLES_PER_RING);
#else
return PI/float(NUM_SAMPLES_PER_RING);
#endif
}void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);vec4 world_center;mat3 surface_vectors;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(circle_center)*circle_elevation(circle_center);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*circle_elevation(circle_center);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,circle_center,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);world_center=vec4(pos,1);
#else 
surface_vectors=mat3(1.0);float height=circle_elevation(circle_center);world_center=vec4(circle_center,height,1);
#endif
vec4 projected_center=u_matrix*world_center;float view_scale=0.0;
#ifdef PITCH_WITH_MAP
#ifdef SCALE_WITH_MAP
view_scale=1.0;
#else
view_scale=projected_center.w/u_camera_to_center_distance;
#endif
#else
#ifdef SCALE_WITH_MAP
view_scale=u_camera_to_center_distance;
#else
view_scale=projected_center.w;
#endif
#endif
gl_Position=project_vertex(extrude,world_center,projected_center,radius,stroke_width,view_scale,surface_vectors);float visibility=0.0;
#ifdef TERRAIN
float step=get_sample_step();vec4 occlusion_world_center;vec4 occlusion_projected_center;
#ifdef PITCH_WITH_MAP
float cantilevered_height=cantilevered_elevation(circle_center,radius,stroke_width,view_scale);occlusion_world_center=vec4(circle_center,cantilevered_height,1);occlusion_projected_center=u_matrix*occlusion_world_center;
#else
occlusion_world_center=world_center;occlusion_projected_center=projected_center;
#endif
for(int ring=0; ring < NUM_VISIBILITY_RINGS; ring++) {float scale=(float(ring)+1.0)/float(NUM_VISIBILITY_RINGS);for(int i=0; i < NUM_SAMPLES_PER_RING; i++) {vec2 extrusion=vec2(cos(step*float(i)),-sin(step*float(i)))*scale;vec4 frag_pos=project_vertex(extrusion,occlusion_world_center,occlusion_projected_center,radius,stroke_width,view_scale,surface_vectors);visibility+=float(!isOccluded(frag_pos));}}visibility/=float(NUM_VISIBILITY_RINGS)*float(NUM_SAMPLES_PER_RING);
#else
visibility=1.0;
#endif
#ifdef PROJECTION_GLOBE_VIEW
visibility=1.0;
#endif
v_visibility=visibility;lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);
#ifdef FOG
v_fog_pos=fog_position(world_center.xyz);
#endif
}`),clippingMask:gr("void main() {glFragColor=vec4(1.0);}","in vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:gr(`#include "_prelude_fog.fragment.glsl"
uniform highp float u_intensity;in vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);glFragColor=vec4(val,1.0,1.0,1.0);
#ifdef FOG
if (u_is_globe==0) {glFragColor.r*=pow(1.0-fog_opacity(v_fog_pos),2.0);}
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
out vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 tilePos=floor(a_pos*0.5);vec3 pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(tilePos)*elevation(tilePos);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*elevation(tilePos);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,tilePos,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#else
pos=vec3(tilePos+extrude,elevation(tilePos));
#endif
gl_Position=u_matrix*vec4(pos,1);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),heatmapTexture:gr(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;in vec2 v_pos;void main() {float t=texture(u_image,v_pos).r;vec4 color=texture(u_color_ramp,vec2(t,0.5));glFragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(0.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,"in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=vec4(a_pos,0,1);v_pos=a_pos*0.5+0.5;}"),collisionBox:gr("in float v_placed;in float v_notUsed;void main() {vec4 red =vec4(1.0,0.0,0.0,1.0);vec4 blue=vec4(0.0,0.0,1.0,0.5);glFragColor =mix(red,blue,step(0.5,v_placed))*0.5;glFragColor*=mix(1.0,0.1,step(0.5,v_notUsed));}",`#include "_prelude_terrain.vertex.glsl"
in vec3 a_pos;in vec2 a_anchor_pos;in vec2 a_extrude;in vec2 a_placed;in vec2 a_shift;in vec2 a_elevation_from_sea;in float a_size_scale;in vec2 a_padding;in float a_auto_z_offset;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;out float v_placed;out float v_notUsed;void main() {float feature_elevation=a_elevation_from_sea.x+a_auto_z_offset;float terrain_elevation=(a_elevation_from_sea.y==1.0 ? 0.0 : elevation(a_anchor_pos));vec4 projectedPoint=u_matrix*vec4(a_pos+elevationVector(a_anchor_pos)*(feature_elevation+terrain_elevation),1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,1.5);gl_Position=projectedPoint;gl_Position.xy+=(a_extrude*a_size_scale+a_shift+a_padding)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}`),collisionCircle:gr("in float v_radius;in vec2 v_extrude;in float v_perspective_ratio;in float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);glFragColor=color*alpha*opacity_t;}",`in vec2 a_pos_2f;in float a_radius;in vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;out float v_radius;out vec2 v_extrude;out float v_perspective_ratio;out float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos_2f;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(
mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}`),debug:gr("uniform highp vec4 u_color;uniform sampler2D u_overlay;in vec2 v_uv;void main() {vec4 overlay_color=texture(u_overlay,v_uv);glFragColor=mix(u_color,overlay_color,overlay_color.a);}",`#include "_prelude_terrain.vertex.glsl"
in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;
#endif
out vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {float h=elevation(a_pos);v_uv=a_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
gl_Position=u_matrix*vec4(a_pos_3+elevationVector(a_pos)*h,1);
#else
gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,h,1);
#endif
}`),fill:gr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
uniform float u_emissive_strength;
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#endif
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
vec4 out_color=color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
out_color*=opacity;
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,v_z_offset);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#endif
uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp float z_offset
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=z_offset;
#endif
}`),fillOutline:gr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
in highp vec2 v_pos;uniform float u_emissive_strength;
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=outline_color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
uniform mat4 u_matrix;uniform vec2 u_world;out highp vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp float z_offset
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutlinePattern:gr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_emissive_strength;
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
in highp vec2 v_pos;in highp vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);float dist=length(v_pos_world-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
out highp vec2 v_pos;out highp vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
#pragma mapbox: initialize highp float z_offset
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);v_pos_world=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillPattern:gr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;in highp vec2 v_pos;uniform float u_emissive_strength;
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
out highp vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
#pragma mapbox: initialize highp float z_offset
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillExtrusion:gr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
in vec4 v_color;in vec4 v_flat;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;
#endif
uniform lowp float u_opacity;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;in vec2 v_ao;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
in vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
in highp vec3 v_normal;
#endif
uniform vec3 u_flood_light_color;uniform highp float u_vertical_scale;uniform float u_flood_light_intensity;uniform vec3 u_ground_shadow_factor;
#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)
in float v_flood_radius;in float v_has_floodlight;
#endif
in float v_height;
#pragma mapbox: define highp float emissive_strength
void main() {
#pragma mapbox: initialize highp float emissive_strength
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
vec3 normal=normalize(v_normal);
#endif
float z;vec4 color=v_color;
#ifdef ZERO_ROOF_RADIUS
z=float(normal.z > 0.00001);
#ifdef LIGHTING_3D_MODE
normal=mix(normal,vec3(0.0,0.0,1.0),z);
#else
color=mix(v_color,v_roof_color,z);
#endif
#endif
float h=max(0.0,v_height);float ao_shade=1.0;
#ifdef FAUX_AO
float intensity=u_ao[0];float h_floors=h/(u_ao[1]*u_vertical_scale);float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);ao_shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;
#ifdef ZERO_ROOF_RADIUS
concave*=(1.0-z);
#endif
float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);ao_shade*=mix(1.0,x_shade*x_shade*x_shade,concave);
#ifdef LIGHTING_3D_MODE
#ifdef FLOOD_LIGHT
color.rgb*=mix(ao_shade,1.0,v_has_floodlight);
#else
color.rgb*=ao_shade;
#endif
#else
color.rgb*=ao_shade;
#endif
#endif
#ifdef LIGHTING_3D_MODE
float flood_radiance=0.0;
#ifdef FLOOD_LIGHT
flood_radiance=(1.0-min(h/v_flood_radius,1.0))*u_flood_light_intensity*v_has_floodlight;
#endif
#ifdef RENDER_SHADOWS
#ifdef FLOOD_LIGHT
float ndotl_unclamped=dot(normal,u_shadow_direction);float ndotl=max(0.0,ndotl_unclamped);float occlusion=ndotl_unclamped < 0.0 ? 1.0 : shadow_occlusion(ndotl,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);vec3 litColor=apply_lighting(color.rgb,normal,(1.0-u_shadow_intensity*occlusion)*ndotl);vec3 floodLitColor=compute_flood_lighting(u_flood_light_color*u_opacity,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=mix(litColor,floodLitColor,flood_radiance);
#else
float shadowed_lighting_factor;
#ifdef RENDER_CUTOFF
shadowed_lighting_factor=shadowed_light_factor_normal_opacity(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w,v_cutoff_opacity);if (v_cutoff_opacity==0.0) {discard;}
#else
shadowed_lighting_factor=shadowed_light_factor_normal(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);
#endif
color.rgb=apply_lighting(color.rgb,normal,shadowed_lighting_factor);
#endif
#else
color.rgb=apply_lighting(color.rgb,normal);
#ifdef FLOOD_LIGHT
color.rgb=mix(color.rgb,u_flood_light_color*u_opacity,flood_radiance);
#endif
#endif
color.rgb=mix(color.rgb,v_flat.rgb,emissive_strength);color*=u_opacity;
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos,h));
#endif
#ifdef INDICATOR_CUTOUT
color=applyCutout(color,h);
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#include "_prelude_lighting.glsl"
uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_edge_radius;uniform float u_width_scale;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef RENDER_WALL_MODE
in vec3 a_join_normal_inside;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
#ifdef TERRAIN
uniform int u_height_type;uniform int u_base_type;
#endif
uniform highp float u_vertical_scale;out vec4 v_color;out vec4 v_flat;
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
out vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
out highp vec3 v_normal;
#endif
#ifdef FAUX_AO
uniform lowp vec2 u_ao;out vec2 v_ao;
#endif
#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)
out float v_flood_radius;out float v_has_floodlight;
#endif
out float v_height;vec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
#pragma mapbox: define highp float flood_light_wall_radius
#pragma mapbox: define highp float line_width
#pragma mapbox: define highp float emissive_strength
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize highp float flood_light_wall_radius
#pragma mapbox: initialize highp float line_width
#pragma mapbox: initialize highp float emissive_strength
base*=u_vertical_scale;height*=u_vertical_scale;vec4 pos_nx=floor(a_pos_normal_ed*0.5);vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
v_normal=normal;
#endif
base=max(0.0,base);float attr_height=height;height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=0.0;float c_ele=0.0;vec3 pos;
#ifdef TERRAIN
bool is_flat_height=centroid_pos.x !=0.0 && u_height_type==1;bool is_flat_base=centroid_pos.x !=0.0 && u_base_type==1;ele=elevation(pos_nx.xy);c_ele=is_flat_height || is_flat_base ? (centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos)) : ele;float h_height=is_flat_height ? max(c_ele+height,ele+base+2.0) : ele+height;float h_base=is_flat_base ? max(c_ele+base,ele+base) : ele+(base==0.0 ?-5.0 : base);h=t > 0.0 ? max(h_base,h_height) : h_base;pos=vec3(pos_nx.xy,h);
#else
h=t > 0.0 ? height : base;pos=vec3(pos_nx.xy,h);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*h);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,pos.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*pos.z;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
float cutoff=1.0;vec3 scaled_pos=pos;
#ifdef RENDER_CUTOFF
vec3 centroid_random=vec3(centroid_pos.xy,centroid_pos.x+centroid_pos.y+1.0);vec3 ground_pos=centroid_pos.x==0.0 ? pos.xyz : (centroid_random/8.0);vec4 ground=u_matrix*vec4(ground_pos.xy,ele,1.0);cutoff=cutoff_opacity(u_cutoff_params,ground.z);if (centroid_pos.y !=0.0 && centroid_pos.x !=0.0) {vec3 g=floor(ground_pos);vec3 mod_=centroid_random-g*8.0;float seed=min(1.0,0.1*(min(3.5,max(mod_.x+mod_.y,0.2*attr_height))*0.35+mod_.z));if (cutoff < 0.8-seed) {cutoff=0.0;}}float cutoff_scale=cutoff;v_cutoff_opacity=cutoff;scaled_pos.z=mix(c_ele,h,cutoff_scale);
#endif
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (cutoff==0.0 && centroid_pos.x !=0.0) || (color.a==0.0));
#ifdef RENDER_WALL_MODE
vec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);scaled_pos.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;scaled_pos.xy-=a_join_normal_inside.z*wall_offset*0.5;
#endif
gl_Position=mix(u_matrix*vec4(scaled_pos,1),AWAY,hidden);h=h-ele;v_height=h;
#ifdef RENDER_SHADOWS
vec3 shd_pos0=pos;vec3 shd_pos1=pos;
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(normal);shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);
#endif
float NdotL=0.0;float colorvalue=0.0;
#ifndef LIGHTING_3D_MODE
colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),NdotL);if (normal.y !=0.0) {float r=0.84;r=mix(0.7,0.98,1.0-u_lightintensity);NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}
#endif
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec2(mix(concave,-concave,start),y_ground);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
#ifdef FLOOD_LIGHT
float is_wall=1.0-float(t > 0.0 && top_up_ny.y > 0.0);v_has_floodlight=float(flood_light_wall_radius > 0.0 && is_wall > 0.0);v_flood_radius=flood_light_wall_radius*u_vertical_scale;
#endif
v_color=vec4(color.rgb,1.0);float ndotl=calculate_NdotL(normal);v_flat.rgb=sRGBToLinear(color.rgb);v_flat.rgb=v_flat.rgb*(ndotl+(1.0-min(ndotl*57.29,1.0))*emissive_strength);v_flat=vec4(linearTosRGB(v_flat.rgb),1.0);
#else
v_color=vec4(0.0,0.0,0.0,1.0);v_color.rgb+=clamp(color.rgb*NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_color*=u_opacity;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
float roofNdotL=clamp(u_lightpos.z,0.0,1.0);roofNdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),roofNdotL);v_roof_color=vec4(0.0,0.0,0.0,1.0);v_roof_color.rgb+=clamp(color.rgb*roofNdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_roof_color*=u_opacity;
#endif
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),fillExtrusionDepth:gr(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,`#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;uniform float u_edge_radius;uniform float u_width_scale;uniform float u_vertical_scale;
#ifdef TERRAIN
uniform int u_height_type;uniform int u_base_type;
#endif
in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef RENDER_WALL_MODE
in vec3 a_join_normal_inside;
#endif
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp float line_width
#pragma mapbox: define highp vec4 color
out highp float v_depth;void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp float line_width
#pragma mapbox: initialize highp vec4 color
base*=u_vertical_scale;height*=u_vertical_scale;vec3 pos_nx=floor(a_pos_normal_ed.xyz*0.5);mediump vec3 top_up_ny=a_pos_normal_ed.xyz-2.0*pos_nx;base=max(0.0,base);height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
vec3 pos;
#ifdef TERRAIN
bool is_flat_height=centroid_pos.x !=0.0 && u_height_type==1;bool is_flat_base=centroid_pos.x !=0.0 && u_base_type==1;float ele=elevation(pos_nx.xy);float c_ele=is_flat_height || is_flat_base ? (centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos)) : ele;float h_height=is_flat_height ? max(c_ele+height,ele+base+2.0) : ele+height;float h_base=is_flat_base ? max(c_ele+base,ele+base) : ele+(base==0.0 ?-5.0 : base);float h=t > 0.0 ? max(h_base,h_height) : h_base;pos=vec3(pos_nx.xy,h);
#else
pos=vec3(pos_nx.xy,t > 0.0 ? height : base);
#endif
#ifdef RENDER_WALL_MODE
vec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);pos.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;pos.xy-=a_join_normal_inside.z*wall_offset*0.5;
#endif
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (color.a==0.0));gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);v_depth=gl_Position.z/gl_Position.w;}`),fillExtrusionPattern:gr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;in vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
in vec3 v_normal;
#endif
in highp vec2 v_pos;in vec4 v_lighting;uniform lowp float u_opacity;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define mediump vec4 pattern
#pragma mapbox: define highp float pixel_ratio
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize highp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color,normalize(v_normal))*u_opacity;
#else
out_color=out_color*v_lighting;
#endif
#ifdef FAUX_AO
float intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);out_color.rgb=out_color.rgb*shade;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,height);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#include "_prelude_lighting.glsl"
uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform float u_tile_units_to_pixels;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_width_scale;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef RENDER_WALL_MODE
in vec3 a_join_normal_inside;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
#ifdef TERRAIN
uniform int u_height_type;uniform int u_base_type;
#endif
out highp vec2 v_pos;out vec4 v_lighting;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;out vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
out vec3 v_normal;
#endif
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump vec4 pattern
#pragma mapbox: define highp float pixel_ratio
#pragma mapbox: define highp float line_width
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize highp float pixel_ratio
#pragma mapbox: initialize highp float line_width
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec4 pos_nx=floor(a_pos_normal_ed*0.5);mediump vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;mediump vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));float edgedistance=a_pos_normal_ed.w;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;float z=t > 0.0 ? height : base;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=z;vec3 p;float c_ele;
#ifdef TERRAIN
bool is_flat_height=centroid_pos.x !=0.0 && u_height_type==1;bool is_flat_base=centroid_pos.x !=0.0 && u_base_type==1;ele=elevation(pos_nx.xy);c_ele=is_flat_height || is_flat_base ? (centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos)) : ele;float h_height=is_flat_height ? max(c_ele+height,ele+base+2.0) : ele+height;float h_base=is_flat_base ? max(c_ele+base,ele+base) : ele+(base==0.0 ?-5.0 : base);h=t > 0.0 ? max(h_base,h_height) : h_base;p=vec3(pos_nx.xy,h);
#else
p=vec3(pos_nx.xy,z);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(p.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,p.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*p.z;p=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
#ifdef RENDER_WALL_MODE
vec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);p.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;p.xy-=a_join_normal_inside.z*wall_offset*0.5;
#endif
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (color.a==0.0));gl_Position=mix(u_matrix*vec4(p,1),AWAY,hidden);vec2 pos=normal.z==1.0
? pos_nx.xy
: vec2(edgedistance,z*u_height_factor);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float NdotL=0.0;
#ifdef LIGHTING_3D_MODE
NdotL=calculate_NdotL(normal);
#else
NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),NdotL);
#endif
if (normal.y !=0.0) {float r=0.84;
#ifndef LIGHTING_3D_MODE
r=mix(0.7,0.98,1.0-u_lightintensity);
#endif
NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
v_normal=normal;
#else
v_lighting.rgb+=clamp(NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;
#endif 
#ifdef FOG
v_fog_pos=fog_position(p);
#endif
}`),groundShadow:gr(`#include "_prelude_shadow.fragment.glsl"
precision highp float;uniform vec3 u_ground_shadow_factor;in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;
#ifdef FOG
in float v_fog_opacity;
#endif
void main() {float light=shadowed_light_factor_plane_bias(v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);vec3 shadow=mix(u_ground_shadow_factor,vec3(1.0),light);
#ifdef RENDER_CUTOFF
shadow=mix(vec3(1.0),shadow,cutoff_opacity(u_cutoff_params,1.0/gl_FragCoord.w));
#endif
#ifdef FOG
shadow=mix(shadow,vec3(1.0),v_fog_opacity);
#endif
#ifdef INDICATOR_CUTOUT
shadow=mix(shadow,vec3(1.0),1.0-applyCutout(vec4(1.0),0.0).r);
#endif
glFragColor=vec4(shadow,1.0);}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;in vec2 a_pos;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;
#ifdef FOG
out float v_fog_opacity;
#endif
void main() {gl_Position=u_matrix*vec4(a_pos,0.0,1.0);v_pos_light_view_0=u_light_matrix_0*vec4(a_pos,0.0,1.0);v_pos_light_view_1=u_light_matrix_1*vec4(a_pos,0.0,1.0);
#ifdef FOG
v_fog_pos=fog_position(a_pos);v_fog_opacity=fog(v_fog_pos);
#endif
}`),fillExtrusionGroundEffect:gr(`uniform highp float u_ao_pass;uniform highp float u_opacity;uniform highp float u_flood_light_intensity;uniform highp vec3 u_flood_light_color;uniform highp float u_attenuation;uniform sampler2D u_fb;uniform float u_fb_size;
#ifdef SDF_SUBPASS
in highp vec2 v_pos;in highp vec4 v_line_segment;in highp float v_flood_light_radius_tile;in highp vec2 v_ao;float line_df(highp vec2 a,highp vec2 b,highp vec2 p) {highp vec2 ba=b-a;highp vec2 pa=p-a;highp float r=clamp(dot(pa,ba)/dot(ba,ba),0.0,1.0);return length(pa-r*ba);}
#ifdef FOG
in highp float v_fog;
#endif
#endif
void main() {
#ifdef CLEAR_SUBPASS
vec4 color=vec4(1.0);
#ifdef CLEAR_FROM_TEXTURE
color=texture(u_fb,gl_FragCoord.xy/vec2(u_fb_size));
#endif
glFragColor=color;
#else
#ifdef SDF_SUBPASS
highp float d=line_df(v_line_segment.xy,v_line_segment.zw,v_pos);highp float effect_radius=mix(v_flood_light_radius_tile,v_ao.y,u_ao_pass);d/=effect_radius;d=min(d,1.0);d=1.0-pow(1.0-d,u_attenuation);highp float effect_intensity=mix(u_flood_light_intensity,v_ao.x,u_ao_pass);highp float fog=1.0;
#ifdef FOG
fog=v_fog;
#endif
#ifdef RENDER_CUTOFF
fog*=v_cutoff_opacity;
#endif
glFragColor=vec4(vec3(0.0),mix(1.0,d,effect_intensity*u_opacity*fog));
#else
vec4 color=mix(vec4(u_flood_light_color,1.0),vec4(vec3(0.0),1.0),u_ao_pass);
#ifdef OVERDRAW_INSPECTOR
color=vec4(1.0);
#endif
glFragColor=color;
#endif
HANDLE_WIREFRAME_DEBUG;
#endif
}`,`#include "_prelude_fog.vertex.glsl"
in highp vec4 a_pos_end;in highp float a_angular_offset_factor;in highp float a_hidden_by_landmark;
#ifdef SDF_SUBPASS
out highp vec2 v_pos;out highp vec4 v_line_segment;out highp float v_flood_light_radius_tile;out highp vec2 v_ao;
#ifdef FOG
out highp float v_fog;
#endif
#endif
uniform highp float u_flood_light_intensity;uniform highp mat4 u_matrix;uniform highp float u_ao_pass;uniform highp float u_meter_to_tile;uniform highp float u_edge_radius;uniform highp float u_dynamic_offset;uniform highp vec2 u_ao;
#pragma mapbox: define highp float flood_light_ground_radius
const float TANGENT_CUTOFF=4.0;const float NORM=32767.0;void main() {
#pragma mapbox: initialize highp float flood_light_ground_radius
vec2 p=a_pos_end.xy;vec2 q=floor(a_pos_end.zw*0.5);vec2 start_bottom=a_pos_end.zw-q*2.0;float fl_ground_radius=flood_light_ground_radius;fl_ground_radius=abs(flood_light_ground_radius);float direction=flood_light_ground_radius < 0.0 ?-1.0 : 1.0;float flood_radius_tile=fl_ground_radius*u_meter_to_tile;vec2 v=normalize(q-p);float ao_radius=u_ao.y/3.5;float effect_radius=mix(flood_radius_tile,ao_radius,u_ao_pass)+u_edge_radius;float angular_offset_factor=a_angular_offset_factor/NORM*TANGENT_CUTOFF;float angular_offset=direction*angular_offset_factor*effect_radius;float top=1.0-start_bottom.y;float side=(0.5-start_bottom.x)*2.0;vec2 extrusion_parallel=v*side*mix(u_dynamic_offset,angular_offset,top);vec2 perp=vec2(v.y,-v.x);vec2 extrusion_perp=direction*perp*effect_radius*top;vec3 pos=vec3(mix(q,p,start_bottom.x),0.0);pos.xy+=extrusion_parallel+extrusion_perp;
#ifdef SDF_SUBPASS
v_pos=pos.xy;v_line_segment=vec4(p,q)+perp.xyxy*u_edge_radius;v_flood_light_radius_tile=flood_radius_tile;v_ao=vec2(u_ao.x,ao_radius);
#ifdef FOG
v_fog_pos=fog_position(pos);v_fog=1.0-fog(v_fog_pos);
#endif
#endif
float hidden_by_landmark=0.0;
#ifdef HAS_CENTROID
hidden_by_landmark=a_hidden_by_landmark;
#endif
float isFloodlit=float(fl_ground_radius > 0.0 && u_flood_light_intensity > 0.0);float hidden=mix(1.0-isFloodlit,isFloodlit,u_ao_pass);hidden+=hidden_by_landmark;gl_Position=mix(u_matrix*vec4(pos,1.0),AWAY,float(hidden > 0.0));
#ifdef RENDER_CUTOFF
v_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);
#endif
}`),hillshadePrepare:gr(`precision highp float;uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;float getElevation(vec2 coord) {return texture(u_image,coord).r/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y));float b=getElevation(v_pos+vec2(0,-epsilon.y));float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y));float d=getElevation(v_pos+vec2(-epsilon.x,0));float e=getElevation(v_pos+vec2(epsilon.x,0));float f=getElevation(v_pos+vec2(-epsilon.x,epsilon.y));float g=getElevation(v_pos+vec2(0,epsilon.y));float h=getElevation(v_pos+vec2(epsilon.x,epsilon.y));float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2(
(c+e+e+h)-(a+d+d+f),(f+g+g+h)-(a+b+b+c)
)/pow(2.0,exaggeration+(19.2562-u_zoom));glFragColor=clamp(vec4(
deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:gr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;uniform float u_emissive_strength;void main() {vec4 pixel=texture(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);glFragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef LIGHTING_3D_MODE
glFragColor=apply_lighting_with_emission_ground(glFragColor,u_emissive_strength);
#endif
#ifdef FOG
glFragColor=fog_dither(fog_apply_premultiplied(glFragColor,v_fog_pos));
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),line:gr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform lowp float u_device_pixel_ratio;uniform highp float u_width_scale;uniform highp float u_floor_width_scale;uniform float u_alpha_discard_threshold;uniform highp vec2 u_trim_offset;uniform highp vec2 u_trim_fade_range;uniform lowp vec4 u_trim_color;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;in highp vec4 v_uv;
#ifdef ELEVATED_ROADS
in highp float v_road_z_offset;
#endif
#ifdef RENDER_LINE_DASH
uniform sampler2D u_dash_image;in vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform sampler2D u_gradient_image;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
float luminance(vec3 c) {return (c.r+c.r+c.b+c.g+c.g+c.g)*0.1667;}uniform float u_emissive_strength;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float border_width
#pragma mapbox: define lowp vec4 border_color
float linearstep(float edge0,float edge1,float x) {return  clamp((x-edge0)/(edge1-edge0),0.0,1.0);}void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float border_width
#pragma mapbox: initialize lowp vec4 border_color
float dist=length(v_normal)*v_width2.s;float blur2=(u_width_scale*blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);
#ifdef RENDER_LINE_DASH
float sdfdist=texture(u_dash_image,v_tex).r;float sdfgamma=1.0/(2.0*u_device_pixel_ratio)/dash.z;float scaled_floorwidth=(floorwidth*u_floor_width_scale);alpha*=linearstep(0.5-sdfgamma/scaled_floorwidth,0.5+sdfgamma/scaled_floorwidth,sdfdist);
#endif
highp vec4 out_color;
#ifdef RENDER_LINE_GRADIENT
out_color=texture(u_gradient_image,v_uv.xy);
#else
out_color=color;
#endif
float trim_alpha=1.0;
#ifdef RENDER_LINE_TRIM_OFFSET
highp float start=v_uv[2];highp float end=v_uv[3];highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=(start+(v_uv.x)*(end-start));if (trim_end > trim_start) {highp float start_transition=max(0.0,min(1.0,(line_progress-trim_start)/max(u_trim_fade_range[0],1.0e-9)));highp float end_transition=max(0.0,min(1.0,(trim_end-line_progress)/max(u_trim_fade_range[1],1.0e-9)));highp float transition_factor=min(start_transition,end_transition);out_color=mix(out_color,u_trim_color,transition_factor);trim_alpha=1.0-transition_factor;}
#endif
if (u_alpha_discard_threshold !=0.0) {if (alpha < u_alpha_discard_threshold) {discard;}}
#ifdef RENDER_LINE_BORDER
float edgeBlur=((border_width*u_width_scale)+1.0/u_device_pixel_ratio);float alpha2=clamp(min(dist-(v_width2.t-edgeBlur),v_width2.s-dist)/edgeBlur,0.0,1.0);if (alpha2 < 1.) {float smoothAlpha=smoothstep(0.6,1.0,alpha2);if (border_color.a==0.0) {float Y=(out_color.a > 0.01) ? luminance(out_color.rgb/out_color.a) : 1.;float adjustment=(Y > 0.) ? 0.5/Y : 0.45;if (out_color.a > 0.25 && Y < 0.25) {vec3 borderColor=(Y > 0.) ? out_color.rgb : vec3(1,1,1)*out_color.a;out_color.rgb=out_color.rgb+borderColor*(adjustment*(1.0-smoothAlpha));} else {out_color.rgb*=(0.6 +0.4*smoothAlpha);}} else {out_color=mix(border_color*trim_alpha,out_color,smoothAlpha);}}
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);
#ifdef ELEVATED_ROADS
out_color.rgb*=mix(v_road_z_offset > 0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);
#else
out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
out_color*=(alpha*opacity);
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,v_z_offset);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define EXTRUDE_SCALE 0.015873016
in vec2 a_pos_normal;in vec4 a_data;
#if defined(ELEVATED) || defined(ELEVATED_ROADS) || defined(VARIABLE_LINE_WIDTH)
in vec2 a_z_offset_width;
#endif
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
in highp vec4 a_packed;
#endif
#ifdef RENDER_LINE_DASH
in float a_linesofar;
#endif
uniform mat4 u_matrix;uniform mat2 u_pixels_to_tile_units;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;uniform float u_width_scale;uniform highp float u_floor_width_scale;
#ifdef ELEVATED
uniform lowp float u_zbias_factor;uniform lowp float u_tile_to_meter;float sample_elevation(vec2 apos) {
#ifdef ELEVATION_REFERENCE_SEA
return 0.0;
#else
return elevation(apos);
#endif
}
#endif
out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp vec4 v_uv;
#ifdef ELEVATED_ROADS
out highp float v_road_z_offset;
#endif
#ifdef RENDER_LINE_DASH
uniform vec2 u_texsize;uniform float u_tile_units_to_pixels;out vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform float u_image_height;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float border_width
#pragma mapbox: define lowp vec4 border_color
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float border_width
#pragma mapbox: initialize lowp vec4 border_color
float a_z_offset;
#if defined(ELEVATED) || defined(ELEVATED_ROADS)
a_z_offset=a_z_offset_width.x;
#endif
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth;
#ifdef VARIABLE_LINE_WIDTH
halfwidth=(u_width_scale*a_z_offset_width.y)/2.0;
#else
halfwidth=(u_width_scale*width)/2.0;
#endif
offset=-1.0*offset*u_width_scale;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*EXTRUDE_SCALE;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*EXTRUDE_SCALE*normal.y*mat2(t,-u,u,t);float hidden=float(opacity==0.0);vec2 extrude=dist*u_pixels_to_tile_units;vec4 projected_extrude=u_matrix*vec4(extrude,0.0,0.0);vec2 projected_extrude_xy=projected_extrude.xy;
#ifdef ELEVATED_ROADS
v_road_z_offset=a_z_offset;gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,a_z_offset+0.01*step(0.01,a_z_offset),1.0)+projected_extrude;
#else
#ifdef ELEVATED
vec2 offsetTile=offset2*u_pixels_to_tile_units;vec2 offset_pos=pos+offsetTile;float ele=0.0;
#ifdef CROSS_SLOPE_VERTICAL
float top=a_pos_normal.y-2.0*floor(a_pos_normal.y*0.5);float line_height=2.0*u_tile_to_meter*outset*top*u_pixels_to_tile_units[1][1]+a_z_offset;ele=sample_elevation(offset_pos)+line_height;projected_extrude=vec4(0);
#else
#ifdef CROSS_SLOPE_HORIZONTAL
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,max(ele1,ele2));ele=ele_max+a_z_offset;
#else
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,0.5*(ele1+ele2));ele=ele_max-ele0+ele1+a_z_offset;
#endif
#endif
gl_Position=u_matrix*vec4(offset_pos,ele,1.0)+projected_extrude;float z=clamp(gl_Position.z/gl_Position.w,0.5,1.0);float zbias=max(0.00005,(pow(z,0.8)-z)*u_zbias_factor*u_exaggeration);gl_Position.z-=(gl_Position.w*zbias);gl_Position=mix(gl_Position,AWAY,hidden);
#else
gl_Position=mix(u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude,AWAY,hidden);
#endif
#endif
#ifdef ELEVATED_ROADS
#ifdef RENDER_SHADOWS
vec3 shd_pos=vec3(pos+(offset2+dist)*u_pixels_to_tile_units,a_z_offset);vec3 shd_pos0=shd_pos;vec3 shd_pos1=shd_pos;
#ifdef NORMAL_OFFSET
vec3 shd_pos_offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=shd_pos_offset*shadow_normal_offset_multiplier0();shd_pos1+=shd_pos_offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#endif
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude_xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=mix(extrude_length_without_perspective/extrude_length_with_perspective,1.0,step(0.01,blur));
#else
v_gamma_scale=1.0;
#endif
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
float a_uv_x=a_packed[0];float a_split_index=a_packed[1];highp float a_clip_start=a_packed[2];highp float a_clip_end=a_packed[3];
#ifdef RENDER_LINE_GRADIENT
highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec4(a_uv_x,a_split_index*texel_height-half_texel_height,a_clip_start,a_clip_end);
#else
v_uv=vec4(a_uv_x,0.0,a_clip_start,a_clip_end);
#endif
#endif
#ifdef RENDER_LINE_DASH
float scale=dash.z==0.0 ? 0.0 : u_tile_units_to_pixels/dash.z;float height=dash.y;v_tex=vec2(a_linesofar*scale/(floorwidth*u_floor_width_scale),(-normal.y*height+dash.x+0.5)/u_texsize.y);
#endif
v_width2=vec2(outset,inset);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=a_z_offset;
#endif
}`),linePattern:gr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform highp float u_device_pixel_ratio;uniform highp float u_width_scale;uniform highp float u_alpha_discard_threshold;uniform highp vec2 u_texsize;uniform highp float u_tile_units_to_pixels;uniform highp vec2 u_trim_offset;uniform highp vec2 u_trim_fade_range;uniform lowp vec4 u_trim_color;uniform sampler2D u_image;in vec2 v_normal;in vec2 v_width2;in highp float v_linesofar;in float v_gamma_scale;in float v_width;
#ifdef RENDER_LINE_TRIM_OFFSET
in highp vec4 v_uv;
#endif
#ifdef ELEVATED_ROADS
in highp float v_road_z_offset;
#endif
#ifdef LINE_JOIN_NONE
in vec2 v_pattern_data;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
uniform float u_emissive_strength;
#pragma mapbox: define mediump vec4 pattern
#pragma mapbox: define mediump float pixel_ratio
#pragma mapbox: define mediump float blur
#pragma mapbox: define mediump float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize mediump float pixel_ratio
#pragma mapbox: initialize mediump float blur
#pragma mapbox: initialize mediump float opacity
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;highp float pattern_size=display_size.x/u_tile_units_to_pixels;float aspect=display_size.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(u_width_scale*blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);highp float pattern_x=v_linesofar/pattern_size*aspect;highp float x=mod(pattern_x,1.0);highp float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;highp vec2 pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(x,y));highp vec2 lod_pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(pattern_x,y));vec4 color=textureLodCustom(u_image,pos,lod_pos);
#ifdef RENDER_LINE_TRIM_OFFSET
highp float start=v_uv[2];highp float end=v_uv[3];highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=(start+(v_uv.x)*(end-start));if (trim_end > trim_start) {highp float start_transition=max(0.0,min(1.0,(line_progress-trim_start)/max(u_trim_fade_range[0],1.0e-9)));highp float end_transition=max(0.0,min(1.0,(trim_end-line_progress)/max(u_trim_fade_range[1],1.0e-9)));highp float transition_factor=min(start_transition,end_transition);color=mix(color,color.a*u_trim_color,transition_factor);}
#endif
#ifdef LINE_JOIN_NONE
highp float pattern_len=pattern_size/aspect;highp float segment_phase=pattern_len-mod(v_linesofar-v_pattern_data.x+pattern_len,pattern_len);highp float visible_start=segment_phase-step(pattern_len*0.5,segment_phase)*pattern_len;highp float visible_end=floor((v_pattern_data.y-segment_phase)/pattern_len)*pattern_len+segment_phase;visible_end+=step(pattern_len*0.5,v_pattern_data.y-visible_end)*pattern_len;if (v_pattern_data.x < visible_start || v_pattern_data.x >=visible_end) {color=vec4(0.0);}
#endif
#ifdef LIGHTING_3D_MODE
color=apply_lighting_with_emission_ground(color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);
#ifdef ELEVATED_ROADS
color.rgb*=mix(v_road_z_offset > 0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);
#else
color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
color*=(alpha*opacity);if (u_alpha_discard_threshold !=0.0) {if (color.a < u_alpha_discard_threshold) {discard;}}
#ifdef INDICATOR_CUTOUT
color=applyCutout(color,v_z_offset);
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define scale 0.015873016
in vec2 a_pos_normal;in vec4 a_data;
#if defined(ELEVATED) || defined(ELEVATED_ROADS)
in vec2 a_z_offset_width;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
in highp vec4 a_packed;
#endif
in highp float a_linesofar;
#ifdef LINE_JOIN_NONE
in highp vec3 a_pattern_data;out vec2 v_pattern_data;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#endif
uniform mat4 u_matrix;uniform float u_tile_units_to_pixels;uniform vec2 u_units_to_pixels;uniform mat2 u_pixels_to_tile_units;uniform float u_device_pixel_ratio;uniform float u_width_scale;uniform float u_floor_width_scale;
#ifdef ELEVATED
uniform lowp float u_zbias_factor;uniform lowp float u_tile_to_meter;float sample_elevation(vec2 apos) {
#ifdef ELEVATION_REFERENCE_SEA
return 0.0;
#else
return elevation(apos);
#endif
}
#endif
out vec2 v_normal;out vec2 v_width2;out highp float v_linesofar;out float v_gamma_scale;out float v_width;
#ifdef RENDER_LINE_TRIM_OFFSET
out highp vec4 v_uv;
#endif
#ifdef ELEVATED_ROADS
out highp float v_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#pragma mapbox: define mediump float blur
#pragma mapbox: define mediump float opacity
#pragma mapbox: define mediump float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define mediump float floorwidth
#pragma mapbox: define mediump vec4 pattern
#pragma mapbox: define mediump float pixel_ratio
void main() {
#pragma mapbox: initialize mediump float blur
#pragma mapbox: initialize mediump float opacity
#pragma mapbox: initialize mediump float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize mediump float floorwidth
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize mediump float pixel_ratio
float a_z_offset;
#if defined(ELEVATED) || defined(ELEVATED_ROADS)
a_z_offset=a_z_offset_width.x;
#endif
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=(u_width_scale*width)/2.0;offset=-1.0*offset*u_width_scale;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);vec2 dist=outset*a_extrude*scale;float u=0.5*a_direction;float t=1.0-abs(u);vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float hidden=float(opacity==0.0);vec2 extrude=dist*u_pixels_to_tile_units;vec4 projected_extrude=u_matrix*vec4(extrude,0.0,0.0);vec2 projected_extrude_xy=projected_extrude.xy;
#ifdef ELEVATED_ROADS
v_road_z_offset=a_z_offset;gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,a_z_offset+0.01*step(0.01,a_z_offset),1.0)+projected_extrude;
#else
#ifdef ELEVATED
vec2 offsetTile=offset2*u_pixels_to_tile_units;vec2 offset_pos=pos+offsetTile;float ele=0.0;
#ifdef CROSS_SLOPE_VERTICAL
float top=a_pos_normal.y-2.0*floor(a_pos_normal.y*0.5);float line_height=2.0*u_tile_to_meter*outset*top*u_pixels_to_tile_units[1][1]+a_z_offset;ele=sample_elevation(offset_pos)+line_height;projected_extrude=vec4(0);
#else
#ifdef CROSS_SLOPE_HORIZONTAL
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,max(ele1,ele2));ele=ele_max+a_z_offset;
#else
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,0.5*(ele1+ele2));ele=ele_max-ele0+ele1+a_z_offset;
#endif
#endif
gl_Position=u_matrix*vec4(offset_pos,ele,1.0)+projected_extrude;float z=clamp(gl_Position.z/gl_Position.w,0.5,1.0);float zbias=max(0.00005,(pow(z,0.8)-z)*u_zbias_factor*u_exaggeration);gl_Position.z-=(gl_Position.w*zbias);gl_Position=mix(gl_Position,AWAY,hidden);
#else
gl_Position=mix(u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude,AWAY,hidden);
#endif
#endif
#ifdef ELEVATED_ROADS
#ifdef RENDER_SHADOWS
vec3 shd_pos=vec3(pos+(offset2+dist)*u_pixels_to_tile_units,a_z_offset);vec3 shd_pos0=shd_pos;vec3 shd_pos1=shd_pos;
#ifdef NORMAL_OFFSET
vec3 shd_pos_offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=shd_pos_offset*shadow_normal_offset_multiplier0();shd_pos1+=shd_pos_offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#endif
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude_xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=mix(extrude_length_without_perspective/extrude_length_with_perspective,1.0,step(0.01,blur));
#else
v_gamma_scale=1.0;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
float a_uv_x=a_packed[0];highp float a_clip_start=a_packed[2];highp float a_clip_end=a_packed[3];v_uv=vec4(a_uv_x,0.0,a_clip_start,a_clip_end);
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=(floorwidth*u_floor_width_scale);
#ifdef LINE_JOIN_NONE
v_width=(floorwidth*u_floor_width_scale)+ANTIALIASING;mediump float pixels_to_tile_units=1.0/u_tile_units_to_pixels;mediump float pixel_ratio_inverse=1.0/pixel_ratio;mediump float aspect=v_width/((pattern.w-pattern.y)*pixel_ratio_inverse);highp float subt_multiple=(pattern.z-pattern.x)*pixel_ratio_inverse*pixels_to_tile_units*aspect*32.0;highp float subt=floor(a_pattern_data.z/subt_multiple)*subt_multiple;float offset_sign=(fract(a_pattern_data.x)-0.5)*4.0;float line_progress_offset=offset_sign*v_width*0.5*pixels_to_tile_units;v_linesofar=(a_pattern_data.z-subt)+a_linesofar+line_progress_offset;v_pattern_data=vec2(a_pattern_data.x+line_progress_offset,a_pattern_data.y);
#endif
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=a_z_offset;
#endif
}`),raster:gr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_raster_array.glsl"
uniform float u_fade_t;uniform float u_opacity;uniform highp float u_raster_elevation;uniform highp float u_zoom_transition;in vec2 v_pos0;in vec2 v_pos1;in float v_depth;
#ifdef PROJECTION_GLOBE_VIEW
in float v_split_fade;
#endif
uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;uniform float u_emissive_strength;
#ifndef RASTER_ARRAY
uniform highp sampler2D u_image0;uniform sampler2D u_image1;
#endif
#ifdef RASTER_COLOR
uniform sampler2D u_color_ramp;uniform highp vec4 u_colorization_mix;uniform highp float u_colorization_offset;uniform vec2 u_texture_res;
#endif
void main() {vec4 color0,color1,color;vec2 value;
#ifdef RASTER_COLOR
#ifdef RASTER_ARRAY
#ifdef RASTER_ARRAY_LINEAR
value=mix(
raTexture2D_image0_linear(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_linear(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t
);
#else
value=mix(
raTexture2D_image0_nearest(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_nearest(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t
);
#endif
if (value.y > 0.0) value.x/=value.y;
#else
color=mix(texture(u_image0,v_pos0),texture(u_image1,v_pos1),u_fade_t);value=vec2(u_colorization_offset+dot(color.rgb,u_colorization_mix.rgb),color.a);
#endif
color=texture(u_color_ramp,vec2(value.x,0.5));if (color.a > 0.0) color.rgb/=color.a;color.a*=value.y;
#else
color0=texture(u_image0,v_pos0);color1=texture(u_image1,v_pos1);if (color0.a > 0.0) color0.rgb/=color0.a;if (color1.a > 0.0) color1.rgb/=color1.a;color=mix(color0,color1,u_fade_t);
#endif
color.a*=u_opacity;
#ifdef GLOBE_POLES
color.a*=1.0-smoothstep(0.0,0.05,u_zoom_transition);
#endif
vec3 rgb=color.rgb;rgb=vec3(
dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);vec3 out_color=mix(u_high_vec,u_low_vec,rgb);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(vec4(out_color,1.0),u_emissive_strength).rgb;
#endif
#ifdef FOG
highp float fog_limit_high_meters=1000000.0;highp float fog_limit_low_meters=600000.0;float fog_limit=1.0-smoothstep(fog_limit_low_meters,fog_limit_high_meters,u_raster_elevation);out_color=fog_dither(fog_apply(out_color,v_fog_pos,fog_limit));
#endif
glFragColor=vec4(out_color*color.a,color.a);
#ifdef PROJECTION_GLOBE_VIEW
glFragColor*=mix(1.0,1.0-smoothstep(0.0,0.05,u_zoom_transition),smoothstep(0.8,0.9,v_split_fade));
#endif
#ifdef RENDER_CUTOFF
glFragColor=glFragColor*cutoff_opacity(u_cutoff_params,v_depth);
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat3 u_grid_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform vec2 u_perspective_transform;uniform vec2 u_texture_offset;uniform float u_raster_elevation;uniform float u_zoom_transition;uniform vec2 u_merc_center;
#define GLOBE_UPSCALE GLOBE_RADIUS/6371008.8
#ifdef GLOBE_POLES
in vec3 a_globe_pos;in vec2 a_uv;
#else
in vec2 a_pos;in vec2 a_texture_pos;
#endif
out vec2 v_pos0;out vec2 v_pos1;out float v_depth;
#ifdef PROJECTION_GLOBE_VIEW
out float v_split_fade;
#endif
void main() {vec2 uv;
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;gl_Position=u_matrix*u_globe_matrix*vec4(globe_pos   ,1.0);uv=a_uv;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(a_globe_pos,1.0)).xyz);
#endif
#else
float w=1.0+dot(a_texture_pos,u_perspective_transform);uv=a_texture_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);vec3 globe_pos=latLngToECEF(latLng.xy);globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);float mercatorY=mercatorYfromLat(latLng[0]);float mercatorX=mercatorXfromLng(latLng[1]);    
v_split_fade=0.0;if (u_zoom_transition > 0.0) {vec2 merc_pos=vec2(mercatorX,mercatorY);merc_world_pos=vec4(merc_pos,u_raster_elevation,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;float opposite_merc_center=mod(u_merc_center.x+0.5,1.0);float dist_from_poles=(abs(mercatorY-0.5)*2.0);float range=0.1;v_split_fade=abs(opposite_merc_center-mercatorX);v_split_fade=clamp(1.0-v_split_fade,0.0,1.0);v_split_fade=max(smoothstep(1.0-range,1.0,dist_from_poles),max(smoothstep(1.0-range,1.0,v_split_fade),smoothstep(1.0-range,1.0,1.0-v_split_fade)));}float tiles=u_grid_matrix[0][2];if (tiles > 0.0) {float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];float uvY=mercatorY*tiles-idy;float uvX=mercatorX*tiles-idx;uv=vec2(uvX,uvY);}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition)*w,w);gl_Position=u_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
#else
gl_Position=u_matrix*vec4(a_pos*w,u_raster_elevation*w,w);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#endif
#endif
v_pos0=uv;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;v_pos0=u_texture_offset.x+u_texture_offset.y*v_pos0;v_pos1=u_texture_offset.x+u_texture_offset.y*v_pos1;
#ifdef RENDER_CUTOFF
v_depth=gl_Position.z;
#endif
}`),rasterParticle:gr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform float u_fade_t;uniform float u_opacity;uniform highp float u_raster_elevation;in vec2 v_pos0;in vec2 v_pos1;uniform sampler2D u_image0;uniform sampler2D u_image1;void main() {vec4 color0,color1,color;color0=texture(u_image0,v_pos0);color1=texture(u_image1,v_pos1);if (color0.a > 0.0) color0.rgb/=color0.a;if (color1.a > 0.0) color1.rgb/=color1.a;color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 out_color=color.rgb;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(vec4(out_color,1.0),0.0).rgb;
#endif
#ifdef FOG
highp float fog_limit_high_meters=1000000.0;highp float fog_limit_low_meters=600000.0;float fog_limit=1.0-smoothstep(fog_limit_low_meters,fog_limit_high_meters,u_raster_elevation);out_color=fog_dither(fog_apply(out_color,v_fog_pos,fog_limit));
#endif
glFragColor=vec4(out_color*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat3 u_grid_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_raster_elevation;uniform float u_zoom_transition;uniform vec2 u_merc_center;
#define GLOBE_UPSCALE GLOBE_RADIUS/6371008.8
in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos0;out vec2 v_pos1;void main() {float w=1.0;vec2 uv;
#ifdef PROJECTION_GLOBE_VIEW
vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float mercatorX=mercatorXfromLng(latLng[1]);float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];float uvX=mercatorX*tiles-idx;float uvY=mercatorY*tiles-idy;uv=vec2(uvX,uvY);vec3 globe_pos=latLngToECEF(latLng.xy);globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {vec2 merc_pos=vec2(mercatorX,mercatorY);merc_world_pos=vec4(merc_pos,u_raster_elevation,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition)*w,w);gl_Position=u_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
#else
uv=a_texture_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*w,u_raster_elevation*w,w);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#endif
v_pos0=uv;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}`),rasterParticleDraw:gr("uniform sampler2D u_color_ramp;in float v_particle_speed;void main() {glFragColor=texture(u_color_ramp,vec2(v_particle_speed,0.5));}",`#include "_prelude_raster_particle.glsl"
in float a_index;uniform sampler2D u_particle_texture;uniform float u_particle_texture_side_len;uniform vec2 u_tile_offset;out float v_particle_speed;void main() {ivec2 pixel_coord=ivec2(
mod(a_index,u_particle_texture_side_len),a_index/u_particle_texture_side_len);vec4 pixel=texelFetch(u_particle_texture,pixel_coord,0);vec2 pos=unpack_pos_from_rgba(pixel)+u_tile_offset;vec2 tex_coord=fract(pos);vec2 velocity=lookup_velocity(tex_coord);if (velocity==INVALID_VELOCITY) {gl_Position=AWAY;v_particle_speed=0.0;} else {gl_Position=vec4(2.0*pos-1.0,0,1);v_particle_speed=length(velocity);}gl_PointSize=1.0;}`),rasterParticleTexture:gr("uniform sampler2D u_texture;uniform float u_opacity;in vec2 v_tex_pos;void main() {vec4 color=texture(u_texture,v_tex_pos);glFragColor=vec4(floor(255.0*color*u_opacity)/255.0);}","in vec2 a_pos;out vec2 v_tex_pos;void main() {vec2 uv=0.5*a_pos+vec2(0.5);v_tex_pos=uv;gl_Position=vec4(a_pos,0.0,1.0);}"),rasterParticleUpdate:gr(`#include "_prelude_raster_particle.glsl"
uniform sampler2D u_particle_texture;uniform mediump float u_particle_texture_side_len;uniform mediump float u_speed_factor;uniform highp float u_reset_rate;uniform highp float u_rand_seed;in highp vec2 v_tex_coord;vec2 linearstep(vec2 edge0,vec2 edge1,vec2 x) {return  clamp((x-edge0)/(edge1-edge0),vec2(0),vec2(1));}const highp vec3 rand_constants=vec3(12.9898,78.233,4375.85453);highp float rand(const highp vec2 co) {highp float t=dot(rand_constants.xy,co);return fract(sin(t)*(rand_constants.z+t));}void main() {ivec2 pixel_coord=ivec2(v_tex_coord*u_particle_texture_side_len);highp vec4 pixel=texelFetch(u_particle_texture,pixel_coord,0);highp vec2 pos=unpack_pos_from_rgba(pixel);highp vec2 velocity=lookup_velocity(clamp(pos,0.0,1.0));highp vec2 dp=velocity==INVALID_VELOCITY ? vec2(0) : velocity*u_speed_factor;pos=pos+dp;highp vec2 seed=(pos+v_tex_coord)*u_rand_seed;highp vec2 random_pos=vec2(rand(seed+1.3),rand(seed+2.1));highp vec2 persist_rate=pow(
linearstep(vec2(-u_particle_pos_offset),vec2(0),pos)*linearstep(vec2(1.0+u_particle_pos_offset),vec2(1),pos),vec2(4)
);highp vec2 per_frame_persist=pow(persist_rate,abs(dp)/u_particle_pos_offset);highp float drop_rate=1.0-per_frame_persist.x*per_frame_persist.y;drop_rate=any(greaterThanEqual(abs(pos-0.5),vec2(0.5+u_particle_pos_offset))) ? 1.0 : drop_rate;highp float drop=step(1.0-drop_rate-u_reset_rate,rand(seed));highp vec2 next_pos=mix(pos,random_pos,drop);glFragColor=pack_pos_to_rgba(next_pos);}`,"in vec2 a_pos;out vec2 v_tex_coord;void main() {v_tex_coord=0.5*(a_pos+vec2(1.0));gl_Position=vec4(a_pos,0.0,1.0);}"),symbol:gr(`#include "_prelude_lighting.glsl"
#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;uniform bool u_is_halo;uniform lowp float u_scale_factor;
#ifdef ICON_TRANSITION
uniform float u_icon_transition;
#endif
#ifdef COLOR_ADJUSTMENT
uniform mat4 u_color_adj_mat;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#endif
in vec2 v_tex_a;
#ifdef ICON_TRANSITION
in vec2 v_tex_b;
#endif
in float v_draw_halo;in vec3 v_gamma_scale_size_fade_opacity;
#ifdef RENDER_TEXT_AND_SYMBOL
in float is_sdf;in vec2 v_tex_a_icon;
#endif
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
vec4 out_color;float fade_opacity=v_gamma_scale_size_fade_opacity[2];
#ifdef RENDER_TEXT_AND_SYMBOL
if (is_sdf==ICON) {vec2 tex_icon=v_tex_a_icon;lowp float alpha=opacity*fade_opacity;glFragColor=texture(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
return;}
#endif
#ifdef RENDER_SDF
float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_gamma_scale_size_fade_opacity.x;float size=v_gamma_scale_size_fade_opacity.y;float fontScale=u_is_text ? size/24.0 : size;out_color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;bool draw_halo=v_draw_halo > 0.0;if (draw_halo) {out_color=halo_color;gamma=(halo_blur*u_scale_factor*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width*u_scale_factor/fontScale)/SDF_PX;}lowp float dist=texture(u_texture,v_tex_a).r;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);out_color*=alpha;
#else
#ifdef ICON_TRANSITION
vec4 a=texture(u_texture,v_tex_a)*(1.0-u_icon_transition);vec4 b=texture(u_texture,v_tex_b)*u_icon_transition;out_color=(a+b);
#else
out_color=texture(u_texture,v_tex_a);
#endif
#ifdef COLOR_ADJUSTMENT
out_color=u_color_adj_mat*out_color;
#endif
#endif
out_color*=opacity*fade_opacity;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,emissive_strength);
#endif
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,v_z_offset);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
in vec4 a_pos_offset;in vec4 a_tex_size;in vec4 a_pixeloffset;in vec4 a_projected_pos;in float a_fade_opacity;
#ifdef Z_OFFSET
in float a_auto_z_offset;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_globe_anchor;in vec3 a_globe_normal;
#endif
#ifdef ICON_TRANSITION
in vec2 a_texb;
#endif
#ifdef OCCLUSION_QUERIES
in float a_occlusion_query_opacity;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_elevation_from_sea;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform vec2 u_texsize_icon;uniform bool u_is_halo;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
out vec2 v_tex_a;
#ifdef ICON_TRANSITION
out vec2 v_tex_b;
#endif
out float v_draw_halo;out vec3 v_gamma_scale_size_fade_opacity;
#ifdef RENDER_TEXT_AND_SYMBOL
out float is_sdf;out vec2 v_tex_a_icon;
#endif
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
#pragma mapbox: define lowp float occlusion_opacity
#pragma mapbox: define lowp float z_offset
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
#pragma mapbox: initialize lowp float occlusion_opacity
#pragma mapbox: initialize lowp float z_offset
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_min_font_scale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;float e=u_elevation_from_sea ? z_offset : z_offset+elevation(tile_anchor);
#ifdef Z_OFFSET
e+=a_auto_z_offset;
#endif
vec3 h=elevationVector(tile_anchor)*e;float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;vec3 world_pos_globe;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos_globe=a_globe_anchor+h;world_pos=mix_globe_mercator(world_pos_globe,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetprojected_point;vec2 a;
#ifdef PROJECTION_GLOBE_VIEW
vec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetprojected_point=u_matrix*vec4(a_globe_anchor+displacement,1);vec4 projected_point_globe=u_matrix*vec4(world_pos_globe,1);a=projected_point_globe.xy/projected_point_globe.w;
#else
offsetprojected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);a=projected_point.xy/projected_point.w;
#endif
vec2 b=offsetprojected_point.xy/offsetprojected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*max(a_min_font_scale,font_scale)+a_pxoffset/16.0);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
#ifdef Z_OFFSET
z+=u_pitch_with_map ? a_auto_z_offset+(u_elevation_from_sea ? z_offset : z_offset) : 0.0;
#else
z+=u_pitch_with_map ? (u_elevation_from_sea ? z_offset : z_offset) : 0.0;
#endif
float occlusion_fade=globe_occlusion_fade;float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));float out_fade_opacity=interpolated_fade_opacity*projection_transition_fade;
#ifdef DEPTH_OCCLUSION
float depth_occlusion=occlusionFadeMultiSample(projected_point);float depth_occlusion_multplier=mix(occlusion_opacity,1.0,depth_occlusion);out_fade_opacity*=depth_occlusion_multplier;
#endif
#ifdef OCCLUSION_QUERIES
float occludedFadeMultiplier=mix(occlusion_opacity,1.0,a_occlusion_query_opacity);out_fade_opacity*=occludedFadeMultiplier;
#endif
float alpha=opacity*out_fade_opacity;float hidden=float(alpha==0.0 || projected_point.w <=0.0 || occlusion_fade==0.0);
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,hidden);
#else
gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,hidden);
#endif
float gamma_scale=gl_Position.w;v_draw_halo=(u_is_halo && float(gl_InstanceID)==0.0) ? 1.0 : 0.0;v_gamma_scale_size_fade_opacity=vec3(gamma_scale,size,out_fade_opacity);v_tex_a=a_tex/u_texsize;
#ifdef RENDER_TEXT_AND_SYMBOL
is_sdf=a_size[0]-2.0*a_size_min;v_tex_a_icon=a_tex/u_texsize_icon;
#endif
#ifdef ICON_TRANSITION
v_tex_b=a_texb/u_texsize;
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=e;
#endif
}`),terrainRaster:gr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image0;in vec2 v_pos0;
#ifdef FOG
in float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;
#endif
uniform vec3 u_ground_shadow_factor;void main() {vec4 image_color=texture(u_image0,v_pos0);vec4 color;
#ifdef LIGHTING_3D_MODE
const vec3 normal=vec3(0.0,0.0,1.0);
#ifdef RENDER_SHADOWS
float cutoffOpacity=1.0;
#ifdef RENDER_CUTOFF
cutoffOpacity=cutoff_opacity(u_cutoff_params,1.0/gl_FragCoord.w);
#endif
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
vec3 unlit_base=image_color.rgb*(1.0-image_color.a);vec3 emissive_base=image_color.rgb*image_color.a;float ndotl=u_shadow_direction.z;float occlusion=ndotl < 0.0 ? 1.0 : shadow_occlusion(v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w,0.0);ndotl=max(0.0,ndotl);vec3 lit=apply_lighting(unlit_base,normal,mix(1.0,(1.0-(u_shadow_intensity*occlusion))*ndotl,cutoffOpacity));vec3 emissive=compute_emissive_draped(emissive_base,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=lit+emissive;color.a=1.0;
#else
float lighting_factor=shadowed_light_factor_normal_unbiased(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);color=apply_lighting(image_color,normal,mix(1.0,lighting_factor,cutoffOpacity));
#endif
#else
float lighting_factor=u_lighting_directional_dir.z;color=apply_lighting(image_color,normal,lighting_factor);
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
color.rgb=mix(color.rgb,image_color.rgb,image_color.a);color.a=1.0;
#endif
#endif
#else
color=image_color;
#endif
#ifdef FOG
#ifdef ZERO_EXAGGERATION
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#else
color=fog_dither(fog_apply_from_vert(color,v_fog_opacity));
#endif
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;uniform float u_skirt_height;in vec2 a_pos;out vec2 v_pos0;
#ifdef FOG
out float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;out float v_depth;
#endif
void main() {vec3 decomposedPosAndSkirt=decomposeToPosAndSkirt(a_pos);float skirt=decomposedPosAndSkirt.z;vec2 decodedPos=decomposedPosAndSkirt.xy;float elevation=elevation(decodedPos)-skirt*u_skirt_height;v_pos0=decodedPos/8192.0;gl_Position=u_matrix*vec4(decodedPos,elevation,1.0);
#ifdef FOG
#ifdef ZERO_EXAGGERATION
v_fog_pos=fog_position(decodedPos);
#else
v_fog_opacity=fog(fog_position(vec3(decodedPos,elevation)));
#endif
#endif
#ifdef RENDER_SHADOWS
vec3 pos=vec3(decodedPos,elevation);v_pos_light_view_0=u_light_matrix_0*vec4(pos,1.);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1.);
#endif
}`),terrainDepth:gr("precision highp float;in float v_depth;void main() {glFragColor=pack_depth(v_depth);}",`#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;in vec2 a_pos;out float v_depth;void main() {float elevation=elevation(a_pos);gl_Position=u_matrix*vec4(a_pos,elevation,1.0);v_depth=gl_Position.z/gl_Position.w;}`),skybox:gr(`#include "_prelude_fog.fragment.glsl"
in lowp vec3 v_uv;uniform lowp samplerCube u_cubemap;uniform lowp float u_opacity;uniform highp float u_temporal_offset;uniform highp vec3 u_sun_direction;float sun_disk(highp vec3 ray_direction,highp vec3 sun_direction) {highp float cos_angle=dot(normalize(ray_direction),sun_direction);const highp float cos_sun_angular_diameter=0.99996192306;const highp float smoothstep_delta=1e-5;return smoothstep(
cos_sun_angular_diameter-smoothstep_delta,cos_sun_angular_diameter+smoothstep_delta,cos_angle);}float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec3 uv=v_uv;const float y_bias=0.015;uv.y+=y_bias;uv.y=pow(abs(uv.y),1.0/5.0);uv.y=map(uv.y,0.0,1.0,-1.0,1.0);vec3 sky_color=texture(u_cubemap,uv).rgb;
#ifdef FOG
sky_color=fog_apply_sky_gradient(v_uv.xzy,sky_color);
#endif
sky_color.rgb=dither(sky_color.rgb,gl_FragCoord.xy+u_temporal_offset);sky_color+=0.1*sun_disk(v_uv,u_sun_direction);glFragColor=vec4(sky_color*u_opacity,u_opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,Hh),skyboxGradient:gr(`#include "_prelude_fog.fragment.glsl"
in highp vec3 v_uv;uniform lowp sampler2D u_color_ramp;uniform highp vec3 u_center_direction;uniform lowp float u_radius;uniform lowp float u_opacity;uniform highp float u_temporal_offset;void main() {float progress=acos(dot(normalize(v_uv),u_center_direction))/u_radius;vec4 color=texture(u_color_ramp,vec2(progress,0.5));
#ifdef FOG
color.rgb=fog_apply_sky_gradient(v_uv.xzy,color.rgb/color.a)*color.a;
#endif
color*=u_opacity;color.rgb=dither(color.rgb,gl_FragCoord.xy+u_temporal_offset);glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,Hh),skyboxCapture:gr(`
in highp vec3 v_position;uniform highp float u_sun_intensity;uniform highp float u_luminance;uniform lowp vec3 u_sun_direction;uniform highp vec4 u_color_tint_r;uniform highp vec4 u_color_tint_m;precision highp float;
#define BETA_R                  vec3(5.5e-6,13.0e-6,22.4e-6)
#define BETA_M                  vec3(21e-6,21e-6,21e-6)
#define MIE_G                   0.76
#define DENSITY_HEIGHT_SCALE_R  8000.0
#define DENSITY_HEIGHT_SCALE_M  1200.0
#define PLANET_RADIUS           6360e3
#define ATMOSPHERE_RADIUS       6420e3
#define SAMPLE_STEPS            10
#define DENSITY_STEPS           4
float ray_sphere_exit(vec3 orig,vec3 dir,float radius) {float a=dot(dir,dir);float b=2.0*dot(dir,orig);float c=dot(orig,orig)-radius*radius;float d=sqrt(b*b-4.0*a*c);return (-b+d)/(2.0*a);}vec3 extinction(vec2 density) {return exp(-vec3(BETA_R*u_color_tint_r.a*density.x+BETA_M*u_color_tint_m.a*density.y));}vec2 local_density(vec3 point) {float height=max(length(point)-PLANET_RADIUS,0.0);float exp_r=exp(-height/DENSITY_HEIGHT_SCALE_R);float exp_m=exp(-height/DENSITY_HEIGHT_SCALE_M);return vec2(exp_r,exp_m);}float phase_ray(float cos_angle) {return (3.0/(16.0*PI))*(1.0+cos_angle*cos_angle);}float phase_mie(float cos_angle) {return (3.0/(8.0*PI))*((1.0-MIE_G*MIE_G)*(1.0+cos_angle*cos_angle))/((2.0+MIE_G*MIE_G)*pow(1.0+MIE_G*MIE_G-2.0*MIE_G*cos_angle,1.5));}vec2 density_to_atmosphere(vec3 point,vec3 light_dir) {float ray_len=ray_sphere_exit(point,light_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(DENSITY_STEPS);vec2 density_point_to_atmosphere=vec2(0.0);for (int i=0; i < DENSITY_STEPS;++i) {vec3 point_on_ray=point+light_dir*((float(i)+0.5)*step_len);density_point_to_atmosphere+=local_density(point_on_ray)*step_len;;}return density_point_to_atmosphere;}vec3 atmosphere(vec3 ray_dir,vec3 sun_direction,float sun_intensity) {vec2 density_orig_to_point=vec2(0.0);vec3 scatter_r=vec3(0.0);vec3 scatter_m=vec3(0.0);vec3 origin=vec3(0.0,PLANET_RADIUS,0.0);float ray_len=ray_sphere_exit(origin,ray_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(SAMPLE_STEPS);for (int i=0; i < SAMPLE_STEPS;++i) {vec3 point_on_ray=origin+ray_dir*((float(i)+0.5)*step_len);vec2 density=local_density(point_on_ray)*step_len;density_orig_to_point+=density;vec2 density_point_to_atmosphere=density_to_atmosphere(point_on_ray,sun_direction);vec2 density_orig_to_atmosphere=density_orig_to_point+density_point_to_atmosphere;vec3 extinction=extinction(density_orig_to_atmosphere);scatter_r+=density.x*extinction;scatter_m+=density.y*extinction;}float cos_angle=dot(ray_dir,sun_direction);float phase_r=phase_ray(cos_angle);float phase_m=phase_mie(cos_angle);vec3 beta_r=BETA_R*u_color_tint_r.rgb*u_color_tint_r.a;vec3 beta_m=BETA_M*u_color_tint_m.rgb*u_color_tint_m.a;return (scatter_r*phase_r*beta_r+scatter_m*phase_m*beta_m)*sun_intensity;}const float A=0.15;const float B=0.50;const float C=0.10;const float D=0.20;const float E=0.02;const float F=0.30;vec3 uncharted2_tonemap(vec3 x) {return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}void main() {vec3 ray_direction=v_position;ray_direction.y=pow(ray_direction.y,5.0);const float y_bias=0.015;ray_direction.y+=y_bias;vec3 color=atmosphere(normalize(ray_direction),u_sun_direction,u_sun_intensity);float white_scale=1.0748724675633854;color=uncharted2_tonemap((log2(2.0/pow(u_luminance,4.0)))*color)*white_scale;glFragColor=vec4(color,1.0);}`,"in highp vec3 a_pos_3f;uniform mat3 u_matrix_3f;out highp vec3 v_position;float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec4 pos=vec4(u_matrix_3f*a_pos_3f,1.0);v_position=pos.xyz;v_position.y*=-1.0;v_position.y=map(v_position.y,-1.0,1.0,0.0,1.0);gl_Position=vec4(a_pos_3f.xy,0.0,1.0);}"),globeRaster:gr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image0;uniform float u_far_z_cutoff;in vec2 v_pos0;
#ifndef FOG
uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform vec2 u_viewport;
#endif
void main() {vec4 color;
#ifdef CUSTOM_ANTIALIASING
vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);vec3 dir=normalize(ray_dir);vec3 closest_point=dot(u_globe_pos,dir)*dir;float norm_dist_from_center=1.0-length(closest_point-u_globe_pos)/u_globe_radius;const float antialias_pixel=2.0;float antialias_factor=antialias_pixel*fwidth(norm_dist_from_center);float antialias=smoothstep(0.0,antialias_factor,norm_dist_from_center);vec4 raster=texture(u_image0,v_pos0);
#ifdef LIGHTING_3D_MODE
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
raster=apply_lighting_with_emission_ground(raster,raster.a);color=vec4(raster.rgb*antialias,antialias);
#else
raster=apply_lighting_ground(raster);color=vec4(raster.rgb*antialias,raster.a*antialias);
#endif
#else
color=vec4(raster.rgb*antialias,raster.a*antialias);
#endif
#else
color=texture(u_image0,v_pos0);
#ifdef LIGHTING_3D_MODE
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
color=apply_lighting_with_emission_ground(color,color.a);color.a=1.0;
#else
color=apply_lighting_ground(color);
#endif
#endif
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
color*=1.0-step(u_far_z_cutoff,1.0/gl_FragCoord.w);glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_proj_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform float u_zoom_transition;uniform vec2 u_merc_center;uniform mat3 u_grid_matrix;uniform float u_skirt_height;
#ifdef GLOBE_POLES
in vec3 a_globe_pos;in vec2 a_uv;
#else
in vec2 a_pos;
#endif
out vec2 v_pos0;void main() {
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;vec2 uv=a_uv;
#else
float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float uvY=mercatorY*tiles-idy;float mercatorX=mercatorXfromLng(latLng[1]);float uvX=mercatorX*tiles-idx;vec3 globe_pos=latLngToECEF(latLng.xy);vec2 merc_pos=vec2(mercatorX,mercatorY);vec2 uv=vec2(uvX,uvY);
#endif
v_pos0=uv;vec2 tile_pos=uv*EXTENT;vec3 globe_derived_up_vector=normalize(globe_pos)*u_tile_up_scale;
#ifdef GLOBE_POLES
vec3 up_vector=globe_derived_up_vector;
#else
vec3 up_vector=elevationVector(tile_pos);
#endif
float height=elevation(tile_pos);globe_pos+=up_vector*height;
#ifndef GLOBE_POLES
globe_pos-=globe_derived_up_vector*u_skirt_height*decomposed_pos_and_skirt.z;
#endif
#ifdef GLOBE_POLES
vec4 interpolated_pos=u_globe_matrix*vec4(globe_pos,1.0);
#else
vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {merc_world_pos=vec4(merc_pos,height-u_skirt_height*decomposed_pos_and_skirt.z,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition),1.0);
#endif
gl_Position=u_proj_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
}`),globeAtmosphere:gr(`#include "_prelude_fog.fragment.glsl"
uniform float u_transition;uniform highp float u_fadeout_range;uniform highp float u_temporal_offset;uniform vec4 u_color;uniform vec4 u_high_color;uniform vec4 u_space_color;uniform float u_horizon_angle;in highp vec3 v_ray_dir;in highp vec3 v_horizon_dir;void main() {highp vec3 dir=normalize(v_ray_dir);float globe_pos_dot_dir;
#ifdef PROJECTION_GLOBE_VIEW
globe_pos_dot_dir=dot(u_globe_pos,dir);highp vec3 closest_point_forward=abs(globe_pos_dot_dir)*dir;float norm_dist_from_center=length(closest_point_forward-u_globe_pos)/u_globe_radius;if (norm_dist_from_center < 0.98) {
#ifdef ALPHA_PASS
glFragColor=vec4(0,0,0,0);return;
#else
#ifdef NATIVE
glFragColor=vec4(1,1,1,1);
#else
glFragColor=vec4(0,0,0,1);
#endif
return;
#endif
}
#endif
highp vec3 horizon_dir=normalize(v_horizon_dir);float horizon_angle_mercator=dir.y < horizon_dir.y ?
0.0 : max(acos(clamp(dot(dir,horizon_dir),-1.0,1.0)),0.0);float horizon_angle;
#ifdef PROJECTION_GLOBE_VIEW
highp vec3 closest_point=globe_pos_dot_dir*dir;highp float closest_point_to_center=length(closest_point-u_globe_pos);highp float theta=asin(clamp(closest_point_to_center/length(u_globe_pos),-1.0,1.0));horizon_angle=globe_pos_dot_dir < 0.0 ?
PI-theta-u_horizon_angle : theta-u_horizon_angle;float angle_t=pow(u_transition,10.0);horizon_angle=mix(horizon_angle,horizon_angle_mercator,angle_t);
#else
horizon_angle=horizon_angle_mercator;
#endif
horizon_angle/=PI;float t=exp(-horizon_angle/u_fadeout_range);float alpha_0=u_color.a;float alpha_1=u_high_color.a;float alpha_2=u_space_color.a;vec3 color_stop_0=u_color.rgb;vec3 color_stop_1=u_high_color.rgb;vec3 color_stop_2=u_space_color.rgb;
#ifdef ALPHA_PASS
float a0=mix(alpha_2,1.0,alpha_1);float a1=mix(a0,1.0,alpha_0);float a2=mix(a0,a1,t);float a =mix(alpha_2,a2,t);glFragColor=vec4(1.0,1.0,1.0,a);
#else
vec3 c0=mix(color_stop_2,color_stop_1,alpha_1);vec3 c1=mix(c0,color_stop_0,alpha_0);vec3 c2=mix(c0,c1,t);vec3 c=c2;
#ifndef NATIVE
c=dither(c,gl_FragCoord.xy+u_temporal_offset);
#endif
glFragColor=vec4(c*t,t);
#endif
}`,`in vec3 a_pos;in vec2 a_uv;uniform vec3 u_frustum_tl;uniform vec3 u_frustum_tr;uniform vec3 u_frustum_br;uniform vec3 u_frustum_bl;uniform float u_horizon;out highp vec3 v_ray_dir;out highp vec3 v_horizon_dir;void main() {v_ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,a_uv.x),mix(u_frustum_bl,u_frustum_br,a_uv.x),a_uv.y);v_horizon_dir=mix(
mix(u_frustum_tl,u_frustum_bl,u_horizon),mix(u_frustum_tr,u_frustum_br,u_horizon),a_uv.x);gl_Position=vec4(a_pos,1.0);}`),model:gr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform float u_opacity;uniform vec3 u_lightcolor;uniform vec3 u_lightpos;uniform float u_lightintensity;uniform vec4 u_baseColorFactor;uniform vec4 u_emissiveFactor;uniform float u_metallicFactor;uniform float u_roughnessFactor;uniform float u_emissive_strength;in highp vec4 v_position_height;in lowp vec4 v_color_mix;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in float v_depth_shadows;
#endif
#ifdef OCCLUSION_TEXTURE_TRANSFORM
uniform vec4 u_occlusionTextureTransform;
#endif
#pragma mapbox: define-attribute highp vec3 normal_3f
#pragma mapbox: define-attribute highp vec3 color_3f
#pragma mapbox: define-attribute highp vec4 color_4f
#pragma mapbox: define-attribute highp vec2 uv_2f
#pragma mapbox: initialize-attribute highp vec3 normal_3f
#pragma mapbox: initialize-attribute highp vec3 color_3f
#pragma mapbox: initialize-attribute highp vec4 color_4f
#pragma mapbox: initialize-attribute highp vec2 uv_2f
#ifdef HAS_ATTRIBUTE_a_pbr
in lowp vec4 v_roughness_metallic_emissive_alpha;in mediump vec4 v_height_based_emission_params;
#endif
#ifdef HAS_TEXTURE_u_baseColorTexture
uniform sampler2D u_baseColorTexture;uniform bool u_baseTextureIsAlpha;uniform bool u_alphaMask;uniform float u_alphaCutoff;
#endif
#ifdef HAS_TEXTURE_u_metallicRoughnessTexture
uniform sampler2D u_metallicRoughnessTexture;
#endif
#ifdef HAS_TEXTURE_u_occlusionTexture
uniform sampler2D u_occlusionTexture;uniform float u_aoIntensity;
#endif
#ifdef HAS_TEXTURE_u_normalTexture
uniform sampler2D u_normalTexture;
#endif
#ifdef HAS_TEXTURE_u_emissionTexture
uniform sampler2D u_emissionTexture;
#endif
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
#ifdef TERRAIN_FRAGMENT_OCCLUSION
in highp float v_depth;uniform highp sampler2D u_depthTexture;uniform highp vec2 u_inv_depth_size;uniform highp vec2 u_depth_range_unpack;
#ifdef DEPTH_D24
highp float unpack_depth(highp float depth) {return  depth*u_depth_range_unpack.x+u_depth_range_unpack.y;}
#else
highp float unpack_depth_rgba(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}
#endif
bool isOccluded() {highp vec2 coord=gl_FragCoord.xy*u_inv_depth_size;
#ifdef DEPTH_D24
highp float depth=unpack_depth(texture(u_depthTexture,coord).r);
#else
highp float depth=unpack_depth_rgba(texture(u_depthTexture,coord));
#endif
return v_depth > depth+0.0005;}
#endif
#define saturate(_x) clamp(_x,0.,1.)
vec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}float calculate_NdotL(vec3 normal,vec3 lightDir) {const float ext=0.70710678118;return (clamp(dot(normal,lightDir),-ext,1.0)+ext)/(1.0+ext);}vec3 getDiffuseShadedColor(vec3 albedo,vec3 normal,vec3 lightDir,vec3 lightColor)
{
#ifdef LIGHTING_3D_MODE
vec3 transformed_normal=vec3(-normal.xy,normal.z);float lighting_factor;
#ifdef RENDER_SHADOWS
lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);
#else
lighting_factor=saturate(dot(transformed_normal,u_lighting_directional_dir));
#endif
return apply_lighting(albedo,transformed_normal,lighting_factor);
#else
vec3 n=normal;float colorvalue=((albedo.x*0.2126)+(albedo.y*0.7152))+(albedo.z*0.0722);vec3 c=vec3(0.03,0.03,0.03);float directional=clamp(dot(n,vec3(lightDir)),0.0,1.0);directional=mix(1.0-u_lightintensity,max((1.0-colorvalue)+u_lightintensity,1.0),directional);vec3 c3=c+clamp((albedo*directional)*lightColor,mix(vec3(0.0),vec3(0.3),vec3(1.0)-lightColor),vec3(1.0));return c3;
#endif
}vec4 getBaseColor() {vec4 albedo=u_baseColorFactor;
#ifdef HAS_ATTRIBUTE_a_color_3f
albedo*=vec4(color_3f,1.0);
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
#else
#ifdef HAS_ATTRIBUTE_a_color_4f
albedo*=color_4f;
#endif
#endif
#if defined (HAS_TEXTURE_u_baseColorTexture) && defined (HAS_ATTRIBUTE_a_uv_2f)
vec4 texColor=texture(u_baseColorTexture,uv_2f);if(u_alphaMask) {if (texColor.w < u_alphaCutoff) {discard;}}
#ifdef UNPREMULT_TEXTURE_IN_SHADER
if(texColor.w > 0.0) {texColor.rgb/=texColor.w;}texColor.w=1.0;
#endif
if(u_baseTextureIsAlpha) {if (texColor.r < 0.5) {discard;}} else {texColor.rgb=sRGBToLinear(texColor.rgb);albedo*=texColor;}
#endif
vec4 color=vec4(mix(albedo.rgb,v_color_mix.rgb,v_color_mix.a),albedo.a);
#ifdef APPLY_LUT_ON_GPU
color=applyLUT(u_lutTexture,color);
#endif
return color;}highp mat3 cotangentFrame(highp vec3 N,highp vec3 p,highp vec2 uv ) {
#ifdef HAS_TEXTURE_u_normalTexture
highp vec3 dp1=vec3(dFdx(p.x),dFdx(p.y),dFdx(p.z));highp vec3 dp2=vec3(dFdy(p.x),dFdy(p.y),dFdy(p.z));highp vec2 duv1=vec2(dFdx(uv.x),dFdx(uv.y));highp vec2 duv2=vec2(dFdy(uv.x),dFdy(uv.y));highp vec3 dp2perp=cross( dp2,N );highp vec3 dp1perp=cross( N,dp1 );highp vec3 T=dp2perp*duv1.x+dp1perp*duv2.x;highp vec3 B=dp2perp*duv1.y+dp1perp*duv2.y;highp float lengthT=dot(T,T);highp float lengthB=dot(B,B);highp float maxLength=max(lengthT,lengthB);highp float invmax=inversesqrt( maxLength );highp mat3 res=mat3( T*invmax,B*invmax,N );return res;
#else
return mat3(1.0);
#endif
}highp vec3 getNormal(){highp vec3 n;
#ifdef HAS_ATTRIBUTE_a_normal_3f
n=normalize(normal_3f);
#else
highp vec3 fdx=vec3(dFdx(v_position_height.x),dFdx(v_position_height.y),dFdx(v_position_height.z));highp vec3 fdy=vec3(dFdy(v_position_height.x),dFdy(v_position_height.y),dFdy(v_position_height.z));n=normalize(cross(fdx,fdy))*-1.0;
#endif
#if defined(HAS_TEXTURE_u_normalTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
vec3 nMap=texture( u_normalTexture,uv_2f).xyz;nMap=normalize(2.0*nMap-vec3(1.0));highp vec3 v=normalize(-v_position_height.xyz);highp mat3 TBN=cotangentFrame(n,v,uv_2f);n=normalize(TBN*nMap);
#endif
return n;}struct Material {float perceptualRoughness;float alphaRoughness;float metallic;vec3 f90;vec4 baseColor;vec3 diffuseColor;vec3 specularColor;highp vec3 normal;};Material getPBRMaterial() {Material mat;mat.baseColor=getBaseColor();mat.perceptualRoughness=u_roughnessFactor;mat.metallic=u_metallicFactor;
#ifdef HAS_ATTRIBUTE_a_pbr
mat.perceptualRoughness=v_roughness_metallic_emissive_alpha.x;mat.metallic=v_roughness_metallic_emissive_alpha.y;mat.baseColor.w*=v_roughness_metallic_emissive_alpha.w;
#endif
#if defined(HAS_TEXTURE_u_metallicRoughnessTexture) && defined(HAS_ATTRIBUTE_a_uv_2f) 
vec4 mrSample=texture(u_metallicRoughnessTexture,uv_2f);mat.perceptualRoughness*=mrSample.g;mat.metallic*=mrSample.b;
#endif
const float c_minRoughness=0.04;mat.perceptualRoughness=clamp(mat.perceptualRoughness,c_minRoughness,1.0);mat.metallic=saturate(mat.metallic);mat.alphaRoughness=mat.perceptualRoughness*mat.perceptualRoughness;const vec3 f0=vec3(0.04);mat.diffuseColor=mat.baseColor.rgb*(vec3(1.0)-f0);mat.diffuseColor*=1.0-mat.metallic;mat.specularColor=mix(f0,mat.baseColor.rgb,mat.metallic);highp float reflectance=max(max(mat.specularColor.r,mat.specularColor.g),mat.specularColor.b);highp float reflectance90=saturate(reflectance*25.0);mat.f90=vec3(reflectance90);mat.normal=getNormal();return mat;}float V_GGX(float NdotL,float NdotV,float roughness)
{float a2=roughness*roughness;float GGXV=NdotL*sqrt(NdotV*NdotV*(1.0-a2)+a2);float GGXL=NdotV*sqrt(NdotL*NdotL*(1.0-a2)+a2);return 0.5/(GGXV+GGXL);}float V_GGXFast(float NdotL,float NdotV,float roughness) {float a=roughness;float GGXV=NdotL*(NdotV*(1.0-a)+a);float GGXL=NdotV*(NdotL*(1.0-a)+a);return 0.5/(GGXV+GGXL);}vec3 F_Schlick(vec3 specularColor,vec3 f90,float VdotH)
{return specularColor+(f90-specularColor)*pow(clamp(1.0-VdotH,0.0,1.0),5.0);}vec3 F_SchlickFast(vec3 specularColor,float VdotH)
{float x=1.0-VdotH;float x4=x*x*x*x;return specularColor+(1.0-specularColor)*x4*x;}float D_GGX(highp float NdotH,float alphaRoughness)
{highp float a4=alphaRoughness*alphaRoughness;highp float f=(NdotH*a4-NdotH)*NdotH+1.0;return a4/(PI*f*f);}vec3 diffuseBurley(Material mat,float LdotH,float NdotL,float NdotV)
{float f90=2.0*LdotH*LdotH*mat.alphaRoughness-0.5;return (mat.diffuseColor/PI)*(1.0+f90*pow((1.0-NdotL),5.0))*(1.0+f90*pow((1.0-NdotV),5.0));}vec3 diffuseLambertian(Material mat)
{
#ifdef LIGHTING_3D_MODE
return mat.diffuseColor;
#else
return mat.diffuseColor/PI;
#endif
}vec3 EnvBRDFApprox(vec3 specularColor,float roughness,highp float NdotV)
{vec4 c0=vec4(-1,-0.0275,-0.572,0.022);vec4 c1=vec4(1,0.0425,1.04,-0.04);highp vec4 r=roughness*c0+c1;highp float a004=min(r.x*r.x,exp2(-9.28*NdotV))*r.x+r.y;vec2 AB=vec2(-1.04,1.04)*a004+r.zw;return specularColor*AB.x+AB.y;}vec3 computeIndirectLightContribution(Material mat,float NdotV,vec3 normal)
{vec3 env_light=vec3(0.65,0.65,0.65);
#ifdef LIGHTING_3D_MODE
float ambient_factor=calculate_ambient_directional_factor(normal);env_light=u_lighting_ambient_color*ambient_factor;
#endif
vec3 envBRDF=EnvBRDFApprox(mat.specularColor,mat.perceptualRoughness,NdotV);vec3 indirectSpecular= envBRDF*env_light;vec3 indirectDiffuse=mat.diffuseColor*env_light;return indirectSpecular+indirectDiffuse;}vec3 computeLightContribution(Material mat,vec3 lightPosition,vec3 lightColor)
{highp vec3 n=mat.normal;highp vec3 v=normalize(-v_position_height.xyz);highp vec3 l=normalize(lightPosition);highp vec3 h=normalize(v+l);float NdotV=clamp(abs(dot(n,v)),0.001,1.0);float NdotL=saturate(dot(n,l));highp float NdotH=saturate(dot(n,h));float VdotH=saturate(dot(v,h));vec3 f=F_SchlickFast(mat.specularColor,VdotH);float g=V_GGXFast(NdotL,NdotV,mat.alphaRoughness);float d=D_GGX(NdotH,mat.alphaRoughness);vec3 diffuseTerm=(1.0-f)*diffuseLambertian(mat);vec3 specularTerm=f*g*d;vec3 transformed_normal=vec3(-n.xy,n.z);float lighting_factor;
#ifdef RENDER_SHADOWS
lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);
#else
lighting_factor=NdotL;
#endif
vec3 directLightColor=(specularTerm+diffuseTerm)*lighting_factor*lightColor;vec3 indirectLightColor=computeIndirectLightContribution(mat,NdotV,transformed_normal);vec3 color=(saturate(directLightColor)+indirectLightColor);float intensityFactor=1.0;
#if !defined(LIGHTING_3D_MODE)
const vec3 luminosityFactor=vec3(0.2126,0.7152,0.0722);float luminance=dot(diffuseTerm,luminosityFactor);intensityFactor=mix((1.0-u_lightintensity),max((1.0-luminance+u_lightintensity),1.0),NdotL);
#endif
color*=intensityFactor;return color;}void main() {
#ifdef TERRAIN_FRAGMENT_OCCLUSION
if (isOccluded()) {discard;}
#endif
vec3 lightDir=u_lightpos;vec3 lightColor=u_lightcolor;
#ifdef LIGHTING_3D_MODE
lightDir=u_lighting_directional_dir;lightDir.xy=-lightDir.xy;lightColor=u_lighting_directional_color;
#endif
vec4 finalColor;
#ifdef DIFFUSE_SHADED
vec3 N=getNormal();vec3 baseColor=getBaseColor().rgb;vec3 diffuse=getDiffuseShadedColor(baseColor,N,lightDir,lightColor);
#ifdef HAS_TEXTURE_u_occlusionTexture
float ao=(texture(u_occlusionTexture,uv_2f).r-1.0)*u_aoIntensity+1.0;diffuse*=ao;
#endif
finalColor=vec4(mix(diffuse,baseColor,u_emissive_strength),1.0)*u_opacity;
#else
Material mat=getPBRMaterial();vec3 color=computeLightContribution(mat,lightDir,lightColor);float ao=1.0;
#if defined (HAS_TEXTURE_u_occlusionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
#ifdef OCCLUSION_TEXTURE_TRANSFORM
vec2 uv=uv_2f.xy*u_occlusionTextureTransform.zw+u_occlusionTextureTransform.xy;
#else
vec2 uv=uv_2f;
#endif
ao=(texture(u_occlusionTexture,uv).x-1.0)*u_aoIntensity+1.0;color*=ao;
#endif
vec4 emissive=u_emissiveFactor;
#if defined(HAS_TEXTURE_u_emissionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
emissive.rgb*=sRGBToLinear(texture(u_emissionTexture,uv_2f).rgb);
#endif
#ifdef APPLY_LUT_ON_GPU
float emissiveFactorLength=max(length(u_emissiveFactor.rgb),0.001);emissive.rgb=sRGBToLinear(applyLUT(u_lutTexture,linearTosRGB(emissive.rgb/emissiveFactorLength).rbg))*emissiveFactorLength;
#endif
color+=emissive.rgb;float opacity=mat.baseColor.w*u_opacity;
#ifdef HAS_ATTRIBUTE_a_pbr
float resEmission=v_roughness_metallic_emissive_alpha.z;resEmission*=v_height_based_emission_params.z+v_height_based_emission_params.w*pow(clamp(v_height_based_emission_params.x,0.0,1.0),v_height_based_emission_params.y);vec3 color_mix=v_color_mix.rgb;
#ifdef APPLY_LUT_ON_GPU
color_mix=applyLUT(u_lutTexture,color_mix);
#endif
color=mix(color,color_mix,min(1.0,resEmission));
#ifdef HAS_ATTRIBUTE_a_color_4f
float distance=length(vec2(1.3*max(0.0,abs(color_4f.x)-color_4f.z),color_4f.y));distance+= mix(0.5,0.0,clamp(resEmission-1.0,0.0,1.0));opacity*=v_roughness_metallic_emissive_alpha.w*saturate(1.0-distance*distance);
#endif
#endif
vec3 unlitColor=mat.baseColor.rgb*ao+emissive.rgb;color=mix(color,unlitColor,u_emissive_strength);color=linearTosRGB(color);color*=opacity;finalColor=vec4(color,opacity);
#endif
#ifdef FOG
finalColor=fog_dither(fog_apply_premultiplied(finalColor,v_fog_pos,v_position_height.w));
#endif
#ifdef RENDER_CUTOFF
finalColor*=v_cutoff_opacity;
#endif
#ifdef INDICATOR_CUTOUT
finalColor=applyCutout(finalColor,v_position_height.w);
#endif
glFragColor=finalColor;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec3 a_pos_3f;
#pragma mapbox: define-attribute highp vec3 normal_3f
#pragma mapbox: define-attribute highp vec2 uv_2f
#pragma mapbox: define-attribute highp vec3 color_3f
#pragma mapbox: define-attribute highp vec4 color_4f
#pragma mapbox: define-attribute-vertex-shader-only highp vec4 pbr
#pragma mapbox: define-attribute-vertex-shader-only highp vec3 heightBasedEmissiveStrength
uniform mat4 u_matrix;uniform mat4 u_node_matrix;uniform mat4 u_lighting_matrix;uniform vec3 u_camera_pos;uniform vec4 u_color_mix;
#ifdef INSTANCED_ARRAYS
in vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;
#else
uniform highp mat4 u_normal_matrix;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out float v_depth_shadows;
#endif
out vec4 v_position_height;out lowp vec4 v_color_mix;
#ifdef TERRAIN_FRAGMENT_OCCLUSION
out highp float v_depth;
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
out lowp vec4 v_roughness_metallic_emissive_alpha;out mediump vec4 v_height_based_emission_params;
#endif
vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}void main() {
#pragma mapbox: initialize-attribute highp vec3 normal_3f
#pragma mapbox: initialize-attribute highp vec2 uv_2f
#pragma mapbox: initialize-attribute highp vec3 color_3f
#pragma mapbox: initialize-attribute highp vec4 color_4f
#pragma mapbox: initialize-attribute-custom highp vec4 pbr
#pragma mapbox: initialize-attribute-custom highp vec3 heightBasedEmissiveStrength
highp mat4 normal_matrix;
#ifdef INSTANCED_ARRAYS
normal_matrix=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);
#else
normal_matrix=u_normal_matrix;
#endif
vec3 local_pos;mat3 rs;
#ifdef MODEL_POSITION_ON_GPU
vec3 pos_color=normal_matrix[0].xyz;vec4 translate=normal_matrix[1];vec3 pos_a=floor(pos_color);vec3 rgb=1.05*(pos_color-pos_a);float hidden=float(pos_a.x > EXTENT);float color_mix=pos_a.z/100.0;v_color_mix=vec4(sRGBToLinear(rgb),color_mix);float meter_to_tile=normal_matrix[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);rs[0].x=normal_matrix[1].w;rs[0].yz=normal_matrix[2].xy;rs[1].xy=normal_matrix[2].zw;rs[1].z=normal_matrix[3].x;rs[2].xyz=normal_matrix[3].yzw;vec4 pos_node=u_lighting_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;local_pos=pos.xyz;gl_Position=mix(u_matrix*pos,AWAY,hidden);pos.z*=meter_to_tile;v_position_height.xyz=pos.xyz-u_camera_pos;
#else
local_pos=a_pos_3f;gl_Position=u_matrix*vec4(a_pos_3f,1);v_position_height.xyz=vec3(u_lighting_matrix*vec4(a_pos_3f,1));v_color_mix=vec4(sRGBToLinear(u_color_mix.rgb),u_color_mix.a);
#endif
v_position_height.w=a_pos_3f.z;
#ifdef HAS_ATTRIBUTE_a_pbr
vec4 albedo_c=decode_color(pbr.xy);vec2 e_r_m=unpack_float(pbr.z);vec2 r_m= unpack_float(e_r_m.y*16.0);r_m.r=r_m.r*16.0;v_color_mix=vec4(albedo_c.rgb,1.0);v_roughness_metallic_emissive_alpha=vec4(vec3(r_m,e_r_m.x)/255.0,albedo_c.a);v_roughness_metallic_emissive_alpha.z*=2.0;float heightBasedRelativeIntepolation=a_pos_3f.z*heightBasedEmissiveStrength.x+heightBasedEmissiveStrength.y;v_height_based_emission_params.x=heightBasedRelativeIntepolation;v_height_based_emission_params.y=heightBasedEmissiveStrength.z;vec2 emissionMultiplierValues=unpack_float(pbr.w)/256.0;v_height_based_emission_params.z=emissionMultiplierValues.x;v_height_based_emission_params.w=emissionMultiplierValues.y-emissionMultiplierValues.x;
#endif
#ifdef FOG
v_fog_pos=fog_position(local_pos);
#endif
#ifdef RENDER_CUTOFF
v_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);
#endif
#ifdef TERRAIN_FRAGMENT_OCCLUSION
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef HAS_ATTRIBUTE_a_normal_3f
#ifdef MODEL_POSITION_ON_GPU
float x_squared_scale=dot(rs[0],rs[0]);float y_squared_scale=dot(rs[1],rs[1]);float z_squared_scale=dot(rs[2],rs[2]);vec3 squared_scale=vec3(x_squared_scale,y_squared_scale,z_squared_scale);normal_3f=rs*((u_lighting_matrix*vec4(normal_3f,0.0)).xyz/squared_scale);normal_3f=normalize(normal_3f);
#else
normal_3f=vec3(normal_matrix*vec4(normal_3f,0));
#endif
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
#ifdef HAS_ATTRIBUTE_a_color_4f
v_roughness_metallic_emissive_alpha.w=clamp(color_4f.a*v_roughness_metallic_emissive_alpha.w*(v_roughness_metallic_emissive_alpha.z-1.0),0.0,1.0);
#endif
#endif
#ifdef RENDER_SHADOWS
vec4 shadow_pos=u_node_matrix*vec4(local_pos,1.0);
#ifdef NORMAL_OFFSET
#ifdef HAS_ATTRIBUTE_a_normal_3f
#ifdef MODEL_POSITION_ON_GPU
vec3 offset=shadow_normal_offset(vec3(-normal_3f.xy,normal_3f.z));shadow_pos.xyz+=offset*shadow_normal_offset_multiplier0();
#else
vec3 offset=shadow_normal_offset_model(normal_3f);shadow_pos.xyz+=offset*shadow_normal_offset_multiplier0();
#endif
#endif
#endif
v_pos_light_view_0=u_light_matrix_0*shadow_pos;v_pos_light_view_1=u_light_matrix_1*shadow_pos;v_depth_shadows=gl_Position.w;
#endif
}`),modelDepth:gr(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,`in vec3 a_pos_3f;uniform mat4 u_matrix;out highp float v_depth;
#ifdef MODEL_POSITION_ON_GPU
#ifdef INSTANCED_ARRAYS
in vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;
#else
uniform highp mat4 u_instance;
#endif
uniform highp mat4 u_node_matrix;
#endif
void main() {
#ifdef MODEL_POSITION_ON_GPU
highp mat4 instance;
#ifdef INSTANCED_ARRAYS
instance=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);
#else
instance=u_instance;
#endif
vec3 pos_color=instance[0].xyz;vec4 translate=instance[1];vec3 pos_a=floor(pos_color);float hidden=float(pos_a.x > EXTENT);float meter_to_tile=instance[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);mat3 rs;rs[0].x=instance[1].w;rs[0].yz=instance[2].xy;rs[1].xy=instance[2].zw;rs[1].z=instance[3].x;rs[2].xyz=instance[3].yzw;vec4 pos_node=u_node_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;gl_Position=mix(u_matrix*pos,AWAY,hidden);
#else
gl_Position=u_matrix*vec4(a_pos_3f,1);
#endif
v_depth=gl_Position.z/gl_Position.w;}`),stars:gr(`in highp vec2 v_uv;in mediump float v_intensity;float shapeCircle(in vec2 uv)
{float beginFade=0.6;float lengthFromCenter=length(v_uv);return 1.0-clamp((lengthFromCenter-beginFade)/(1.0-beginFade),0.0,1.0);}void main() {float alpha=shapeCircle(v_uv);vec3 color=vec3(1.0,1.0,1.0);alpha*=v_intensity;glFragColor=vec4(color*alpha,alpha);HANDLE_WIREFRAME_DEBUG;}`,`
in vec3 a_pos_3f;in vec2 a_uv;in float a_size_scale;in float a_fade_opacity;uniform mat4 u_matrix;uniform vec3 u_up;uniform vec3 u_right;uniform float u_intensity_multiplier;out highp vec2 v_uv;out mediump float v_intensity;void main() {v_uv=a_uv;v_intensity=a_fade_opacity*u_intensity_multiplier;vec3 pos=a_pos_3f;pos+=a_uv.x*u_right*a_size_scale;pos+=a_uv.y*u_up*a_size_scale;gl_Position=u_matrix*vec4(pos,1.0);}`),snowParticle:gr("in highp vec2 uv;in highp float alphaMultiplier;uniform vec4 u_particleColor;uniform vec2 u_simpleShapeParameters;void main() {float t=clamp((length(uv)-u_simpleShapeParameters.x)/(1.0-u_simpleShapeParameters.x),0.0,1.0);float alpha=1.0-pow(t,pow(10.0,u_simpleShapeParameters.y));alpha*=alphaMultiplier;alpha*=u_particleColor.a;vec3 color=u_particleColor.rgb*alpha;glFragColor=vec4(color,alpha) ;HANDLE_WIREFRAME_DEBUG;}",`
in highp vec3 a_pos_3f;in highp vec2 a_uv;in highp vec4 a_snowParticleData;in highp vec4 a_snowParticleDataHorizontalOscillation;uniform mat4 u_modelview;uniform mat4 u_projection;uniform vec3 u_cam_pos;uniform vec2 u_screenSize;uniform float u_time;uniform float u_boxSize;uniform float u_velocityConeAperture; 
uniform float u_velocity;uniform vec3 u_direction;uniform float u_horizontalOscillationRadius; 
uniform float u_horizontalOscillationRate; 
uniform float u_billboardSize;uniform vec2 u_thinningCenterPos;uniform vec3 u_thinningShape;uniform float u_thinningAffectedRatio;uniform float u_thinningParticleOffset;out highp vec2 uv;out highp float alphaMultiplier;void main() {vec3 pos=a_pos_3f;float halfBoxSize=0.5*u_boxSize;pos.xyz*=halfBoxSize;pos+=u_cam_pos;float velocityConeApertureRad=radians(u_velocityConeAperture*0.5);float coneAnglePichRad=velocityConeApertureRad*a_snowParticleData.z;float coneAngleHeadingRad=a_snowParticleData.w*radians(360.0);vec3 localZ=normalize(u_direction);vec3 localX=normalize(cross(localZ,vec3(1,0,0)));vec3 localY=normalize(cross(localZ,localX));vec3 direction;direction.x=cos(coneAngleHeadingRad)*sin(coneAnglePichRad);direction.y=sin(coneAngleHeadingRad)*sin(coneAnglePichRad);direction.z=cos(coneAnglePichRad);direction=normalize(direction);vec3 simPosLocal=vec3(0,0,0);float velocityScale=(1.0+3.0*a_snowParticleData.y)*u_velocity;simPosLocal+=direction*velocityScale*u_time;float horizontalOscillationRadius=u_horizontalOscillationRadius*a_snowParticleDataHorizontalOscillation.x;float horizontalOscillationAngle=u_horizontalOscillationRate*u_time*(-1.0+2.0*a_snowParticleDataHorizontalOscillation.y);simPosLocal.xy+=horizontalOscillationRadius*vec2(cos(horizontalOscillationAngle),sin(horizontalOscillationAngle));vec3 simPos=localX*simPosLocal.x+
localY*simPosLocal.y+localZ*simPosLocal.z;pos+=simPos;pos=fract((pos+vec3(halfBoxSize))/vec3(u_boxSize))*u_boxSize-vec3(halfBoxSize);float clipZ=-u_cam_pos.z+pos.z;vec4 posView=u_modelview*vec4(pos,1.0);float size=u_billboardSize;alphaMultiplier=1.0;vec4 posScreen=u_projection*posView;posScreen/=posScreen.w;posScreen.xy=vec2(0.5)+posScreen.xy*0.5;posScreen.xy*=u_screenSize;vec2 thinningCenterPos=u_thinningCenterPos.xy;thinningCenterPos.y=u_screenSize.y-thinningCenterPos.y;float screenDist=length((thinningCenterPos-posScreen.xy)/(0.5*u_screenSize));screenDist+=a_snowParticleData.x*u_thinningParticleOffset;float scaleFactorMode=0.0;float thinningShapeDist=u_thinningShape.x+u_thinningShape.y;if (screenDist < thinningShapeDist) {float thinningFadeRatio=clamp((screenDist-u_thinningShape.x)/u_thinningShape.y,0.0,1.0);thinningFadeRatio=pow(thinningFadeRatio,u_thinningShape.z);if (a_snowParticleData.x < u_thinningAffectedRatio) {scaleFactorMode=1.0-thinningFadeRatio;alphaMultiplier=thinningFadeRatio;}}vec4 posScreen1=u_projection*vec4(posView.x-size,posView.yzw);posScreen1/=posScreen1.w;vec4 posScreen2=u_projection*vec4(posView.x+size,posView.yzw);posScreen2/=posScreen2.w;posScreen1.xy=vec2(0.5)+posScreen1.xy*0.5;posScreen1.xy*=u_screenSize;posScreen2.xy=vec2(0.5)+posScreen2.xy*0.5;posScreen2.xy*=u_screenSize;float screenLength=length(posScreen1.xy-posScreen2.xy);float screenEpsilon=3.0;float scaleFactor=1.0;if (screenLength < screenEpsilon) {scaleFactor=screenEpsilon/max(screenLength,0.01);scaleFactor=mix(scaleFactor,1.0,scaleFactorMode);}float screenEpsilon2=15.0;if (screenLength > screenEpsilon2) {scaleFactor=screenEpsilon2/max(screenLength,0.01);}size*=scaleFactor;vec2 right=size*vec2(1,0);vec2 up=size*vec2(0,1);posView.xy+=right*a_uv.x;posView.xy+=up*a_uv.y;uv=a_uv;gl_Position=u_projection*posView;}`),rainParticle:gr("in highp vec2 uv;in highp float particleRandomValue;uniform sampler2D u_texScreen;uniform float u_distortionStrength;uniform vec4 u_color;uniform vec2 u_thinningCenterPos;uniform vec3 u_thinningShape;uniform float u_thinningAffectedRatio;uniform float u_thinningParticleOffset;uniform float u_shapeDirectionalPower;uniform float u_mode;void main() {vec2 st=uv*0.5+vec2(0.5);vec2 uvm=uv;uvm.y=-1.0+2.0*pow(st.y,u_shapeDirectionalPower);float shape=clamp(1.0-length(uvm),0.0,1.0);float alpha=abs(shape)*u_color.a;vec2 screenSize=vec2(textureSize(u_texScreen,0));vec2 thinningCenterPos=u_thinningCenterPos.xy;thinningCenterPos.y=screenSize.y-thinningCenterPos.y;float screenDist=length((thinningCenterPos-gl_FragCoord.xy)/(0.5*screenSize));screenDist+=(0.5+0.5*particleRandomValue)*u_thinningParticleOffset;float thinningShapeDist=u_thinningShape.x+u_thinningShape.y;float thinningAlpha=1.0;if (screenDist < thinningShapeDist) {float thinningFadeRatio=clamp((screenDist-u_thinningShape.x)/u_thinningShape.y,0.0,1.0);thinningFadeRatio=pow(thinningFadeRatio,u_thinningShape.z);thinningAlpha*=thinningFadeRatio;}vec2 offsetXY=normalize(uvm)*abs(shape);vec2 stScreen=(gl_FragCoord.xy+offsetXY*u_distortionStrength*thinningAlpha)/screenSize;vec3 colorScreen=texture(u_texScreen,stScreen).rgb;alpha*=thinningAlpha;glFragColor=mix(vec4(colorScreen,1.0),vec4(u_color.rgb*alpha,alpha),u_mode);HANDLE_WIREFRAME_DEBUG;}",`
in highp vec3 a_pos_3f;in highp vec2 a_uv;in highp vec4 a_rainParticleData;uniform mat4 u_modelview;uniform mat4 u_projection;uniform vec3 u_cam_pos;uniform float u_time;uniform float u_boxSize;uniform float u_velocityConeAperture; 
uniform float u_velocity; 
uniform vec2 u_rainDropletSize;uniform vec3 u_rainDirection;out highp vec2 uv;out highp float particleRandomValue;void main() {vec3 pos=a_pos_3f;float halfBoxSize=0.5*u_boxSize;pos*=halfBoxSize; 
pos+=u_cam_pos;float velocityConeApertureRad=radians(u_velocityConeAperture*0.5);float coneAnglePichRad=velocityConeApertureRad*a_rainParticleData.z;float coneAngleHeadingRad=a_rainParticleData.w*radians(360.0);vec3 localZ=normalize(u_rainDirection);vec3 localX=normalize(cross(localZ,vec3(1,0,0)));vec3 localY=normalize(cross(localZ,localX));vec3 directionLocal;directionLocal.x=cos(coneAngleHeadingRad)*sin(coneAnglePichRad);directionLocal.y=sin(coneAngleHeadingRad)*sin(coneAnglePichRad);directionLocal.z=cos(coneAnglePichRad);directionLocal=normalize(directionLocal);vec3 directionWorld=localX*directionLocal.x+localY*directionLocal.y+localZ*directionLocal.z;float velocityScale=(1.0+3.0*a_rainParticleData.y)*u_velocity;vec3 simPosLocal=vec3(0,0,0);simPosLocal+=directionLocal*velocityScale*u_time;vec3 simPos=localX*simPosLocal.x+
localY*simPosLocal.y+localZ*simPosLocal.z;pos+=simPos;pos=fract((pos+vec3(halfBoxSize))/vec3(u_boxSize))*u_boxSize-vec3(halfBoxSize);vec4 posView=u_modelview*vec4(pos,1.0);vec3 directionView=normalize((u_modelview*vec4(directionWorld,0.0)).xyz);vec3 side=cross(directionView,normalize(posView.xyz));posView.xyz+=side*a_uv.x*u_rainDropletSize.x;posView.xyz+=directionView*a_uv.y*u_rainDropletSize.y;uv=a_uv;particleRandomValue=a_rainParticleData.x;gl_Position=u_projection*posView;}`),vignette:gr("uniform vec3 u_vignetteShape;uniform vec4 u_vignetteColor;in vec2 st;void main() {float screenDist=length(st);float alpha=clamp((screenDist-u_vignetteShape.x)/u_vignetteShape.y,0.0,1.0);alpha=pow(alpha,u_vignetteShape.z)*u_vignetteColor.a;vec3 color=u_vignetteColor.rgb;glFragColor=vec4(color*alpha,alpha) ;}","in vec2 a_pos_2f;out vec2 st;void main() {st=a_pos_2f;gl_Position=vec4(a_pos_2f,0,1);}"),occlusion:gr("uniform vec4 u_color;void main() {glFragColor=u_color;}",`#include "_prelude_terrain.vertex.glsl"
in highp vec2 a_offset_xy;uniform highp vec3 u_anchorPos;uniform mat4 u_matrix;uniform vec2 u_screenSizePx;uniform vec2 u_occluderSizePx;void main() {vec3 world_pos=u_anchorPos;
#ifdef TERRAIN
float e=elevation(world_pos.xy);world_pos.z+=e;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1.0);projected_point.xy+=projected_point.w*a_offset_xy*0.5*u_occluderSizePx/u_screenSizePx;gl_Position=projected_point;}`)};function rc(u,t){const o=u.replace(/\s*\/\/[^\n]*\n/g,`
`).split(`
`);for(let h of o)if(h=h.trim(),h[0]==="#"&&h.includes("if")&&!h.includes("endif")){h=h.replace("#","").replace(/ifdef|ifndef|elif|if/g,"").replace(/!|defined|\(|\)|\|\||&&/g,"").replace(/\s+/g," ").trim();const g=h.split(" ");for(const v of g)t.includes(v)||t.push(v)}}function gr(u,t){const o=/#include\s+"([^"]+)"/g,h=/#pragma mapbox: ([\w\-]+) ([\w]+) ([\w]+) ([\w]+)/g;let g=t.match(/(attribute(\S*)|(^\s*|;)in) (highp |mediump |lowp )?([\w]+) ([\w]+)/gm);g&&(g=g.map(D=>{const B=D.split(" ");return B[B.length-1]}),g=[...new Set(g)]);const v={},S=[],I=[];if(u=u.replace(o,(D,B)=>(I.push(B),"")),(t=t.replace(o,(D,B)=>(S.push(B),""))).includes("flat out"))return void console.error('The usage of "flat" qualifier is disallowed, see: https://bugs.webkit.org/show_bug.cgi?id=268071');let L=[...Sa];rc(u,L),rc(t,L);for(const D of[...S,...I])zl[D]||console.error(`Undefined include: ${D}`),Ll[D]||(Ll[D]=[],rc(zl[D],Ll[D])),L=[...L,...Ll[D]];return{fragmentSource:u=u.replace(h,(D,B,V,U,G)=>(v[G]=!0,B==="define"?`
#ifndef HAS_UNIFORM_u_${G}
in ${V} ${U} ${G};
#else
uniform ${V} ${U} u_${G};
#endif
`:B==="initialize"?`
#ifdef HAS_UNIFORM_u_${G}
    ${V} ${U} ${G} = u_${G};
#endif
`:B==="define-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${G}
    in ${V} ${U} ${G};
#endif
`:B==="initialize-attribute"?"":void 0)),vertexSource:t=t.replace(h,(D,B,V,U,G)=>{const re=U==="float"?"vec2":U,Q=G.match(/color/)?"color":re;return B==="define-attribute-vertex-shader-only"?`
#ifdef HAS_ATTRIBUTE_a_${G}
in ${V} ${U} a_${G};
#endif
`:v[G]?B==="define"?`
#ifndef HAS_UNIFORM_u_${G}
uniform lowp float u_${G}_t;
in ${V} ${re} a_${G};
out ${V} ${U} ${G};
#else
uniform ${V} ${U} u_${G};
#endif
`:B==="initialize"?Q==="vec4"?`
#ifndef HAS_UNIFORM_u_${G}
    ${G} = a_${G};
#else
    ${V} ${U} ${G} = u_${G};
#endif
`:`
#ifndef HAS_UNIFORM_u_${G}
    ${G} = unpack_mix_${Q}(a_${G}, u_${G}_t);
#else
    ${V} ${U} ${G} = u_${G};
#endif
`:B==="define-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${G}
    in ${V} ${U} a_${G};
    out ${V} ${U} ${G};
#endif
`:B==="initialize-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${G}
    ${G} = a_${G};
#endif
`:void 0:B==="define"?`
#ifndef HAS_UNIFORM_u_${G}
uniform lowp float u_${G}_t;
in ${V} ${re} a_${G};
#else
uniform ${V} ${U} u_${G};
#endif
`:B==="define-instanced"?Q==="mat4"?`
#ifdef INSTANCED_ARRAYS
in vec4 a_${G}0;
in vec4 a_${G}1;
in vec4 a_${G}2;
in vec4 a_${G}3;
#else
uniform ${V} ${U} u_${G};
#endif
`:`
#ifdef INSTANCED_ARRAYS
in ${V} ${re} a_${G};
#else
uniform ${V} ${U} u_${G};
#endif
`:B==="initialize-attribute-custom"?`
#ifdef HAS_ATTRIBUTE_a_${G}
    ${V} ${U} ${G} = a_${G};
#endif
`:Q==="vec4"?`
#ifndef HAS_UNIFORM_u_${G}
    ${V} ${U} ${G} = a_${G};
#else
    ${V} ${U} ${G} = u_${G};
#endif
`:`
#ifndef HAS_UNIFORM_u_${G}
    ${V} ${U} ${G} = unpack_mix_${Q}(a_${G}, u_${G}_t);
#else
    ${V} ${U} ${G} = u_${G};
#endif
`}),staticAttributes:g,usedDefines:L,vertexIncludes:S,fragmentIncludes:I}}class qc{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffers=[],this.vao=null}bind(t,o,h,g,v,S,I,L){this.context=t;let D=this.boundPaintVertexBuffers.length!==g.length;for(let V=0;!D&&V<g.length;V++)this.boundPaintVertexBuffers[V]!==g[V]&&(D=!0);let B=this.boundDynamicVertexBuffers.length!==I.length;for(let V=0;!B&&V<I.length;V++)this.boundDynamicVertexBuffers[V]!==I[V]&&(B=!0);if(!this.vao||this.boundProgram!==o||this.boundLayoutVertexBuffer!==h||D||B||this.boundIndexBuffer!==v||this.boundVertexOffset!==S)this.freshBind(o,h,g,v,S,I,L);else{t.bindVertexArrayOES.set(this.vao);for(const V of I)V&&(V.bind(),L&&V.instanceCount&&V.setVertexAttribDivisor(t.gl,o,L));v&&v.dynamicDraw&&v.bind()}}freshBind(t,o,h,g,v,S,I){const L=t.numAttributes,D=this.context,B=D.gl;this.vao&&this.destroy(),this.vao=D.gl.createVertexArray(),D.bindVertexArrayOES.set(this.vao),this.boundProgram=t,this.boundLayoutVertexBuffer=o,this.boundPaintVertexBuffers=h,this.boundIndexBuffer=g,this.boundVertexOffset=v,this.boundDynamicVertexBuffers=S,o.enableAttributes(B,t),o.bind(),o.setVertexAttribPointers(B,t,v);for(const V of h)V.enableAttributes(B,t),V.bind(),V.setVertexAttribPointers(B,t,v);for(const V of S)V&&(V.enableAttributes(B,t),V.bind(),V.setVertexAttribPointers(B,t,v),I&&V.instanceCount&&V.setVertexAttribDivisor(B,t,I));g&&g.bind(),D.currentNumAttributes=L}destroy(){this.vao&&(this.context.gl.deleteVertexArray(this.vao),this.vao=null)}}function Dd(u,t){const o=Math.pow(2,t.canonical.z),h=t.canonical.y;return[new r.aa(0,h/o).toLngLat().lat,new r.aa(0,(h+1)/o).toLngLat().lat]}function ic(u,t,o,h,g,v,S){const I=u.context,L=I.gl,D=o.hillshadeFBO;if(!D)return;u.prepareDrawTile();const B=u.isTileAffectedByFog(t),V=u.getOrCreateProgram("hillshade",{overrideFog:B});I.activeTexture.set(L.TEXTURE0),L.bindTexture(L.TEXTURE_2D,D.colorAttachment.get());const U=((ue,ce,ye,Ae)=>{const Ee=ye.paint.get("hillshade-shadow-color"),Fe=ye.paint.get("hillshade-shadow-color-use-theme").constantOr("default")==="none",ze=ye.paint.get("hillshade-highlight-color"),Oe=ye.paint.get("hillshade-highlight-color-use-theme").constantOr("default")==="none",ke=ye.paint.get("hillshade-accent-color"),Ge=ye.paint.get("hillshade-accent-color-use-theme").constantOr("default")==="none",Ze=ye.paint.get("hillshade-emissive-strength");let ft=r.ai(ye.paint.get("hillshade-illumination-direction"));if(ye.paint.get("hillshade-illumination-anchor")==="viewport")ft-=ue.transform.angle;else if(ue.style&&ue.style.enable3dLights()&&ue.style.directionalLight){const We=ue.style.directionalLight.properties.get("direction"),tt=r.cb(We.x,We.y,We.z);ft=r.ai(tt[1])}const ct=!ue.options.moving;return{u_matrix:Ae||ue.transform.calculateProjMatrix(ce.tileID.toUnwrapped(),ct),u_image:0,u_latrange:Dd(0,ce.tileID),u_light:[ye.paint.get("hillshade-exaggeration"),ft],u_shadow:Ee.toRenderColor(Fe?null:ye.lut),u_highlight:ze.toRenderColor(Oe?null:ye.lut),u_emissive_strength:Ze,u_accent:ke.toRenderColor(Ge?null:ye.lut)}})(u,o,h,u.terrain?t.projMatrix:null);u.uploadCommonUniforms(I,V,t.toUnwrapped());const{tileBoundsBuffer:G,tileBoundsIndexBuffer:re,tileBoundsSegments:Q}=u.getTileBoundsBuffers(o);V.draw(u,L.TRIANGLES,g,v,S,Wn.disabled,U,h.id,G,re,Q)}function rh(u,t,o){if(!t.needsDEMTextureUpload)return;const h=u.context,g=h.gl;h.pixelStoreUnpackPremultiplyAlpha.set(!1),t.demTexture=t.demTexture||u.getTileTexture(o.stride);const v=o.getPixels();t.demTexture?t.demTexture.update(v,{premultiply:!1}):t.demTexture=new r.T(h,v,g.R32F,{premultiply:!1}),t.needsDEMTextureUpload=!1}function Sc(u,t,o){const h=u.context,g=h.gl;if(!t.dem)return;const v=t.dem;if(h.activeTexture.set(g.TEXTURE1),rh(u,t,v),!t.demTexture)return;t.demTexture.bind(g.NEAREST,g.CLAMP_TO_EDGE);const S=v.dim;h.activeTexture.set(g.TEXTURE0);let I=t.hillshadeFBO;if(!I){const U=new r.T(h,{width:S,height:S,data:null},g.RGBA8);U.bind(g.LINEAR,g.CLAMP_TO_EDGE),I=t.hillshadeFBO=h.createFramebuffer(S,S,!0,"renderbuffer"),I.colorAttachment.set(U.texture)}h.bindFramebuffer.set(I.framebuffer),h.viewport.set([0,0,S,S]);const{tileBoundsBuffer:L,tileBoundsIndexBuffer:D,tileBoundsSegments:B}=u.getMercatorTileBoundsBuffers(),V=[];u.linearFloatFilteringSupported()&&V.push("TERRAIN_DEM_FLOAT_FORMAT"),u.getOrCreateProgram("hillshadePrepare",{defines:V}).draw(u,g.TRIANGLES,Dn.disabled,or.disabled,Sr.unblended,Wn.disabled,((U,G)=>{const re=G.stride,Q=r.ab.mat4.create();return r.ab.mat4.ortho(Q,0,r.ag,-r.ag,0,0,1),r.ab.mat4.translate(Q,Q,[0,-r.ag,0]),{u_matrix:Q,u_image:1,u_dimension:[re,re],u_zoom:U.overscaledZ}})(t.tileID,v),o.id,L,D,B),t.needsHillshadePrepare=!1}class Li{constructor(t){this.gl=t.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(t){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class Mp extends Li{getDefault(){return r.aj.transparent}set(t){const o=this.current;(t.r!==o.r||t.g!==o.g||t.b!==o.b||t.a!==o.a||this.dirty)&&(this.gl.clearColor(t.r,t.g,t.b,t.a),this.current=t,this.dirty=!1)}}class ih extends Li{getDefault(){return 1}set(t){(t!==this.current||this.dirty)&&(this.gl.clearDepth(t),this.current=t,this.dirty=!1)}}class Ap extends Li{getDefault(){return 0}set(t){(t!==this.current||this.dirty)&&(this.gl.clearStencil(t),this.current=t,this.dirty=!1)}}class Pu extends Li{getDefault(){return[!0,!0,!0,!0]}set(t){const o=this.current;(t[0]!==o[0]||t[1]!==o[1]||t[2]!==o[2]||t[3]!==o[3]||this.dirty)&&(this.gl.colorMask(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class Zc extends Li{getDefault(){return!0}set(t){(t!==this.current||this.dirty)&&(this.gl.depthMask(t),this.current=t,this.dirty=!1)}}class Qi extends Li{getDefault(){return 255}set(t){(t!==this.current||this.dirty)&&(this.gl.stencilMask(t),this.current=t,this.dirty=!1)}}class Ru extends Li{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(t){const o=this.current;(t.func!==o.func||t.ref!==o.ref||t.mask!==o.mask||this.dirty)&&(this.gl.stencilFunc(t.func,t.ref,t.mask),this.current=t,this.dirty=!1)}}class oc extends Li{getDefault(){const t=this.gl;return[t.KEEP,t.KEEP,t.KEEP]}set(t){const o=this.current;(t[0]!==o[0]||t[1]!==o[1]||t[2]!==o[2]||this.dirty)&&(this.gl.stencilOp(t[0],t[1],t[2]),this.current=t,this.dirty=!1)}}class Ec extends Li{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const o=this.gl;t?o.enable(o.STENCIL_TEST):o.disable(o.STENCIL_TEST),this.current=t,this.dirty=!1}}class Rf extends Li{getDefault(){return[0,1]}set(t){const o=this.current;(t[0]!==o[0]||t[1]!==o[1]||this.dirty)&&(this.gl.depthRange(t[0],t[1]),this.current=t,this.dirty=!1)}}class Xc extends Li{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const o=this.gl;t?o.enable(o.DEPTH_TEST):o.disable(o.DEPTH_TEST),this.current=t,this.dirty=!1}}class sc extends Li{getDefault(){return this.gl.LESS}set(t){(t!==this.current||this.dirty)&&(this.gl.depthFunc(t),this.current=t,this.dirty=!1)}}class ml extends Li{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const o=this.gl;t?o.enable(o.BLEND):o.disable(o.BLEND),this.current=t,this.dirty=!1}}class _s extends Li{getDefault(){const t=this.gl;return[t.ONE,t.ZERO,t.ONE,t.ZERO]}set(t){const o=this.current;(t[0]!==o[0]||t[1]!==o[1]||t[2]!==o[2]||t[3]!==o[3]||this.dirty)&&(this.gl.blendFuncSeparate(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class Gh extends Li{getDefault(){return r.aj.transparent}set(t){const o=this.current;(t.r!==o.r||t.g!==o.g||t.b!==o.b||t.a!==o.a||this.dirty)&&(this.gl.blendColor(t.r,t.g,t.b,t.a),this.current=t,this.dirty=!1)}}class Yc extends Li{getDefault(){return this.gl.FUNC_ADD}set(t){(t!==this.current||this.dirty)&&(this.gl.blendEquationSeparate(t,t),this.current=t,this.dirty=!1)}}class ku extends Li{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const o=this.gl;t?o.enable(o.CULL_FACE):o.disable(o.CULL_FACE),this.current=t,this.dirty=!1}}class qh extends Li{getDefault(){return this.gl.BACK}set(t){(t!==this.current||this.dirty)&&(this.gl.cullFace(t),this.current=t,this.dirty=!1)}}class Kc extends Li{getDefault(){return this.gl.CCW}set(t){(t!==this.current||this.dirty)&&(this.gl.frontFace(t),this.current=t,this.dirty=!1)}}let Jc=class extends Li{getDefault(){return null}set(u){(u!==this.current||this.dirty)&&(this.gl.useProgram(u),this.current=u,this.dirty=!1)}};class Ol extends Li{getDefault(){return this.gl.TEXTURE0}set(t){(t!==this.current||this.dirty)&&(this.gl.activeTexture(t),this.current=t,this.dirty=!1)}}class Qc extends Li{getDefault(){const t=this.gl;return[0,0,t.drawingBufferWidth,t.drawingBufferHeight]}set(t){const o=this.current;(t[0]!==o[0]||t[1]!==o[1]||t[2]!==o[2]||t[3]!==o[3]||this.dirty)&&(this.gl.viewport(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class eu extends Li{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const o=this.gl;o.bindFramebuffer(o.FRAMEBUFFER,t),this.current=t,this.dirty=!1}}class Zh extends Li{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const o=this.gl;o.bindRenderbuffer(o.RENDERBUFFER,t),this.current=t,this.dirty=!1}}class kf extends Li{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const o=this.gl;o.bindTexture(o.TEXTURE_2D,t),this.current=t,this.dirty=!1}}class tu extends Li{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const o=this.gl;o.bindBuffer(o.ARRAY_BUFFER,t),this.current=t,this.dirty=!1}}class oh extends Li{getDefault(){return null}set(t){const o=this.gl;o.bindBuffer(o.ELEMENT_ARRAY_BUFFER,t),this.current=t,this.dirty=!1}}class nu extends Li{getDefault(){return null}set(t){this.gl&&(t!==this.current||this.dirty)&&(this.gl.bindVertexArray(t),this.current=t,this.dirty=!1)}}class Fd extends Li{getDefault(){return 4}set(t){if(t===this.current&&!this.dirty)return;const o=this.gl;o.pixelStorei(o.UNPACK_ALIGNMENT,t),this.current=t,this.dirty=!1}}class Tc extends Li{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const o=this.gl;o.pixelStorei(o.UNPACK_PREMULTIPLY_ALPHA_WEBGL,t),this.current=t,this.dirty=!1}}class zf extends Li{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const o=this.gl;o.pixelStorei(o.UNPACK_FLIP_Y_WEBGL,t),this.current=t,this.dirty=!1}}class Cc extends Li{constructor(t,o){super(t),this.context=t,this.parent=o}getDefault(){return null}}class Ha extends Cc{setDirty(){this.dirty=!0}set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const o=this.gl;o.framebufferTexture2D(o.FRAMEBUFFER,o.COLOR_ATTACHMENT0,o.TEXTURE_2D,t,0),this.current=t,this.dirty=!1}}class Mc extends Cc{attachment(){return this.gl.DEPTH_ATTACHMENT}set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const o=this.gl;o.framebufferRenderbuffer(o.FRAMEBUFFER,this.attachment(),o.RENDERBUFFER,t),this.current=t,this.dirty=!1}}class Dl extends Cc{attachment(){return this.gl.DEPTH_ATTACHMENT}set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const o=this.gl;o.framebufferTexture2D(o.FRAMEBUFFER,this.attachment(),o.TEXTURE_2D,t,0),this.current=t,this.dirty=!1}}class Ac extends Mc{attachment(){return this.gl.DEPTH_STENCIL_ATTACHMENT}}const Bd=(u,t,o)=>({u_matrix:u,u_image0:0,u_skirt_height:t,u_ground_shadow_factor:o}),Nd=(u,t,o,h,g,v,S,I,L,D,B,V,U,G,re,Q)=>({u_proj_matrix:Float32Array.from(u),u_globe_matrix:t,u_normalize_matrix:Float32Array.from(h),u_merc_matrix:o,u_zoom_transition:g,u_merc_center:v,u_image0:0,u_frustum_tl:S,u_frustum_tr:I,u_frustum_br:L,u_frustum_bl:D,u_globe_pos:B,u_globe_radius:V,u_viewport:U,u_grid_matrix:Q?Float32Array.from(Q):new Float32Array(9),u_skirt_height:G,u_far_z_cutoff:re});function Fl(u,t){return u!=null&&t!=null&&!(!u.hasData()||!t.hasData())&&u.demTexture!=null&&t.demTexture!=null&&u.tileID.key!==t.tileID.key}const ca=new class{constructor(){this.operations={}}newMorphing(u,t,o,h,g){if(u in this.operations){const v=this.operations[u];v.to.tileID.key!==o.tileID.key&&(v.queued=o)}else this.operations[u]={startTime:h,phase:0,duration:g,from:t,to:o,queued:null}}getMorphValuesForProxy(u){if(!(u in this.operations))return null;const t=this.operations[u];return{from:t.from,to:t.to,phase:t.phase}}update(u){for(const t in this.operations){const o=this.operations[t];for(o.phase=(u-o.startTime)/o.duration;o.phase>=1||!this._validOp(o);)if(!this._nextOp(o,u)){delete this.operations[t];break}}}_nextOp(u,t){return!!u.queued&&(u.from=u.to,u.to=u.queued,u.queued=null,u.phase=0,u.startTime=t,!0)}_validOp(u){return u.from.hasData()&&u.to.hasData()}},ua={0:null,1:"TERRAIN_VERTEX_MORPHING"};function Wa(u,t,o){if(t===0)return 0;const h=t<1&&o===514?.25/t:1;return 6*Math.pow(1.5,22-u)*Math.max(t,1)*h}function gl(u,t){const o=1<<u.z;return!t&&(u.x===0||u.x===o-1)||u.y===0||u.y===o-1}const Ga=u=>({u_matrix:u});function ha(u,t,o,h,g){if(g>0){const v=r.q.now(),S=(v-u.timeAdded)/g,I=t?(v-t.timeAdded)/g:-1,L=o.getSource(),D=h.coveringZoomLevel({tileSize:L.tileSize,roundZoom:L.roundZoom}),B=!t||Math.abs(t.tileID.overscaledZ-D)>Math.abs(u.tileID.overscaledZ-D),V=B&&u.refreshedUponExpiration?1:r.aw(B?S:1-I,0,1);return u.refreshedUponExpiration&&S>=1&&(u.refreshedUponExpiration=!1),t?{opacity:1,mix:1-V}:{opacity:V,mix:0}}return{opacity:1,mix:0}}class eo extends Ls{constructor(t){const o={type:"raster-dem",maxzoom:t.transform.maxZoom},h=new r.D(r.ci(),null),g=tl("mock-dem",o,h,t.style);super("mock-dem",g,!1),g.setEventedParent(this),this._sourceLoaded=!0}_loadTile(t,o){t.state="loaded",o(null)}}class to extends Ls{constructor(t){const o=tl("proxy",{type:"geojson",maxzoom:t.transform.maxZoom},new r.D(r.ci(),null),t.style);super("proxy",o,!1),o.setEventedParent(this),this.map=this.getSource().map=t,this.used=this._sourceLoaded=!0,this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}update(t,o,h){if(t.freezeTileCoverage)return;this.transform=t;const g=t.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}).reduce((v,S)=>{if(v[S.key]="",!this._tiles[S.key]){const I=new As(S,this._source.tileSize*S.overscaleFactor(),t.tileZoom);I.state="loaded",this._tiles[S.key]=I}return v},{});for(const v in this._tiles)v in g||(this.freeFBO(v),this._tiles[v].unloadVectorData(),delete this._tiles[v])}freeFBO(t){const o=this.proxyCachedFBO[t];if(o!==void 0){const h=Object.values(o);this.renderCachePool.push(...h),delete this.proxyCachedFBO[t]}}deallocRenderCache(){this.renderCache.forEach(t=>t.fb.destroy()),this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}}class Ea extends r.aG{constructor(t,o,h){super(t.overscaledZ,t.wrap,t.canonical.z,t.canonical.x,t.canonical.y),this.proxyTileKey=o,this.projMatrix=h}}class ys extends r.cJ{constructor(t,o){super(),this._debugParams={sortTilesHiZFirst:!0,disableRenderCache:!1},t.tp.registerParameter(this._debugParams,["Terrain"],"sortTilesHiZFirst",{},()=>{this._style.map.triggerRepaint()}),t.tp.registerParameter(this._debugParams,["Terrain"],"disableRenderCache",{},()=>{this._style.map.triggerRepaint()}),t.tp.registerButton(["Terrain"],"Invalidate Render Cache",()=>{this.invalidateRenderCache=!0,this._style.map.triggerRepaint()}),this.painter=t,this.terrainTileForTile={},this.prevTerrainTileForTile={};const[h,g,v]=function(L){const D=new r.b4,B=new r.aU,V=131;D.reserve(17161),B.reserve(33800);const U=r.ag/128,G=r.ag+U/2,re=G+U;for(let ue=-U;ue<re;ue+=U)for(let ce=-U;ce<re;ce+=U){const ye=ce<0||ce>G||ue<0||ue>G?24575:0,Ae=r.aw(Math.round(ce),0,r.ag),Ee=r.aw(Math.round(ue),0,r.ag);D.emplaceBack(Ae+ye,Ee)}const Q=(ue,ce)=>{const ye=ce*V+ue;B.emplaceBack(ye+1,ye,ye+V),B.emplaceBack(ye+V,ye+V+1,ye+1)};for(let ue=1;ue<129;ue++)for(let ce=1;ce<129;ce++)Q(ce,ue);return[0,129].forEach(ue=>{for(let ce=0;ce<130;ce++)Q(ce,ue),Q(ue,ce)}),[D,B,32768]}(),S=t.context;this.gridBuffer=S.createVertexBuffer(h,r.b6.members),this.gridIndexBuffer=S.createIndexBuffer(g),this.gridSegments=r.b7.simpleSegment(0,0,h.length,g.length),this.gridNoSkirtSegments=r.b7.simpleSegment(0,0,h.length,v),this.proxyCoords=[],this.proxiedCoords={},this._visibleDemTiles=[],this._drapedRenderBatches=[],this._sourceTilesOverlap={},this.proxySourceCache=new to(o.map),this.orthoMatrix=r.ab.mat4.create(),r.ab.mat4.ortho(this.orthoMatrix,this.painter.transform.projection.name==="globe"?.015:0,r.ag,0,r.ag,0,1);const I=S.gl;this._overlapStencilMode=new or({func:I.GEQUAL,mask:255},0,255,I.KEEP,I.KEEP,I.REPLACE),this._previousZoom=t.transform.zoom,this.pool=[],this._findCoveringTileCache={},this._tilesDirty={},this.style=o,this._useVertexMorphing=!0,this._exaggeration=1,this._mockSourceCache=new eo(o.map),this._pendingGroundEffectLayers=[]}set style(t){t.on("data",this._onStyleDataEvent.bind(this)),this._style=t,this._style.map.on("moveend",()=>{this._clearLineLayersFromRenderCache()})}update(t,o,h){if(t&&t.terrain){this._style!==t&&(this.style=t,this._evaluationZoom=void 0);const g=t.terrain.properties,v=t.terrain.drapeRenderMode===0,S=t.terrain.isZoomDependent();this._previousUpdateTimestamp=this.enabled?this._updateTimestamp:void 0,this._updateTimestamp=r.q.now();const I=t.terrain&&t.terrain.scope,L=g.get("source"),D=v?this._mockSourceCache:t.getSourceCache(L,I);if(!D)return void r.w(`Couldn't find terrain source "${L}".`);if(this.sourceCache=D,this._attenuationRange=t.terrain.getAttenuationRange(),this._exaggeration=S?this.calculateExaggeration(o):g.get("exaggeration"),!o.projection.requiresDraping&&S&&this._exaggeration===0)return void this._disable();this.enabled=!0;const B=()=>{this.sourceCache.used&&r.w(`Raster DEM source '${this.sourceCache.id}' is used both for terrain and as layer source.
This leads to lower resolution of hillshade. For full hillshade resolution but higher memory consumption, define another raster DEM source.`);const V=this.getScaledDemTileSize();this.sourceCache.update(o,V,!0),this.resetTileLookupCache(this.sourceCache.id)};this.sourceCache.usedForTerrain||(this.resetTileLookupCache(this.sourceCache.id),this.sourceCache.usedForTerrain=!0,B(),this._initializing=!0),B(),o.updateElevation(!0,h),this.resetTileLookupCache(this.proxySourceCache.id),this.proxySourceCache.update(o),this._emptyDEMTextureDirty=!0,this._previousZoom=o.zoom}else this._disable()}calculateExaggeration(t){if(this._attenuationRange&&t.zoom>=Math.ceil(this._attenuationRange[1]))return this._style.terrain.getExaggeration(t.zoom);const o=this._previousCameraAltitude,h=t.getFreeCameraOptions().position.z/t.pixelsPerMeter*t.worldSize;this._previousCameraAltitude=h;const g=o!=null?h-o:Number.MAX_VALUE;if(Math.abs(g)<2)return this._exaggeration;const v=t.zoom,S=this._style.terrain;if(!this._previousUpdateTimestamp)return S.getExaggeration(v);let I=v-this._previousZoom;const L=this._previousUpdateTimestamp;let D=v;this._evaluationZoom!=null&&(D=this._evaluationZoom,Math.abs(v-D)>.5&&(I=.5*(v-D+I)),I*g<0&&(D+=I)),this._evaluationZoom=D;const B=S.getExaggeration(D),V=B===S.getExaggeration(Math.max(0,D-.1));if(V&&Math.abs(B-this._exaggeration)<.01)return B;let U=Math.min(.1,.00375*(this._updateTimestamp-L));return(V||B<.1||Math.abs(I)<1e-4)&&(U=Math.min(.2,4*U)),r.af(this._exaggeration,B,U)}resetTileLookupCache(t){this._findCoveringTileCache[t]={}}attenuationRange(){return this._attenuationRange}getDemUpscale(){return this.proxySourceCache.getSource().tileSize/128}getScaledDemTileSize(){return this.sourceCache.getSource().tileSize/128*this.proxySourceCache.getSource().tileSize}_onStyleDataEvent(t){t.coord&&t.dataType==="source"?this._clearRenderCacheForTile(t.sourceCacheId,t.coord):t.dataType==="style"&&(this.invalidateRenderCache=!0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this._previousCameraAltitude=void 0)}_disable(){if(this.enabled&&(this.enabled=!1,this._emptyDEMTextureDirty=!0,this._sharedDepthStencil=void 0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this.proxySourceCache.deallocRenderCache(),this._style))for(const t in this._style._mergedSourceCaches)this._style._mergedSourceCaches[t].usedForTerrain=!1}destroy(){this._disable(),this._emptyDEMTexture&&this._emptyDEMTexture.destroy(),this.pool.forEach(t=>t.fb.destroy()),this.pool=[],this.framebufferCopyTexture&&this.framebufferCopyTexture.destroy()}_source(){return this.enabled?this.sourceCache:null}isUsingMockSource(){return this.sourceCache===this._mockSourceCache}exaggeration(){return this.enabled?this._exaggeration:0}get visibleDemTiles(){return this._visibleDemTiles}get drapeBufferSize(){const t=2*this.proxySourceCache.getSource().tileSize;return[t,t]}set useVertexMorphing(t){this._useVertexMorphing=t}updateTileBinding(t){if(!this.enabled)return;this.prevTerrainTileForTile=this.terrainTileForTile;const o=this.proxySourceCache,h=this.painter.transform;this._initializing&&(this._initializing=h._centerAltitude===0&&this.getAtPointOrZero(r.aa.fromLngLat(h.center),-1)===-1,this._emptyDEMTextureDirty=!this._initializing);const g=this.proxyCoords=o.getIds().map(L=>{const D=o.getTileByID(L).tileID;return D.projMatrix=h.calculateProjMatrix(D.toUnwrapped()),D});(function(L,D){const B=D.transform.pointCoordinate(D.transform.getCameraPoint()),V=new r.P(B.x,B.y);L.sort((U,G)=>{if(G.overscaledZ-U.overscaledZ)return G.overscaledZ-U.overscaledZ;const re=new r.P(U.canonical.x+(1<<U.canonical.z)*U.wrap,U.canonical.y),Q=new r.P(G.canonical.x+(1<<G.canonical.z)*G.wrap,G.canonical.y),ue=V.mult(1<<U.canonical.z);return ue.x-=.5,ue.y-=.5,ue.distSqr(re)-ue.distSqr(Q)})})(g,this.painter);const v=this.proxyToSource||{};this.proxyToSource={},g.forEach(L=>{this.proxyToSource[L.key]={}}),this.terrainTileForTile={};const S=this._style._mergedSourceCaches;for(const L in S){const D=S[L];if(!D.used||(D!==this.sourceCache&&this.resetTileLookupCache(D.id),this._setupProxiedCoordsForOrtho(D,t[L],v),D.usedForTerrain))continue;const B=t[L];D.getSource().reparseOverscaled&&this._assignTerrainTiles(B)}this.proxiedCoords[o.id]=g.map(L=>new Ea(L,L.key,this.orthoMatrix)),this._assignTerrainTiles(g),this._prepareDEMTextures(),this._setupDrapedRenderBatches(),this._initFBOPool(),this._setupRenderCache(v),this.renderingToTexture=!1;const I={};this._visibleDemTiles=[];for(const L of this.proxyCoords){const D=this.terrainTileForTile[L.key];if(!D)continue;const B=D.tileID.key;B in I||(this._visibleDemTiles.push(D),I[B]=B)}}_assignTerrainTiles(t){this._initializing||t.forEach(o=>{if(this.terrainTileForTile[o.key])return;const h=this._findTileCoveringTileID(o,this.sourceCache);h&&(this.terrainTileForTile[o.key]=h)})}_prepareDEMTextures(){const t=this.painter.context,o=t.gl;for(const h in this.terrainTileForTile){const g=this.terrainTileForTile[h],v=g.dem;!v||g.demTexture&&!g.needsDEMTextureUpload||(t.activeTexture.set(o.TEXTURE1),rh(this.painter,g,v))}}_prepareDemTileUniforms(t,o,h,g){if(!o||o.demTexture==null)return!1;const v=t.tileID.canonical,S=Math.pow(2,o.tileID.canonical.z-v.z),I=g||"";return h[`u_dem_tl${I}`]=[v.x*S%1,v.y*S%1],h[`u_dem_scale${I}`]=S,!0}get emptyDEMTexture(){return!this._emptyDEMTextureDirty&&this._emptyDEMTexture?this._emptyDEMTexture:this._updateEmptyDEMTexture()}_getLoadedAreaMinimum(){if(!this.enabled)return 0;let t=0;const o=this._visibleDemTiles.reduce((h,g)=>{if(!g.dem)return h;const v=g.dem.tree.minimums[0];return v>0&&t++,h+v},0);return t?o/t:0}_updateEmptyDEMTexture(){const t=this.painter.context,o=t.gl;t.activeTexture.set(o.TEXTURE2);const h=this._getLoadedAreaMinimum(),g=new r.cK({width:1,height:1},new Float32Array([h]));this._emptyDEMTextureDirty=!1;let v=this._emptyDEMTexture;return v?v.update(g,{premultiply:!1}):v=this._emptyDEMTexture=new r.T(t,g,o.R32F,{premultiply:!1}),v}setupElevationDraw(t,o,h){const g=this.painter.context,v=g.gl,S={u_dem:2,u_dem_prev:4,u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_depth_range_unpack:[0,1],u_occluder_half_size:16,u_occlusion_depth_offset:-1e-4,u_exaggeration:0};S.u_exaggeration=this.exaggeration();let I=null,L=null,D=1;if(h&&h.morphing&&this._useVertexMorphing){const G=h.morphing.srcDemTile,re=h.morphing.dstDemTile;D=h.morphing.phase,G&&re&&(this._prepareDemTileUniforms(t,G,S,"_prev")&&(L=G),this._prepareDemTileUniforms(t,re,S)&&(I=re))}const B=G=>G&&G.demTexture&&this.painter.linearFloatFilteringSupported()?v.LINEAR:v.NEAREST;let V=null;var U;if(this.enabled?L&&I?(V=I.demTexture,g.activeTexture.set(v.TEXTURE4),L.demTexture.bind(B(L),v.CLAMP_TO_EDGE),S.u_dem_lerp=D):(I=this.terrainTileForTile[t.tileID.key],V=this._prepareDemTileUniforms(t,I,S)?I.demTexture:this.emptyDEMTexture):V=this.emptyDEMTexture,g.activeTexture.set(v.TEXTURE2),V&&(S.u_dem_size=(U=V).size[0]===1?1:U.size[0]-2,V.bind(B(I),v.CLAMP_TO_EDGE)),this.painter.setupDepthForOcclusion(h&&h.useDepthForOcclusion,o,S),h&&h.useMeterToDem&&I){const G=(1<<I.tileID.canonical.z)*r.bH(1,this.painter.transform.center.lat)*this.sourceCache.getSource().tileSize;S.u_meter_to_dem=G}if(h&&h.labelPlaneMatrixInv&&(S.u_label_plane_matrix_inv=h.labelPlaneMatrixInv),o.setTerrainUniformValues(g,S),this.painter.transform.projection.name==="globe"){const G=this.globeUniformValues(this.painter.transform,t.tileID.canonical,h&&h.useDenormalizedUpVectorScale);o.setGlobeUniformValues(g,G)}}globeUniformValues(t,o,h){const g=t.projection;return{u_tile_tl_up:g.upVector(o,0,0),u_tile_tr_up:g.upVector(o,r.ag,0),u_tile_br_up:g.upVector(o,r.ag,r.ag),u_tile_bl_up:g.upVector(o,0,r.ag),u_tile_up_scale:h?r.cL(1):g.upVectorScale(o,t.center.lat,t.worldSize).metersToTile}}renderToBackBuffer(t){const o=this.painter,h=this.painter.context;t.length!==0&&(h.bindFramebuffer.set(null),h.viewport.set([0,0,o.width,o.height]),o.gpuTimingDeferredRenderStart(),this.renderingToTexture=!1,function(g,v,S,I,L){if(g.transform.projection.name==="globe")(function(D,B,V,U,G){const re=D.context,Q=re.gl;let ue,ce;const ye=D.transform,Ae=r.cC(D,re,ye),Ee=(We,tt)=>{if(ce===tt)return;const zt=[ua[tt],"PROJECTION_GLOBE_VIEW"];Ae&&zt.push("CUSTOM_ANTIALIASING");const Gt=D.isTileAffectedByFog(We);ue=D.getOrCreateProgram("globeRaster",{defines:zt,overrideFog:Gt}),ce=tt},Fe=D.colorModeForRenderPass(),ze=new Dn(Q.LEQUAL,Dn.ReadWrite,D.depthRangeFor3D);ca.update(G);const Oe=r.cD(ye),ke=[r.at(ye.center.lng),r.aA(ye.center.lat)],Ge=D.globeSharedBuffers,Ze=[ye.width*r.q.devicePixelRatio,ye.height*r.q.devicePixelRatio],ft=Float32Array.from(ye.globeMatrix),ct={useDenormalizedUpVectorScale:!0};{const We=D.transform,tt=Wa(We.zoom,B.exaggeration(),B.sourceCache._source.tileSize);ce=-1;const zt=Q.TRIANGLES;for(const Gt of U){const Yt=V.getTile(Gt),dt=or.disabled,Ft=B.prevTerrainTileForTile[Gt.key],Et=B.terrainTileForTile[Gt.key];Fl(Ft,Et)&&ca.newMorphing(Gt.key,Ft,Et,G,250),re.activeTexture.set(Q.TEXTURE0),Yt.texture&&Yt.texture.bind(Q.LINEAR,Q.CLAMP_TO_EDGE);const rn=ca.getMorphValuesForProxy(Gt.key),Vt=rn?1:0;rn&&r.J(ct,{morphing:{srcDemTile:rn.from,dstDemTile:rn.to,phase:r.cB(rn.phase)}});const kt=r.cE(Gt.canonical),_n=r.cF(kt.getCenter().lat),gn=r.cG(Gt.canonical,kt,_n,We.worldSize/We._pixelsPerMercatorPixel),ln=r.bb(r.cH(Gt.canonical)),xn=Nd(We.expandedFarZProjMatrix,ft,Oe,ln,r.ae(We.zoom),ke,We.frustumCorners.TL,We.frustumCorners.TR,We.frustumCorners.BR,We.frustumCorners.BL,We.globeCenterInViewSpace,We.globeRadius,Ze,tt,We._farZ,gn);if(Ee(Gt,Vt),ue&&(B.setupElevationDraw(Yt,ue,ct),D.uploadCommonUniforms(re,ue,Gt.toUnwrapped()),Ge)){const[tr,Ln,Fn]=Ge.getGridBuffers(_n,tt!==0);ue.draw(D,zt,ze,dt,Fe,Wn.backCCW,xn,"globe_raster",tr,Ln,Fn)}}}if(Ge&&(D.renderDefaultNorthPole||D.renderDefaultSouthPole)){const We=["GLOBE_POLES","PROJECTION_GLOBE_VIEW"];Ae&&We.push("CUSTOM_ANTIALIASING"),ue=D.getOrCreateProgram("globeRaster",{defines:We});for(const tt of U){const{x:zt,y:Gt,z:Yt}=tt.canonical,dt=Gt===0,Ft=Gt===(1<<Yt)-1,[Et,rn,Vt,kt]=Ge.getPoleBuffers(Yt,!1);if(kt&&(dt||Ft)){const _n=V.getTile(tt);re.activeTexture.set(Q.TEXTURE0),_n.texture&&_n.texture.bind(Q.LINEAR,Q.CLAMP_TO_EDGE);let gn=r.cI(Yt,zt,ye);const ln=r.bb(r.cH(tt.canonical)),xn=(tr,Ln)=>tr.draw(D,Q.TRIANGLES,ze,or.disabled,Fe,Wn.disabled,Nd(ye.expandedFarZProjMatrix,gn,gn,ln,0,ke,ye.frustumCorners.TL,ye.frustumCorners.TR,ye.frustumCorners.BR,ye.frustumCorners.BL,ye.globeCenterInViewSpace,ye.globeRadius,Ze,0,ye._farZ),"globe_pole_raster",Ln,Vt,kt);B.setupElevationDraw(_n,ue,ct),D.uploadCommonUniforms(re,ue,tt.toUnwrapped()),dt&&D.renderDefaultNorthPole&&xn(ue,Et),Ft&&D.renderDefaultSouthPole&&(gn=r.ab.mat4.scale(r.ab.mat4.create(),gn,[1,-1,1]),xn(ue,rn))}}}})(g,v,S,I,L);else{const D=g.context,B=D.gl;let V,U;const G=g.shadowRenderer,re=ul(g,g.longestCutoffRange),Q=Fe=>{if(U===Fe)return;const ze=[];ze.push(ua[Fe]),re.shouldRenderCutoff&&ze.push("RENDER_CUTOFF"),G&&(ze.push("RENDER_SHADOWS","DEPTH_TEXTURE"),G.useNormalOffset&&ze.push("NORMAL_OFFSET")),V=g.getOrCreateProgram("terrainRaster",{defines:ze}),U=Fe},ue=g.colorModeForRenderPass(),ce=new Dn(B.LEQUAL,Dn.ReadWrite,g.depthRangeFor3D);ca.update(L);const ye=g.transform,Ae=Wa(ye.zoom,v.exaggeration(),v.sourceCache._source.tileSize);let Ee=[0,0,0];if(G){const Fe=g.style.directionalLight,ze=g.style.ambientLight;Fe&&ze&&(Ee=Gc(g.style,Fe,ze))}{U=-1;const Fe=B.TRIANGLES,[ze,Oe]=[v.gridIndexBuffer,v.gridSegments];for(const ke of I){const Ge=S.getTile(ke),Ze=or.disabled,ft=v.prevTerrainTileForTile[ke.key],ct=v.terrainTileForTile[ke.key];Fl(ft,ct)&&ca.newMorphing(ke.key,ft,ct,L,250),D.activeTexture.set(B.TEXTURE0),Ge.texture&&Ge.texture.bind(B.LINEAR,B.CLAMP_TO_EDGE);const We=ca.getMorphValuesForProxy(ke.key),tt=We?1:0;let zt;We&&(zt={morphing:{srcDemTile:We.from,dstDemTile:We.to,phase:r.cB(We.phase)}});const Gt=Bd(ke.projMatrix,gl(ke.canonical,ye.renderWorldCopies)?Ae/10:Ae,Ee);if(Q(tt),!V)continue;v.setupElevationDraw(Ge,V,zt);const Yt=ke.toUnwrapped();G&&G.setupShadows(Yt,V),g.uploadCommonUniforms(D,V,Yt,null,re),V.draw(g,Fe,ce,Ze,ue,Wn.backCCW,Gt,"terrain_raster",v.gridBuffer,ze,Oe)}}}}(o,this,this.proxySourceCache,t,this._updateTimestamp),this.renderingToTexture=!0,o.gpuTimingDeferredRenderEnd(),t.splice(0,t.length))}renderBatch(t){if(this._drapedRenderBatches.length===0)return t+1;this.renderingToTexture=!0;const o=this.painter,h=this.painter.context,g=this.proxySourceCache,v=this.proxiedCoords[g.id],S=this._drapedRenderBatches.shift(),I=o.style.order,L=[];let D=0;for(const B of v){const V=g.getTileByID(B.proxyTileKey),U=g.proxyCachedFBO[B.key]?g.proxyCachedFBO[B.key][t]:void 0,G=U!==void 0?g.renderCache[U]:this.pool[D++],re=U!==void 0;if(V.texture=G.tex,re&&!G.dirty){L.push(V.tileID);continue}let Q;h.bindFramebuffer.set(G.fb.framebuffer),this.renderedToTile=!1,G.dirty&&(h.clear({color:r.aj.transparent,stencil:0}),G.dirty=!1);for(let ue=S.start;ue<=S.end;++ue){const ce=o.style._mergedLayers[I[ue]];if(ce.isHidden(o.transform.zoom))continue;const ye=o.style.getLayerSourceCache(ce),Ae=ye?this.proxyToSource[B.key][ye.id]:[B];if(!Ae)continue;const Ee=Ae;h.viewport.set([0,0,G.fb.width,G.fb.height]),Q!==(ye?ye.id:null)&&(this._setupStencil(G,Ae,ce,ye),Q=ye?ye.id:null),o.renderLayer(o,ye,ce,Ee)}if(this._drapedRenderBatches.length===0)for(const ue of this._pendingGroundEffectLayers){const ce=o.style._mergedLayers[I[ue]];if(ce.isHidden(o.transform.zoom))continue;const ye=o.style.getLayerSourceCache(ce),Ae=ye?this.proxyToSource[B.key][ye.id]:[B];if(!Ae)continue;const Ee=Ae;h.viewport.set([0,0,G.fb.width,G.fb.height]),Q!==(ye?ye.id:null)&&(this._setupStencil(G,Ae,ce,ye),Q=ye?ye.id:null),o.renderLayer(o,ye,ce,Ee)}this.renderedToTile?(G.dirty=!0,L.push(V.tileID)):re||--D,D===5&&(D=0,this.renderToBackBuffer(L))}return this.renderToBackBuffer(L),this.renderingToTexture=!1,h.bindFramebuffer.set(null),h.viewport.set([0,0,o.width,o.height]),S.end+1}postRender(){}isLayerOrderingCorrect(t){const o=t.order.length;let h=-1,g=o;for(let v=0;v<o;++v)this._style.isLayerDraped(t._mergedLayers[t.order[v]])?h=Math.max(h,v):g=Math.min(g,v);return g>h}getMinElevationBelowMSL(){let t=0;return this._visibleDemTiles.filter(o=>o.dem).forEach(o=>{t=Math.min(t,o.dem.tree.minimums[0])}),t===0?t:(t-30)*this._exaggeration}raycast(t,o,h){if(!this._visibleDemTiles)return null;const g=this._visibleDemTiles.filter(v=>v.dem).map(v=>{const S=v.tileID,I=1<<S.overscaledZ,{x:L,y:D}=S.canonical,B=L/I,V=(L+1)/I,U=D/I,G=(D+1)/I;return{minx:B,miny:U,maxx:V,maxy:G,t:v.dem.tree.raycastRoot(B,U,V,G,t,o,h),tile:v}});g.sort((v,S)=>(v.t!==null?v.t:Number.MAX_VALUE)-(S.t!==null?S.t:Number.MAX_VALUE));for(const v of g){if(v.t==null)return null;const S=v.tile.dem.tree.raycast(v.minx,v.miny,v.maxx,v.maxy,t,o,h);if(S!=null)return S}return null}_createFBO(){const t=this.painter.context,o=t.gl,h=this.drapeBufferSize;t.activeTexture.set(o.TEXTURE0);const g=new r.T(t,{width:h[0],height:h[1],data:null},o.RGBA8);g.bind(o.LINEAR,o.CLAMP_TO_EDGE);const v=t.createFramebuffer(h[0],h[1],!0,null);return v.colorAttachment.set(g.texture),v.depthAttachment=new Ac(t,v.framebuffer),this._sharedDepthStencil===void 0?(this._sharedDepthStencil=t.createRenderbuffer(t.gl.DEPTH_STENCIL,h[0],h[1]),this._stencilRef=0,v.depthAttachment.set(this._sharedDepthStencil),t.clear({stencil:0})):v.depthAttachment.set(this._sharedDepthStencil),t.extTextureFilterAnisotropic&&o.texParameterf(o.TEXTURE_2D,t.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,t.extTextureFilterAnisotropicMax),{fb:v,tex:g,dirty:!1}}_initFBOPool(){for(;this.pool.length<Math.min(5,this.proxyCoords.length);)this.pool.push(this._createFBO())}_shouldDisableRenderCache(){if(this._debugParams.disableRenderCache||this._style.hasLightTransitions())return!0;for(const t in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[t].hasTransition())return!0;return this._style.order.some(t=>{const o=this._style._mergedLayers[t],h=o.isHidden(this.painter.transform.zoom);return o.type==="hillshade"||o.type==="custom"?!h&&o.shouldRedrape():!h&&o.hasTransition()})}_clearLineLayersFromRenderCache(){let t=!1;for(const h of this._style.getSources())if(h instanceof Il){t=!0;break}if(!t)return;const o={};for(let h=0;h<this._style.order.length;++h){const g=this._style._mergedLayers[this._style.order[h]],v=this._style.getLayerSourceCache(g);if(v&&!o[v.id]&&!g.isHidden(this.painter.transform.zoom)&&g.type==="line"&&g.widthExpression()instanceof r.a9){o[v.id]=!0;for(const S of this.proxyCoords){const I=this.proxyToSource[S.key][v.id];if(I)for(const L of I)this._clearRenderCacheForTile(v.id,L)}}}}_clearRasterLayersFromRenderCache(){let t=!1;for(const h in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[h]._source instanceof zo){t=!0;break}if(!t)return;const o={};for(let h=0;h<this._style.order.length;++h){const g=this._style._mergedLayers[this._style.order[h]],v=this._style.getLayerSourceCache(g);if(!v||o[v.id]||g.isHidden(this.painter.transform.zoom)||g.type!=="raster")continue;const S=g.paint.get("raster-fade-duration");for(const I of this.proxyCoords){const L=this.proxyToSource[I.key][v.id];if(L)for(const D of L){const B=ha(v.getTile(D),v.findLoadedParent(D,0),v,this.painter.transform,S);(B.opacity!==1||B.mix!==0)&&this._clearRenderCacheForTile(v.id,D)}}}}_setupDrapedRenderBatches(){this._style.updateDrapeFirstLayers();const t=this._style.order,o=t.length;if(o===0)return;const h=[];this._pendingGroundEffectLayers=[];let g,v=0,S=this._style._mergedLayers[t[v]];for(;!this._style.isLayerDraped(S)&&S.isHidden(this.painter.transform.zoom)&&++v<o;)S=this._style._mergedLayers[t[v]];for(;v<o;++v){const I=this._style._mergedLayers[t[v]];I.isHidden(this.painter.transform.zoom)||(this._style.isLayerDraped(I)?g===void 0&&(g=v):(I.type==="fill-extrusion"&&this._pendingGroundEffectLayers.push(v),g!==void 0&&(h.push({start:g,end:v-1}),g=void 0)))}if(g!==void 0&&h.push({start:g,end:v-1}),h.length!==0){const I=h[h.length-1];this._pendingGroundEffectLayers.every(L=>L>I.end)||r.w("fill-extrusion with flood lighting and/or ground ambient occlusion should be moved to be on top of all draped layers.")}this._drapedRenderBatches=h}_setupRenderCache(t){const o=this.proxySourceCache;if(this._shouldDisableRenderCache()||this.invalidateRenderCache){if(this.invalidateRenderCache=!1,o.renderCache.length>o.renderCachePool.length){const S=Object.values(o.proxyCachedFBO);o.proxyCachedFBO={};for(let I=0;I<S.length;++I){const L=Object.values(S[I]);o.renderCachePool.push(...L)}}return}this._clearRasterLayersFromRenderCache();const h=this.proxyCoords,g=this._tilesDirty;for(let S=h.length-1;S>=0;S--){const I=h[S];if(o.getTileByID(I.key),o.proxyCachedFBO[I.key]!==void 0){const L=t[I.key],D=this.proxyToSource[I.key];let B=0;for(const V in D){const U=D[V],G=L[V];if(!G||G.length!==U.length||U.some((re,Q)=>re!==G[Q]||g[V]&&g[V].hasOwnProperty(re.key))){B=-1;break}++B}for(const V in o.proxyCachedFBO[I.key])o.renderCache[o.proxyCachedFBO[I.key][V]].dirty=B<0||B!==Object.values(L).length}}const v=[...this._drapedRenderBatches];v.sort((S,I)=>I.end-I.start-(S.end-S.start));for(const S of v)for(const I of h){if(o.proxyCachedFBO[I.key])continue;let L=o.renderCachePool.pop();L===void 0&&o.renderCache.length<50&&(L=o.renderCache.length,o.renderCache.push(this._createFBO())),L!==void 0&&(o.proxyCachedFBO[I.key]={},o.proxyCachedFBO[I.key][S.start]=L,o.renderCache[L].dirty=!0)}this._tilesDirty={}}_setupStencil(t,o,h,g){if(!g||!this._sourceTilesOverlap[g.id])return void(this._overlapStencilType&&(this._overlapStencilType=!1));const v=this.painter.context,S=v.gl;if(o.length<=1)return void(this._overlapStencilType=!1);let I;if(h.isTileClipped())I=o.length,this._overlapStencilMode.test={func:S.EQUAL,mask:255},this._overlapStencilType="Clip";else{if(!(o[0].overscaledZ>o[o.length-1].overscaledZ))return void(this._overlapStencilType=!1);I=1,this._overlapStencilMode.test={func:S.GREATER,mask:255},this._overlapStencilType="Mask"}this._stencilRef+I>255&&(v.clear({stencil:0}),this._stencilRef=0),this._stencilRef+=I,this._overlapStencilMode.ref=this._stencilRef,h.isTileClipped()&&this._renderTileClippingMasks(o,this._overlapStencilMode.ref)}clipOrMaskOverlapStencilType(){return this._overlapStencilType==="Clip"||this._overlapStencilType==="Mask"}stencilModeForRTTOverlap(t){return this.renderingToTexture&&this._overlapStencilType?(this._overlapStencilType==="Clip"&&(this._overlapStencilMode.ref=this.painter._tileClippingMaskIDs[t.key]),this._overlapStencilMode):or.disabled}_renderTileClippingMasks(t,o){const h=this.painter,g=this.painter.context,v=g.gl;h._tileClippingMaskIDs={},g.setColorMode(Sr.disabled),g.setDepthMode(Dn.disabled);const S=h.getOrCreateProgram("clippingMask");for(const I of t){const L=h._tileClippingMaskIDs[I.key]=--o;S.draw(h,v.TRIANGLES,Dn.disabled,new or({func:v.ALWAYS,mask:0},L,255,v.KEEP,v.KEEP,v.REPLACE),Sr.disabled,Wn.disabled,Ga(I.projMatrix),"$clipping",h.tileExtentBuffer,h.quadTriangleIndexBuffer,h.tileExtentSegments)}}pointCoordinate(t){const o=this.painter.transform;if(t.x<0||t.x>o.width||t.y<0||t.y>o.height)return null;const h=[t.x,t.y,1,1];r.ab.vec4.transformMat4(h,h,o.pixelMatrixInverse),r.ab.vec4.scale(h,h,1/h[3]),h[0]/=o.worldSize,h[1]/=o.worldSize;const g=o._camera.position,v=r.bH(1,o.center.lat),S=[g[0],g[1],g[2]/v,0],I=r.ab.vec3.subtract([],h.slice(0,3),S);r.ab.vec3.normalize(I,I);const L=this.raycast(S,I,this._exaggeration);return L!==null&&L?(r.ab.vec3.scaleAndAdd(S,S,I,L),S[3]=S[2],S[2]*=v,S):null}_setupProxiedCoordsForOrtho(t,o,h){if(t.getSource()instanceof r.aJ)return this._setupProxiedCoordsForImageSource(t,o,h);this._findCoveringTileCache[t.id]=this._findCoveringTileCache[t.id]||{};const g=this.proxiedCoords[t.id]=[],v=this.proxyCoords;for(let L=0;L<v.length;L++){const D=v[L],B=this._findTileCoveringTileID(D,t);if(B){const V=this._createProxiedId(D,B,h[D.key]&&h[D.key][t.id]);g.push(V),this.proxyToSource[D.key][t.id]=[V]}}let S=!1;const I=new Set;for(let L=0;L<o.length;L++){const D=t.getTile(o[L]);if(!D||!D.hasData())continue;const B=this._findTileCoveringTileID(D.tileID,this.proxySourceCache);if(B&&B.tileID.canonical.z!==D.tileID.canonical.z){const V=this.proxyToSource[B.tileID.key][t.id],U=this._createProxiedId(B.tileID,D,h[B.tileID.key]&&h[B.tileID.key][t.id]);V?V.splice(V.length-1,0,U):this.proxyToSource[B.tileID.key][t.id]=[U];const G=this.proxyToSource[B.tileID.key][t.id];I.has(G)||I.add(G),g.push(U),S=!0}}if(this._sourceTilesOverlap[t.id]=S,S&&this._debugParams.sortTilesHiZFirst)for(const L of I)L.sort((D,B)=>B.overscaledZ-D.overscaledZ)}_setupProxiedCoordsForImageSource(t,o,h){if(!t.getSource().loaded())return;const g=this.proxiedCoords[t.id]=[],v=this.proxyCoords,S=t.getSource(),I=S.tileID;if(!I)return;const L=new r.P(I.x,I.y)._div(1<<I.z),D=S.coordinates.map(r.aa.fromLngLat).reduce((V,U)=>(V.min.x=Math.min(V.min.x,U.x-L.x),V.min.y=Math.min(V.min.y,U.y-L.y),V.max.x=Math.max(V.max.x,U.x-L.x),V.max.y=Math.max(V.max.y,U.y-L.y),V),{min:new r.P(Number.MAX_VALUE,Number.MAX_VALUE),max:new r.P(-Number.MAX_VALUE,-Number.MAX_VALUE)}),B=(V,U)=>{const G=V.wrap+V.canonical.x/(1<<V.canonical.z),re=V.canonical.y/(1<<V.canonical.z),Q=r.ag/(1<<V.canonical.z),ue=U.wrap+U.canonical.x/(1<<U.canonical.z),ce=U.canonical.y/(1<<U.canonical.z);return G+Q<ue+D.min.x||G>ue+D.max.x||re+Q<ce+D.min.y||re>ce+D.max.y};for(let V=0;V<v.length;V++){const U=v[V];for(let G=0;G<o.length;G++){const re=t.getTile(o[G]);if(!re||!re.hasData()||B(U,re.tileID))continue;const Q=this._createProxiedId(U,re,h[U.key]&&h[U.key][t.id]),ue=this.proxyToSource[U.key][t.id];ue?ue.push(Q):this.proxyToSource[U.key][t.id]=[Q],g.push(Q)}}}_createProxiedId(t,o,h){let g=this.orthoMatrix;if(h){const v=h.find(S=>S.key===o.tileID.key);if(v)return v}if(o.tileID.key!==t.key){const v=t.canonical.z-o.tileID.canonical.z;let S,I,L;g=r.ab.mat4.create();const D=o.tileID.wrap-t.wrap<<t.overscaledZ;v>0?(S=r.ag>>v,I=S*((o.tileID.canonical.x<<v)-t.canonical.x+D),L=S*((o.tileID.canonical.y<<v)-t.canonical.y)):(S=r.ag<<-v,I=r.ag*(o.tileID.canonical.x-(t.canonical.x+D<<-v)),L=r.ag*(o.tileID.canonical.y-(t.canonical.y<<-v))),r.ab.mat4.ortho(g,0,S,0,S,0,1),r.ab.mat4.translate(g,g,[I,L,0])}return new Ea(o.tileID,t.key,g)}_findTileCoveringTileID(t,o){let h=o.getTile(t);if(h&&h.hasData())return h;const g=this._findCoveringTileCache[o.id],v=g[t.key];if(h=v?o.getTileByID(v):null,h&&h.hasData()||v===null)return h;let S=h?h.tileID:t,I=S.overscaledZ;const L=o.getSource().minzoom,D=[];if(!v){const V=o.getSource().maxzoom;if(t.canonical.z>=V){const U=t.canonical.z-V;o.getSource().reparseOverscaled?(I=Math.max(t.canonical.z+2,o.transform.tileZoom),S=new r.aG(I,t.wrap,V,t.canonical.x>>U,t.canonical.y>>U)):U!==0&&(I=V,S=new r.aG(I,t.wrap,V,t.canonical.x>>U,t.canonical.y>>U))}S.key!==t.key&&(D.push(S.key),h=o.getTile(S))}const B=V=>{D.forEach(U=>{g[U]=V}),D.length=0};for(I-=1;I>=L&&(!h||!h.hasData());I--){h&&B(h.tileID.key);const V=S.calculateScaledKey(I);if(h=o.getTileByID(V),h&&h.hasData())break;const U=g[V];if(U===null)break;U===void 0?D.push(V):h=o.getTileByID(U)}return B(h?h.tileID.key:null),h&&h.hasData()?h:null}findDEMTileFor(t){return this.enabled?this._findTileCoveringTileID(t,this.sourceCache):null}prepareDrawTile(){this.renderedToTile=!0}_clearRenderCacheForTile(t,o){let h=this._tilesDirty[t];h||(h=this._tilesDirty[t]={}),h[o.key]=!0}}function Qo(u,t,o){const h=function(I,L,D){const B=r.ab.vec3.dot(L,I),V=r.ab.vec3.dot(D,[.2126,.7152,.0722]),U=(re,Q,ue)=>(1-ue)*re+ue*Q,G=U(1-.3*Math.min(V,1),1,Math.min(B+1,1));return U(.92,1,Math.asin(r.aw(L[2],-1,1))/Math.PI+.5)*G}(u,[0,0,1],t),g=[0,0,0];r.ab.vec3.scale(g,o.slice(0,3),h);const v=[0,0,0];r.ab.vec3.scale(v,t.slice(0,3),u[2]);const S=[0,0,0];return r.ab.vec3.add(S,g,v),r.cf(S)}const Ks=["fill","fillOutline","fillPattern","line","linePattern","background","backgroundPattern","hillshade","raster"],Bl=["stars","rainParticle","snowParticle","fillExtrusion","fillExtrusionGroundEffect","model","symbol"];class Js{static cacheKey(t,o,h,g){let v=`${o}${g?g.cacheKey:""}`;for(const S of h)t.usedDefines.includes(S)&&(v+=`/${S}`);return v}constructor(t,o,h,g,v,S){const I=t.gl;this.program=I.createProgram(),this.configuration=g,this.name=o,this.fixedDefines=[...S];const L=g?g.getBinderAttributes():[],D=(h.staticAttributes||[]).concat(L);let B=g?g.defines():[];B=B.concat(S.map(ue=>`#define ${ue}`));const V=`#version 300 es
`;let U=V+B.concat("precision mediump float;",nh,wc.fragmentSource).join(`
`);for(const ue of h.fragmentIncludes)U+=`
${zl[ue]}`;U+=`
${h.fragmentSource}`;let G=V+B.concat("precision highp float;",nh,wc.vertexSource).join(`
`);for(const ue of h.vertexIncludes)G+=`
${zl[ue]}`;this.forceManualRenderingForInstanceIDShaders=t.forceManualRenderingForInstanceIDShaders&&h.vertexSource.indexOf("gl_InstanceID")!==-1,this.forceManualRenderingForInstanceIDShaders&&(G+=`
uniform int u_instanceID;
`),G+=`
${h.vertexSource}`,this.forceManualRenderingForInstanceIDShaders&&(G=G.replaceAll("gl_InstanceID","u_instanceID"));const re=I.createShader(I.FRAGMENT_SHADER);if(I.isContextLost())return void(this.failedToCreate=!0);I.shaderSource(re,U),I.compileShader(re),I.attachShader(this.program,re);const Q=I.createShader(I.VERTEX_SHADER);if(I.isContextLost())this.failedToCreate=!0;else{I.shaderSource(Q,G),I.compileShader(Q),I.attachShader(this.program,Q),this.attributes={},this.numAttributes=D.length;for(let ue=0;ue<this.numAttributes;ue++)if(D[ue]){const ce=D[ue].startsWith("a_")?D[ue]:`a_${D[ue]}`;I.bindAttribLocation(this.program,ue,ce),this.attributes[ce]=ue}I.linkProgram(this.program),I.deleteShader(Q),I.deleteShader(re),this.fixedUniforms=v(t),this.binderUniforms=g?g.getUniforms(t):[],this.forceManualRenderingForInstanceIDShaders&&(this.instancingUniforms=(ue=>({u_instanceID:new r.bN(ue)}))(t)),(S.includes("TERRAIN")||o.indexOf("symbol")!==-1||o.indexOf("circle")!==-1)&&(this.terrainUniforms=(ue=>({u_dem:new r.bN(ue),u_dem_prev:new r.bN(ue),u_dem_tl:new r.bK(ue),u_dem_scale:new r.bM(ue),u_dem_tl_prev:new r.bK(ue),u_dem_scale_prev:new r.bM(ue),u_dem_size:new r.bM(ue),u_dem_lerp:new r.bM(ue),u_exaggeration:new r.bM(ue),u_depth:new r.bN(ue),u_depth_size_inv:new r.bK(ue),u_depth_range_unpack:new r.bK(ue),u_occluder_half_size:new r.bM(ue),u_occlusion_depth_offset:new r.bM(ue),u_meter_to_dem:new r.bM(ue),u_label_plane_matrix_inv:new r.bJ(ue)}))(t)),S.includes("GLOBE")&&(this.globeUniforms=(ue=>({u_tile_tl_up:new r.bL(ue),u_tile_tr_up:new r.bL(ue),u_tile_br_up:new r.bL(ue),u_tile_bl_up:new r.bL(ue),u_tile_up_scale:new r.bM(ue)}))(t)),S.includes("FOG")&&(this.fogUniforms=(ue=>({u_fog_matrix:new r.bJ(ue),u_fog_range:new r.bK(ue),u_fog_color:new r.ca(ue),u_fog_horizon_blend:new r.bM(ue),u_fog_vertical_limit:new r.bK(ue),u_fog_temporal_offset:new r.bM(ue),u_frustum_tl:new r.bL(ue),u_frustum_tr:new r.bL(ue),u_frustum_br:new r.bL(ue),u_frustum_bl:new r.bL(ue),u_globe_pos:new r.bL(ue),u_globe_radius:new r.bM(ue),u_globe_transition:new r.bM(ue),u_is_globe:new r.bN(ue),u_viewport:new r.bK(ue)}))(t)),S.includes("RENDER_CUTOFF")&&(this.cutoffUniforms=(ue=>({u_cutoff_params:new r.ca(ue)}))(t)),S.includes("LIGHTING_3D_MODE")&&(this.lightsUniforms=(ue=>({u_lighting_ambient_color:new r.bL(ue),u_lighting_directional_dir:new r.bL(ue),u_lighting_directional_color:new r.bL(ue),u_ground_radiance:new r.bL(ue)}))(t)),S.includes("RENDER_SHADOWS")&&(this.shadowUniforms=(ue=>({u_light_matrix_0:new r.bJ(ue),u_light_matrix_1:new r.bJ(ue),u_fade_range:new r.bK(ue),u_shadow_normal_offset:new r.bL(ue),u_shadow_intensity:new r.bM(ue),u_shadow_texel_size:new r.bM(ue),u_shadow_map_resolution:new r.bM(ue),u_shadow_direction:new r.bL(ue),u_shadow_bias:new r.bL(ue),u_shadowmap_0:new r.bN(ue),u_shadowmap_1:new r.bN(ue)}))(t))}}setTerrainUniformValues(t,o){if(!this.terrainUniforms)return;const h=this.terrainUniforms;if(!this.failedToCreate){t.program.set(this.program);for(const g in o)h[g]&&h[g].set(this.program,g,o[g])}}setGlobeUniformValues(t,o){if(!this.globeUniforms)return;const h=this.globeUniforms;if(!this.failedToCreate){t.program.set(this.program);for(const g in o)h[g]&&h[g].set(this.program,g,o[g])}}setFogUniformValues(t,o){if(!this.fogUniforms)return;const h=this.fogUniforms;if(!this.failedToCreate){t.program.set(this.program);for(const g in o)h[g].set(this.program,g,o[g])}}setCutoffUniformValues(t,o){if(!this.cutoffUniforms)return;const h=this.cutoffUniforms;if(!this.failedToCreate){t.program.set(this.program);for(const g in o)h[g].set(this.program,g,o[g])}}setLightsUniformValues(t,o){if(!this.lightsUniforms)return;const h=this.lightsUniforms;if(!this.failedToCreate){t.program.set(this.program);for(const g in o)h[g].set(this.program,g,o[g])}}setShadowUniformValues(t,o){if(this.failedToCreate||!this.shadowUniforms)return;const h=this.shadowUniforms;t.program.set(this.program);for(const g in o)h[g].set(this.program,g,o[g])}_drawDebugWireframe(t,o,h,g,v,S,I,L,D,B){const V=t.options.wireframe;if(V.terrain===!1&&V.layers2D===!1&&V.layers3D===!1)return;const U=t.context;if(!(!(!V.terrain||this.name!=="terrainRaster"&&this.name!=="globeRaster")||!(!V.layers2D||t._terrain&&t._terrain.renderingToTexture||!Ks.includes(this.name))||!(!V.layers3D||!Bl.includes(this.name))))return;const G=U.gl,re=t.wireframeDebugCache.getLinesFromTrianglesBuffer(t.frameCounter,v,U);if(!re)return;const Q=[...this.fixedDefines];Q.push("DEBUG_WIREFRAME");const ue=t.getOrCreateProgram(this.name,{config:this.configuration,defines:Q});U.program.set(ue.program);const ce=(Ee,Fe,ze)=>{if(Fe[Ee]&&ze[Ee])for(const Oe in Fe[Ee])ze[Ee][Oe]&&ze[Ee][Oe].set(ze.program,Oe,Fe[Ee][Oe].current)};D&&D.setUniforms(ue.program,U,ue.binderUniforms,I,{zoom:L}),ce("fixedUniforms",this,ue),ce("terrainUniforms",this,ue),ce("globeUniforms",this,ue),ce("fogUniforms",this,ue),ce("lightsUniforms",this,ue),ce("shadowUniforms",this,ue),re.bind(),U.setColorMode(new Sr([G.ONE,G.ONE_MINUS_SRC_ALPHA,G.ZERO,G.ONE],r.aj.transparent,[!0,!0,!0,!1])),U.setDepthMode(new Dn(o.func===G.LESS?G.LEQUAL:o.func,Dn.ReadOnly,o.range)),U.setStencilMode(or.disabled);const ye=3*S.primitiveLength*2,Ae=3*S.primitiveOffset*2*2;if(this.forceManualRenderingForInstanceIDShaders){const Ee=B||1;for(let Fe=0;Fe<Ee;++Fe)ue.instancingUniforms.u_instanceID.set(this.program,"u_instanceID",Fe),G.drawElements(G.LINES,ye,G.UNSIGNED_SHORT,Ae)}else B&&B>1?G.drawElementsInstanced(G.LINES,ye,G.UNSIGNED_SHORT,Ae,B):G.drawElements(G.LINES,ye,G.UNSIGNED_SHORT,Ae);v.bind(),U.program.set(this.program),U.setDepthMode(o),U.setStencilMode(h),U.setColorMode(g)}checkUniforms(t,o,h){if(this.fixedDefines.includes(o)){for(const g of Object.keys(h))if(!h[g].initialized)throw new Error(`Program '${this.name}', from draw '${t}': uniform ${g} not set but required by ${o} being defined`)}}draw(t,o,h,g,v,S,I,L,D,B,V,U,G,re,Q,ue){const ce=t.context,ye=ce.gl;if(this.failedToCreate)return;ce.program.set(this.program),ce.setDepthMode(h),ce.setStencilMode(g),ce.setColorMode(v),ce.setCullFace(S);for(const Fe of Object.keys(this.fixedUniforms))this.fixedUniforms[Fe].set(this.program,Fe,I[Fe]);re&&re.setUniforms(this.program,ce,this.binderUniforms,U,{zoom:G});const Ae={[ye.POINTS]:1,[ye.LINES]:2,[ye.TRIANGLES]:3,[ye.LINE_STRIP]:1}[o];this.checkUniforms(L,"RENDER_SHADOWS",this.shadowUniforms);const Ee=ue&&ue>0?1:void 0;for(const Fe of V.get()){const ze=Fe.vaos||(Fe.vaos={});if((ze[L]||(ze[L]=new qc)).bind(ce,this,D,re?re.getPaintVertexBuffers():[],B,Fe.vertexOffset,Q||[],Ee),this.forceManualRenderingForInstanceIDShaders){const Oe=ue||1;for(let ke=0;ke<Oe;++ke)this.instancingUniforms.u_instanceID.set(this.program,"u_instanceID",ke),B?ye.drawElements(o,Fe.primitiveLength*Ae,ye.UNSIGNED_SHORT,Fe.primitiveOffset*Ae*2):ye.drawArrays(o,Fe.vertexOffset,Fe.vertexLength)}else ue&&ue>1?ye.drawElementsInstanced(o,Fe.primitiveLength*Ae,ye.UNSIGNED_SHORT,Fe.primitiveOffset*Ae*2,ue):B?ye.drawElements(o,Fe.primitiveLength*Ae,ye.UNSIGNED_SHORT,Fe.primitiveOffset*Ae*2):ye.drawArrays(o,Fe.vertexOffset,Fe.vertexLength);o===ye.TRIANGLES&&B&&this._drawDebugWireframe(t,h,g,v,B,Fe,U,G,re,ue)}}}function sh(u,t){const o=Math.pow(2,t.tileID.overscaledZ),h=t.tileSize*Math.pow(2,u.transform.tileZoom)/o,g=h*(t.tileID.canonical.x+t.tileID.wrap*o),v=h*t.tileID.canonical.y;return{u_image:0,u_texsize:t.imageAtlasTexture?t.imageAtlasTexture.size:[0,0],u_tile_units_to_pixels:1/r.ar(t,1,u.transform.tileZoom),u_pixel_coord_upper:[g>>16,v>>16],u_pixel_coord_lower:[65535&g,65535&v]}}const zu={terrain:0,flat:1},Lf=r.ab.mat4.create(),ru=(u,t,o,h,g,v,S,I,L,D,B,V,U,G,re,Q,ue,ce)=>{const ye=t.style.light,Ae=ye.properties.get("position"),Ee=[Ae.x,Ae.y,Ae.z],Fe=r.ab.mat3.create();ye.properties.get("anchor")==="viewport"&&(r.ab.mat3.fromRotation(Fe,-t.transform.angle),r.ab.vec3.transformMat3(Ee,Ee,Fe));const ze=ye.properties.get("color"),Oe=t.transform,ke={u_matrix:u,u_lightpos:Ee,u_lightintensity:ye.properties.get("intensity"),u_lightcolor:[ze.r,ze.g,ze.b],u_vertical_gradient:+o,u_opacity:h,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:Lf,u_merc_center:[0,0],u_up_dir:[0,0,0],u_height_lift:0,u_height_type:zu[D],u_base_type:zu[B],u_ao:g,u_edge_radius:v,u_width_scale:S,u_flood_light_color:re,u_vertical_scale:Q,u_flood_light_intensity:ue,u_ground_shadow_factor:ce};return Oe.projection.name==="globe"&&(ke.u_tile_id=[I.canonical.x,I.canonical.y,1<<I.canonical.z],ke.u_zoom_transition=V,ke.u_inv_rot_matrix=G,ke.u_merc_center=U,ke.u_up_dir=Oe.projection.upVector(new r.bT(0,0,0),U[0]*r.ag,U[1]*r.ag),ke.u_height_lift=L),ke},Xh=(u,t,o,h,g,v)=>({u_matrix:u,u_edge_radius:t,u_width_scale:o,u_vertical_scale:h,u_height_type:zu[g],u_base_type:zu[v]}),Ta=(u,t,o,h,g,v,S,I,L,D,B,V,U,G,re,Q,ue)=>{const ce=ru(u,t,o,h,g,v,S,I,D,B,V,U,G,re,Q,ue,1,[0,0,0]),ye={u_height_factor:-Math.pow(2,I.overscaledZ)/L.tileSize/8};return r.l(ce,sh(t,L),ye)},Ic=(u,t)=>({u_matrix:u,u_emissive_strength:t}),_l=(u,t,o,h)=>r.l(Ic(u,t),sh(o,h)),Lu=(u,t,o)=>({u_matrix:u,u_world:o,u_emissive_strength:t}),Yh=(u,t,o,h,g)=>r.l(_l(u,t,o,h),{u_world:g}),yl=(u,t,o,h)=>{const g=r.ag/o.tileSize;return{u_matrix:u,u_camera_to_center_distance:t.getCameraToCenterDistance(h),u_extrude_scale:[t.pixelsToGLUnits[0]/g,t.pixelsToGLUnits[1]/g]}},Ca=(u,t,o=1)=>({u_matrix:u,u_color:t.toRenderColor(null),u_overlay:0,u_overlay_scale:o}),xe=r.ab.mat4.create(),$=(u,t,o,h,g,v,S)=>{const I=u.transform,L=I.projection.name==="globe",D=L?r.cN(I.zoom,t.canonical)*I._pixelsPerMercatorPixel:r.ar(o,1,v),B={u_matrix:t.projMatrix,u_extrude_scale:D,u_intensity:S,u_inv_rot_matrix:xe,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(L){B.u_inv_rot_matrix=h,B.u_merc_center=g,B.u_tile_id=[t.canonical.x,t.canonical.y,1<<t.canonical.z],B.u_zoom_transition=r.ae(I.zoom);const V=g[0]*r.ag,U=g[1]*r.ag;B.u_up_dir=I.projection.upVector(new r.bT(0,0,0),V,U)}return B};function ae(u,[t,o,h,g],[v,S]){if(v===S)return[0,0,0,0];const I=255*(u-1)/(u*(S-v));return[t*I,o*I,h*I,g*I]}function De(u,t,[o,h]){return o===h?0:.5/u+(t-o)*(u-1)/(u*(h-o))}const qe=(u,t,o,h,g,v,S,I,L,D,B,V,U,G,re,Q,ue,ce,ye,Ae,Ee)=>({u_matrix:u,u_normalize_matrix:t,u_globe_matrix:o,u_merc_matrix:h,u_grid_matrix:g,u_tl_parent:v,u_scale_parent:D,u_fade_t:B.mix,u_opacity:B.opacity*V.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:V.paint.get("raster-brightness-min"),u_brightness_high:V.paint.get("raster-brightness-max"),u_saturation_factor:r.cO(V.paint.get("raster-saturation")),u_contrast_factor:r.cP(V.paint.get("raster-contrast")),u_spin_weights:Dt(V.paint.get("raster-hue-rotate")),u_perspective_transform:U,u_raster_elevation:G,u_zoom_transition:S,u_merc_center:I,u_cutoff_params:L,u_colorization_mix:ae(r.cQ,Q,ce),u_colorization_offset:De(r.cQ,ue,ce),u_color_ramp:re,u_texture_offset:[Ae/(ye+2*Ae),ye/(ye+2*Ae)],u_texture_res:[ye+2*Ae,ye+2*Ae],u_emissive_strength:Ee});function Dt(u){u*=Math.PI/180;const t=Math.sin(u),o=Math.cos(u);return[(2*o+1)/3,(-Math.sqrt(3)*t-o+1)/3,(Math.sqrt(3)*t-o+1)/3]}const Qt=.05,mn=(u,t,o,h,g,v,S,I,L,D,B,V)=>({u_matrix:u,u_normalize_matrix:t,u_globe_matrix:o,u_merc_matrix:h,u_grid_matrix:g,u_tl_parent:v,u_scale_parent:D,u_fade_t:B.mix,u_opacity:B.opacity,u_image0:0,u_image1:1,u_raster_elevation:V,u_zoom_transition:S,u_merc_center:I,u_cutoff_params:L}),An=(u,t,o,h,g,v,S,I,L,D)=>({u_particle_texture:u,u_particle_texture_side_len:t,u_tile_offset:o,u_velocity:h,u_color_ramp:v,u_velocity_res:g,u_max_speed:S,u_uv_offset:I,u_data_scale:[255*L[0],255*L[1]],u_data_offset:D,u_particle_pos_scale:1.1,u_particle_pos_offset:[Qt,Qt]}),Xt=(u,t,o,h,g,v,S,I,L,D)=>({u_particle_texture:u,u_particle_texture_side_len:t,u_velocity:o,u_velocity_res:h,u_max_speed:g,u_speed_factor:v,u_reset_rate:S,u_rand_seed:Math.random(),u_uv_offset:I,u_data_scale:[255*L[0],255*L[1]],u_data_offset:D,u_particle_pos_scale:1.1,u_particle_pos_offset:[Qt,Qt]}),Qn=r.ab.mat4.create(),qn=(u,t,o,h,g,v,S,I,L,D,B,V,U,G,re,Q,ue,ce,ye,Ae,Ee,Fe)=>{const ze=g.transform,Oe={u_is_size_zoom_constant:+(u==="constant"||u==="source"),u_is_size_feature_constant:+(u==="constant"||u==="camera"),u_size_t:t?t.uSizeT:0,u_size:t?t.uSize:0,u_camera_to_center_distance:ze.getCameraToCenterDistance(ye),u_rotate_symbol:+o,u_aspect_ratio:ze.width/ze.height,u_fade_change:g.options.fadeDuration?g.symbolFadeChange:1,u_matrix:v,u_label_plane_matrix:S,u_coord_matrix:I,u_is_text:+D,u_elevation_from_sea:L?1:0,u_pitch_with_map:+h,u_texsize:B,u_texsize_icon:V,u_texture:0,u_texture_icon:1,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:Qn,u_merc_center:[0,0],u_camera_forward:[0,0,0],u_ecef_origin:[0,0,0],u_tile_matrix:Qn,u_up_vector:[0,-1,0],u_color_adj_mat:Ae,u_icon_transition:Ee||0,u_gamma_scale:h?g.transform.getCameraToCenterDistance(ye)*Math.cos(g.terrain?0:g.transform._pitch):1,u_device_pixel_ratio:r.q.devicePixelRatio,u_is_halo:1,u_scale_factor:Fe||1};return ye.name==="globe"&&(Oe.u_tile_id=[G.canonical.x,G.canonical.y,1<<G.canonical.z],Oe.u_zoom_transition=re,Oe.u_inv_rot_matrix=ue,Oe.u_merc_center=Q,Oe.u_camera_forward=ze._camera.forward(),Oe.u_ecef_origin=r.cR(ze.globeMatrix,G.toUnwrapped()),Oe.u_tile_matrix=Float32Array.from(ze.globeMatrix),Oe.u_up_vector=ce),Oe},Rr=(u,t,o,h)=>({u_matrix:u,u_emissive_strength:t,u_opacity:o,u_color:h}),cr=(u,t,o,h,g,v,S,I,L)=>r.l(function(D,B,V,U,G,re){const{width:Q,height:ue}=U.imageManager.getPixelSize(B),ce=Math.pow(2,re.tileID.overscaledZ),ye=re.tileSize*Math.pow(2,U.transform.tileZoom)/ce,Ae=ye*(re.tileID.canonical.x+re.tileID.wrap*ce),Ee=ye*re.tileID.canonical.y;return{u_image:0,u_pattern_tl:V.tl,u_pattern_br:V.br,u_texsize:[Q,ue],u_pattern_size:V.displaySize,u_pattern_units_to_pixels:G?[U.transform.width,-1*U.transform.height]:[1/r.ar(re,1,U.transform.tileZoom),1/r.ar(re,1,U.transform.tileZoom)],u_pixel_coord_upper:[Ae>>16,Ee>>16],u_pixel_coord_lower:[65535&Ae,65535&Ee]}}(0,v,S,h,I,L),{u_matrix:u,u_emissive_strength:t,u_opacity:o}),er=new Float32Array(r.ab.mat4.identity([])),vr=(u,t,o,h,g,v,S,I,L,D,B,V,U,G=[0,0,0],re)=>{const Q=g.style.light,ue=Q.properties.get("position"),ce=[-ue.x,-ue.y,ue.z],ye=r.ab.mat3.create();Q.properties.get("anchor")==="viewport"&&(r.ab.mat3.fromRotation(ye,-g.transform.angle),r.ab.vec3.transformMat3(ce,ce,ye));const Ae=B.alphaMode==="MASK",Ee=Q.properties.get("color").toRenderColor(null),Fe=U.paint.get("model-ambient-occlusion-intensity"),ze=U.paint.get("model-color").constantOr(r.aj.white).toRenderColor(null),Oe=U.paint.get("model-color-mix-intensity").constantOr(0);return{u_matrix:u,u_lighting_matrix:t,u_normal_matrix:o,u_node_matrix:h||er,u_lightpos:ce,u_lightintensity:Q.properties.get("intensity"),u_lightcolor:[Ee.r,Ee.g,Ee.b],u_camera_pos:G,u_opacity:v,u_baseTextureIsAlpha:0,u_alphaMask:+Ae,u_alphaCutoff:B.alphaCutoff,u_baseColorFactor:[S.r,S.g,S.b,S.a],u_emissiveFactor:[I[0],I[1],I[2],1],u_metallicFactor:L,u_roughnessFactor:D,u_baseColorTexture:ps.BaseColor,u_metallicRoughnessTexture:ps.MetallicRoughness,u_normalTexture:ps.Normal,u_occlusionTexture:ps.Occlusion,u_emissionTexture:ps.Emission,u_lutTexture:ps.LUT,u_color_mix:[ze.r,ze.g,ze.b,Oe],u_aoIntensity:Fe,u_emissive_strength:V,u_occlusionTextureTransform:re||[0,0,0,0]}},Kr=(u,t=er,o=er)=>({u_matrix:u,u_instance:t,u_node_matrix:o}),Xi={fillExtrusion:u=>({u_matrix:new r.bJ(u),u_lightpos:new r.bL(u),u_lightintensity:new r.bM(u),u_lightcolor:new r.bL(u),u_vertical_gradient:new r.bM(u),u_opacity:new r.bM(u),u_edge_radius:new r.bM(u),u_width_scale:new r.bM(u),u_ao:new r.bK(u),u_height_type:new r.bN(u),u_base_type:new r.bN(u),u_tile_id:new r.bL(u),u_zoom_transition:new r.bM(u),u_inv_rot_matrix:new r.bJ(u),u_merc_center:new r.bK(u),u_up_dir:new r.bL(u),u_height_lift:new r.bM(u),u_flood_light_color:new r.bL(u),u_vertical_scale:new r.bM(u),u_flood_light_intensity:new r.bM(u),u_ground_shadow_factor:new r.bL(u)}),fillExtrusionDepth:u=>({u_matrix:new r.bJ(u),u_edge_radius:new r.bM(u),u_width_scale:new r.bM(u),u_vertical_scale:new r.bM(u),u_height_type:new r.bN(u),u_base_type:new r.bN(u)}),fillExtrusionPattern:u=>({u_matrix:new r.bJ(u),u_lightpos:new r.bL(u),u_lightintensity:new r.bM(u),u_lightcolor:new r.bL(u),u_vertical_gradient:new r.bM(u),u_height_factor:new r.bM(u),u_edge_radius:new r.bM(u),u_width_scale:new r.bM(u),u_ao:new r.bK(u),u_height_type:new r.bN(u),u_base_type:new r.bN(u),u_tile_id:new r.bL(u),u_zoom_transition:new r.bM(u),u_inv_rot_matrix:new r.bJ(u),u_merc_center:new r.bK(u),u_up_dir:new r.bL(u),u_height_lift:new r.bM(u),u_image:new r.bN(u),u_texsize:new r.bK(u),u_pixel_coord_upper:new r.bK(u),u_pixel_coord_lower:new r.bK(u),u_tile_units_to_pixels:new r.bM(u),u_opacity:new r.bM(u)}),fillExtrusionGroundEffect:u=>({u_matrix:new r.bJ(u),u_opacity:new r.bM(u),u_ao_pass:new r.bM(u),u_meter_to_tile:new r.bM(u),u_ao:new r.bK(u),u_flood_light_intensity:new r.bM(u),u_flood_light_color:new r.bL(u),u_attenuation:new r.bM(u),u_edge_radius:new r.bM(u),u_fb:new r.bN(u),u_fb_size:new r.bM(u),u_dynamic_offset:new r.bM(u)}),fill:u=>({u_matrix:new r.bJ(u),u_emissive_strength:new r.bM(u)}),fillPattern:u=>({u_matrix:new r.bJ(u),u_emissive_strength:new r.bM(u),u_image:new r.bN(u),u_texsize:new r.bK(u),u_pixel_coord_upper:new r.bK(u),u_pixel_coord_lower:new r.bK(u),u_tile_units_to_pixels:new r.bM(u)}),fillOutline:u=>({u_matrix:new r.bJ(u),u_emissive_strength:new r.bM(u),u_world:new r.bK(u)}),fillOutlinePattern:u=>({u_matrix:new r.bJ(u),u_emissive_strength:new r.bM(u),u_world:new r.bK(u),u_image:new r.bN(u),u_texsize:new r.bK(u),u_pixel_coord_upper:new r.bK(u),u_pixel_coord_lower:new r.bK(u),u_tile_units_to_pixels:new r.bM(u)}),circle:r.cS,collisionBox:u=>({u_matrix:new r.bJ(u),u_camera_to_center_distance:new r.bM(u),u_extrude_scale:new r.bK(u)}),collisionCircle:u=>({u_matrix:new r.bJ(u),u_inv_matrix:new r.bJ(u),u_camera_to_center_distance:new r.bM(u),u_viewport_size:new r.bK(u)}),debug:u=>({u_color:new r.cz(u),u_matrix:new r.bJ(u),u_overlay:new r.bN(u),u_overlay_scale:new r.bM(u)}),clippingMask:u=>({u_matrix:new r.bJ(u)}),heatmap:u=>({u_extrude_scale:new r.bM(u),u_intensity:new r.bM(u),u_matrix:new r.bJ(u),u_inv_rot_matrix:new r.bJ(u),u_merc_center:new r.bK(u),u_tile_id:new r.bL(u),u_zoom_transition:new r.bM(u),u_up_dir:new r.bL(u)}),heatmapTexture:u=>({u_image:new r.bN(u),u_color_ramp:new r.bN(u),u_opacity:new r.bM(u)}),hillshade:u=>({u_matrix:new r.bJ(u),u_image:new r.bN(u),u_latrange:new r.bK(u),u_light:new r.bK(u),u_shadow:new r.cz(u),u_highlight:new r.cz(u),u_emissive_strength:new r.bM(u),u_accent:new r.cz(u)}),hillshadePrepare:u=>({u_matrix:new r.bJ(u),u_image:new r.bN(u),u_dimension:new r.bK(u),u_zoom:new r.bM(u)}),line:r.cT,linePattern:r.cU,raster:u=>({u_matrix:new r.bJ(u),u_normalize_matrix:new r.bJ(u),u_globe_matrix:new r.bJ(u),u_merc_matrix:new r.bJ(u),u_grid_matrix:new r.cA(u),u_tl_parent:new r.bK(u),u_scale_parent:new r.bM(u),u_fade_t:new r.bM(u),u_opacity:new r.bM(u),u_image0:new r.bN(u),u_image1:new r.bN(u),u_brightness_low:new r.bM(u),u_brightness_high:new r.bM(u),u_saturation_factor:new r.bM(u),u_contrast_factor:new r.bM(u),u_spin_weights:new r.bL(u),u_perspective_transform:new r.bK(u),u_raster_elevation:new r.bM(u),u_zoom_transition:new r.bM(u),u_merc_center:new r.bK(u),u_cutoff_params:new r.ca(u),u_colorization_mix:new r.ca(u),u_colorization_offset:new r.bM(u),u_color_ramp:new r.bN(u),u_texture_offset:new r.bK(u),u_texture_res:new r.bK(u),u_emissive_strength:new r.bM(u)}),rasterParticle:u=>({u_matrix:new r.bJ(u),u_normalize_matrix:new r.bJ(u),u_globe_matrix:new r.bJ(u),u_merc_matrix:new r.bJ(u),u_grid_matrix:new r.cA(u),u_tl_parent:new r.bK(u),u_scale_parent:new r.bM(u),u_fade_t:new r.bM(u),u_opacity:new r.bM(u),u_image0:new r.bN(u),u_image1:new r.bN(u),u_raster_elevation:new r.bM(u),u_zoom_transition:new r.bM(u),u_merc_center:new r.bK(u),u_cutoff_params:new r.ca(u)}),rasterParticleTexture:u=>({u_texture:new r.bN(u),u_opacity:new r.bM(u)}),rasterParticleDraw:u=>({u_particle_texture:new r.bN(u),u_particle_texture_side_len:new r.bM(u),u_tile_offset:new r.bK(u),u_velocity:new r.bN(u),u_color_ramp:new r.bN(u),u_velocity_res:new r.bK(u),u_max_speed:new r.bM(u),u_uv_offset:new r.bK(u),u_data_scale:new r.bK(u),u_data_offset:new r.bM(u),u_particle_pos_scale:new r.bM(u),u_particle_pos_offset:new r.bK(u)}),rasterParticleUpdate:u=>({u_particle_texture:new r.bN(u),u_particle_texture_side_len:new r.bM(u),u_velocity:new r.bN(u),u_velocity_res:new r.bK(u),u_max_speed:new r.bM(u),u_speed_factor:new r.bM(u),u_reset_rate:new r.bM(u),u_rand_seed:new r.bM(u),u_uv_offset:new r.bK(u),u_data_scale:new r.bK(u),u_data_offset:new r.bM(u),u_particle_pos_scale:new r.bM(u),u_particle_pos_offset:new r.bK(u)}),symbol:u=>({u_is_size_zoom_constant:new r.bN(u),u_is_size_feature_constant:new r.bN(u),u_size_t:new r.bM(u),u_size:new r.bM(u),u_camera_to_center_distance:new r.bM(u),u_rotate_symbol:new r.bN(u),u_aspect_ratio:new r.bM(u),u_fade_change:new r.bM(u),u_matrix:new r.bJ(u),u_label_plane_matrix:new r.bJ(u),u_coord_matrix:new r.bJ(u),u_is_text:new r.bN(u),u_elevation_from_sea:new r.bN(u),u_pitch_with_map:new r.bN(u),u_texsize:new r.bK(u),u_texsize_icon:new r.bK(u),u_texture:new r.bN(u),u_texture_icon:new r.bN(u),u_gamma_scale:new r.bM(u),u_device_pixel_ratio:new r.bM(u),u_tile_id:new r.bL(u),u_zoom_transition:new r.bM(u),u_inv_rot_matrix:new r.bJ(u),u_merc_center:new r.bK(u),u_camera_forward:new r.bL(u),u_tile_matrix:new r.bJ(u),u_up_vector:new r.bL(u),u_ecef_origin:new r.bL(u),u_is_halo:new r.bN(u),u_icon_transition:new r.bM(u),u_color_adj_mat:new r.bJ(u),u_scale_factor:new r.bM(u)}),background:u=>({u_matrix:new r.bJ(u),u_emissive_strength:new r.bM(u),u_opacity:new r.bM(u),u_color:new r.cz(u)}),backgroundPattern:u=>({u_matrix:new r.bJ(u),u_emissive_strength:new r.bM(u),u_opacity:new r.bM(u),u_image:new r.bN(u),u_pattern_tl:new r.bK(u),u_pattern_br:new r.bK(u),u_texsize:new r.bK(u),u_pattern_size:new r.bK(u),u_pixel_coord_upper:new r.bK(u),u_pixel_coord_lower:new r.bK(u),u_pattern_units_to_pixels:new r.bK(u)}),terrainRaster:u=>({u_matrix:new r.bJ(u),u_image0:new r.bN(u),u_skirt_height:new r.bM(u),u_ground_shadow_factor:new r.bL(u)}),skybox:u=>({u_matrix:new r.bJ(u),u_sun_direction:new r.bL(u),u_cubemap:new r.bN(u),u_opacity:new r.bM(u),u_temporal_offset:new r.bM(u)}),skyboxGradient:u=>({u_matrix:new r.bJ(u),u_color_ramp:new r.bN(u),u_center_direction:new r.bL(u),u_radius:new r.bM(u),u_opacity:new r.bM(u),u_temporal_offset:new r.bM(u)}),skyboxCapture:u=>({u_matrix_3f:new r.cA(u),u_sun_direction:new r.bL(u),u_sun_intensity:new r.bM(u),u_color_tint_r:new r.ca(u),u_color_tint_m:new r.ca(u),u_luminance:new r.bM(u)}),globeRaster:u=>({u_proj_matrix:new r.bJ(u),u_globe_matrix:new r.bJ(u),u_normalize_matrix:new r.bJ(u),u_merc_matrix:new r.bJ(u),u_zoom_transition:new r.bM(u),u_merc_center:new r.bK(u),u_image0:new r.bN(u),u_grid_matrix:new r.cA(u),u_skirt_height:new r.bM(u),u_far_z_cutoff:new r.bM(u),u_frustum_tl:new r.bL(u),u_frustum_tr:new r.bL(u),u_frustum_br:new r.bL(u),u_frustum_bl:new r.bL(u),u_globe_pos:new r.bL(u),u_globe_radius:new r.bM(u),u_viewport:new r.bK(u)}),globeAtmosphere:u=>({u_frustum_tl:new r.bL(u),u_frustum_tr:new r.bL(u),u_frustum_br:new r.bL(u),u_frustum_bl:new r.bL(u),u_horizon:new r.bM(u),u_transition:new r.bM(u),u_fadeout_range:new r.bM(u),u_color:new r.ca(u),u_high_color:new r.ca(u),u_space_color:new r.ca(u),u_temporal_offset:new r.bM(u),u_horizon_angle:new r.bM(u)}),model:u=>({u_matrix:new r.bJ(u),u_lighting_matrix:new r.bJ(u),u_normal_matrix:new r.bJ(u),u_node_matrix:new r.bJ(u),u_lightpos:new r.bL(u),u_lightintensity:new r.bM(u),u_lightcolor:new r.bL(u),u_camera_pos:new r.bL(u),u_opacity:new r.bM(u),u_baseColorFactor:new r.ca(u),u_emissiveFactor:new r.ca(u),u_metallicFactor:new r.bM(u),u_roughnessFactor:new r.bM(u),u_baseTextureIsAlpha:new r.bN(u),u_alphaMask:new r.bN(u),u_alphaCutoff:new r.bM(u),u_baseColorTexture:new r.bN(u),u_metallicRoughnessTexture:new r.bN(u),u_normalTexture:new r.bN(u),u_occlusionTexture:new r.bN(u),u_emissionTexture:new r.bN(u),u_lutTexture:new r.bN(u),u_color_mix:new r.ca(u),u_aoIntensity:new r.bM(u),u_emissive_strength:new r.bM(u),u_occlusionTextureTransform:new r.ca(u)}),modelDepth:u=>({u_matrix:new r.bJ(u),u_instance:new r.bJ(u),u_node_matrix:new r.bJ(u)}),groundShadow:u=>({u_matrix:new r.bJ(u),u_ground_shadow_factor:new r.bL(u)}),stars:u=>({u_matrix:new r.bJ(u),u_up:new r.bL(u),u_right:new r.bL(u),u_intensity_multiplier:new r.bM(u)}),snowParticle:u=>({u_modelview:new r.bJ(u),u_projection:new r.bJ(u),u_time:new r.bM(u),u_cam_pos:new r.bL(u),u_velocityConeAperture:new r.bM(u),u_velocity:new r.bM(u),u_horizontalOscillationRadius:new r.bM(u),u_horizontalOscillationRate:new r.bM(u),u_boxSize:new r.bM(u),u_billboardSize:new r.bM(u),u_simpleShapeParameters:new r.bK(u),u_screenSize:new r.bK(u),u_thinningCenterPos:new r.bK(u),u_thinningShape:new r.bL(u),u_thinningAffectedRatio:new r.bM(u),u_thinningParticleOffset:new r.bM(u),u_particleColor:new r.ca(u),u_direction:new r.bL(u)}),rainParticle:u=>({u_modelview:new r.bJ(u),u_projection:new r.bJ(u),u_time:new r.bM(u),u_cam_pos:new r.bL(u),u_texScreen:new r.bN(u),u_velocityConeAperture:new r.bM(u),u_velocity:new r.bM(u),u_boxSize:new r.bM(u),u_rainDropletSize:new r.bK(u),u_distortionStrength:new r.bM(u),u_rainDirection:new r.bL(u),u_color:new r.ca(u),u_screenSize:new r.bK(u),u_thinningCenterPos:new r.bK(u),u_thinningShape:new r.bL(u),u_thinningAffectedRatio:new r.bM(u),u_thinningParticleOffset:new r.bM(u),u_shapeDirectionalPower:new r.bM(u),u_shapeNormalPower:new r.bM(u),u_mode:new r.bM(u)}),vignette:u=>({u_vignetteShape:new r.bL(u),u_vignetteColor:new r.ca(u)}),occlusion:u=>({u_matrix:new r.bJ(u),u_anchorPos:new r.bL(u),u_screenSizePx:new r.bK(u),u_occluderSizePx:new r.bK(u),u_color:new r.ca(u)})};class bi{constructor(t,o,h,g){this.id=bi.uniqueIdxCounter,bi.uniqueIdxCounter++,this.context=t;const v=t.gl;this.buffer=v.createBuffer(),this.dynamicDraw=!!h,this.context.unbindVAO(),t.bindElementBuffer.set(this.buffer),v.bufferData(v.ELEMENT_ARRAY_BUFFER,o.arrayBuffer,this.dynamicDraw?v.DYNAMIC_DRAW:v.STATIC_DRAW),this.dynamicDraw||g||o.destroy()}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(t){this.id=bi.uniqueIdxCounter,bi.uniqueIdxCounter++;const o=this.context.gl;this.context.unbindVAO(),this.bind(),o.bufferSubData(o.ELEMENT_ARRAY_BUFFER,0,t.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}bi.uniqueIdxCounter=0;const di={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class Ii{constructor(t,o,h,g,v,S){this.length=o.length,this.attributes=h,this.itemSize=o.bytesPerElement,this.dynamicDraw=g,this.instanceCount=S,this.context=t;const I=t.gl;this.buffer=I.createBuffer(),t.bindVertexBuffer.set(this.buffer),I.bufferData(I.ARRAY_BUFFER,o.arrayBuffer,this.dynamicDraw?I.DYNAMIC_DRAW:I.STATIC_DRAW),this.dynamicDraw||v||o.destroy()}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(t){const o=this.context.gl;this.bind(),o.bufferSubData(o.ARRAY_BUFFER,0,t.arrayBuffer)}enableAttributes(t,o){for(let h=0;h<this.attributes.length;h++){const g=o.attributes[this.attributes[h].name];g!==void 0&&t.enableVertexAttribArray(g)}}setVertexAttribPointers(t,o,h){for(let g=0;g<this.attributes.length;g++){const v=this.attributes[g],S=o.attributes[v.name];S!==void 0&&t.vertexAttribPointer(S,v.components,t[di[v.type]],!1,this.itemSize,v.offset+this.itemSize*(h||0))}}setVertexAttribDivisor(t,o,h){for(let g=0;g<this.attributes.length;g++){const v=o.attributes[this.attributes[g].name];v!==void 0&&this.instanceCount&&this.instanceCount>0&&t.vertexAttribDivisor(v,h)}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class Jr{constructor(t,o,h,g,v){this.context=t,this.width=o,this.height=h;const S=this.framebuffer=t.gl.createFramebuffer();g&&(this.colorAttachment=new Ha(t,S)),v&&(this.depthAttachmentType=v,this.depthAttachment=v==="renderbuffer"?new Mc(t,S):new Dl(t,S))}destroy(){const t=this.context.gl;if(this.colorAttachment){const o=this.colorAttachment.get();o&&t.deleteTexture(o)}if(this.depthAttachment&&this.depthAttachmentType)if(this.depthAttachmentType==="renderbuffer"){const o=this.depthAttachment.get();o&&t.deleteRenderbuffer(o)}else{const o=this.depthAttachment.get();o&&t.deleteTexture(o)}t.deleteFramebuffer(this.framebuffer)}}class jr{constructor(t,o){this.gl=t,this.clearColor=new Mp(this),this.clearDepth=new ih(this),this.clearStencil=new Ap(this),this.colorMask=new Pu(this),this.depthMask=new Zc(this),this.stencilMask=new Qi(this),this.stencilFunc=new Ru(this),this.stencilOp=new oc(this),this.stencilTest=new Ec(this),this.depthRange=new Rf(this),this.depthTest=new Xc(this),this.depthFunc=new sc(this),this.blend=new ml(this),this.blendFunc=new _s(this),this.blendColor=new Gh(this),this.blendEquation=new Yc(this),this.cullFace=new ku(this),this.cullFaceSide=new qh(this),this.frontFace=new Kc(this),this.program=new Jc(this),this.activeTexture=new Ol(this),this.viewport=new Qc(this),this.bindFramebuffer=new eu(this),this.bindRenderbuffer=new Zh(this),this.bindTexture=new kf(this),this.bindVertexBuffer=new tu(this),this.bindElementBuffer=new oh(this),this.bindVertexArrayOES=new nu(this),this.pixelStoreUnpack=new Fd(this),this.pixelStoreUnpackPremultiplyAlpha=new Tc(this),this.pixelStoreUnpackFlipY=new zf(this),this.options=o?{...o}:{},this.options.extTextureFilterAnisotropicForceOff||(this.extTextureFilterAnisotropic=t.getExtension("EXT_texture_filter_anisotropic")||t.getExtension("MOZ_EXT_texture_filter_anisotropic")||t.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=t.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT))),this.extDebugRendererInfo=t.getExtension("WEBGL_debug_renderer_info"),this.extDebugRendererInfo&&(this.renderer=t.getParameter(this.extDebugRendererInfo.UNMASKED_RENDERER_WEBGL),this.vendor=t.getParameter(this.extDebugRendererInfo.UNMASKED_VENDOR_WEBGL)),this.forceManualRenderingForInstanceIDShaders=o&&!!o.forceManualRenderingForInstanceIDShaders||this.renderer&&this.renderer.indexOf("PowerVR")!==-1,this.options.extTextureFloatLinearForceOff||(this.extTextureFloatLinear=t.getExtension("OES_texture_float_linear")),this.extRenderToTextureHalfFloat=t.getExtension("EXT_color_buffer_half_float"),this.extTimerQuery=t.getExtension("EXT_disjoint_timer_query_webgl2"),this.maxTextureSize=t.getParameter(t.MAX_TEXTURE_SIZE),this.maxPointSize=t.getParameter(t.ALIASED_POINT_SIZE_RANGE)[1]}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArrayOES.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(t,o,h){return new bi(this,t,o,h)}createVertexBuffer(t,o,h,g,v){return new Ii(this,t,o,h,g,v)}createRenderbuffer(t,o,h){const g=this.gl,v=g.createRenderbuffer();return this.bindRenderbuffer.set(v),g.renderbufferStorage(g.RENDERBUFFER,t,o,h),this.bindRenderbuffer.set(null),v}createFramebuffer(t,o,h,g){return new Jr(this,t,o,h,g)}clear({color:t,depth:o,stencil:h,colorMask:g}){const v=this.gl;let S=0;t&&(S|=v.COLOR_BUFFER_BIT,this.clearColor.set(t),this.colorMask.set(g||[!0,!0,!0,!0])),o!==void 0&&(S|=v.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(o),this.depthMask.set(!0)),h!==void 0&&(S|=v.STENCIL_BUFFER_BIT,this.clearStencil.set(h),this.stencilMask.set(255)),v.clear(S)}setCullFace(t){t.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(t.mode),this.frontFace.set(t.frontFace))}setDepthMode(t){t.func!==this.gl.ALWAYS||t.mask?(this.depthTest.set(!0),this.depthFunc.set(t.func),this.depthMask.set(t.mask),this.depthRange.set(t.range)):this.depthTest.set(!1)}setStencilMode(t){t.test.func!==this.gl.ALWAYS||t.mask?(this.stencilTest.set(!0),this.stencilMask.set(t.mask),this.stencilOp.set([t.fail,t.depthFail,t.pass]),this.stencilFunc.set({func:t.test.func,ref:t.ref,mask:t.test.mask})):this.stencilTest.set(!1)}setColorMode(t){r.bn(t.blendFunction,Sr.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(t.blendFunction),this.blendColor.set(t.blendColor),t.blendEquation?this.blendEquation.set(t.blendEquation):this.blendEquation.setDefault()),this.colorMask.set(t.mask)}unbindVAO(){this.bindVertexArrayOES.set(null)}}let ri;function Fi(u,t,o,h,g,v,S){const I=u.context,L=I.gl,D=u.transform,B=u.getOrCreateProgram("collisionBox"),V=[];let U=0,G=0;for(let Ee=0;Ee<h.length;Ee++){const Fe=h[Ee],ze=t.getTile(Fe),Oe=ze.getBucket(o);if(!Oe)continue;const ke=_o(Fe,Oe,D);let Ge=ke;g[0]===0&&g[1]===0||(Ge=u.translatePosMatrix(ke,ze,g,v));const Ze=S?Oe.textCollisionBox:Oe.iconCollisionBox,ft=Oe.collisionCircleArray;if(ft.length>0){const ct=r.ab.mat4.create(),We=Ge;r.ab.mat4.mul(ct,Oe.placementInvProjMatrix,D.glCoordMatrix),r.ab.mat4.mul(ct,ct,Oe.placementViewportMatrix),V.push({circleArray:ft,circleOffset:G,transform:We,invTransform:ct,projection:Oe.getProjection()}),U+=ft.length/4,G=U}Ze&&(u.terrain&&u.terrain.setupElevationDraw(ze,B),B.draw(u,L.LINES,Dn.disabled,or.disabled,u.colorModeForRenderPass(),Wn.disabled,yl(Ge,D,ze,Oe.getProjection()),o.id,Ze.layoutVertexBuffer,Ze.indexBuffer,Ze.segments,null,D.zoom,null,[Ze.collisionVertexBuffer,Ze.collisionVertexBufferExt]))}if(!S||!V.length)return;const re=u.getOrCreateProgram("collisionCircle"),Q=new r.cV;Q.resize(4*U),Q._trim();let ue=0;for(const Ee of V)for(let Fe=0;Fe<Ee.circleArray.length/4;Fe++){const ze=4*Fe,Oe=Ee.circleArray[ze+0],ke=Ee.circleArray[ze+1],Ge=Ee.circleArray[ze+2],Ze=Ee.circleArray[ze+3];Q.emplace(ue++,Oe,ke,Ge,Ze,0),Q.emplace(ue++,Oe,ke,Ge,Ze,1),Q.emplace(ue++,Oe,ke,Ge,Ze,2),Q.emplace(ue++,Oe,ke,Ge,Ze,3)}(!ri||ri.length<2*U)&&(ri=function(Ee){const Fe=2*Ee,ze=new r.aU;ze.resize(Fe),ze._trim();for(let Oe=0;Oe<Fe;Oe++){const ke=6*Oe;ze.uint16[ke+0]=4*Oe+0,ze.uint16[ke+1]=4*Oe+1,ze.uint16[ke+2]=4*Oe+2,ze.uint16[ke+3]=4*Oe+2,ze.uint16[ke+4]=4*Oe+3,ze.uint16[ke+5]=4*Oe+0}return ze}(U));const ce=I.createIndexBuffer(ri,!0),ye=I.createVertexBuffer(Q,r.cW.members,!0);for(const Ee of V){const Fe={u_matrix:Ee.transform,u_inv_matrix:Ee.invTransform,u_camera_to_center_distance:(Ae=D).getCameraToCenterDistance(Ee.projection),u_viewport_size:[Ae.width,Ae.height]};re.draw(u,L.TRIANGLES,Dn.disabled,or.disabled,u.colorModeForRenderPass(),Wn.disabled,Fe,o.id,ye,ce,r.b7.simpleSegment(0,2*Ee.circleOffset,Ee.circleArray.length,Ee.circleArray.length/2),null,D.zoom)}var Ae;ye.destroy(),ce.destroy()}const Pi=r.ab.mat4.create();function no(u){const t=u._camera.getWorldToCamera(u.worldSize,1),o=r.ab.mat4.multiply([],t,u.globeMatrix);r.ab.mat4.invert(o,o);const h=[0,0,0],g=[0,1,0,0];return r.ab.vec4.transformMat4(g,g,o),h[0]=g[0],h[1]=g[1],h[2]=g[2],r.ab.vec3.normalize(h,h),h}function Ps({width:u,height:t,anchor:o,textOffset:h,textScale:g},v){const{horizontalAlign:S,verticalAlign:I}=r.bD(o),L=-(S-.5)*u,D=-(I-.5)*t,B=r.bC(o,h);return new r.P((L/g+B[0])*v,(D/g+B[1])*v)}function Ma(u,t,o,h,g,v,S,I,L,D,B){const V=u.text.placedSymbolArray,U=u.text.dynamicLayoutVertexArray,G=u.icon.dynamicLayoutVertexArray,re={},Q=u.getProjection(),ue=Jl(I,Q,v),ce=v.elevation,ye=Q.upVectorScale(I.canonical,v.center.lat,v.worldSize).metersToTile;U.clear();for(let Ae=0;Ae<V.length;Ae++){const Ee=V.get(Ae),{tileAnchorX:Fe,tileAnchorY:ze,numGlyphs:Oe}=Ee,ke=Ee.hidden||!Ee.crossTileID||u.allowVerticalPlacement&&!Ee.placedOrientation?null:h[Ee.crossTileID];if(ke){let Ge=0,Ze=0,ft=0;if(ce){const Et=ce?ce.getAtTileOffset(I,Fe,ze):0,[rn,Vt,kt]=Q.upVector(I.canonical,Fe,ze);Ge=Et*rn*ye,Ze=Et*Vt*ye,ft=Et*kt*ye}let[ct,We,tt,zt]=wi(Ee.projectedAnchorX+Ge,Ee.projectedAnchorY+Ze,Ee.projectedAnchorZ+ft,o?ue:S);const Gt=Pd(v.getCameraToCenterDistance(Q),zt);let Yt=g.evaluateSizeForFeature(u.textSizeData,D,Ee)*Gt/r.bw;o&&(Yt*=u.tilePixelRatio/L);const dt=Ps(ke,Yt);o?({x:ct,y:We,z:tt}=Q.projectTilePoint(Fe+dt.x,ze+dt.y,I.canonical),[ct,We,tt]=wi(ct+Ge,We+Ze,tt+ft,S)):(t&&dt._rotate(-v.angle),ct+=dt.x,We+=dt.y,tt=0);const Ft=u.allowVerticalPlacement&&Ee.placedOrientation===r.bq.vertical?Math.PI/2:0;for(let Et=0;Et<Oe;Et++)r.bt(U,ct,We,tt,Ft);B&&Ee.associatedIconIndex>=0&&(re[Ee.associatedIconIndex]={x:ct,y:We,z:tt,angle:Ft})}else ol(Oe,U)}if(B){G.clear();const Ae=u.icon.placedSymbolArray;for(let Ee=0;Ee<Ae.length;Ee++){const Fe=Ae.get(Ee),{numGlyphs:ze}=Fe,Oe=re[Ee];if(Fe.hidden||!Oe)ol(ze,G);else{const{x:ke,y:Ge,z:Ze,angle:ft}=Oe;for(let ct=0;ct<ze;ct++)r.bt(G,ke,Ge,Ze,ft)}}u.icon.dynamicLayoutVertexBuffer.updateData(G)}u.text.dynamicLayoutVertexBuffer.updateData(U)}function Yi(u,t,o,h,g,v,S={}){const I=o.paint.get("icon-translate"),L=o.paint.get("text-translate"),D=o.paint.get("icon-translate-anchor"),B=o.paint.get("text-translate-anchor"),V=o.layout.get("icon-rotation-alignment"),U=o.layout.get("text-rotation-alignment"),G=o.layout.get("icon-pitch-alignment"),re=o.layout.get("text-pitch-alignment"),Q=o.layout.get("icon-keep-upright"),ue=o.layout.get("text-keep-upright"),ce=o.paint.get("icon-color-saturation"),ye=o.paint.get("icon-color-contrast"),Ae=o.paint.get("icon-color-brightness-min"),Ee=o.paint.get("icon-color-brightness-max"),Fe=o.layout.get("symbol-elevation-reference")==="sea",ze=u.context,Oe=ze.gl,ke=u.transform,Ge=V==="map",Ze=U==="map",ft=G==="map",ct=re==="map",We=o.layout.get("symbol-sort-key").constantOr(1)!==void 0;let tt=!1;const zt=u.depthModeForSublayer(0,Dn.ReadOnly),Gt=[r.at(ke.center.lng),r.aA(ke.center.lat)],Yt=o.layout.get("text-variable-anchor"),dt=ke.projection.name==="globe",Ft=[],Et=[0,-1,0];for(const rn of h){const Vt=t.getTile(rn),kt=Vt.getBucket(o);if(!kt||kt.projection.name==="mercator"&&dt||kt.fullyClipped)continue;const _n=kt.projection.name==="globe",gn=_n?r.ae(ke.zoom):0,ln=Jl(rn,kt.getProjection(),ke),xn=ke.calculatePixelsToTileUnitsMatrix(Vt),tr=Yt&&kt.hasTextData(),Ln=kt.hasIconTextFit()&&tr&&kt.hasIconData(),Fn=kt.getProjection().createInversionMatrix(ke,rn.canonical),Yn=Bn=>{ke.depthOcclusionForSymbolsAndCircles&&(o.hasInitialOcclusionOpacityProperties||u.terrain)&&(Bn.push("DEPTH_D24"),Bn.push("DEPTH_OCCLUSION"))},Dr=()=>{const Bn=Ge&&o.layout.get("symbol-placement")!=="point",ii=[];Yn(ii);const Ji=Bn||Ln,ts=o.paint.get("icon-image-cross-fade").constantOr(0);u.terrainRenderModeElevated()&&ft&&ii.push("PITCH_WITH_MAP_TERRAIN"),_n&&(ii.push("PROJECTION_GLOBE_VIEW"),Ji&&ii.push("PROJECTED_POS_ON_VIEWPORT")),ts>0&&ii.push("ICON_TRANSITION"),kt.icon.zOffsetVertexBuffer&&ii.push("Z_OFFSET"),ce===0&&ye===0&&Ae===0&&Ee===1||ii.push("COLOR_ADJUSTMENT"),kt.sdfIcons&&ii.push("RENDER_SDF");const Za=kt.icon.programConfigurations.get(o.id),Bo=u.getOrCreateProgram("symbol",{config:Za,defines:ii}),ns=Vt.imageAtlasTexture?Vt.imageAtlasTexture.size:[0,0],Co=kt.iconSizeData,Vi=r.bp(Co,ke.zoom),ki=ft||ke.pitch!==0,mi=ds(ln,Vt.tileID.canonical,ft,Ge,ke,kt.getProjection(),xn),Yr=Lo(ln,Vt.tileID.canonical,ft,Ge,ke,kt.getProjection(),xn),ho=u.translatePosMatrix(Yr,Vt,I,D,!0),Go=u.translatePosMatrix(ln,Vt,I,D),Ei=Ji?Pi:mi,Gs=Ge&&!ft&&!Bn;let El=Et;!dt&&!ke.mercatorFromTransition||Ge||(El=no(ke));const fa=_n?El:Et,kc=o.getColorAdjustmentMatrix(ce,ye,Ae,Ee),pa=qn(Co.kind,Vi,Gs,ft,u,Go,Ei,ho,Fe,!1,ns,[0,0],!0,rn,gn,Gt,Fn,fa,kt.getProjection(),kc,ts),na=Vt.imageAtlasTexture?Vt.imageAtlasTexture:null,qs=o.layout.get("icon-size").constantOr(0)!==1||kt.iconsNeedLinear,zc=kt.sdfIcons||u.options.rotating||u.options.zooming||qs||ki?Oe.LINEAR:Oe.NEAREST,Wi=kt.sdfIcons&&o.paint.get("icon-halo-width").constantOr(1)!==0,vh=u.terrain&&ft&&Bn?r.ab.mat4.invert(r.ab.mat4.create(),mi):Pi;if(Bn&&kt.icon){const dd=ke.elevation,Dp=dd?dd.getAtTileOffsetFunc(rn,ke.center.lat,ke.worldSize,kt.getProjection()):null,Vf=oa(ln,Vt.tileID.canonical,ft,Ge,ke,kt.getProjection(),xn);Yl(kt,ln,u,!1,Vf,Yr,ft,Q,Dp,rn)}return{program:Bo,buffers:kt.icon,uniformValues:pa,atlasTexture:na,atlasTextureIcon:null,atlasInterpolation:zc,atlasInterpolationIcon:null,isSDF:kt.sdfIcons,hasHalo:Wi,tile:Vt,labelPlaneMatrixInv:vh}},pr=()=>{const Bn=Ze&&o.layout.get("symbol-placement")!=="point",ii=[],Ji=Bn||Yt||Ln;u.terrainRenderModeElevated()&&ct&&ii.push("PITCH_WITH_MAP_TERRAIN"),_n&&(ii.push("PROJECTION_GLOBE_VIEW"),Ji&&ii.push("PROJECTED_POS_ON_VIEWPORT")),kt.text.zOffsetVertexBuffer&&ii.push("Z_OFFSET"),kt.iconsInText&&ii.push("RENDER_TEXT_AND_SYMBOL"),ii.push("RENDER_SDF"),Yn(ii);const ts=kt.text.programConfigurations.get(o.id),Za=u.getOrCreateProgram("symbol",{config:ts,defines:ii});let Bo,ns=[0,0],Co=null;const Vi=kt.textSizeData;kt.iconsInText&&(ns=Vt.imageAtlasTexture?Vt.imageAtlasTexture.size:[0,0],Co=Vt.imageAtlasTexture?Vt.imageAtlasTexture:null,Bo=ct||ke.pitch!==0||u.options.rotating||u.options.zooming||Vi.kind==="composite"||Vi.kind==="camera"?Oe.LINEAR:Oe.NEAREST);const ki=Vt.glyphAtlasTexture?Vt.glyphAtlasTexture.size:[0,0],mi=o.layout.get("text-size-scale-range"),Yr=r.aw(u.scaleFactor,mi[0],mi[1]),ho=r.bp(Vi,ke.zoom,Yr),Go=ds(ln,Vt.tileID.canonical,ct,Ze,ke,kt.getProjection(),xn),Ei=Lo(ln,Vt.tileID.canonical,ct,Ze,ke,kt.getProjection(),xn),Gs=u.translatePosMatrix(Ei,Vt,L,B,!0),El=u.translatePosMatrix(ln,Vt,L,B),fa=Ji?Pi:Go,kc=Ze&&!ct&&!Bn;let pa=Et;!dt&&!ke.mercatorFromTransition||Ze||(pa=no(ke));const na=qn(Vi.kind,ho,kc,ct,u,El,fa,Gs,Fe,!0,ki,ns,!0,rn,gn,Gt,Fn,_n?pa:Et,kt.getProjection(),null,null,Yr),qs=Vt.glyphAtlasTexture?Vt.glyphAtlasTexture:null,zc=Oe.LINEAR,Wi=o.paint.get("text-halo-width").constantOr(1)!==0,vh=u.terrain&&ct&&Bn?r.ab.mat4.invert(r.ab.mat4.create(),Go):Pi;if(Bn&&kt.text){const dd=ke.elevation,Dp=dd?dd.getAtTileOffsetFunc(rn,ke.center.lat,ke.worldSize,kt.getProjection()):null,Vf=oa(ln,Vt.tileID.canonical,ct,Ze,ke,kt.getProjection(),xn);Yl(kt,ln,u,!0,Vf,Ei,ct,ue,Dp,rn)}return{program:Za,buffers:kt.text,uniformValues:na,atlasTexture:qs,atlasTextureIcon:Co,atlasInterpolation:zc,atlasInterpolationIcon:Bo,isSDF:!0,hasHalo:Wi,tile:Vt,labelPlaneMatrixInv:vh}},Oi=kt.icon.segments.get().length,Si=kt.text.segments.get().length,si=Oi&&!S.onlyText?Dr():null,Fr=Si&&!S.onlyIcons?pr():null,ur=o.paint.get("icon-opacity").constantOr(1),Er=o.paint.get("text-opacity").constantOr(1);if(We&&kt.canOverlap){tt=!0;const Bn=ur&&!S.onlyText?kt.icon.segments.get():[],ii=Er&&!S.onlyIcons?kt.text.segments.get():[];for(const Ji of Bn)Ft.push({segments:new r.b7([Ji]),sortKey:Ji.sortKey,state:si});for(const Ji of ii)Ft.push({segments:new r.b7([Ji]),sortKey:Ji.sortKey,state:Fr})}else S.onlyText||Ft.push({segments:ur?kt.icon.segments:new r.b7([]),sortKey:0,state:si}),S.onlyIcons||Ft.push({segments:Er?kt.text.segments:new r.b7([]),sortKey:0,state:Fr})}tt&&Ft.sort((rn,Vt)=>rn.sortKey-Vt.sortKey);for(const rn of Ft){const Vt=rn.state;if(Vt)if(u.terrain?u.terrain.setupElevationDraw(Vt.tile,Vt.program,{useDepthForOcclusion:ke.depthOcclusionForSymbolsAndCircles,labelPlaneMatrixInv:Vt.labelPlaneMatrixInv}):u.setupDepthForOcclusion(ke.depthOcclusionForSymbolsAndCircles,Vt.program),ze.activeTexture.set(Oe.TEXTURE0),Vt.atlasTexture&&Vt.atlasTexture.bind(Vt.atlasInterpolation,Oe.CLAMP_TO_EDGE,!0),Vt.atlasTextureIcon&&(ze.activeTexture.set(Oe.TEXTURE1),Vt.atlasTextureIcon&&Vt.atlasTextureIcon.bind(Vt.atlasInterpolationIcon,Oe.CLAMP_TO_EDGE,!0)),u.uploadCommonLightUniforms(u.context,Vt.program),Vt.hasHalo){const kt=Vt.uniformValues;kt.u_is_halo=1,qr(Vt.buffers,rn.segments,o,u,Vt.program,zt,g,v,kt,2),kt.u_is_halo=0}else{if(Vt.isSDF){const kt=Vt.uniformValues;Vt.hasHalo&&(kt.u_is_halo=1,qr(Vt.buffers,rn.segments,o,u,Vt.program,zt,g,v,kt,1)),kt.u_is_halo=0}qr(Vt.buffers,rn.segments,o,u,Vt.program,zt,g,v,Vt.uniformValues,1)}}}function qr(u,t,o,h,g,v,S,I,L,D){const B=[u.dynamicLayoutVertexBuffer,u.opacityVertexBuffer,u.iconTransitioningVertexBuffer,u.globeExtVertexBuffer,u.zOffsetVertexBuffer];g.draw(h,h.context.gl.TRIANGLES,v,S,I,Wn.disabled,L,o.id,u.layoutVertexBuffer,u.indexBuffer,t,o.paint,h.transform.zoom,u.programConfigurations.get(o.id),B,D)}function Ds(u,t,o,h,g,v,S){const I=u.context.gl,L=o.paint.get("fill-pattern"),D=o.is3D(),B=D?u.stencilModeFor3D():or.disabled,V=L&&L.constantOr(1);let U,G,re,Q,ue;S?(G=V&&!o.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",U=I.LINES):(G=V?"fillPattern":"fill",U=I.TRIANGLES);for(const ce of h){const ye=t.getTile(ce);if(V&&!ye.patternsLoaded())continue;const Ae=ye.getBucket(o);if(!Ae)continue;u.prepareDrawTile();const Ee=Ae.programConfigurations.get(o.id),Fe=u.isTileAffectedByFog(ce),ze=u.getOrCreateProgram(G,{config:Ee,overrideFog:Fe});V&&(u.context.activeTexture.set(I.TEXTURE0),ye.imageAtlasTexture&&ye.imageAtlasTexture.bind(I.LINEAR,I.CLAMP_TO_EDGE),Ee.updatePaintBuffers());const Oe=L.constantOr(null);if(Oe&&ye.imageAtlas){const Ze=ye.imageAtlas,ft=r.A.from(Oe),ct=Ze.patternPositions[ft.getSerializedPrimary()];ct&&Ee.setConstantPatternPositions(ct)}const ke=u.translatePosMatrix(ce.projMatrix,ye,o.paint.get("fill-translate"),o.paint.get("fill-translate-anchor")),Ge=o.paint.get("fill-emissive-strength");if(S){Q=Ae.indexBuffer2,ue=Ae.segments2;const Ze=u.terrain&&u.terrain.renderingToTexture?u.terrain.drapeBufferSize:[I.drawingBufferWidth,I.drawingBufferHeight];re=G==="fillOutlinePattern"&&V?Yh(ke,Ge,u,ye,Ze):Lu(ke,Ge,Ze)}else Q=Ae.indexBuffer,ue=Ae.segments,re=V?_l(ke,Ge,u,ye):Ic(ke,Ge);u.uploadCommonUniforms(u.context,ze,ce.toUnwrapped()),ze.draw(u,U,g,D?B:u.stencilModeForClipping(ce),v,Wn.disabled,re,o.id,Ae.layoutVertexBuffer,Q,ue,o.paint,u.transform.zoom,Ee,void 0)}}function Hi(u,t,o,h,g,v,S,I){o.resetLayerRenderingStats(u);const L=u.context,D=L.gl,B=u.transform,V=o.paint.get("fill-extrusion-pattern"),U=V.constantOr(1),G=o.paint.get("fill-extrusion-opacity"),re=u.style.enable3dLights(),Q=o.paint.get(re&&!U?"fill-extrusion-ambient-occlusion-wall-radius":"fill-extrusion-ambient-occlusion-radius"),ue=[o.paint.get("fill-extrusion-ambient-occlusion-intensity"),Q],ce=o.layout.get("fill-extrusion-edge-radius"),ye=ce>0&&!o.paint.get("fill-extrusion-rounded-roof"),Ae=ye?0:ce,Ee=B.projection.name==="globe"?r.d3():0,Fe=B.projection.name==="globe",ze=Fe?r.ae(B.zoom):0,Oe=[r.at(B.center.lng),r.aA(B.center.lat)],ke=o.paint.get("fill-extrusion-flood-light-color-use-theme").constantOr("default")==="none",Ge=o.paint.get("fill-extrusion-flood-light-color").toRenderColor(ke?null:o.lut).toArray01().slice(0,3),Ze=o.paint.get("fill-extrusion-flood-light-intensity"),ft=o.paint.get("fill-extrusion-vertical-scale"),ct=o.paint.get("fill-extrusion-line-width").constantOr(1)!==0,We=o.paint.get("fill-extrusion-height-alignment"),tt=o.paint.get("fill-extrusion-base-alignment"),zt=ul(u,o.paint.get("fill-extrusion-cutoff-fade-range")),Gt=[];let Yt;Fe&&Gt.push("PROJECTION_GLOBE_VIEW"),ue[0]>0&&Gt.push("FAUX_AO"),ye&&Gt.push("ZERO_ROOF_RADIUS"),I&&Gt.push("HAS_CENTROID"),Ze>0&&Gt.push("FLOOD_LIGHT"),zt.shouldRenderCutoff&&Gt.push("RENDER_CUTOFF"),ct&&Gt.push("RENDER_WALL_MODE");const dt=u.renderPass==="shadow",Ft=u.shadowRenderer,Et=dt&&!!Ft;u.shadowRenderer&&(u.shadowRenderer.useNormalOffset=!0);let rn=[0,0,0];if(Ft){const _n=u.style.directionalLight,gn=u.style.ambientLight;_n&&gn&&(rn=Gc(u.style,_n,gn)),dt||(Gt.push("RENDER_SHADOWS","DEPTH_TEXTURE"),Ft.useNormalOffset&&Gt.push("NORMAL_OFFSET")),Yt=Gt.concat(["SHADOWS_SINGLE_CASCADE"])}const Vt=Et?"fillExtrusionDepth":U?"fillExtrusionPattern":"fillExtrusion",kt=o.getLayerRenderingStats();for(const _n of h){const gn=t.getTile(_n),ln=gn.getBucket(o);if(!ln||ln.projection.name!==B.projection.name)continue;let xn=!1;Ft&&(xn=Ft.getMaxCascadeForTile(_n.toUnwrapped())===0);const tr=u.isTileAffectedByFog(_n),Ln=ln.programConfigurations.get(o.id),Fn=u.getOrCreateProgram(Vt,{config:Ln,defines:xn?Yt:Gt,overrideFog:tr});if(u.terrain&&u.terrain.setupElevationDraw(gn,Fn,{useMeterToDem:!0}),!ln.centroidVertexBuffer){const Fr=Fn.attributes.a_centroid_pos;Fr!==void 0&&D.vertexAttrib2f(Fr,0,0)}!dt&&Ft&&Ft.setupShadows(gn.tileID.toUnwrapped(),Fn,"vector-tile",gn.tileID.overscaledZ),U&&(u.context.activeTexture.set(D.TEXTURE0),gn.imageAtlasTexture&&gn.imageAtlasTexture.bind(D.LINEAR,D.CLAMP_TO_EDGE),Ln.updatePaintBuffers());const Yn=V.constantOr(null);if(Yn&&gn.imageAtlas){const Fr=gn.imageAtlas,ur=r.A.from(Yn),Er=Fr.patternPositions[ur.getSerializedPrimary()];Er&&Ln.setConstantPatternPositions(Er)}const Dr=o.paint.get("fill-extrusion-vertical-gradient"),pr=1/ln.tileToMeter;let Oi;if(dt&&Ft){if(Do(gn.tileID,ln,u))continue;const Fr=Ft.calculateShadowPassMatrixFromTile(gn.tileID.toUnwrapped());Oi=Xh(Fr,Ae,pr,ft,We,tt)}else{const Fr=u.translatePosMatrix(_n.expandedProjMatrix,gn,o.paint.get("fill-extrusion-translate"),o.paint.get("fill-extrusion-translate-anchor")),ur=B.projection.createInversionMatrix(B,_n.canonical);Oi=U?Ta(Fr,u,Dr,G,ue,Ae,pr,_n,gn,Ee,We,tt,ze,Oe,ur,Ge,ft):ru(Fr,u,Dr,G,ue,Ae,pr,_n,Ee,We,tt,ze,Oe,ur,Ge,ft,Ze,rn)}u.uploadCommonUniforms(L,Fn,_n.toUnwrapped(),null,zt);let Si=ln.segments;if(B.projection.name==="mercator"&&!dt&&(Si=ln.getVisibleSegments(gn.tileID,u.terrain,u.transform.getFrustum(0)),!Si.get().length))continue;if(kt)if(dt)for(const Fr of Si.get())kt.numRenderedVerticesInShadowPass+=Fr.primitiveLength;else for(const Fr of Si.get())kt.numRenderedVerticesInTransparentPass+=Fr.primitiveLength;const si=[];(u.terrain||I)&&si.push(ln.centroidVertexBuffer),Fe&&si.push(ln.layoutVertexExtBuffer),ct&&si.push(ln.wallVertexBuffer),Fn.draw(u,L.gl.TRIANGLES,g,v,S,Wn.backCCW,Oi,o.id,ln.layoutVertexBuffer,ln.indexBuffer,Si,o.paint,u.transform.zoom,Ln,si)}u.shadowRenderer&&(u.shadowRenderer.useNormalOffset=!1)}function vs(u,t,o,h,g,v,S,I,L,D,B,V,U,G,re,Q,ue,ce,ye){const Ae=u.context,Ee=Ae.gl,Fe=u.transform,ze=u.transform.zoom,Oe=[],ke=ul(u,o.paint.get("fill-extrusion-cutoff-fade-range"));D==="clear"?(Oe.push("CLEAR_SUBPASS"),ye&&(Oe.push("CLEAR_FROM_TEXTURE"),Ae.activeTexture.set(Ee.TEXTURE0),ye.bind(Ee.LINEAR,Ee.CLAMP_TO_EDGE))):D==="sdf"&&Oe.push("SDF_SUBPASS"),ue&&Oe.push("HAS_CENTROID"),ke.shouldRenderCutoff&&Oe.push("RENDER_CUTOFF");const Ge=o.layout.get("fill-extrusion-edge-radius"),Ze=(ft,ct,We,tt,zt)=>{const Gt=ct.programConfigurations.get(o.id),Yt=u.isTileAffectedByFog(ft),dt=u.getOrCreateProgram("fillExtrusionGroundEffect",{config:Gt,defines:Oe,overrideFog:Yt}),Ft=((rn,Vt,kt,_n,gn,ln,xn,tr,Ln,Fn,Yn)=>({u_matrix:Vt,u_opacity:kt,u_ao_pass:_n?1:0,u_meter_to_tile:gn,u_ao:ln,u_flood_light_intensity:xn,u_flood_light_color:tr,u_attenuation:Ln,u_edge_radius:Fn,u_fb:0,u_fb_size:Yn,u_dynamic_offset:1}))(0,tt,B,L,zt,[V,U*zt],G,re,Q,ze>=17?0:Ge*zt,ye?ye.size[0]:0),Et=[];ue&&Et.push(ct.hiddenByLandmarkVertexBuffer),u.uploadCommonUniforms(Ae,dt,ft.toUnwrapped(),null,ke),dt.draw(u,Ae.gl.TRIANGLES,g,v,S,I,Ft,o.id,ct.vertexBuffer,ct.indexBuffer,We,o.paint,ze,Gt,Et)};for(const ft of h){const ct=t.getTile(ft),We=ct.getBucket(o);if(!We||We.projection.name!==Fe.projection.name||!We.groundEffect||We.groundEffect&&!We.groundEffect.hasData())continue;const tt=We.groundEffect,zt=1/We.tileToMeter;{const Gt=u.translatePosMatrix(ft.projMatrix,ct,o.paint.get("fill-extrusion-translate"),o.paint.get("fill-extrusion-translate-anchor")),Yt=tt.getDefaultSegment();Ze(ft,tt,Yt,Gt,zt)}if(ce)for(let Gt=0;Gt<4;Gt++){const Yt=r.d4[Gt](ft),dt=t.getTile(Yt);if(!dt)continue;const Ft=dt.getBucket(o);if(!Ft||Ft.projection.name!==Fe.projection.name||!Ft.groundEffect||Ft.groundEffect&&!Ft.groundEffect.hasData())continue;const Et=Ft.groundEffect;let rn,Vt;Gt===0?(rn=[-r.ag,0,0],Vt=1):Gt===1?(rn=[r.ag,0,0],Vt=0):Gt===2?(rn=[0,-r.ag,0],Vt=3):(rn=[0,r.ag,0],Vt=2);const kt=Et.regionSegments[Vt];if(!kt)continue;const _n=new Float32Array(16);r.ab.mat4.translate(_n,ft.projMatrix,rn),Ze(ft,Et,kt,u.translatePosMatrix(_n,ct,o.paint.get("fill-extrusion-translate"),o.paint.get("fill-extrusion-translate-anchor")),zt)}}}function Us(u,t,o,h,g,v,S){h.centroidVertexArray.length===0&&h.createCentroidsBuffer();const I=v?v.findDEMTileFor(o):null;if(!(I&&I.dem||S))return;v&&I&&I.dem&&h.selfDEMTileTimestamp!==I.dem._timestamp&&(h.borderDoneWithNeighborZ=[-1,-1,-1,-1],h.selfDEMTileTimestamp=I.dem._timestamp);const L=ce=>new r.P(Math.ceil((ce+r.d7)*r.d8),0),D=ce=>{const ye=t.getSource().minzoom,Ae=Fe=>{const ze=t.getTileByID(Fe);if(ze&&ze.hasData())return ze.getBucket(g)},Ee=[0,-1,1];for(const Fe of Ee){if(ce.overscaledZ+Fe<ye)continue;const ze=Ae(ce.calculateScaledKey(ce.overscaledZ+Fe));if(ze)return ze}},B=[0,0,0],V=(ce,ye)=>(B[0]=Math.min(ce.min.y,ye.min.y),B[1]=Math.max(ce.max.y,ye.max.y),B[2]=r.ag-ye.min.x>ce.max.x?ye.min.x-r.ag:ce.max.x,B),U=(ce,ye)=>(B[0]=Math.min(ce.min.x,ye.min.x),B[1]=Math.max(ce.max.x,ye.max.x),B[2]=r.ag-ye.min.y>ce.max.y?ye.min.y-r.ag:ce.max.y,B),G=[(ce,ye)=>V(ce,ye),(ce,ye)=>V(ye,ce),(ce,ye)=>U(ce,ye),(ce,ye)=>U(ye,ce)],re=(ce,ye,Ae,Ee,Fe,ze,Oe)=>{if(!v)return 0;const ke=[[ze?Ae:ce,ze?ce:Ae,0],[ze?Ae:ye,ze?ye:Ae,0]],Ge=Oe<0?r.ag+Oe:Oe,Ze=[ze?Ge:(ce+ye)/2,ze?(ce+ye)/2:Ge,0];return Ae===0&&Oe<0||Ae!==0&&Oe>0?v.getForTilePoints(Fe,[Ze],!0,Ee):ke.push(Ze),v.getForTilePoints(o,ke,!0,I),Math.max(ke[0][2],ke[1][2],Ze[2])/v.exaggeration()};for(let ce=0;ce<4;ce++){const ye=h.borderFeatureIndices[ce];if(ye.length===0)continue;const Ae=r.d4[ce](o),Ee=D(Ae);if(!(Ee&&Ee instanceof r.d5))continue;const Fe=v?v.findDEMTileFor(Ae):null;if(!(Fe&&Fe.dem||S)||(v&&Fe&&Fe.dem&&h.borderDEMTileTimestamp[ce]!==Fe.dem._timestamp&&(h.borderDoneWithNeighborZ[ce]=-1,h.borderDEMTileTimestamp[ce]=Fe.dem._timestamp),h.borderDoneWithNeighborZ[ce]===Ee.canonical.z))continue;Ee.centroidVertexArray.length===0&&Ee.createCentroidsBuffer();const ze=(ce<2?1:5)-ce,Oe=Ee.borderDoneWithNeighborZ[ze]!==h.canonical.z,ke=Ee.borderFeatureIndices[ze];let Ge=0;if(h.canonical.z!==Ee.canonical.z){for(const Ze of ye)h.showCentroid(h.featuresOnBorder[Ze]);if(Oe)for(const Ze of ke)Ee.showCentroid(Ee.featuresOnBorder[Ze]);h.borderDoneWithNeighborZ[ce]=Ee.canonical.z,Ee.borderDoneWithNeighborZ[ze]=h.canonical.z}for(const Ze of ye){const ft=h.featuresOnBorder[Ze],ct=h.centroidData[ft.centroidDataIndex],We=ft.borders[ce];let tt;for(;Ge<ke.length;){tt=Ee.featuresOnBorder[ke[Ge]];const zt=tt.borders[ze];if(zt[1]>We[0]+3||zt[0]>We[0]-3)break;Ee.showCentroid(tt),Ge++}if(tt&&Ge<ke.length){const zt=Ge;let Gt=0;for(;!(tt.borders[ze][0]>We[1]-3)&&(Gt++,++Ge!==ke.length);)tt=Ee.featuresOnBorder[ke[Ge]];tt=Ee.featuresOnBorder[ke[zt]];let Yt=!1;if(Gt>=1){const Et=tt.borders[ze];Math.abs(We[0]-Et[0])<3&&Math.abs(We[1]-Et[1])<3&&(Gt=1,Yt=!0,Ge=zt+1)}else if(Gt===0){h.showCentroid(ft);continue}const dt=Ee.centroidData[tt.centroidDataIndex];S&&Yt&&(((Q=ct).flags|(ue=dt).flags)&r.d6?(Q.flags|=r.d6,ue.flags|=r.d6):(Q.flags&=~r.d6,ue.flags&=~r.d6));const Ft=ft.intersectsCount()>1||tt.intersectsCount()>1;if(Gt>1)Ge=zt,ct.centroidXY=dt.centroidXY=new r.P(0,0);else if(Fe&&Fe.dem&&!Ft){const Et=G[ce](ct,dt),rn=ce%2?r.ag-1:0,Vt=re(Et[0],Math.min(r.ag-1,Et[1]),rn,Fe,Ae,ce<2,Et[2]);ct.centroidXY=dt.centroidXY=L(Vt)}else Ft?ct.centroidXY=dt.centroidXY=new r.P(0,0):(ct.centroidXY=h.encodeBorderCentroid(ft),dt.centroidXY=Ee.encodeBorderCentroid(tt));h.writeCentroidToBuffer(ct),Ee.writeCentroidToBuffer(dt)}else h.showCentroid(ft)}h.borderDoneWithNeighborZ[ce]=Ee.canonical.z,Ee.borderDoneWithNeighborZ[ze]=h.canonical.z}var Q,ue;(h.needsCentroidUpdate||!h.centroidVertexBuffer&&h.centroidVertexArray.length!==0)&&h.uploadCentroid(u)}const ac=[1,0,0],es=[0,1,0],Ri=[0,0,1];function Do(u,t,o){const h=o.transform,g=o.shadowRenderer;if(!g)return!0;const v=u.toUnwrapped(),S=h.tileSize*g._cascades[o.currentShadowCascade].scale;let I=t.maxHeight;if(h.elevation){const Q=h.elevation.getMinMaxForTile(u);Q&&(I+=Q.max)}const L=[...g.shadowDirection];L[2]=-L[2];const D=g.computeSimplifiedTileShadowVolume(v,I,S,L);if(!D)return!1;const B=[ac,es,Ri,L,[L[0],0,L[2]],[0,L[1],L[2]]],V=h.projection.name==="globe",U=h.scaleZoom(S),G=r.bR.fromInvProjectionMatrix(h.invProjMatrix,h.worldSize,U,!V),re=g.getCurrentCascadeFrustum();return G.intersectsPrecise(D.vertices,D.planes,B)===0||re.intersectsPrecise(D.vertices,D.planes,B)===0}function Zt(u){return[u[0]*r.d9,u[1]*r.d9,u[2]*r.d9,0]}function an(u,t,o,h,g,v,S,I,L){const D=h.getSource(),B=o.globeSharedBuffers;if(!B)return;let V,U,G;if(t&&(V=h.getTile(t)),D instanceof r.aJ?(U=D.texture,G=r.cI(0,0,o.transform)):V&&t&&(U=V.texture,G=r.cI(t.canonical.z,t.canonical.x,o.transform)),!U||!G)return;u||(G=r.ab.mat4.scale(r.ab.mat4.create(),G,[1,-1,1]));const re=o.context,Q=re.gl,ue=g.paint.get("raster-resampling")==="nearest"?Q.NEAREST:Q.LINEAR,ce=o.colorModeForDrapableLayerRenderPass(v),ye=S.defines;ye.push("GLOBE_POLES");const Ae=new Dn(Q.LEQUAL,Dn.ReadWrite,o.depthRangeFor3D),Ee=Float32Array.from(o.transform.expandedFarZProjMatrix),Fe=Float32Array.from(r.bb(r.cH(new r.bT(0,0,0))));o.terrain&&o.terrain.prepareDrawTile(),re.activeTexture.set(Q.TEXTURE0),U.bind(ue,Q.CLAMP_TO_EDGE),re.activeTexture.set(Q.TEXTURE1),U.bind(ue,Q.CLAMP_TO_EDGE),U.useMipmap&&re.extTextureFilterAnisotropic&&o.transform.pitch>20&&Q.texParameterf(Q.TEXTURE_2D,re.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,re.extTextureFilterAnisotropicMax);const[ze,Oe,ke,Ge]=t?B.getPoleBuffers(t.canonical.z,!1):B.getPoleBuffers(0,!0),Ze=g.paint.get("raster-elevation");let ft;u?(ft=ze,o.renderDefaultNorthPole=Ze!==0):(ft=Oe,o.renderDefaultSouthPole=Ze!==0);const ct=Zt(S.mix),We=((zt,Gt,Yt,dt,Ft,Et,rn,Vt,kt,_n,gn,ln,xn)=>qe(zt,Gt,Yt,new Float32Array(16),new Float32Array(9),[0,0],dt,[0,0],[0,0,0,0],1,{opacity:1,mix:0},Et,[0,0],Vt,2,_n,gn,ln,1,0,xn))(Ee,Fe,G,r.ae(o.transform.zoom),0,g,0,Ze,0,ct,S.offset,S.range,v),tt=o.getOrCreateProgram("raster",{defines:ye});o.uploadCommonUniforms(re,tt,null),tt.draw(o,Q.TRIANGLES,Ae,L,ce,I,We,g.id,ft,ke,Ge)}function Qs(u){const t=u._nearZ,o=u.projection.farthestPixelDistance(u),h=o-t,g=.2*u.height,v=t+g;return[t,o,(v-g-t)/h,(v-t)/h]}function $i(u,t,o,h){if(u)return t instanceof $o&&u instanceof nl?t.getTextureDescriptor(u,o,!0):{texture:u.texture,mix:Zt(h.mix),offset:h.offset,buffer:0,tileSize:1}}var yt=r.da([{name:"a_index",type:"Int16",components:1}]);class Aa{constructor(t,o,h,g){const v={width:h[0],height:h[1],data:null},S=t.gl;this.targetColorTexture=new r.T(t,v,S.RGBA8,{useMipmap:!1}),this.backgroundColorTexture=new r.T(t,v,S.RGBA8,{useMipmap:!1}),this.context=t,this.updateParticleTexture(o,g),this.lastInvalidatedAt=0}updateParticleTexture(t,o){if(this.particleTextureDimension===o.width)return;(this.particleTexture0||this.particleTexture1||this.particleIndexBuffer||this.particleSegment)&&(this.particleTexture0.destroy(),this.particleTexture1.destroy(),this.particleIndexBuffer.destroy(),this.particleSegment.destroy());const h=this.context.gl,g=o.width*o.height;this.particleTexture0=new r.T(this.context,o,h.RGBA8,{premultiply:!1,useMipmap:!1}),this.particleTexture1=new r.T(this.context,o,h.RGBA8,{premultiply:!1,useMipmap:!1});const v=new r.db;v.reserve(g);for(let S=0;S<g;S++)v.emplaceBack(S);this.particleIndexBuffer=this.context.createVertexBuffer(v,yt.members,!0),this.particleSegment=r.b7.simpleSegment(0,0,this.particleIndexBuffer.length,0),this.particleTextureDimension=o.width}update(t){return!(this.lastInvalidatedAt<t&&(this.lastInvalidatedAt=r.q.now(),1))}destroy(){this.targetColorTexture.destroy(),this.backgroundColorTexture.destroy(),this.particleIndexBuffer.destroy(),this.particleTexture0.destroy(),this.particleTexture1.destroy(),this.particleSegment.destroy()}}function vl(u,t,o){if(!u)return null;const h=t.getTextureDescriptor(u,o,!0);if(!h)return null;let{texture:g,mix:v,offset:S,tileSize:I,buffer:L,format:D}=h;if(!g||!D)return null;let B=!1;return D==="uint32"&&(B=!0,v[3]=0,v=ae(r.dc,v,[0,o.paint.get("raster-particle-max-speed")]),S=De(r.dc,S,[0,o.paint.get("raster-particle-max-speed")])),{texture:g,textureOffset:[L/(I+2*L),I/(I+2*L)],tileSize:I,scalarData:B,scale:v,offset:S,defines:["RASTER_ARRAY",{uint8:"DATA_FORMAT_UINT8",uint16:"DATA_FORMAT_UINT16",uint32:"DATA_FORMAT_UINT32"}[D]]}}function ah(u){const t=u._nearZ,o=u.projection.farthestPixelDistance(u),h=o-t,g=.2*u.height,v=t+g;return[t,o,(v-g-t)/h,(v-t)/h]}const lh=new r.aj(1,0,0,1),Nl=new r.aj(0,1,0,1),jl=new r.aj(0,0,1,1),lc=new r.aj(1,0,1,1),jd=new r.aj(0,1,1,1);function $l(u,t,o,h,g,v,S){const I=u.context,L=u.transform,D=I.gl,B=L.projection.name==="globe",V=B?["PROJECTION_GLOBE_VIEW"]:[];let U=r.ab.mat4.clone(o.projMatrix);if(B&&r.ae(L.zoom)>0){const ct=r.ba(o.canonical,L),We=r.dd(ct);U=r.ab.mat4.multiply(new Float32Array(16),L.globeMatrix,We),r.ab.mat4.multiply(U,L.projMatrix,U)}const G=r.ab.mat4.create();G[12]+=2*g/(r.q.devicePixelRatio*L.width),G[13]+=2*v/(r.q.devicePixelRatio*L.height),r.ab.mat4.multiply(U,G,U);const re=u.getOrCreateProgram("debug",{defines:V}),Q=t.getTileByID(o.key);u.terrain&&u.terrain.setupElevationDraw(Q,re);const ue=Dn.disabled,ce=or.disabled,ye=u.colorModeForRenderPass(),Ae="$debug";I.activeTexture.set(D.TEXTURE0),u.emptyTexture.bind(D.LINEAR,D.CLAMP_TO_EDGE),B?Q._makeGlobeTileDebugBuffers(u.context,L):Q._makeDebugTileBoundsBuffers(u.context,L.projection);const Ee=Q._tileDebugBuffer||u.debugBuffer,Fe=Q._tileDebugIndexBuffer||u.debugIndexBuffer,ze=Q._tileDebugSegments||u.debugSegments;if(re.draw(u,D.LINE_STRIP,ue,ce,ye,Wn.disabled,Ca(U,h),Ae,Ee,Fe,ze,null,null,null,[Q._globeTileDebugBorderBuffer]),S){const ct=Q.latestRawTileData,We=Math.floor((ct&&ct.byteLength||0)/1024);let tt=o.canonical.toString();o.overscaledZ!==o.canonical.z&&(tt+=` => ${o.overscaledZ}`),tt+=` ${Q.state}`,tt+=` ${We}kb`,function(zt,Gt){zt.initDebugOverlayCanvas();const Yt=zt.debugOverlayCanvas,dt=zt.context.gl,Ft=zt.debugOverlayCanvas.getContext("2d");Ft.clearRect(0,0,Yt.width,Yt.height),Ft.shadowColor="white",Ft.shadowBlur=2,Ft.lineWidth=1.5,Ft.strokeStyle="white",Ft.textBaseline="top",Ft.font="bold 36px Open Sans, sans-serif",Ft.fillText(Gt,5,5),Ft.strokeText(Gt,5,5),zt.debugOverlayTexture.update(Yt),zt.debugOverlayTexture.bind(dt.LINEAR,dt.CLAMP_TO_EDGE)}(u,tt)}const Oe=t.getTile(o).tileSize,ke=512/Math.min(Oe,512)*(o.overscaledZ/L.zoom)*.5,Ge=Q._tileDebugTextBuffer||u.debugBuffer,Ze=Q._tileDebugTextIndexBuffer||u.quadTriangleIndexBuffer,ft=Q._tileDebugTextSegments||u.debugSegments;re.draw(u,D.TRIANGLES,ue,ce,Sr.alphaBlended,Wn.disabled,Ca(U,r.aj.transparent,ke),Ae,Ge,Ze,ft,null,null,null,[Q._globeTileDebugTextBuffer])}function Kh(u,t,o,h){Ho(u,0,t+o/2,u.transform.width,o,h)}function cc(u,t,o,h){Ho(u,t-o/2,0,o,u.transform.height,h)}function Ho(u,t,o,h,g,v){const S=u.context,I=S.gl;I.enable(I.SCISSOR_TEST),I.scissor(t*r.q.devicePixelRatio,o*r.q.devicePixelRatio,h*r.q.devicePixelRatio,g*r.q.devicePixelRatio),S.clear({color:v}),I.disable(I.SCISSOR_TEST)}const uc=r.da([{name:"a_pos_3f",components:3,type:"Float32"}]),{members:iu}=uc;function Rs(u,t,o,h){u.emplaceBack(t,o,h)}class hc{constructor(t){this.vertexArray=new r.de,this.indices=new r.aU,Rs(this.vertexArray,-1,-1,1),Rs(this.vertexArray,1,-1,1),Rs(this.vertexArray,-1,1,1),Rs(this.vertexArray,1,1,1),Rs(this.vertexArray,-1,-1,-1),Rs(this.vertexArray,1,-1,-1),Rs(this.vertexArray,-1,1,-1),Rs(this.vertexArray,1,1,-1),this.indices.emplaceBack(5,1,3),this.indices.emplaceBack(3,7,5),this.indices.emplaceBack(6,2,0),this.indices.emplaceBack(0,4,6),this.indices.emplaceBack(2,6,7),this.indices.emplaceBack(7,3,2),this.indices.emplaceBack(5,4,0),this.indices.emplaceBack(0,1,5),this.indices.emplaceBack(0,2,3),this.indices.emplaceBack(3,1,0),this.indices.emplaceBack(7,6,4),this.indices.emplaceBack(4,5,7),this.vertexBuffer=t.createVertexBuffer(this.vertexArray,iu),this.indexBuffer=t.createIndexBuffer(this.indices),this.segment=r.b7.simpleSegment(0,0,36,12)}}function Wo(u,t,o,h,g,v){const S=u.context.gl,I=t.paint.get("sky-atmosphere-color"),L=t.paint.get("sky-atmosphere-halo-color"),D=t.paint.get("sky-atmosphere-sun-intensity"),B=((V,U,G,re,Q)=>({u_matrix_3f:V,u_sun_direction:U,u_sun_intensity:G,u_color_tint_r:[re.r,re.g,re.b,re.a],u_color_tint_m:[Q.r,Q.g,Q.b,Q.a],u_luminance:5e-5}))(r.ab.mat3.fromMat4(r.ab.mat3.create(),h),g,D,I,L);S.framebufferTexture2D(S.FRAMEBUFFER,S.COLOR_ATTACHMENT0,S.TEXTURE_CUBE_MAP_POSITIVE_X+v,t.skyboxTexture,0),o.draw(u,S.TRIANGLES,Dn.disabled,or.disabled,Sr.unblended,Wn.frontCW,B,"skyboxCapture",t.skyboxGeometry.vertexBuffer,t.skyboxGeometry.indexBuffer,t.skyboxGeometry.segment)}const Jh=r.da([{type:"Float32",name:"a_pos",components:3},{type:"Float32",name:"a_uv",components:2}]);class Qh{constructor(t){const o=new r.df;o.emplaceBack(-1,1,1,0,0),o.emplaceBack(1,1,1,1,0),o.emplaceBack(1,-1,1,1,1),o.emplaceBack(-1,-1,1,0,1);const h=new r.aU;h.emplaceBack(0,1,2),h.emplaceBack(2,3,0),this.vertexBuffer=t.createVertexBuffer(o,Jh.members),this.indexBuffer=t.createIndexBuffer(h),this.segments=r.b7.simpleSegment(0,0,4,2)}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy()}}const vi=r.da([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_size_scale",components:1},{type:"Float32",name:"a_fade_opacity",components:1}]);class ed{constructor(){this.starsCount=16e3,this.sizeMultiplier=.15,this.sizeRange=100,this.intensityRange=200}}class ou{constructor(t){this.colorModeAlphaBlendedWriteRGB=new Sr([1,Mu,1,Mu],r.aj.transparent,[!0,!0,!0,!1]),this.colorModeWriteAlpha=new Sr([1,0,1,0],r.aj.transparent,[!1,!1,!1,!0]),this.params=new ed,this.updateNeeded=!0,t.tp.registerParameter(this.params,["Stars"],"starsCount",{min:100,max:16e3,step:1},()=>{this.updateNeeded=!0}),t.tp.registerParameter(this.params,["Stars"],"sizeMultiplier",{min:.01,max:2,step:.01}),t.tp.registerParameter(this.params,["Stars"],"sizeRange",{min:0,max:200,step:1},()=>{this.updateNeeded=!0}),t.tp.registerParameter(this.params,["Stars"],"intensityRange",{min:0,max:200,step:1},()=>{this.updateNeeded=!0})}update(t){const o=t.context;if(!this.atmosphereBuffer||this.updateNeeded){this.updateNeeded=!1,this.atmosphereBuffer=new Qh(o);const h=this.params.sizeRange,g=this.params.intensityRange,v=function(B){const V=r.di(30),U=[];for(let G=0;G<B;++G){const re=2*Math.PI*V(),Q=Math.acos(1-2*V())-.5*Math.PI;U.push(r.ab.vec3.fromValues(Math.cos(Q)*Math.cos(re),Math.cos(Q)*Math.sin(re),Math.sin(Q)))}return U}(this.params.starsCount),S=r.di(300),I=new r.dg,L=new r.aU;let D=0;for(let B=0;B<v.length;++B){const V=r.ab.vec3.scale([],v[B],200),U=Math.max(0,1+.01*h*(1*S()-.5)),G=Math.max(0,1+.01*g*(1*S()-.5));I.emplaceBack(V[0],V[1],V[2],-1,-1,U,G),I.emplaceBack(V[0],V[1],V[2],1,-1,U,G),I.emplaceBack(V[0],V[1],V[2],1,1,U,G),I.emplaceBack(V[0],V[1],V[2],-1,1,U,G),L.emplaceBack(D+0,D+1,D+2),L.emplaceBack(D+0,D+2,D+3),D+=4}this.starsVx=o.createVertexBuffer(I,vi.members),this.starsIdx=o.createIndexBuffer(L),this.starsSegments=r.b7.simpleSegment(0,0,I.length,L.length)}}destroy(){this.atmosphereBuffer&&this.atmosphereBuffer.destroy(),this.starsVx&&this.starsVx.destroy(),this.starsIdx&&this.starsIdx.destroy()}drawAtmosphereGlow(t,o){const h=t.context,g=h.gl,v=t.transform,S=new Dn(g.LEQUAL,Dn.ReadOnly,[0,1]),I=r.ae(v.zoom),L=t.style.getLut(o.scope),D=o.properties.get("color-use-theme")==="none",B=o.properties.get("color").toRenderColor(D?null:L).toArray01(),V=o.properties.get("high-color-use-theme")==="none",U=o.properties.get("high-color").toRenderColor(V?null:L).toArray01(),G=o.properties.get("space-color-use-theme")==="none",re=o.properties.get("space-color").toRenderColor(G?null:L).toArray01PremultipliedAlpha(),Q=5e-4,ue=r.dh(o.properties.get("horizon-blend"),0,1,Q,.25),ce=r.cC(t,h,v)&&ue===Q?v.worldSize/(2*Math.PI*1.025)-1:v.globeRadius,ye=t.frameCounter/1e3%1,Ae=r.ab.vec3.length(v.globeCenterInViewSpace),Ee=Math.sqrt(Math.pow(Ae,2)-Math.pow(ce,2)),Fe=Math.acos(Ee/Ae),ze=Oe=>{const ke=v.projection.name==="globe"?["PROJECTION_GLOBE_VIEW","FOG"]:["FOG"];Oe&&ke.push("ALPHA_PASS");const Ge=t.getOrCreateProgram("globeAtmosphere",{defines:ke}),Ze=((ct,We,tt,zt,Gt,Yt,dt,Ft,Et,rn,Vt,kt)=>({u_frustum_tl:ct,u_frustum_tr:We,u_frustum_br:tt,u_frustum_bl:zt,u_horizon:Gt,u_transition:Yt,u_fadeout_range:dt,u_color:Ft,u_high_color:Et,u_space_color:rn,u_temporal_offset:Vt,u_horizon_angle:kt}))(v.frustumCorners.TL,v.frustumCorners.TR,v.frustumCorners.BR,v.frustumCorners.BL,v.frustumCorners.horizon,I,ue,B,U,re,ye,Fe);t.uploadCommonUniforms(h,Ge);const ft=this.atmosphereBuffer;ft&&Ge.draw(t,g.TRIANGLES,S,or.disabled,Oe?this.colorModeWriteAlpha:this.colorModeAlphaBlendedWriteRGB,Wn.backCW,Ze,Oe?"atmosphere_glow_alpha":"atmosphere_glow",ft.vertexBuffer,ft.indexBuffer,ft.segments)};ze(!1),ze(!0)}drawStars(t,o){const h=r.aw(o.properties.get("star-intensity"),0,1);if(h===0)return;const g=t.context,v=g.gl,S=t.transform,I=t.getOrCreateProgram("stars"),L=r.ab.quat.identity([]);r.ab.quat.rotateX(L,L,-S._pitch),r.ab.quat.rotateZ(L,L,-S.angle),r.ab.quat.rotateX(L,L,r.ai(S._center.lat)),r.ab.quat.rotateY(L,L,-r.ai(S._center.lng));const D=r.ab.mat4.fromQuat(new Float32Array(16),L),B=r.ab.mat4.multiply([],S.starsProjMatrix,D),V=r.ab.mat3.fromMat4([],D),U=r.ab.mat3.invert([],V),G=[0,1,0];r.ab.vec3.transformMat3(G,G,U),r.ab.vec3.scale(G,G,this.params.sizeMultiplier);const re=[1,0,0];r.ab.vec3.transformMat3(re,re,U),r.ab.vec3.scale(re,re,this.params.sizeMultiplier);const Q=(ue=G,ce=re,ye=h,{u_matrix:Float32Array.from(B),u_up:ue,u_right:ce,u_intensity_multiplier:ye});var ue,ce,ye;t.uploadCommonUniforms(g,I),this.starsVx&&this.starsIdx&&I.draw(t,v.TRIANGLES,Dn.disabled,or.disabled,this.colorModeAlphaBlendedWriteRGB,Wn.disabled,Q,"atmosphere_stars",this.starsVx,this.starsIdx,this.starsSegments)}}function xi(u,t){const o=[...u],h=t.cameraWorldSizeForFog/t.worldSize,g=r.ab.mat4.identity([]);return r.ab.mat4.scale(g,g,[h,h,1]),r.ab.mat4.multiply(o,g,o),r.ab.mat4.multiply(o,t.worldToFogMatrix,o),o}function $r(u,t,o,h,g){const v=o.material,S=h.context,{baseColorTexture:I,metallicRoughnessTexture:L}=v.pbrMetallicRoughness,{normalTexture:D,occlusionTexture:B,emissionTexture:V}=v;function U(re,Q,ue){if(re&&(u.push(Q),S.activeTexture.set(S.gl.TEXTURE0+ue),re.gfxTexture)){const{minFilter:ce,magFilter:ye,wrapS:Ae,wrapT:Ee}=re.sampler;re.gfxTexture.bindExtraParam(ce,ye,Ae,Ee)}}U(I,"HAS_TEXTURE_u_baseColorTexture",ps.BaseColor),U(L,"HAS_TEXTURE_u_metallicRoughnessTexture",ps.MetallicRoughness),U(D,"HAS_TEXTURE_u_normalTexture",ps.Normal),U(B,"HAS_TEXTURE_u_occlusionTexture",ps.Occlusion),U(V,"HAS_TEXTURE_u_emissionTexture",ps.Emission),g&&(g.texture||(g.texture=new r.dk(h.context,g.image,[g.image.height,g.image.height,g.image.height],S.gl.RGBA8)),S.activeTexture.set(S.gl.TEXTURE0+ps.LUT),g.texture&&g.texture.bind(S.gl.LINEAR,S.gl.CLAMP_TO_EDGE),u.push("APPLY_LUT_ON_GPU")),o.texcoordBuffer&&(u.push("HAS_ATTRIBUTE_a_uv_2f"),t.push(o.texcoordBuffer)),o.colorBuffer&&(u.push(o.colorBuffer.itemSize===12?"HAS_ATTRIBUTE_a_color_3f":"HAS_ATTRIBUTE_a_color_4f"),t.push(o.colorBuffer)),o.normalBuffer&&(u.push("HAS_ATTRIBUTE_a_normal_3f"),t.push(o.normalBuffer)),o.pbrBuffer&&(u.push("HAS_ATTRIBUTE_a_pbr"),u.push("HAS_ATTRIBUTE_a_heightBasedEmissiveStrength"),t.push(o.pbrBuffer)),v.alphaMode!=="OPAQUE"&&v.alphaMode!=="MASK"||u.push("UNPREMULT_TEXTURE_IN_SHADER"),v.defined||u.push("DIFFUSE_SHADED"),u.push("USE_STANDARD_DERIVATIVES");const G=h.shadowRenderer;G&&(u.push("RENDER_SHADOWS","DEPTH_TEXTURE"),G.useNormalOffset&&u.push("NORMAL_OFFSET"))}function ch(u,t,o,h,g,v){const S=o.paint.get("model-opacity").constantOr(1),I=t.context,L=new Dn(t.context.gl.LEQUAL,Dn.ReadWrite,t.depthRangeFor3D),D=t.transform,B=u.mesh,V=B.material,U=V.pbrMetallicRoughness,G=t.style.fog;let re;re=t.transform.projection.zAxisUnit==="pixels"?[...u.nodeModelMatrix]:r.ab.mat4.multiply([],h.zScaleMatrix,u.nodeModelMatrix),r.ab.mat4.multiply(re,h.negCameraPosMatrix,re);const Q=r.ab.mat4.invert([],re);r.ab.mat4.transpose(Q,Q);const ue=o.paint.get("model-color-use-theme").constantOr("default")==="none",ce=o.paint.get("model-emissive-strength").constantOr(0),ye=vr(new Float32Array(u.worldViewProjection),new Float32Array(re),new Float32Array(Q),null,t,S,U.baseColorFactor.toRenderColor(null),V.emissiveFactor,U.metallicFactor,U.roughnessFactor,V,ce,o),Ae={defines:[]},Ee=[],Fe=t.shadowRenderer;Fe&&(Fe.useNormalOffset=!1),$r(Ae.defines,Ee,B,t,ue?null:o.lut);let ze=null;if(G){const Ge=xi(u.nodeModelMatrix,t.transform);if(ze=new Float32Array(Ge),D.projection.name!=="globe"){const Ze=B.aabb.min,ft=B.aabb.max,[ct,We]=G.getOpacityForBounds(Ge,Ze[0],Ze[1],ft[0],ft[1]);Ae.overrideFog=ct>=on||We>=on}}const Oe=ul(t,o.paint.get("model-cutoff-fade-range"));Oe.shouldRenderCutoff&&Ae.defines.push("RENDER_CUTOFF");const ke=t.getOrCreateProgram("model",Ae);t.uploadCommonUniforms(I,ke,null,ze,Oe),t.renderPass!=="shadow"&&Fe&&Fe.setupShadowsFromMatrix(u.nodeModelMatrix,ke),ke.draw(t,I.gl.TRIANGLES,L,g,v,B.material.doubleSided?Wn.disabled:Wn.backCCW,ye,o.id,B.vertexBuffer,B.indexBuffer,B.segments,o.paint,t.transform.zoom,void 0,Ee)}function Ia(u,t,o,h,g,v,S){let I;I=u.projection.name==="globe"?r.dl(o,u):[...o],r.ab.mat4.multiply(I,I,t.matrix);const L=r.ab.mat4.multiply([],h,I);if(t.meshes)for(const D of t.meshes){if(D.material.alphaMode!=="BLEND"){S.push({mesh:D,depth:0,modelIndex:g,worldViewProjection:L,nodeModelMatrix:I});continue}const B=r.ab.vec3.transformMat4([],D.centroid,L);B[2]>0&&v.push({mesh:D,depth:B[2],modelIndex:g,worldViewProjection:L,nodeModelMatrix:I})}if(t.children)for(const D of t.children)Ia(u,D,o,h,g,v,S)}function yo(u,t,o,h){const g=o.shadowRenderer;if(!g)return;const v=g.getShadowPassDepthMode(),S=g.getShadowPassColorMode(),I=g.calculateShadowPassMatrixFromMatrix(t),L=Kr(I);o.getOrCreateProgram("modelDepth",{defines:o._shadowMapDebug?[]:["DEPTH_TEXTURE"]}).draw(o,o.context.gl.TRIANGLES,v,or.disabled,S,Wn.backCCW,L,h.id,u.vertexBuffer,u.indexBuffer,u.segments,h.paint,o.transform.zoom,void 0,void 0)}function Fo(u,t,o){const h=t.updateZoomBasedPaintProperties(),g=function(v,S,I){let L,D,B,V=v.terrain?v.terrain.exaggeration():0;if(v.terrain&&V>0){const U=v.terrain,G=U.findDEMTileFor(I);G&&G.dem?L=r.dn.create(U,I,G):V=0}if(V===0&&(S.terrainElevationMin=0,S.terrainElevationMax=0),V===S.validForExaggeration&&(V===0||L&&L._demTile&&L._demTile.tileID===S.validForDEMTile.id&&L._dem._timestamp===S.validForDEMTile.timestamp))return!1;for(const U in S.instancesPerModel){const G=S.instancesPerModel[U];for(let re=0;re<G.instancedDataArray.length;++re){const Q=(L?V*L.getElevationAt(0|G.instancedDataArray.float32[16*re],0|G.instancedDataArray.float32[16*re+1],!0,!0):0)+G.instancesEvaluatedElevation[re];G.instancedDataArray.float32[16*re+6]=Q,D=D?Math.min(S.terrainElevationMin,Q):Q,B=B?Math.max(S.terrainElevationMax,Q):Q}}return S.terrainElevationMin=D||0,S.terrainElevationMax=B||0,S.validForExaggeration=V,S.validForDEMTile=L&&L._demTile?{id:L._demTile.tileID,timestamp:L._dem._timestamp}:{id:void 0,timestamp:0},!0}(u,t,o);(h||g)&&(t.uploaded=!1,t.upload(u.context))}const uo={shadowUniformsInitialized:!1,useSingleShadowCascade:!1,tileMatrix:new Float64Array(16),shadowTileMatrix:new Float32Array(16),aabb:new r.cd([0,0,0],[r.ag,r.ag,0])};function td(u,t){const o=1<<u.canonical.z,h=t.getFreeCameraOptions().position,g=t.elevation,v=u.canonical.x/o,S=(u.canonical.x+1)/o,I=u.canonical.y/o,L=(u.canonical.y+1)/o;let D=t._centerAltitude;if(g){const G=g.getMinMaxForTile(u);G&&G.max>D&&(D=G.max)}const B=r.aw(h.x,v,S)-h.x,V=r.aw(h.y,I,L)-h.y,U=r.bH(D,t.center.lat)-h.z;return t._zoomFromMercatorZ(Math.sqrt(B*B+V*V+U*U))}function xl(u,t,o,h,g,v,S){const I=u.context,L=u.renderPass==="shadow",D=u.shadowRenderer,B=L&&D?D.getShadowPassDepthMode():new Dn(I.gl.LEQUAL,Dn.ReadWrite,u.depthRangeFor3D),V=u.isTileAffectedByFog(v);if(o.meshes)for(const U of o.meshes){const G=["MODEL_POSITION_ON_GPU"],re=[];let Q,ue,ce;h.instancedDataArray.length>20&&G.push("INSTANCED_ARRAYS");const ye=ul(u,t.paint.get("model-cutoff-fade-range"));if(ye.shouldRenderCutoff&&G.push("RENDER_CUTOFF"),L&&D)Q=u.getOrCreateProgram("modelDepth",{defines:G}),ue=Kr(S.shadowTileMatrix,S.shadowTileMatrix,Float32Array.from(o.matrix)),ce=D.getShadowPassColorMode();else{$r(G,re,U,u,t.paint.get("model-color-use-theme").constantOr("default")==="none"?null:t.lut),Q=u.getOrCreateProgram("model",{defines:G,overrideFog:V});const Ee=U.material,Fe=Ee.pbrMetallicRoughness,ze=t.paint.get("model-opacity").constantOr(1),Oe=t.paint.get("model-emissive-strength").constantOr(0);ue=vr(v.expandedProjMatrix,Float32Array.from(o.matrix),new Float32Array(16),null,u,ze,Fe.baseColorFactor.toRenderColor(null),Ee.emissiveFactor,Fe.metallicFactor,Fe.roughnessFactor,Ee,Oe,t,g),D&&(S.shadowUniformsInitialized?Q.setShadowUniformValues(I,D.getShadowUniformValues()):(D.setupShadows(v.toUnwrapped(),Q,"model-tile",v.overscaledZ),S.shadowUniformsInitialized=!0)),ce=ye.shouldRenderCutoff||ze<1||Ee.alphaMode!=="OPAQUE"?Sr.alphaBlended:Sr.unblended}u.uploadCommonUniforms(I,Q,v.toUnwrapped(),null,ye);const Ae=U.material.doubleSided?Wn.disabled:Wn.backCCW;if(h.instancedDataArray.length>20)re.push(h.instancedDataBuffer),Q.draw(u,I.gl.TRIANGLES,B,or.disabled,ce,Ae,ue,t.id,U.vertexBuffer,U.indexBuffer,U.segments,t.paint,u.transform.zoom,void 0,re,h.instancedDataArray.length);else{const Ee=L?"u_instance":"u_normal_matrix";for(let Fe=0;Fe<h.instancedDataArray.length;++Fe)ue[Ee]=new Float32Array(h.instancedDataArray.arrayBuffer,64*Fe,16),Q.draw(u,I.gl.TRIANGLES,B,or.disabled,ce,Ae,ue,t.id,U.vertexBuffer,U.indexBuffer,U.segments,t.paint,u.transform.zoom,void 0,re)}}if(o.children)for(const U of o.children)xl(u,t,U,h,g,v,S)}const Vl=[1,-1,1];function Ou(u,t,o,h){if(!o.modelManager)return!0;const g=o.modelManager;if(!o.shadowRenderer)return!0;const v=o.shadowRenderer,S=t.aabb;let I=!0,L=u.maxHeight;if(L===0){let B=0;for(const V in u.instancesPerModel){const U=g.getModel(V,h);U?B=Math.max(B,Math.max(Math.max(U.aabb.max[0],U.aabb.max[1]),U.aabb.max[2])):I=!1}L=u.maxScale*B*1.41+u.maxVerticalOffset,I&&(u.maxHeight=L)}S.max[2]=L,S.min[2]+=u.terrainElevationMin,S.max[2]+=u.terrainElevationMax,r.ab.vec3.transformMat4(S.min,S.min,t.tileMatrix),r.ab.vec3.transformMat4(S.max,S.max,t.tileMatrix);const D=S.intersects(v.getCurrentCascadeFrustum());return o.currentShadowCascade===0&&(u.isInsideFirstShadowMapFrustum=D===2),D===0}function Fs(u,t){const o=u.uniformValues.u_cutoff_params[0],h=u.uniformValues.u_cutoff_params[1],g=u.uniformValues.u_cutoff_params[2],v=u.uniformValues.u_cutoff_params[3];return h===o||v===g?1:r.aw(((t-o)/(h-o)-g)/(v-g),0,1)}function nd(u,t,o,h){if(t.pitch<20)return 1;const g=t.getWorldToCameraMatrix();r.ab.mat4.multiply(g,g,u);const v=r.ab.vec4.fromValues(o.min[0],o.min[1],o.min[2],1);let S=r.ab.vec4.transformMat4(r.ab.vec4.create(),v,g),I=S,L=S;v[1]=o.max[1],S=r.ab.vec4.transformMat4(r.ab.vec4.create(),v,g),I=S[1]<I[1]?S:I,L=S[1]>L[1]?S:L,v[0]=o.max[0],S=r.ab.vec4.transformMat4(r.ab.vec4.create(),v,g),I=S[1]<I[1]?S:I,L=S[1]>L[1]?S:L,v[1]=o.min[1],S=r.ab.vec4.transformMat4(r.ab.vec4.create(),v,g),I=S[1]<I[1]?S:I,L=S[1]>L[1]?S:L;const D=r.aw(h[0],0,1),B=100*t.pixelsPerMeter*r.aw(h[1],0,1),V=r.aw(h[2],0,1),U=r.ab.vec4.lerp(r.ab.vec4.create(),I,L,D),G=Math.tan(.5*t.fovX),re=-U[2]*G;if(B===0)return U[1]<-Math.abs(re)?V:1;const Q=(-Math.abs(re)-U[1])/B,ue=(ye,Ae,Ee)=>(1-Ee)*ye+Ee*Ae,ce=r.aw(ue(1,V,Q),V,1);return ue(1,ce,r.aw((t.pitch-20)/20,0,1))}class $d{}class Vd{constructor(){this._storage=new Map}getLinesFromTrianglesBuffer(t,o,h){{const V=this._storage.get(o.id);if(V)return V.lastUsedFrameIdx=t,V.buf}const g=h.gl,v=g.getBufferParameter(g.ELEMENT_ARRAY_BUFFER,g.BUFFER_SIZE),S=new ArrayBuffer(v),I=new Int16Array(S);g.getBufferSubData(g.ELEMENT_ARRAY_BUFFER,0,new Int16Array(S));const L=new r.dq;for(let V=0;V<v/2;V+=3){const U=I[V],G=I[V+1],re=I[V+2];L.emplaceBack(U,G),L.emplaceBack(G,re),L.emplaceBack(re,U)}const D=h.bindVertexArrayOES.current,B=new $d;return B.buf=new bi(h,L),B.lastUsedFrameIdx=t,this._storage.set(o.id,B),h.bindVertexArrayOES.set(D),B.buf}update(t){for(const[o,h]of this._storage)t-h.lastUsedFrameIdx>30&&(h.buf.destroy(),this._storage.delete(o))}destroy(){for(const[t,o]of this._storage)o.buf.destroy(),this._storage.delete(t)}}class Ul{constructor(t){this.occluderSize=30,this.depthOffset=-1e-4,t.registerParameter(this,["Occlusion"],"occluderSize",{min:1,max:100,step:1}),t.registerParameter(this,["Occlusion"],"depthOffset",{min:-.05,max:0,step:1e-5})}}const Bs=r.da([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_rainParticleData",components:4}]);class uh{registerParameter(){}registerButton(){}registerBinding(){}refreshUI(){}}class hh{constructor(t,o){this.revealStart=11,this.revealRange=2,t.registerParameter(this,[...o,"Reveal"],"revealStart",{min:0,max:17,step:.05}),t.registerParameter(this,[...o,"Reveal"],"revealRange",{min:.1,max:5.1,step:.05})}}const Ud=r.da([{type:"Float32",name:"a_pos_2f",components:2}]);class Of{destroy(){this.vignetteVx&&this.vignetteVx.destroy(),this.vignetteIdx&&this.vignetteIdx.destroy()}draw(t,o){const h=t.getOrCreateProgram("vignette");if(!this.vignetteVx||!this.vignetteIdx){const S=new r.dr,I=new r.aU;S.emplaceBack(-1,-1),S.emplaceBack(1,-1),S.emplaceBack(1,1),S.emplaceBack(-1,1),I.emplaceBack(0,1,2),I.emplaceBack(0,2,3),this.vignetteVx=t.context.createVertexBuffer(S,Ud.members),this.vignetteIdx=t.context.createIndexBuffer(I)}const g=r.b7.simpleSegment(0,0,4,6);if(this.vignetteVx&&this.vignetteIdx){t.uploadCommonUniforms(t.context,h);const S={u_vignetteShape:(v={vignetteShape:[o.start,o.range,Math.pow(10,o.fadePower)],vignetteColor:[o.color.r,o.color.g,o.color.b,o.color.a*o.strength]}).vignetteShape,u_vignetteColor:v.vignetteColor};h.draw(t,t.context.gl.TRIANGLES,Dn.disabled,or.disabled,Sr.alphaBlended,Wn.disabled,S,"vignette",this.vignetteVx,this.vignetteIdx,g,{})}var v}}class Ns{constructor(){this._accumulatedOffsetX=0,this._accumulatedOffsetY=0,this._accumulatedElevation=0}update(t,o){const h=t.getFreeCameraOptions().position,g=h.toAltitude(),v=h.toLngLat(),S=r.ai(v.lng),I=r.ai(v.lat),L=t.pixelsPerMeter/o,D=S*r.ds,B=r.ds*Math.log(Math.tan(Math.PI/4+I/2));if(this._offsetXPrev===void 0)this._offsetXPrev=0,this._offsetYPrev=0,this._elevationPrev=0,this._accumulatedOffsetX=0,this._accumulatedOffsetY=0,this._accumulatedElevation=0;else{const V=-this._offsetYPrev+B,U=-this._elevationPrev+g;this._accumulatedOffsetX+=(-this._offsetXPrev+D)*L,this._accumulatedOffsetY+=V*L,this._accumulatedElevation+=U*L,this._offsetXPrev=D,this._offsetYPrev=B,this._elevationPrev=g}}getPosition(){return[this._accumulatedOffsetX,this._accumulatedOffsetY,this._accumulatedElevation]}}function Hd(u,t){return[-(u[0]-Math.floor(u[0]/t)*t),-(u[1]-Math.floor(u[1]/t)*t),-(u[2]-Math.floor(u[2]/t)*t)]}function Wd(u){const t=r.di(1323123451230),o=[];for(let h=0;h<u;++h){const g=2*t()-1,v=2*t()-1,S=2*t()-1;o.push(r.ab.vec3.fromValues(g,v,S))}return o}function bl(u,t,o,h,g){const v=r.aw((g-o)/(h-o),0,1);return(1-v)*u+v*t}class su{constructor(t){this._movement=new Ns,this._accumulatedTimeFromStart=0,this._prevTime=Date.now()/1e3,this._vignette=new Of,this._ppmScaleFactor=t}destroy(){this.particlesVx&&this.particlesVx.destroy(),this.particlesIdx&&this.particlesIdx.destroy(),this._vignette&&this._vignette.destroy()}updateOnRender(t,o){const h=t.transform;this._movement.update(h,this._ppmScaleFactor);const g=h.starsProjMatrix,v=r.ab.quat.identity([]);r.ab.quat.rotateX(v,v,r.ai(90)-h._pitch),r.ab.quat.rotateZ(v,v,-h.angle);const S=r.ab.mat4.fromQuat(new Float32Array(16),v),I=r.ab.mat4.fromValues(1,0,0,0,0,0,1,0,0,-1,0,0,0,0,0,1),L=r.ab.mat4.transpose([],I),D=r.ab.mat4.multiply([],L,S),B=Date.now()/1e3;return this._accumulatedTimeFromStart+=(B-this._prevTime)*o,this._prevTime=B,{projectionMatrix:g,modelviewMatrix:D}}}class Df extends su{constructor(t){super(4.25),this._params={overrideStyleParameters:!1,intensity:.5,timeFactor:1,velocityConeAperture:0,velocity:300,boxSize:2500,dropletSizeX:1,dropletSizeYScale:10,distortionStrength:70,screenThinning:{intensity:.57,start:.46,range:1.17,fadePower:.17,affectedRatio:1,particleOffset:-.2},color:{r:.66,g:.68,b:.74,a:.7},direction:{x:-50,y:-35},shapeDirPower:2,shapeNormalPower:1},this._revealParams=new hh(t.tp,["Precipitation","Rain"]),this._vignetteParams={strength:1,start:.7,range:1,fadePower:.4,color:{r:.27,g:.27,b:.27,a:1}},this.particlesCount=16e3}update(t){const o=t.context;if(!this.particlesVx){const h=Wd(this.particlesCount),g=new r.dt,v=new r.aU;let S=0;const I=r.di(1323123451230);for(let L=0;L<h.length;++L){const D=h[L],B=[2*I()-1,I(),I(),I()];g.emplaceBack(D[0],D[1],D[2],-1,-1,...B),g.emplaceBack(D[0],D[1],D[2],1,-1,...B),g.emplaceBack(D[0],D[1],D[2],1,1,...B),g.emplaceBack(D[0],D[1],D[2],-1,1,...B),v.emplaceBack(S+0,S+1,S+2),v.emplaceBack(S+0,S+2,S+3),S+=4}this.particlesVx=o.createVertexBuffer(g,Bs.members),this.particlesIdx=o.createIndexBuffer(v)}}draw(t){if(!this._params.overrideStyleParameters&&!t.style.rain)return;const o=this._params.overrideStyleParameters?this._revealParams:{revealStart:0,revealRange:.01},h=t.transform.zoom;if(o.revealStart>h)return;const g=bl(0,1,o.revealStart,o.revealStart+o.revealRange,h);if(!this.particlesVx||!this.particlesIdx)return;const v=structuredClone(this._params);let S=[-v.direction.x,v.direction.y,-100];r.ab.vec3.normalize(S,S);const I=structuredClone(this._vignetteParams);I.strength*=g,v.overrideStyleParameters||(v.intensity=t.style.rain.state.density,v.timeFactor=t.style.rain.state.intensity,v.color=structuredClone(t.style.rain.state.color),S=structuredClone(t.style.rain.state.direction),v.screenThinning.intensity=t.style.rain.state.centerThinning,v.dropletSizeX=t.style.rain.state.dropletSize[0],v.dropletSizeYScale=t.style.rain.state.dropletSize[1]/t.style.rain.state.dropletSize[0],v.distortionStrength=100*t.style.rain.state.distortionStrength,I.strength=1,I.color=structuredClone(t.style.rain.state.vignetteColor));const L=this.updateOnRender(t,v.timeFactor),D=t.context,B=D.gl,V=t.transform;this.screenTexture&&this.screenTexture.size[0]===t.width&&this.screenTexture.size[1]===t.height||(this.screenTexture=new r.T(D,{width:t.width,height:t.height,data:null},B.RGBA8)),v.distortionStrength>0&&(D.activeTexture.set(B.TEXTURE0),this.screenTexture.bind(B.LINEAR,B.CLAMP_TO_EDGE),B.copyTexSubImage2D(B.TEXTURE_2D,0,0,0,0,0,t.width,t.height));const U=t.getOrCreateProgram("rainParticle");t.uploadCommonUniforms(D,U),D.activeTexture.set(B.TEXTURE0),this.screenTexture.bind(B.LINEAR,B.CLAMP_TO_EDGE);const G=[v.color.r,v.color.g,v.color.b,v.color.a],re=(Q,ue)=>{const ce=Hd(this._movement.getPosition(),Q),ye=v.dropletSizeX,Ae=v.dropletSizeX*v.dropletSizeYScale,Ee=t.width/2,Fe=t.height/2,ze=bl(0,v.screenThinning.start,0,1,v.screenThinning.intensity),Oe=bl(.001,v.screenThinning.range,0,1,v.screenThinning.intensity),ke=bl(0,v.screenThinning.particleOffset,0,1,v.screenThinning.intensity),Ge=(Ze={modelview:L.modelviewMatrix,projection:L.projectionMatrix,time:this._accumulatedTimeFromStart,camPos:ce,velocityConeAperture:v.velocityConeAperture,velocity:v.velocity,boxSize:Q,rainDropletSize:[ye,Ae],distortionStrength:v.distortionStrength,rainDirection:S,color:G,screenSize:[V.width,V.height],thinningCenterPos:[Ee,Fe],thinningShape:[ze,Oe,Math.pow(10,v.screenThinning.fadePower)],thinningAffectedRatio:v.screenThinning.affectedRatio,thinningParticleOffset:ke,shapeDirectionalPower:v.shapeDirPower,shapeNormalPower:v.shapeNormalPower,mode:ue?0:1},{u_modelview:Float32Array.from(Ze.modelview),u_projection:Float32Array.from(Ze.projection),u_time:Ze.time,u_cam_pos:Ze.camPos,u_texScreen:0,u_velocityConeAperture:Ze.velocityConeAperture,u_velocity:Ze.velocity,u_boxSize:Ze.boxSize,u_rainDropletSize:Ze.rainDropletSize,u_distortionStrength:Ze.distortionStrength,u_rainDirection:Ze.rainDirection,u_color:Ze.color,u_screenSize:Ze.screenSize,u_thinningCenterPos:Ze.thinningCenterPos,u_thinningShape:Ze.thinningShape,u_thinningAffectedRatio:Ze.thinningAffectedRatio,u_thinningParticleOffset:Ze.thinningParticleOffset,u_shapeDirectionalPower:Ze.shapeDirectionalPower,u_shapeNormalPower:Ze.shapeNormalPower,u_mode:Ze.mode});var Ze;const ft=Math.round(g*v.intensity*this.particlesCount),ct=r.b7.simpleSegment(0,0,4*ft,2*ft);U.draw(t,B.TRIANGLES,Dn.disabled,or.disabled,Sr.alphaBlended,Wn.disabled,Ge,"rain_particles",this.particlesVx,this.particlesIdx,ct,{})};v.distortionStrength>0&&re(v.boxSize,!0),re(v.boxSize,!1),this._vignette.draw(t,I)}}const Ff=r.da([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_snowParticleData",components:4},{type:"Float32",name:"a_snowParticleDataHorizontalOscillation",components:2}]);class dh extends su{constructor(t){super(2.25),this._params={overrideStyleParameters:!1,intensity:.85,timeFactor:.75,velocityConeAperture:70,velocity:40,horizontalOscillationRadius:4,horizontalOscillationRate:1.5,boxSize:2e3,billboardSize:2,shapeFadeStart:.27,shapeFadePower:.21,screenThinning:{intensity:.4,start:.15,range:1.4,fadePower:.24,affectedRatio:1,particleOffset:-.2},color:{r:1,g:1,b:1,a:1},direction:{x:-50,y:-35}},this._revealParams=new hh(t.tp,["Precipitation","Snow"]),this._vignetteParams={strength:.3,start:.78,range:.46,fadePower:.2,color:{r:1,g:1,b:1,a:1}},this.particlesCount=16e3}update(t){const o=t.context;if(!this.particlesVx){const h=Wd(this.particlesCount),g=new r.du,v=new r.aU;let S=0;const I=r.di(1323123451230);for(let L=0;L<h.length;++L){const D=h[L],B=I(),V=I(),U=I(),G=[L/h.length,B,V,U],re=[I(),I()];g.emplaceBack(D[0],D[1],D[2],-1,-1,...G,...re),g.emplaceBack(D[0],D[1],D[2],1,-1,...G,...re),g.emplaceBack(D[0],D[1],D[2],1,1,...G,...re),g.emplaceBack(D[0],D[1],D[2],-1,1,...G,...re),v.emplaceBack(S+0,S+1,S+2),v.emplaceBack(S+0,S+2,S+3),S+=4}this.particlesVx=o.createVertexBuffer(g,Ff.members),this.particlesIdx=o.createIndexBuffer(v)}}draw(t){if(!this._params.overrideStyleParameters&&!t.style.snow)return;const o=structuredClone(this._params);let h=[-o.direction.x,o.direction.y,-100];r.ab.vec3.normalize(h,h);const g=structuredClone(this._vignetteParams),v=o.overrideStyleParameters?this._revealParams:{revealStart:0,revealRange:.01},S=t.transform.zoom;if(v.revealStart>S)return;const I=bl(0,1,v.revealStart,v.revealStart+v.revealRange,S);g.strength*=I,o.overrideStyleParameters||(o.intensity=t.style.snow.state.density,o.timeFactor=t.style.snow.state.intensity,o.color=structuredClone(t.style.snow.state.color),h=structuredClone(t.style.snow.state.direction),o.screenThinning.intensity=t.style.snow.state.centerThinning,o.billboardSize=2.79*t.style.snow.state.flakeSize,g.strength=1,g.color=structuredClone(t.style.snow.state.vignetteColor));const L=this.updateOnRender(t,o.timeFactor);if(!this.particlesVx||!this.particlesIdx)return;const D=t.context,B=D.gl,V=t.transform,U=t.getOrCreateProgram("snowParticle");t.uploadCommonUniforms(D,U),((G,re,Q)=>{const ue=Hd(this._movement.getPosition(),G),ce=V.width/2,ye=V.height/2,Ae=bl(0,Q.screenThinning.start,0,1,Q.screenThinning.intensity),Ee=bl(.001,Q.screenThinning.range,0,1,Q.screenThinning.intensity),Fe=bl(0,Q.screenThinning.particleOffset,0,1,Q.screenThinning.intensity),ze=(Oe={modelview:L.modelviewMatrix,projection:L.projectionMatrix,time:this._accumulatedTimeFromStart,camPos:ue,velocityConeAperture:Q.velocityConeAperture,velocity:Q.velocity,horizontalOscillationRadius:Q.horizontalOscillationRadius,horizontalOscillationRate:Q.horizontalOscillationRate,boxSize:G,billboardSize:1*Q.billboardSize,simpleShapeParameters:[Q.shapeFadeStart,Q.shapeFadePower],screenSize:[V.width,V.height],thinningCenterPos:[ce,ye],thinningShape:[Ae,Ee,Math.pow(10,Q.screenThinning.fadePower)],thinningAffectedRatio:Q.screenThinning.affectedRatio,thinningParticleOffset:Fe,color:[Q.color.r,Q.color.g,Q.color.b,Q.color.a],direction:h},{u_modelview:Float32Array.from(Oe.modelview),u_projection:Float32Array.from(Oe.projection),u_time:Oe.time,u_cam_pos:Oe.camPos,u_velocityConeAperture:Oe.velocityConeAperture,u_velocity:Oe.velocity,u_horizontalOscillationRadius:Oe.horizontalOscillationRadius,u_horizontalOscillationRate:Oe.horizontalOscillationRate,u_boxSize:Oe.boxSize,u_billboardSize:Oe.billboardSize,u_simpleShapeParameters:Oe.simpleShapeParameters,u_screenSize:Oe.screenSize,u_thinningCenterPos:Oe.thinningCenterPos,u_thinningShape:Oe.thinningShape,u_thinningAffectedRatio:Oe.thinningAffectedRatio,u_thinningParticleOffset:Oe.thinningParticleOffset,u_particleColor:Oe.color,u_direction:Oe.direction});var Oe;const ke=Math.round(I*Q.intensity*this.particlesCount),Ge=r.b7.simpleSegment(0,0,4*ke,2*ke);this.particlesVx&&this.particlesIdx&&U.draw(t,B.TRIANGLES,Dn.disabled,or.disabled,Sr.alphaBlended,Wn.disabled,ze,"snow_particles",this.particlesVx,this.particlesIdx,Ge,{})})(o.boxSize,0,o),this._vignette.draw(t,g)}}const Pc={symbol:function(u,t,o,h,g){if(u.renderPass!=="translucent")return;const v=or.disabled,S=u.colorModeForRenderPass(),I=o.layout.get("text-variable-anchor"),L=o.layout.get("text-size-scale-range"),D=r.aw(u.scaleFactor,L[0],L[1]);I&&function(U,G,re,Q,ue,ce,ye,Ae){const Ee=G.transform,Fe=ue==="map",ze=ce==="map";for(const Oe of U){const ke=Q.getTile(Oe),Ge=ke.getBucket(re);if(!Ge||!Ge.text||!Ge.text.segments.get().length)continue;const Ze=r.bp(Ge.textSizeData,Ee.zoom,Ae),ft=Jl(Oe,Ge.getProjection(),Ee),ct=Ee.calculatePixelsToTileUnitsMatrix(ke),We=ds(ft,ke.tileID.canonical,ze,Fe,Ee,Ge.getProjection(),ct),tt=Ge.hasIconTextFit()&&Ge.hasIconData();if(Ze){const zt=Math.pow(2,Ee.zoom-ke.tileID.overscaledZ);Ma(Ge,Fe,ze,ye,r.cX,Ee,We,Oe,zt,Ze,tt)}}}(h,u,o,t,o.layout.get("text-rotation-alignment"),o.layout.get("text-pitch-alignment"),g,D);const B=o.paint.get("icon-opacity").constantOr(1)!==0,V=o.paint.get("text-opacity").constantOr(1)!==0;o.layout.get("symbol-sort-key").constantOr(1)!==void 0&&(B||V)?Yi(u,t,o,h,v,S):(B&&Yi(u,t,o,h,v,S,{onlyIcons:!0}),V&&Yi(u,t,o,h,v,S,{onlyText:!0})),t.map.showCollisionBoxes&&(Fi(u,t,o,h,o.paint.get("text-translate"),o.paint.get("text-translate-anchor"),!0),Fi(u,t,o,h,o.paint.get("icon-translate"),o.paint.get("icon-translate-anchor"),!1))},circle:function(u,t,o,h){if(u.renderPass!=="translucent")return;const g=o.paint.get("circle-opacity"),v=o.paint.get("circle-stroke-width"),S=o.paint.get("circle-stroke-opacity"),I=o.layout.get("circle-sort-key").constantOr(1)!==void 0,L=o.paint.get("circle-emissive-strength");if(g.constantOr(1)===0&&(v.constantOr(1)===0||S.constantOr(1)===0))return;const D=u.context,B=D.gl,V=u.transform,U=u.depthModeForSublayer(0,Dn.ReadOnly),G=or.disabled,re=u.colorModeForDrapableLayerRenderPass(L),Q=V.projection.name==="globe",ue=[r.at(V.center.lng),r.aA(V.center.lat)],ce=[];for(let Ae=0;Ae<h.length;Ae++){const Ee=h[Ae],Fe=t.getTile(Ee),ze=Fe.getBucket(o);if(!ze||ze.projection.name!==V.projection.name)continue;const Oe=ze.programConfigurations.get(o.id),ke=r.cY(o),Ge=u.isTileAffectedByFog(Ee);Q&&ke.push("PROJECTION_GLOBE_VIEW"),ke.push("DEPTH_D24"),u.terrain&&V.depthOcclusionForSymbolsAndCircles&&ke.push("DEPTH_OCCLUSION");const Ze=u.getOrCreateProgram("circle",{config:Oe,defines:ke,overrideFog:Ge}),ft=ze.layoutVertexBuffer,ct=ze.globeExtVertexBuffer,We=ze.indexBuffer,tt=V.projection.createInversionMatrix(V,Ee.canonical),zt={programConfiguration:Oe,program:Ze,layoutVertexBuffer:ft,globeExtVertexBuffer:ct,indexBuffer:We,uniformValues:r.cZ(u,Ee,Fe,tt,ue,o),tile:Fe};if(I){const Gt=ze.segments.get();for(const Yt of Gt)ce.push({segments:new r.b7([Yt]),sortKey:Yt.sortKey,state:zt})}else ce.push({segments:ze.segments,sortKey:0,state:zt})}I&&ce.sort((Ae,Ee)=>Ae.sortKey-Ee.sortKey);const ye={useDepthForOcclusion:V.depthOcclusionForSymbolsAndCircles};for(const Ae of ce){const{programConfiguration:Ee,program:Fe,layoutVertexBuffer:ze,globeExtVertexBuffer:Oe,indexBuffer:ke,uniformValues:Ge,tile:Ze}=Ae.state,ft=Ae.segments;u.terrain&&u.terrain.setupElevationDraw(Ze,Fe,ye),u.uploadCommonUniforms(D,Fe,Ze.tileID.toUnwrapped()),Fe.draw(u,B.TRIANGLES,U,G,re,Wn.disabled,Ge,o.id,ze,ke,ft,o.paint,V.zoom,Ee,[Oe])}},heatmap:function(u,t,o,h){if(o.paint.get("heatmap-opacity")!==0)if(u.renderPass==="offscreen"){const g=u.context,v=g.gl,S=or.disabled,I=new Sr([v.ONE,v.ONE,v.ONE,v.ONE],r.aj.transparent,[!0,!0,!0,!0]);(function(G,re,Q,ue){const ce=G.gl,ye=re.width*ue,Ae=re.height*ue;G.activeTexture.set(ce.TEXTURE1),G.viewport.set([0,0,ye,Ae]);let Ee=Q.heatmapFbo;if(!Ee||Ee&&(Ee.width!==ye||Ee.height!==Ae)){Ee&&Ee.destroy();const Fe=ce.createTexture();ce.bindTexture(ce.TEXTURE_2D,Fe),ce.texParameteri(ce.TEXTURE_2D,ce.TEXTURE_WRAP_S,ce.CLAMP_TO_EDGE),ce.texParameteri(ce.TEXTURE_2D,ce.TEXTURE_WRAP_T,ce.CLAMP_TO_EDGE),ce.texParameteri(ce.TEXTURE_2D,ce.TEXTURE_MIN_FILTER,ce.LINEAR),ce.texParameteri(ce.TEXTURE_2D,ce.TEXTURE_MAG_FILTER,ce.LINEAR),Ee=Q.heatmapFbo=G.createFramebuffer(ye,Ae,!0,null),function(ze,Oe,ke,Ge,Ze,ft){const ct=ze.gl;ct.texImage2D(ct.TEXTURE_2D,0,ze.extRenderToTextureHalfFloat?ct.RGBA16F:ct.RGBA,Ze,ft,0,ct.RGBA,ze.extRenderToTextureHalfFloat?ct.HALF_FLOAT:ct.UNSIGNED_BYTE,null),Ge.colorAttachment.set(ke)}(G,0,Fe,Ee,ye,Ae)}else ce.bindTexture(ce.TEXTURE_2D,Ee.colorAttachment.get()),G.bindFramebuffer.set(Ee.framebuffer)})(g,u,o,u.transform.projection.name==="globe"?.5:.25),g.clear({color:r.aj.transparent});const L=u.transform,D=L.projection.name==="globe",B=D?["PROJECTION_GLOBE_VIEW"]:[],V=D?Wn.frontCCW:Wn.disabled,U=[r.at(L.center.lng),r.aA(L.center.lat)];for(let G=0;G<h.length;G++){const re=h[G];if(t.hasRenderableParent(re))continue;const Q=t.getTile(re),ue=Q.getBucket(o);if(!ue||ue.projection.name!==L.projection.name)continue;const ce=u.isTileAffectedByFog(re),ye=ue.programConfigurations.get(o.id),Ae=u.getOrCreateProgram("heatmap",{config:ye,defines:B,overrideFog:ce}),{zoom:Ee}=u.transform;u.terrain&&u.terrain.setupElevationDraw(Q,Ae),u.uploadCommonUniforms(g,Ae,re.toUnwrapped());const Fe=L.projection.createInversionMatrix(L,re.canonical);Ae.draw(u,v.TRIANGLES,Dn.disabled,S,I,V,$(u,re,Q,Fe,U,Ee,o.paint.get("heatmap-intensity")),o.id,ue.layoutVertexBuffer,ue.indexBuffer,ue.segments,o.paint,u.transform.zoom,ye,D?[ue.globeExtVertexBuffer]:null)}g.viewport.set([0,0,u.width,u.height])}else u.renderPass==="translucent"&&(u.context.setColorMode(u.colorModeForRenderPass()),function(g,v){const S=g.context,I=S.gl,L=v.heatmapFbo;if(!L)return;S.activeTexture.set(I.TEXTURE0),I.bindTexture(I.TEXTURE_2D,L.colorAttachment.get()),S.activeTexture.set(I.TEXTURE1);let D=v.colorRampTexture;D||(D=v.colorRampTexture=new r.T(S,v.colorRamp,I.RGBA8)),D.bind(I.LINEAR,I.CLAMP_TO_EDGE),g.getOrCreateProgram("heatmapTexture").draw(g,I.TRIANGLES,Dn.disabled,or.disabled,g.colorModeForRenderPass(),Wn.disabled,((B,V,U,G)=>({u_image:0,u_color_ramp:1,u_opacity:V.paint.get("heatmap-opacity")}))(0,v),v.id,g.viewportBuffer,g.quadTriangleIndexBuffer,g.viewportSegments,v.paint,g.transform.zoom)}(u,o))},line:function(u,t,o,h){if(u.renderPass!=="translucent")return;const g=o.paint.get("line-opacity"),v=o.paint.get("line-width");if(g.constantOr(1)===0||v.constantOr(1)===0)return;const S=o.paint.get("line-emissive-strength"),I=o.paint.get("line-occlusion-opacity"),L=o.layout.get("line-elevation-reference"),D=o.layout.get("line-width-unit")==="meters",B=L==="sea",V=u.context,U=V.gl,G=!o.isDraped();if(G&&u.transform.projection.name==="globe")return;const re=o.layout.get("line-cross-slope"),Q=re!==void 0,ue=re<1,ce=G?new Dn(u.depthOcclusion?U.GREATER:U.LEQUAL,Dn.ReadOnly,u.depthRangeFor3D):u.depthModeForSublayer(0,Dn.ReadOnly),ye=u.colorModeForDrapableLayerRenderPass(S),Ae=u.terrain&&u.terrain.renderingToTexture,Ee=Ae?1:r.q.devicePixelRatio,Fe=o.paint.get("line-dasharray"),ze=Fe.constantOr(1),Oe=o.layout.get("line-cap"),ke=Fe.constantOr(null),Ge=Oe.constantOr(null),Ze=o.paint.get("line-pattern"),ft=Ze.constantOr(1),ct=Ze.constantOr(null),We=o.paint.get("line-opacity").constantOr(1);let tt=!ft&&We!==1||u.depthOcclusion&&I>0&&I<1;const zt=o.paint.get("line-gradient"),Gt=ft?"linePattern":"line",Yt=r.c_(o);let dt;if(Ae&&u.terrain&&u.terrain.clipOrMaskOverlapStencilType()&&(tt=!1),I!==0&&u.depthOcclusion){const Et=o.paint._values["line-opacity"];Et&&Et.value&&Et.value.kind==="constant"?dt=Et.value:r.w(`Occlusion opacity for layer ${o.id} is supported only when line-opacity isn't data-driven.`)}if(G&&(u.forceTerrainMode=!0),!G&&I!==0&&u.terrain&&!Ae)return void r.w(`Occlusion opacity for layer ${o.id} is supported on terrain only if the layer has line-z-offset enabled.`);const Ft=tt&&G?u.stencilModeFor3D():or.disabled;G&&(Yt.push("ELEVATED"),Q&&Yt.push(ue?"CROSS_SLOPE_HORIZONTAL":"CROSS_SLOPE_VERTICAL"),B&&Yt.push("ELEVATION_REFERENCE_SEA")),v.value.kind!=="constant"&&v.value.isLineProgressConstant===!1&&Yt.push("VARIABLE_LINE_WIDTH");for(const Et of h){const rn=t.getTile(Et);if(ft&&!rn.patternsLoaded())continue;const Vt=rn.getBucket(o);if(!Vt)continue;u.prepareDrawTile();const kt=Vt.programConfigurations.get(o.id),_n=u.isTileAffectedByFog(Et),gn=u.getOrCreateProgram(Gt,{config:kt,defines:Yt,overrideFog:_n,overrideRtt:!G&&void 0});if(ct&&rn.imageAtlas){const pr=r.A.from(ct),Oi=rn.imageAtlas.patternPositions[pr.getSerializedPrimary()];Oi&&kt.setConstantPatternPositions(Oi)}if(!ft&&ke&&Ge&&rn.lineAtlas){const pr=rn.lineAtlas.getDash(ke,Ge);pr&&kt.setConstantPatternPositions(pr)}let[ln,xn]=o.paint.get("line-trim-offset");(Ge==="round"||Ge==="square")&&ln!==xn&&(ln===0&&(ln-=1),xn===1&&(xn+=1));const tr=Ae?Et.projMatrix:null,Ln=D?1/Vt.tileToMeter/r.ar(rn,1,u.transform.zoom):1,Fn=D?1/Vt.tileToMeter/r.ar(rn,1,Math.floor(u.transform.zoom)):1,Yn=ft?r.c$(u,rn,o,tr,Ee,Ln,Fn,[ln,xn]):r.d0(u,rn,o,tr,Vt.lineClipsArray.length,Ee,Ln,Fn,[ln,xn]);if(zt){const pr=Vt.gradients[o.id];let Oi=pr.texture;if(o.gradientVersion!==pr.version){let Si=256;if(o.stepInterpolant){const si=t.getSource().maxzoom,Fr=Et.canonical.z===si?Math.ceil(1<<u.transform.maxZoom-Et.canonical.z):1;Si=r.aw(r.d1(Vt.maxLineLength/r.ag*1024*Fr),256,V.maxTextureSize)}pr.gradient=r.d2({expression:o.gradientExpression(),evaluationKey:"lineProgress",resolution:Si,image:pr.gradient||void 0,clips:Vt.lineClipsArray}),pr.texture?pr.texture.update(pr.gradient):pr.texture=new r.T(V,pr.gradient,U.RGBA8),pr.version=o.gradientVersion,Oi=pr.texture}V.activeTexture.set(U.TEXTURE1),Oi.bind(o.stepInterpolant?U.NEAREST:U.LINEAR,U.CLAMP_TO_EDGE)}ze&&(V.activeTexture.set(U.TEXTURE0),rn.lineAtlasTexture&&rn.lineAtlasTexture.bind(U.LINEAR,U.REPEAT),kt.updatePaintBuffers()),ft&&(V.activeTexture.set(U.TEXTURE0),rn.imageAtlasTexture&&rn.imageAtlasTexture.bind(U.LINEAR,U.CLAMP_TO_EDGE),kt.updatePaintBuffers()),G&&!B&&u.terrain.setupElevationDraw(rn,gn),u.uploadCommonUniforms(V,gn,Et.toUnwrapped());const Dr=pr=>{dt!=null&&(dt.value=We*I),gn.draw(u,U.TRIANGLES,ce,pr,ye,Wn.disabled,Yn,o.id,Vt.layoutVertexBuffer,Vt.indexBuffer,Vt.segments,o.paint,u.transform.zoom,kt,[Vt.layoutVertexBuffer2,Vt.patternVertexBuffer,Vt.zOffsetVertexBuffer]),dt!=null&&(dt.value=We)};if(tt&&!G){const pr=u.stencilModeForClipping(Et).ref;pr===0&&Ae&&V.clear({stencil:0});const Oi={func:U.EQUAL,mask:255};Yn.u_alpha_discard_threshold=.8,Dr(new or(Oi,pr,255,U.KEEP,U.KEEP,U.INVERT)),Yn.u_alpha_discard_threshold=0,Dr(new or(Oi,pr,255,U.KEEP,U.KEEP,U.KEEP))}else tt&&G&&(Yn.u_alpha_discard_threshold=.001),Dr(G?Ft:u.stencilModeForClipping(Et))}G&&(u.forceTerrainMode=!1),tt&&(u.resetStencilClippingMasks(),Ae&&V.clear({stencil:0})),I===0||u.depthOcclusion||Ae||u.layersWithOcclusionOpacity.push(u.currentLayer)},fill:function(u,t,o,h){const g=o.paint.get("fill-color"),v=o.paint.get("fill-opacity"),S=o.is3D(),I=new Dn(u.context.gl.LEQUAL,Dn.ReadWrite,u.depthRangeFor3D);if(v.constantOr(1)===0)return;const L=o.paint.get("fill-emissive-strength"),D=u.colorModeForDrapableLayerRenderPass(L),B=o.paint.get("fill-pattern"),V=u.opaquePassEnabledForLayer()&&!B.constantOr(1)&&g.constantOr(r.aj.transparent).a===1&&v.constantOr(0)===1?"opaque":"translucent";if(u.renderPass===V){const U=S?I:u.depthModeForSublayer(1,u.renderPass==="opaque"?Dn.ReadWrite:Dn.ReadOnly);Ds(u,t,o,h,U,D,!1)}if(!S&&u.renderPass==="translucent"&&o.paint.get("fill-antialias")){const U=S?I:u.depthModeForSublayer(o.getPaintProperty("fill-outline-color")?2:0,Dn.ReadOnly);Ds(u,t,o,h,U,D,!0)}},"fill-extrusion":function(u,t,o,h){const g=o.paint.get("fill-extrusion-opacity"),v=u.context,S=v.gl,I=u.terrain,L=I&&I.renderingToTexture;if(g===0)return;const D=u.conflationActive&&u.style.isLayerClipped(o,t.getSource()),B=u.style.order.indexOf(o.fqid);if(D&&function(V,U,G,re,Q){for(const ue of re){const ce=U.getTile(ue).getBucket(G);ce&&(ce.updateReplacement(ue,V.replacementSource,Q),ce.uploadCentroid(V.context))}}(u,t,o,h,B),I||D)for(const V of h){const U=t.getTile(V).getBucket(o);U&&Us(u.context,t,V,U,o,I,D)}if(u.renderPass==="shadow"&&u.shadowRenderer){const V=u.shadowRenderer;if(I&&g<.65&&o._transitionablePaint._values["fill-extrusion-opacity"].value.expression instanceof r.a9)return;const U=V.getShadowPassDepthMode(),G=V.getShadowPassColorMode();Hi(u,t,o,h,U,or.disabled,G,D)}else if(u.renderPass==="translucent"){const V=!o.paint.get("fill-extrusion-pattern").constantOr(1),U=o.paint.get("fill-extrusion-color").constantOr(r.aj.white);if(!L&&U.a!==0){const G=new Dn(u.context.gl.LEQUAL,Dn.ReadWrite,u.depthRangeFor3D);g===1&&V?Hi(u,t,o,h,G,or.disabled,Sr.unblended,D):(Hi(u,t,o,h,G,or.disabled,Sr.disabled,D),Hi(u,t,o,h,G,u.stencilModeFor3D(),u.colorModeForRenderPass(),D),u.resetStencilClippingMasks())}if(u.style.enable3dLights()&&V&&(!I&&u.transform.projection.name!=="globe"||L)){const G=o.paint.get("fill-extrusion-opacity"),re=o.paint.get("fill-extrusion-ambient-occlusion-intensity"),Q=o.paint.get("fill-extrusion-ambient-occlusion-ground-radius"),ue=o.paint.get("fill-extrusion-flood-light-intensity"),ce=o.paint.get("fill-extrusion-flood-light-color-use-theme").constantOr("default")==="none",ye=o.paint.get("fill-extrusion-flood-light-color").toRenderColor(ce?null:o.lut).toArray01().slice(0,3),Ae=re>0&&Q>0,Ee=ue>0,Fe=(Oe,ke,Ge)=>(1-Ge)*Oe+Ge*ke,ze=Oe=>{const ke=u.depthModeForSublayer(1,Dn.ReadOnly,S.LEQUAL,!0),Ge=o.paint.get(Oe?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),Ze=Fe(.1,3,Ge),ft=u._showOverdrawInspector;if(!ft){const ct=new or({func:S.ALWAYS,mask:255},255,255,S.KEEP,S.KEEP,S.REPLACE),We=new Sr([S.ONE,S.ONE,S.ONE,S.ONE],r.aj.transparent,[!1,!1,!1,!0],S.MIN);vs(u,t,o,h,ke,ct,We,Wn.disabled,Oe,"sdf",G,re,Q,ue,ye,Ze,D,!1)}{const ct=ft?or.disabled:new or({func:S.EQUAL,mask:255},255,255,S.KEEP,S.DECR,S.DECR),We=ft?u.colorModeForRenderPass():new Sr([S.ONE_MINUS_DST_ALPHA,S.DST_ALPHA,S.ONE,S.ONE],r.aj.transparent,[!0,!0,!0,!0]);vs(u,t,o,h,ke,ct,We,Wn.disabled,Oe,"color",G,re,Q,ue,ye,Ze,D,!1)}};if(L){const Oe=(ke,Ge,Ze)=>{const ft=u.depthModeForSublayer(1,Dn.ReadOnly,S.LEQUAL,!1),ct=o.paint.get(ke?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),We=Fe(.1,3,ct);{const tt=new Sr([S.ONE,S.ONE,S.ONE,S.ONE],r.aj.transparent,[!1,!1,!1,!0]);vs(u,t,o,h,ft,or.disabled,tt,Wn.disabled,ke,"clear",G,re,Q,ue,ye,We,D,Ge)}{const tt=new or({func:S.ALWAYS,mask:255},255,255,S.KEEP,S.KEEP,S.REPLACE),zt=new Sr([S.ONE,S.ONE,S.ONE,S.ONE],r.aj.transparent,[!1,!1,!1,!0],S.MIN);vs(u,t,o,h,ft,tt,zt,Wn.disabled,ke,"sdf",G,re,Q,ue,ye,We,D,Ge)}{const tt=ke?S.ZERO:S.ONE_MINUS_DST_ALPHA,zt=new or({func:S.EQUAL,mask:255},255,255,S.KEEP,S.DECR,S.DECR),Gt=new Sr([tt,S.DST_ALPHA,S.ONE_MINUS_DST_ALPHA,S.ZERO],r.aj.transparent,[!0,!0,!0,!0]);vs(u,t,o,h,ft,zt,Gt,Wn.disabled,ke,"color",G,re,Q,ue,ye,We,D,Ge)}{const tt=new Sr([S.ONE,S.ONE,S.ONE,ke?S.ZERO:S.ONE],r.aj.transparent,[!1,!1,!1,!0],ke?S.FUNC_ADD:S.MAX);vs(u,t,o,h,ft,or.disabled,tt,Wn.disabled,ke,"clear",G,re,Q,ue,ye,We,D,Ge,Ze)}};if(Ae||Ee){let ke;if(u.prepareDrawTile(),I){const Ge=I.drapeBufferSize[0],Ze=I.drapeBufferSize[1];ke=I.framebufferCopyTexture,ke&&(!ke||ke.size[0]===Ge&&ke.size[1]===Ze)||(ke&&ke.destroy(),ke=I.framebufferCopyTexture=new r.T(v,new r.r({width:Ge,height:Ze}),S.RGBA8)),ke.bind(S.LINEAR,S.CLAMP_TO_EDGE),S.copyTexSubImage2D(S.TEXTURE_2D,0,0,0,0,0,Ge,Ze)}Ae&&Oe(!0,!1,ke),Ee&&Oe(!1,!0,ke)}}else Ae&&ze(!0),Ee&&ze(!1),(Ae||Ee)&&u.resetStencilClippingMasks()}}},hillshade:function(u,t,o,h){if(u.renderPass!=="offscreen"&&u.renderPass!=="translucent"||u.style.disableElevatedTerrain)return;const g=u.context,v=u.terrain&&u.terrain.renderingToTexture,[S,I]=u.renderPass!=="translucent"||v?[{},h]:u.stencilConfigForOverlap(h);for(const L of I){const D=t.getTile(L);if(D.needsHillshadePrepare&&u.renderPass==="offscreen")Sc(u,D,o);else if(u.renderPass==="translucent"){const B=u.depthModeForSublayer(0,Dn.ReadOnly),V=o.paint.get("hillshade-emissive-strength"),U=u.colorModeForDrapableLayerRenderPass(V),G=v&&u.terrain?u.terrain.stencilModeForRTTOverlap(L):S[L.overscaledZ];ic(u,L,D,o,B,G,U)}}g.viewport.set([0,0,u.width,u.height]),u.resetStencilClippingMasks()},raster:function(u,t,o,h,g,v){if(u.renderPass!=="translucent"||o.paint.get("raster-opacity")===0)return;const S=u.transform.projection.name==="globe",I=o.paint.get("raster-elevation")!==0,L=I&&S;if(u.renderElevatedRasterBackface&&!L)return;const D=u.context,B=D.gl,V=t.getSource(),U=function(ze,Oe,ke,Ge){const Ze=Oe.paint.get("raster-color"),ft=ze.type==="raster-array",ct=[],We=Oe.paint.get("raster-resampling"),tt=Oe.paint.get("raster-color-mix");let zt=Oe.paint.get("raster-color-range");const Gt=[tt[0],tt[1],tt[2],0],Yt=tt[3];let dt=We==="nearest"?Ge.NEAREST:Ge.LINEAR;if(ft&&(ct.push("RASTER_ARRAY"),Ze||ct.push("RASTER_COLOR"),We==="linear"&&ct.push("RASTER_ARRAY_LINEAR"),dt=Ge.NEAREST,!zt&&ze.rasterLayers)){const Ft=ze.rasterLayers.find(({id:Et})=>Et===Oe.sourceLayer);Ft&&Ft.fields&&Ft.fields.range&&(zt=Ft.fields.range)}if(zt=zt||[0,1],Ze){ct.push("RASTER_COLOR"),ke.activeTexture.set(Ge.TEXTURE2),Oe.updateColorRamp(zt);let Ft=Oe.colorRampTexture;Ft||(Ft=Oe.colorRampTexture=new r.T(ke,Oe.colorRamp,Ge.RGBA8)),Ft.bind(Ge.LINEAR,Ge.CLAMP_TO_EDGE)}return{mix:Gt,range:zt,offset:Yt,defines:ct,resampling:dt}}(V,o,D,B);if(V instanceof r.aJ&&!h.length&&!S)return;const G=o.paint.get("raster-emissive-strength"),re=u.colorModeForDrapableLayerRenderPass(G),Q=u.terrain&&u.terrain.renderingToTexture,ue=!u.options.moving,ce=o.paint.get("raster-resampling")==="nearest"?B.NEAREST:B.LINEAR;if(V instanceof r.aJ&&!h.length&&(V.onNorthPole||V.onSouthPole)){const ze=I?u.stencilModeFor3D():or.disabled;return void an(!!V.onNorthPole,null,u,t,o,G,U,Wn.disabled,ze)}if(!h.length)return;const[ye,Ae]=V instanceof r.aJ||Q?[{},h]:u.stencilConfigForOverlap(h),Ee=Ae[Ae.length-1].overscaledZ;L&&U.defines.push("PROJECTION_GLOBE_VIEW"),I&&U.defines.push("RENDER_CUTOFF");const Fe=(ze,Oe,ke)=>{for(const Ge of ze){const Ze=Ge.toUnwrapped(),ft=t.getTile(Ge);if(Q&&(!ft||!ft.hasData()))continue;D.activeTexture.set(B.TEXTURE0);const ct=$i(ft,V,o,U);if(!ct||!ct.texture)continue;const{texture:We,mix:tt,offset:zt,tileSize:Gt,buffer:Yt}=ct;let dt,Ft;Q?(dt=Dn.disabled,Ft=Ge.projMatrix):I?(dt=new Dn(B.LEQUAL,Dn.ReadWrite,u.depthRangeFor3D),Ft=S?Float32Array.from(u.transform.expandedFarZProjMatrix):u.transform.calculateProjMatrix(Ze,ue)):(dt=u.depthModeForSublayer(Ge.overscaledZ-Ee,o.paint.get("raster-opacity")===1?Dn.ReadWrite:Dn.ReadOnly,B.LESS),Ft=u.transform.calculateProjMatrix(Ze,ue));const Et=u.terrain&&Q?u.terrain.stencilModeForRTTOverlap(Ge):ye[Ge.overscaledZ],rn=v?0:o.paint.get("raster-fade-duration");ft.registerFadeDuration(rn);const Vt=t.findLoadedParent(Ge,0),kt=ha(ft,Vt,t,u.transform,rn);let _n,gn;u.terrain&&u.terrain.prepareDrawTile(),D.activeTexture.set(B.TEXTURE0),We.bind(ce,B.CLAMP_TO_EDGE),D.activeTexture.set(B.TEXTURE1),Vt?(Vt.texture&&Vt.texture.bind(ce,B.CLAMP_TO_EDGE),_n=Math.pow(2,Vt.tileID.overscaledZ-ft.tileID.overscaledZ),gn=[ft.tileID.canonical.x*_n%1,ft.tileID.canonical.y*_n%1]):We.bind(ce,B.CLAMP_TO_EDGE),We.useMipmap&&D.extTextureFilterAnisotropic&&u.transform.pitch>20&&B.texParameterf(B.TEXTURE_2D,D.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,D.extTextureFilterAnisotropicMax);const ln=u.transform;let xn;const tr=I?Qs(ln):[0,0,0,0];let Ln,Fn,Yn,Dr,pr,Oi=0;if(L&&V instanceof r.aJ&&V.coordinates.length>3)Ln=Float32Array.from(r.bb(r.cH(new r.bT(0,0,0)))),Fn=Float32Array.from(ln.globeMatrix),Yn=Float32Array.from(r.cD(ln)),Dr=[r.at(ln.center.lng),r.aA(ln.center.lat)],xn=V.elevatedGlobePerspectiveTransform,pr=V.elevatedGlobeGridMatrix||new Float32Array(9);else if(L){const ur=r.cE(Ge.canonical);Oi=r.cF(ur.getCenter().lat),Ln=Float32Array.from(r.bb(r.cH(Ge.canonical))),Fn=Float32Array.from(ln.globeMatrix),Yn=Float32Array.from(r.cD(ln)),Dr=[r.at(ln.center.lng),r.aA(ln.center.lat)],xn=[0,0],pr=Float32Array.from(r.cG(Ge.canonical,ur,Oi,ln.worldSize/ln._pixelsPerMercatorPixel))}else xn=V instanceof r.aJ?V.perspectiveTransform:[0,0],Ln=new Float32Array(16),Fn=new Float32Array(9),Yn=new Float32Array(16),Dr=[0,0],pr=new Float32Array(9);const Si=qe(Ft,Ln,Fn,Yn,pr,gn||[0,0],r.ae(u.transform.zoom),Dr,tr,_n||1,kt,o,xn,I?o.paint.get("raster-elevation"):0,2,tt,zt,U.range,Gt,Yt,G),si=u.isTileAffectedByFog(Ge),Fr=u.getOrCreateProgram("raster",{defines:U.defines,overrideFog:si});if(u.uploadCommonUniforms(D,Fr,Ze),V instanceof r.aJ){const ur=V.elevatedGlobeVertexBuffer,Er=V.elevatedGlobeIndexBuffer;if(Q||!S)V.boundsBuffer&&V.boundsSegments&&Fr.draw(u,B.TRIANGLES,dt,or.disabled,re,Wn.disabled,Si,o.id,V.boundsBuffer,u.quadTriangleIndexBuffer,V.boundsSegments);else if(ur&&Er){const Bn=ln.zoom<=r.c6?V.elevatedGlobeSegments:V.getSegmentsForLongitude(ln.center.lng);Bn&&Fr.draw(u,B.TRIANGLES,dt,or.disabled,re,Oe,Si,o.id,ur,Er,Bn)}}else if(L){dt=new Dn(B.LEQUAL,Dn.ReadOnly,u.depthRangeFor3D);const ur=u.globeSharedBuffers;if(ur){const[Er,Bn,ii]=ur.getGridBuffers(Oi,!1);Fr.draw(u,B.TRIANGLES,dt,ke||Et,u.colorModeForRenderPass(),Oe,Si,o.id,Er,Bn,ii)}}else{const{tileBoundsBuffer:ur,tileBoundsIndexBuffer:Er,tileBoundsSegments:Bn}=u.getTileBoundsBuffers(ft);Fr.draw(u,B.TRIANGLES,dt,Et,re,Wn.disabled,Si,o.id,ur,Er,Bn)}}if(!(V instanceof r.aJ)&&L)for(const Ge of ze){const Ze=Ge.canonical.y===(1<<Ge.canonical.z)-1;Ge.canonical.y===0&&an(!0,Ge,u,t,o,G,U,Oe,ke||or.disabled),Ze&&an(!1,Ge,u,t,o,G,U,Oe===Wn.frontCW?Wn.backCW:Wn.frontCW,ke||or.disabled)}};L?Fe(Ae,u.renderElevatedRasterBackface?Wn.backCW:Wn.frontCW,u.stencilModeFor3D()):Fe(Ae,Wn.disabled,void 0),u.resetStencilClippingMasks()},"raster-particle":function(u,t,o,h,g,v){u.renderPass==="offscreen"&&function(S,I,L,D){if(!D.length)return;const B=S.context,V=B.gl,U=I.getSource();if(!(U instanceof $o))return;const G=Math.ceil(Math.sqrt(L.paint.get("raster-particle-count")));let re=L.particlePositionRGBAImage;if(!re||re.width!==G){const Ae=function(Ee){const Fe=Ee*Ee,ze=new Uint8Array(4*Fe),Oe=function(Ge){return Ge|=0,Ge=Math.imul(2747636419^Ge,2654435769),Ge=Math.imul(Ge^Ge>>>16,2654435769),((Ge=Math.imul(Ge^Ge>>>16,2654435769))>>>0)/4294967296},ke=1/1.1;for(let Ge=0;Ge<Fe;Ge++){const Ze=ke*(Oe(2*Ge+0)+Qt),ft=ke*(Oe(2*Ge+1)+Qt),ct=255*Ze%1,We=255*ft%1,tt=ct,zt=ft-We/255,Gt=We;ze[4*Ge+0]=255*(Ze-ct/255),ze[4*Ge+1]=255*tt,ze[4*Ge+2]=255*zt,ze[4*Ge+3]=255*Gt}return ze}(G);re=L.particlePositionRGBAImage=new r.r({width:G,height:G},Ae)}let Q=L.particleFramebuffer;Q?Q.width!==G&&(Q.destroy(),Q=L.particleFramebuffer=B.createFramebuffer(G,G,!0,null)):Q=L.particleFramebuffer=B.createFramebuffer(G,G,!0,null);const ue=[];for(const Ae of D){const Ee=I.getTile(Ae);if(!(Ee instanceof nl))continue;const Fe=vl(Ee,U,L);if(!Fe)continue;const ze=[Ee.tileSize,Ee.tileSize];let Oe=L.tileFramebuffer;Oe||(Oe=L.tileFramebuffer=B.createFramebuffer(ze[0],ze[1],!0,null));let ke=Ee.rasterParticleState;ke||(ke=Ee.rasterParticleState=new Aa(B,Ae,ze,re));const Ge=ke.update(L.lastInvalidatedAt);ke.particleTextureDimension!==G&&ke.updateParticleTexture(Ae,re);const Ze=ke.targetColorTexture;ke.targetColorTexture=ke.backgroundColorTexture,ke.backgroundColorTexture=Ze;const ft=ke.particleTexture0;ke.particleTexture0=ke.particleTexture1,ke.particleTexture1=ft,ue.push([Ae,Fe,ke,Ge])}if(ue.length===0)return;const ce=r.q.now(),ye=L.previousDrawTimestamp?.001*(ce-L.previousDrawTimestamp):.0167;if(L.previousDrawTimestamp=ce,L.hasColorMap()){B.activeTexture.set(V.TEXTURE0+2);let Ae=L.colorRampTexture;Ae||(Ae=L.colorRampTexture=new r.T(B,L.colorRamp,V.RGBA8)),Ae.bind(V.LINEAR,V.CLAMP_TO_EDGE)}B.bindFramebuffer.set(L.tileFramebuffer.framebuffer),function(Ae,Ee,Fe){const ze=Ae.context,Oe=ze.gl,ke=Ee.tileFramebuffer;ze.activeTexture.set(Oe.TEXTURE0);const Ge={u_texture:0,u_opacity:1.05*(ft=Ee.paint.get("raster-particle-fade-opacity-factor"))/(ft+.05)},Ze=Ae.getOrCreateProgram("rasterParticleTexture",{defines:[],overrideFog:!1});var ft;for(const ct of Fe){const[,,We,tt]=ct;ke.colorAttachment.set(We.targetColorTexture.texture),ze.viewport.set([0,0,ke.width,ke.height]),ze.clear({color:r.aj.transparent}),tt&&(We.backgroundColorTexture.bind(Oe.NEAREST,Oe.CLAMP_TO_EDGE),Ze.draw(Ae,Oe.TRIANGLES,Dn.disabled,or.disabled,Sr.alphaBlended,Wn.disabled,Ge,Ee.id,Ae.viewportBuffer,Ae.quadTriangleIndexBuffer,Ae.viewportSegments))}}(S,L,ue),function(Ae,Ee,Fe,ze){const Oe=Ae.context,ke=Oe.gl,Ge=Fe.tileFramebuffer,Ze=Ae.transform.projection.name==="globe",ft=Fe.paint.get("raster-particle-max-speed");for(const ct of ze){const[We,tt,zt]=ct;Oe.activeTexture.set(ke.TEXTURE0+0),tt.texture.bind(ke.LINEAR,ke.CLAMP_TO_EDGE),Ge.colorAttachment.set(zt.targetColorTexture.texture);const Gt=Ae.getOrCreateProgram("rasterParticleDraw",{defines:tt.defines,overrideFog:!1});Oe.activeTexture.set(ke.TEXTURE0+1);const Yt=tt.scalarData?[]:[0,1,2,3].map(Et=>r.d4[Et](We));Yt.push(We);const dt=We.canonical.x,Ft=We.canonical.y;for(const Et of Yt){const rn=Ee.getTile(Ze?Et.wrapped():Et);if(!rn)continue;const Vt=rn.rasterParticleState;if(!Vt)continue;const kt=Et.canonical.x+(1<<Et.canonical.z)*(Et.wrap-We.wrap),_n=Et.canonical.y;Vt.particleTexture0.bind(ke.NEAREST,ke.CLAMP_TO_EDGE);const gn=An(1,Vt.particleTexture0.size[0],[kt-dt,_n-Ft],0,tt.texture.size,2,ft,tt.textureOffset,tt.scale,tt.offset);Gt.draw(Ae,ke.POINTS,Dn.disabled,or.disabled,Sr.alphaBlended,Wn.disabled,gn,Fe.id,Vt.particleIndexBuffer,void 0,Vt.particleSegment)}}}(S,I,L,ue),B.bindFramebuffer.set(L.particleFramebuffer.framebuffer),function(Ae,Ee,Fe,ze){const Oe=Ae.context,ke=Oe.gl,Ge=Ee.paint.get("raster-particle-max-speed"),Ze=ze*Ee.paint.get("raster-particle-speed-factor")*.15,ft=function(We){return Math.pow(We,6)}(.01+1*Ee.paint.get("raster-particle-reset-rate-factor")),ct=Ee.particleFramebuffer;Oe.viewport.set([0,0,ct.width,ct.height]);for(const We of Fe){const[,tt,zt]=We;Oe.activeTexture.set(ke.TEXTURE0+0),tt.texture.bind(ke.LINEAR,ke.CLAMP_TO_EDGE),Oe.activeTexture.set(ke.TEXTURE0+1);const Gt=zt.particleTexture0;Gt.bind(ke.NEAREST,ke.CLAMP_TO_EDGE);const Yt=Xt(1,Gt.size[0],0,tt.texture.size,Ge,Ze,ft,tt.textureOffset,tt.scale,tt.offset);ct.colorAttachment.set(zt.particleTexture1.texture),Oe.clear({color:r.aj.transparent}),Ae.getOrCreateProgram("rasterParticleUpdate",{defines:tt.defines}).draw(Ae,ke.TRIANGLES,Dn.disabled,or.disabled,Sr.unblended,Wn.disabled,Yt,Ee.id,Ae.viewportBuffer,Ae.quadTriangleIndexBuffer,Ae.viewportSegments)}}(S,L,ue,ye)}(u,t,o,h),u.renderPass==="translucent"&&(function(S,I,L,D,B){const V=S.context,U=V.gl,G=I.getSource().tileSize,re=5*(1-r.ac(r.bY,r.bY+1,S.transform.zoom))*G+L.paint.get("raster-particle-elevation"),Q=!S.options.moving,ue=S.transform.projection.name==="globe";if(!D.length)return;const[ce,ye]=S.stencilConfigForOverlap(D),Ae=[];ue&&Ae.push("PROJECTION_GLOBE_VIEW");const Ee=S.stencilModeFor3D();for(const Fe of ye){const ze=Fe.toUnwrapped(),Oe=I.getTile(Fe);if(!Oe.rasterParticleState)continue;const ke=Oe.rasterParticleState,Ge=100;Oe.registerFadeDuration(Ge);const Ze=I.findLoadedParent(Fe,0),ft=ha(Oe,Ze,I,S.transform,Ge);let ct,We;S.terrain&&S.terrain.prepareDrawTile(),V.activeTexture.set(U.TEXTURE0),ke.targetColorTexture.bind(U.LINEAR,U.CLAMP_TO_EDGE),V.activeTexture.set(U.TEXTURE1),Ze&&Ze.rasterParticleState?(Ze.rasterParticleState.targetColorTexture.bind(U.LINEAR,U.CLAMP_TO_EDGE),ct=Math.pow(2,Ze.tileID.overscaledZ-Oe.tileID.overscaledZ),We=[Oe.tileID.canonical.x*ct%1,Oe.tileID.canonical.y*ct%1]):ke.targetColorTexture.bind(U.LINEAR,U.CLAMP_TO_EDGE);const tt=ue?Float32Array.from(S.transform.expandedFarZProjMatrix):S.transform.calculateProjMatrix(ze,Q),zt=S.transform,Gt=ah(zt),Yt=r.cE(Fe.canonical),dt=r.cF(Yt.getCenter().lat);let Ft,Et,rn,Vt,kt;ue?(Ft=Float32Array.from(r.bb(r.cH(Fe.canonical))),Et=Float32Array.from(zt.globeMatrix),rn=Float32Array.from(r.cD(zt)),Vt=[r.at(zt.center.lng),r.aA(zt.center.lat)],kt=Float32Array.from(r.cG(Fe.canonical,Yt,dt,zt.worldSize/zt._pixelsPerMercatorPixel))):(Ft=new Float32Array(16),Et=new Float32Array(9),rn=new Float32Array(16),Vt=[0,0],kt=new Float32Array(9));const _n=mn(tt,Ft,Et,rn,kt,We||[0,0],r.ae(S.transform.zoom),Vt,Gt,ct||1,ft,re),gn=S.isTileAffectedByFog(Fe),ln=S.getOrCreateProgram("rasterParticle",{defines:Ae,overrideFog:gn});if(S.uploadCommonUniforms(V,ln,ze),ue){const xn=new Dn(U.LEQUAL,Dn.ReadOnly,S.depthRangeFor3D),tr=0,Ln=S.globeSharedBuffers;if(Ln){const[Fn,Yn,Dr]=Ln.getGridBuffers(dt,tr!==0);ln.draw(S,U.TRIANGLES,xn,Ee,Sr.alphaBlended,S.renderElevatedRasterBackface?Wn.frontCCW:Wn.backCCW,_n,L.id,Fn,Yn,Dr)}}else{const xn=S.depthModeForSublayer(0,Dn.ReadOnly),tr=ce[Fe.overscaledZ],{tileBoundsBuffer:Ln,tileBoundsIndexBuffer:Fn,tileBoundsSegments:Yn}=S.getTileBoundsBuffers(Oe);ln.draw(S,U.TRIANGLES,xn,tr,Sr.alphaBlended,Wn.disabled,_n,L.id,Ln,Fn,Yn)}}S.resetStencilClippingMasks()}(u,t,o,h),u.style.map.triggerRepaint())},background:function(u,t,o,h){const g=o.paint.get("background-color"),v=o.paint.get("background-color-use-theme").constantOr("default")==="none",S=o.paint.get("background-opacity"),I=o.paint.get("background-emissive-strength"),L=o.paint.get("background-pitch-alignment")==="viewport";if(S===0)return;const D=u.context,B=D.gl,V=u.transform,U=V.tileSize,G=o.paint.get("background-pattern");let re;if(G!==void 0&&(G===null||(re=u.imageManager.getPattern(G.toString(),o.scope,u.style.getLut(o.scope)),!re)))return;const Q=!G&&g.a===1&&S===1&&u.opaquePassEnabledForLayer()?"opaque":"translucent";if(u.renderPass!==Q)return;const ue=or.disabled,ce=u.depthModeForSublayer(0,Q==="opaque"?Dn.ReadWrite:Dn.ReadOnly),ye=u.colorModeForDrapableLayerRenderPass(I),Ae=G?"backgroundPattern":"background";let Ee,Fe=h;if(Fe||(Ee=u.getBackgroundTiles(),Fe=Object.values(Ee).map(ze=>ze.tileID)),G&&(D.activeTexture.set(B.TEXTURE0),u.imageManager.bind(u.context,o.scope)),L){const ze=u.getOrCreateProgram(Ae,{overrideFog:!1,overrideRtt:!0}),Oe=new Float32Array(r.ab.mat4.identity([])),ke=new r.aG(0,0,0,0,0),Ge=G?cr(Oe,I,S,u,0,o.scope,re,L,{tileID:ke,tileSize:U}):Rr(Oe,I,S,g.toRenderColor(v?null:o.lut));ze.draw(u,B.TRIANGLES,ce,ue,ye,Wn.disabled,Ge,o.id,u.viewportBuffer,u.quadTriangleIndexBuffer,u.viewportSegments)}else for(const ze of Fe){const Oe=u.isTileAffectedByFog(ze),ke=u.getOrCreateProgram(Ae,{overrideFog:Oe}),Ge=ze.toUnwrapped(),Ze=h?ze.projMatrix:u.transform.calculateProjMatrix(Ge);u.prepareDrawTile();const ft=t?t.getTile(ze):Ee?Ee[ze.key]:new As(ze,U,V.zoom,u),ct=G?cr(Ze,I,S,u,0,o.scope,re,L,{tileID:ze,tileSize:U}):Rr(Ze,I,S,g.toRenderColor(v?null:o.lut));u.uploadCommonUniforms(D,ke,Ge);const{tileBoundsBuffer:We,tileBoundsIndexBuffer:tt,tileBoundsSegments:zt}=u.getTileBoundsBuffers(ft);ke.draw(u,B.TRIANGLES,ce,ue,ye,Wn.disabled,ct,o.id,We,tt,zt)}},sky:function(u,t,o){const h=u._atmosphere?r.ae(u.transform.zoom):1,g=o.paint.get("sky-opacity")*h;if(g===0)return;const v=u.context,S=o.paint.get("sky-type"),I=new Dn(v.gl.LEQUAL,Dn.ReadOnly,[0,1]),L=u.frameCounter/1e3%1;S==="atmosphere"?u.renderPass==="offscreen"?o.needsSkyboxCapture(u)&&(function(D,B,V,U){const G=D.context,re=G.gl;let Q=B.skyboxFbo;if(!Q){Q=B.skyboxFbo=G.createFramebuffer(32,32,!0,null),B.skyboxGeometry=new hc(G),B.skyboxTexture=G.gl.createTexture(),re.bindTexture(re.TEXTURE_CUBE_MAP,B.skyboxTexture),re.texParameteri(re.TEXTURE_CUBE_MAP,re.TEXTURE_WRAP_S,re.CLAMP_TO_EDGE),re.texParameteri(re.TEXTURE_CUBE_MAP,re.TEXTURE_WRAP_T,re.CLAMP_TO_EDGE),re.texParameteri(re.TEXTURE_CUBE_MAP,re.TEXTURE_MIN_FILTER,re.LINEAR),re.texParameteri(re.TEXTURE_CUBE_MAP,re.TEXTURE_MAG_FILTER,re.LINEAR);for(let Ae=0;Ae<6;++Ae)re.texImage2D(re.TEXTURE_CUBE_MAP_POSITIVE_X+Ae,0,re.RGBA,32,32,0,re.RGBA,re.UNSIGNED_BYTE,null)}G.bindFramebuffer.set(Q.framebuffer),G.viewport.set([0,0,32,32]);const ue=B.getCenter(D,!0),ce=D.getOrCreateProgram("skyboxCapture"),ye=new Float64Array(16);r.ab.mat4.identity(ye),r.ab.mat4.rotateY(ye,ye,.5*-Math.PI),Wo(D,B,ce,ye,ue,0),r.ab.mat4.identity(ye),r.ab.mat4.rotateY(ye,ye,.5*Math.PI),Wo(D,B,ce,ye,ue,1),r.ab.mat4.identity(ye),r.ab.mat4.rotateX(ye,ye,.5*-Math.PI),Wo(D,B,ce,ye,ue,2),r.ab.mat4.identity(ye),r.ab.mat4.rotateX(ye,ye,.5*Math.PI),Wo(D,B,ce,ye,ue,3),r.ab.mat4.identity(ye),Wo(D,B,ce,ye,ue,4),r.ab.mat4.identity(ye),r.ab.mat4.rotateY(ye,ye,Math.PI),Wo(D,B,ce,ye,ue,5),G.viewport.set([0,0,D.width,D.height])}(u,o),o.markSkyboxValid(u)):u.renderPass==="sky"&&function(D,B,V,U,G){const re=D.context,Q=re.gl,ue=D.transform,ce=D.getOrCreateProgram("skybox");re.activeTexture.set(Q.TEXTURE0),Q.bindTexture(Q.TEXTURE_CUBE_MAP,B.skyboxTexture);const ye=((Ae,Ee,Fe,ze,Oe)=>({u_matrix:Ae,u_sun_direction:Ee,u_cubemap:0,u_opacity:ze,u_temporal_offset:Oe}))(ue.skyboxMatrix,B.getCenter(D,!1),0,U,G);D.uploadCommonUniforms(re,ce),ce.draw(D,Q.TRIANGLES,V,or.disabled,D.colorModeForRenderPass(),Wn.backCW,ye,"skybox",B.skyboxGeometry.vertexBuffer,B.skyboxGeometry.indexBuffer,B.skyboxGeometry.segment)}(u,o,I,g,L):S==="gradient"&&u.renderPass==="sky"&&function(D,B,V,U,G){const re=D.context,Q=re.gl,ue=D.transform,ce=D.getOrCreateProgram("skyboxGradient");B.skyboxGeometry||(B.skyboxGeometry=new hc(re)),re.activeTexture.set(Q.TEXTURE0);let ye=B.colorRampTexture;ye||(ye=B.colorRampTexture=new r.T(re,B.colorRamp,Q.RGBA8)),ye.bind(Q.LINEAR,Q.CLAMP_TO_EDGE);const Ae=((Ee,Fe,ze,Oe,ke)=>({u_matrix:Ee,u_color_ramp:0,u_center_direction:Fe,u_radius:r.ai(ze),u_opacity:Oe,u_temporal_offset:ke}))(ue.skyboxMatrix,B.getCenter(D,!1),B.paint.get("sky-gradient-radius"),U,G);D.uploadCommonUniforms(re,ce),ce.draw(D,Q.TRIANGLES,V,or.disabled,D.colorModeForRenderPass(),Wn.backCW,Ae,"skyboxGradient",B.skyboxGeometry.vertexBuffer,B.skyboxGeometry.indexBuffer,B.skyboxGeometry.segment)}(u,o,I,g,L)},debug:function(u,t,o,h,g,v){for(let S=0;S<o.length;S++)if(g){const D=new r.aj(h.r*.8,h.g*.8,h.b*.8,1);$l(u,t,o[S],h,-1,-1,v),$l(u,t,o[S],h,-1,1,v),$l(u,t,o[S],h,1,1,v),$l(u,t,o[S],h,1,-1,v),$l(u,t,o[S],D,0,0,v)}else $l(u,t,o[S],h,0,0,v)},custom:function(u,t,o,h){const g=u.context,v=o.implementation;if(!u.transform.projection.unsupportedLayers||!u.transform.projection.unsupportedLayers.includes("custom")||u.terrain&&(u.terrain.renderingToTexture||u.renderPass==="offscreen")&&o.isDraped(t)){if(u.renderPass==="offscreen"){const S=v.prerender;if(S){if(u.setCustomLayerDefaults(),g.setColorMode(u.colorModeForRenderPass()),u.transform.projection.name==="globe"){const I=u.transform.pointMerc;S.call(v,g.gl,u.transform.customLayerMatrix(),u.transform.getProjection(),u.transform.globeToMercatorMatrix(),r.ae(u.transform.zoom),[I.x,I.y],u.transform.pixelsPerMeterRatio)}else S.call(v,g.gl,u.transform.customLayerMatrix());g.setDirty(),u.setBaseState()}}else if(u.renderPass==="translucent"){if(u.terrain&&u.terrain.renderingToTexture){const I=v.renderToTile;if(I){const L=h[0].canonical,D=new r.aa(L.x+h[0].wrap*(1<<L.z),L.y,L.z);g.setDepthMode(Dn.disabled),g.setStencilMode(or.disabled),g.setColorMode(u.colorModeForRenderPass()),u.setCustomLayerDefaults(),I.call(v,g.gl,D),g.setDirty(),u.setBaseState()}return}u.setCustomLayerDefaults(),g.setColorMode(u.colorModeForRenderPass()),g.setStencilMode(or.disabled);const S=v.renderingMode==="3d"?new Dn(u.context.gl.LEQUAL,Dn.ReadWrite,u.depthRangeFor3D):u.depthModeForSublayer(0,Dn.ReadOnly);if(g.setDepthMode(S),u.transform.projection.name==="globe"){const I=u.transform.pointMerc;v.render(g.gl,u.transform.customLayerMatrix(),u.transform.getProjection(),u.transform.globeToMercatorMatrix(),r.ae(u.transform.zoom),[I.x,I.y],u.transform.pixelsPerMeterRatio)}else v.render(g.gl,u.transform.customLayerMatrix());g.setDirty(),u.setBaseState(),g.bindFramebuffer.set(null)}}else r.w("Custom layers are not yet supported with this projection. Use mercator or globe to enable usage of custom layers.")},model:function(u,t,o,h){if(u.renderPass==="opaque")return;const g=o.paint.get("model-opacity").constantOr(1);if(g===0)return;const v=o.paint.get("model-cast-shadows");if(u.renderPass==="shadow"&&(!v||u.terrain&&g<.65&&o._transitionablePaint._values["model-opacity"].value.expression instanceof r.a9))return;const S=u.shadowRenderer,I=o.paint.get("model-receive-shadows");S&&(S.useNormalOffset=!0,I||(S.enabled=!1));const L=()=>{S&&(S.useNormalOffset=!0,I||(S.enabled=!0))},D=t.getSource();if(u.renderPass==="light-beam"&&D.type!=="batched-model")return;if(D.type==="vector"||D.type==="geojson")return function(ce,ye,Ae,Ee,Fe){const ze=ce.transform;if(ze.projection.name!=="mercator")return void r.w(`Drawing 3D models for ${ze.projection.name} projection is not yet implemented`);const Oe=ze.getFreeCameraOptions().position;if(!ce.modelManager)return;const ke=ce.modelManager;Ae.modelManager=ke;const Ge=ce.shadowRenderer;if(!Ae._unevaluatedLayout._values.hasOwnProperty("model-id"))return;const Ze=Ae._unevaluatedLayout._values["model-id"],ft={...Ae.layout.get("model-id").parameters},ct=ce.style.order.indexOf(Ae.fqid);for(const We of Ee){const tt=ye.getTile(We).getBucket(Ae);if(!tt||tt.projection.name!==ze.projection.name)continue;const zt=tt.getModelUris();zt&&!tt.modelsRequested&&(ke.addModelsFromBucket(zt,Fe),tt.modelsRequested=!0);const Gt=td(We,ze);ft.zoom=Gt;const Yt=Ze.possiblyEvaluate(ft);if(Fo(ce,tt,We),uo.shadowUniformsInitialized=!1,uo.useSingleShadowCascade=!!Ge&&Ge.getMaxCascadeForTile(We.toUnwrapped())===0,ce.renderPass==="shadow"&&Ge){if(ce.currentShadowCascade===1&&tt.isInsideFirstShadowMapFrustum)continue;const Et=ze.calculatePosMatrix(We.toUnwrapped(),ze.worldSize);if(uo.tileMatrix.set(Et),uo.shadowTileMatrix=Float32Array.from(Ge.calculateShadowPassMatrixFromMatrix(Et)),uo.aabb.min.fill(0),uo.aabb.max[0]=uo.aabb.max[1]=r.ag,uo.aabb.max[2]=0,Ou(tt,uo,ce,Ae.scope))continue}const dt=1<<We.canonical.z,Ft=[((Oe.x-We.wrap)*dt-We.canonical.x)*r.ag,(Oe.y*dt-We.canonical.y)*r.ag,Oe.z*dt*r.ag];ce.conflationActive&&Object.keys(tt.instancesPerModel).length>0&&ce.style.isLayerClipped(Ae,ye.getSource())&&tt.updateReplacement(We,ce.replacementSource,ct,Fe)&&(tt.uploaded=!1,tt.upload(ce.context));for(let Et in tt.instancesPerModel){const rn=tt.instancesPerModel[Et];rn.features.length>0&&(Et=Yt.evaluate(rn.features[0].feature,{}));const Vt=ke.getModel(Et,Fe);if(Vt&&Vt.uploaded)for(const kt of Vt.nodes)xl(ce,Ae,kt,rn,Ft,We,uo)}}}(u,t,o,h,D.type==="vector"?o.scope:""),void L();if(!D.loaded())return;if(D.type==="batched-model")return function(ce,ye,Ae,Ee){Ae.resetLayerRenderingStats(ce);const Fe=ce.context,ze=ce.transform,Oe=ce.style.fog,ke=ce.shadowRenderer;if(ze.projection.name!=="mercator")return void r.w(`Drawing 3D landmark models for ${ze.projection.name} projection is not yet implemented`);const Ge=ce.transform.getFreeCameraOptions().position,Ze=r.ab.vec3.scale([],[Ge.x,Ge.y,Ge.z],ce.transform.worldSize),ft=r.ab.vec3.negate([],Ze),ct=r.ab.mat4.identity([]),We=r.dj(ze.center.lat,ze.zoom),tt=r.ab.mat4.fromScaling([],[1,1,1/We]);r.ab.mat4.translate(ct,ct,ft);const zt=Ae.paint.get("model-opacity").constantOr(1),Gt=new Dn(Fe.gl.LEQUAL,Dn.ReadWrite,ce.depthRangeFor3D),Yt=new Dn(Fe.gl.LEQUAL,Dn.ReadOnly,ce.depthRangeFor3D),dt=new r.cd([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),Ft=ce.renderPass==="shadow",Et=Ft&&ke?ke.getCurrentCascadeFrustum():ze.getFrustum(ze.scaleZoom(ze.worldSize)),rn=Ae.paint.get("model-front-cutoff"),Vt=rn[2]<1,kt=ul(ce,Ae.paint.get("model-cutoff-fade-range")),_n=Ae.getLayerRenderingStats();(function(gn,ln,xn,tr){const Ln=gn.terrain?gn.terrain.exaggeration():0,Fn=gn.transform.zoom;for(const Yn of tr){const Dr=ln.getTile(Yn).getBucket(xn);Dr&&(gn.conflationActive&&Dr.updateReplacement(Yn,gn.replacementSource),Dr.evaluateScale(gn,xn),gn.terrain&&Ln>0&&Dr.elevationUpdate(gn.terrain,Ln,Yn,xn.source),Dr.needsReEvaluation(gn,Fn,xn)&&Dr.evaluate(xn))}})(ce,ye,Ae,Ee),function(){let gn,ln,xn;Vt?(gn=Ee.length-1,ln=-1,xn=-1):(gn=0,ln=Ee.length,xn=1);const tr=new Float64Array(16),Ln=r.ab.vec3.create(),Fn=new r.P(0,0);for(let Yn=gn;Yn!==ln;Yn+=xn){const Dr=Ee[Yn],pr=ye.getTile(Dr).getBucket(Ae);if(!pr||!pr.uploaded)continue;let Oi=!1;ke&&(Oi=ke.getMaxCascadeForTile(Dr.toUnwrapped())===0);const Si=ze.calculatePosMatrix(Dr.toUnwrapped(),ze.worldSize),si=pr.modelTraits;!Ft&&Vt&&(r.ab.mat4.invert(tr,Si),r.ab.vec3.transformMat4(Ln,Ze,tr),Fn.x=Ln[0],Fn.y=Ln[1]);const Fr=[];for(const ur of pr.getNodesInfo()){if(ur.hiddenByReplacement||!ur.node.meshes)continue;const Er=ur.node;let Bn=0;ce.terrain&&Er.elevation&&(Bn=Er.elevation*ce.terrain.exaggeration());const ii=(()=>{const Yr=ur.aabb;return dt.min=[...Yr.min],dt.max=[...Yr.max],dt.min[2]+=Bn,dt.max[2]+=Bn,r.ab.vec3.transformMat4(dt.min,dt.min,Si),r.ab.vec3.transformMat4(dt.max,dt.max,Si),dt})(),Ji=ur.evaluatedScale;if(Ji[0]<=1&&Ji[1]<=1&&Ji[2]<=1&&ii.intersects(Et)===0)continue;if(!Ft&&Vt){const Yr=.16666666666666666;ur.cameraCollisionOpacity=Ze[0]>ii.min[0]&&Ze[0]<ii.max[0]&&Ze[1]>ii.min[1]&&Ze[1]<ii.max[1]&&Ze[2]*We<ii.max[2]&&Er.footprint&&r.bA(Fn,Er.footprint)?Math.max(ur.cameraCollisionOpacity-Yr,0):Math.min(1,ur.cameraCollisionOpacity+Yr)}const ts=[...Si],Za=Er.anchor?Er.anchor[0]:0,Bo=Er.anchor?Er.anchor[1]:0;r.ab.mat4.translate(ts,ts,[Za*(Ji[0]-1),Bo*(Ji[1]-1),Bn]),r.ab.vec3.exactEquals(Ji,r.dm)||r.ab.mat4.scale(ts,ts,Ji);const ns=r.ab.mat4.multiply([],ts,Er.matrix),Co=r.ab.mat4.multiply([],ze.expandedFarZProjMatrix,ns),Vi=r.ab.mat4.multiply([],ze.expandedFarZProjMatrix,ts),ki=r.ab.vec4.transformMat4([],[Za,Bo,Bn,1],Co)[2];Er.hidden=!1;let mi=zt;Ft||(Vt&&(mi*=ur.cameraCollisionOpacity,mi*=nd(ts,ze,ur.aabb,rn)),mi*=Fs(kt,ki)),mi!==0?Fr.push({nodeInfo:ur,depth:ki,opacity:mi,wvpForNode:Co,wvpForTile:Vi,nodeModelMatrix:ns,tileModelMatrix:ts}):Er.hidden=!0}Ft||Fr.sort((ur,Er)=>!Vt||ur.opacity===1&&Er.opacity===1?ur.depth<Er.depth?-1:1:ur.opacity===1?-1:Er.opacity===1?1:ur.depth>Er.depth?-1:1);for(const ur of Fr){const Er=ur.nodeInfo,Bn=Er.node;let ii=r.ab.mat4.multiply([],tt,ur.tileModelMatrix);r.ab.mat4.multiply(ii,ct,ii);const Ji=r.ab.mat4.invert([],ii);r.ab.mat4.transpose(Ji,Ji),r.ab.mat4.scale(Ji,Ji,Vl),ii=r.ab.mat4.multiply(ii,ii,Bn.matrix);const ts=ce.renderPass==="light-beam",Za=Ae.paint.get("model-color-use-theme").constantOr("default")==="none",Bo=si&r.dp.HasMapboxMeshFeatures,ns=Bo?0:Er.evaluatedRMEA[0][2];for(let Co=0;Co<Bn.meshes.length;++Co){const Vi=Bn.meshes[Co],ki=Co===Bn.lightMeshIndex;let mi=ur.wvpForNode;if(ki){if(!ts&&!ce.terrain&&ce.shadowRenderer){ce.currentLayer<ce.firstLightBeamLayer&&(ce.firstLightBeamLayer=ce.currentLayer);continue}mi=ur.wvpForTile}else if(ts)continue;const Yr={defines:[]},ho=[];if(!Ft&&ke&&(ke.useNormalOffset=!!Vi.normalBuffer),$r(Yr.defines,ho,Vi,ce,Za?null:Ae.lut),Bo||Yr.defines.push("DIFFUSE_SHADED"),Oi&&Yr.defines.push("SHADOWS_SINGLE_CASCADE"),_n&&(Ft?_n.numRenderedVerticesInShadowPass+=Vi.vertexArray.length:_n.numRenderedVerticesInTransparentPass+=Vi.vertexArray.length),Ft){yo(Vi,ur.nodeModelMatrix,ce,Ae);continue}let Go=null;if(Oe){const pa=xi(ur.nodeModelMatrix,ce.transform);if(Go=new Float32Array(pa),ze.projection.name!=="globe"){const na=Vi.aabb.min,qs=Vi.aabb.max,[zc,Wi]=Oe.getOpacityForBounds(pa,na[0],na[1],qs[0],qs[1]);Yr.overrideFog=zc>=on||Wi>=on}}const Ei=Vi.material;let Gs;Ei.occlusionTexture&&Ei.occlusionTexture.offsetScale&&(Gs=Ei.occlusionTexture.offsetScale,Yr.defines.push("OCCLUSION_TEXTURE_TRANSFORM"));const El=ce.getOrCreateProgram("model",Yr);!Ft&&ke&&ke.setupShadowsFromMatrix(ur.tileModelMatrix,El,ke.useNormalOffset),ce.uploadCommonUniforms(Fe,El,null,Go);const fa=Ei.pbrMetallicRoughness;fa.metallicFactor=.9,fa.roughnessFactor=.5;const kc=vr(new Float32Array(mi),new Float32Array(ii),new Float32Array(Ji),new Float32Array(Bn.matrix),ce,ur.opacity,fa.baseColorFactor.toRenderColor(null),Ei.emissiveFactor,fa.metallicFactor,fa.roughnessFactor,Ei,ns,Ae,[0,0,0],Gs);!ki&&(Er.hasTranslucentParts||ur.opacity<1)&&El.draw(ce,Fe.gl.TRIANGLES,Gt,or.disabled,Sr.disabled,Wn.backCCW,kc,Ae.id,Vi.vertexBuffer,Vi.indexBuffer,Vi.segments,Ae.paint,ce.transform.zoom,void 0,ho),El.draw(ce,Fe.gl.TRIANGLES,ki?Yt:Gt,or.disabled,ki||ur.opacity<1||Er.hasTranslucentParts?Sr.alphaBlended:Sr.unblended,Wn.backCCW,kc,Ae.id,Vi.vertexBuffer,Vi.indexBuffer,Vi.segments,Ae.paint,ce.transform.zoom,void 0,ho)}}}}()}(u,t,o,h),void L();if(D.type!=="model")return;const B=D.getModels(),V=[],U=u.transform.getFreeCameraOptions().position,G=r.ab.vec3.scale([],[U.x,U.y,U.z],u.transform.worldSize);r.ab.vec3.negate(G,G);const re=[],Q=[];let ue=0;for(const ce of B){const ye=o.paint.get("model-rotation").constantOr(null),Ae=o.paint.get("model-scale").constantOr(null),Ee=o.paint.get("model-translation").constantOr(null);ce.computeModelMatrix(u,ye,Ae,Ee,!0,!0,!1);const Fe=r.ab.mat4.identity([]),ze=r.dj(ce.position.lat,u.transform.zoom),Oe=r.ab.mat4.fromScaling([],[1,1,1/ze]);r.ab.mat4.translate(Fe,Fe,G),V.push({zScaleMatrix:Oe,negCameraPosMatrix:Fe});for(const ke of ce.nodes)Ia(u.transform,ke,ce.matrix,u.transform.expandedFarZProjMatrix,ue,re,Q);ue++}if(re.sort((ce,ye)=>ye.depth-ce.depth),u.renderPass!=="shadow"){if(g===1)for(const ce of Q)ch(ce,u,o,V[ce.modelIndex],or.disabled,u.colorModeForRenderPass());else{for(const ce of Q)ch(ce,u,o,V[ce.modelIndex],or.disabled,Sr.disabled);for(const ce of Q)ch(ce,u,o,V[ce.modelIndex],u.stencilModeFor3D(),u.colorModeForRenderPass());u.resetStencilClippingMasks()}for(const ce of re)ch(ce,u,o,V[ce.modelIndex],or.disabled,u.colorModeForRenderPass());L()}else{for(const ce of Q)yo(ce.mesh,ce.nodeModelMatrix,u,o);for(const ce of re)yo(ce.mesh,ce.nodeModelMatrix,u,o);L()}}},fh={model:function(u,t,o){const h=t.getSource();if(!h.loaded())return;if(h.type==="vector"||h.type==="geojson")return void(o.modelManager&&o.modelManager.upload(o,h.type==="vector"?u.scope:""));if(h.type==="batched-model"||h.type!=="model")return;const g=h.getModels();for(const v of g)v.upload(o.context)},raster:function(u,t,o){const h=t.getSource();if(!(h instanceof $o&&h.loaded()))return;const g=u.sourceLayer||h.rasterLayerIds&&h.rasterLayerIds[0];if(!g)return;const v=u.paint.get("raster-array-band")||h.getInitialBand(g);if(v==null)return;const S=t.getIds().map(I=>t.getTileByID(I));for(const I of S)I.updateNeeded(g,v)&&h.prepareTile(I,g,v)},"raster-particle":function(u,t,o){const h=t.getSource();if(!(h instanceof $o&&h.loaded()))return;const g=u.sourceLayer||h.rasterLayerIds&&h.rasterLayerIds[0];if(!g)return;const v=u.paint.get("raster-particle-array-band")||h.getInitialBand(g);if(v==null)return;const S=t.getIds().map(I=>t.getTileByID(I));for(const I of S)I.updateNeeded(g,v)&&h.prepareTile(I,g,v)}};class rd{constructor(t,o,h,g,v){this.context=new jr(t,o),this.transform=h,this._tileTextures={},this.frameCopies=[],this.loadTimeStamps=[],this.tp=v,this._timeStamp=r.q.now(),this._averageFPS=0,this._fpsHistory=[],this._dt=0,this._debugParams={forceEnablePrecipitation:!1,showTerrainProxyTiles:!1,fpsWindow:30,continousRedraw:!1,enabledLayers:{}};const S=["fill","line","symbol","circle","heatmap","fill-extrusion","raster","raster-particle","hillshade","model","background","sky"];for(const L of S)this._debugParams.enabledLayers[L]=!0;v.registerParameter(this._debugParams,["Terrain"],"showTerrainProxyTiles",{},()=>{this.style.map.triggerRepaint()}),v.registerParameter(this._debugParams,["Precipitation"],"forceEnablePrecipitation"),v.registerParameter(this._debugParams,["FPS"],"fpsWindow",{min:1,max:100,step:1}),v.registerBinding(this._debugParams,["FPS"],"continousRedraw",{readonly:!0,label:"continuous redraw"}),v.registerBinding(this,["FPS"],"_averageFPS",{readonly:!0,label:"value"}),v.registerBinding(this,["FPS"],"_averageFPS",{readonly:!0,label:"graph",view:"graph",min:0,max:200});for(const L of S)v.registerParameter(this._debugParams.enabledLayers,["Debug","Layers"],L);this.occlusionParams=new Ul(v),this.setup(),this.numSublayers=Ls.maxUnderzooming+Ls.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.deferredRenderGpuTimeQueries=[],this.gpuTimers={},this.frameCounter=0,this._backgroundTiles={},this.conflationActive=!1,this.replacementSource=new r.dv,this.longestCutoffRange=0,this.minCutoffZoom=0,this._fogVisible=!1,this._cachedTileFogOpacities={},this._shadowRenderer=new Rl(this),this._wireframeDebugCache=new Vd,this.renderDefaultNorthPole=!0,this.renderDefaultSouthPole=!0,this.layersWithOcclusionOpacity=[];const I=new r.r({width:1,height:1},Uint8Array.of(0,0,0,0));this.emptyDepthTexture=new r.T(this.context,I,t.RGBA8),this._clippingActiveLastFrame=!1,this.scaleFactor=g}updateTerrain(t,o){const h=!!t&&!!t.terrain&&this.transform.projection.supportsTerrain;if(!(h||this._terrain&&this._terrain.enabled))return;this._terrain||(this._terrain=new ys(this,t));const g=this._terrain;this.transform.elevation=h?g:null,g.update(t,this.transform,o),this.transform.elevation&&!g.enabled&&(this.transform.elevation=null)}_updateFog(t){const o=t.fog;if(!o||this.transform.projection.name==="globe"||o.getOpacity(this.transform.pitch)<1||o.properties.get("horizon-blend")<.03)return void(this.transform.fogCullDistSq=null);const[h,g]=o.getFovAdjustedRange(this.transform._fov);if(h>g)return void(this.transform.fogCullDistSq=null);const v=h+.78*(g-h);this.transform.fogCullDistSq=v*v}get terrain(){return this.transform._terrainEnabled()&&this._terrain&&this._terrain.enabled||this._forceTerrainMode?this._terrain:null}get forceTerrainMode(){return this._forceTerrainMode}set forceTerrainMode(t){t&&!this._terrain&&(this._terrain=new ys(this,this.style)),this._forceTerrainMode=t}get shadowRenderer(){return this._shadowRenderer&&this._shadowRenderer.enabled?this._shadowRenderer:null}get wireframeDebugCache(){return this._wireframeDebugCache}resize(t,o){if(this.width=t*r.q.devicePixelRatio,this.height=o*r.q.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const h of this.style.order)this.style._mergedLayers[h].resize()}setup(){const t=this.context,o=new r.b4;o.emplaceBack(0,0),o.emplaceBack(r.ag,0),o.emplaceBack(0,r.ag),o.emplaceBack(r.ag,r.ag),this.tileExtentBuffer=t.createVertexBuffer(o,r.b6.members),this.tileExtentSegments=r.b7.simpleSegment(0,0,4,2);const h=new r.b4;h.emplaceBack(0,0),h.emplaceBack(r.ag,0),h.emplaceBack(0,r.ag),h.emplaceBack(r.ag,r.ag),this.debugBuffer=t.createVertexBuffer(h,r.b6.members),this.debugSegments=r.b7.simpleSegment(0,0,4,5);const g=new r.b4;g.emplaceBack(-1,-1),g.emplaceBack(1,-1),g.emplaceBack(-1,1),g.emplaceBack(1,1),this.viewportBuffer=t.createVertexBuffer(g,r.b6.members),this.viewportSegments=r.b7.simpleSegment(0,0,4,2);const v=new r.aT;v.emplaceBack(0,0,0,0),v.emplaceBack(r.ag,0,r.ag,0),v.emplaceBack(0,r.ag,0,r.ag),v.emplaceBack(r.ag,r.ag,r.ag,r.ag),this.mercatorBoundsBuffer=t.createVertexBuffer(v,r.b9.members),this.mercatorBoundsSegments=r.b7.simpleSegment(0,0,4,2);const S=new r.aU;S.emplaceBack(0,1,2),S.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=t.createIndexBuffer(S);const I=new r.b5;for(const D of[0,1,3,2,0])I.emplaceBack(D);this.debugIndexBuffer=t.createIndexBuffer(I),this.emptyTexture=new r.T(t,new r.r({width:1,height:1},Uint8Array.of(0,0,0,0)),t.gl.RGBA8),this.identityMat=r.ab.mat4.create();const L=this.context.gl;this.stencilClearMode=new or({func:L.ALWAYS,mask:0},0,255,L.ZERO,L.ZERO,L.ZERO),this.loadTimeStamps.push(performance.now())}getMercatorTileBoundsBuffers(){return{tileBoundsBuffer:this.mercatorBoundsBuffer,tileBoundsIndexBuffer:this.quadTriangleIndexBuffer,tileBoundsSegments:this.mercatorBoundsSegments}}getTileBoundsBuffers(t){return t._makeTileBoundsBuffers(this.context,this.transform.projection),t._tileBoundsBuffer?{tileBoundsBuffer:t._tileBoundsBuffer,tileBoundsIndexBuffer:t._tileBoundsIndexBuffer,tileBoundsSegments:t._tileBoundsSegments}:this.getMercatorTileBoundsBuffers()}clearStencil(){const t=this.context.gl;this.nextStencilID=1,this.currentStencilSource=void 0,this._tileClippingMaskIDs={},this.getOrCreateProgram("clippingMask").draw(this,t.TRIANGLES,Dn.disabled,this.stencilClearMode,Sr.disabled,Wn.disabled,Ga(this.identityMat),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}resetStencilClippingMasks(){this.terrain||(this.currentStencilSource=void 0,this._tileClippingMaskIDs={})}_renderTileClippingMasks(t,o,h){if(!o||this.currentStencilSource===o.id||!t.isTileClipped()||!h||h.length===0)return;if(this._tileClippingMaskIDs&&!this.terrain){let I=!1;for(const L of h)if(this._tileClippingMaskIDs[L.key]===void 0){I=!0;break}if(!I)return}this.currentStencilSource=o.id;const g=this.context,v=g.gl;this.nextStencilID+h.length>256&&this.clearStencil(),g.setColorMode(Sr.disabled),g.setDepthMode(Dn.disabled);const S=this.getOrCreateProgram("clippingMask");this._tileClippingMaskIDs={};for(const I of h){const L=o.getTile(I),D=this._tileClippingMaskIDs[I.key]=this.nextStencilID++,{tileBoundsBuffer:B,tileBoundsIndexBuffer:V,tileBoundsSegments:U}=this.getTileBoundsBuffers(L);S.draw(this,v.TRIANGLES,Dn.disabled,new or({func:v.ALWAYS,mask:0},D,255,v.KEEP,v.KEEP,v.REPLACE),Sr.disabled,Wn.disabled,Ga(I.projMatrix),"$clipping",B,V,U)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const t=this.nextStencilID++,o=this.context.gl;return new or({func:o.NOTEQUAL,mask:255},t,255,o.KEEP,o.KEEP,o.REPLACE)}stencilModeForClipping(t){if(this.terrain)return this.terrain.stencilModeForRTTOverlap(t);const o=this.context.gl;return new or({func:o.EQUAL,mask:255},this._tileClippingMaskIDs[t.key],0,o.KEEP,o.KEEP,o.REPLACE)}stencilConfigForOverlap(t){const o=this.context.gl,h=t.sort((S,I)=>I.overscaledZ-S.overscaledZ),g=h[h.length-1].overscaledZ,v=h[0].overscaledZ-g+1;if(v>1){this.currentStencilSource=void 0,this.nextStencilID+v>256&&this.clearStencil();const S={};for(let I=0;I<v;I++)S[I+g]=new or({func:o.GEQUAL,mask:255},I+this.nextStencilID,255,o.KEEP,o.KEEP,o.REPLACE);return this.nextStencilID+=v,[S,h]}return[{[g]:or.disabled},h]}colorModeForRenderPass(){const t=this.context.gl;return this._showOverdrawInspector?new Sr([t.CONSTANT_COLOR,t.ONE,t.CONSTANT_COLOR,t.ONE],new r.aj(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?Sr.unblended:Sr.alphaBlended}colorModeForDrapableLayerRenderPass(t){const o=this.context.gl;return this.style&&this.style.enable3dLights()&&this.terrain&&this.terrain.renderingToTexture&&this.renderPass==="translucent"?new Sr([o.ONE,o.ONE_MINUS_SRC_ALPHA,o.CONSTANT_ALPHA,o.ONE_MINUS_SRC_ALPHA],new r.aj(0,0,0,t===void 0?0:t),[!0,!0,!0,!0]):this.colorModeForRenderPass()}depthModeForSublayer(t,o,h,g=!1){if(this.depthOcclusion)return new Dn(this.context.gl.GREATER,Dn.ReadOnly,this.depthRangeFor3D);if(!this.opaquePassEnabledForLayer()&&!g)return Dn.disabled;const v=1-((1+this.currentLayer)*this.numSublayers+t)*this.depthEpsilon;return new Dn(h||this.context.gl.LEQUAL,o,[v,v])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}blitDepth(){const t=this.context.gl,o=Math.ceil(this.width),h=Math.ceil(this.height),g=this.context.bindFramebuffer.get(),v=t.getParameter(t.TEXTURE_BINDING_2D);this.depthFBO&&this.depthFBO.width===o&&this.depthFBO.height===h||(this.depthFBO&&(this.depthFBO.destroy(),this.depthFBO=void 0,this.depthTexture=void 0),o!==0&&h!==0&&(this.depthFBO=new Jr(this.context,o,h,!1,"texture"),this.depthTexture=new r.T(this.context,{width:o,height:h,data:null},t.DEPTH24_STENCIL8),this.depthFBO.depthAttachment.set(this.depthTexture.texture))),this.context.bindFramebuffer.set(g),t.bindTexture(t.TEXTURE_2D,v),this.depthFBO&&(t.bindFramebuffer(t.READ_FRAMEBUFFER,null),t.bindFramebuffer(t.DRAW_FRAMEBUFFER,this.depthFBO.framebuffer),t.blitFramebuffer(0,0,o,h,0,0,o,h,t.DEPTH_BUFFER_BIT,t.NEAREST),t.bindFramebuffer(t.FRAMEBUFFER,this.context.bindFramebuffer.current))}updateAverageFPS(){this._fpsHistory.push(this._dt===0?0:1e3/this._dt),this._fpsHistory.length>this._debugParams.fpsWindow&&this._fpsHistory.splice(0,this._fpsHistory.length-this._debugParams.fpsWindow),this._averageFPS=Math.round(this._fpsHistory.reduce((t,o)=>t+o/this._fpsHistory.length,0))}render(t,o){const h=r.q.now();this._dt=h-this._timeStamp,this._timeStamp=h,this._wireframeDebugCache.update(this.frameCounter),this._debugParams.continousRedraw=t.map.repaint,this.style=t,this.options=o;const g=this.style._mergedLayers,v=this.style._getOrder(!(!this.terrain||!this.terrain.enabled)).filter(We=>{const tt=g[We];return!(tt.type in this._debugParams.enabledLayers)||this._debugParams.enabledLayers[tt.type]});let S=!1,I=!1;for(const We of v){const tt=g[We];tt.type==="circle"&&(S=!0),tt.type==="symbol"&&(tt.hasInitialOcclusionOpacityProperties?I=!0:S=!0)}const L=v.map(We=>g[We]),D=this.style._mergedSourceCaches;this.imageManager=t.imageManager,this.modelManager=t.modelManager,this.symbolFadeChange=t.placement.symbolFadeChange(r.q.now()),this.imageManager.beginFrame();let B=0,V=!1;for(const We in D){const tt=D[We];tt.used&&(tt.prepare(this.context),tt.getSource().usedInConflation&&++B)}let U=!1;for(const We of L)We.isHidden(this.transform.zoom)||(We.type==="clip"&&(U=!0),this.prepareLayer(We));const G={},re={},Q={},ue={},ce={};for(const We in D){const tt=D[We];G[We]=tt.getVisibleCoordinates(),re[We]=G[We].slice().reverse(),Q[We]=tt.getVisibleCoordinates(!0).reverse(),ue[We]=tt.getShadowCasterCoordinates(),ce[We]=tt.sortCoordinatesByDistance(G[We])}const ye=We=>{const tt=this.style.getLayerSourceCache(We);return tt&&tt.used?tt.getSource():null};if(B||U||this._clippingActiveLastFrame){const We=[],tt=[];let zt=0;for(const Gt of L)this.isSourceForClippingOrConflation(Gt,ye(Gt))&&(We.push(Gt),tt.push(zt)),zt++;if(U||We.length>1||this._clippingActiveLastFrame){U=!1;const Gt=[];for(let Yt=0;Yt<We.length;Yt++){const dt=We[Yt],Ft=tt[Yt],Et=this.style.getLayerSourceCache(dt);if(!Et||!Et.used||!Et.getSource().usedInConflation&&dt.type!=="clip")continue;let rn=r.dx,Vt=r.by.None;const kt=[];let _n=!0;if(dt.type==="clip"){rn=Ft;for(const gn of dt.layout.get("clip-layer-types"))Vt|=gn==="model"?r.by.Model:gn==="symbol"?r.by.Symbol:r.by.FillExtrusion;for(const gn of dt.layout.get("clip-layer-scope"))kt.push(gn);dt.isHidden(this.transform.zoom)?_n=!1:U=!0}_n&&Gt.push({layer:dt.fqid,cache:Et,order:rn,clipMask:Vt,clipScope:kt})}this.replacementSource.setSources(Gt),V=!0}}this._clippingActiveLastFrame=U,V||this.replacementSource.clear(),this.conflationActive=V,this.minCutoffZoom=0,this.longestCutoffRange=0,this.opaquePassCutoff=1/0,this._lastOcclusionLayer=-1,this.layersWithOcclusionOpacity=[];for(let We=0;We<L.length;We++){const tt=L[We],zt=tt.cutoffRange();if(this.longestCutoffRange=Math.max(zt,this.longestCutoffRange),zt>0){const Gt=ye(tt);Gt&&(this.minCutoffZoom=Math.max(Gt.minzoom,this.minCutoffZoom)),tt.minzoom&&(this.minCutoffZoom=Math.max(tt.minzoom,this.minCutoffZoom))}tt.is3D()&&(this.opaquePassCutoff===1/0&&(this.opaquePassCutoff=We),this._lastOcclusionLayer=We)}const Ae=this.style&&this.style.fog;Ae?(this._fogVisible=Ae.getOpacity(this.transform.pitch)!==0,this._fogVisible&&this.transform.projection.name!=="globe"&&(this._fogVisible=Ae.isVisibleOnFrustum(this.transform.cameraFrustum))):this._fogVisible=!1,this._cachedTileFogOpacities={},this.terrain&&(this.terrain.updateTileBinding(Q),this.opaquePassCutoff=0);const Ee=this._shadowRenderer;if(Ee){Ee.updateShadowParameters(this.transform,this.style.directionalLight);for(const We in D)for(const tt of G[We]){let zt={min:0,max:0};this.terrain&&(zt=this.terrain.getMinMaxForTile(tt)||zt),Ee.addShadowReceiver(tt.toUnwrapped(),zt.min,zt.max)}}this.transform.projection.name!=="globe"||this.globeSharedBuffers||(this.globeSharedBuffers=new r.dw(this.context)),this.style.fog&&this.transform.projection.supportsFog?(this._atmosphere||(this._atmosphere=new ou(this)),this._atmosphere.update(this)):this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0);const Fe=this._debugParams.forceEnablePrecipitation||!(!this.style||!this.style.snow),ze=this._debugParams.forceEnablePrecipitation||!(!this.style||!this.style.rain);if(Fe&&!this._snow&&(this._snow=new dh(this)),!Fe&&this._snow&&(this._snow.destroy(),delete this._snow),ze&&!this._rain&&(this._rain=new Df(this)),!ze&&this._rain&&(this._rain.destroy(),delete this._rain),this._snow&&this._snow.update(this),this._rain&&this._rain.update(this),!Hr.has(this.context.gl))return;this.renderPass="offscreen";for(const We of L){const tt=t.getLayerSourceCache(We);if(!We.hasOffscreenPass()||We.isHidden(this.transform.zoom))continue;const zt=tt?re[tt.id]:void 0;(We.type==="custom"||We.type==="raster"||We.type==="raster-particle"||We.isSky()||zt&&zt.length)&&this.renderLayer(this,tt,We,zt)}this.depthRangeFor3D=[0,1-(L.length+2)*this.numSublayers*this.depthEpsilon],this._shadowRenderer&&(this.renderPass="shadow",this._shadowRenderer.drawShadowPass(this.style,ue)),this.context.bindFramebuffer.set(null),this.context.viewport.set([0,0,this.width,this.height]);const Oe=this.transform.projection.name==="globe"||this.transform.isHorizonVisible(),ke=(()=>{if(o.showOverdrawInspector)return r.aj.black;const We=this.style.fog;if(We&&this.transform.projection.supportsFog){const tt=this.style.getLut(We.scope);if(!Oe){const zt=We.properties.get("color-use-theme")==="none",Gt=We.properties.get("color").toRenderColor(zt?null:tt).toArray01();return new r.aj(...Gt)}if(Oe){const zt=We.properties.get("space-color-use-theme")==="none",Gt=We.properties.get("space-color").toRenderColor(zt?null:tt).toArray01();return new r.aj(...Gt)}}return r.aj.transparent})();if(this.context.clear({color:ke,depth:1}),this.clearStencil(),this._showOverdrawInspector=o.showOverdrawInspector,this.renderPass="opaque",this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&Oe&&this._atmosphere.drawStars(this,this.style.fog),!this.terrain)for(this.currentLayer=v.length-1;this.currentLayer>=0;this.currentLayer--){const We=L[this.currentLayer],tt=t.getLayerSourceCache(We);if(We.isSky())continue;const zt=tt?(We.is3D()?ce:re)[tt.id]:void 0;this._renderTileClippingMasks(We,tt,zt),this.renderLayer(this,tt,We,zt)}if(this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&Oe&&this._atmosphere.drawAtmosphereGlow(this,this.style.fog),this.renderPass="sky",(!this._atmosphere||r.ae(this.transform.zoom)>0)&&(this.transform.projection.name==="globe"||this.transform.isHorizonVisible()))for(this.currentLayer=0;this.currentLayer<v.length;this.currentLayer++){const We=L[this.currentLayer],tt=t.getLayerSourceCache(We);We.isSky()&&this.renderLayer(this,tt,We,tt?re[tt.id]:void 0)}function Ge(We,tt){let zt;return tt&&(zt=(We.type==="symbol"?Q:We.is3D()?ce:re)[tt.id]),zt}if(this.renderPass="translucent",this.transform.projection.name==="globe"){for(this.renderElevatedRasterBackface=!0,this.currentLayer=0;this.currentLayer<v.length;){const We=L[this.currentLayer];if(We.type==="raster"||We.type==="raster-particle"){const tt=t.getLayerSourceCache(We);this.renderLayer(this,tt,We,Ge(We,tt))}++this.currentLayer}this.renderElevatedRasterBackface=!1}this.currentLayer=0,this.firstLightBeamLayer=Number.MAX_SAFE_INTEGER;let Ze=0;Ee&&(Ze=Ee.getShadowCastingLayerCount());let ft=!1,ct=-1;for(let We=0;We<v.length;++We){const tt=L[We];tt.isHidden(this.transform.zoom)||tt.is3D()&&(ct=We)}for(I&&ct===-1&&(S=!0);this.currentLayer<v.length;){const We=L[this.currentLayer],tt=t.getLayerSourceCache(We);if(We.isSky())++this.currentLayer;else if(this.terrain&&this.style.isLayerDraped(We)){if(We.isHidden(this.transform.zoom)){++this.currentLayer;continue}this.currentLayer=this.terrain.renderBatch(this.currentLayer),this._lastOcclusionLayer=Math.max(this.currentLayer,this._lastOcclusionLayer)}else{if(S&&!ft&&this.terrain&&!this.transform.isOrthographic&&(ft=!0,this.blitDepth()),I&&ct!==-1&&this.currentLayer===ct+1&&!this.transform.isOrthographic&&this.blitDepth(),We.is3D()||this.terrain||this._renderTileClippingMasks(We,tt,tt?G[tt.id]:void 0),this.renderLayer(this,tt,We,Ge(We,tt)),!this.terrain&&Ee&&Ze>0&&We.hasShadowPass()&&--Ze==0&&(Ee.drawGroundShadows(),this.firstLightBeamLayer<=this.currentLayer)){const zt=this.currentLayer;for(this.renderPass="light-beam",this.currentLayer=this.firstLightBeamLayer;this.currentLayer<=zt;this.currentLayer++){const Gt=L[this.currentLayer];if(!Gt.hasLightBeamPass())continue;const Yt=t.getLayerSourceCache(Gt);this.renderLayer(this,Yt,Gt,Yt?re[Yt.id]:void 0)}this.currentLayer=zt,this.renderPass="translucent"}if(this.currentLayer>=this._lastOcclusionLayer&&this.layersWithOcclusionOpacity.length>0){const zt=this.currentLayer;this.depthOcclusion=!0;for(const Gt of this.layersWithOcclusionOpacity){this.currentLayer=Gt;const Yt=L[this.currentLayer],dt=t.getLayerSourceCache(Yt),Ft=dt?re[dt.id]:void 0;Yt.is3D()||this.terrain||this._renderTileClippingMasks(Yt,dt,dt?G[dt.id]:void 0),this.renderLayer(this,dt,Yt,Ft)}this.depthOcclusion=!1,this.currentLayer=zt,this.renderPass="translucent",this.layersWithOcclusionOpacity=[]}++this.currentLayer}}if(this.terrain&&this.terrain.postRender(),this._snow&&this._snow.draw(this),this._rain&&this._rain.draw(this),this.options.showTileBoundaries||this.options.showQueryGeometry||this.options.showTileAABBs){let We=null;L.forEach(tt=>{const zt=t.getLayerSourceCache(tt);zt&&!tt.isHidden(this.transform.zoom)&&zt.getVisibleCoordinates().length&&(!We||We.getSource().maxzoom<zt.getSource().maxzoom)&&(We=zt)}),We&&this.options.showTileBoundaries&&Pc.debug(this,We,We.getVisibleCoordinates(),r.aj.red,!1,this.options.showParseStatus)}this.terrain&&this._debugParams.showTerrainProxyTiles&&Pc.debug(this,this.terrain.proxySourceCache,this.terrain.proxyCoords,new r.aj(1,.8,.1,1),!0,this.options.showParseStatus),this.options.showPadding&&function(We){const tt=We.transform.padding;Kh(We,We.transform.height-(tt.top||0),3,lh),Kh(We,tt.bottom||0,3,Nl),cc(We,tt.left||0,3,jl),cc(We,We.transform.width-(tt.right||0),3,lc);const zt=We.transform.centerPoint;(function(Gt,Yt,dt,Ft){Ho(Gt,Yt-1,dt-10,2,20,Ft),Ho(Gt,Yt-10,dt-1,20,2,Ft)})(We,zt.x,We.transform.height-zt.y,jd)}(this),this.context.setDefault(),this.frameCounter=(this.frameCounter+1)%Number.MAX_SAFE_INTEGER,this.tileLoaded&&this.options.speedIndexTiming&&(this.loadTimeStamps.push(performance.now()),this.saveCanvasCopy()),V||(this.conflationActive=!1)}prepareLayer(t){this.gpuTimingStart(t);const{unsupportedLayers:o}=this.transform.projection,h=!o||!o.includes(t.type);if(fh[t.type]&&(h||this.terrain&&t.type==="custom")){const g=this.style.getLayerSourceCache(t);fh[t.type](t,g,this)}this.gpuTimingEnd()}renderLayer(t,o,h,g){h.isHidden(this.transform.zoom)||(h.type==="background"||h.type==="sky"||h.type==="custom"||h.type==="model"||h.type==="raster"||h.type==="raster-particle"||g&&g.length)&&(this.id=h.id,this.gpuTimingStart(h),t.transform.projection.unsupportedLayers&&t.transform.projection.unsupportedLayers.includes(h.type)&&(!t.terrain||h.type!=="custom")||h.type==="clip"||Pc[h.type](t,o,h,g,this.style.placement.variableOffsets,this.options.isInitialLoad),this.gpuTimingEnd())}gpuTimingStart(t){if(!this.options.gpuTiming)return;const o=this.context.extTimerQuery,h=this.context.gl;let g=this.gpuTimers[t.id];g||(g=this.gpuTimers[t.id]={calls:0,cpuTime:0,query:h.createQuery()}),g.calls++,h.beginQuery(o.TIME_ELAPSED_EXT,g.query)}gpuTimingDeferredRenderStart(){if(this.options.gpuTimingDeferredRender){const t=this.context.extTimerQuery,o=this.context.gl,h=o.createQuery();this.deferredRenderGpuTimeQueries.push(h),o.beginQuery(t.TIME_ELAPSED_EXT,h)}}gpuTimingDeferredRenderEnd(){this.options.gpuTimingDeferredRender&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}gpuTimingEnd(){this.options.gpuTiming&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}collectGpuTimers(){const t=this.gpuTimers;return this.gpuTimers={},t}collectDeferredRenderGpuQueries(){const t=this.deferredRenderGpuTimeQueries;return this.deferredRenderGpuTimeQueries=[],t}queryGpuTimers(t){const o={};for(const h in t){const g=t[h],v=this.context.extTimerQuery,S=v.getQueryParameter(g.query,this.context.gl.QUERY_RESULT)/1e6;v.deleteQueryEXT(g.query),o[h]=S}return o}queryGpuTimeDeferredRender(t){if(!this.options.gpuTimingDeferredRender)return 0;const o=this.context.gl;let h=0;for(const g of t)h+=o.getQueryParameter(g,o.QUERY_RESULT)/1e6,o.deleteQuery(g);return h}translatePosMatrix(t,o,h,g,v){if(!h[0]&&!h[1])return t;const S=v?g==="map"?this.transform.angle:0:g==="viewport"?-this.transform.angle:0;if(S){const D=Math.sin(S),B=Math.cos(S);h=[h[0]*B-h[1]*D,h[0]*D+h[1]*B]}const I=[v?h[0]:r.ar(o,h[0],this.transform.zoom),v?h[1]:r.ar(o,h[1],this.transform.zoom),0],L=new Float32Array(16);return r.ab.mat4.translate(L,t,I),L}saveTileTexture(t){const o=t.size[0],h=this._tileTextures[o];h?h.push(t):this._tileTextures[o]=[t]}getTileTexture(t){const o=this._tileTextures[t];return o&&o.length>0?o.pop():null}terrainRenderModeElevated(){return this.style&&!!this.style.getTerrain()&&!!this.terrain&&!this.terrain.renderingToTexture||this.forceTerrainMode}linearFloatFilteringSupported(){return this.context.extTextureFloatLinear!=null}currentGlobalDefines(t,o,h){const g=h===void 0?this.terrain&&this.terrain.renderingToTexture:h,v=[];return this.style&&this.style.enable3dLights()&&(t==="globeRaster"||t==="terrainRaster"?(v.push("LIGHTING_3D_MODE"),v.push("LIGHTING_3D_ALPHA_EMISSIVENESS")):g||v.push("LIGHTING_3D_MODE")),this.renderPass==="shadow"&&(this._shadowMapDebug||v.push("DEPTH_TEXTURE")),this.terrainRenderModeElevated()&&(v.push("TERRAIN"),this.linearFloatFilteringSupported()&&v.push("TERRAIN_DEM_FLOAT_FORMAT")),this.transform.projection.name==="globe"&&v.push("GLOBE"),!this._fogVisible||g||o!==void 0&&!o||v.push("FOG","FOG_DITHERING"),g&&v.push("RENDER_TO_TEXTURE"),this._showOverdrawInspector&&v.push("OVERDRAW_INSPECTOR"),v}getOrCreateProgram(t,o){this.cache=this.cache||{};const h=o&&o.defines||[],g=o&&o.config,v=this.currentGlobalDefines(t,o&&o.overrideFog,o&&o.overrideRtt).concat(h),S=Js.cacheKey(Wh[t],t,v,g);return this.cache[S]||(this.cache[S]=new Js(this.context,t,Wh[t],g,Xi[t],v)),this.cache[S]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.frontFace.setDefault(),this.context.cullFaceSide.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const t=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(t.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new r.T(this.context,this.debugOverlayCanvas,this.context.gl.RGBA8))}destroy(){this._terrain&&this._terrain.destroy(),this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0),this.globeSharedBuffers&&this.globeSharedBuffers.destroy(),this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy(),this._wireframeDebugCache.destroy(),this.depthFBO&&(this.depthFBO.destroy(),this.depthFBO=void 0,this.depthTexture=void 0),this.emptyDepthTexture&&this.emptyDepthTexture.destroy()}prepareDrawTile(){this.terrain&&this.terrain.prepareDrawTile()}uploadCommonLightUniforms(t,o){if(this.style.enable3dLights()){const h=this.style.directionalLight,g=this.style.ambientLight;if(h&&g){const v=((S,I,L)=>{const D=S.properties.get("direction"),B=S.properties.get("color-use-theme")==="none",V=S.properties.get("color").toRenderColor(B?null:L.getLut(S.scope)).toArray01(),U=S.properties.get("intensity"),G=I.properties.get("color-use-theme")==="none",re=I.properties.get("color").toRenderColor(G?null:L.getLut(I.scope)).toArray01(),Q=I.properties.get("intensity"),ue=[D.x,D.y,D.z],ce=r.cM(re,Q),ye=r.cM(V,U);return{u_lighting_ambient_color:ce,u_lighting_directional_dir:ue,u_lighting_directional_color:ye,u_ground_radiance:Qo(ue,ye,ce)}})(h,g,this.style);o.setLightsUniformValues(t,v)}}}uploadCommonUniforms(t,o,h,g,v){if(this.uploadCommonLightUniforms(t,o),this.terrain&&this.terrain.renderingToTexture)return;const S=this.style.fog;if(S){const I=S.getOpacity(this.transform.pitch),L=((D,B,V,U,G,re,Q,ue,ce,ye,Ae,Ee)=>{const Fe=D.transform,ze=B.properties.get("color-use-theme")==="none",Oe=B.properties.get("color").toRenderColor(ze?null:D.style.getLut(B.scope)).toArray01();Oe[3]=U;const ke=D.frameCounter/1e3%1,[Ge,Ze]=B.properties.get("vertical-range");return{u_fog_matrix:V?Fe.calculateFogTileMatrix(V):Ee||D.identityMat,u_fog_range:B.getFovAdjustedRange(Fe._fov),u_fog_color:Oe,u_fog_horizon_blend:B.properties.get("horizon-blend"),u_fog_vertical_limit:[Math.min(Ge,Ze),Ze],u_fog_temporal_offset:ke,u_frustum_tl:G,u_frustum_tr:re,u_frustum_br:Q,u_frustum_bl:ue,u_globe_pos:ce,u_globe_radius:ye,u_viewport:Ae,u_globe_transition:r.ae(Fe.zoom),u_is_globe:+(Fe.projection.name==="globe")}})(this,S,h,I,this.transform.frustumCorners.TL,this.transform.frustumCorners.TR,this.transform.frustumCorners.BR,this.transform.frustumCorners.BL,this.transform.globeCenterInViewSpace,this.transform.globeRadius,[this.transform.width*r.q.devicePixelRatio,this.transform.height*r.q.devicePixelRatio],g);o.setFogUniformValues(t,L)}v&&o.setCutoffUniformValues(t,v.uniformValues)}setTileLoadedFlag(t){this.tileLoaded=t}saveCanvasCopy(){const t=this.canvasCopy();t&&(this.frameCopies.push(t),this.tileLoaded=!1)}canvasCopy(){const t=this.context.gl,o=t.createTexture();return t.bindTexture(t.TEXTURE_2D,o),t.copyTexImage2D(t.TEXTURE_2D,0,t.RGBA,0,0,t.drawingBufferWidth,t.drawingBufferHeight,0),o}getCanvasCopiesAndTimestamps(){return{canvasCopies:this.frameCopies,timeStamps:this.loadTimeStamps}}averageElevationNeedsEasing(){if(!this.transform._elevation)return!1;const t=this.style&&this.style.fog;return!!t&&t.getOpacity(this.transform.pitch)!==0}getBackgroundTiles(){const t=this._backgroundTiles,o=this._backgroundTiles={},h=this.transform.coveringTiles({tileSize:512});for(const g of h)o[g.key]=t[g.key]||new As(g,512,this.transform.tileZoom,this);return o}clearBackgroundTiles(){this._backgroundTiles={}}isSourceForClippingOrConflation(t,o){return!(!t.is3D()||t.type!=="clip"&&(t.minzoom&&t.minzoom>this.transform.zoom||(this.style._clipLayerPresent||t.sourceLayer!=="building")&&(!o||o.type!=="batched-model")))}isTileAffectedByFog(t){if(!this.style||!this.style.fog)return!1;if(this.transform.projection.name==="globe")return!0;let o=this._cachedTileFogOpacities[t.key];return o||(this._cachedTileFogOpacities[t.key]=o=this.style.fog.getOpacityForTile(t)),o[0]>=on||o[1]>=on}setupDepthForOcclusion(t,o,h){const g=this.context,v=g.gl,S=!!h;var I;h||(h={u_dem:2,u_dem_prev:4,u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_depth_range_unpack:[0,1],u_occluder_half_size:16,u_occlusion_depth_offset:-1e-4,u_exaggeration:0}),g.activeTexture.set(v.TEXTURE3),t&&this.depthFBO&&this.depthTexture?(this.depthTexture.bind(v.NEAREST,v.CLAMP_TO_EDGE),h.u_depth_size_inv=[1/this.depthFBO.width,1/this.depthFBO.height],h.u_depth_range_unpack=[2/((I=this.depthRangeFor3D)[1]-I[0]),-1-2*I[0]/(I[1]-I[0])],h.u_occluder_half_size=.5*this.occlusionParams.occluderSize,h.u_occlusion_depth_offset=this.occlusionParams.depthOffset):this.emptyDepthTexture.bind(v.NEAREST,v.CLAMP_TO_EDGE),g.activeTexture.set(v.TEXTURE0),S||o.setTerrainUniformValues(g,h)}}function Gd(u,t){let o=!1,h=null;const g=()=>{h=null,o&&(u(),h=setTimeout(g,t),o=!1)};return()=>(o=!0,h||g(),h)}class id{constructor(t){this._hashName=t&&encodeURIComponent(t),r.aP(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=Gd(this._updateHashUnthrottled.bind(this),300)}addTo(t){return this._map=t,window.addEventListener("hashchange",this._onHashChange,!1),t.on("moveend",this._updateHash),this}remove(){return this._map?(this._map.off("moveend",this._updateHash),window.removeEventListener("hashchange",this._onHashChange,!1),clearTimeout(this._updateHash()),this._map=void 0,this):this}getHashString(){const t=this._map;if(!t)return"";const o=qd(t);if(this._hashName){const h=this._hashName;let g=!1;const v=location.hash.slice(1).split("&").map(S=>{const I=S.split("=")[0];return I===h?(g=!0,`${I}=${o}`):S}).filter(S=>S);return g||v.push(`${h}=${o}`),`#${v.join("&")}`}return`#${o}`}_getCurrentHash(){const t=location.hash.replace("#","");if(this._hashName){let o;return t.split("&").map(h=>h.split("=")).forEach(h=>{h[0]===this._hashName&&(o=h)}),(o&&o[1]||"").split("/")}return t.split("/")}_onHashChange(){const t=this._map;if(!t)return!1;const o=this._getCurrentHash();if(o.length>=3&&!o.some(h=>isNaN(h))){const h=t.dragRotate.isEnabled()&&t.touchZoomRotate.isEnabled()?+(o[3]||0):t.getBearing();return t.jumpTo({center:[+o[2],+o[1]],zoom:+o[0],bearing:h,pitch:+(o[4]||0)}),!0}return!1}_updateHashUnthrottled(){history.replaceState(history.state,"",location.href.replace(/(#.+)?$/,this.getHashString()))}}function qd(u,t){const o=u.getCenter(),h=Math.round(100*u.getZoom())/100,g=Math.ceil((h*Math.LN2+Math.log(512/360/.5))/Math.LN10),v=Math.pow(10,g),S=Math.round(o.lng*v)/v,I=Math.round(o.lat*v)/v,L=u.getBearing(),D=u.getPitch();let B=t?`/${S}/${I}/${h}`:`${h}/${I}/${S}`;return(L||D)&&(B+="/"+Math.round(10*L)/10),D&&(B+=`/${Math.round(D)}`),B}const ph={linearity:.3,easing:r.dy(0,0,.3,1)},Ip=r.l({deceleration:2500,maxSpeed:1400},ph),Pp=r.l({deceleration:20,maxSpeed:1400},ph),Bf=r.l({deceleration:1e3,maxSpeed:360},ph),Rp=r.l({deceleration:1e3,maxSpeed:90},ph);class kp{constructor(t){this._map=t,this.clear()}clear(){this._inertiaBuffer=[]}record(t){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:r.q.now(),settings:t})}_drainInertiaBuffer(){const t=this._inertiaBuffer,o=r.q.now();for(;t.length>0&&o-t[0].time>160;)t.shift()}_onMoveEnd(t){if(this._map._prefersReducedMotion()||(this._drainInertiaBuffer(),this._inertiaBuffer.length<2))return;const o={zoom:0,bearing:0,pitch:0,pan:new r.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:v}of this._inertiaBuffer)o.zoom+=v.zoomDelta||0,o.bearing+=v.bearingDelta||0,o.pitch+=v.pitchDelta||0,v.panDelta&&o.pan._add(v.panDelta),v.around&&(o.around=v.around),v.pinchAround&&(o.pinchAround=v.pinchAround);const h=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,g={};if(o.pan.mag()){const v=Zd(o.pan.mag(),h,r.l({},Ip,t||{}));g.offset=o.pan.mult(v.amount/o.pan.mag()),g.center=this._map.transform.center,od(g,v)}if(o.zoom){const v=Zd(o.zoom,h,Pp);g.zoom=this._map.transform.zoom+v.amount,od(g,v)}if(o.bearing){const v=Zd(o.bearing,h,Bf);g.bearing=this._map.transform.bearing+r.aw(v.amount,-179,179),od(g,v)}if(o.pitch){const v=Zd(o.pitch,h,Rp);g.pitch=this._map.transform.pitch+v.amount,od(g,v)}if(g.zoom||g.bearing){const v=o.pinchAround===void 0?o.around:o.pinchAround;g.around=v?this._map.unproject(v):this._map.getCenter()}return this.clear(),g.noMoveStart=!0,g}}function od(u,t){(!u.duration||u.duration<t.duration)&&(u.duration=t.duration,u.easing=t.easing)}function Zd(u,t,o){const{maxSpeed:h,linearity:g,deceleration:v}=o,S=r.aw(u*g/(t/1e3),-h,h),I=Math.abs(S)/(v*g);return{easing:o.easing,duration:1e3*I,amount:S*(I/2)}}class Pa extends r.z{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,o,h,g={}){const v=rt(o.getCanvasContainer(),h),S=o.unproject(v);super(t,r.l({point:v,lngLat:S,originalEvent:h},g)),this._defaultPrevented=!1,this.target=o}}class Xd extends r.z{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,o,h){const g=t==="touchend"?h.changedTouches:h.touches,v=at(o.getCanvasContainer(),g),S=v.map(L=>o.unproject(L)),I=v.reduce((L,D,B,V)=>L.add(D.div(V.length)),new r.P(0,0));super(t,{points:v,point:I,lngLats:S,lngLat:o.unproject(I),originalEvent:h}),this._defaultPrevented=!1}}class fm extends r.z{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,o){super("wheel",{originalEvent:o}),this._defaultPrevented=!1}}class zp{constructor(t,o){this._map=t,this._clickTolerance=o.clickTolerance}reset(){this._mousedownPos=void 0}wheel(t){return this._firePreventable(new fm(this._map,t))}mousedown(t,o){return this._mousedownPos=o,this._firePreventable(new Pa(t.type,this._map,t))}mouseup(t){this._map.fire(new Pa(t.type,this._map,t))}preclick(t){const o=r.l({},t);o.type="preclick",this._map.fire(new Pa(o.type,this._map,o))}click(t,o){this._mousedownPos&&this._mousedownPos.dist(o)>=this._clickTolerance||(this.preclick(t),this._map.fire(new Pa(t.type,this._map,t)))}dblclick(t){return this._firePreventable(new Pa(t.type,this._map,t))}mouseover(t){this._map.fire(new Pa(t.type,this._map,t))}mouseout(t){this._map.fire(new Pa(t.type,this._map,t))}touchstart(t){return this._firePreventable(new Xd(t.type,this._map,t))}touchmove(t){this._map.fire(new Xd(t.type,this._map,t))}touchend(t){this._map.fire(new Xd(t.type,this._map,t))}touchcancel(t){this._map.fire(new Xd(t.type,this._map,t))}_firePreventable(t){if(this._map.fire(t),t.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Lp{constructor(t){this._map=t}reset(){this._delayContextMenu=!1,this._contextMenuEvent=void 0}mousemove(t){this._map.fire(new Pa(t.type,this._map,t))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new Pa("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(t){this._delayContextMenu?this._contextMenuEvent=t:this._map.fire(new Pa(t.type,this._map,t)),this._map.listens("contextmenu")&&t.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Op{constructor(t,o){this._map=t,this._el=t.getCanvasContainer(),this._container=t.getContainer(),this._clickTolerance=o.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(t,o){this.isEnabled()&&t.shiftKey&&t.button===0&&(Ne(),this._startPos=this._lastPos=o,this._active=!0)}mousemoveWindow(t,o){if(!this._active)return;const h=o,g=this._startPos,v=this._lastPos;if(!g||!v||v.equals(h)||!this._box&&h.dist(g)<this._clickTolerance)return;this._lastPos=h,this._box||(this._box=ge("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",t));const S=Math.min(g.x,h.x),I=Math.max(g.x,h.x),L=Math.min(g.y,h.y),D=Math.max(g.y,h.y);this._map._requestDomTask(()=>{this._box&&(this._box.style.transform=`translate(${S}px,${L}px)`,this._box.style.width=I-S+"px",this._box.style.height=D-L+"px")})}mouseupWindow(t,o){if(!this._active)return;const h=this._startPos,g=o;if(h&&t.button===0){if(this.reset(),Pe(),h.x!==g.x||h.y!==g.y)return this._map.fire(new r.z("boxzoomend",{originalEvent:t})),{cameraAnimation:v=>v.fitScreenCoordinates(h,g,this._map.getBearing(),{linear:!1})};this._fireEvent("boxzoomcancel",t)}}keydown(t){this._active&&t.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",t))}blur(){this.reset()}reset(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(this._box.remove(),this._box=null),nt(),delete this._startPos,delete this._lastPos}_fireEvent(t,o){return this._map.fire(new r.z(t,{originalEvent:o}))}}function sd(u,t){const o={};for(let h=0;h<u.length;h++)o[u[h].identifier]=t[h];return o}class Pg{constructor(t){this.reset(),this.numTouches=t.numTouches}reset(){this.centroid=void 0,this.startTime=0,this.touches={},this.aborted=!1}touchstart(t,o,h){(this.centroid||h.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===0&&(this.startTime=t.timeStamp),h.length===this.numTouches&&(this.centroid=function(g){const v=new r.P(0,0);for(const S of g)v._add(S);return v.div(g.length)}(o),this.touches=sd(h,o)))}touchmove(t,o,h){if(this.aborted||!this.centroid)return;const g=sd(h,o);for(const v in this.touches){const S=g[v];(!S||S.dist(this.touches[v])>30)&&(this.aborted=!0)}}touchend(t,o,h){if((!this.centroid||t.timeStamp-this.startTime>500)&&(this.aborted=!0),h.length===0){const g=!this.aborted&&this.centroid;if(this.reset(),g)return g}}}class vo{constructor(t){this.singleTap=new Pg(t),this.numTaps=t.numTaps,this.reset()}reset(){this.lastTime=1/0,this.lastTap=void 0,this.count=0,this.singleTap.reset()}touchstart(t,o,h){this.singleTap.touchstart(t,o,h)}touchmove(t,o,h){this.singleTap.touchmove(t,o,h)}touchend(t,o,h){const g=this.singleTap.touchend(t,o,h);if(g){const v=t.timeStamp-this.lastTime<500,S=!this.lastTap||this.lastTap.dist(g)<30;if(v&&S||this.reset(),this.count++,this.lastTime=t.timeStamp,this.lastTap=g,this.count===this.numTaps)return this.reset(),g}}}class pm{constructor(){this._zoomIn=new vo({numTouches:1,numTaps:2}),this._zoomOut=new vo({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(t,o,h){this._zoomIn.touchstart(t,o,h),this._zoomOut.touchstart(t,o,h)}touchmove(t,o,h){this._zoomIn.touchmove(t,o,h),this._zoomOut.touchmove(t,o,h)}touchend(t,o,h){const g=this._zoomIn.touchend(t,o,h),v=this._zoomOut.touchend(t,o,h);return g?(this._active=!0,t.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:S=>S.easeTo({duration:300,zoom:S.getZoom()+1,around:S.unproject(g)},{originalEvent:t})}):v?(this._active=!0,t.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:S=>S.easeTo({duration:300,zoom:S.getZoom()-1,around:S.unproject(v)},{originalEvent:t})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}const dc={0:1,2:2};class Yd{constructor(t){this.reset(),this._clickTolerance=t.clickTolerance||1}blur(){this.reset()}reset(){this._active=!1,this._moved=!1,this._lastPoint=void 0,this._eventButton=void 0}_correctButton(t,o){return!1}_move(t,o){return{}}mousedown(t,o){if(this._lastPoint)return;const h=Qe(t);this._correctButton(t,h)&&(this._lastPoint=o,this._eventButton=h)}mousemoveWindow(t,o){const h=this._lastPoint;if(h){if(t.preventDefault(),this._eventButton!=null&&function(g,v){const S=dc[v];return g.buttons===void 0||(g.buttons&S)!==S}(t,this._eventButton))this.reset();else if(this._moved||!(o.dist(h)<this._clickTolerance))return this._moved=!0,this._lastPoint=o,this._move(h,o)}}mouseupWindow(t){this._lastPoint&&Qe(t)===this._eventButton&&(this._moved&&Pe(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Du extends Yd{mousedown(t,o){super.mousedown(t,o),this._lastPoint&&(this._active=!0)}_correctButton(t,o){return o===0&&!t.ctrlKey}_move(t,o){return{around:o,panDelta:o.sub(t)}}}class Nf extends Yd{_correctButton(t,o){return o===0&&t.ctrlKey||o===2}_move(t,o){const h=.8*(o.x-t.x);if(h)return this._active=!0,{bearingDelta:h}}contextmenu(t){t.preventDefault()}}class Kd extends Yd{_correctButton(t,o){return o===0&&t.ctrlKey||o===2}_move(t,o){const h=-.5*(o.y-t.y);if(h)return this._active=!0,{pitchDelta:h}}contextmenu(t){t.preventDefault()}}class Jd{constructor(t,o){this._map=t,this._el=t.getCanvasContainer(),this._minTouches=1,this._clickTolerance=o.clickTolerance||1,this.reset(),r.aP(["_addTouchPanBlocker","_showTouchPanBlockerAlert"],this)}reset(){this._active=!1,this._touches={},this._sum=new r.P(0,0)}touchstart(t,o,h){return this._calculateTransform(t,o,h)}touchmove(t,o,h){if(this._active&&!(h.length<this._minTouches)){if(this._map._cooperativeGestures&&!this._map.isMoving()){if(h.length===1&&!r.dz())return void this._showTouchPanBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}return t.cancelable&&t.preventDefault(),this._calculateTransform(t,o,h)}}touchend(t,o,h){this._calculateTransform(t,o,h),this._active&&h.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(t,o,h){h.length>0&&(this._active=!0);const g=sd(h,o),v=new r.P(0,0),S=new r.P(0,0);let I=0;for(const D in g){const B=g[D],V=this._touches[D];V&&(v._add(B),S._add(B.sub(V)),I++,g[D]=B)}if(this._touches=g,I<this._minTouches||!S.mag())return;const L=S.div(I);return this._sum._add(L),this._sum.mag()<this._clickTolerance?void 0:{around:v.div(I),panDelta:L}}enable(){this._enabled=!0,this._map._cooperativeGestures&&(this._addTouchPanBlocker(),this._el.classList.add("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page"))}disable(){this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove(),this._el.classList.remove("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page")),this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}_addTouchPanBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=ge("div","mapboxgl-touch-pan-blocker",this._map._container),this._alertContainer.textContent=this._map._getUIString("TouchPanBlocker.Message"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showTouchPanBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=window.setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-touch-pan-blocker-show"),this._alertContainer.removeAttribute("role")},500)}}class wl{constructor(){this.reset()}reset(){this._active=!1,this._firstTwoTouches=void 0}_start(t){}_move(t,o,h){return{}}touchstart(t,o,h){this._firstTwoTouches||h.length<2||(this._firstTwoTouches=[h[0].identifier,h[1].identifier],this._start([o[0],o[1]]))}touchmove(t,o,h){const g=this._firstTwoTouches;if(!g)return;t.preventDefault();const[v,S]=g,I=Hl(h,o,v),L=Hl(h,o,S);if(!I||!L)return;const D=this._aroundCenter?null:I.add(L).div(2);return this._move([I,L],D,t)}touchend(t,o,h){if(!this._firstTwoTouches)return;const[g,v]=this._firstTwoTouches,S=Hl(h,o,g),I=Hl(h,o,v);S&&I||(this._active&&Pe(),this.reset())}touchcancel(){this.reset()}enable(t){this._enabled=!0,this._aroundCenter=!!t&&t.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function Hl(u,t,o){for(let h=0;h<u.length;h++)if(u[h].identifier===o)return t[h]}function xo(u,t){return Math.log(u/t)/Math.LN2}class Wl extends wl{reset(){super.reset(),this._distance=0,this._startDistance=0}_start(t){this._startDistance=this._distance=t[0].dist(t[1])}_move(t,o){const h=this._distance;if(this._distance=t[0].dist(t[1]),this._active||!(Math.abs(xo(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:xo(this._distance,h),pinchAround:o}}}function jf(u,t){return 180*u.angleWith(t)/Math.PI}class Qd extends wl{reset(){super.reset(),this._minDiameter=0,this._startVector=void 0,this._vector=void 0}_start(t){this._startVector=this._vector=t[0].sub(t[1]),this._minDiameter=t[0].dist(t[1])}_move(t,o){const h=this._vector;if(this._vector=t[0].sub(t[1]),h&&(this._active||!this._isBelowThreshold(this._vector)))return this._active=!0,{bearingDelta:jf(this._vector,h),pinchAround:o}}_isBelowThreshold(t){this._minDiameter=Math.min(this._minDiameter,t.mag());const o=25/(Math.PI*this._minDiameter)*360,h=this._startVector;if(!h)return!1;const g=jf(t,h);return Math.abs(g)<o}}function ef(u){return Math.abs(u.y)>Math.abs(u.x)}class mm extends wl{constructor(t){super(),this._map=t}reset(){super.reset(),this._valid=void 0,this._firstMove=void 0,this._lastPoints=void 0}_start(t){this._lastPoints=t,ef(t[0].sub(t[1]))&&(this._valid=!1)}_move(t,o,h){const g=this._lastPoints;if(!g)return;const v=t[0].sub(g[0]),S=t[1].sub(g[1]);return this._map._cooperativeGestures&&!r.dz()&&h.touches.length<3||(this._valid=this.gestureBeginsVertically(v,S,h.timeStamp),!this._valid)?void 0:(this._lastPoints=t,this._active=!0,{pitchDelta:(v.y+S.y)/2*-.5})}gestureBeginsVertically(t,o,h){if(this._valid!==void 0)return this._valid;const g=t.mag()>=2,v=o.mag()>=2;if(!g&&!v)return;if(!g||!v)return this._firstMove==null&&(this._firstMove=h),h-this._firstMove<100&&void 0;const S=t.y>0==o.y>0;return ef(t)&&ef(o)&&S}}const ad={panStep:100,bearingStep:15,pitchStep:10};class gm{constructor(){const t=ad;this._panStep=t.panStep,this._bearingStep=t.bearingStep,this._pitchStep=t.pitchStep,this._rotationDisabled=!1}blur(){this.reset()}reset(){this._active=!1}keydown(t){if(t.altKey||t.ctrlKey||t.metaKey)return;let o=0,h=0,g=0,v=0,S=0;switch(t.keyCode){case 61:case 107:case 171:case 187:o=1;break;case 189:case 109:case 173:o=-1;break;case 37:t.shiftKey?h=-1:(t.preventDefault(),v=-1);break;case 39:t.shiftKey?h=1:(t.preventDefault(),v=1);break;case 38:t.shiftKey?g=1:(t.preventDefault(),S=-1);break;case 40:t.shiftKey?g=-1:(t.preventDefault(),S=1);break;default:return}return this._rotationDisabled&&(h=0,g=0),{cameraAnimation:I=>{const L=I.getZoom();I.easeTo({duration:300,easeId:"keyboardHandler",easing:Rg,zoom:o?Math.round(L)+o*(t.shiftKey?2:1):L,bearing:I.getBearing()+h*this._bearingStep,pitch:I.getPitch()+g*this._pitchStep,offset:[-v*this._panStep,-S*this._panStep],center:I.getCenter()},{originalEvent:t})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function Rg(u){return u*(2-u)}const ea=4.000244140625,ta=1/450;class mh{constructor(t,o){this._map=t,this._el=t.getCanvasContainer(),this._handler=o,this._delta=0,this._lastDelta=0,this._defaultZoomRate=.01,this._wheelZoomRate=ta,r.aP(["_onTimeout","_addScrollZoomBlocker","_showBlockerAlert"],this)}setZoomRate(t){this._defaultZoomRate=t}setWheelZoomRate(t){this._wheelZoomRate=t}isEnabled(){return!!this._enabled}isActive(){return this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(t){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!t&&t.around==="center",this._map._cooperativeGestures&&this._addScrollZoomBlocker())}disable(){this.isEnabled()&&(this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove()))}wheel(t){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!(t.ctrlKey||t.metaKey||this.isZooming()||r.dz()))return void this._showBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}let o=t.deltaMode===WheelEvent.DOM_DELTA_LINE?40*t.deltaY:t.deltaY;const h=r.q.now(),g=h-(this._lastWheelEventTime||0);this._lastWheelEventTime=h,o!==0&&o%ea==0?this._type="wheel":o!==0&&Math.abs(o)<4?this._type="trackpad":g>400?(this._type=null,this._lastValue=o,this._timeout=window.setTimeout(this._onTimeout,40,t)):this._type||(this._type=Math.abs(g*o)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,o+=this._lastValue)),t.shiftKey&&o&&(o/=4),this._type&&(this._lastWheelEvent=t,this._delta-=o,this._active||this._start(t)),t.preventDefault()}_onTimeout(t){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(t)}_start(t){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const o=rt(this._el,t);this._aroundPoint=this._aroundCenter?this._map.transform.centerPoint:o,this._aroundCoord=this._map.transform.pointCoordinate3D(this._aroundPoint),this._targetZoom=void 0,this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const t=this._map.transform;this._type==="wheel"&&t.projection.wrap&&(t._center.lng>=180||t._center.lng<=-180)&&(this._prevEase=null,this._easing=null,this._lastWheelEvent=null,this._lastWheelEventTime=0);const o=()=>t._terrainEnabled()&&this._aroundCoord?t.computeZoomRelativeTo(this._aroundCoord):t.zoom;if(this._delta!==0){const D=this._type==="wheel"&&Math.abs(this._delta)>ea?this._wheelZoomRate:this._defaultZoomRate;let B=2/(1+Math.exp(-Math.abs(this._delta*D)));this._delta<0&&B!==0&&(B=1/B);const V=o(),U=Math.pow(2,V),G=typeof this._targetZoom=="number"?t.zoomScale(this._targetZoom):U;this._targetZoom=Math.min(t.maxZoom,Math.max(t.minZoom,t.scaleZoom(G*B))),this._type==="wheel"&&(this._startZoom=V,this._easing=this._smoothOutEasing(200)),this._lastDelta=this._delta,this._delta=0}const h=typeof this._targetZoom=="number"?this._targetZoom:o(),g=this._startZoom,v=this._easing;let S,I=!1;if(this._type==="wheel"&&g&&v){const D=Math.min((r.q.now()-this._lastWheelEventTime)/200,1),B=v(D);S=r.af(g,h,B),D<1?this._frameId||(this._frameId=!0):I=!0}else S=h,I=!0;this._active=!0,I&&(this._active=!1,this._finishTimeout=window.setTimeout(()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200));let L=S-o();return L*this._lastDelta<0&&(L=0),{noInertia:!0,needsRenderFrame:!I,zoomDelta:L,around:this._aroundPoint,aroundCoord:this._aroundCoord,originalEvent:this._lastWheelEvent}}_smoothOutEasing(t){let o=r.dA;if(this._prevEase){const h=this._prevEase,g=(r.q.now()-h.start)/h.duration,v=h.easing(g+.01)-h.easing(g),S=.27/Math.sqrt(v*v+1e-4)*.01,I=Math.sqrt(.0729-S*S);o=r.dy(S,I,.25,1)}return this._prevEase={start:r.q.now(),duration:t,easing:o},o}blur(){this.reset()}reset(){this._active=!1}_addScrollZoomBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=ge("div","mapboxgl-scroll-zoom-blocker",this._map._container),this._alertContainer.textContent=/(Mac|iPad)/i.test(navigator.userAgent)?this._map._getUIString("ScrollZoomBlocker.CmdMessage"):this._map._getUIString("ScrollZoomBlocker.CtrlMessage"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=window.setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.removeAttribute("role")},200)}}class gh{constructor(t,o){this._clickZoom=t,this._tapZoom=o}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class Rc{constructor(){this.reset()}reset(){this._active=!1}blur(){this.reset()}dblclick(t,o){return t.preventDefault(),{cameraAnimation:h=>{h.easeTo({duration:300,zoom:h.getZoom()+(t.shiftKey?-1:1),around:h.unproject(o)},{originalEvent:t})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Gl{constructor(){this._tap=new vo({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,this._swipePoint=void 0,this._swipeTouch=0,this._tapTime=0,this._tap.reset()}touchstart(t,o,h){this._swipePoint||(this._tapTime&&t.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?h.length>0&&(this._swipePoint=o[0],this._swipeTouch=h[0].identifier):this._tap.touchstart(t,o,h))}touchmove(t,o,h){if(this._tapTime){if(this._swipePoint){if(h[0].identifier!==this._swipeTouch)return;const g=o[0],v=g.y-this._swipePoint.y;return this._swipePoint=g,t.preventDefault(),this._active=!0,{zoomDelta:v/128}}}else this._tap.touchmove(t,o,h)}touchend(t,o,h){this._tapTime?this._swipePoint&&h.length===0&&this.reset():this._tap.touchend(t,o,h)&&(this._tapTime=t.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class au{constructor(t,o,h){this._el=t,this._mousePan=o,this._touchPan=h}enable(t){this._inertiaOptions=t||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class lu{constructor(t,o,h){this._pitchWithRotate=t.pitchWithRotate,this._mouseRotate=o,this._mousePitch=h}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class cu{constructor(t,o,h,g){this._el=t,this._touchZoom=o,this._touchRotate=h,this._tapDragZoom=g,this._rotationDisabled=!1,this._enabled=!0}enable(t){this._touchZoom.enable(t),this._rotationDisabled||this._touchRotate.enable(t),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const ld=u=>u.zoom||u.drag||u.pitch||u.rotate;class _m extends r.z{}class ym{constructor(){this.constants=[1,1,.01],this.radius=0}setup(t,o){const h=r.ab.vec3.sub([],o,t);this.radius=r.ab.vec3.length(h[2]<0?r.ab.vec3.div([],h,this.constants):[h[0],h[1],0])}projectRay(t){r.ab.vec3.div(t,t,this.constants),r.ab.vec3.normalize(t,t),r.ab.vec3.mul(t,t,this.constants);const o=r.ab.vec3.scale([],t,this.radius);if(o[2]>0){const h=r.ab.vec3.scale([],[0,0,1],r.ab.vec3.dot(o,[0,0,1])),g=r.ab.vec3.scale([],r.ab.vec3.normalize([],[o[0],o[1],0]),this.radius),v=r.ab.vec3.add([],o,r.ab.vec3.scale([],r.ab.vec3.sub([],r.ab.vec3.add([],g,h),o),2));o[0]=v[0],o[1]=v[1]}return o}}function cd(u){return u.panDelta&&u.panDelta.mag()||u.zoomDelta||u.bearingDelta||u.pitchDelta}class $f{constructor(t,o){this._map=t,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new kp(t),this._bearingSnap=o.bearingSnap,this._previousActiveHandlers={},this._trackingEllipsoid=new ym,this._dragOrigin=null,this._eventsInProgress={},this._addDefaultHandlers(o),r.aP(["handleEvent","handleWindowEvent"],this);const h=this._el;this._listeners=[[h,"touchstart",{passive:!0}],[h,"touchmove",{passive:!1}],[h,"touchend",void 0],[h,"touchcancel",void 0],[h,"mousedown",void 0],[h,"mousemove",void 0],[h,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[h,"mouseover",void 0],[h,"mouseout",void 0],[h,"dblclick",void 0],[h,"click",void 0],[h,"keydown",{capture:!1}],[h,"keyup",void 0],[h,"wheel",{passive:!1}],[h,"contextmenu",void 0],[window,"blur",void 0]];for(const[g,v,S]of this._listeners){const I=g===document?this.handleWindowEvent:this.handleEvent;g.addEventListener(v,I,S)}}destroy(){for(const[t,o,h]of this._listeners){const g=t===document?this.handleWindowEvent:this.handleEvent;t.removeEventListener(o,g,h)}}_addDefaultHandlers(t){const o=this._map,h=o.getCanvasContainer();this._add("mapEvent",new zp(o,t));const g=o.boxZoom=new Op(o,t);this._add("boxZoom",g);const v=new pm,S=new Rc;o.doubleClickZoom=new gh(S,v),this._add("tapZoom",v),this._add("clickZoom",S);const I=new Gl;this._add("tapDragZoom",I);const L=o.touchPitch=new mm(o);this._add("touchPitch",L);const D=new Nf(t),B=new Kd(t);o.dragRotate=new lu(t,D,B),this._add("mouseRotate",D,["mousePitch"]),this._add("mousePitch",B,["mouseRotate"]);const V=new Du(t),U=new Jd(o,t);o.dragPan=new au(h,V,U),this._add("mousePan",V),this._add("touchPan",U,["touchZoom","touchRotate"]);const G=new Qd,re=new Wl;o.touchZoomRotate=new cu(h,re,G,I),this._add("touchRotate",G,["touchPan","touchZoom"]),this._add("touchZoom",re,["touchPan","touchRotate"]),this._add("blockableMapEvent",new Lp(o));const Q=o.scrollZoom=new mh(o,this);this._add("scrollZoom",Q,["mousePan"]);const ue=o.keyboard=new gm;this._add("keyboard",ue);for(const ce of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])t.interactive&&t[ce]&&o[ce].enable(t[ce])}_add(t,o,h){this._handlers.push({handlerName:t,handler:o,allowed:h}),this._handlersById[t]=o}stop(t){if(!this._updatingCamera){for(const{handler:o}of this._handlers)o.reset();this._inertia.clear(),this._fireEvents({},{},t),this._changes=[],this._originalZoom=void 0}}isActive(){for(const{handler:t}of this._handlers)if(t.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!ld(this._eventsInProgress)||this.isZooming()}_isDragging(){return!!this._eventsInProgress.drag}_blockedByActive(t,o,h){for(const g in t)if(g!==h&&(!o||o.indexOf(g)<0))return!0;return!1}handleWindowEvent(t){this.handleEvent(t,`${t.type}Window`)}_getMapTouches(t){const o=[];for(const h of t)this._el.contains(h.target)&&o.push(h);return o}handleEvent(t,o){this._updatingCamera=!0;const h=t.type==="renderFrame",g=h?void 0:t,v={needsRenderFrame:!1},S={},I={},L=t.touches?this._getMapTouches(t.touches):void 0,D=L?at(this._el,L):h?void 0:rt(this._el,t);for(const{handlerName:U,handler:G,allowed:re}of this._handlers){if(!G.isEnabled())continue;let Q;this._blockedByActive(I,re,U)?G.reset():G[o||t.type]&&(Q=G[o||t.type](t,D,L),this.mergeHandlerResult(v,S,Q,U,g),Q&&Q.needsRenderFrame&&this._triggerRenderFrame()),(Q||G.isActive())&&(I[U]=G)}const B={};for(const U in this._previousActiveHandlers)I[U]||(B[U]=g);this._previousActiveHandlers=I,(Object.keys(B).length||cd(v))&&(this._changes.push([v,S,B]),this._triggerRenderFrame()),(Object.keys(I).length||cd(v))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:V}=v;V&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],V(this._map))}mergeHandlerResult(t,o,h,g,v){if(!h)return;r.l(t,h);const S={handlerName:g,originalEvent:h.originalEvent||v};h.zoomDelta!==void 0&&(o.zoom=S),h.panDelta!==void 0&&(o.drag=S),h.pitchDelta!==void 0&&(o.pitch=S),h.bearingDelta!==void 0&&(o.rotate=S)}_applyChanges(){const t={},o={},h={};for(const[g,v,S]of this._changes)g.panDelta&&(t.panDelta=(t.panDelta||new r.P(0,0))._add(g.panDelta)),g.zoomDelta&&(t.zoomDelta=(t.zoomDelta||0)+g.zoomDelta),g.bearingDelta&&(t.bearingDelta=(t.bearingDelta||0)+g.bearingDelta),g.pitchDelta&&(t.pitchDelta=(t.pitchDelta||0)+g.pitchDelta),g.around!==void 0&&(t.around=g.around),g.aroundCoord!==void 0&&(t.aroundCoord=g.aroundCoord),g.pinchAround!==void 0&&(t.pinchAround=g.pinchAround),g.noInertia&&(t.noInertia=g.noInertia),r.l(o,v),r.l(h,S);this._updateMapTransform(t,o,h),this._changes=[]}_updateMapTransform(t,o,h){const g=this._map,v=g.transform,S=ye=>[ye.x,ye.y,ye.z];if((ye=>{const Ae=this._eventsInProgress.drag;return Ae&&!this._handlersById[Ae.handlerName].isActive()})()&&!cd(t)){const ye=v.zoom;v.cameraElevationReference="sea",this._originalZoom!=null&&v._orthographicProjectionAtLowPitch&&v.projection.name!=="globe"&&v.pitch===0?(v.cameraElevationReference="ground",v.zoom=this._originalZoom):(v.recenterOnTerrain(),v.cameraElevationReference="ground"),ye!==v.zoom&&this._map._update(!0)}if(v._isCameraConstrained&&g._stop(!0),!cd(t))return void this._fireEvents(o,h,!0);let{panDelta:I,zoomDelta:L,bearingDelta:D,pitchDelta:B,around:V,aroundCoord:U,pinchAround:G}=t;v._isCameraConstrained&&(L>0&&(L=0),v._isCameraConstrained=!1),G!==void 0&&(V=G),(L||(ye=>o[ye]&&!this._eventsInProgress[ye])("drag"))&&V&&(this._dragOrigin=S(v.pointCoordinate3D(V)),this._originalZoom=v.zoom,this._trackingEllipsoid.setup(v._camera.position,this._dragOrigin)),v.cameraElevationReference="sea",g._stop(!0),V=V||g.transform.centerPoint,D&&(v.bearing+=D),B&&(v.pitch+=B),v._updateCameraState();const re=[0,0,0];if(I)if(v.projection.name==="mercator"){const ye=this._trackingEllipsoid.projectRay(v.screenPointToMercatorRay(V).dir),Ae=this._trackingEllipsoid.projectRay(v.screenPointToMercatorRay(V.sub(I)).dir);re[0]=Ae[0]-ye[0],re[1]=Ae[1]-ye[1]}else{const ye=v.pointCoordinate(V);if(v.projection.name==="globe"){I=I.rotate(-v.angle);const Ae=v._pixelsPerMercatorPixel/v.worldSize;re[0]=-I.x*r.dB(r.aS(ye.y))*Ae,re[1]=-I.y*r.dB(v.center.lat)*Ae}else{const Ae=v.pointCoordinate(V.sub(I));ye&&Ae&&(re[0]=Ae.x-ye.x,re[1]=Ae.y-ye.y)}}const Q=v.zoom,ue=[0,0,0];if(L){const ye=S(U||v.pointCoordinate3D(V)),Ae={dir:r.ab.vec3.normalize([],r.ab.vec3.sub([],ye,v._camera.position))};if(Ae.dir[2]<0){const Ee=v.zoomDeltaToMovement(ye,L);r.ab.vec3.scale(ue,Ae.dir,Ee)}}const ce=r.ab.vec3.add(re,re,ue);v._translateCameraConstrained(ce),L&&Math.abs(v.zoom-Q)>1e-4&&v.recenterOnTerrain(),v.cameraElevationReference="ground",this._map._update(),t.noInertia||this._inertia.record(t),this._fireEvents(o,h,!0)}_fireEvents(t,o,h){const g=ld(this._eventsInProgress),v=ld(t),S={};for(const B in t){const{originalEvent:V}=t[B];this._eventsInProgress[B]||(S[`${B}start`]=V),this._eventsInProgress[B]=t[B]}!g&&v&&this._fireEvent("movestart",v.originalEvent);for(const B in S)this._fireEvent(B,S[B]);v&&this._fireEvent("move",v.originalEvent);for(const B in t){const{originalEvent:V}=t[B];this._fireEvent(B,V)}const I={};let L;for(const B in this._eventsInProgress){const{handlerName:V,originalEvent:U}=this._eventsInProgress[B];this._handlersById[V].isActive()||(delete this._eventsInProgress[B],L=o[V]||U,I[`${B}end`]=L)}for(const B in I)this._fireEvent(B,I[B]);const D=ld(this._eventsInProgress);if(h&&(g||v)&&!D){this._updatingCamera=!0;const B=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),V=U=>U!==0&&-this._bearingSnap<U&&U<this._bearingSnap;B?(V(B.bearing||this._map.getBearing())&&(B.bearing=0),this._map.easeTo(B,{originalEvent:L})):(this._map.fire(new r.z("moveend",{originalEvent:L})),V(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(t,o){this._map.fire(new r.z(t,o?{originalEvent:o}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(t=>{this._frameId=void 0,this.handleEvent(new _m("renderFrame",{timeStamp:t})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}const Hs="map.setFreeCameraOptions(...) and map.getFreeCameraOptions() are not yet supported for non-mercator projections.";class tf extends r.E{constructor(t,o){super(),this._moving=!1,this._zooming=!1,this.transform=t,this._bearingSnap=o.bearingSnap,this._respectPrefersReducedMotion=o.respectPrefersReducedMotion!==!1,r.aP(["_renderFrameCallback"],this)}getCenter(){return new r.bO(this.transform.center.lng,this.transform.center.lat)}setCenter(t,o){return this.jumpTo({center:t},o)}panBy(t,o,h){return t=r.P.convert(t).mult(-1),this.panTo(this.transform.center,r.l({offset:t},o),h)}panTo(t,o,h){return this.easeTo(r.l({center:t},o),h)}getZoom(){return this.transform.zoom}setZoom(t,o){return this.jumpTo({zoom:t},o),this}zoomTo(t,o,h){return this.easeTo(r.l({zoom:t},o),h)}zoomIn(t,o){return this.zoomTo(this.getZoom()+1,t,o),this}zoomOut(t,o){return this.zoomTo(this.getZoom()-1,t,o),this}getBearing(){return this.transform.bearing}setBearing(t,o){return this.jumpTo({bearing:t},o),this}getPadding(){return this.transform.padding}setPadding(t,o){return this.jumpTo({padding:t},o),this}rotateTo(t,o,h){return this.easeTo(r.l({bearing:t},o),h)}resetNorth(t,o){return this.rotateTo(0,r.l({duration:1e3},t),o),this}resetNorthPitch(t,o){return this.easeTo(r.l({bearing:0,pitch:0,duration:1e3},t),o),this}snapToNorth(t,o){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(t,o):this}getPitch(){return this.transform.pitch}setPitch(t,o){return this.jumpTo({pitch:t},o),this}cameraForBounds(t,o){t=r.az.convert(t);const h=o&&o.bearing||0,g=o&&o.pitch||0,v=t.getNorthWest(),S=t.getSouthEast();return this._cameraForBounds(this.transform,v,S,h,g,o)}_extendPadding(t){const o={top:0,right:0,bottom:0,left:0};return t==null?r.l({},o,this.transform.padding):typeof t=="number"?{top:t,bottom:t,right:t,left:t}:r.l({},o,t)}_extendCameraOptions(t){return(t=r.l({offset:[0,0],maxZoom:this.transform.maxZoom},t)).padding=this._extendPadding(t.padding),t}_minimumAABBFrustumDistance(t,o){const h=o.max[0]-o.min[0],g=o.max[1]-o.min[1];return h/g>t.aspect?h/(2*Math.tan(.5*t.fovX)*t.aspect):g/(2*Math.tan(.5*t.fovY)*t.aspect)}_cameraForBoundsOnGlobe(t,o,h,g,v,S){const I=t.clone(),L=this._extendCameraOptions(S);I.bearing=g,I.pitch=v;const D=r.bO.convert(o),B=r.bO.convert(h),V=.5*(D.lat+B.lat),U=.5*(D.lng+B.lng),G=r.dC(V,U),re=r.ab.vec3.normalize([],G),Q=r.ab.vec3.normalize([],r.ab.vec3.cross([],re,[0,1,0])),ue=r.ab.vec3.cross([],Q,re),ce=[Q[0],Q[1],Q[2],0,ue[0],ue[1],ue[2],0,re[0],re[1],re[2],0,0,0,0,1],ye=[G,r.dC(D.lat,D.lng),r.dC(B.lat,D.lng),r.dC(B.lat,B.lng),r.dC(D.lat,B.lng),r.dC(V,D.lng),r.dC(V,B.lng),r.dC(D.lat,U),r.dC(B.lat,U)];let Ae=r.cd.fromPoints(ye.map(Et=>[r.ab.vec3.dot(Q,Et),r.ab.vec3.dot(ue,Et),r.ab.vec3.dot(re,Et)]));const Ee=r.ab.vec3.transformMat4([],Ae.center,ce);r.ab.vec3.squaredLength(Ee)===0&&r.ab.vec3.set(Ee,0,0,1),r.ab.vec3.normalize(Ee,Ee),r.ab.vec3.scale(Ee,Ee,r.ax),I.center=r.dD(Ee);const Fe=I.getWorldToCameraMatrix(),ze=r.ab.mat4.invert(new Float64Array(16),Fe);Ae=r.cd.applyTransform(Ae,r.ab.mat4.multiply([],Fe,ce));const Oe=this._extendAABB(Ae,I,L,g);if(!Oe)return void r.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");Ae=Oe,r.ab.vec3.transformMat4(Ee,Ee,Fe);const ke=.5*(Ae.max[2]-Ae.min[2]),Ge=this._minimumAABBFrustumDistance(I,Ae),Ze=r.ab.vec3.scale([],[0,0,1],ke),ft=r.ab.vec3.add(Ze,Ee,Ze),ct=Ge+(I.pitch===0?0:r.ab.vec3.distance(Ee,ft)),We=I.globeCenterInViewSpace,tt=r.ab.vec3.sub([],Ee,[We[0],We[1],We[2]]);r.ab.vec3.normalize(tt,tt),r.ab.vec3.scale(tt,tt,ct);const zt=r.ab.vec3.add([],Ee,tt);r.ab.vec3.transformMat4(zt,zt,ze);const Gt=r.ds/r.ax,Yt=r.ab.vec3.length(zt),dt=r.bH(Math.max(Yt*Gt-r.ds,Number.EPSILON),0),Ft=Math.min(I.zoomFromMercatorZAdjusted(dt),L.maxZoom);return Ft>.5*(r.c6+r.bY)?(I.setProjection({name:"mercator"}),I.zoom=Ft,this._cameraForBounds(I,o,h,g,v,S)):{center:I.center,zoom:Ft,bearing:g,pitch:v}}_extendAABB(t,o,h,g){const v=.5*((h.padding.left||0)+(h.padding.right||0)),S=.5*((h.padding.top||0)+(h.padding.bottom||0)),I=S,L=v,D=v,B=S,V=o.width-(L+D),U=o.height-(I+B),G=r.ab.vec3.sub([],t.max,t.min),re=Math.min(V/G[0],U/G[1]),Q=Math.min(o.scaleZoom(o.scale*re),h.maxZoom);if(isNaN(Q))return null;const ue=o.scale/o.zoomScale(Q),ce=new r.cd([t.min[0]-L*ue,t.min[1]-B*ue,t.min[2]],[t.max[0]+D*ue,t.max[1]+I*ue,t.max[2]]),ye=(typeof h.offset.x=="number"&&typeof h.offset.y=="number"?new r.P(h.offset.x,h.offset.y):r.P.convert(h.offset)).rotate(-r.ai(g));return ce.center[0]-=ye.x*ue,ce.center[1]+=ye.y*ue,ce}queryTerrainElevation(t,o){const h=this.transform.elevation;return h?(o=r.l({},{exaggerated:!0},o),h.getAtPoint(r.aa.fromLngLat(t),null,o.exaggerated)):null}_cameraForBounds(t,o,h,g,v,S){if(t.projection.name==="globe")return this._cameraForBoundsOnGlobe(t,o,h,g,v,S);const I=t.clone(),L=this._extendCameraOptions(S);I.bearing=g,I.pitch=v;const D=r.bO.convert(o),B=r.bO.convert(h),V=new r.bO(D.lng,B.lat),U=new r.bO(B.lng,D.lat),G=I.project(D),re=I.project(B),Q=this.queryTerrainElevation(D),ue=this.queryTerrainElevation(B),ce=this.queryTerrainElevation(V),ye=this.queryTerrainElevation(U),Ae=[[G.x,G.y,Math.min(Q||0,ue||0,ce||0,ye||0)],[re.x,re.y,Math.max(Q||0,ue||0,ce||0,ye||0)]];let Ee=r.cd.fromPoints(Ae);const Fe=I.getWorldToCameraMatrix(),ze=r.ab.mat4.invert(new Float64Array(16),Fe);Ee=r.cd.applyTransform(Ee,Fe);const Oe=this._extendAABB(Ee,I,L,g);if(!Oe)return void r.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");Ee=Oe;const ke=.5*r.ab.vec3.sub([],Ee.max,Ee.min)[2],Ge=this._minimumAABBFrustumDistance(I,Ee),Ze=[0,0,1,0];r.ab.vec4.transformMat4(Ze,Ze,Fe),r.ab.vec4.normalize(Ze,Ze);const ft=r.ab.vec3.scale([],Ze,Ge+ke),ct=r.ab.vec3.add([],Ee.center,ft);r.ab.vec3.transformMat4(Ee.center,Ee.center,ze),r.ab.vec3.transformMat4(ct,ct,ze);const We=I.unproject(new r.P(Ee.center[0],Ee.center[1])),tt=r.dE(I.projection,We),zt=Math.pow(2,tt),Gt=Math.min(I._zoomFromMercatorZ(ct[2]*I.pixelsPerMeter*zt/I.worldSize),L.maxZoom);return I.mercatorFromTransition&&Gt<.5*(r.c6+r.bY)?(I.setProjection({name:"globe"}),I.zoom=Gt,this._cameraForBounds(I,o,h,g,v,S)):{center:We,zoom:Gt,bearing:g,pitch:v}}fitBounds(t,o,h){const g=this.cameraForBounds(t,o);return this._fitInternal(g,o,h)}fitScreenCoordinates(t,o,h,g,v){const S=r.P.convert(t),I=r.P.convert(o),L=new r.P(Math.min(S.x,I.x),Math.min(S.y,I.y)),D=new r.P(Math.max(S.x,I.x),Math.max(S.y,I.y));if(this.transform.projection.name==="mercator"&&this.transform.anyCornerOffEdge(S,I))return this;const B=this.transform.pointLocation3D(L),V=this.transform.pointLocation3D(D),U=this.transform.pointLocation3D(new r.P(L.x,D.y)),G=this.transform.pointLocation3D(new r.P(D.x,L.y)),re=[Math.min(B.lng,V.lng,U.lng,G.lng),Math.min(B.lat,V.lat,U.lat,G.lat)],Q=[Math.max(B.lng,V.lng,U.lng,G.lng),Math.max(B.lat,V.lat,U.lat,G.lat)],ue=g&&g.pitch?g.pitch:this.getPitch(),ce=this._cameraForBounds(this.transform,re,Q,h,ue,g);return this._fitInternal(ce,g,v)}_fitInternal(t,o,h){return t?(o=r.l(t,o)).linear?this.easeTo(o,h):this.flyTo(o,h):this}jumpTo(t,o){this.stop();const h=t.preloadOnly?this.transform.clone():this.transform;let g=!1,v=!1,S=!1;"zoom"in t&&h.zoom!==+t.zoom&&(g=!0,h.zoom=+t.zoom),t.center!==void 0&&(h.center=r.bO.convert(t.center)),"bearing"in t&&h.bearing!==+t.bearing&&(v=!0,h.bearing=+t.bearing),"pitch"in t&&h.pitch!==+t.pitch&&(S=!0,h.pitch=+t.pitch);const I=typeof t.padding=="number"?this._extendPadding(t.padding):t.padding;if(t.padding!=null&&!h.isPaddingEqual(I))if(t.retainPadding===!1){const L=h.clone();L.padding=I,h.setLocationAtPoint(h.center,L.centerPoint)}else h.padding=I;return t.preloadOnly?(this._preloadTiles(h),this):(this.fire(new r.z("movestart",o)).fire(new r.z("move",o)),g&&this.fire(new r.z("zoomstart",o)).fire(new r.z("zoom",o)).fire(new r.z("zoomend",o)),v&&this.fire(new r.z("rotatestart",o)).fire(new r.z("rotate",o)).fire(new r.z("rotateend",o)),S&&this.fire(new r.z("pitchstart",o)).fire(new r.z("pitch",o)).fire(new r.z("pitchend",o)),this.fire(new r.z("moveend",o)))}getFreeCameraOptions(){return this.transform.projection.supportsFreeCamera||r.w(Hs),this.transform.getFreeCameraOptions()}setFreeCameraOptions(t,o){const h=this.transform;if(!h.projection.supportsFreeCamera)return r.w(Hs),this;this.stop();const g=h.zoom,v=h.pitch,S=h.bearing;h.setFreeCameraOptions(t);const I=g!==h.zoom,L=v!==h.pitch,D=S!==h.bearing;return this.fire(new r.z("movestart",o)).fire(new r.z("move",o)),I&&this.fire(new r.z("zoomstart",o)).fire(new r.z("zoom",o)).fire(new r.z("zoomend",o)),D&&this.fire(new r.z("rotatestart",o)).fire(new r.z("rotate",o)).fire(new r.z("rotateend",o)),L&&this.fire(new r.z("pitchstart",o)).fire(new r.z("pitch",o)).fire(new r.z("pitchend",o)),this.fire(new r.z("moveend",o)),this}easeTo(t,o){this._stop(!1,t.easeId),((t=r.l({offset:[0,0],duration:500,easing:r.dA},t)).animate===!1||this._prefersReducedMotion(t))&&(t.duration=0);const h=this.transform,g=this.getZoom(),v=this.getBearing(),S=this.getPitch(),I=this.getPadding(),L="zoom"in t?+t.zoom:g,D="bearing"in t?this._normalizeBearing(t.bearing,v):v,B="pitch"in t?+t.pitch:S,V=this._extendPadding(t.padding),U=r.P.convert(t.offset);let G,re,Q;if(h.projection.name==="globe"){const Ze=r.aa.fromLngLat(h.center),ft=U.rotate(-h.angle);Ze.x+=ft.x/h.worldSize,Ze.y+=ft.y/h.worldSize;const ct=Ze.toLngLat(),We=r.bO.convert(t.center||ct);this._normalizeCenter(We),G=h.centerPoint.add(ft),re=new r.P(Ze.x,Ze.y).mult(h.worldSize),Q=new r.P(r.at(We.lng),r.aA(We.lat)).mult(h.worldSize).sub(re)}else{G=h.centerPoint.add(U);const Ze=h.pointLocation(G),ft=r.bO.convert(t.center||Ze);this._normalizeCenter(ft),re=h.project(Ze),Q=h.project(ft).sub(re)}const ue=h.zoomScale(L-g);let ce,ye;t.around&&(ce=r.bO.convert(t.around),ye=h.locationPoint(ce));const Ae=this._zooming||L!==g,Ee=this._rotating||v!==D,Fe=this._pitching||B!==S,ze=!h.isPaddingEqual(V),Oe=t.retainPadding===!1?h.clone():h,ke=Ze=>ft=>{if(Ae&&(Ze.zoom=r.af(g,L,ft)),Ee&&(Ze.bearing=r.af(v,D,ft)),Fe&&(Ze.pitch=r.af(S,B,ft)),ze&&(Oe.interpolatePadding(I,V,ft),G=Oe.centerPoint.add(U)),ce)Ze.setLocationAtPoint(ce,ye);else{const ct=Ze.zoomScale(Ze.zoom-g),We=L>g?Math.min(2,ue):Math.max(.5,ue),tt=Math.pow(We,1-ft),zt=Ze.unproject(re.add(Q.mult(ft*tt)).mult(ct));Ze.setLocationAtPoint(Ze.renderWorldCopies?zt.wrap():zt,G)}return t.preloadOnly||this._fireMoveEvents(o),Ze};if(t.preloadOnly){const Ze=this._emulate(ke,t.duration,h);return this._preloadTiles(Ze),this}const Ge={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=Ae,this._rotating=Ee,this._pitching=Fe,this._padding=ze,this._easeId=t.easeId,this._prepareEase(o,t.noMoveStart,Ge),this._ease(ke(h),Ze=>{h.cameraElevationReference==="sea"&&h.recenterOnTerrain(),this._afterEase(o,Ze)},t),this}_prepareEase(t,o,h={}){this._moving=!0,this.transform.cameraElevationReference="sea",this.transform._orthographicProjectionAtLowPitch&&this.transform.pitch===0&&this.transform.projection.name!=="globe"&&(this.transform.cameraElevationReference="ground"),o||h.moving||this.fire(new r.z("movestart",t)),this._zooming&&!h.zooming&&this.fire(new r.z("zoomstart",t)),this._rotating&&!h.rotating&&this.fire(new r.z("rotatestart",t)),this._pitching&&!h.pitching&&this.fire(new r.z("pitchstart",t))}_fireMoveEvents(t){this.fire(new r.z("move",t)),this._zooming&&this.fire(new r.z("zoom",t)),this._rotating&&this.fire(new r.z("rotate",t)),this._pitching&&this.fire(new r.z("pitch",t))}_afterEase(t,o){if(this._easeId&&o&&this._easeId===o)return;this._easeId=void 0,this.transform.cameraElevationReference="ground";const h=this._zooming,g=this._rotating,v=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,h&&this.fire(new r.z("zoomend",t)),g&&this.fire(new r.z("rotateend",t)),v&&this.fire(new r.z("pitchend",t)),this.fire(new r.z("moveend",t))}flyTo(t,o){if(this._prefersReducedMotion(t)){const Et=r.ay(t,["center","zoom","bearing","pitch","around","padding","retainPadding"]);return this.jumpTo(Et,o)}this.stop(),t=r.l({offset:[0,0],speed:1.2,curve:1.42,easing:r.dA},t);const h=this.transform,g=this.getZoom(),v=this.getBearing(),S=this.getPitch(),I=this.getPadding(),L="zoom"in t?r.aw(+t.zoom,h.minZoom,h.maxZoom):g,D="bearing"in t?this._normalizeBearing(t.bearing,v):v,B="pitch"in t?+t.pitch:S,V=this._extendPadding(t.padding),U=h.zoomScale(L-g),G=r.P.convert(t.offset);let re=h.centerPoint.add(G);const Q=h.pointLocation(re),ue=r.bO.convert(t.center||Q);this._normalizeCenter(ue);const ce=h.project(Q),ye=h.project(ue).sub(ce);let Ae=t.curve;const Ee=Math.max(h.width,h.height),Fe=Ee/U,ze=ye.mag();if("minZoom"in t){const Et=r.aw(Math.min(t.minZoom,g,L),h.minZoom,h.maxZoom),rn=Ee/h.zoomScale(Et-g);Ae=Math.sqrt(rn/ze*2)}const Oe=Ae*Ae;function ke(Et){const rn=(Fe*Fe-Ee*Ee+(Et?-1:1)*Oe*Oe*ze*ze)/(2*(Et?Fe:Ee)*Oe*ze);return Math.log(Math.sqrt(rn*rn+1)-rn)}function Ge(Et){return(Math.exp(Et)-Math.exp(-Et))/2}function Ze(Et){return(Math.exp(Et)+Math.exp(-Et))/2}const ft=ke(0);let ct=function(Et){return Ze(ft)/Ze(ft+Ae*Et)},We=function(Et){return Ee*((Ze(ft)*(Ge(rn=ft+Ae*Et)/Ze(rn))-Ge(ft))/Oe)/ze;var rn},tt=(ke(1)-ft)/Ae;if(Math.abs(ze)<1e-6||!isFinite(tt)){if(Math.abs(Ee-Fe)<1e-6)return this.easeTo(t,o);const Et=Fe<Ee?-1:1;tt=Math.abs(Math.log(Fe/Ee))/Ae,We=function(){return 0},ct=function(rn){return Math.exp(Et*Ae*rn)}}t.duration="duration"in t?+t.duration:1e3*tt/("screenSpeed"in t?+t.screenSpeed/Ae:+t.speed),t.maxDuration&&t.duration>t.maxDuration&&(t.duration=0);const zt=v!==D,Gt=B!==S,Yt=!h.isPaddingEqual(V),dt=t.retainPadding===!1?h.clone():h,Ft=Et=>rn=>{const Vt=rn*tt,kt=1/ct(Vt);Et.zoom=rn===1?L:g+Et.scaleZoom(kt),zt&&(Et.bearing=r.af(v,D,rn)),Gt&&(Et.pitch=r.af(S,B,rn)),Yt&&(dt.interpolatePadding(I,V,rn),re=dt.centerPoint.add(G));const _n=rn===1?ue:Et.unproject(ce.add(ye.mult(We(Vt))).mult(kt));return Et.setLocationAtPoint(Et.renderWorldCopies?_n.wrap():_n,re),Et._updateCameraOnTerrain(),t.preloadOnly||this._fireMoveEvents(o),Et};if(t.preloadOnly){const Et=this._emulate(Ft,t.duration,h);return this._preloadTiles(Et),this}return this._zooming=!0,this._rotating=zt,this._pitching=Gt,this._padding=Yt,this._prepareEase(o,!1),this._ease(Ft(h),()=>this._afterEase(o),t),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_requestRenderFrame(t){}_cancelRenderFrame(t){}_stop(t,o){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),this._easeFrameId=void 0,this._onEaseFrame=void 0),this._onEaseEnd){const h=this._onEaseEnd;this._onEaseEnd=void 0,h.call(this,o)}if(!t){const h=this.handlers;h&&h.stop(!1)}return this}_ease(t,o,h){h.animate===!1||h.duration===0?(t(1),o()):(this._easeStart=r.q.now(),this._easeOptions=h,this._onEaseFrame=t,this._onEaseEnd=o,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){const t=Math.min((r.q.now()-this._easeStart)/this._easeOptions.duration,1),o=this._onEaseFrame;o&&o(this._easeOptions.easing(t)),t<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(t,o){t=r.bF(t,-180,180);const h=Math.abs(t-o);return Math.abs(t-360-o)<h&&(t-=360),Math.abs(t+360-o)<h&&(t+=360),t}_normalizeCenter(t){const o=this.transform;if(o.maxBounds||o.projection.name!=="globe"&&!o.renderWorldCopies)return;const h=t.lng-o.center.lng;t.lng+=h>180?-360:h<-180?360:0}_prefersReducedMotion(t){return this._respectPrefersReducedMotion&&r.q.prefersReducedMotion&&!(t&&t.essential)}_emulate(t,o,h){const g=Math.ceil(15*o/1e3),v=[],S=t(h.clone());for(let I=0;I<=g;I++){const L=S(I/g);v.push(L.clone())}return v}_preloadTiles(t,o){}}class ud{constructor(t={}){this.options=t,r.aP(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)}getDefaultPosition(){return"bottom-right"}onAdd(t){const o=this.options&&this.options.compact,h=t._getUIString("AttributionControl.ToggleAttribution");this._map=t,this._container=ge("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=ge("button","mapboxgl-ctrl-attrib-button",this._container),this._compactButton.type="button",this._compactButton.addEventListener("click",this._toggleAttribution),this._compactButton.setAttribute("aria-label",h);const g=ge("span","mapboxgl-ctrl-icon",this._compactButton);return g.setAttribute("aria-hidden","true"),g.setAttribute("title",h),this._innerContainer=ge("div","mapboxgl-ctrl-attrib-inner",this._container),o&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),o===void 0&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container}onRemove(){this._container.remove(),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0}_toggleAttribution(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","true"))}_updateEditLink(){let t=this._editLink;t||(t=this._editLink=this._container.querySelector(".mapbox-improve-map"));const o=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||r.e.ACCESS_TOKEN}];if(t){const h=o.reduce((g,v,S)=>(v.value&&(g+=`${v.key}=${v.value}${S<o.length-1?"&":""}`),g),"?");t.href=`${r.e.FEEDBACK_URL}/${h}#${qd(this._map,!0)}`,t.rel="noopener nofollow"}}_updateData(t){!t||t.sourceDataType!=="metadata"&&t.sourceDataType!=="visibility"&&t.dataType!=="style"||(this._updateAttributions(),this._updateEditLink())}_updateAttributions(){if(!this._map.style)return;let t=[];if(this._map.style.stylesheet){const g=this._map.style.stylesheet;this.styleOwner=g.owner,this.styleId=g.id}const o=this._map.style._mergedSourceCaches;for(const g in o){const v=o[g];if(v.used){const S=v.getSource();S.attribution&&t.indexOf(S.attribution)<0&&t.push(S.attribution)}}t.sort((g,v)=>g.length-v.length),t=t.filter((g,v)=>{for(let S=v+1;S<t.length;S++)if(t[S].indexOf(g)>=0)return!1;return!0}),this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?t=[...this.options.customAttribution,...t]:t.unshift(this.options.customAttribution));const h=t.join(" | ");h!==this._attribHTML&&(this._attribHTML=h,t.length?(this._innerContainer.innerHTML=h,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")}}class vm{constructor(){r.aP(["_updateLogo","_updateCompact"],this)}onAdd(t){this._map=t,this._container=ge("div","mapboxgl-ctrl");const o=ge("a","mapboxgl-ctrl-logo");return o.target="_blank",o.rel="noopener nofollow",o.href="https://www.mapbox.com/",o.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),o.setAttribute("rel","noopener nofollow"),this._container.appendChild(o),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){this._container.remove(),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)}getDefaultPosition(){return"bottom-left"}_updateLogo(t){t&&t.sourceDataType!=="metadata"||(this._container.style.display=this._logoRequired()?"block":"none")}_logoRequired(){if(!this._map.style)return!0;const t=this._map.style._sourceCaches;if(Object.entries(t).length===0)return!0;for(const o in t){const h=t[o].getSource();if(h.hasOwnProperty("mapbox_logo")&&!h.mapbox_logo)return!1}return!0}_updateCompact(){const t=this._container.children;if(t.length){const o=t[0];this._map.getCanvasContainer().offsetWidth<250?o.classList.add("mapboxgl-compact"):o.classList.remove("mapboxgl-compact")}}}class Fu{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(t){const o=++this._id;return this._queue.push({callback:t,id:o,cancelled:!1}),o}remove(t){const o=this._currentlyRunning,h=o?this._queue.concat(o):this._queue;for(const g of h)if(g.id===t)return void(g.cancelled=!0)}run(t=0){const o=this._currentlyRunning=this._queue;this._queue=[];for(const h of o)if(!h.cancelled&&(h.callback(t),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}class nf{constructor(t){this.jumpTo(t)}getValue(t){if(t<=this._startTime)return this._start;if(t>=this._endTime)return this._end;const o=r.cB((t-this._startTime)/(this._endTime-this._startTime));return this._start*(1-o)+this._end*o}isEasing(t){return t>=this._startTime&&t<=this._endTime}jumpTo(t){this._startTime=-1/0,this._endTime=-1/0,this._start=t,this._end=t}easeTo(t,o,h){this._start=this.getValue(o),this._end=t,this._startTime=o,this._endTime=o+h}}const Sl={"AttributionControl.ToggleAttribution":"Toggle attribution","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox homepage","Map.Title":"Map","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScrollZoomBlocker.CtrlMessage":"Use ctrl + scroll to zoom the map","ScrollZoomBlocker.CmdMessage":"Use  + scroll to zoom the map","TouchPanBlocker.Message":"Use two fingers to move the map"},Ra=["mouseenter","mouseover","mouseleave","mouseout"];class ka extends r.z{constructor(t,o,h,g){const{point:v,lngLat:S,originalEvent:I,target:L}=t;super(t.type,{point:v,lngLat:S,originalEvent:I,target:L}),this.preventDefault=()=>{t.preventDefault()},this.id=o,this.interaction=h,this.feature=g}}class _h{constructor(t){this.map=t,this.interactionsByType=new Map,this.typeById=new Map,this.filters=new Map,this.delegatedHandlers=new Map,this.handleType=this.handleType.bind(this)}add(t,o){if(this.typeById.has(t))throw new Error(`Interaction id "${t}" already exists.`);const{type:h,filter:g}=o;g&&this.filters.set(t,r.aZ(g));const v=this.interactionsByType.get(h)||new Map;if(v.size===0){if(Ra.includes(h)){const{mousemove:S,mouseout:I}=this._createDelegatedHandlers(t,o);this.map.on("mousemove",S),this.map.on("mouseout",I),this.delegatedHandlers.set(t,{mousemove:S,mouseout:I})}else this.map.on(h,this.handleType);this.interactionsByType.set(h,v)}v.set(t,o),this.typeById.set(t,h)}get(t){const o=this.typeById.get(t);if(!o)return;const h=this.interactionsByType.get(o);return h?h.get(t):void 0}remove(t){const o=this.typeById.get(t);if(!o)return;this.typeById.delete(t),this.filters.delete(t);const h=this.interactionsByType.get(o);if(h){if(h.delete(t),this.delegatedHandlers.has(t)){const{mousemove:g,mouseout:v}=this.delegatedHandlers.get(t);this.map.off("mousemove",g),this.map.off("mouseout",v),this.delegatedHandlers.delete(t)}h.size===0&&this.map.off(o,this.handleType)}}queryTargets(t,o){const h=[];for(const[g,v]of o)v.target&&h.push({targetId:g,target:v.target,filter:this.filters.get(g)});return this.map.style.queryRenderedTargets(t,h,this.map.transform)}handleType(t,o){const h=this.interactionsByType.get(t.type),g=Array.from(h).reverse();o=o||this.queryTargets(t.point,g);let v=!1;for(const S of o){for(const[I,L]of g){if(!L.target)continue;const D=S.variants?S.variants[I]:null;if(D){for(const B of D){const V=new r.cw(S,B);if(L.handler(new ka(t,I,L,V))!==!1){v=!0;break}}if(v)break}}if(v)break}if(!v)for(const[S,I]of g){const{handler:L,target:D}=I;if(!D&&L(new ka(t,S,I,null))!==!1)break}}_createDelegatedHandlers(t,o){switch(o.type){case"mouseenter":case"mouseover":{let h=!1,g=new Set;return{mousemove:v=>{const S=this.queryTargets(v.point,[[t,o]]),I=new Set;if(!S.length)return h=!1,void g.clear();const L=[];for(const D of S)g.has(D.id)||(I.add(D.id),L.push(D));h&&!L.length||(h=!0,g=I,v.type=o.type,this.handleType(v,L))},mouseout:()=>{h=!1,g.clear()}}}case"mouseleave":case"mouseout":{let h=[];return{mousemove:g=>{const v=this.queryTargets(g.point,[[t,o]]);if(!v.length)return g.type=o.type,this.handleType(g,h),void(h=v);const S=[],I=new Set(v.map(L=>L.id));for(const L of h)I.has(L.id)||S.push(L);S.length&&(g.type=o.type,this.handleType(g,S)),h=v},mouseout:g=>{h.length&&(g.type=o.type,this.handleType(g,h),h=[])}}}}}}function yh(u,t){if(Array.isArray(u)&&Array.isArray(t)){const o=new Set(u),h=new Set(t);return o.size===h.size&&u.every(g=>h.has(g))}return r.bn(u,t)}const rf={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:85,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,performanceMetricsCollection:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,antialias:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,minTileCacheSize:null,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",localFontFamily:null,transformRequest:null,accessToken:null,fadeDuration:300,respectPrefersReducedMotion:!0,crossSourceCollisions:!0,collectResourceTiming:!1,testMode:!1,precompilePrograms:!0,scaleFactor:1,spriteFormat:"auto"},Qr={showCompass:!0,showZoom:!0,visualizePitch:!1};class uu{constructor(t,o,h=!1){this._clickTolerance=10,this.element=o,this.mouseRotate=new Nf({clickTolerance:t.dragRotate._mouseRotate._clickTolerance}),this.map=t,h&&(this.mousePitch=new Kd({clickTolerance:t.dragRotate._mousePitch._clickTolerance})),r.aP(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),o.addEventListener("mousedown",this.mousedown),o.addEventListener("touchstart",this.touchstart,{passive:!1}),o.addEventListener("touchmove",this.touchmove),o.addEventListener("touchend",this.touchend),o.addEventListener("touchcancel",this.reset)}down(t,o){this.mouseRotate.mousedown(t,o),this.mousePitch&&this.mousePitch.mousedown(t,o),Ne()}move(t,o){const h=this.map,g=this.mouseRotate.mousemoveWindow(t,o),v=g&&g.bearingDelta;if(v&&h.setBearing(h.getBearing()+v),this.mousePitch){const S=this.mousePitch.mousemoveWindow(t,o),I=S&&S.pitchDelta;I&&h.setPitch(h.getPitch()+I)}}off(){const t=this.element;t.removeEventListener("mousedown",this.mousedown),t.removeEventListener("touchstart",this.touchstart,{passive:!1}),t.removeEventListener("touchmove",this.touchmove),t.removeEventListener("touchend",this.touchend),t.removeEventListener("touchcancel",this.reset),this.offTemp()}offTemp(){nt(),window.removeEventListener("mousemove",this.mousemove),window.removeEventListener("mouseup",this.mouseup)}mousedown(t){this.down(r.l({},t,{ctrlKey:!0,preventDefault:()=>t.preventDefault()}),rt(this.element,t)),window.addEventListener("mousemove",this.mousemove),window.addEventListener("mouseup",this.mouseup)}mousemove(t){this.move(t,rt(this.element,t))}mouseup(t){this.mouseRotate.mouseupWindow(t),this.mousePitch&&this.mousePitch.mouseupWindow(t),this.offTemp()}touchstart(t){t.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=at(this.element,t.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>t.preventDefault()},this._startPos))}touchmove(t){t.targetTouches.length!==1?this.reset():(this._lastPos=at(this.element,t.targetTouches)[0],this.move({preventDefault:()=>t.preventDefault()},this._lastPos))}touchend(t){t.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}function hd(u,t,o){if(u=new r.bO(u.lng,u.lat),t){const h=new r.bO(u.lng-360,u.lat),g=new r.bO(u.lng+360,u.lat),v=360*Math.ceil(Math.abs(u.lng-o.center.lng)/360),S=o.locationPoint(u).distSqr(t),I=t.x<0||t.y<0||t.x>o.width||t.y>o.height;o.locationPoint(h).distSqr(t)<S&&(I||Math.abs(h.lng-o.center.lng)<v)?u=h:o.locationPoint(g).distSqr(t)<S&&(I||Math.abs(g.lng-o.center.lng)<v)&&(u=g)}for(;Math.abs(u.lng-o.center.lng)>180;){const h=o.locationPoint(u);if(h.x>=0&&h.y>=0&&h.x<=o.width&&h.y<=o.height)break;u.lng>o.center.lng?u.lng-=360:u.lng+=360}return u}const Ws={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};class of extends r.E{constructor(t,o){if(super(),(t instanceof HTMLElement||o)&&(t=r.l({element:t},o)),r.aP(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress","_clearFadeTimer"],this),this._anchor=t&&t.anchor||"center",this._color=t&&t.color||"#3FB1CE",this._scale=t&&t.scale||1,this._draggable=t&&t.draggable||!1,this._clickTolerance=t&&t.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=t&&t.rotation||0,this._rotationAlignment=t&&t.rotationAlignment||"auto",this._pitchAlignment=t&&t.pitchAlignment&&t.pitchAlignment||"auto",this._updateMoving=()=>this._update(!0),this._occludedOpacity=t&&t.occludedOpacity||.2,t&&t.element)this._element=t.element,this._offset=r.P.convert(t&&t.offset||[0,0]);else{this._defaultMarker=!0,this._element=ge("div");const v=41,S=27,I=fe("svg",{display:"block",height:v*this._scale+"px",width:S*this._scale+"px",viewBox:`0 0 ${S} ${v}`},this._element),L=fe("radialGradient",{id:"shadowGradient"},fe("defs",{},I));fe("stop",{offset:"10%","stop-opacity":.4},L),fe("stop",{offset:"100%","stop-opacity":.05},L),fe("ellipse",{cx:13.5,cy:34.8,rx:10.5,ry:5.25,fill:"url(#shadowGradient)"},I),fe("path",{fill:this._color,d:"M27,13.5C27,19.07 20.25,27 14.75,34.5C14.02,35.5 12.98,35.5 12.25,34.5C6.75,27 0,19.22 0,13.5C0,6.04 6.04,0 13.5,0C20.96,0 27,6.04 27,13.5Z"},I),fe("path",{opacity:.25,d:"M13.5,0C6.04,0 0,6.04 0,13.5C0,19.22 6.75,27 12.25,34.5C13,35.52 14.02,35.5 14.75,34.5C20.25,27 27,19.07 27,13.5C27,6.04 20.96,0 13.5,0ZM13.5,1C20.42,1 26,6.58 26,13.5C26,15.9 24.5,19.18 22.22,22.74C19.95,26.3 16.71,30.14 13.94,33.91C13.74,34.18 13.61,34.32 13.5,34.44C13.39,34.32 13.26,34.18 13.06,33.91C10.28,30.13 7.41,26.31 5.02,22.77C2.62,19.23 1,15.95 1,13.5C1,6.58 6.58,1 13.5,1Z"},I),fe("circle",{fill:"white",cx:13.5,cy:13.5,r:5.5},I),this._offset=r.P.convert(t&&t.offset||[0,-14])}this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label","Map marker"),this._element.hasAttribute("role")||this._element.setAttribute("role","img"),this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",v=>{v.preventDefault()}),this._element.addEventListener("mousedown",v=>{v.preventDefault()});const h=this._element.classList;for(const v in Ws)h.remove(`mapboxgl-marker-anchor-${v}`);h.add(`mapboxgl-marker-anchor-${this._anchor}`);const g=t&&t.className?t.className.trim().split(/\s+/):[];h.add(...g),this._popup=null}addTo(t){return t===this._map||(this.remove(),this._map=t,t.getCanvasContainer().appendChild(this._element),t.on("move",this._updateMoving),t.on("moveend",this._update),t.on("remove",this._clearFadeTimer),t._addMarker(this),this.setDraggable(this._draggable),this._update(),t.on("click",this._onMapClick)),this}remove(){const t=this._map;return t&&(t.off("click",this._onMapClick),t.off("move",this._updateMoving),t.off("moveend",this._update),t.off("mousedown",this._addDragHandler),t.off("touchstart",this._addDragHandler),t.off("mouseup",this._onUp),t.off("touchend",this._onUp),t.off("mousemove",this._onMove),t.off("touchmove",this._onMove),t.off("remove",this._clearFadeTimer),t._removeMarker(this),this._map=void 0),this._clearFadeTimer(),this._element.remove(),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(t){return this._lngLat=r.bO.convert(t),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(!0),this}getElement(){return this._element}setPopup(t){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeAttribute("role"),this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),t){if(!("offset"in t.options)){const g=Math.sqrt(Math.pow(13.5,2)/2);t.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[g,-1*(38.1-13.5+g)],"bottom-right":[-g,-1*(38.1-13.5+g)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=t,t._marker=this,this._lngLat&&this._popup.setLngLat(this._lngLat),this._element.setAttribute("role","button"),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress),this._element.setAttribute("aria-expanded","false")}return this}_onKeyPress(t){const o=t.code,h=t.charCode||t.keyCode;o!=="Space"&&o!=="Enter"&&h!==32&&h!==13||this.togglePopup()}_onMapClick(t){const o=t.originalEvent.target,h=this._element;this._popup&&(o===h||h.contains(o))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){const t=this._popup;return t?(t.isOpen()?(t.remove(),this._element.setAttribute("aria-expanded","false")):this._map&&(t.addTo(this._map),this._element.setAttribute("aria-expanded","true")),this):this}_behindTerrain(){const t=this._map,o=this._pos;if(!t||!o)return!1;const h=t.unproject(o),g=t.getFreeCameraOptions();if(!g.position)return!1;const v=g.position.toLngLat();return v.distanceTo(h)<.9*v.distanceTo(this._lngLat)}_evaluateOpacity(){const t=this._map;if(!t)return;const o=this._pos;if(!o||o.x<0||o.x>t.transform.width||o.y<0||o.y>t.transform.height)return void this._clearFadeTimer();const h=t.unproject(o);let g;t._showingGlobe()&&r.dH(t.transform,this._lngLat)?g=0:(g=1-t._queryFogOpacity(h),t.transform._terrainEnabled()&&t.getTerrain()&&this._behindTerrain()&&(g*=this._occludedOpacity)),this._element.style.opacity=`${g}`,this._element.style.pointerEvents=g>0?"auto":"none",this._popup&&this._popup._setOpacity(g),this._fadeTimer=null}_clearFadeTimer(){this._fadeTimer&&(clearTimeout(this._fadeTimer),this._fadeTimer=null)}_updateDOM(){const t=this._pos;if(!t||!this._map)return;const o=this._offset.mult(this._scale);this._element.style.transform=`
            translate(${t.x}px,${t.y}px)
            ${Ws[this._anchor]}
            ${this._calculateXYTransform()} ${this._calculateZTransform()}
            translate(${o.x}px,${o.y}px)
        `}_calculateXYTransform(){const t=this._pos,o=this._map,h=this.getPitchAlignment();if(!o||!t||h!=="map")return"";if(!o._showingGlobe()){const L=o.getPitch();return L?`rotateX(${L}deg)`:""}const g=r.c4(r.dI(o.transform,this._lngLat)),v=t.sub(r.dJ(o.transform)),S=Math.abs(v.x)+Math.abs(v.y);if(S===0)return"";const I=g/S;return`rotateX(${-v.y*I}deg) rotateY(${v.x*I}deg)`}_calculateZTransform(){const t=this._pos,o=this._map;if(!o||!t)return"";let h=0;const g=this.getRotationAlignment();if(g==="map")if(o._showingGlobe()){const v=o.project(new r.bO(this._lngLat.lng,this._lngLat.lat+.001)),S=o.project(new r.bO(this._lngLat.lng,this._lngLat.lat-.001)).sub(v);h=r.c4(Math.atan2(S.y,S.x))-90}else h=-o.getBearing();else if(g==="horizon"){const v=r.ac(4,6,o.getZoom()),S=r.dJ(o.transform);S.y+=v*o.transform.height;const I=t.sub(S),L=r.c4(Math.atan2(I.y,I.x));h=(L>90?L-270:L+90)*(1-v)}return h+=this._rotation,h?`rotateZ(${h}deg)`:""}_update(t){cancelAnimationFrame(this._updateFrameId);const o=this._map;o&&(o.transform.renderWorldCopies&&(this._lngLat=hd(this._lngLat,this._pos,o.transform)),this._pos=o.project(this._lngLat),t===!0?this._updateFrameId=requestAnimationFrame(()=>{this._element&&this._pos&&this._anchor&&(this._pos=this._pos.round(),this._updateDOM())}):this._pos=this._pos.round(),o._requestDomTask(()=>{this._map&&(this._element&&this._pos&&this._anchor&&this._updateDOM(),(o._showingGlobe()||o.getTerrain()||o.getFog())&&!this._fadeTimer&&(this._fadeTimer=window.setTimeout(this._evaluateOpacity.bind(this),60)))}))}getOffset(){return this._offset}setOffset(t){return this._offset=r.P.convert(t),this._update(),this}addClassName(t){return this._element.classList.add(t),this}removeClassName(t){return this._element.classList.remove(t),this}toggleClassName(t){return this._element.classList.toggle(t)}_onMove(t){const o=this._map;if(!o)return;const h=this._pointerdownPos,g=this._positionDelta;if(h&&g){if(!this._isDragging){const v=this._clickTolerance||o._clickTolerance;if(t.point.dist(h)<v)return;this._isDragging=!0}this._pos=t.point.sub(g),this._lngLat=o.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new r.z("dragstart"))),this.fire(new r.z("drag"))}}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1;const t=this._map;t&&(t.off("mousemove",this._onMove),t.off("touchmove",this._onMove)),this._state==="active"&&this.fire(new r.z("dragend")),this._state="inactive"}_addDragHandler(t){const o=this._map,h=this._pos;o&&h&&this._element.contains(t.originalEvent.target)&&(t.preventDefault(),this._positionDelta=t.point.sub(h),this._pointerdownPos=t.point,this._state="pending",o.on("mousemove",this._onMove),o.on("touchmove",this._onMove),o.once("mouseup",this._onUp),o.once("touchend",this._onUp))}setDraggable(t){this._draggable=!!t;const o=this._map;return o&&(t?(o.on("mousedown",this._addDragHandler),o.on("touchstart",this._addDragHandler)):(o.off("mousedown",this._addDragHandler),o.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(t){return this._rotation=t||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(t){return this._rotationAlignment=t||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment==="auto"||this._rotationAlignment==="horizon"&&this._map&&!this._map._showingGlobe()?"viewport":this._rotationAlignment}setPitchAlignment(t){return this._pitchAlignment=t||"auto",this._update(),this}getPitchAlignment(){return this._pitchAlignment==="auto"?this.getRotationAlignment():this._pitchAlignment}setOccludedOpacity(t){return this._occludedOpacity=t||.2,this._update(),this}getOccludedOpacity(){return this._occludedOpacity}}const Bu={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0,showUserHeading:!1},ql={maxWidth:100,unit:"metric"},Ki={kilometer:"km",meter:"m",mile:"mi",foot:"ft","nautical-mile":"nm"},qa={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},jn=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function Nu(u=new r.P(0,0),t="bottom"){if(typeof u=="number"){const o=Math.round(Math.sqrt(.5*Math.pow(u,2)));switch(t){case"top":return new r.P(0,u);case"top-left":return new r.P(o,o);case"top-right":return new r.P(-o,o);case"bottom":return new r.P(0,-u);case"bottom-left":return new r.P(o,-o);case"bottom-right":return new r.P(-o,-o);case"left":return new r.P(u,0);case"right":return new r.P(-u,0)}return new r.P(0,0)}return u instanceof r.P||Array.isArray(u)?r.P.convert(u):r.P.convert(u[t]||[0,0])}return{version:H,supported:pe.supported,setRTLTextPlugin:r.dK,getRTLTextPluginStatus:r.dL,Map:class extends tf{constructor(u){K.mark(Z.create);const t=u;if((u=r.l({},rf,u)).minZoom!=null&&u.maxZoom!=null&&u.minZoom>u.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(u.minPitch!=null&&u.maxPitch!=null&&u.minPitch>u.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(u.minPitch!=null&&u.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(u.maxPitch!=null&&u.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(u.antialias&&r.dF(window)&&(u.antialias=!1,r.w("Antialiasing is disabled for this WebGL context to avoid browser bug: https://github.com/mapbox/mapbox-gl-js/issues/11609")),super(new jh(u.minZoom,u.maxZoom,u.minPitch,u.maxPitch,u.renderWorldCopies),u),this._repaint=!!u.repaint,this._interactive=u.interactive,this._minTileCacheSize=u.minTileCacheSize,this._maxTileCacheSize=u.maxTileCacheSize,this._failIfMajorPerformanceCaveat=u.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=u.preserveDrawingBuffer,this._antialias=u.antialias,this._trackResize=u.trackResize,this._bearingSnap=u.bearingSnap,this._refreshExpiredTiles=u.refreshExpiredTiles,this._fadeDuration=u.fadeDuration,this._isInitialLoad=!0,this._crossSourceCollisions=u.crossSourceCollisions,this._collectResourceTiming=u.collectResourceTiming,this._language=this._parseLanguage(u.language),this._worldview=u.worldview,this._renderTaskQueue=new Fu,this._domRenderTaskQueue=new Fu,this._controls=[],this._markers=[],this._popups=[],this._mapId=r.aV(),this._locale=r.l({},Sl,u.locale),this._clickTolerance=u.clickTolerance,this._cooperativeGestures=u.cooperativeGestures,this._performanceMetricsCollection=u.performanceMetricsCollection,this._tessellationStep=u.tessellationStep,this._containerWidth=0,this._containerHeight=0,this._showParseStatus=!0,this._precompilePrograms=u.precompilePrograms,this._scaleFactorChanged=!1,this._averageElevationLastSampledAt=-1/0,this._averageElevationExaggeration=0,this._averageElevation=new nf(0),this._interactionRange=[1/0,-1/0],this._visibilityHidden=0,this._useExplicitProjection=!1,this._frameId=0,this._scaleFactor=u.scaleFactor,this._requestManager=new Nt(u.transformRequest,u.accessToken,u.testMode),this._silenceAuthErrors=!!u.testMode,this._contextCreateOptions=u.contextCreateOptions?{...u.contextCreateOptions}:{},typeof u.container=="string"){const o=document.getElementById(u.container);if(!o)throw new Error(`Container '${u.container.toString()}' not found.`);this._container=o}else{if(!(u.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=u.container}if(this._container.childNodes.length>0&&r.w("The map container element should be empty, otherwise the map's interactivity will be negatively impacted. If you want to display a message when WebGL is not supported, use the Mapbox GL Supported plugin instead."),u.maxBounds&&this.setMaxBounds(u.maxBounds),this._spriteFormat=u.spriteFormat,r.aP(["_onWindowOnline","_onWindowResize","_onVisibilityChange","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._tp||(this._tp=new uh),this._tp.registerParameter(this,["Debug"],"showOverdrawInspector"),this._tp.registerParameter(this,["Debug"],"showTileBoundaries"),this._tp.registerParameter(this,["Debug"],"showParseStatus"),this._tp.registerParameter(this,["Debug"],"repaint"),this._tp.registerParameter(this,["Debug"],"showTileAABBs"),this._tp.registerParameter(this,["Debug"],"showPadding"),this._tp.registerParameter(this,["Debug"],"showCollisionBoxes",{noSave:!0}),this._tp.registerParameter(this.transform,["Debug"],"freezeTileCoverage",{noSave:!0},()=>{this._update()}),this._tp.registerParameter(this,["Debug","Wireframe"],"showTerrainWireframe"),this._tp.registerParameter(this,["Debug","Wireframe"],"showLayers2DWireframe"),this._tp.registerParameter(this,["Debug","Wireframe"],"showLayers3DWireframe"),this._tp.registerParameter(this,["Scaling"],"_scaleFactor",{min:.1,max:10,step:.1},()=>{this.setScaleFactor(this._scaleFactor)}),this._setupPainter(),this.painter===void 0)throw new Error("Failed to initialize WebGL.");if(this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),this._fullscreenchangeEvent="onfullscreenchange"in document?"fullscreenchange":"webkitfullscreenchange",window.addEventListener("online",this._onWindowOnline,!1),window.addEventListener("resize",this._onWindowResize,!1),window.addEventListener("orientationchange",this._onWindowResize,!1),window.addEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),window.addEventListener("visibilitychange",this._onVisibilityChange,!1),this.handlers=new $f(this,u),this._localFontFamily=u.localFontFamily,this._localIdeographFontFamily=u.localIdeographFontFamily,(u.style||!u.testMode)&&this.setStyle(u.style||r.e.DEFAULT_STYLE,{config:u.config,localFontFamily:this._localFontFamily,localIdeographFontFamily:this._localIdeographFontFamily}),u.projection&&this.setProjection(u.projection),this.indoor=new Af(this),u.hash&&(this._hash=new id(typeof u.hash=="string"&&u.hash||void 0).addTo(this)),!this._hash||!this._hash._onHashChange()){t.center==null&&t.zoom==null||(this.transform._unmodified=!1),this.jumpTo({center:u.center,zoom:u.zoom,bearing:u.bearing,pitch:u.pitch});const o=u.bounds;o&&(this.resize(),this.fitBounds(o,r.l({},u.fitBoundsOptions,{duration:0})))}this.resize(),u.attributionControl&&this.addControl(new ud({customAttribution:u.customAttribution})),this._logoControl=new vm,this.addControl(this._logoControl,u.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet),this._postStyleLoadEvent()}),this.on("data",o=>{this._update(o.dataType==="style"),this.fire(new r.z(`${o.dataType}data`,o))}),this.on("dataloading",o=>{this.fire(new r.z(`${o.dataType}dataloading`,o))}),this._interactions=new _h(this)}_getMapId(){return this._mapId}addControl(u,t){if(t===void 0&&(t=u.getDefaultPosition?u.getDefaultPosition():"top-right"),!u||!u.onAdd)return this.fire(new r.y(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const o=u.onAdd(this);this._controls.push(u);const h=this._controlPositions[t];return t.indexOf("bottom")!==-1?h.insertBefore(o,h.firstChild):h.appendChild(o),this}removeControl(u){if(!u||!u.onRemove)return this.fire(new r.y(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const t=this._controls.indexOf(u);return t>-1&&this._controls.splice(t,1),u.onRemove(this),this}hasControl(u){return this._controls.indexOf(u)>-1}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}resize(u){if(this._updateContainerDimensions(),this._containerWidth===this.transform.width&&this._containerHeight===this.transform.height)return this;this._resizeCanvas(this._containerWidth,this._containerHeight),this.transform.resize(this._containerWidth,this._containerHeight),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight));const t=!this._moving;return t&&this.fire(new r.z("movestart",u)).fire(new r.z("move",u)),this.fire(new r.z("resize",u)),t&&this.fire(new r.z("moveend",u)),this}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()||null}setMaxBounds(u){return this.transform.setMaxBounds(r.az.convert(u)),this._update()}setMinZoom(u){if((u=u??-2)>=-2&&u<=this.transform.maxZoom)return this.transform.minZoom=u,this._update(),this.getZoom()<u?this.setZoom(u):this.fire(new r.z("zoomstart")).fire(new r.z("zoom")).fire(new r.z("zoomend")),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(u){if((u=u??22)>=this.transform.minZoom)return this.transform.maxZoom=u,this._update(),this.getZoom()>u?this.setZoom(u):this.fire(new r.z("zoomstart")).fire(new r.z("zoom")).fire(new r.z("zoomend")),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(u){if((u=u??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(u>=0&&u<=this.transform.maxPitch)return this.transform.minPitch=u,this._update(),this.getPitch()<u?this.setPitch(u):this.fire(new r.z("pitchstart")).fire(new r.z("pitch")).fire(new r.z("pitchend")),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(u){if((u=u??85)>85)throw new Error("maxPitch must be less than or equal to 85");if(u>=this.transform.minPitch)return this.transform.maxPitch=u,this._update(),this.getPitch()>u?this.setPitch(u):this.fire(new r.z("pitchstart")).fire(new r.z("pitch")).fire(new r.z("pitchend")),this;throw new Error("maxPitch must be greater than or equal to minPitch")}getMaxPitch(){return this.transform.maxPitch}getScaleFactor(){return this._scaleFactor}setScaleFactor(u){return this._scaleFactor=u,this.painter.scaleFactor=u,this._tp.refreshUI(),this._scaleFactorChanged=!0,this.style._updateFilteredLayers(t=>t.type==="symbol"),this._update(!0),this}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(u){return this.transform.renderWorldCopies=u,this.transform.renderWorldCopies||this._forceMarkerAndPopupUpdate(!0),this._update()}getLanguage(){return this._language}_parseLanguage(u){return u==="auto"?navigator.language:Array.isArray(u)?u.length===0?void 0:u.map(t=>t==="auto"?navigator.language:t):u}setLanguage(u){const t=this._parseLanguage(u);if(!this.style||t===this._language)return this;this._language=t,this.style.reloadSources();for(const o of this._controls)o._setLanguage&&o._setLanguage(this._language);return this}getWorldview(){return this._worldview}setWorldview(u){return this.style&&u!==this._worldview?(this._worldview=u,this.style.reloadSources(),this):this}getProjection(){return this.transform.mercatorFromTransition?{name:"globe",center:[0,0]}:this.transform.getProjection()}_showingGlobe(){return this.transform.projection.name==="globe"}setProjection(u){return this._lazyInitEmptyStyle(),u?typeof u=="string"&&(u={name:u}):u=null,this._useExplicitProjection=!!u,this._prioritizeAndUpdateProjection(u,this.style.projection)}_updateProjectionTransition(){if(this.getProjection().name!=="globe")return;const u=this.transform,t=u.projection.name;let o;t==="globe"&&u.zoom>=r.bY?(u.setMercatorFromTransition(),o=!0):t==="mercator"&&u.zoom<r.bY&&(u.setProjection({name:"globe"}),o=!0),o&&(this.style.applyProjectionUpdate(),this.style._forceSymbolLayerUpdate())}_prioritizeAndUpdateProjection(u,t){return this._updateProjection(u||t||{name:"mercator"})}_updateProjection(u){let t;return t=u.name==="globe"&&this.transform.zoom>=r.bY?this.transform.setMercatorFromTransition():this.transform.setProjection(u),this.style.applyProjectionUpdate(),t&&(this.painter.clearBackgroundTiles(),this.style.clearSources(),this._update(!0),this._forceMarkerAndPopupUpdate(!0)),this}project(u){return this.transform.locationPoint3D(r.bO.convert(u))}unproject(u){return this.transform.pointLocation3D(r.P.convert(u))}isMoving(){return this._moving||this.handlers&&this.handlers.isMoving()||!1}isZooming(){return this._zooming||this.handlers&&this.handlers.isZooming()||!1}isRotating(){return this._rotating||this.handlers&&this.handlers.isRotating()||!1}_isDragging(){return this.handlers&&this.handlers._isDragging()||!1}_createDelegatedListener(u,t,o){const h=g=>{let v=[];if(Array.isArray(t)){const S=t.filter(I=>this.getLayer(I));v=S.length?this.queryRenderedFeatures(g,{layers:S}):[]}else v=this.queryRenderedFeatures(g,{target:t});return v};if(u==="mouseenter"||u==="mouseover"){let g=!1;return{listener:o,targets:t,delegates:{mousemove:S=>{const I=h(S.point);I.length?g||(g=!0,o.call(this,new Pa(u,this,S.originalEvent,{features:I}))):g=!1},mouseout:()=>{g=!1}}}}if(u==="mouseleave"||u==="mouseout"){let g=!1;return{listener:o,targets:t,delegates:{mousemove:I=>{h(I.point).length?g=!0:g&&(g=!1,o.call(this,new Pa(u,this,I.originalEvent)))},mouseout:I=>{g&&(g=!1,o.call(this,new Pa(u,this,I.originalEvent)))}}}}{const g=v=>{const S=h(v.point);S.length&&(v.features=S,o.call(this,v),delete v.features)};return{listener:o,targets:t,delegates:{[u]:g}}}}on(u,t,o){if(typeof t=="function"||o===void 0)return super.on(u,t);if(typeof t=="string"&&(t=[t]),!this._areTargetsValid(t))return this;const h=this._createDelegatedListener(u,t,o);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[u]=this._delegatedListeners[u]||[],this._delegatedListeners[u].push(h);for(const g in h.delegates)this.on(g,h.delegates[g]);return this}once(u,t,o){if(typeof t=="function"||o===void 0)return super.once(u,t);if(typeof t=="string"&&(t=[t]),!this._areTargetsValid(t))return this;const h=this._createDelegatedListener(u,t,o);for(const g in h.delegates)this.once(g,h.delegates[g]);return this}off(u,t,o){if(typeof t=="function"||o===void 0)return super.off(u,t);if(typeof t=="string"&&(t=[t]),!this._areTargetsValid(t))return this;const h=this._delegatedListeners?this._delegatedListeners[u]:void 0;return h&&(g=>{for(let v=0;v<g.length;v++){const S=g[v];if(S.listener===o&&yh(S.targets,t)){for(const I in S.delegates)this.off(I,S.delegates[I]);return g.splice(v,1),this}}})(h),this}queryRenderedFeatures(u,t){if(!this.style)return[];if(u===void 0||u instanceof r.P||Array.isArray(u)||t!==void 0||(t=u,u=void 0),u=u||[[0,0],[this.transform.width,this.transform.height]],!t){const v=this.style.queryRenderedFeatures(u,void 0,this.transform),S=this.style.queryRenderedFeatureset(u,void 0,this.transform);return v.concat(S)}let o=!0;if(t.target&&(o=this._isTargetValid(t.target),o&&!t.layers))return this.style.queryRenderedFeatureset(u,t,this.transform);let h=!0;if(t.layers&&Array.isArray(t.layers)){for(const v of t.layers)if(!this._isValidId(v)){h=!1;break}if(h&&!t.target)return this.style.queryRenderedFeatures(u,t,this.transform)}let g=[];return h&&(g=g.concat(this.style.queryRenderedFeatures(u,t,this.transform))),o&&(g=g.concat(this.style.queryRenderedFeatureset(u,t,this.transform))),g}querySourceFeatures(u,t){return!u||typeof u=="string"&&!this._isValidId(u)?[]:this.style.querySourceFeatures(u,t)}isPointOnSurface(u){const{name:t}=this.transform.projection;return t!=="globe"&&t!=="mercator"&&r.w(`${t} projection does not support isPointOnSurface, this API may behave unexpectedly.`),this.transform.isPointOnSurface(r.P.convert(u))}addInteraction(u,t){return this._interactions.add(u,t),this}removeInteraction(u){return this._interactions.remove(u),this}setStyle(u,t){return t=r.l({},{localIdeographFontFamily:this._localIdeographFontFamily,localFontFamily:this._localFontFamily},t),this.style&&u&&t.diff!==!1&&t.localFontFamily===this._localFontFamily&&t.localIdeographFontFamily===this._localIdeographFontFamily&&!t.config?(this.style._diffStyle(u,(o,h)=>{o?(r.w(`Unable to perform style diff: ${String(o.message||o.error||o)}. Rebuilding the style from scratch.`),this._updateStyle(u,t)):h&&this._update(!0)},()=>{this._postStyleLoadEvent()}),this):(this._localIdeographFontFamily=t.localIdeographFontFamily,this._localFontFamily=t.localFontFamily,this._updateStyle(u,t))}_getUIString(u){const t=this._locale[u];if(t==null)throw new Error(`Missing UI string '${u}'`);return t}_updateStyle(u,t){if(this.style&&(this.style.setEventedParent(null),this.style._remove(),this.style=void 0),u){const o=r.l({},t);t&&t.config&&(o.initialConfig=t.config,delete o.config),this.style=new Va(this,o).load(u),this.style.setEventedParent(this,{style:this.style})}return this._updateTerrain(),this}_lazyInitEmptyStyle(){this.style||(this.style=new Va(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():(r.w("There is no style added to the map."),!1)}_isValidId(u){return u==null?(this.fire(new r.y(new Error("IDs can't be empty."))),!1):!r.cr(u)||(this.fire(new r.y(new Error(`IDs can't contain special symbols: "${u}".`))),!1)}_isTargetValid(u){return"featuresetId"in u?this._isValidId("importId"in u?u.importId:u.featuresetId):"layerId"in u&&this._isValidId(u.layerId)}_areTargetsValid(u){if(Array.isArray(u)){for(const t of u)if(!this._isValidId(t))return!1;return!0}return this._isTargetValid(u)}addSource(u,t){return this._isValidId(u)?(this._lazyInitEmptyStyle(),this.style.addSource(u,t),this._update(!0)):this}isSourceLoaded(u){return!!this._isValidId(u)&&!!this.style&&this.style._isSourceCacheLoaded(u)}areTilesLoaded(){return this.style.areTilesLoaded()}addSourceType(u,t,o){this._lazyInitEmptyStyle(),this.style.addSourceType(u,t,o)}removeSource(u){return this._isValidId(u)?(this.style.removeSource(u),this._updateTerrain(),this._update(!0)):this}getSource(u){return this._isValidId(u)?this.style.getOwnSource(u):null}addImage(u,t,{pixelRatio:o=1,sdf:h=!1,stretchX:g,stretchY:v,content:S}={}){if(this._lazyInitEmptyStyle(),t instanceof HTMLImageElement||ImageBitmap&&t instanceof ImageBitmap){const{width:I,height:L,data:D}=r.q.getImageData(t);this.style.addImage(u,{data:new r.r({width:I,height:L},D),pixelRatio:o,stretchX:g,stretchY:v,content:S,sdf:h,version:0,usvg:!1})}else if(t.width===void 0||t.height===void 0)this.fire(new r.y(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));else{const{width:I,height:L}=t,D=t;this.style.addImage(u,{data:new r.r({width:I,height:L},new Uint8Array(D.data)),pixelRatio:o,stretchX:g,stretchY:v,content:S,sdf:h,usvg:!1,version:0,userImage:D}),D.onAdd&&D.onAdd(this,u)}}updateImage(u,t){this._lazyInitEmptyStyle();const o=this.style.getImage(u);if(!o)return void this.fire(new r.y(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const h=t instanceof HTMLImageElement||ImageBitmap&&t instanceof ImageBitmap?r.q.getImageData(t):t,{width:g,height:v,data:S}=h;if(g===void 0||v===void 0)return void this.fire(new r.y(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(g!==(o.usvg?o.icon.usvg_tree.width:o.data.width)||v!==(o.usvg?o.icon.usvg_tree.height:o.data.height))return void this.fire(new r.y(new Error(`The width and height of the updated image (${g}, ${v})
                must be that same as the previous version of the image
                (${o.data.width}, ${o.data.height})`)));const I=!(t instanceof HTMLImageElement||ImageBitmap&&t instanceof ImageBitmap);let L=!1;o.usvg?(o.data=new r.r({width:g,height:v},new Uint8Array(S)),o.usvg=!1,o.icon=void 0,L=!0):o.data.replace(S,I),this.style.updateImage(u,o,L)}hasImage(u){return u?!!this.style&&!!this.style.getImage(u):(this.fire(new r.y(new Error("Missing required image id"))),!1)}removeImage(u){this.style.removeImage(u)}loadImage(u,t){r.o(this._requestManager.transformRequest(u,r.R.Image),(o,h)=>{t(o,h instanceof HTMLImageElement?r.q.getImageData(h):h)})}listImages(){return this.style.listImages()}addModel(u,t){this._lazyInitEmptyStyle(),this.style.addModel(u,t)}hasModel(u){return u?this.style.hasModel(u):(this.fire(new r.y(new Error("Missing required model id"))),!1)}removeModel(u){this.style.removeModel(u)}listModels(){return this.style.listModels()}addLayer(u,t){return this._isValidId(u.id)?(this._lazyInitEmptyStyle(),this.style.addLayer(u,t),this._update(!0)):this}getSlot(u){const t=this.getLayer(u);return t&&t.slot||null}setSlot(u,t){return this.style.setSlot(u,t),this.style.mergeLayers(),this._update(!0)}addImport(u,t){return this.style.addImport(u,t),this}updateImport(u,t){return typeof t!="string"&&t.id!==u?(this.removeImport(u),this.addImport(t)):(this.style.updateImport(u,t),this._update(!0))}removeImport(u){return this.style.removeImport(u),this}moveImport(u,t){return this.style.moveImport(u,t),this._update(!0)}moveLayer(u,t){return this._isValidId(u)?(this.style.moveLayer(u,t),this._update(!0)):this}removeLayer(u){return this._isValidId(u)?(this.style.removeLayer(u),this._update(!0)):this}getLayer(u){if(!this._isValidId(u))return null;const t=this.style.getOwnLayer(u);return t?t.type==="custom"?t.implementation:t.serialize():void 0}getSlots(){return this.style.getSlots()}setLayerZoomRange(u,t,o){return this._isValidId(u)?(this.style.setLayerZoomRange(u,t,o),this._update(!0)):this}setFilter(u,t,o={}){return this._isValidId(u)?(this.style.setFilter(u,t,o),this._update(!0)):this}getFilter(u){return this._isValidId(u)?this.style.getFilter(u):null}setPaintProperty(u,t,o,h={}){return this._isValidId(u)?(this.style.setPaintProperty(u,t,o,h),this._update(!0)):this}getPaintProperty(u,t){return this._isValidId(u)?this.style.getPaintProperty(u,t):null}setLayoutProperty(u,t,o,h={}){return this._isValidId(u)?(this.style.setLayoutProperty(u,t,o,h),this._update(!0)):this}getLayoutProperty(u,t){return this._isValidId(u)?this.style.getLayoutProperty(u,t):null}getSchema(u){return this.style.getSchema(u)}setSchema(u,t){return this.style.setSchema(u,t),this._update(!0)}getConfig(u){return this.style.getConfig(u)}setConfig(u,t){return this.style.setConfig(u,t),this._update(!0)}getConfigProperty(u,t){return this.style.getConfigProperty(u,t)}setConfigProperty(u,t,o){return this.style.setConfigProperty(u,t,o),this._update(!0)}getFeaturesetDescriptors(u){return this.style.getFeaturesetDescriptors(u)}setLights(u){if(this._lazyInitEmptyStyle(),u&&u.length===1&&u[0].type==="flat"){const t=u[0];t.properties?this.style.setFlatLight(t.properties,t.id,{}):this.style.setFlatLight({},"flat")}else this.style.setLights(u),this.painter.terrain&&(this.painter.terrain.invalidateRenderCache=!0);return this._update(!0)}getLights(){const u=this.style.getLights()||[];return u.length===0&&u.push({id:this.style.light.id,type:"flat",properties:this.style.getFlatLight()}),u}setLight(u,t={}){return console.log("The `map.setLight` function is deprecated, prefer using `map.setLights` with `flat` light type instead."),this.setLights([{id:"flat",type:"flat",properties:u}])}getLight(){return console.log("The `map.getLight` function is deprecated, prefer using `map.getLights` instead."),this.style.getFlatLight()}setTerrain(u){return this._lazyInitEmptyStyle(),!u&&this.transform.projection.requiresDraping?this.style.setTerrainForDraping():this.style.setTerrain(u),this._averageElevationLastSampledAt=-1/0,this._update(!0)}getTerrain(){return this.style?this.style.getTerrain():null}setFog(u){return this._lazyInitEmptyStyle(),this.style.setFog(u),this._update(!0)}getFog(){return this.style?this.style.getFog():null}setSnow(u){return this._lazyInitEmptyStyle(),this.style.setSnow(u),this._update(!0)}getSnow(){return this.style?this.style.getSnow():null}setRain(u){return this._lazyInitEmptyStyle(),this.style.setRain(u),this._update(!0)}getRain(){return this.style?this.style.getRain():null}setColorTheme(u){return this._lazyInitEmptyStyle(),this.style.setColorTheme(u),this._update(!0)}setImportColorTheme(u,t){return this._lazyInitEmptyStyle(),this.style.setImportColorTheme(u,t),this._update(!0)}setCamera(u){return this.style.setCamera(u),this._triggerCameraUpdate(u)}_triggerCameraUpdate(u){return this._update(this.transform.setOrthographicProjectionAtLowPitch(u["camera-projection"]==="orthographic"))}getCamera(){return this.style.camera}_queryFogOpacity(u){return this.style&&this.style.fog?this.style.fog.getOpacityAtLatLng(r.bO.convert(u),this.transform):0}setFeatureState(u,t){return u.source&&!this._isValidId(u.source)?this:(this.style.setFeatureState(u,t),this._update())}removeFeatureState(u,t){return u.source&&!this._isValidId(u.source)?this:(this.style.removeFeatureState(u,t),this._update())}getFeatureState(u){return u.source&&!this._isValidId(u.source)?null:this.style.getFeatureState(u)}_updateContainerDimensions(){if(!this._container)return;const u=this._container.getBoundingClientRect().width||400,t=this._container.getBoundingClientRect().height||300;let o,h,g,v=this._container;for(;v&&(!h||!g);){const S=window.getComputedStyle(v).transform;S&&S!=="none"&&(o=S.match(/matrix.*\((.+)\)/)[1].split(", "),o[0]&&o[0]!=="0"&&o[0]!=="1"&&(h=o[0]),o[3]&&o[3]!=="0"&&o[3]!=="1"&&(g=o[3])),v=v.parentElement}this._containerWidth=h?Math.abs(u/h):u,this._containerHeight=g?Math.abs(t/g):t}_detectMissingCSS(){window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")!=="rgb(250, 128, 114)"&&r.w("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")}_setupContainer(){const u=this._container;u.classList.add("mapboxgl-map"),(this._missingCSSCanary=ge("div","mapboxgl-canary",u)).style.visibility="hidden",this._detectMissingCSS();const t=this._canvasContainer=ge("div","mapboxgl-canvas-container",u);this._canvas=ge("canvas","mapboxgl-canvas",t),this._interactive&&(t.classList.add("mapboxgl-interactive"),this._canvas.setAttribute("tabindex","0")),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region"),this._updateContainerDimensions(),this._resizeCanvas(this._containerWidth,this._containerHeight);const o=this._controlContainer=ge("div","mapboxgl-control-container",u),h=this._controlPositions={};["top-left","top","top-right","right","bottom-right","bottom","bottom-left","left"].forEach(g=>{h[g]=ge("div",`mapboxgl-ctrl-${g}`,o)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(u,t){const o=r.q.devicePixelRatio||1;this._canvas.width=o*Math.ceil(u),this._canvas.height=o*Math.ceil(t),this._canvas.style.width=`${u}px`,this._canvas.style.height=`${t}px`}_addMarker(u){this._markers.push(u)}_removeMarker(u){const t=this._markers.indexOf(u);t!==-1&&this._markers.splice(t,1)}_addPopup(u){this._popups.push(u)}_removePopup(u){const t=this._popups.indexOf(u);t!==-1&&this._popups.splice(t,1)}_setupPainter(){const u=r.l({},pe.supported.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),t=this._canvas.getContext("webgl2",u);t?(Nr(t,!0),this.painter=new rd(t,this._contextCreateOptions,this.transform,this._scaleFactor,this._tp),this.on("data",o=>{o.dataType==="source"&&this.painter.setTileLoadedFlag(!0)}),r.m.testSupport(t)):this.fire(new r.y(new Error("Failed to initialize WebGL")))}_contextLost(u){u.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new r.z("webglcontextlost",{originalEvent:u}))}_contextRestored(u){this._setupPainter(),this.resize(),this._update(),this.fire(new r.z("webglcontextrestored",{originalEvent:u}))}_onMapScroll(u){if(u.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}idle(){return!this.isMoving()&&this.loaded()}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}frameReady(){return this.loaded()&&!this._placementDirty}_update(u){return this.style?(this._styleDirty=this._styleDirty||u,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(u){return this._update(),this._renderTaskQueue.add(u)}_cancelRenderFrame(u){this._renderTaskQueue.remove(u)}_requestDomTask(u){!this.loaded()||this.loaded()&&!this.isMoving()?u():this._domRenderTaskQueue.add(u)}_render(u){let t;this.fire(new r.z("renderstart")),++this._frameId;const o=this.painter.context.extTimerQuery,h=r.q.now(),g=this.painter.context.gl;if(this.listens("gpu-timing-frame")&&(t=g.createQuery(),g.beginQuery(o.TIME_ELAPSED_EXT,t)),this.painter.context.setDirty(),this.painter.setBaseState(),(this.isMoving()||this.isRotating()||this.isZooming())&&(this._interactionRange[0]=Math.min(this._interactionRange[0],performance.now()),this._interactionRange[1]=Math.max(this._interactionRange[1],performance.now())),this._renderTaskQueue.run(u),this._domRenderTaskQueue.run(u),this._removed)return;this._updateProjectionTransition();const v=this._isInitialLoad?0:this._fadeDuration;if(this.style&&this._styleDirty){this._styleDirty=!1;const D=this.transform.zoom,B=this.transform.pitch,V=r.q.now(),U=new r.a8(D,{now:V,fadeDuration:v,pitch:B,transition:this.style.transition});this.style.update(U)}this.style&&this.style.hasFogTransition()&&(this.style._markersNeedUpdate=!0,this._sourcesDirty=!0);let S=!1;this.style&&this._sourcesDirty?(this._sourcesDirty=!1,this.painter._updateFog(this.style),this._updateTerrain(),S=this._updateAverageElevation(h),this.style.updateSources(this.transform),this._forceMarkerAndPopupUpdate()):S=this._updateAverageElevation(h);const I=this.style&&this.style._updatePlacement(this.painter,this.painter.transform,this.showCollisionBoxes,v,this._crossSourceCollisions,this.painter.replacementSource,this._scaleFactorChanged);if(this._scaleFactorChanged&&(this._scaleFactorChanged=!1),I&&(this._placementDirty=I.needsRerender),this.style&&this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showParseStatus:this.showParseStatus,wireframe:{terrain:this.showTerrainWireframe,layers2D:this.showLayers2DWireframe,layers3D:this.showLayers3DWireframe},showOverdrawInspector:this._showOverdrawInspector,showQueryGeometry:!!this._showQueryGeometry,showTileAABBs:this.showTileAABBs,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:v,isInitialLoad:this._isInitialLoad,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer"),gpuTimingDeferredRender:!!this.listens("gpu-timing-deferred-render"),speedIndexTiming:this.speedIndexTiming}),this.fire(new r.z("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,K.mark(Z.load),this.fire(new r.z("load"))),this.style&&this.style.hasTransitions()&&(this._styleDirty=!0),this.style&&(this.style.snow||this.style.rain)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),t){const D=r.q.now()-h;g.endQuery(o.TIME_ELAPSED_EXT),setTimeout(()=>{const B=g.getQueryParameter(t,g.QUERY_RESULT)/1e6;g.deleteQuery(t),this.fire(new r.z("gpu-timing-frame",{cpuTime:D,gpuTime:B}))},50)}if(this.listens("gpu-timing-layer")){const D=this.painter.collectGpuTimers();setTimeout(()=>{const B=this.painter.queryGpuTimers(D);this.fire(new r.z("gpu-timing-layer",{layerTimes:B}))},50)}if(this.listens("gpu-timing-deferred-render")){const D=this.painter.collectDeferredRenderGpuQueries();setTimeout(()=>{const B=this.painter.queryGpuTimeDeferredRender(D);this.fire(new r.z("gpu-timing-deferred-render",{gpuTime:B}))},50)}const L=this._sourcesDirty||this._styleDirty||this._placementDirty||S;if(L||this._repaint)this.triggerRepaint();else{const D=this.idle();if(D&&(S=this._updateAverageElevation(h,!0)),S)this.triggerRepaint();else if(this._triggerFrame(!1),D&&(this.fire(new r.z("idle")),this._isInitialLoad=!1,this.speedIndexTiming)){const B=this._calculateSpeedIndex();this.fire(new r.z("speedindexcompleted",{speedIndex:B})),this.speedIndexTiming=!1}}!this._loaded||this._fullyLoaded||L||(this._fullyLoaded=!0,K.mark(Z.fullLoad),this._performanceMetricsCollection&&Ut(this._requestManager._customAccessToken,{width:this.painter.width,height:this.painter.height,interactionRange:this._interactionRange,visibilityHidden:this._visibilityHidden,terrainEnabled:!!this.painter.style.getTerrain(),fogEnabled:!!this.painter.style.getFog(),projection:this.getProjection().name,zoom:this.transform.zoom,renderer:this.painter.context.renderer,vendor:this.painter.context.vendor}),this._authenticate())}_forceMarkerAndPopupUpdate(u){for(const t of this._markers)u&&!this.getRenderWorldCopies()&&(t._lngLat=t._lngLat.wrap()),t._update();for(const t of this._popups)!u||this.getRenderWorldCopies()||t._trackPointer||(t._lngLat=t._lngLat.wrap()),t._update()}_updateAverageElevation(u,t=!1){const o=g=>(this.transform.averageElevation=g,this._update(!1),!0);if(!this.painter.averageElevationNeedsEasing())return this.transform.averageElevation!==0&&o(0);const h=this.transform.elevation&&this.transform.elevation.exaggeration()!==this._averageElevationExaggeration;if(h||(t||u-this._averageElevationLastSampledAt>500)&&!this._averageElevation.isEasing(u)){const g=this.transform.averageElevation;let v=this.transform.sampleAverageElevation();this.transform.elevation!=null&&(this._averageElevationExaggeration=this.transform.elevation.exaggeration()),isNaN(v)?v=0:this._averageElevationLastSampledAt=u;const S=Math.abs(g-v);if(S>1){if(this._isInitialLoad||h)return this._averageElevation.jumpTo(v),o(v);this._averageElevation.easeTo(v,u,300)}else if(S>1e-4)return this._averageElevation.jumpTo(v),o(v)}return!!this._averageElevation.isEasing(u)&&o(this._averageElevation.getValue(u))}_authenticate(){Re(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,u=>{if(u&&(u.message===Rt||u.status===401)){const t=this.painter.context.gl;Nr(t,!1),this._logoControl instanceof vm&&this._logoControl._updateLogo(),t&&t.clear(t.DEPTH_BUFFER_BIT|t.COLOR_BUFFER_BIT|t.STENCIL_BUFFER_BIT),this._silenceAuthErrors||this.fire(new r.y(new Error("A valid Mapbox access token is required to use Mapbox GL JS. To create an account or a new access token, visit https://account.mapbox.com/")))}}),Ot(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,()=>{})}_postStyleLoadEvent(){this.style.globalId&&hn(this._requestManager._customAccessToken,{map:this,skuToken:this._requestManager._skuToken,style:this.style.globalId,importedStyles:this.style.getImportGlobalIds()})}_updateTerrain(){const u=this._isDragging();this.painter.updateTerrain(this.style,u)}_calculateSpeedIndex(){const u=this.painter.canvasCopy(),t=this.painter.getCanvasCopiesAndTimestamps();t.timeStamps.push(performance.now());const o=this.painter.context.gl,h=o.createFramebuffer();function g(v){o.framebufferTexture2D(o.FRAMEBUFFER,o.COLOR_ATTACHMENT0,o.TEXTURE_2D,v,0);const S=new Uint8Array(o.drawingBufferWidth*o.drawingBufferHeight*4);return o.readPixels(0,0,o.drawingBufferWidth,o.drawingBufferHeight,o.RGBA,o.UNSIGNED_BYTE,S),S}return o.bindFramebuffer(o.FRAMEBUFFER,h),this._canvasPixelComparison(g(u),t.canvasCopies.map(g),t.timeStamps)}_canvasPixelComparison(u,t,o){let h=o[1]-o[0];const g=u.length/4;for(let v=0;v<t.length;v++){const S=t[v];let I=0;for(let L=0;L<S.length;L+=4)S[L]===u[L]&&S[L+1]===u[L+1]&&S[L+2]===u[L+2]&&S[L+3]===u[L+3]&&(I+=1);h+=(o[v+2]-o[v+1])*(1-I/g)}return h}remove(){this._hash&&this._hash.remove();for(const t of this._controls)t.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this._domRenderTaskQueue.clear(),this.style&&this.style.destroy(),this.indoor.destroy(),this.painter.destroy(),this.handlers&&this.handlers.destroy(),this.handlers=void 0,this.setStyle(null),window.removeEventListener("resize",this._onWindowResize,!1),window.removeEventListener("orientationchange",this._onWindowResize,!1),window.removeEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),window.removeEventListener("online",this._onWindowOnline,!1),window.removeEventListener("visibilitychange",this._onVisibilityChange,!1);const u=this.painter.context.gl.getExtension("WEBGL_lose_context");u&&u.loseContext(),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvasContainer.remove(),this._controlContainer.remove(),this._missingCSSCanary.remove(),this._canvas=void 0,this._canvasContainer=void 0,this._controlContainer=void 0,this._missingCSSCanary=void 0,this._container.classList.remove("mapboxgl-map"),this._container.removeEventListener("scroll",this._onMapScroll,!1),Hr.delete(this.painter.context.gl),bn.remove(),Mt.remove(),this._removed=!0,this.fire(new r.z("remove"))}triggerRepaint(){this._triggerFrame(!0)}_triggerFrame(u){this._renderNextFrame=this._renderNextFrame||u,this.style&&!this._frame&&(this._frame=r.q.frame(t=>{const o=!!this._renderNextFrame;this._frame=null,this._renderNextFrame=null,o&&this._render(t)}))}_preloadTiles(u){const t=this.style?this.style.getSourceCaches():[];return r.bl(t,(o,h)=>o._preloadTiles(u,h),()=>{this.triggerRepaint()}),this}_onWindowOnline(){this._update()}_onWindowResize(u){this._trackResize&&this.resize({originalEvent:u})._update()}_onVisibilityChange(){document.visibilityState==="hidden"&&this._visibilityHidden++}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(u){this._showTileBoundaries!==u&&(this._showTileBoundaries=u,this._tp.refreshUI(),this._update())}get showParseStatus(){return!!this._showParseStatus}set showParseStatus(u){this._showParseStatus!==u&&(this._showParseStatus=u,this._tp.refreshUI(),this._update())}get showTerrainWireframe(){return!!this._showTerrainWireframe}set showTerrainWireframe(u){this._showTerrainWireframe!==u&&(this._showTerrainWireframe=u,this._tp.refreshUI(),this._update())}get showLayers2DWireframe(){return!!this._showLayers2DWireframe}set showLayers2DWireframe(u){this._showLayers2DWireframe!==u&&(this._showLayers2DWireframe=u,this._tp.refreshUI(),this._update())}get showLayers3DWireframe(){return!!this._showLayers3DWireframe}set showLayers3DWireframe(u){this._showLayers3DWireframe!==u&&(this._showLayers3DWireframe=u,this._tp.refreshUI(),this._update())}get speedIndexTiming(){return!!this._speedIndexTiming}set speedIndexTiming(u){this._speedIndexTiming!==u&&(this._speedIndexTiming=u,this._update())}get showPadding(){return!!this._showPadding}set showPadding(u){this._showPadding!==u&&(this._showPadding=u,this._tp.refreshUI(),this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(u){this._showCollisionBoxes!==u&&(this._showCollisionBoxes=u,this._tp.refreshUI(),u?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(u){this._showOverdrawInspector!==u&&(this._showOverdrawInspector=u,this._tp.refreshUI(),this._update())}get repaint(){return!!this._repaint}set repaint(u){this._repaint!==u&&(this._repaint=u,this._tp.refreshUI(),this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(u){this._vertices=u,this._update()}get showTileAABBs(){return!!this._showTileAABBs}set showTileAABBs(u){this._showTileAABBs!==u&&(this._showTileAABBs=u,this._tp.refreshUI(),u&&this._update())}_setCacheLimits(u,t){r.dG(u,t)}get version(){return H}},NavigationControl:class{constructor(u={}){this.options=r.l({},Qr,u),this._container=ge("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",t=>t.preventDefault()),this.options.showZoom&&(r.aP(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",t=>{this._map&&this._map.zoomIn({},{originalEvent:t})}),ge("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",t=>{this._map&&this._map.zoomOut({},{originalEvent:t})}),ge("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(r.aP(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",t=>{const o=this._map;o&&(this.options.visualizePitch?o.resetNorthPitch({},{originalEvent:t}):o.resetNorth({},{originalEvent:t}))}),this._compassIcon=ge("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}_updateZoomButtons(){const u=this._map;if(!u)return;const t=u.getZoom(),o=t===u.getMaxZoom(),h=t===u.getMinZoom();this._zoomInButton.disabled=o,this._zoomOutButton.disabled=h,this._zoomInButton.setAttribute("aria-disabled",o.toString()),this._zoomOutButton.setAttribute("aria-disabled",h.toString())}_rotateCompassArrow(){const u=this._map;if(!u)return;const t=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(u.transform.pitch*(Math.PI/180)),.5)}) rotateX(${u.transform.pitch}deg) rotateZ(${u.transform.angle*(180/Math.PI)}deg)`:`rotate(${u.transform.angle*(180/Math.PI)}deg)`;u._requestDomTask(()=>{this._compassIcon&&(this._compassIcon.style.transform=t)})}onAdd(u){return this._map=u,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),u.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&u.on("pitch",this._rotateCompassArrow),u.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new uu(u,this._compass,this.options.visualizePitch)),this._container}onRemove(){const u=this._map;u&&(this._container.remove(),this.options.showZoom&&u.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&u.off("pitch",this._rotateCompassArrow),u.off("rotate",this._rotateCompassArrow),this._handler&&this._handler.off(),this._handler=void 0),this._map=void 0)}_createButton(u,t){const o=ge("button",u,this._container);return o.type="button",o.addEventListener("click",t),o}_setButtonTitle(u,t){if(!this._map)return;const o=this._map._getUIString(`NavigationControl.${t}`);u.setAttribute("aria-label",o),u.firstElementChild&&u.firstElementChild.setAttribute("title",o)}},GeolocateControl:class extends r.E{constructor(u={}){super();const t=navigator.geolocation;this.options=r.l({geolocation:t},Bu,u),r.aP(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker","_updateMarkerRotation","_onDeviceOrientation"],this),this._updateMarkerRotationThrottled=Gd(this._updateMarkerRotation,20),this._numberOfWatches=0}onAdd(u){return this._map=u,this._container=ge("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkGeolocationSupport(this._setupUI),this._container}onRemove(){this._geolocationWatchID!==void 0&&(this.options.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),this._container.remove(),this._map.off("zoom",this._onZoom),this._map=void 0,this._numberOfWatches=0,this._noTimeout=!1}_checkGeolocationSupport(u){const t=(o=!!this.options.geolocation)=>{this._supportsGeolocation=o,u(o)};this._supportsGeolocation!==void 0?u(this._supportsGeolocation):navigator.permissions!==void 0?navigator.permissions.query({name:"geolocation"}).then(o=>t(o.state!=="denied")).catch(()=>t()):t()}_isOutOfMapMaxBounds(u){const t=this._map.getMaxBounds(),o=u.coords;return!!t&&(o.longitude<t.getWest()||o.longitude>t.getEast()||o.latitude<t.getSouth()||o.latitude>t.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}}_onSuccess(u){if(this._map){if(this._isOutOfMapMaxBounds(u))return this._setErrorState(),this.fire(new r.z("outofmaxbounds",u)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=u,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(u),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(u),this.options.showUserLocation&&this._userLocationDotMarker.removeClassName("mapboxgl-user-location-dot-stale"),this.fire(new r.z("geolocate",u)),this._finish()}}_updateCamera(u){const t=new r.bO(u.coords.longitude,u.coords.latitude),o=u.coords.accuracy,h=this._map.getBearing(),g=r.l({bearing:h},this.options.fitBoundsOptions);this._map.fitBounds(t.toBounds(o),g,{geolocateSource:!0})}_updateMarker(u){if(u){const t=new r.bO(u.coords.longitude,u.coords.latitude);this._accuracyCircleMarker.setLngLat(t).addTo(this._map),this._userLocationDotMarker.setLngLat(t).addTo(this._map),this._accuracy=u.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){const u=this._map.transform,t=r.bH(1,u._center.lat)*u.worldSize,o=Math.ceil(2*this._accuracy*t);this._circleElement.style.width=`${o}px`,this._circleElement.style.height=`${o}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_updateMarkerRotation(){this._userLocationDotMarker&&typeof this._heading=="number"?(this._userLocationDotMarker.setRotation(this._heading),this._userLocationDotMarker.addClassName("mapboxgl-user-location-show-heading")):(this._userLocationDotMarker.removeClassName("mapboxgl-user-location-show-heading"),this._userLocationDotMarker.setRotation(0))}_onError(u){if(this._map){if(this.options.trackUserLocation)if(u.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const t=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.setAttribute("aria-label",t),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",t),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(u.code===3&&this._noTimeout)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._userLocationDotMarker.addClassName("mapboxgl-user-location-dot-stale"),this.fire(new r.z("error",u)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(u){if(this._map!==void 0){if(this._container.addEventListener("contextmenu",t=>t.preventDefault()),this._geolocateButton=ge("button","mapboxgl-ctrl-geolocate",this._container),ge("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",u===!1){r.w("Geolocation support is not available so the GeolocateControl will be disabled.");const t=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.setAttribute("aria-label",t),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",t)}else{const t=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.setAttribute("aria-label",t),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",t)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=ge("div","mapboxgl-user-location"),this._dotElement.appendChild(ge("div","mapboxgl-user-location-dot")),this._dotElement.appendChild(ge("div","mapboxgl-user-location-heading")),this._userLocationDotMarker=new of({element:this._dotElement,rotationAlignment:"map",pitchAlignment:"map"}),this._circleElement=ge("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new of({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",t=>{t.geolocateSource||this._watchState!=="ACTIVE_LOCK"||t.originalEvent&&t.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this.fire(new r.z("trackuserlocationend")))})}}_onDeviceOrientation(u){this._userLocationDotMarker&&(u.webkitCompassHeading?this._heading=u.webkitCompassHeading:u.absolute===!0&&(this._heading=-1*u.alpha),this._updateMarkerRotationThrottled())}trigger(){if(!this._setup)return r.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new r.z("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":this._numberOfWatches--,this._noTimeout=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new r.z("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new r.z("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let u;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),this._numberOfWatches++,this._numberOfWatches>1?(u={maximumAge:6e5,timeout:0},this._noTimeout=!0):(u=this.options.positionOptions,this._noTimeout=!1),this._geolocationWatchID=this.options.geolocation.watchPosition(this._onSuccess,this._onError,u),this.options.showUserHeading&&this._addDeviceOrientationListener()}}else this.options.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=window.setTimeout(this._finish,1e4);return!0}_addDeviceOrientationListener(){const u=()=>{"ondeviceorientationabsolute"in window?window.addEventListener("deviceorientationabsolute",this._onDeviceOrientation):window.addEventListener("deviceorientation",this._onDeviceOrientation)};typeof DeviceMotionEvent<"u"&&typeof DeviceMotionEvent.requestPermission=="function"?DeviceOrientationEvent.requestPermission().then(t=>{t==="granted"&&u()}).catch(console.error):u()}_clearWatch(){this.options.geolocation.clearWatch(this._geolocationWatchID),window.removeEventListener("deviceorientation",this._onDeviceOrientation),window.removeEventListener("deviceorientationabsolute",this._onDeviceOrientation),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:ud,ScaleControl:class{constructor(u={}){this.options=r.l({},ql,u),this._isNumberFormatSupported=function(){try{return new Intl.NumberFormat("en",{style:"unit",unitDisplay:"short",unit:"meter"}),!0}catch{return!1}}(),r.aP(["_update","_setScale","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_update(){const u=this.options.maxWidth||100,t=this._map,o=t._containerHeight/2,h=t._containerWidth/2-u/2,g=t.unproject([h,o]),v=t.unproject([h+u,o]),S=g.distanceTo(v);if(this.options.unit==="imperial"){const I=3.2808*S;I>5280?this._setScale(u,I/5280,"mile"):this._setScale(u,I,"foot")}else this.options.unit==="nautical"?this._setScale(u,S/1852,"nautical-mile"):S>=1e3?this._setScale(u,S/1e3,"kilometer"):this._setScale(u,S,"meter")}_setScale(u,t,o){this._map._requestDomTask(()=>{const h=function(v){const S=Math.pow(10,`${Math.floor(v)}`.length-1);let I=v/S;return I=I>=10?10:I>=5?5:I>=3?3:I>=2?2:I>=1?1:function(L){const D=Math.pow(10,Math.ceil(-Math.log(L)/Math.LN10));return Math.round(L*D)/D}(I),S*I}(t),g=h/t;this._container.innerHTML=this._isNumberFormatSupported&&o!=="nautical-mile"?new Intl.NumberFormat(this._language,{style:"unit",unitDisplay:"short",unit:o}).format(h):`${h}&nbsp;${Ki[o]}`,this._container.style.width=u*g+"px"})}onAdd(u){return this._map=u,this._language=u.getLanguage(),this._container=ge("div","mapboxgl-ctrl mapboxgl-ctrl-scale",u.getContainer()),this._container.dir="auto",this._map.on("move",this._update),this._update(),this._container}onRemove(){this._container.remove(),this._map.off("move",this._update),this._map=void 0}_setLanguage(u){this._language=u,this._update()}setUnit(u){this.options.unit=u,this._update()}},FullscreenControl:class{constructor(u={}){this._fullscreen=!1,u&&u.container&&(u.container instanceof HTMLElement?this._container=u.container:r.w("Full screen control 'container' must be a DOM element.")),r.aP(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onwebkitfullscreenchange"in document&&(this._fullscreenchange="webkitfullscreenchange")}onAdd(u){return this._map=u,this._container||(this._container=this._map.getContainer()),this._controlContainer=ge("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",r.w("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){this._controlContainer.remove(),this._map=null,document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!(!document.fullscreenEnabled&&!document.webkitFullscreenEnabled)}_setupUI(){const u=this._fullscreenButton=ge("button","mapboxgl-ctrl-fullscreen",this._controlContainer);ge("span","mapboxgl-ctrl-icon",u).setAttribute("aria-hidden","true"),u.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){const u=this._getTitle();this._fullscreenButton.setAttribute("aria-label",u),this._fullscreenButton.firstElementChild&&this._fullscreenButton.firstElementChild.setAttribute("title",u)}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(document.fullscreenElement||document.webkitFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?document.exitFullscreen?document.exitFullscreen():document.webkitCancelFullScreen&&document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},Popup:class extends r.E{constructor(u){super(),this.options=r.l(Object.create(qa),u),r.aP(["_update","_onClose","remove","_onMouseEvent"],this),this._classList=new Set(u&&u.className?u.className.trim().split(/\s+/):[])}addTo(u){return this._map&&this.remove(),this._map=u,this.options.closeOnClick&&u.on("preclick",this._onClose),this.options.closeOnMove&&u.on("move",this._onClose),u.on("remove",this.remove),this._update(),u._addPopup(this),this._focusFirstElement(),this._trackPointer?(u.on("mousemove",this._onMouseEvent),u.on("mouseup",this._onMouseEvent),u._canvasContainer.classList.add("mapboxgl-track-pointer")):u.on("move",this._update),this.fire(new r.z("open")),this}isOpen(){return!!this._map}remove(){this._content&&this._content.remove(),this._container&&(this._container.remove(),this._container=void 0);const u=this._map;return u&&(u.off("move",this._update),u.off("move",this._onClose),u.off("preclick",this._onClose),u.off("click",this._onClose),u.off("remove",this.remove),u.off("mousemove",this._onMouseEvent),u.off("mouseup",this._onMouseEvent),u.off("drag",this._onMouseEvent),u._canvasContainer&&u._canvasContainer.classList.remove("mapboxgl-track-pointer"),u._removePopup(this),this._map=void 0),this.fire(new r.z("close")),this}getLngLat(){return this._lngLat}setLngLat(u){this._lngLat=r.bO.convert(u),this._pos=null,this._trackPointer=!1,this._update();const t=this._map;return t&&(t.on("move",this._update),t.off("mousemove",this._onMouseEvent),t._canvasContainer.classList.remove("mapboxgl-track-pointer")),this}trackPointer(){this._trackPointer=!0,this._pos=null,this._update();const u=this._map;return u&&(u.off("move",this._update),u.on("mousemove",this._onMouseEvent),u.on("drag",this._onMouseEvent),u._canvasContainer.classList.add("mapboxgl-track-pointer")),this}getElement(){return this._container}setText(u){return this.setDOMContent(document.createTextNode(u))}setHTML(u){const t=document.createDocumentFragment(),o=document.createElement("body");let h;for(o.innerHTML=u;h=o.firstChild,h;)t.appendChild(h);return this.setDOMContent(t)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(u){return this.options.maxWidth=u,this._update(),this}setDOMContent(u){let t=this._content;if(t)for(;t.hasChildNodes();)t.firstChild&&t.removeChild(t.firstChild);else t=this._content=ge("div","mapboxgl-popup-content",this._container||void 0);if(t.appendChild(u),this.options.closeButton){const o=this._closeButton=ge("button","mapboxgl-popup-close-button",t);o.type="button",o.setAttribute("aria-label","Close popup"),o.setAttribute("aria-hidden","true"),o.innerHTML="&#215;",o.addEventListener("click",this._onClose)}return this._update(),this._focusFirstElement(),this}addClassName(u){return this._classList.add(u),this._updateClassList(),this}removeClassName(u){return this._classList.delete(u),this._updateClassList(),this}setOffset(u){return this.options.offset=u,this._update(),this}toggleClassName(u){let t;return this._classList.delete(u)?t=!1:(this._classList.add(u),t=!0),this._updateClassList(),t}_onMouseEvent(u){this._update(u.point)}_getAnchor(u){if(this.options.anchor)return this.options.anchor;const t=this._map,o=this._container,h=this._pos;if(!t||!o||!h)return"bottom";const g=o.offsetWidth,v=o.offsetHeight,S=h.x<g/2,I=h.x>t.transform.width-g/2;if(h.y+u<v)return S?"top-left":I?"top-right":"top";if(h.y>t.transform.height-v){if(S)return"bottom-left";if(I)return"bottom-right"}return S?"left":I?"right":"bottom"}_updateClassList(){const u=this._container;if(!u)return;const t=[...this._classList];t.push("mapboxgl-popup"),this._anchor&&t.push(`mapboxgl-popup-anchor-${this._anchor}`),this._trackPointer&&t.push("mapboxgl-popup-track-pointer"),u.className=t.join(" ")}_update(u){const t=this._map,o=this._content;if(!t||!this._lngLat&&!this._trackPointer||!o)return;let h=this._container;if(h||(h=this._container=ge("div","mapboxgl-popup",t.getContainer()),this._tip=ge("div","mapboxgl-popup-tip",h),h.appendChild(o)),this.options.maxWidth&&h.style.maxWidth!==this.options.maxWidth&&(h.style.maxWidth=this.options.maxWidth),t.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=hd(this._lngLat,this._pos,t.transform)),!this._trackPointer||u){const g=this._pos=this._trackPointer&&u instanceof r.P?u:t.project(this._lngLat),v=Nu(this.options.offset),S=this._anchor=this._getAnchor(v.y),I=Nu(this.options.offset,S),L=g.add(I).round();t._requestDomTask(()=>{this._container&&S&&(this._container.style.transform=`${Ws[S]} translate(${L.x}px,${L.y}px)`)})}if(!this._marker&&t._showingGlobe()){const g=r.dH(t.transform,this._lngLat)?0:1;this._setOpacity(g)}this._updateClassList()}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const u=this._container.querySelector(jn);u&&u.focus()}_onClose(){this.remove()}_setOpacity(u){this._container&&(this._container.style.opacity=`${u}`),this._content&&(this._content.style.pointerEvents=u?"auto":"none")}},Marker:of,Style:Va,LngLat:r.bO,LngLatBounds:r.az,Point:r.P,MercatorCoordinate:r.aa,FreeCameraOptions:yc,Evented:r.E,config:r.e,prewarm:r.dM,clearPrewarmedResources:r.dN,get accessToken(){return r.e.ACCESS_TOKEN},set accessToken(u){r.e.ACCESS_TOKEN=u},get baseApiUrl(){return r.e.API_URL},set baseApiUrl(u){r.e.API_URL=u},get workerCount(){return r.dO.workerCount},set workerCount(u){r.dO.workerCount=u},get maxParallelImageRequests(){return r.e.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(u){r.e.MAX_PARALLEL_IMAGE_REQUESTS=u},clearStorage(u){r.dP(u)},get workerUrl(){return r.dQ.workerUrl},set workerUrl(u){r.dQ.workerUrl=u},get workerClass(){return r.dQ.workerClass},set workerClass(u){r.dQ.workerClass=u},get workerParams(){return r.dQ.workerParams},set workerParams(u){r.dQ.workerParams=u},get dracoUrl(){return r.dR()},set dracoUrl(u){r.dS(u)},get meshoptUrl(){return r.dT()},set meshoptUrl(u){r.dU(u)},setNow:r.q.setNow,restoreNow:r.q.restoreNow}});var O=b;return O})}(Pv)),Pv.exports}var jj=Nj();const Rv=lm(jj);var $j=Object.defineProperty,Vj=Object.defineProperties,Uj=Object.getOwnPropertyDescriptors,gx=Object.getOwnPropertySymbols,tR=Object.prototype.hasOwnProperty,nR=Object.prototype.propertyIsEnumerable,lA=(i,l,f)=>l in i?$j(i,l,{enumerable:!0,configurable:!0,writable:!0,value:f}):i[l]=f,jo=(i,l)=>{for(var f in l||(l={}))tR.call(l,f)&&lA(i,f,l[f]);if(gx)for(var f of gx(l))nR.call(l,f)&&lA(i,f,l[f]);return i},pp=(i,l)=>Vj(i,Uj(l)),$x=(i,l)=>{var f={};for(var _ in i)tR.call(i,_)&&l.indexOf(_)<0&&(f[_]=i[_]);if(i!=null&&gx)for(var _ of gx(i))l.indexOf(_)<0&&nR.call(i,_)&&(f[_]=i[_]);return f},e2=(i,l,f)=>{if(!l.has(i))throw TypeError("Cannot "+f)},Cl=(i,l,f)=>(e2(i,l,"read from private field"),f?f.call(i):l.get(i)),_u=(i,l,f)=>{if(l.has(i))throw TypeError("Cannot add the same private member more than once");l instanceof WeakSet?l.add(i):l.set(i,f)},Rh=(i,l,f,_)=>(e2(i,l,"write to private field"),l.set(i,f),f),Hj=(i,l,f,_)=>({set _(b){Rh(i,l,b)},get _(){return Cl(i,l,_)}}),Tg=(i,l,f)=>(e2(i,l,"access private method"),f),$c=(i,l,f)=>new Promise((_,b)=>{var z=H=>{try{r(f.next(H))}catch(Z){b(Z)}},O=H=>{try{r(f.throw(H))}catch(Z){b(Z)}},r=H=>H.done?_(H.value):Promise.resolve(H.value).then(z,O);r((f=f.apply(i,l)).next())}),rR="https://api.mapbox.com/autofill/v1",Wj="suggest",Gj="retrieve",qj=`${rR}/${Wj}`,Zj=`${rR}/${Gj}`,Zs=class{constructor(i,l){if(isNaN(i)||isNaN(l))throw new Error(`Invalid LngLat object: (${i}, ${l})`);if(this.lng=+i,this.lat=+l,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90");if(this.lng>180||this.lng<-180)throw new Error("Invalid LngLat longitude value: must be between -180 and 180")}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}static convert(i){if(i instanceof Zs)return new Zs(i.lng,i.lat);if(Array.isArray(i)&&i.length===2)return new Zs(Number(i[0]),Number(i[1]));if(!Array.isArray(i)&&typeof i=="object"&&i!==null&&("lng"in i||"lon"in i)&&"lat"in i)return new Zs(Number("lng"in i?i.lng:i.lon),Number(i.lat));throw new Error("`LngLatLike` argument must be specified as an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}},vu=class{constructor(i,l){this._sw=Zs.convert(i),this._ne=Zs.convert(l)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new Zs(this.getWest(),this.getNorth())}getSouthEast(){return new Zs(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toFlatArray(){return[this._sw.lng,this._sw.lat,this._ne.lng,this._ne.lat]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}static convert(i){if(!i)throw new Error("Invalid LngLatBounds convert value: falsy");if(i instanceof vu)return new vu(i.getSouthWest(),i.getNorthEast());if(Array.isArray(i)&&i.length===2)return new vu(Zs.convert(i[0]),Zs.convert(i[1]));if(Array.isArray(i)&&i.length===4)return new vu(Zs.convert([i[0],i[1]]),Zs.convert([i[2],i[3]]));throw new Error("`LngLatBoundsLike` argument must be specified as an array [<LngLatLike>, <LngLatLike>] or an array [<west>, <south>, <east>, <north>]")}};function Xj(){const l=(Math.random().toString(16)+Date.now().toString(16)+Math.random().toString(16)).replace(/\./g,"");return[l.slice(0,8),l.slice(8,12),"4"+l.slice(12,15)+"-8"+l.slice(15,18),l.slice(18,30)].join("-")}var Xu=class{constructor(i){this.id=i??Xj()}toString(){return this.id}static convert(i){return new Xu(i instanceof Xu?i.id:i.toString())}},Yj="Unknown error",Kj=class extends Error{constructor(i,l){super(String(i.message||i.error||Yj)),this.name="MapboxError",this.statusCode=l}toString(){return`${this.name} (${this.statusCode}): ${this.message}`}};function mf(i){return $c(this,null,function*(){if(!i.ok){const l=yield i.json();throw new Kj(l,i.status)}})}var cA=globalThis.fetch,Jj=globalThis.AbortController;function Md(){if(!cA)throw new Error("Fetch implementation not found. Please include a fetch polyfill in your application or use `polyfillFetch` from `@mapbox/search-js-core` to fix this issue.");return{fetch:cA,AbortController:Jj}}function sm(...i){const l=[];for(const f of i){if(!f)continue;const _=Object.entries(f);for(const[b,z]of _)z!=null&&l.push(`${b}=${encodeURIComponent(String(z))}`)}return l.join("&")}var kv,Nw,iR,oR=class{constructor(i={}){_u(this,Nw),_u(this,kv,void 0);const l=i,{accessToken:f}=l,_=$x(l,["accessToken"]);this.accessToken=f,this.defaults=jo(jo({},oR.defaults),_)}get responseHeaders(){return Cl(this,kv)}suggest(i,l){return $c(this,null,function*(){if(!i)throw new Error("searchText is required");const{sessionToken:f,signal:_}=l,b=pp(jo(jo({},this.defaults),l),{sessionToken:f}),z=new URL(`${qj}/${encodeURIComponent(i)}`);z.search=Tg(this,Nw,iR).call(this,b);const{fetch:O}=Md(),r=yield O(z.toString(),{signal:_});Rh(this,kv,r.headers),yield mf(r);const H=yield r.json();return pp(jo({},H),{suggestions:H.suggestions.map(Z=>pp(jo({},Z),{original_search_text:i})),url:z.toString()})})}retrieve(i,l){return $c(this,null,function*(){if(!i)throw new Error("suggestion is required");if(!this.canRetrieve(i))throw new Error("suggestion cannot be retrieved");const{sessionToken:f,signal:_}=l,b=Xu.convert(f),z=new URL(`${Zj}/${i.action.id}`);z.search=sm({access_token:this.accessToken,session_token:b.id});const{fetch:O}=Md(),r=yield O(z.toString(),{signal:_});yield mf(r);const H=yield r.json();return H.url=z.toString(),H})}canRetrieve(i){const l=i.action;return typeof(l==null?void 0:l.id)=="string"}},sR=oR;kv=new WeakMap;Nw=new WeakSet;iR=function(i){return sm({types:"address",access_token:this.accessToken,streets:i.streets,language:i.language,country:i.country,limit:i.limit},i.sessionToken&&{session_token:Xu.convert(i.sessionToken).id},i.proximity&&{proximity:typeof i.proximity=="string"?i.proximity:Zs.convert(i.proximity).toArray().join(",")},i.bbox&&{bbox:typeof i.bbox=="string"?i.bbox:vu.convert(i.bbox).toFlatArray().join(",")})};sR.defaults={language:"en",proximity:"ip",streets:!0};var Vx="https://api.mapbox.com/search/searchbox/v1",Qj="suggest",e6="retrieve",t6="category",n6="reverse",r6=`${Vx}/${Qj}`,i6=`${Vx}/${e6}`,o6=`${Vx}/${t6}`,s6=`${Vx}/${n6}`,zv,jw,aR=class{constructor(i={}){_u(this,zv);const l=i,{accessToken:f}=l,_=$x(l,["accessToken"]);this.accessToken=f,this.defaults=jo(jo({},aR.defaults),_)}suggest(i,l){return $c(this,null,function*(){if(!i)throw new Error("searchText is required");const{sessionToken:f,signal:_}=l,b=pp(jo(jo({},this.defaults),l),{q:i,sessionToken:f});if(b.eta_type&&(!b.origin||!b.navigation_profile))throw new Error("to provide eta estimate: eta, navigation_profile, and origin are required");if(b.origin&&!b.navigation_profile)throw new Error("to provide distance estimate: both navigation_profile and origin are required");const z=new URL(r6);z.search=Tg(this,zv,jw).call(this,b);const{fetch:O}=Md(),r=yield O(z.toString(),{signal:_});yield mf(r);const H=yield r.json();return H.url=z.toString(),H})}retrieve(i,l){return $c(this,null,function*(){if(!i)throw new Error("suggestion is required");const{sessionToken:f,signal:_,language:b}=l,z=Xu.convert(f),O=jo(jo({},this.defaults),b&&{language:b}),r=new URL(`${i6}/${encodeURIComponent(i.mapbox_id)}`);r.search=sm({access_token:this.accessToken,session_token:z.id},{language:O.language});const{fetch:H}=Md(),Z=yield H(r.toString(),{signal:_});yield mf(Z);const K=yield Z.json();return K.url=r.toString(),K})}category(i){return $c(this,arguments,function*(l,f={}){if(!l)throw new Error("category is required");const _=jo(jo({},this.defaults),f),b=new URL(`${o6}/${encodeURIComponent(l)}`);b.search=Tg(this,zv,jw).call(this,_);const{fetch:z}=Md(),O=yield z(b.toString(),{signal:_.signal});yield mf(O);const r=yield O.json();return r.url=b.toString(),r})}reverse(i){return $c(this,arguments,function*(l,f={}){if(!l)throw new Error("lngLat is required");const[_,b]=typeof l=="string"?l.split(",").map(K=>parseFloat(K)):Zs.convert(l).toArray();if(isNaN(_)||isNaN(b))throw new Error("lngLat is required");const z=jo(jo({},this.defaults),f),O=new URL(s6);O.search=sm({access_token:this.accessToken,language:z.language,limit:z.limit,longitude:_,latitude:b},z.types&&{types:typeof z.types=="string"?z.types:[...z.types].join(",")});const{fetch:r}=Md(),H=yield r(O.toString(),{signal:z.signal});yield mf(H);const Z=yield H.json();return Z.url=O.toString(),Z})}},lR=aR;zv=new WeakSet;jw=function(i){return sm({q:i.q,access_token:this.accessToken,language:i.language,limit:i.limit,navigation_profile:i.navigation_profile,route:i.route,route_geometry:i.route_geometry,sar_type:i.sar_type,time_deviation:i.time_deviation,eta_type:i.eta_type,country:i.country,poi_category:i.poi_category,rich_metadata_provider:i.rich_metadata_provider,poi_category_exclusions:i.poi_category_exclusions},i.sessionToken&&{session_token:Xu.convert(i.sessionToken).id},i.proximity&&{proximity:typeof i.proximity=="string"?i.proximity:Zs.convert(i.proximity).toArray().join(",")},i.origin&&{origin:typeof i.origin=="string"?i.origin:Zs.convert(i.origin).toArray().join(",")},i.bbox&&{bbox:typeof i.bbox=="string"?i.bbox:vu.convert(i.bbox).toFlatArray().join(",")},i.types&&{types:typeof i.types=="string"?i.types:[...i.types].join(",")})};lR.defaults={language:"en"};var a6="https://api.mapbox.com/autofill/v1",l6="retrieve",c6=`${a6}/${l6}`,$w,cR,uR=class{constructor(i={}){_u(this,$w);const l=i,{accessToken:f}=l,_=$x(l,["accessToken"]);this.accessToken=f,this.defaults=jo(jo({},uR.defaults),_)}validate(i,l){return $c(this,null,function*(){if(!i)throw new Error("searchText is required");const{sessionToken:f,signal:_}=l,b=pp(jo(jo({},this.defaults),l),{sessionToken:f}),z=new URL(`${c6}/${encodeURIComponent(i)}`);z.search=Tg(this,$w,cR).call(this,b);const{fetch:O}=Md(),r=yield O(z.toString(),{signal:_});yield mf(r);const H=yield r.json();return H.url=z.toString(),H.features.length>0&&(H.features=[H.features[0]]),H})}},hR=uR;$w=new WeakSet;cR=function(i){return sm({access_token:this.accessToken,language:i.language,country:i.country},i.sessionToken&&{session_token:Xu.convert(i.sessionToken).id},i.proximity&&{proximity:typeof i.proximity=="string"?i.proximity:Zs.convert(i.proximity).toArray().join(",")},i.bbox&&{bbox:typeof i.bbox=="string"?i.bbox:vu.convert(i.bbox).toFlatArray().join(",")})};hR.defaults={language:"en",proximity:"ip"};var dR="https://api.mapbox.com/search/geocode/v6",u6=`${dR}/forward`,h6=`${dR}/reverse`,d6=/^[ ]*(-?\d{1,3}(\.\d{0,256})?)[, ]+(-?\d{1,3}(\.\d{0,256})?)[ ]*$/,f6=/[\s,]+/,g_,Lv,Vw,p6=class{constructor(i={}){_u(this,Lv),_u(this,g_,void 0);const l=i,{accessToken:f}=l,_=$x(l,["accessToken"]);this.accessToken=f,this.defaults=jo({},_)}get responseHeaders(){return Cl(this,g_)}forward(i,l){return $c(this,null,function*(){if(!i)throw new Error("searchText is required");let f;l&&({signal:f}=l);const _=pp(jo(jo({},this.defaults),l),{q:i}),b=new URL(`${u6}`);b.search=Tg(this,Lv,Vw).call(this,_);const{fetch:z}=Md(),O=f?{signal:f}:{},r=yield z(b.toString(),O);Rh(this,g_,r.headers),yield mf(r);const H=yield r.json();return H.url=b.toString(),H})}reverse(i,l){return $c(this,null,function*(){if(!i)throw new Error("lngLat is required");let f;l&&({signal:f}=l);let _;if(typeof i=="string"){const[K,te]=i.split(",");_=new Zs(Number(K),Number(te))}else _=Zs.convert(i);const b=pp(jo(jo({},this.defaults),l),{longitude:_.lng,latitude:_.lat}),z=new URL(`${h6}`);z.search=Tg(this,Lv,Vw).call(this,b,!0);const{fetch:O}=Md(),r=f?{signal:f}:{},H=yield O(z.toString(),r);Rh(this,g_,H.headers),yield mf(H);const Z=yield H.json();return Z.url=z.toString(),Z})}suggest(i,l){return $c(this,null,function*(){if(d6.test(i)){const _=i.trim().split(f6).map(b=>b.trim()).join(",");return this.reverse(_,l)}else return this.forward(i,l)})}retrieve(i){return $c(this,null,function*(){return i})}};g_=new WeakMap;Lv=new WeakSet;Vw=function(i,l=!1){return l&&["proximity","autocomplete","bbox"].forEach(f=>{f in i&&delete i[f]}),sm({q:i.q,longitude:i.longitude,latitude:i.latitude,access_token:this.accessToken,permanent:i.permanent,language:i.language,country:i.country,limit:i.limit,autocomplete:i.autocomplete,worldview:i.worldview},i.sessionToken&&{session_token:Xu.convert(i.sessionToken).id},i.proximity&&{proximity:typeof i.proximity=="string"?i.proximity:Zs.convert(i.proximity).toArray().join(",")},i.bbox&&{bbox:typeof i.bbox=="string"?i.bbox:vu.convert(i.bbox).toFlatArray().join(",")},i.types&&{types:typeof i.types=="string"?i.types:[...i.types].join(",")})};var fR=(i=>(i.exact="exact",i.high="high",i.medium="medium",i.low="low",i))(fR||{}),__,m6=class{constructor(){_u(this,__,{})}addEventListener(i,l){const f=Cl(this,__);f[i]||(f[i]=[]),f[i].push(l)}removeEventListener(i,l){const f=Cl(this,__);if(!f[i])return;const _=f[i],b=_.indexOf(l);b!==-1&&_.splice(b,1)}fire(i,l){const f=Cl(this,__);if(!f[i])return;const _=f[i];for(const b of _)b(l)}};__=new WeakMap;function pR(i,l,f){let _=null;return(...b)=>{_!==null&&clearTimeout(_);const z=f&&f();_=setTimeout(()=>{_=null,!(z!=null&&z.aborted)&&i(...b)},l)}}function F1(){const{AbortController:i}=Md();return new i}var y_,Ov,Dv,Km,rp,Fv,t2=class extends m6{constructor(i,l=0){super(),_u(this,y_,new Xu),_u(this,Ov,0),_u(this,Dv,!1),_u(this,Km,void 0),_u(this,rp,F1()),_u(this,Fv,void 0),Rh(this,Fv,pR((f,..._)=>$c(this,[f,..._],function*(b,z={}){if(Cl(this,rp).abort(),Rh(this,rp,F1()),!b){Rh(this,Km,null),this.fire("suggest",Cl(this,Km));return}try{const O=yield this.search.suggest(b,pp(jo({sessionToken:this.sessionToken},z),{signal:Cl(this,rp).signal}));Rh(this,Km,O),this.fire("suggest",O)}catch(O){if(O.name==="AbortError")return;this.fire("suggesterror",O)}}),l,()=>Cl(this,rp).signal)),Object.defineProperties(this,{search:{value:i,writable:!1},debounce:{value:l,writable:!1}})}get sessionToken(){return Cl(this,Dv)?Cl(this,y_).id:`${Cl(this,y_).id}.${Cl(this,Ov)}`}set sessionToken(i){Rh(this,Dv,!0),Rh(this,y_,new Xu(i))}get suggestions(){return Cl(this,Km)}suggest(i,l){return Cl(this,Fv).call(this,i,l),new Promise((f,_)=>{let b,z;b=O=>{this.removeEventListener("suggest",b),this.removeEventListener("suggesterror",z),f(O)},z=O=>{this.removeEventListener("suggest",b),this.removeEventListener("suggesterror",z),_(O)},this.addEventListener("suggest",b),this.addEventListener("suggesterror",z)})}clear(){this.suggest("")}retrieve(i,l){return $c(this,null,function*(){const f=yield this.search.retrieve(i,jo({sessionToken:this.sessionToken},l));return this.fire("retrieve",f),f})}canRetrieve(i){return this.search.canRetrieve?this.search.canRetrieve(i):!0}canSuggest(i){return this.search.canSuggest?this.search.canSuggest(i):!0}abort(){Cl(this,rp).abort(),Rh(this,rp,F1())}incrementSession(){Hj(this,Ov)._++}};y_=new WeakMap;Ov=new WeakMap;Dv=new WeakMap;Km=new WeakMap;rp=new WeakMap;Fv=new WeakMap;function n2(i){const{properties:l}=i;return jo({},l)}function Ux(i){return i.split("-")[0]}function r2(i){return i.split("-")[1]}function i2(i){return["top","bottom"].includes(Ux(i))?"x":"y"}function mR(i){return i==="y"?"height":"width"}function uA(i,l,f){let{reference:_,floating:b}=i;const z=_.x+_.width/2-b.width/2,O=_.y+_.height/2-b.height/2,r=i2(l),H=mR(r),Z=_[H]/2-b[H]/2,K=r==="x";let te;switch(Ux(l)){case"top":te={x:z,y:_.y-b.height};break;case"bottom":te={x:z,y:_.y+_.height};break;case"right":te={x:_.x+_.width,y:O};break;case"left":te={x:_.x-b.width,y:O};break;default:te={x:_.x,y:_.y}}switch(r2(l)){case"start":te[r]-=Z*(f&&K?-1:1);break;case"end":te[r]+=Z*(f&&K?-1:1)}return te}const g6=async(i,l,f)=>{const{placement:_="bottom",strategy:b="absolute",middleware:z=[],platform:O}=f,r=await(O.isRTL==null?void 0:O.isRTL(l));let H=await O.getElementRects({reference:i,floating:l,strategy:b}),{x:Z,y:K}=uA(H,_,r),te=_,le={},Te=0;for(let pe=0;pe<z.length;pe++){const{name:ge,fn:fe}=z[pe],{x:me,y:_e,data:Ie,reset:Ne}=await fe({x:Z,y:K,initialPlacement:_,placement:te,strategy:b,middlewareData:le,rects:H,platform:O,elements:{reference:i,floating:l}});Z=me??Z,K=_e??K,le={...le,[ge]:{...le[ge],...Ie}},Ne&&Te<=50&&(Te++,typeof Ne=="object"&&(Ne.placement&&(te=Ne.placement),Ne.rects&&(H=Ne.rects===!0?await O.getElementRects({reference:i,floating:l,strategy:b}):Ne.rects),{x:Z,y:K}=uA(H,te,r)),pe=-1)}return{x:Z,y:K,placement:te,strategy:b,middlewareData:le}};function _6(i){return typeof i!="number"?function(l){return{top:0,right:0,bottom:0,left:0,...l}}(i):{top:i,right:i,bottom:i,left:i}}function _x(i){return{...i,top:i.y,left:i.x,right:i.x+i.width,bottom:i.y+i.height}}async function y6(i,l){var f;l===void 0&&(l={});const{x:_,y:b,platform:z,rects:O,elements:r,strategy:H}=i,{boundary:Z="clippingAncestors",rootBoundary:K="viewport",elementContext:te="floating",altBoundary:le=!1,padding:Te=0}=l,pe=_6(Te),ge=r[le?te==="floating"?"reference":"floating":te],fe=_x(await z.getClippingRect({element:(f=await(z.isElement==null?void 0:z.isElement(ge)))==null||f?ge:ge.contextElement||await(z.getDocumentElement==null?void 0:z.getDocumentElement(r.floating)),boundary:Z,rootBoundary:K,strategy:H})),me=_x(z.convertOffsetParentRelativeRectToViewportRelativeRect?await z.convertOffsetParentRelativeRectToViewportRelativeRect({rect:te==="floating"?{...O.floating,x:_,y:b}:O.reference,offsetParent:await(z.getOffsetParent==null?void 0:z.getOffsetParent(r.floating)),strategy:H}):O[te]);return{top:fe.top-me.top+pe.top,bottom:me.bottom-fe.bottom+pe.bottom,left:fe.left-me.left+pe.left,right:me.right-fe.right+pe.right}}const v6={left:"right",right:"left",bottom:"top",top:"bottom"};function yx(i){return i.replace(/left|right|bottom|top/g,l=>v6[l])}function x6(i,l,f){f===void 0&&(f=!1);const _=r2(i),b=i2(i),z=mR(b);let O=b==="x"?_===(f?"end":"start")?"right":"left":_==="start"?"bottom":"top";return l.reference[z]>l.floating[z]&&(O=yx(O)),{main:O,cross:yx(O)}}const b6={start:"end",end:"start"};function hA(i){return i.replace(/start|end/g,l=>b6[l])}const w6=["top","right","bottom","left"];w6.reduce((i,l)=>i.concat(l,l+"-start",l+"-end"),[]);const S6=function(i){return i===void 0&&(i={}),{name:"flip",options:i,async fn(l){var f;const{placement:_,middlewareData:b,rects:z,initialPlacement:O,platform:r,elements:H}=l,{mainAxis:Z=!0,crossAxis:K=!0,fallbackPlacements:te,fallbackStrategy:le="bestFit",flipAlignment:Te=!0,...pe}=i,ge=Ux(_),fe=te||(ge===O||!Te?[yx(O)]:function(rt){const at=yx(rt);return[hA(rt),at,hA(at)]}(O)),me=[O,...fe],_e=await y6(l,pe),Ie=[];let Ne=((f=b.flip)==null?void 0:f.overflows)||[];if(Z&&Ie.push(_e[ge]),K){const{main:rt,cross:at}=x6(_,z,await(r.isRTL==null?void 0:r.isRTL(H.floating)));Ie.push(_e[rt],_e[at])}if(Ne=[...Ne,{placement:_,overflows:Ie}],!Ie.every(rt=>rt<=0)){var nt,Le;const rt=((nt=(Le=b.flip)==null?void 0:Le.index)!=null?nt:0)+1,at=me[rt];if(at)return{data:{index:rt,overflows:Ne},reset:{placement:at}};let Qe="bottom";switch(le){case"bestFit":{var Pe;const lt=(Pe=Ne.map(Ct=>[Ct,Ct.overflows.filter(Rt=>Rt>0).reduce((Rt,Nt)=>Rt+Nt,0)]).sort((Ct,Rt)=>Ct[1]-Rt[1])[0])==null?void 0:Pe[0].placement;lt&&(Qe=lt);break}case"initialPlacement":Qe=O}if(_!==Qe)return{reset:{placement:Qe}}}return{}}}},E6=function(i){return i===void 0&&(i=0),{name:"offset",options:i,async fn(l){const{x:f,y:_}=l,b=await async function(z,O){const{placement:r,platform:H,elements:Z}=z,K=await(H.isRTL==null?void 0:H.isRTL(Z.floating)),te=Ux(r),le=r2(r),Te=i2(r)==="x",pe=["left","top"].includes(te)?-1:1,ge=K&&Te?-1:1,fe=typeof O=="function"?O(z):O;let{mainAxis:me,crossAxis:_e,alignmentAxis:Ie}=typeof fe=="number"?{mainAxis:fe,crossAxis:0,alignmentAxis:null}:{mainAxis:0,crossAxis:0,alignmentAxis:null,...fe};return le&&typeof Ie=="number"&&(_e=le==="end"?-1*Ie:Ie),Te?{x:_e*ge,y:me*pe}:{x:me*pe,y:_e*ge}}(l,i);return{x:f+b.x,y:_+b.y,data:b}}}};function gR(i){return i&&i.document&&i.location&&i.alert&&i.setInterval}function Tf(i){if(i==null)return window;if(!gR(i)){const l=i.ownerDocument;return l&&l.defaultView||window}return i}function py(i){return Tf(i).getComputedStyle(i)}function _f(i){return gR(i)?"":i?(i.nodeName||"").toLowerCase():""}function _R(){const i=navigator.userAgentData;return i!=null&&i.brands?i.brands.map(l=>l.brand+"/"+l.version).join(" "):navigator.userAgent}function Id(i){return i instanceof Tf(i).HTMLElement}function _p(i){return i instanceof Tf(i).Element}function o2(i){return typeof ShadowRoot>"u"?!1:i instanceof Tf(i).ShadowRoot||i instanceof ShadowRoot}function Hx(i){const{overflow:l,overflowX:f,overflowY:_}=py(i);return/auto|scroll|overlay|hidden/.test(l+_+f)}function T6(i){return["table","td","th"].includes(_f(i))}function dA(i){const l=/firefox/i.test(_R()),f=py(i);return f.transform!=="none"||f.perspective!=="none"||f.contain==="paint"||["transform","perspective"].includes(f.willChange)||l&&f.willChange==="filter"||l&&!!f.filter&&f.filter!=="none"}function yR(){return!/^((?!chrome|android).)*safari/i.test(_R())}const fA=Math.min,U_=Math.max,vx=Math.round;function yf(i,l,f){var _,b,z,O;l===void 0&&(l=!1),f===void 0&&(f=!1);const r=i.getBoundingClientRect();let H=1,Z=1;l&&Id(i)&&(H=i.offsetWidth>0&&vx(r.width)/i.offsetWidth||1,Z=i.offsetHeight>0&&vx(r.height)/i.offsetHeight||1);const K=_p(i)?Tf(i):window,te=!yR()&&f,le=(r.left+(te&&(_=(b=K.visualViewport)==null?void 0:b.offsetLeft)!=null?_:0))/H,Te=(r.top+(te&&(z=(O=K.visualViewport)==null?void 0:O.offsetTop)!=null?z:0))/Z,pe=r.width/H,ge=r.height/Z;return{width:pe,height:ge,top:Te,right:le+pe,bottom:Te+ge,left:le,x:le,y:Te}}function mp(i){return(l=i,(l instanceof Tf(l).Node?i.ownerDocument:i.document)||window.document).documentElement;var l}function Wx(i){return _p(i)?{scrollLeft:i.scrollLeft,scrollTop:i.scrollTop}:{scrollLeft:i.pageXOffset,scrollTop:i.pageYOffset}}function vR(i){return yf(mp(i)).left+Wx(i).scrollLeft}function C6(i,l,f){const _=Id(l),b=mp(l),z=yf(i,_&&function(H){const Z=yf(H);return vx(Z.width)!==H.offsetWidth||vx(Z.height)!==H.offsetHeight}(l),f==="fixed");let O={scrollLeft:0,scrollTop:0};const r={x:0,y:0};if(_||!_&&f!=="fixed")if((_f(l)!=="body"||Hx(b))&&(O=Wx(l)),Id(l)){const H=yf(l,!0);r.x=H.x+l.clientLeft,r.y=H.y+l.clientTop}else b&&(r.x=vR(b));return{x:z.left+O.scrollLeft-r.x,y:z.top+O.scrollTop-r.y,width:z.width,height:z.height}}function xR(i){return _f(i)==="html"?i:i.assignedSlot||i.parentNode||(o2(i)?i.host:null)||mp(i)}function pA(i){return Id(i)&&getComputedStyle(i).position!=="fixed"?i.offsetParent:null}function Uw(i){const l=Tf(i);let f=pA(i);for(;f&&T6(f)&&getComputedStyle(f).position==="static";)f=pA(f);return f&&(_f(f)==="html"||_f(f)==="body"&&getComputedStyle(f).position==="static"&&!dA(f))?l:f||function(_){let b=xR(_);for(o2(b)&&(b=b.host);Id(b)&&!["html","body"].includes(_f(b));){if(dA(b))return b;b=b.parentNode}return null}(i)||l}function mA(i){if(Id(i))return{width:i.offsetWidth,height:i.offsetHeight};const l=yf(i);return{width:l.width,height:l.height}}function bR(i){const l=xR(i);return["html","body","#document"].includes(_f(l))?i.ownerDocument.body:Id(l)&&Hx(l)?l:bR(l)}function xx(i,l){var f;l===void 0&&(l=[]);const _=bR(i),b=_===((f=i.ownerDocument)==null?void 0:f.body),z=Tf(_),O=b?[z].concat(z.visualViewport||[],Hx(_)?_:[]):_,r=l.concat(O);return b?r:r.concat(xx(O))}function gA(i,l,f){return l==="viewport"?_x(function(_,b){const z=Tf(_),O=mp(_),r=z.visualViewport;let H=O.clientWidth,Z=O.clientHeight,K=0,te=0;if(r){H=r.width,Z=r.height;const le=yR();(le||!le&&b==="fixed")&&(K=r.offsetLeft,te=r.offsetTop)}return{width:H,height:Z,x:K,y:te}}(i,f)):_p(l)?function(_,b){const z=yf(_,!1,b==="fixed"),O=z.top+_.clientTop,r=z.left+_.clientLeft;return{top:O,left:r,x:r,y:O,right:r+_.clientWidth,bottom:O+_.clientHeight,width:_.clientWidth,height:_.clientHeight}}(l,f):_x(function(_){var b;const z=mp(_),O=Wx(_),r=(b=_.ownerDocument)==null?void 0:b.body,H=U_(z.scrollWidth,z.clientWidth,r?r.scrollWidth:0,r?r.clientWidth:0),Z=U_(z.scrollHeight,z.clientHeight,r?r.scrollHeight:0,r?r.clientHeight:0);let K=-O.scrollLeft+vR(_);const te=-O.scrollTop;return py(r||z).direction==="rtl"&&(K+=U_(z.clientWidth,r?r.clientWidth:0)-H),{width:H,height:Z,x:K,y:te}}(mp(i)))}function M6(i){const l=xx(i),f=["absolute","fixed"].includes(py(i).position)&&Id(i)?Uw(i):i;return _p(f)?l.filter(_=>_p(_)&&function(b,z){const O=z.getRootNode==null?void 0:z.getRootNode();if(b.contains(z))return!0;if(O&&o2(O)){let r=z;do{if(r&&b===r)return!0;r=r.parentNode||r.host}while(r)}return!1}(_,f)&&_f(_)!=="body"):[]}const A6={getClippingRect:function(i){let{element:l,boundary:f,rootBoundary:_,strategy:b}=i;const z=[...f==="clippingAncestors"?M6(l):[].concat(f),_],O=z[0],r=z.reduce((H,Z)=>{const K=gA(l,Z,b);return H.top=U_(K.top,H.top),H.right=fA(K.right,H.right),H.bottom=fA(K.bottom,H.bottom),H.left=U_(K.left,H.left),H},gA(l,O,b));return{width:r.right-r.left,height:r.bottom-r.top,x:r.left,y:r.top}},convertOffsetParentRelativeRectToViewportRelativeRect:function(i){let{rect:l,offsetParent:f,strategy:_}=i;const b=Id(f),z=mp(f);if(f===z)return l;let O={scrollLeft:0,scrollTop:0};const r={x:0,y:0};if((b||!b&&_!=="fixed")&&((_f(f)!=="body"||Hx(z))&&(O=Wx(f)),Id(f))){const H=yf(f,!0);r.x=H.x+f.clientLeft,r.y=H.y+f.clientTop}return{...l,x:l.x-O.scrollLeft+r.x,y:l.y-O.scrollTop+r.y}},isElement:_p,getDimensions:mA,getOffsetParent:Uw,getDocumentElement:mp,getElementRects:i=>{let{reference:l,floating:f,strategy:_}=i;return{reference:C6(l,Uw(f),_),floating:{...mA(f),x:0,y:0}}},getClientRects:i=>Array.from(i.getClientRects()),isRTL:i=>py(i).direction==="rtl"};function I6(i,l,f,_){_===void 0&&(_={});const{ancestorScroll:b=!0,ancestorResize:z=!0,elementResize:O=!0,animationFrame:r=!1}=_,H=b&&!r,Z=z&&!r,K=H||Z?[..._p(i)?xx(i):[],...xx(l)]:[];K.forEach(pe=>{H&&pe.addEventListener("scroll",f,{passive:!0}),Z&&pe.addEventListener("resize",f)});let te,le=null;if(O){let pe=!0;le=new ResizeObserver(()=>{pe||f(),pe=!1}),_p(i)&&!r&&le.observe(i),le.observe(l)}let Te=r?yf(i):null;return r&&function pe(){const ge=yf(i);!Te||ge.x===Te.x&&ge.y===Te.y&&ge.width===Te.width&&ge.height===Te.height||f(),Te=ge,te=requestAnimationFrame(pe)}(),f(),()=>{var pe;K.forEach(ge=>{H&&ge.removeEventListener("scroll",f),Z&&ge.removeEventListener("resize",f)}),(pe=le)==null||pe.disconnect(),le=null,r&&cancelAnimationFrame(te)}}const P6=(i,l,f)=>g6(i,l,{platform:A6,...f});var B1={exports:{}},_A;function R6(){return _A||(_A=1,function(i){(function(l){var f=!1,_,b;function z(){if(typeof _<"u")return _;var te=document.documentElement,le=document.createElement("div");return le.setAttribute("style","width:99px;height:99px;position:absolute;top:-9999px;overflow:scroll;"),te.appendChild(le),_=le.offsetWidth-le.clientWidth,te.removeChild(le),_}function O(){return document.documentElement.scrollHeight>window.innerHeight}function r(te){if(!(typeof document>"u"||f)){var le=document.documentElement;b=window.pageYOffset,O()?le.style.width="calc(100% - "+z()+"px)":le.style.width="100%",le.style.position="fixed",le.style.top=-b+"px",le.style.overflow="hidden",f=!0}}function H(){if(!(typeof document>"u"||!f)){var te=document.documentElement;te.style.width="",te.style.position="",te.style.top="",te.style.overflow="",window.scroll(0,b),f=!1}}function Z(){if(f){H();return}r()}var K={on:r,off:H,toggle:Z};i.exports=K})()}(B1)),B1.exports}var k6=R6();const yA=lm(k6);/*!
* tabbable 5.3.3
* @license MIT, https://github.com/focus-trap/tabbable/blob/master/LICENSE
*/var wR=["input","select","textarea","a[href]","button","[tabindex]:not(slot)","audio[controls]","video[controls]",'[contenteditable]:not([contenteditable="false"])',"details>summary:first-of-type","details"],bx=wR.join(","),SR=typeof Element>"u",am=SR?function(){}:Element.prototype.matches||Element.prototype.msMatchesSelector||Element.prototype.webkitMatchesSelector,Hw=!SR&&Element.prototype.getRootNode?function(i){return i.getRootNode()}:function(i){return i.ownerDocument},ER=function(l,f,_){var b=Array.prototype.slice.apply(l.querySelectorAll(bx));return f&&am.call(l,bx)&&b.unshift(l),b=b.filter(_),b},TR=function i(l,f,_){for(var b=[],z=Array.from(l);z.length;){var O=z.shift();if(O.tagName==="SLOT"){var r=O.assignedElements(),H=r.length?r:O.children,Z=i(H,!0,_);_.flatten?b.push.apply(b,Z):b.push({scope:O,candidates:Z})}else{var K=am.call(O,bx);K&&_.filter(O)&&(f||!l.includes(O))&&b.push(O);var te=O.shadowRoot||typeof _.getShadowRoot=="function"&&_.getShadowRoot(O),le=!_.shadowRootFilter||_.shadowRootFilter(O);if(te&&le){var Te=i(te===!0?O.children:te.children,!0,_);_.flatten?b.push.apply(b,Te):b.push({scope:O,candidates:Te})}else z.unshift.apply(z,O.children)}}return b},CR=function(l,f){return l.tabIndex<0&&(f||/^(AUDIO|VIDEO|DETAILS)$/.test(l.tagName)||l.isContentEditable)&&isNaN(parseInt(l.getAttribute("tabindex"),10))?0:l.tabIndex},z6=function(l,f){return l.tabIndex===f.tabIndex?l.documentOrder-f.documentOrder:l.tabIndex-f.tabIndex},MR=function(l){return l.tagName==="INPUT"},L6=function(l){return MR(l)&&l.type==="hidden"},O6=function(l){var f=l.tagName==="DETAILS"&&Array.prototype.slice.apply(l.children).some(function(_){return _.tagName==="SUMMARY"});return f},D6=function(l,f){for(var _=0;_<l.length;_++)if(l[_].checked&&l[_].form===f)return l[_]},F6=function(l){if(!l.name)return!0;var f=l.form||Hw(l),_=function(r){return f.querySelectorAll('input[type="radio"][name="'+r+'"]')},b;if(typeof window<"u"&&typeof window.CSS<"u"&&typeof window.CSS.escape=="function")b=_(window.CSS.escape(l.name));else try{b=_(l.name)}catch(O){return console.error("Looks like you have a radio button with a name attribute containing invalid CSS selector characters and need the CSS.escape polyfill: %s",O.message),!1}var z=D6(b,l.form);return!z||z===l},B6=function(l){return MR(l)&&l.type==="radio"},N6=function(l){return B6(l)&&!F6(l)},vA=function(l){var f=l.getBoundingClientRect(),_=f.width,b=f.height;return _===0&&b===0},j6=function(l,f){var _=f.displayCheck,b=f.getShadowRoot;if(getComputedStyle(l).visibility==="hidden")return!0;var z=am.call(l,"details>summary:first-of-type"),O=z?l.parentElement:l;if(am.call(O,"details:not([open]) *"))return!0;var r=Hw(l).host,H=(r==null?void 0:r.ownerDocument.contains(r))||l.ownerDocument.contains(l);if(!_||_==="full"){if(typeof b=="function"){for(var Z=l;l;){var K=l.parentElement,te=Hw(l);if(K&&!K.shadowRoot&&b(K)===!0)return vA(l);l.assignedSlot?l=l.assignedSlot:!K&&te!==l.ownerDocument?l=te.host:l=K}l=Z}if(H)return!l.getClientRects().length}else if(_==="non-zero-area")return vA(l);return!1},$6=function(l){if(/^(INPUT|BUTTON|SELECT|TEXTAREA)$/.test(l.tagName))for(var f=l.parentElement;f;){if(f.tagName==="FIELDSET"&&f.disabled){for(var _=0;_<f.children.length;_++){var b=f.children.item(_);if(b.tagName==="LEGEND")return am.call(f,"fieldset[disabled] *")?!0:!b.contains(l)}return!0}f=f.parentElement}return!1},wx=function(l,f){return!(f.disabled||L6(f)||j6(f,l)||O6(f)||$6(f))},Ww=function(l,f){return!(N6(f)||CR(f)<0||!wx(l,f))},V6=function(l){var f=parseInt(l.getAttribute("tabindex"),10);return!!(isNaN(f)||f>=0)},U6=function i(l){var f=[],_=[];return l.forEach(function(b,z){var O=!!b.scope,r=O?b.scope:b,H=CR(r,O),Z=O?i(b.candidates):r;H===0?O?f.push.apply(f,Z):f.push(r):_.push({documentOrder:z,tabIndex:H,item:b,isScope:O,content:Z})}),_.sort(z6).reduce(function(b,z){return z.isScope?b.push.apply(b,z.content):b.push(z.content),b},[]).concat(f)},H6=function(l,f){f=f||{};var _;return f.getShadowRoot?_=TR([l],f.includeContainer,{filter:Ww.bind(null,f),flatten:!1,getShadowRoot:f.getShadowRoot,shadowRootFilter:V6}):_=ER(l,f.includeContainer,Ww.bind(null,f)),U6(_)},W6=function(l,f){f=f||{};var _;return f.getShadowRoot?_=TR([l],f.includeContainer,{filter:wx.bind(null,f),flatten:!0,getShadowRoot:f.getShadowRoot}):_=ER(l,f.includeContainer,wx.bind(null,f)),_},vv=function(l,f){if(f=f||{},!l)throw new Error("No node provided");return am.call(l,bx)===!1?!1:Ww(f,l)},G6=wR.concat("iframe").join(","),N1=function(l,f){if(f=f||{},!l)throw new Error("No node provided");return am.call(l,G6)===!1?!1:wx(f,l)};/*!
* focus-trap 6.9.4
* @license MIT, https://github.com/focus-trap/focus-trap/blob/master/LICENSE
*/function xA(i,l){var f=Object.keys(i);if(Object.getOwnPropertySymbols){var _=Object.getOwnPropertySymbols(i);l&&(_=_.filter(function(b){return Object.getOwnPropertyDescriptor(i,b).enumerable})),f.push.apply(f,_)}return f}function bA(i){for(var l=1;l<arguments.length;l++){var f=arguments[l]!=null?arguments[l]:{};l%2?xA(Object(f),!0).forEach(function(_){q6(i,_,f[_])}):Object.getOwnPropertyDescriptors?Object.defineProperties(i,Object.getOwnPropertyDescriptors(f)):xA(Object(f)).forEach(function(_){Object.defineProperty(i,_,Object.getOwnPropertyDescriptor(f,_))})}return i}function q6(i,l,f){return l in i?Object.defineProperty(i,l,{value:f,enumerable:!0,configurable:!0,writable:!0}):i[l]=f,i}var wA=function(){var i=[];return{activateTrap:function(f){if(i.length>0){var _=i[i.length-1];_!==f&&_.pause()}var b=i.indexOf(f);b===-1||i.splice(b,1),i.push(f)},deactivateTrap:function(f){var _=i.indexOf(f);_!==-1&&i.splice(_,1),i.length>0&&i[i.length-1].unpause()}}}(),Z6=function(l){return l.tagName&&l.tagName.toLowerCase()==="input"&&typeof l.select=="function"},X6=function(l){return l.key==="Escape"||l.key==="Esc"||l.keyCode===27},Y6=function(l){return l.key==="Tab"||l.keyCode===9},SA=function(l){return setTimeout(l,0)},EA=function(l,f){var _=-1;return l.every(function(b,z){return f(b)?(_=z,!1):!0}),_},p_=function(l){for(var f=arguments.length,_=new Array(f>1?f-1:0),b=1;b<f;b++)_[b-1]=arguments[b];return typeof l=="function"?l.apply(void 0,_):l},xv=function(l){return l.target.shadowRoot&&typeof l.composedPath=="function"?l.composedPath()[0]:l.target},K6=function(l,f){var _=(f==null?void 0:f.document)||document,b=bA({returnFocusOnDeactivate:!0,escapeDeactivates:!0,delayInitialFocus:!0},f),z={containers:[],containerGroups:[],tabbableGroups:[],nodeFocusedBeforeActivation:null,mostRecentlyFocusedNode:null,active:!1,paused:!1,delayInitialFocusTimer:void 0},O,r=function(Le,Pe,rt){return Le&&Le[Pe]!==void 0?Le[Pe]:b[rt||Pe]},H=function(Le){return z.containerGroups.findIndex(function(Pe){var rt=Pe.container,at=Pe.tabbableNodes;return rt.contains(Le)||at.find(function(Qe){return Qe===Le})})},Z=function(Le){var Pe=b[Le];if(typeof Pe=="function"){for(var rt=arguments.length,at=new Array(rt>1?rt-1:0),Qe=1;Qe<rt;Qe++)at[Qe-1]=arguments[Qe];Pe=Pe.apply(void 0,at)}if(Pe===!0&&(Pe=void 0),!Pe){if(Pe===void 0||Pe===!1)return Pe;throw new Error("`".concat(Le,"` was specified but was not a node, or did not return a node"))}var lt=Pe;if(typeof Pe=="string"&&(lt=_.querySelector(Pe),!lt))throw new Error("`".concat(Le,"` as selector refers to no known node"));return lt},K=function(){var Le=Z("initialFocus");if(Le===!1)return!1;if(Le===void 0)if(H(_.activeElement)>=0)Le=_.activeElement;else{var Pe=z.tabbableGroups[0],rt=Pe&&Pe.firstTabbableNode;Le=rt||Z("fallbackFocus")}if(!Le)throw new Error("Your focus-trap needs to have at least one focusable element");return Le},te=function(){if(z.containerGroups=z.containers.map(function(Le){var Pe=H6(Le,b.tabbableOptions),rt=W6(Le,b.tabbableOptions);return{container:Le,tabbableNodes:Pe,focusableNodes:rt,firstTabbableNode:Pe.length>0?Pe[0]:null,lastTabbableNode:Pe.length>0?Pe[Pe.length-1]:null,nextTabbableNode:function(Qe){var lt=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0,Ct=rt.findIndex(function(Rt){return Rt===Qe});if(!(Ct<0))return lt?rt.slice(Ct+1).find(function(Rt){return vv(Rt,b.tabbableOptions)}):rt.slice(0,Ct).reverse().find(function(Rt){return vv(Rt,b.tabbableOptions)})}}}),z.tabbableGroups=z.containerGroups.filter(function(Le){return Le.tabbableNodes.length>0}),z.tabbableGroups.length<=0&&!Z("fallbackFocus"))throw new Error("Your focus-trap must have at least one container with at least one tabbable node in it at all times")},le=function nt(Le){if(Le!==!1&&Le!==_.activeElement){if(!Le||!Le.focus){nt(K());return}Le.focus({preventScroll:!!b.preventScroll}),z.mostRecentlyFocusedNode=Le,Z6(Le)&&Le.select()}},Te=function(Le){var Pe=Z("setReturnFocus",Le);return Pe||(Pe===!1?!1:Le)},pe=function(Le){var Pe=xv(Le);if(!(H(Pe)>=0)){if(p_(b.clickOutsideDeactivates,Le)){O.deactivate({returnFocus:b.returnFocusOnDeactivate&&!N1(Pe,b.tabbableOptions)});return}p_(b.allowOutsideClick,Le)||Le.preventDefault()}},ge=function(Le){var Pe=xv(Le),rt=H(Pe)>=0;rt||Pe instanceof Document?rt&&(z.mostRecentlyFocusedNode=Pe):(Le.stopImmediatePropagation(),le(z.mostRecentlyFocusedNode||K()))},fe=function(Le){var Pe=xv(Le);te();var rt=null;if(z.tabbableGroups.length>0){var at=H(Pe),Qe=at>=0?z.containerGroups[at]:void 0;if(at<0)Le.shiftKey?rt=z.tabbableGroups[z.tabbableGroups.length-1].lastTabbableNode:rt=z.tabbableGroups[0].firstTabbableNode;else if(Le.shiftKey){var lt=EA(z.tabbableGroups,function(gt){var ht=gt.firstTabbableNode;return Pe===ht});if(lt<0&&(Qe.container===Pe||N1(Pe,b.tabbableOptions)&&!vv(Pe,b.tabbableOptions)&&!Qe.nextTabbableNode(Pe,!1))&&(lt=at),lt>=0){var Ct=lt===0?z.tabbableGroups.length-1:lt-1,Rt=z.tabbableGroups[Ct];rt=Rt.lastTabbableNode}}else{var Nt=EA(z.tabbableGroups,function(gt){var ht=gt.lastTabbableNode;return Pe===ht});if(Nt<0&&(Qe.container===Pe||N1(Pe,b.tabbableOptions)&&!vv(Pe,b.tabbableOptions)&&!Qe.nextTabbableNode(Pe))&&(Nt=at),Nt>=0){var At=Nt===z.tabbableGroups.length-1?0:Nt+1,xt=z.tabbableGroups[At];rt=xt.firstTabbableNode}}}else rt=Z("fallbackFocus");rt&&(Le.preventDefault(),le(rt))},me=function(Le){if(X6(Le)&&p_(b.escapeDeactivates,Le)!==!1){Le.preventDefault(),O.deactivate();return}if(Y6(Le)){fe(Le);return}},_e=function(Le){var Pe=xv(Le);H(Pe)>=0||p_(b.clickOutsideDeactivates,Le)||p_(b.allowOutsideClick,Le)||(Le.preventDefault(),Le.stopImmediatePropagation())},Ie=function(){if(z.active)return wA.activateTrap(O),z.delayInitialFocusTimer=b.delayInitialFocus?SA(function(){le(K())}):le(K()),_.addEventListener("focusin",ge,!0),_.addEventListener("mousedown",pe,{capture:!0,passive:!1}),_.addEventListener("touchstart",pe,{capture:!0,passive:!1}),_.addEventListener("click",_e,{capture:!0,passive:!1}),_.addEventListener("keydown",me,{capture:!0,passive:!1}),O},Ne=function(){if(z.active)return _.removeEventListener("focusin",ge,!0),_.removeEventListener("mousedown",pe,!0),_.removeEventListener("touchstart",pe,!0),_.removeEventListener("click",_e,!0),_.removeEventListener("keydown",me,!0),O};return O={get active(){return z.active},get paused(){return z.paused},activate:function(Le){if(z.active)return this;var Pe=r(Le,"onActivate"),rt=r(Le,"onPostActivate"),at=r(Le,"checkCanFocusTrap");at||te(),z.active=!0,z.paused=!1,z.nodeFocusedBeforeActivation=_.activeElement,Pe&&Pe();var Qe=function(){at&&te(),Ie(),rt&&rt()};return at?(at(z.containers.concat()).then(Qe,Qe),this):(Qe(),this)},deactivate:function(Le){if(!z.active)return this;var Pe=bA({onDeactivate:b.onDeactivate,onPostDeactivate:b.onPostDeactivate,checkCanReturnFocus:b.checkCanReturnFocus},Le);clearTimeout(z.delayInitialFocusTimer),z.delayInitialFocusTimer=void 0,Ne(),z.active=!1,z.paused=!1,wA.deactivateTrap(O);var rt=r(Pe,"onDeactivate"),at=r(Pe,"onPostDeactivate"),Qe=r(Pe,"checkCanReturnFocus"),lt=r(Pe,"returnFocus","returnFocusOnDeactivate");rt&&rt();var Ct=function(){SA(function(){lt&&le(Te(z.nodeFocusedBeforeActivation)),at&&at()})};return lt&&Qe?(Qe(Te(z.nodeFocusedBeforeActivation)).then(Ct,Ct),this):(Ct(),this)},pause:function(){return z.paused||!z.active?this:(z.paused=!0,Ne(),this)},unpause:function(){return!z.paused||!z.active?this:(z.paused=!1,te(),Ie(),this)},updateContainerElements:function(Le){var Pe=[].concat(Le).filter(Boolean);return z.containers=Pe.map(function(rt){return typeof rt=="string"?_.querySelector(rt):rt}),z.active&&te(),this}},O.updateContainerElements(l),O},Bv={exports:{}},J6=Bv.exports,TA;function Q6(){return TA||(TA=1,function(i){(function(l,f,_){i.exports?i.exports=_():l[f]=_()})(J6,"subtag",function(){var l="",f=/^([a-zA-Z]{2,3})(?:[_-]+([a-zA-Z]{3})(?=$|[_-]+))?(?:[_-]+([a-zA-Z]{4})(?=$|[_-]+))?(?:[_-]+([a-zA-Z]{2}|[0-9]{3})(?=$|[_-]+))?/;function _(H){return H.match(f)||[]}function b(H){return _(H).filter(function(Z,K){return Z&&K})}function z(H){return H=_(H),{language:H[1]||l,extlang:H[2]||l,script:H[3]||l,region:H[4]||l}}function O(H,Z,K){Object.defineProperty(H,Z,{value:K,enumerable:!0})}function r(H,Z,K){function te(le){return _(le)[H]||l}O(te,"pattern",Z),O(z,K,te)}return r(1,/^[a-zA-Z]{2,3}$/,"language"),r(2,/^[a-zA-Z]{3}$/,"extlang"),r(3,/^[a-zA-Z]{4}$/,"script"),r(4,/^[a-zA-Z]{2}$|^[0-9]{3}$/,"region"),O(z,"split",b),z})}(Bv)),Bv.exports}var e$=Q6();const AR=lm(e$);var j1={exports:{}},CA;function t$(){return CA||(CA=1,function(i,l){var f=function(){var _={},b=Math.PI/180,z=180/Math.PI,O=6378137,r=20037508342789244e-9;function H(K){return Number(K)===K&&K%1!==0}function Z(K){if(K=K||{},this.size=K.size||256,this.expansion=K.antimeridian===!0?2:1,!_[this.size]){var te=this.size,le=_[this.size]={};le.Bc=[],le.Cc=[],le.zc=[],le.Ac=[];for(var Te=0;Te<30;Te++)le.Bc.push(te/360),le.Cc.push(te/(2*Math.PI)),le.zc.push(te/2),le.Ac.push(te),te*=2}this.Bc=_[this.size].Bc,this.Cc=_[this.size].Cc,this.zc=_[this.size].zc,this.Ac=_[this.size].Ac}return Z.prototype.px=function(K,te){if(H(te)){var le=this.size*Math.pow(2,te),Te=le/2,pe=le/360,ge=le/(2*Math.PI),fe=le,me=Math.min(Math.max(Math.sin(b*K[1]),-.9999),.9999),_e=Te+K[0]*pe,Ie=Te+.5*Math.log((1+me)/(1-me))*-ge;return _e>fe*this.expansion&&(_e=fe*this.expansion),Ie>fe&&(Ie=fe),[_e,Ie]}else{var Te=this.zc[te],me=Math.min(Math.max(Math.sin(b*K[1]),-.9999),.9999),_e=Math.round(Te+K[0]*this.Bc[te]),Ie=Math.round(Te+.5*Math.log((1+me)/(1-me))*-this.Cc[te]);return _e>this.Ac[te]*this.expansion&&(_e=this.Ac[te]*this.expansion),Ie>this.Ac[te]&&(Ie=this.Ac[te]),[_e,Ie]}},Z.prototype.ll=function(K,te){if(H(te)){var le=this.size*Math.pow(2,te),Te=le/360,pe=le/(2*Math.PI),ge=le/2,fe=(K[1]-ge)/-pe,me=(K[0]-ge)/Te,_e=z*(2*Math.atan(Math.exp(fe))-.5*Math.PI);return[me,_e]}else{var fe=(K[1]-this.zc[te])/-this.Cc[te],me=(K[0]-this.zc[te])/this.Bc[te],_e=z*(2*Math.atan(Math.exp(fe))-.5*Math.PI);return[me,_e]}},Z.prototype.bbox=function(K,te,le,Te,pe){Te&&(te=Math.pow(2,le)-1-te);var ge=[K*this.size,(+te+1)*this.size],fe=[(+K+1)*this.size,te*this.size],me=this.ll(ge,le).concat(this.ll(fe,le));return pe==="900913"?this.convert(me,"900913"):me},Z.prototype.xyz=function(K,te,le,Te){Te==="900913"&&(K=this.convert(K,"WGS84"));var pe=[K[0],K[1]],ge=[K[2],K[3]],fe=this.px(pe,te),me=this.px(ge,te),_e=[Math.floor(fe[0]/this.size),Math.floor((me[0]-1)/this.size)],Ie=[Math.floor(me[1]/this.size),Math.floor((fe[1]-1)/this.size)],Ne={minX:Math.min.apply(Math,_e)<0?0:Math.min.apply(Math,_e),minY:Math.min.apply(Math,Ie)<0?0:Math.min.apply(Math,Ie),maxX:Math.max.apply(Math,_e),maxY:Math.max.apply(Math,Ie)};if(le){var nt={minY:Math.pow(2,te)-1-Ne.maxY,maxY:Math.pow(2,te)-1-Ne.minY};Ne.minY=nt.minY,Ne.maxY=nt.maxY}return Ne},Z.prototype.convert=function(K,te){return te==="900913"?this.forward(K.slice(0,2)).concat(this.forward(K.slice(2,4))):this.inverse(K.slice(0,2)).concat(this.inverse(K.slice(2,4)))},Z.prototype.forward=function(K){var te=[O*K[0]*b,O*Math.log(Math.tan(Math.PI*.25+.5*K[1]*b))];return te[0]>r&&(te[0]=r),te[0]<-20037508342789244e-9&&(te[0]=-20037508342789244e-9),te[1]>r&&(te[1]=r),te[1]<-20037508342789244e-9&&(te[1]=-20037508342789244e-9),te},Z.prototype.inverse=function(K){return[K[0]*z/O,(Math.PI*.5-2*Math.atan(Math.exp(-K[1]/O)))*z]},Z}();i.exports=f}(j1)),j1.exports}var n$=t$();const r$=lm(n$);var i$=Object.defineProperty,o$=Object.defineProperties,s$=Object.getOwnPropertyDescriptors,MA=Object.getOwnPropertySymbols,a$=Object.prototype.hasOwnProperty,l$=Object.prototype.propertyIsEnumerable,AA=(i,l,f)=>l in i?i$(i,l,{enumerable:!0,configurable:!0,writable:!0,value:f}):i[l]=f,Ui=(i,l)=>{for(var f in l||(l={}))a$.call(l,f)&&AA(i,f,l[f]);if(MA)for(var f of MA(l))l$.call(l,f)&&AA(i,f,l[f]);return i},bu=(i,l)=>o$(i,s$(l)),s2=(i,l,f)=>{if(!l.has(i))throw TypeError("Cannot "+f)},ie=(i,l,f)=>(s2(i,l,"read from private field"),f?f.call(i):l.get(i)),$t=(i,l,f)=>{if(l.has(i))throw TypeError("Cannot add the same private member more than once");l instanceof WeakSet?l.add(i):l.set(i,f)},Vn=(i,l,f,_)=>(s2(i,l,"write to private field"),l.set(i,f),f),H_=(i,l,f)=>(s2(i,l,"access private method"),f),Cg=(i,l,f)=>new Promise((_,b)=>{var z=H=>{try{r(f.next(H))}catch(Z){b(Z)}},O=H=>{try{r(f.throw(H))}catch(Z){b(Z)}},r=H=>H.done?_(H.value):Promise.resolve(H.value).then(z,O);r((f=f.apply(i,l)).next())}),IA=document.implementation.createHTMLDocument();function hm(i,l){const f={};for(const[_,b]of Object.entries(l))f[_]=i.querySelector(b);return f}function c$(i){return Array.from(i.childNodes||[]).filter(l=>l.nodeType===Node.ELEMENT_NODE)}function Su(i){const l=document.createElement("template");return l.innerHTML=i,l.content.firstElementChild}function u$(i){const l=IA.createElement("style");return l.textContent=i,IA.head.appendChild(l),l.sheet}function h$(i){return window.getComputedStyle(i).display!=="none"}function yd(i,l){if(!i)return;Object.getOwnPropertyDescriptor(i.constructor.prototype,"value").set.call(i,l);const _=i;_._valueTracker&&_._valueTracker.setValue("");const b=new Event("input",{bubbles:!0});b.simulated=!0,i.dispatchEvent(b);const z=new Event("change",{bubbles:!0});z.simulated=!0,i.dispatchEvent(z)}function IR(i,l=!1){let f,_;const b=i.getBoundingClientRect();if(i.style.display==="none"||b.height===0&&b.width===0){const z=i.cloneNode(l);i.parentElement.appendChild(z),z.style.setProperty("display","block","important");const O=z.getBoundingClientRect();f=O.width,_=O.height,z.style.setProperty("display","none"),z.remove()}else f=b.width,_=b.height;return{height:Math.floor(_),width:Math.floor(f)}}function d$(i){const l=document.createElement("style");l.innerHTML=i,document.head.appendChild(l)}var f$=new RegExp("[_a-zA-Z]+[_a-zA-Z0-9-]*","g"),p$=new RegExp(`\\.${f$.source}`,"g"),m$=new RegExp("^\\s*(@(?:media|supports)[^{]*){(.*)}\\s*$");function Nv(i,l){return i.replace(p$,f=>"."+l(f.slice(1)))}function PR(i,l){const _=u$(i).cssRules;function b(O){if(O instanceof CSSStyleRule)return`${Nv(O.selectorText,l)} { ${O.style.cssText} }`;const r=m$.exec(O.cssText.split(`
`).join(""));if(r&&r.length>2){const H=r[1],Z=r[2];return`${H} { ${PR(Z,l)} }`}return O.cssText}let z="";for(const O of Array.from(_))z+=b(O)+`

`;return z.trim()}function PA(i,l){const f=Array.from(i.querySelectorAll("[class]"));f.push(i);for(const _ of f){const{classList:b}=_;for(const z of Array.from(b))b.remove(z),b.add(l(z))}return i}var a2=1.4;function RR(i,l,f=.5){const{center:_,zoom:b}=i.cameraForBounds(l),z=Math.max(b-f,0);return{center:_,zoom:z,speed:a2}}function kR(i){switch(i){case"street":return 15;case"neighborhood":case"postcode":case"locality":case"oaza":return 14;case"place":case"city":return 13;case"district":return 9;case"region":case"prefecture":return 6;case"country":return 4;default:return 16}}function zR(i,l){return`https://api.mapbox.com/styles/v1/${i}/${l}/static/`}var l2='<svg viewBox="0 0 18 18" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M3.8 3.8a1 1 0 0 1 1.4 0L9 7.58l3.8-3.8a1 1 0 1 1 1.4 1.42L10.42 9l3.8 3.8a1 1 0 0 1-1.42 1.4L9 10.42l-3.8 3.8a1 1 0 0 1-1.4-1.42L7.58 9l-3.8-3.8a1 1 0 0 1 0-1.4Z" fill="currentColor"/></svg>',LR='<svg viewBox="0 0 18 18" xmlns="http://www.w3.org/2000/svg"><path fill="#333" d="M4.4 4.4l.8.8c2.1-2.1 5.5-2.1 7.6 0l.8-.8c-2.5-2.5-6.7-2.5-9.2 0z"/><path opacity=".1" d="M12.8 12.9c-2.1 2.1-5.5 2.1-7.6 0-2.1-2.1-2.1-5.5 0-7.7l-.8-.8c-2.5 2.5-2.5 6.7 0 9.2s6.6 2.5 9.2 0 2.5-6.6 0-9.2l-.8.8c2.2 2.1 2.2 5.6 0 7.7z"/></svg>',g$=zR("mapbox","satellite-streets-v11"),_$="20d01",y$=["mapbox.com","mapbox.cn","tilestream.net"],v$=Su(`
<template>
  <div class="MapboxSearch">
    <div class="Label" role="label" aria-live="polite" aria-atomic="true">
    </div>
    <div class="Results" aria-hidden="true">
      <div class="ResultsList" role="listbox">
      </div>
      <div class="ResultsAttribution" aria-hidden="true">
        <a href="https://www.mapbox.com/search-service" target="_blank" tabindex="-1">
          Powered by Mapbox
        </a>
      </div>
    </div>
  </div>
</template>
`),x$=Su(`
<template>
  <div class="Suggestion" role="option" tabindex="-1">
    <div class="SuggestionIcon" aria-hidden="true"></div>
    <div class="SuggestionText">
      <div class="SuggestionName"></div>
      <div class="SuggestionDesc"></div>
    </div>
  </div>
</template>
`),b$=Su(`
<template>
  <div class="SearchBox">
    <div class="SearchIcon"></div>
    <input class="Input" type="text" />
    <div class="ActionIcon">
      <button aria-label="Clear" class="ClearBtn" type="button">${l2}</button>
      <div class="LoadingIcon">${LR}</div>
    </div>
  </div>
</template>
`),w$=Su(`
<template>
  <div class="Geocoder">
    <div class="SearchIcon"></div>
    <input class="Input" type="text" />
    <div class="ActionIcon">
      <button aria-label="Clear" class="ClearBtn" type="button">${l2}</button>
      <div class="LoadingIcon">${LR}</div>
    </div>
  </div>
</template>
`);function rm(){return"mbx"+new Xu().id.slice(0,8)}function Mg(i){try{return JSON.parse(i)}catch{return null}}function c2(i,l){if(i==null||l==null||typeof i!="object"||typeof l!="object")return i===l;const f=Object.keys(i),_=Object.keys(l);if(f.length!==_.length)return!1;for(const b of f)if(!c2(i[b],l[b]))return!1;return!0}function RA(i,l){const f=Math.pow(10,l);return Math.round(i*f)/f}function S$(i){return!!i.match(/localhost|[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}|::1|\.local|^$/gi)}function E$(i){return!!y$.some(l=>i.includes(l))}var v_,Jm,Qm,wp=class extends HTMLElement{constructor(){super(...arguments),$t(this,v_,rm()),$t(this,Jm,void 0),$t(this,Qm,i=>`${ie(this,v_)}--${i}`)}get template(){return null}get templateStyle(){return null}get templateUserStyle(){return null}clonedCallback(i,l){const f=z=>z.replace(i,l);PA(this,f);const _=Array.from(this.querySelectorAll("style"));for(const z of _)z.textContent=Nv(z.textContent,f);_.length&&Vn(this,Jm,_[_.length-1]);const b=Array.from(this.querySelectorAll(`[id^="${i}"]`));for(const z of b)z.id=z.id.replace(i,l)}connectedCallback(){if(this.childElementCount>0){const _=this.dataset.seed,b=ie(this,v_);_&&_!==b&&(this.clonedCallback(_,b),this.dataset.seed=b);return}this.dataset.seed=ie(this,v_);const i=this.template;if(i){const _=this.prepareTemplate(i);this.appendChild(_)}const l=this.templateStyle;if(l){const _=document.createElement("style");_.textContent=this.prepareCSS(l),this.appendChild(_)}const f=document.createElement("style");this.templateUserStyle&&(f.textContent=this.prepareCSS(this.templateUserStyle)),this.appendChild(f),Vn(this,Jm,f)}prepareTemplate(i){const l=i.content.firstElementChild;return PA(l.cloneNode(!0),ie(this,Qm))}prepareCSS(i){return PR(i,ie(this,Qm))}updateTemplateUserStyle(i){ie(this,Jm)&&(ie(this,Jm).textContent=this.prepareCSS(i))}querySelector(i){return super.querySelector(Nv(i,ie(this,Qm)))}querySelectorAll(i){return super.querySelectorAll(Nv(i,ie(this,Qm)))}addEventListener(i,l,f){super.addEventListener(i,l,f)}removeEventListener(i,l,f){super.removeEventListener(i,l,f)}dispatchEvent(i){return super.dispatchEvent(i)}};v_=new WeakMap;Jm=new WeakMap;Qm=new WeakMap;var T$='<?xml version="1.0" encoding="UTF-8" standalone="yes"?><svg viewBox="0 0 18 18" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M9 16A7 7 0 1 0 9 2a7 7 0 0 0 0 14ZM6.88 4.88a2.58 2.58 0 0 1 1.83-.75h1.08a2.58 2.58 0 0 1 2.59 2.58v.16c0 1-.53 1.94-1.4 2.46l-.56.34c-.27.16-.45.42-.52.71-.03.14-.14.25-.28.25H8.38a.23.23 0 0 1-.24-.25c.08-.91.59-1.74 1.38-2.21l.56-.34c.34-.2.54-.57.54-.96V6.7a.83.83 0 0 0-.83-.83H8.71a.83.83 0 0 0-.84.83v.18a.87.87 0 1 1-1.75 0V6.7c0-.69.28-1.34.76-1.83ZM10 13a1 1 0 1 1-2 0 1 1 0 0 1 2 0Z" fill="currentColor"/></svg>',C$='<svg width="48" height="56" fill="none" xmlns="http://www.w3.org/2000/svg"><g filter="url(#a)"><path d="m24 50.4 13.79-14.12a18.82 18.82 0 0 0 4.23-20.86 19.23 19.23 0 0 0-7.19-8.6 19.76 19.76 0 0 0-21.66 0c-3.21 2.11-5.71 5.1-7.19 8.6a18.82 18.82 0 0 0 4.23 20.86L24 50.4Z" fill="currentColor"/><path d="M37.26 35.75 24 49.34 10.75 35.76l-.01-.01A18.07 18.07 0 0 1 6.68 15.7a18.48 18.48 0 0 1 6.9-8.26 19 19 0 0 1 20.84 0 18.48 18.48 0 0 1 6.9 8.26 18.07 18.07 0 0 1-4.06 20.04Z" stroke="#fff" stroke-width="1.5"/></g><circle cx="24" cy="22.45" fill="#fff" r="5.85"/><defs><filter id="a" x=".5" y=".6" width="47" height="54.8" filterUnits="userSpaceOnUse" color-interpolation-filters="sRGB"><feFlood flood-opacity="0" result="BackgroundImageFix"/><feColorMatrix in="SourceAlpha" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0" result="hardAlpha"/><feOffset dy="1"/><feGaussianBlur stdDeviation="2"/><feColorMatrix values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.2 0"/><feBlend in2="BackgroundImageFix" result="effect1_dropShadow_17_871"/><feBlend in="SourceGraphic" in2="effect1_dropShadow_17_871" result="shape"/></filter></defs></svg>',M$=`<svg width="24" height="24" viewBox="0 0 18 18" fill="none" xmlns="http://www.w3.org/2000/svg">
  <path fill-rule="evenodd" clip-rule="evenodd" d="M1.08 14.94 5.625 3.06h1.17l-3.42 11.88H1.08Zm15.885 0L12.42 3.06h-1.17l3.42 11.88h2.295Zm-6.86-1.44H7.946l.128-2.61h1.912l.119 2.61Zm-.217-4.77H8.181l.088-1.8h1.537l.082 1.8ZM9.74 5.49h-1.4l.049-.99h1.306l.045.99Z" fill="currentColor" />
</svg>`,A$=`<!-- TODO: I'm not sure if the way I added the circle will "scale" properly, need to check that -->
<svg width="24" height="24" viewBox="0 0 18 18" xmlns="http://www.w3.org/2000/svg">
  <path fill="none" stroke="currentColor" stroke-width="1.5" d="M4 7a5 5 0 1 1 10 0c0 3.025-3.28 6.713-5 9-1.72-2.287-5-5.975-5-9z"></path>
    <circle cx="9" cy="7" r="2" fill="currentColor"></circle>
</svg>`,I$=`<svg viewBox="0 0 18 18" xmlns="http://www.w3.org/2000/svg">
  <path d="M7.4 2.5c-2.7 0-4.9 2.2-4.9 4.9s2.2 4.9 4.9 4.9c1 0 1.8-.2 2.5-.8l3.7 3.7c.2.2.4.3.8.3.7 0 1.1-.4 1.1-1.1 0-.3-.1-.5-.3-.8L11.4 10c.4-.8.8-1.6.8-2.5.1-2.8-2.1-5-4.8-5zm0 1.6c1.8 0 3.2 1.4 3.2 3.2s-1.4 3.2-3.2 3.2-3.3-1.3-3.3-3.1 1.4-3.3 3.3-3.3z"/>
</svg>`,P$="@mapbox/search-js-web",Gx="1.0.0-beta.25",R$=`https://api.mapbox.com/search-js/v${Gx}/img/style-toggle-satellite.jpg`,k$=`https://api.mapbox.com/search-js/v${Gx}/img/style-toggle-default.jpg`,z$=767,L$=`@media only screen and (max-width: ${z$}px)`,u2={variables:{unit:["mobile","16px","14px"],unitHeader:["mobile","24px","18px"],minWidth:"min(300px, 100vw)",spacing:"0.75em",padding:"0.5em 0.75em",paddingFooterLabel:"0.5em 0.75em",paddingModal:"1.25em",colorText:"rgba(0, 0, 0, 0.75)",colorPrimary:"#4264FB",colorSecondary:"#667F91",colorBackground:"#fff",colorBackgroundHover:"#f5f5f5",colorBackgroundActive:"#f0f0f0",colorBackdrop:"rgba(102, 127, 145, 0.3)",border:"none",borderRadius:"4px",boxShadow:`
      0 0 10px 2px rgba(0, 0, 0, 0.05),
      0 0 6px 1px rgba(0, 0, 0, 0.1),
      0 0 0 1px rgba(0, 0, 0, 0.1)
    `,lineHeight:"1.2em",fontFamily:`
      -apple-system, BlinkMacSystemFont,
      avenir next, avenir,
      segoe ui,
      helvetica neue, helvetica,
      Ubuntu, roboto, noto, arial, sans-serif
    `,fontWeight:"normal",fontWeightSemibold:"600",fontWeightBold:"bold",duration:"150ms",curve:"ease-out"},icons:{close:l2,question:T$,marker:C$,street:M$,addressMarker:A$,search:I$},images:{styleToggleDefault:k$,styleToggleSatellite:R$}};function Vc(i,l={}){const f=Ui(Ui({},u2.variables),l.variables||{});let _=l.cssText||"",b="";for(const[z,O]of Object.entries(f)){if(!Array.isArray(O)){b+=`--${z}: ${O};`;continue}if(O[0]!=="mobile"){const Z=JSON.stringify(O);throw new Error(`Unsupported expression in theme variables: ${z} ${Z}`)}const[,r,H]=O;_+=`${L$} { ${i} { --${z}: ${r} !important; } }`,b+=`--${z}: ${H};`}return _+`${i} { ${b} }`}function Gu(i,l={}){return Ui(Ui({},u2.icons),l.icons||{})[i]}function O$(i,l={}){return Ui(Ui({},u2.images),l.images||{})[i]}var eg,Gw,kA=class{constructor(i,l,f){$t(this,eg,void 0),$t(this,Gw,{placement:"bottom-start",flip:!1,offset:10}),this.update=()=>Cg(this,null,function*(){const _={placement:this.options.placement,middleware:[E6(this.options.offset),this.options.flip&&S6()].filter(Boolean)},{x:b,y:z}=yield P6(this.referenceEl,this.floatingEl,_);Object.assign(this.floatingEl.style,{left:`${b}px`,top:`${z}px`})}),this.referenceEl=i,this.floatingEl=l,Vn(this,eg,Ui(Ui({},ie(this,Gw)),f)),this.destroy=I6(this.referenceEl,this.floatingEl,this.update)}get options(){return ie(this,eg)}set options(i){Vn(this,eg,Ui(Ui({},ie(this,eg)),i))}};eg=new WeakMap;Gw=new WeakMap;var dm="*{box-sizing:border-box!important}[role=button]{cursor:pointer}.MapboxSearch{--width:0;display:none}.Results{background-color:var(--colorBackground);border:var(--border);border-radius:var(--borderRadius);box-shadow:var(--boxShadow);color:var(--colorText);font-family:var(--fontFamily);font-size:var(--unit);font-weight:var(--fontWeight);line-height:var(--lineHeight);min-width:var(--minWidth);overflow-y:auto;position:absolute;transform:translateZ(0);transition:visibility var(--duration);width:var(--width);z-index:1000}.Results:not([aria-hidden=true]){visibility:visible}.Results[aria-hidden=true]{animation:fadein var(--duration) var(--curve) reverse forwards;visibility:hidden}.Suggestion{align-items:center;display:flex;padding:var(--padding)}.Suggestion:hover{cursor:pointer}.Suggestion[aria-selected=true]{background-color:var(--colorBackgroundHover)}.Suggestion:active{background-color:var(--colorBackgroundActive)}.SuggestionName{font-weight:var(--fontWeightBold)}.SuggestionIcon{margin-right:6px}.SuggestionIcon[aria-hidden=true]{display:none}.ResultsAttribution{padding:var(--paddingFooterLabel)}.ResultsAttribution a{color:var(--colorSecondary)}.ResultsAttribution a:not(:hover){text-decoration:none}.ResultsList{list-style:none;margin:0;padding:0}.Label{display:none}.Geocoder,.SearchBox{background-color:var(--colorBackground);border:var(--border);border-radius:var(--borderRadius);box-shadow:var(--boxShadow);color:var(--colorText);font-family:var(--fontFamily);font-size:var(--unit);font-weight:var(--fontWeight);line-height:var(--lineHeight);padding:var(--padding);padding-bottom:0;padding-top:0;position:relative;width:100%}.SearchIcon{fill:#757575;left:.5em}.ActionIcon,.SearchIcon{bottom:0;height:20px;margin:auto 0;position:absolute;top:0;width:20px}.ActionIcon{right:.5em}.ActionIcon>button{background:none;border:none;color:inherit;cursor:pointer;font:inherit;height:100%;outline:inherit;padding:0;width:100%}.ActionIcon>button:hover{background:none!important}.ClearBtn{display:none}.ClearBtn:hover{color:#909090}.LoadingIcon{-moz-animation:rotate .8s cubic-bezier(.45,.05,.55,.95) infinite;-webkit-animation:rotate .8s cubic-bezier(.45,.05,.55,.95) infinite;animation:rotate .8s cubic-bezier(.45,.05,.55,.95) infinite;display:none;height:100%}@-webkit-keyframes rotate{0%{-webkit-transform:rotate(0);transform:rotate(0)}to{-webkit-transform:rotate(1turn);transform:rotate(1turn)}}@keyframes rotate{0%{-webkit-transform:rotate(0);transform:rotate(0)}to{-webkit-transform:rotate(1turn);transform:rotate(1turn)}}.Input{background-color:transparent;border:0;color:#404040;color:rgba(0,0,0,.75);font:inherit;height:36px;margin:0;overflow:hidden;padding:0 40px;text-overflow:ellipsis;white-space:nowrap;width:100%}.Input::-ms-clear{display:none}.Input:focus{border:thin dotted;border-radius:var(--borderRadius);box-shadow:none;color:#404040;color:rgba(0,0,0,.75);outline:0}mapbox-address-confirmation-feature[aria-hidden=true],mapbox-address-confirmation-no-feature[aria-hidden=true]{display:none}.MapboxAddressConfirmation{align-items:center;background-color:var(--colorBackdrop);bottom:0;display:flex;justify-content:center;left:0;position:fixed;right:0;top:0;transform:translateZ(0);z-index:1000}.MapboxAddressConfirmation:not([aria-hidden=true]){animation:fadein var(--duration) var(--curve) forwards;visibility:visible}.MapboxAddressConfirmation[aria-hidden=true]{visibility:hidden}.ContentFeature,.ContentNoFeature{width:var(--minWidth)}.Modal{background-color:var(--colorBackground);border:var(--border);border-radius:var(--borderRadius);box-shadow:var(--boxShadow);color:var(--colorText);font-family:var(--fontFamily);font-size:var(--unit);font-weight:var(--fontWeight);line-height:var(--lineHeight);padding:var(--paddingModal);width:100%}@media screen and (max-width:480px){.MapboxAddressConfirmation{align-items:flex-end}.ContentFeature,.ContentNoFeature{width:100%}.Modal{border-bottom-left-radius:0;border-bottom-right-radius:0}}.ModalHeader{align-items:center;color:var(--colorPrimary);display:flex;font-size:var(--unitHeader);font-weight:var(--fontWeightBold);margin-bottom:var(--spacing);user-select:none;width:100%}.ModalMap{height:calc(var(--minWidth)*9/16);margin-left:calc(var(--paddingModal)*-1);width:calc(100% + var(--paddingModal)*2)}.ModalMap[aria-hidden=true]{display:none}.Icon{height:var(--unitHeader);width:var(--unitHeader)}.Icon.IconClose{color:var(--colorSecondary)}.ModalHeaderTitle{flex:1;margin-left:.25em}.ModalFooter{color:var(--colorSecondary);margin-top:var(--spacing);text-align:center}.ModalFooter[aria-hidden=true]{display:none}.ModalSubheader{font-weight:var(--fontWeightBold);user-select:none}.ModalDescription{color:var(--colorPrimary)}.ModalAddress,.ModalSubheader{margin-bottom:var(--spacing)}.ModalAddress.ModalAddressApprove{color:var(--colorPrimary)}.Button{border-radius:var(--borderRadius);cursor:pointer;font-weight:var(--fontWeightSemibold);margin-top:var(--spacing);padding:var(--padding);text-align:center;user-select:none;width:100%}.Button[aria-hidden=true]{display:none}.Button.ButtonPrimary{background-color:var(--colorPrimary);color:var(--colorBackground)}.Button.ButtonSecondary{border:1px solid var(--colorSecondary);color:var(--colorSecondary)}@keyframes fadein{0%{opacity:0}to{opacity:1}}.MapboxAddressMinimap{font-family:var(--fontFamily);font-size:var(--unit);font-weight:var(--fontWeight);line-height:var(--lineHeight)}.MapboxAddressMinimap[aria-hidden=true]{display:none}.MinimapImageContainer{border-radius:var(--borderRadius);overflow:hidden}.MinimapImage{height:unset;max-height:unset;max-width:unset;position:relative;width:unset}.MinimapInnerFrame{border:var(--border);border-radius:inherit;height:inherit;left:0;overflow:hidden;position:absolute;top:0;width:inherit}.MinimapMarker{left:50%;position:absolute;top:50%}.MinimapMarker>svg{color:var(--colorPrimary);display:block!important}.MinimapAttributionLogo{bottom:0;left:0;margin:0 0 6px 6px;position:absolute}.MinimapAttributionLogo a{cursor:pointer;display:block;height:23px;width:88px}.MinimapAttributionText{background-color:hsla(0,0%,100%,.65);bottom:0;font:11px/16px Helvetica Neue,Arial,Helvetica,sans-serif;padding:0 5px;position:absolute;right:0}.MinimapAttributionText a{color:rgba(0,0,0,.75);text-decoration:none}.MinimapAttributionText a:hover{color:inherit;text-decoration:underline}.MinimapAttributionText a:not(:first-child){margin-left:3px}.MinimapStyleToggle{background-position:0;background-repeat:no-repeat;background-size:contain;border:2px solid #fff;border-radius:3px;box-shadow:var(--boxShadow);cursor:pointer;height:2em;position:absolute;right:var(--spacing);top:var(--spacing);width:2em}.MinimapFooter{color:var(--colorSecondary);font-family:var(--fontFamily);font-size:var(--unit);margin-top:var(--spacing)}.MinimapFooter[aria-hidden=true]{display:none}.MinimapEditButtons{bottom:26px;display:flex;font-family:var(--fontFamily);position:absolute;right:var(--spacing)}.MinimapEditButtons .Button{box-shadow:var(--boxShadow)}.MinimapButtonCancel{background-color:var(--colorBackground);margin-left:var(--spacing)}.draggable{cursor:move;cursor:grab}.draggable:active{cursor:grabbing}",Zo=class extends CustomEvent{constructor(i,l){super(i,{composed:!0,detail:l})}clone(i){const l=new Zo(this.type,this.detail);return i&&Object.defineProperty(l,"target",{value:i}),l}},D$="Type in 2 or more characters for results.",F$="When autocomplete results are available use up and down arrows to review and enter to select. Touch device users, explore by touch or with swipe gestures.",B$="No search results.",N$=(i,l,f)=>`${l} ${l===1?"result is":"results are"} available. ${i}. ${f} of ${l} is selected.`,j$=i=>`${i} ${i===1?"result is":"results are"} available. Use up and down arrows to review and enter to select. Touch device users, explore by touch or with swipe gestures.`;function OR(i){const l=i.currentTarget;(i.key===" "||i.key==="Enter")&&(i.preventDefault(),i.stopPropagation(),l.dispatchEvent(new MouseEvent("click",{bubbles:!0,composed:!0})))}var DR="search-listbox__description",h2=i=>{const l=document.createElement("div");l.setAttribute("aria-live","polite"),l.setAttribute("aria-atomic","true"),l.setAttribute("role","status"),l.setAttribute("style","border: 0px;clip: rect(0px, 0px, 0px, 0px);height: 1px;margin-bottom: -1px;margin-right: -1px;overflow: hidden;padding: 0px;position: absolute;white-space: nowrap;width: 1px;");const f=document.createElement("div");return f.setAttribute("id",`${i}--${DR}`),l.appendChild(f),l},zA=(i,l)=>{var f;const _=(f=document.body.querySelector(`[id="${l}--${DR}"]`))!=null?f:null;_&&(_.textContent=i)},$$=i=>{i.name=i.name+" address-search",i.setAttribute("data-lpignore","true")},V$=(i,l,f)=>{let _=null;const b=!l||l.length===0;if((i==null?void 0:i.length)<2)_=D$+" "+F$;else if(b)_=B$;else if(f!==void 0){const z=l[f],O=z.name||z.feature_name||z.properties.name;_=N$(O,l.length,f+1)}else _=j$(l.length);return _},qw=(i,l)=>{switch(l){case 0:return i.matching_name||i.feature_name||i.address_line1;case 2:return i.name;case 1:return i.properties.name;default:return""}},U$=(i,l)=>{switch(l){case 0:return i.description;case 2:return i.feature_type==="poi"?i.full_address:i.place_formatted;case 1:return i.properties.place_formatted;default:return""}};function $1(i,l){return`${i}-${l}`}var Xl,pc,x_,uf,b_,jv,w_,$v,Zw,Xw,FR,Vv,Uv,Hv,W_,S_,tg,Wv,my=class extends wp{constructor(){super(...arguments),$t(this,$v),$t(this,Xw),this.suggestions=null,$t(this,Xl,null),$t(this,pc,void 0),$t(this,x_,void 0),$t(this,uf,void 0),$t(this,b_,void 0),$t(this,jv,null),$t(this,w_,void 0),$t(this,Vv,{}),$t(this,Uv,{}),$t(this,Hv,i=>{const{Results:l}=ie(this,pc),f=i.target;if(f.dataset.mapboxSuccess){delete f.dataset.mapboxSuccess;return}const _=f.value;this.renderAriaMessage(),l.setAttribute("aria-busy","true"),this.dispatchEvent(new Zo("input",{lastInput:i.data,inputText:_}))}),this.renderAriaMessage=()=>{var i;const l=V$((i=this.input)==null?void 0:i.value,this.suggestions,this.selectedIndex);zA(l,this.dataset.seed)},this.clearAriaMessage=()=>{zA("",this.dataset.seed)},this.handleSuggest=i=>{if(this.suggestions=i,(!i||i.length===0)&&this.renderAriaMessage(),!i){this.hideResults();return}H_(this,Xw,FR).call(this),i.length&&H_(this,$v,Zw).call(this);const{Results:l}=ie(this,pc);l.setAttribute("aria-busy","false")},this.handleError=()=>{const{Results:i}=ie(this,pc);i.setAttribute("aria-busy","false"),this.hideResults()},$t(this,W_,(i,l)=>Cg(this,null,function*(){const f=this.input;f&&(f.dataset.mapboxSuccess="true");const _={suggestion:i,selectedIndex:l};this.dispatchEvent(new Zo("select",_)),this.hideResults()})),$t(this,S_,()=>{const i=this.input;delete i.dataset.mapboxSuccess,this.dispatchEvent(new Zo("focus")),this.renderAriaMessage(),H_(this,$v,Zw).call(this)}),$t(this,tg,()=>{document.activeElement!==this.input&&(this.dispatchEvent(new Zo("blur")),this.clearAriaMessage(),this.hideResults())}),this.handleArrowUp=()=>{this.selectedIndex===void 0?this.selectedIndex=this.suggestions.length-1:this.selectedIndex===0?this.selectedIndex=void 0:this.selectedIndex=Math.max(0,this.selectedIndex-1)},this.handleArrowDown=()=>{this.selectedIndex===void 0?this.selectedIndex=0:this.selectedIndex===this.suggestions.length-1?this.selectedIndex=void 0:this.selectedIndex=Math.min(this.selectedIndex+1,this.suggestions.length-1)},$t(this,Wv,i=>{var l;if((l=this.suggestions)!=null&&l.length){if(i.key==="ArrowDown"){i.preventDefault(),this.handleArrowDown();return}if(i.key==="ArrowUp"){i.preventDefault(),this.handleArrowUp();return}if(i.key==="Escape"){this.hideResults();return}if(this.selectedIndex!==void 0){if(i.key==="Tab"){ie(this,W_).call(this,this.suggestions[this.selectedIndex],this.selectedIndex);return}if(i.key==="Enter"){i.preventDefault(),ie(this,W_).call(this,this.suggestions[this.selectedIndex],this.selectedIndex);return}}}})}get template(){return v$}get templateStyle(){return dm}get templateUserStyle(){return Vc(".MapboxSearch",this.theme)}get input(){return ie(this,b_)}set input(i){const l=ie(this,b_);l&&(l.removeEventListener("input",ie(this,Hv)),l.removeEventListener("focus",ie(this,S_)),l.removeEventListener("blur",ie(this,tg)),l.removeEventListener("keydown",ie(this,Wv)),ie(this,Xl)&&ie(this,Xl).destroy()),i&&(i.addEventListener("input",ie(this,Hv)),i.addEventListener("focus",ie(this,S_)),i.addEventListener("blur",ie(this,tg)),i.addEventListener("keydown",ie(this,Wv)),i.setAttribute("role","combobox"),i.setAttribute("aria-autocomplete","list"),i.setAttribute("aria-controls",ie(this,uf)),this.isConnected&&Vn(this,Xl,new kA(i,ie(this,pc).Results,this.popoverOptions))),Vn(this,b_,i)}get searchService(){return ie(this,jv)}set searchService(i){Vn(this,jv,i)}get selectedIndex(){return ie(this,w_)}set selectedIndex(i){const l=ie(this,w_);Vn(this,w_,i);const{ResultsList:f}=ie(this,pc),_=$1(ie(this,uf),i);if(i!==void 0?(this.input.setAttribute("aria-activedescendant",_),f.setAttribute("aria-activedescendant",_)):(this.input.removeAttribute("aria-activedescendant"),f.removeAttribute("aria-activedescendant")),l!==i){const b=$1(ie(this,uf),l),z=f.querySelector(`#${b}`);if(z==null||z.removeAttribute("aria-selected"),z==null||z.setAttribute("tabindex","-1"),i!==void 0){const O=f.querySelector(`#${_}`);O==null||O.setAttribute("aria-selected","true"),O==null||O.setAttribute("tabindex","0")}}this.renderAriaMessage()}hideResults(){const{Results:i,ResultsList:l}=ie(this,pc);i.setAttribute("aria-hidden","true"),this.input.setAttribute("aria-expanded","false"),l.removeAttribute("aria-activedescendant"),this.input.removeAttribute("aria-activedescendant")}renderItem(i){const l=this.prepareTemplate(x$);return l.id=$1(ie(this,uf),i),l}fillItem(i,l,f,_){const b=i.querySelector('[class$="SuggestionIcon"]'),z=i.querySelector('[class$="SuggestionName"]'),O=i.querySelector('[class$="SuggestionDesc"]');this.searchService===0?(b.innerHTML=Gu(l.accuracy==="street"?"street":"addressMarker",this.theme),b.removeAttribute("aria-hidden")):b.setAttribute("aria-hidden","true"),z.textContent=O.textContent="",z.textContent=qw(l,this.searchService),O.textContent=U$(l,this.searchService),f===this.selectedIndex?i.setAttribute("aria-selected","true"):i.removeAttribute("aria-selected"),i.setAttribute("aria-posinset",(f+1).toString()),i.setAttribute("aria-setsize",_.toString())}get theme(){return ie(this,Vv)}set theme(i){Vn(this,Vv,i),!(!ie(this,pc)||!i)&&this.updateTemplateUserStyle(Vc(".MapboxSearch",i))}get popoverOptions(){return ie(this,Uv)}set popoverOptions(i){Vn(this,Uv,i),ie(this,Xl)&&(ie(this,Xl).options=i,ie(this,Xl).update())}connectedCallback(){super.connectedCallback(),this.dataSeed=this.dataset.seed,Vn(this,x_,this.dataset.seed+"-Label"),Vn(this,uf,this.dataset.seed+"-ResultsList"),this.input&&this.input.setAttribute("aria-controls",ie(this,uf)),Vn(this,pc,hm(this,{MapboxSearch:".MapboxSearch",Results:".Results",ResultsList:".ResultsList",Label:".Label"}));const{Results:i,ResultsList:l,Label:f}=ie(this,pc);f.id=ie(this,x_),l.id=ie(this,uf),l.setAttribute("aria-labelledby",ie(this,x_)),i.addEventListener("blur",ie(this,tg)),!ie(this,Xl)&&this.input&&Vn(this,Xl,new kA(this.input,ie(this,pc).Results,this.popoverOptions)),requestAnimationFrame(()=>{ie(this,Xl)&&ie(this,Xl).update()})}disconnectedCallback(){this.input=null;const{Results:i}=ie(this,pc);i.removeEventListener("blur",ie(this,tg)),ie(this,Xl)&&ie(this,Xl).destroy()}focus(){document.activeElement===this.input?ie(this,S_).call(this):this.input.focus()}blur(){this.input.blur()}updatePopover(){ie(this,Xl)&&ie(this,Xl).update()}};Xl=new WeakMap;pc=new WeakMap;x_=new WeakMap;uf=new WeakMap;b_=new WeakMap;jv=new WeakMap;w_=new WeakMap;$v=new WeakSet;Zw=function(){if(!this.suggestions||!this.suggestions.length)return;const{Results:i,MapboxSearch:l}=ie(this,pc),f=this.input.getBoundingClientRect();l.style.setProperty("--width",`${f.width}px`),l.style.setProperty("display","block"),this.input.setAttribute("aria-expanded","true"),i.removeAttribute("aria-hidden"),this.selectedIndex=void 0};Xw=new WeakSet;FR=function(){const{ResultsList:i}=ie(this,pc);if(!this.suggestions||!this.suggestions.length){i.innerHTML="",this.hideResults();return}const l=c$(i);if(this.suggestions.length>l.length)for(let f=l.length;f<this.suggestions.length;f++){const _=this.renderItem(f);l.push(_),_.onmouseenter=()=>{this.selectedIndex=f},_.onmouseleave=()=>{this.selectedIndex=void 0},i.appendChild(_)}if(this.suggestions.length<l.length)for(let f=this.suggestions.length;f<l.length;f++)l[f].remove();for(let f=0;f<this.suggestions.length;f++){const _=this.suggestions[f],b=l[f];this.fillItem(b,_,f,this.suggestions.length),b.onclick=()=>{ie(this,W_).call(this,_,f)}}};Vv=new WeakMap;Uv=new WeakMap;Hv=new WeakMap;W_=new WeakMap;S_=new WeakMap;tg=new WeakMap;Wv=new WeakMap;window.MapboxSearchListbox=my;window.customElements.get("mapbox-search-listbox")||customElements.define("mapbox-search-listbox",my);var H$=new Set(["street-address","address-line1","address-line2","address-line3","address-level4","address-level3","address-level2","address-level1","country","country-name","postal-code"]),W$=new Set(["off","on","true","false"]);function BR(i){let l=i.parentNode;for(;l;){if(l instanceof HTMLFormElement)return l;l=l.parentNode}return null}function G$(i){const l=i||document;return Array.from(l.querySelectorAll('input[autocomplete~="address-line1"], input[autocomplete~="street-address"]'))}var q$="section-",Z$="section-default",X$="section-shipping",Y$="section-billing";function d2(i){const l=Array.from(i.querySelectorAll("[autocomplete]")).filter(_=>{const b=_.tagName.toLowerCase();return b==="input"||b==="select"||b==="textarea"}),f=[];for(const _ of l){if(!h$(_))continue;const b=_.getAttribute("autocomplete")||"";if(!b||W$.has(b))continue;const z=b.toLowerCase().split(" ");if(z.length>3)continue;const O=z[z.length-1];if(!H$.has(O))continue;z.pop();let r=Z$;if(z.length){const H=z[z.length-1];H==="shipping"&&(r=X$,z.pop()),H==="billing"&&(r=Y$,z.pop())}if(z.length){const H=z[z.length-1];H.startsWith(q$)&&(r=H)}f.push({input:_,section:r,field:O})}return f}function gy(i,l){const f=[],_=[],b=d2(i);let z=null;for(const{input:O,section:r,field:H}of b){let Z=f.length-1,K=!1;if(f.length?(_[Z]!==r||f[Z][H])&&(K=!0):K=!0,K){if(z)break;f.push({[H]:O}),_.push(r),Z++}else f[Z][H]=O;O===l&&(z=f[Z])}return z??{}}function NR(i,l,f){var _;const b=gy(i,l),z=[f.address_line1,f.address_line2,f.address_line3].filter(r=>!!r).join(", ");yd(b["street-address"],b["address-line2"]?f.address_line1||"":z),yd(b["address-line1"],f.address_line1||""),yd(b["address-line2"],f.address_line2||""),yd(b["address-level1"],f.address_level1||""),yd(b["address-level2"],f.address_level2||""),yd(b["address-level3"],f.address_level3||"");const O=f.country_code||((_=f.metadata)==null?void 0:_.iso_3166_1)||"";if(b.country&&b.country instanceof HTMLSelectElement){let r=b.country.querySelector("option").value;r===""&&(r=b.country.querySelectorAll("option")[1].value);const H=r===r.toUpperCase();yd(b.country,H?O.toUpperCase():O)}else yd(b.country,O);yd(b["country-name"],f.country||""),yd(b["postal-code"],f.postcode||"")}function K$(i,l){const f=gy(i,l),_={};for(const[b,z]of Object.entries(f))z!=null&&z.value&&(_[b]=z.value);return _}function jR(i){const l=[];return i["street-address"]?l.push(i["street-address"]):l.push(i["address-line1"]||""),l.push(i["address-line2"]||""),l.push(i["address-line3"]||""),l.push(i["address-level3"]||""),l.push(i["address-level2"]||""),l.push(i["address-level1"]||""),l.push(i["postal-code"]||""),i["country-name"]?l.push(i["country-name"]):l.push(i.country||""),l.filter(f=>!!f).map(f=>f.trim()).join(", ")}function $R(i,l){const f=BR(l);if(!f)return;const _=n2(i);NR(f,l,_);const b=gy(f,l);b["address-line2"]&&!_.address_line2&&b["address-line2"].focus()}function J$(i){var l;const f={},_=[i.properties.address_line1,i.properties.address_line2,i.properties.address_line3].filter(b=>!!b).join(", ");return f["street-address"]=_,f["address-line1"]=i.properties.address_line1,f["address-line2"]=i.properties.address_line2,f["address-line3"]=i.properties.address_line3,f["address-level1"]=i.properties.address_level1,f["address-level2"]=i.properties.address_level2,f["address-level3"]=i.properties.address_level3,f.country=(l=i.properties.metadata)==null?void 0:l.iso_3166_1,f["country-name"]=i.properties.country,f["postal-code"]=i.properties.postcode,f}function Q$(i,l){for(const[f,_]of Object.entries(i))if(l[f]!==_)return!0;return!1}var eV=i=>i.filter((l,f,_)=>{const b=qw(l,0);return l.accuracy!=="street"||_.findIndex(z=>b===qw(z,0))===f}),_g=(i,l,f)=>{const z=f?l||"address-line1":"new-password";i&&(i.autocomplete=z)},tV=(i,l,f)=>{if(!i||!f)return;_g(i,l,!0);const _={properties:bu(Ui({},f),{address_line1:f.address_line1+" ",postcode:null})};$R(_,i),_g(i,l,!1),i==null||i.focus()},nV=class{constructor(){this.feedbackEnabled=!0,this.autofillSessionToken=new Xu,this.autofillSessionEnabled=!1,this.detectBrowserAutofillEnabled=!1}},Lh=new nV;Object.defineProperty(Lh,"autofillSessionToken",{configurable:!1,writable:!1});var rV=Su(`
<template>
  <div class="MapboxAddressConfirmation" aria-hidden="true">
    <mapbox-address-confirmation-feature class="ContentFeature"></mapbox-address-confirmation-feature>
    <mapbox-address-confirmation-no-feature class="ContentNoFeature"></mapbox-address-confirmation-no-feature>
  </div>
</template>
`),Gv,Wu,ng,qv,f2=class extends wp{constructor(){super(...arguments),$t(this,Gv,!1),$t(this,Wu,void 0),$t(this,ng,void 0),$t(this,qv,{})}get template(){return rV}get templateStyle(){return dm}get templateUserStyle(){return Vc(".MapboxAddressConfirmation",this.theme)}get theme(){return ie(this,qv)}set theme(i){if(Vn(this,qv,i),!ie(this,Wu)||!i)return;this.updateTemplateUserStyle(Vc(".MapboxAddressConfirmation",i));const{ContentFeature:l,ContentNoFeature:f}=ie(this,Wu);l.theme=i,f.theme=i}connectedCallback(){super.connectedCallback(),Vn(this,Wu,hm(this,{MapboxAddressConfirmation:".MapboxAddressConfirmation",ContentFeature:".ContentFeature",ContentNoFeature:".ContentNoFeature"}));const{MapboxAddressConfirmation:i}=ie(this,Wu);i.setAttribute("aria-hidden","true");const l=this.theme;if(l){const{ContentFeature:f,ContentNoFeature:_}=ie(this,Wu);f.theme=l,_.theme=l}}disconnectedCallback(){Vn(this,ng,null)}hide(){var i;if(Vn(this,Gv,!1),!ie(this,Wu))return;const{MapboxAddressConfirmation:l}=ie(this,Wu);l.setAttribute("aria-hidden","true"),(i=ie(this,ng))==null||i.deactivate(),yA.off()}show(i,l,f){return Cg(this,null,function*(){var _;if(!ie(this,Wu))return{type:"cancel"};const{MapboxAddressConfirmation:b,ContentFeature:z,ContentNoFeature:O}=ie(this,Wu),{accessToken:r,minimap:H=!1,theme:Z,footer:K}=l;this.theme=Z,f?(z.removeAttribute("aria-hidden"),O.setAttribute("aria-hidden","true"),z.minimap=H,z.accessToken=r,z.footer=K,z.update(f,i)):(z.setAttribute("aria-hidden","true"),O.removeAttribute("aria-hidden"),O.update(i)),Vn(this,Gv,!0),b.removeAttribute("aria-hidden"),yA.on();const te=f?z:O;return Vn(this,ng,K6(b,{fallbackFocus:te,escapeDeactivates:()=>(this.hide(),!0)})),(_=ie(this,ng))==null||_.activate(),new Promise(le=>{const Te=te,pe=ge=>{Te.removeEventListener("result",pe);const fe=ge.detail;this.hide(),le(fe==="change"?{type:"change",feature:f}:{type:fe})};Te.addEventListener("result",pe)})})}tryShow(i,l){return Cg(this,null,function*(){if(!ie(this,Wu))return{type:"cancel"};const{accessToken:f,options:_={}}=l,b=new hR(Ui({accessToken:f},_)),z=jR(i),r=(yield b.validate(z,{sessionToken:Lh.autofillSessionToken})).features[0];if(r){const H=K=>K.properties.match_code.confidence===fR.exact,{skipConfirmModal:Z=H}=l;if(Z(r))return{type:"nochange"}}return yield this.show(i,l,r)})}};Gv=new WeakMap;Wu=new WeakMap;ng=new WeakMap;qv=new WeakMap;window.MapboxAddressConfirmation=f2;window.customElements.get("mapbox-address-confirmation")||customElements.define("mapbox-address-confirmation",f2);var V1=new f2;function iV(i){return Cg(this,arguments,function*(l,f={}){var _;const{sections:b=[]}=f;V1.parentNode||document.body.appendChild(V1);let z={type:"nochange"};const O=G$(l),r=d2(l),H=Array.from(document.querySelectorAll("mapbox-search-listbox"));for(const Z of O){if(b.length){const ge=r.find(fe=>fe.input===Z);if(!ge||!b.includes(ge.section))continue}const K=K$(l,Z),te=H.find(ge=>ge.input===Z),le=te==null?void 0:te.autofillHost;if(le){const ge=le.retrieveFeature;if(ge){const fe=J$(ge);if(!Q$(K,fe))continue}}const Te=f.accessToken||Lh.accessToken,pe=yield V1.tryShow(K,bu(Ui({},f),{accessToken:Te}));if(pe.type==="change"){const ge=gy(l,Z);if((_=ge["address-line2"])!=null&&_.value&&(pe.feature.properties.address_line2=ge["address-line2"].value),te)le.simulateRetrieve(pe.feature);else{Z.dataset.mapboxSuccess="true";const fe=n2(pe.feature);NR(l,Z,fe)}}pe.type==="change"&&z.type!=="cancel"&&(z=pe),pe.type==="cancel"&&(z=pe)}return z})}function VR(i,l,f,_,b){if(l){const z=Su(`
        <span>
          <span></span>
          <br />
          <span></span>
        </span>
      `),[O,r]=Array.from(z.querySelectorAll("span > span"));if(f&&_)O.textContent=f,r.textContent=_;else{const H=l.split(",");O.textContent=H[0].trim(),r.textContent=H.slice(1).join(",").trim()}if(!b){if(i["address-line2"]){const H=document.createElement("span");H.textContent=i["address-line2"],z.insertBefore(H,r),z.insertBefore(document.createElement("br"),r)}if(i["address-line3"]){const H=document.createElement("span");H.textContent=i["address-line3"],z.insertBefore(H,r),z.insertBefore(document.createElement("br"),r)}}return z}else{const z=i["street-address"]||i["address-line1"]||"",O=i["address-line2"],r=i["address-line3"],H=[i["address-level4"]||"",i["address-level3"]||"",i["address-level2"]||"",`${i["address-level1"]||""} ${i["postal-code"]||""}`,i.country||i["country-name"]||""].filter(Boolean).join(", "),K=[z,O,r,H].filter(Boolean).map(le=>`<span>${le}</span>`).join("<br />");return Su(`
        <span>${K}</span>
      `)}}function oV(i,l,f,_){return Cg(this,null,function*(){if(!f)return;const b=BR(i),z=Object.values(gy(b,i));if(!l.detail.elements.some(le=>z.includes(le)))return;const O=d2(b),H=O.find(le=>le.input===i).section,Z=Array.from(new Set(O.filter(le=>l.detail.elements.includes(le.input)).map(le=>le.section)));if(!Z.includes(H))return;const K=typeof f=="object"&&f.sections||[];if(K.length&&!K.some(le=>Z.includes(le)))return;let te=typeof f=="object"?f:{};te=bu(Ui({},te),{accessToken:_,sections:[H]}),yield iV(b,te)})}var sV="https://contribute-api.mapbox.com/v1",aV="https://contribute-api-staging.tilestream.net/v1",lV="edit-suggestion";function UR(i,l){if(!Lh.feedbackEnabled)return;const f=window.location.hostname,b=`${S$(f)||E$(f)?aV:sV}/${lV}/address?access_token=${i}`,{originalCoordinate:z,originalAddress:O,changes:r}=l,H={action:"update",reason:"incorrect_address",location:{longitude:z[0],latitude:z[1]},userEmail:"no-reply-autofill@mapbox.com",changes:r,placeName:O};fetch(b,{method:"POST",headers:new Headers({"User-Agent":`mapbox-search-js.${Gx}.${navigator.userAgent}`,"Content-Type":"application/json"}),body:JSON.stringify(H)})}var cV=Su(`
<template>
  <div class="MapboxAddressConfirmationFeature">
    <div class="Modal" aria-modal="true" role="dialog">
      <div class="ModalHeader">
        <svg viewBox="0 0 18 18" class="Icon IconQuestion"></svg>
        <div class="ModalHeaderTitle">Did you mean?</div>
        <svg
          viewBox="0 0 18 18"
          class="Icon IconClose"
          tabindex="0"
          role="button"
          title="Close"
          aria-label="Close"
          aria-expanded="true"
        ></svg>
      </div>

      <div class="ModalAddress ModalAddressApprove"></div>
            
      <div class="ModalMap">
        <mapbox-address-minimap class="Minimap"></mapbox-address-minimap>
      </div>

      <div
        class="Button ButtonPrimary ButtonApprove"
        tabindex="0"
        role="button"
        aria-label="Yes"
      >
        Yes
      </div>
      
      <div
        class="Button ButtonSecondary ButtonReject"
        tabindex="0"
        role="button"
        aria-label="No, use the address I provided"
      >
        No, use the address I provided
      </div>

      <div class="ModalFooter">
          Your confirmation helps improve address data accuracy.
      </div>
    </div>
  </div>
</template>
`),hf,Zv,E_,Xv,Yv,Kv,Jv,Qv,HR=class extends wp{constructor(){super(...arguments),$t(this,hf,void 0),$t(this,Zv,{}),this.minimap=!1,$t(this,E_,void 0),$t(this,Xv,void 0),this.update=(i,l)=>{var f;Vn(this,E_,i),Vn(this,Xv,l);const{ModalMap:_,Minimap:b,ModalAddressApprove:z}=ie(this,hf);if(this.minimap){if(_.removeAttribute("aria-hidden"),b.accessToken=this.accessToken,typeof this.minimap=="object"){const{defaultMapStyle:r,theme:H,mapStyleMode:Z,satelliteToggle:K}=this.minimap;r&&(b.defaultMapStyle=this.minimap.defaultMapStyle),H&&(b.theme=this.minimap.theme),Z&&(b.mapStyleMode=Z),K!==void 0&&(b.satelliteToggle=K)}b.feature=i}else _.setAttribute("aria-hidden","true");const O=i.properties.place_name||i.properties.full_address||i.properties.address;z.innerHTML="",z.appendChild(VR(l,O,i.properties.feature_name,i.properties.description,((f=i.properties.place_type)==null?void 0:f[0])==="secondary_address"))},$t(this,Yv,()=>{this.dispatchEvent(new Zo("result","cancel"))}),this.approve=()=>{this.dispatchEvent(new Zo("result","change"))},this.reject=()=>{this.dispatchEvent(new Zo("result","nochange")),UR(this.accessToken,{originalCoordinate:ie(this,E_).geometry.coordinates,originalAddress:ie(this,E_).properties.full_address,changes:{address:jR(ie(this,Xv))}})},$t(this,Kv,rm()),$t(this,Jv,rm()),$t(this,Qv,rm())}get template(){return cV}get templateStyle(){return dm}get templateUserStyle(){return Vc(".MapboxAddressConfirmationFeature",this.theme)}get theme(){return ie(this,Zv)}set theme(i){if(Vn(this,Zv,i),!ie(this,hf)||!i)return;this.updateTemplateUserStyle(Vc(".MapboxAddressConfirmationFeature",i));const{IconQuestion:l,IconClose:f}=ie(this,hf);l.innerHTML=Gu("question",i),f.innerHTML=Gu("close",i)}set footer(i){if(i===void 0)return;const l=this.querySelector(".ModalFooter");typeof i=="string"?(l.textContent=i,l.removeAttribute("aria-hidden")):i?l.removeAttribute("aria-hidden"):l.setAttribute("aria-hidden","true")}connectedCallback(){super.connectedCallback(),Vn(this,hf,hm(this,{MapboxAddressConfirmationFeature:".MapboxAddressConfirmationFeature",Modal:".Modal",ModalHeaderTitle:".ModalHeaderTitle",ModalMap:".ModalMap",Minimap:".Minimap",IconQuestion:".IconQuestion",IconClose:".IconClose",ButtonApprove:".ButtonApprove",ButtonReject:".ButtonReject",ModalAddressApprove:".ModalAddressApprove"}));const{Modal:i,ModalHeaderTitle:l,IconClose:f,ButtonApprove:_,ButtonReject:b,ModalAddressApprove:z}=ie(this,hf);i.setAttribute("aria-labelledby",ie(this,Jv)),i.setAttribute("aria-describedby",ie(this,Qv)),f.setAttribute("aria-controls",ie(this,Kv)),i.id=ie(this,Kv),l.id=ie(this,Jv),z.id=ie(this,Qv);const O=Array.from(this.querySelectorAll('[role="button"]'));for(const H of O)H.addEventListener("keydown",OR);f.addEventListener("click",ie(this,Yv)),_.addEventListener("click",this.approve),b.addEventListener("click",this.reject);const r=this.theme;if(r){const{IconQuestion:H,IconClose:Z}=ie(this,hf);H.innerHTML=Gu("question",r),Z.innerHTML=Gu("close",r)}}disconnectedCallback(){const{IconClose:i,ButtonApprove:l}=ie(this,hf);i.removeEventListener("click",ie(this,Yv)),l.removeEventListener("click",this.approve)}};hf=new WeakMap;Zv=new WeakMap;E_=new WeakMap;Xv=new WeakMap;Yv=new WeakMap;Kv=new WeakMap;Jv=new WeakMap;Qv=new WeakMap;window.MapboxAddressConfirmationFeature=HR;window.customElements.get("mapbox-address-confirmation-feature")||customElements.define("mapbox-address-confirmation-feature",HR);var uV=Su(`
<template>
  <div class="MapboxAddressConfirmationNoFeature">
    <div class="Modal" aria-modal="true" role="dialog">
      <div class="ModalHeader">
        <svg viewBox="0 0 18 18" class="Icon IconQuestion"></svg>
        <div class="ModalHeaderTitle">Confirm address</div>
        <svg
          viewBox="0 0 18 18"
          class="Icon IconClose"
          tabindex="0"
          role="button"
          title="Close"
          aria-label="Close"
          aria-expanded="true"
        ></svg>
      </div>
      <div class="ModalDescription">
        We couldn't verify this address. Please check that your information is correct before continuing.
      </div>
      <br />
      <div class="ModalSubheader">
        You entered
      </div>
      <div class="ModalAddress"></div>
      <div
        class="Button ButtonPrimary"
        tabindex="0"
        role="button"
        aria-label="Use the address I provided"
      >
        Use the address I provided
      </div>
    </div>
  </div>
</template>
`),df,e0,t0,n0,r0,i0,WR=class extends wp{constructor(){super(...arguments),$t(this,df,void 0),$t(this,e0,{}),this.update=i=>{const{ModalAddress:l}=ie(this,df);l.innerHTML="",l.appendChild(VR(i))},$t(this,t0,()=>{this.dispatchEvent(new Zo("result","cancel"))}),this.reject=()=>{this.dispatchEvent(new Zo("result","nochange"))},$t(this,n0,rm()),$t(this,r0,rm()),$t(this,i0,rm())}get template(){return uV}get templateStyle(){return dm}get templateUserStyle(){return Vc(".MapboxAddressConfirmationNoFeature",this.theme)}get theme(){return ie(this,e0)}set theme(i){if(Vn(this,e0,i),!ie(this,df)||!i)return;this.updateTemplateUserStyle(Vc(".MapboxAddressConfirmationNoFeature",i));const{IconQuestion:l,IconClose:f}=ie(this,df);l.innerHTML=Gu("question",i),f.innerHTML=Gu("close",i)}connectedCallback(){super.connectedCallback(),Vn(this,df,hm(this,{Modal:".Modal",ModalHeaderTitle:".ModalHeaderTitle",IconQuestion:".IconQuestion",IconClose:".IconClose",ModalAddress:".ModalAddress",ButtonReject:".Button"}));const{Modal:i,ModalHeaderTitle:l,IconClose:f,ModalAddress:_,ButtonReject:b}=ie(this,df);i.setAttribute("aria-labelledby",ie(this,r0)),i.setAttribute("aria-describedby",ie(this,i0)),f.setAttribute("aria-controls",ie(this,n0)),i.id=ie(this,n0),l.id=ie(this,r0),_.id=ie(this,i0);const z=Array.from(this.querySelectorAll('[role="button"]'));for(const r of z)r.addEventListener("keydown",OR);f.addEventListener("click",ie(this,t0)),b.addEventListener("click",this.reject);const O=this.theme;if(O){const{IconQuestion:r,IconClose:H}=ie(this,df);r.innerHTML=Gu("question",O),H.innerHTML=Gu("close",O)}}disconnectedCallback(){const{IconClose:i,ButtonReject:l}=ie(this,df);i.removeEventListener("click",ie(this,t0)),l.removeEventListener("click",this.reject)}};df=new WeakMap;e0=new WeakMap;t0=new WeakMap;n0=new WeakMap;r0=new WeakMap;i0=new WeakMap;window.MapboxAddressConfirmationNoFeature=WR;window.customElements.get("mapbox-address-confirmation-no-feature")||customElements.define("mapbox-address-confirmation-no-feature",WR);var hV='input:-webkit-autofill,select:-webkit-autofill,textarea:-webkit-autofill{animation-name:onbrowserautofillstart}input:not(:-webkit-autofill),select:not(:-webkit-autofill),textarea:not(:-webkit-autofill){animation-name:onbrowserautofillcancel}@keyframes onbrowserautofillstart{0%{animation-name:"onbrowserautofillstart"}to{animation-name:"onbrowserautofillstart"}}@keyframes onbrowserautofillcancel{0%{animation-name:"onbrowserautofillcancel"}to{animation-name:"onbrowserautofillcancel"}}',Sx="browser-autofilled",Yw=[];function dV(){window.dispatchEvent(new window.CustomEvent("browserautofill",{bubbles:!0,cancelable:!0,detail:{elements:Yw}})),Yw=[]}var fV=pR(dV,5);function GR(i){i.hasAttribute(Sx)||(i.setAttribute(Sx,""),Yw.push(i),fV())}function qR(i){i.hasAttribute(Sx)&&i.removeAttribute(Sx)}function pV(i){i.animationName==="onbrowserautofillstart"?GR(i.target):qR(i.target)}function mV(i){const l=i.target;l.nodeName.toLowerCase()!=="select"&&!i.simulated&&!(i instanceof Zo)&&(i.inputType==="insertReplacementText"||!("data"in i))?GR(l):qR(l)}function gV(){Lh.detectBrowserAutofillEnabled||(Lh.detectBrowserAutofillEnabled=!0,d$(hV),document.addEventListener("animationstart",pV,!0),document.addEventListener("input",mV,!0))}var p2=(i,l)=>{if(typeof i=="string")if(i==="ip"){const f=l==null?void 0:l.get("ip-proximity");return f&&typeof f=="string"?f.split(",").map(parseFloat):[999,999]}else return i.split(",").map(Number);else return Zs.convert(i).toArray()},_V=i=>{const l={};return i.bbox&&(typeof i.bbox=="string"?l.bbox=i.bbox.split(",").map(Number):l.bbox=vu.convert(i.bbox).toFlatArray()),i.proximity&&(l.proximity=p2(i.proximity)),i.country&&(l.country=i.country.split(",")),i.language&&(l.language=i.language.split(",")),i.types&&(typeof i.types=="string"?l.types=i.types.split(","):l.types=Array.from(i.types)),i.limit&&(typeof i.limit=="string"?l.limit=parseInt(i.limit):l.limit=i.limit),l},yV=(i,l)=>{const f={};return i.bbox&&(typeof i.bbox=="string"?f.bbox=i.bbox.split(",").map(Number):f.bbox=vu.convert(i.bbox).toFlatArray()),i.proximity&&(f.proximity=p2(i.proximity,l)),i.country&&(f.country=i.country.split(",")),i.language&&(f.language=i.language.split(",")),i.types&&(typeof i.types=="string"?f.types=i.types.split(","):f.types=Array.from(i.types)),i.limit&&(typeof i.limit=="string"?f.limit=parseInt(i.limit):f.limit=i.limit),typeof i.autocomplete=="boolean"&&(f.autocomplete=i.autocomplete),i.worldview&&(f.worldview=i.worldview),i.permanent&&(f.permanent=i.permanent),f},vV=(i,l)=>{const f={};return i.bbox&&(typeof i.bbox=="string"?f.bbox=i.bbox.split(",").map(Number):f.bbox=vu.convert(i.bbox).toFlatArray()),i.proximity&&(f.proximity=p2(i.proximity,l)),i.country&&(f.country=i.country.split(",")),i.language&&(f.language=i.language.split(",")),i.limit&&(typeof i.limit=="string"?f.limit=parseInt(i.limit):f.limit=i.limit),i.streets!==void 0&&i.streets!==null&&(typeof i.streets=="string"?f.streets=i.streets==="true":f.streets=i.streets),f},xV=(i,l,f)=>{switch(l){case 2:return _V(i);case 1:return yV(i,f);case 0:return vV(i,f)}},bV=i=>({suggestionIds:i.map(l=>l.mapbox_id||""),suggestionNames:i.map(l=>l.feature_type==="poi"?[l.name,l.full_address].filter(Boolean).join(", "):l.full_address?l.full_address:l.name),suggestionTypes:i.map(l=>l.feature_type||""),suggestionSources:i.map(()=>"mapbox")}),wV=i=>({suggestionIds:i.map(l=>l.properties.mapbox_id||l.id||""),suggestionNames:i.map(l=>l.properties.full_address||""),suggestionTypes:i.map(l=>l.properties.feature_type||""),suggestionSources:i.map(()=>"mapbox")}),SV=i=>({suggestionIds:i.map(l=>l.mapbox_id||""),suggestionNames:i.map(l=>l.full_address||""),suggestionTypes:i.map(l=>{var f;return((f=l.place_type)==null?void 0:f[0])||""}),suggestionSources:i.map(()=>"mapbox")}),EV=(i,l)=>{switch(l){case 2:return bV(i);case 1:return wV(i);case 0:return SV(i)}},LA=(i,l)=>{switch(i){case 2:return"search/searchbox/v1/suggest";case 1:return`search/geocode/v6/${/^[ ]*(-?\d{1,3}(\.\d{0,256})?)[, ]+(-?\d{1,3}(\.\d{0,256})?)[ ]*$/.test(l)?"reverse":"forward"}`;case 0:return"autofill/v1/suggest"}},Kw,Jw,Zp,o0,Qw,Xp,T_,C_,M_,A_,eS,rg,ff,tS,nS,rS,I_,iS,oS,sS,aS,lS,cS,P_,Yp,R_,m2=class{constructor(i){$t(this,Kw,"https://api.mapbox.com"),$t(this,Jw,"events/v2"),$t(this,Zp,void 0),$t(this,o0,void 0),$t(this,Qw,navigator.language||null),$t(this,Xp,[]),$t(this,T_,""),$t(this,C_,0),$t(this,M_,!0),$t(this,A_,1e3),$t(this,eS,100),$t(this,rg,void 0),$t(this,ff,void 0),this.start=(l,f,_,b)=>{Vn(this,Zp,f.accessToken);const z=ie(this,I_).call(this,"search.start",{queryString:l,options:f,map:_,responseHeaders:b});z&&ie(this,R_).call(this,z)},this.input=(l,f,_,b,z)=>{if(Vn(this,Zp,_.accessToken),ie(this,M_)&&(this.start(l,_,b,z),Vn(this,M_,!1)),!f)return;const O=ie(this,I_).call(this,"search.keystroke",{lastInput:f,queryString:l,options:_,map:b,responseHeaders:z});O&&ie(this,R_).call(this,O)},this.select=(l,f,_,b,z,O)=>{Vn(this,Zp,b.accessToken);const r=ie(this,I_).call(this,"search.select",{queryString:l,selectedIndex:f,suggestions:_,options:b,map:z,responseHeaders:O});r&&(r.resultIndex===ie(this,C_)&&r.queryString===ie(this,T_)||r.resultIndex===-1||(Vn(this,C_,r.resultIndex),Vn(this,T_,r.queryString),ie(this,R_).call(this,r)))},this.clear=()=>{Vn(this,M_,!0),Vn(this,T_,""),Vn(this,C_,0),ie(this,Yp).call(this)},$t(this,tS,l=>{const f=`${ie(this,Kw)}/${ie(this,Jw)}?access_token=${ie(this,Zp)}`,_=ie(this,nS).call(this,l);try{fetch(f,_)}catch(b){ie(this,rS).call(this,b)}}),$t(this,nS,l=>(Array.isArray(l)||(l=[l]),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(l)})),$t(this,rS,l=>{console.log(l)}),$t(this,I_,(l,f)=>{if(l==="search.select"&&!(typeof f.selectedIndex=="number"||f.suggestions)||l==="search.keystroke"&&!f.lastInput)return null;const _=xV(f.options,ie(this,ff),f.responseHeaders),b=ie(this,iS).call(this,l,f,_);return l==="search.keystroke"?ie(this,oS).call(this,b,f,_):l==="search.select"&&ie(this,sS).call(this,b,f,_),ie(this,cS).call(this,b)?b:null}),$t(this,iS,(l,f,_)=>{let b={event:l,version:ie(this,lS).call(this,l),created:+new Date,sessionIdentifier:f.options.sessionToken,userAgent:ie(this,o0),keyboardLocale:ie(this,Qw),queryString:f.queryString};if(_&&(b=Ui(Ui({},b),_)),l==="search.start")for(const z of["streets","permanent"])delete b[z];if(f.map){const z=f.map.getZoom()||void 0,O=f.map.getCenter();b=bu(Ui({},b),{mapZoom:z,mapCenterLat:O.lat,mapCenterLng:O.lng})}return b}),$t(this,oS,(l,f,_)=>{switch(ie(this,ff)){case 0:_.streets&&(l.streets=_.streets);break;case 1:_.permanent&&(l.permanent=_.permanent);break}l.path=LA(ie(this,ff),f.queryString),l.lastAction=f.lastInput}),$t(this,sS,(l,f,_)=>{switch(ie(this,ff)){case 0:_.streets&&(l.streets=_.streets);break;case 1:_.permanent&&(l.permanent=_.permanent);break}l.path=LA(ie(this,ff),f.queryString);const{selectedIndex:b,suggestions:z}=f;if(z&&z.length>0){const O=EV(z,ie(this,ff));l.resultIndex=b,l.resultPlaceName=O.suggestionNames[b],l.resultId=O.suggestionIds[b],l.resultId.startsWith("dXJuOm1ie")&&(l.resultMapboxId=l.resultId),l.suggestionIds=O.suggestionIds,l.suggestionNames=O.suggestionNames,l.suggestionTypes=O.suggestionTypes,l.suggestionSources=O.suggestionSources}}),$t(this,aS,()=>`mapbox.${P$.split("/")[1]}.${Gx}.${navigator.userAgent}`),$t(this,lS,l=>["search.keystroke","search.select"].includes(l)?"2.2":"2.0"),$t(this,cS,l=>{if(!l||!l.event)return!1;const f=["event","created","sessionIdentifier","queryString"],_=["event","created","sessionIdentifier","queryString","lastAction"],b=["event","created","sessionIdentifier","queryString","resultIndex","path","suggestionIds"],z=l.event;return z==="search.start"?ie(this,P_).call(this,l,f):z==="search.keystroke"?ie(this,P_).call(this,l,_):z==="search.select"?ie(this,P_).call(this,l,b):!0}),$t(this,P_,(l,f)=>f.every(_=>_==="queryString"?typeof l[_]=="string"&&l[_].length>0:l[_]!==void 0)),$t(this,Yp,()=>{ie(this,Xp).length>0&&ie(this,Zp)&&(ie(this,tS).call(this,ie(this,Xp)),Vn(this,Xp,[])),ie(this,rg)&&clearTimeout(ie(this,rg)),ie(this,A_)&&Vn(this,rg,setTimeout(ie(this,Yp),ie(this,A_)))}),$t(this,R_,(l,f)=>{ie(this,Xp).push(l),(ie(this,Xp).length>=ie(this,eS)||f)&&ie(this,Yp).call(this)}),this.remove=()=>{ie(this,Yp).call(this)},Vn(this,ff,i),Vn(this,o0,ie(this,aS).call(this)),Vn(this,rg,setTimeout(ie(this,Yp),ie(this,A_)))}};Kw=new WeakMap;Jw=new WeakMap;Zp=new WeakMap;o0=new WeakMap;Qw=new WeakMap;Xp=new WeakMap;T_=new WeakMap;C_=new WeakMap;M_=new WeakMap;A_=new WeakMap;eS=new WeakMap;rg=new WeakMap;ff=new WeakMap;tS=new WeakMap;nS=new WeakMap;rS=new WeakMap;I_=new WeakMap;iS=new WeakMap;oS=new WeakMap;sS=new WeakMap;aS=new WeakMap;lS=new WeakMap;cS=new WeakMap;P_=new WeakMap;Yp=new WeakMap;R_=new WeakMap;var ip,Fc,Bc,Ro,ig,op,k_,s0,a0,z_,l0,c0,u0,h0,d0,f0,p0,uS,g2=class extends wp{constructor(){super(...arguments),$t(this,ip,new sR),$t(this,Fc,new t2(ie(this,ip))),$t(this,Bc,void 0),$t(this,Ro,new my),$t(this,ig,new m2(0)),$t(this,op,void 0),this.options={},this.confirmOnBrowserAutofill=!1,$t(this,k_,!1),$t(this,s0,i=>{const l=i!=null&&i.suggestions?eV(i.suggestions):null;ie(this,Ro).handleSuggest(l),this.dispatchEvent(new Zo("suggest",i))}),$t(this,a0,i=>{ie(this,Ro).handleError(),this.dispatchEvent(new Zo("suggesterror",i))}),$t(this,z_,i=>{var l;if(this.dispatchEvent(new Zo("retrieve",i)),this.retrieveFeature=(l=i.features)==null?void 0:l[0],!ie(this,Bc))return;const f=i;!f||!f.features||!f.features.length||$R(f.features[0],ie(this,Bc))}),$t(this,l0,()=>{var i;try{const l=(i=this.querySelector("input"))!=null?i:null;Vn(this,Bc,l),ie(this,Ro).input=l}catch(l){Vn(this,Bc,null),ie(this,Ro).input=null,console.error(l.message||l)}}),$t(this,c0,new MutationObserver(ie(this,l0))),$t(this,u0,i=>{ie(this,Ro).blur(),oV(ie(this,Bc),i,this.confirmOnBrowserAutofill,this.accessToken)}),this.retrieveFeature=null,this.interceptSearch=null,$t(this,h0,i=>{this.dispatchEvent(new Zo("input",i.detail.inputText));const{lastInput:l,inputText:f}=i.detail,_=this.browserAutofillEnabled===!0&&(f==null?void 0:f.length)<=2;if(_g(ie(this,Bc),ie(this,op),_),!f){ie(this,uS).call(this);return}const b=this.interceptSearch&&this.interceptSearch(f),z=this.interceptSearch?b:f;if(this.interceptSearch&&!b||(z==null?void 0:z.length)<=2){ie(this,Ro).handleSuggest(null);return}ie(this,Fc).suggest(z,this.options),ie(this,ig).input(z,l,bu(Ui({},this.options),{sessionToken:ie(this,Fc).sessionToken,accessToken:this.accessToken}),null,ie(this,ip).responseHeaders)}),$t(this,d0,i=>{const{suggestion:l,selectedIndex:f}=i.detail;l.accuracy!=="street"?(_g(ie(this,Bc),ie(this,op),!0),ie(this,Fc).retrieve(l,this.options),ie(this,ig).select(this.input.value,f,ie(this,Ro).suggestions,bu(Ui({},this.options),{sessionToken:ie(this,Fc).sessionToken,accessToken:this.accessToken}),null,ie(this,ip).responseHeaders)):tV(ie(this,Bc),ie(this,op),l)}),$t(this,f0,()=>{_g(ie(this,Bc),ie(this,op),!0),ie(this,Fc).abort()}),$t(this,p0,()=>{var i;const l=this.browserAutofillEnabled===!0&&((i=ie(this,Bc).value)==null?void 0:i.length)<=2;_g(ie(this,Bc),ie(this,op),l)}),$t(this,uS,()=>{ie(this,Ro).handleSuggest(null),ie(this,ig).clear()})}get accessToken(){return ie(this,ip).accessToken}set accessToken(i){ie(this,ip).accessToken=i}get input(){return ie(this,Bc)}get theme(){return ie(this,Ro).theme}set theme(i){ie(this,Ro).theme=i}get popoverOptions(){return ie(this,Ro).popoverOptions}set popoverOptions(i){ie(this,Ro).popoverOptions=i}get browserAutofillEnabled(){return ie(this,k_)}set browserAutofillEnabled(i){Vn(this,k_,i)}connectedCallback(){var i;super.connectedCallback(),Lh.autofillSessionEnabled=!0,ie(this,Fc).sessionToken=Lh.autofillSessionToken.id,ie(this,Ro).autofillHost=this,ie(this,Ro).searchService=0;const l=(i=this.querySelector("input"))!=null?i:null;ie(this,c0).observe(this,{subtree:!0,childList:!0}),ie(this,l0).call(this),ie(this,Ro).addEventListener("input",ie(this,h0)),ie(this,Ro).addEventListener("select",ie(this,d0)),ie(this,Ro).addEventListener("blur",ie(this,f0)),ie(this,Ro).addEventListener("focus",ie(this,p0)),ie(this,Fc).addEventListener("suggest",ie(this,s0)),ie(this,Fc).addEventListener("suggesterror",ie(this,a0)),ie(this,Fc).addEventListener("retrieve",ie(this,z_)),document.body.appendChild(ie(this,Ro)),l&&(l.insertAdjacentElement("beforebegin",h2(ie(this,Ro).dataSeed)),$$(l),Vn(this,op,l.autocomplete)),gV(),window.addEventListener("browserautofill",ie(this,u0))}disconnectedCallback(){ie(this,Ro).remove(),ie(this,Ro).removeEventListener("input",ie(this,h0)),ie(this,Ro).removeEventListener("select",ie(this,d0)),ie(this,Ro).removeEventListener("blur",ie(this,f0)),ie(this,Ro).removeEventListener("focus",ie(this,p0)),ie(this,Fc).removeEventListener("suggest",ie(this,s0)),ie(this,Fc).removeEventListener("suggesterror",ie(this,a0)),ie(this,Fc).removeEventListener("retrieve",ie(this,z_)),ie(this,ig).remove(),ie(this,c0).disconnect(),window.removeEventListener("browserautofill",ie(this,u0))}attributeChangedCallback(i,l,f){if(i==="access-token"){ie(this,ip).accessToken=f;return}if(i==="browser-autofill-enabled"){Vn(this,k_,!!f);return}if(i==="theme"){this.theme=Mg(f);return}if(i==="popover-options"){this.popoverOptions=Mg(f);return}const _=i.split("-").join("_");f||delete this.options[_],this.options[_]=f}focus(){ie(this,Ro).focus()}simulateRetrieve(i){const l=this.input;l&&(l.dataset.mapboxSuccess="true"),ie(this,Ro).hideResults();const f={type:"FeatureCollection",features:[i],url:""};ie(this,z_).call(this,f)}};ip=new WeakMap;Fc=new WeakMap;Bc=new WeakMap;Ro=new WeakMap;ig=new WeakMap;op=new WeakMap;k_=new WeakMap;s0=new WeakMap;a0=new WeakMap;z_=new WeakMap;l0=new WeakMap;c0=new WeakMap;u0=new WeakMap;h0=new WeakMap;d0=new WeakMap;f0=new WeakMap;p0=new WeakMap;uS=new WeakMap;g2.observedAttributes=["access-token","browser-autofill-enabled","theme","popover-options","css-text","language","country","bbox","limit","proximity","streets"];window.MapboxAddressAutofill=g2;window.customElements.get("mapbox-address-autofill")||customElements.define("mapbox-address-autofill",g2);var TV={de:"Suche",it:"Ricerca",en:"Search",nl:"Zoeken",fr:"Chercher",ca:"Cerca",he:"",ja:"",lv:"Meklt",pt:"Procurar",sr:"",zh:"",cs:"Vyhledvn",hu:"Keress",ka:"",nb:"Ske",sk:"Vyhadvanie",th:"",fi:"Hae",is:"Leita",ko:"",pl:"Szukaj",sl:"Iskanje",fa:"",ru:""},ZR={placeholder:TV},CV=9,vd,og,Nc,Mh,xd,rs,sg,hS,XR,ag,m0,g0,_0,Kp,y0,v0,L_,x0,b0,sp,w0,S0,_2=class extends wp{constructor(){super(...arguments),$t(this,hS),$t(this,vd,void 0),$t(this,og,new lR({})),$t(this,Nc,new t2(ie(this,og))),$t(this,Mh,null),$t(this,xd,void 0),$t(this,rs,new my),$t(this,sg,new m2(2)),this.options={},$t(this,ag,void 0),$t(this,m0,i=>{ie(this,sp).call(this),ie(this,rs).handleSuggest((i==null?void 0:i.suggestions)||null),this.dispatchEvent(new Zo("suggest",i))}),$t(this,g0,i=>{ie(this,sp).call(this),ie(this,rs).handleError(),this.dispatchEvent(new Zo("suggesterror",i))}),$t(this,_0,i=>{ie(this,sp).call(this),this.dispatchEvent(new Zo("retrieve",i));const l=i;if(!l||!l.features.length)return;const f=n2(l.features[0]);ie(this,xd).value=f.name;const _=ie(this,Mh);if(!_)return;const b=l.features[0];if(!b)return;const z=b.properties.feature_type,O=b.properties.bbox;if(O)_.flyTo(RR(_,vu.convert(O).toFlatArray()));else{const r=b.geometry.coordinates,H=kR(z);_.flyTo({center:r,zoom:H,speed:a2})}this.marker&&this.mapboxgl&&ie(this,v0).call(this,b)}),$t(this,Kp,void 0),$t(this,y0,()=>{ie(this,Kp)&&(ie(this,Kp).remove(),Vn(this,Kp,null))}),$t(this,v0,i=>{if(!ie(this,Mh)||(ie(this,y0).call(this),!i))return;const f=Ui(Ui({},{color:"#4668F2"}),typeof this.marker=="object"&&this.marker);Vn(this,Kp,new this.mapboxgl.Marker(f)),i.geometry&&i.geometry.type&&i.geometry.type==="Point"&&i.geometry.coordinates&&ie(this,Kp).setLngLat(i.geometry.coordinates).addTo(ie(this,Mh))}),this.interceptSearch=null,$t(this,L_,i=>{this.dispatchEvent(new Zo("input",i.detail.inputText));const{lastInput:l,inputText:f}=i.detail;if(!f){ie(this,w0).call(this);return}const _=this.interceptSearch&&this.interceptSearch(f),b=this.interceptSearch?_:f;if(this.interceptSearch&&!_){ie(this,rs).hideResults();return}ie(this,Nc).suggest(b,this.options),ie(this,sg).input(b,l,bu(Ui({},this.options),{sessionToken:ie(this,Nc).sessionToken,accessToken:this.accessToken}),ie(this,Mh)),ie(this,sp).call(this,!0)}),$t(this,x0,i=>{const{suggestion:l,selectedIndex:f}=i.detail;ie(this,Nc).retrieve(l,this.options),ie(this,sg).select(this.value,f,ie(this,rs).suggestions,bu(Ui({},this.options),{sessionToken:ie(this,Nc).sessionToken,accessToken:this.accessToken}),ie(this,Mh)),ie(this,sp).call(this,!0)}),$t(this,b0,()=>{ie(this,Nc).abort()}),$t(this,sp,(i=!1)=>{i?(ie(this,vd).ClearBtn.style.display="none",ie(this,vd).LoadingIcon.style.display="block"):(ie(this,vd).LoadingIcon.style.display="none",ie(this,vd).ClearBtn.style.display=this.value?"block":"none")}),$t(this,w0,()=>{this.value="",ie(this,sp).call(this),ie(this,v0).call(this,null),ie(this,rs).handleSuggest(null),ie(this,sg).clear(),ie(this,Nc).incrementSession(),this.dispatchEvent(new Zo("clear"))}),this.marker=!0,$t(this,S0,()=>{const i=ie(this,Mh),l=Ui({},this.options);if(i.getZoom()<=CV){delete l.proximity,this.options=l;return}const f=i.getCenter();this.options=bu(Ui({},l),{proximity:f})})}get accessToken(){return ie(this,og).accessToken}set accessToken(i){ie(this,og).accessToken=i}get value(){return ie(this,xd).value}set value(i){ie(this,xd).value=i||""}get input(){return ie(this,xd)}get template(){return b$}get templateStyle(){return dm}get templateUserStyle(){return Vc(".SearchBox",ie(this,rs).theme)}get theme(){return ie(this,rs).theme}set theme(i){if(ie(this,rs).theme=i,!ie(this,vd)||!i)return;this.updateTemplateUserStyle(Vc(".SearchBox",i)),ie(this,rs).updatePopover();const{SearchIcon:l}=ie(this,vd);l.innerHTML=Gu("search",i)}get popoverOptions(){return ie(this,rs).popoverOptions}set popoverOptions(i){ie(this,rs).popoverOptions=i}get placeholder(){return ie(this,ag)||H_(this,hS,XR).call(this)}set placeholder(i){Vn(this,ag,i),ie(this,xd)&&(ie(this,xd).placeholder=this.placeholder,ie(this,xd).setAttribute("aria-label",this.placeholder))}connectedCallback(){super.connectedCallback(),Vn(this,vd,hm(this,{SearchBox:".SearchBox",SearchIcon:".SearchIcon",Input:".Input",ClearBtn:".ClearBtn",LoadingIcon:".LoadingIcon"})),this.theme=Ui({},this.theme);const{Input:i,ClearBtn:l}=ie(this,vd);Vn(this,xd,i),ie(this,rs).input=i,ie(this,rs).searchService=2,ie(this,rs).addEventListener("input",ie(this,L_)),ie(this,rs).addEventListener("select",ie(this,x0)),ie(this,rs).addEventListener("blur",ie(this,b0)),ie(this,Nc).addEventListener("suggest",ie(this,m0)),ie(this,Nc).addEventListener("suggesterror",ie(this,g0)),ie(this,Nc).addEventListener("retrieve",ie(this,_0)),l.addEventListener("click",ie(this,w0)),this.placeholder=ie(this,ag),this.parentElement.appendChild(ie(this,rs)),i&&(i.previousElementSibling.hasAttribute("aria-live")&&i.previousElementSibling.remove(),i.insertAdjacentElement("beforebegin",h2(ie(this,rs).dataSeed)))}disconnectedCallback(){ie(this,rs).remove(),ie(this,rs).input=null,ie(this,rs).removeEventListener("input",ie(this,L_)),ie(this,rs).removeEventListener("select",ie(this,x0)),ie(this,rs).removeEventListener("blur",ie(this,b0)),ie(this,Nc).removeEventListener("suggest",ie(this,m0)),ie(this,Nc).removeEventListener("suggesterror",ie(this,g0)),ie(this,Nc).removeEventListener("retrieve",ie(this,_0)),ie(this,sg).remove()}attributeChangedCallback(i,l,f){if(i==="access-token"){ie(this,og).accessToken=f;return}if(i==="theme"){this.theme=Mg(f);return}if(i==="popover-options"){this.popoverOptions=Mg(f);return}if(i==="placeholder"){this.placeholder=f;return}const _=i.split("-").join("_");f||delete this.options[_],this.options[_]=f,_==="language"&&(this.placeholder=ie(this,ag))}focus(){ie(this,rs).focus()}search(i){this.value=i;const l={lastInput:i,inputText:i};ie(this,L_).call(this,new Zo("input",l))}bindMap(i){ie(this,Mh)&&ie(this,Mh).off("moveend",ie(this,S0)),i&&i.on("moveend",ie(this,S0)),Vn(this,Mh,i)}unbindMap(){this.bindMap(null)}onAdd(i){this.bindMap(i),this.remove();const l=document.createElement("div");return l.className="mapboxgl-ctrl",l.style.width="300px",l.appendChild(this),l}onRemove(){this.remove(),this.unbindMap(),ie(this,y0).call(this)}getDefaultPosition(){return"top-right"}};vd=new WeakMap;og=new WeakMap;Nc=new WeakMap;Mh=new WeakMap;xd=new WeakMap;rs=new WeakMap;sg=new WeakMap;hS=new WeakSet;XR=function(){if(this.options.language){const i=this.options.language.split(",")[0],l=AR.language(i),f=ZR.placeholder[l];if(f)return f}return"Search"};ag=new WeakMap;m0=new WeakMap;g0=new WeakMap;_0=new WeakMap;Kp=new WeakMap;y0=new WeakMap;v0=new WeakMap;L_=new WeakMap;x0=new WeakMap;b0=new WeakMap;sp=new WeakMap;w0=new WeakMap;S0=new WeakMap;_2.observedAttributes=["access-token","theme","popover-options","placeholder","language","country","bbox","limit","navigation-profile","origin","proximity","eta-type","types"];window.MapboxSearchBox=_2;window.customElements.get("mapbox-search-box")||customElements.define("mapbox-search-box",_2);var MV=9,bd,ap,jc,Ah,wd,is,lg,dS,YR,cg,E0,T0,C0,Jp,M0,A0,O_,I0,P0,lp,R0,k0,y2=class extends wp{constructor(){super(...arguments),$t(this,dS),$t(this,bd,void 0),$t(this,ap,new p6({})),$t(this,jc,new t2(ie(this,ap))),$t(this,Ah,null),$t(this,wd,void 0),$t(this,is,new my),$t(this,lg,new m2(1)),this.options={},$t(this,cg,void 0),$t(this,E0,i=>{ie(this,lp).call(this),ie(this,is).handleSuggest((i==null?void 0:i.features)||null),this.dispatchEvent(new Zo("suggest",i))}),$t(this,T0,i=>{ie(this,lp).call(this),ie(this,is).handleError(),this.dispatchEvent(new Zo("suggesterror",i))}),$t(this,C0,i=>{ie(this,lp).call(this),this.dispatchEvent(new Zo("retrieve",i));const l=i;if(!l)return;ie(this,wd).value=l.properties.full_address;const f=ie(this,Ah);if(!f)return;const _=l.properties.feature_type,b=l.properties.bbox;if(b)f.flyTo(RR(f,vu.convert(b).toFlatArray()));else{const z=l.geometry.coordinates,O=kR(_);f.flyTo({center:z,zoom:O,speed:a2})}this.marker&&this.mapboxgl&&ie(this,A0).call(this,l)}),$t(this,Jp,void 0),$t(this,M0,()=>{ie(this,Jp)&&(ie(this,Jp).remove(),Vn(this,Jp,null))}),$t(this,A0,i=>{if(!ie(this,Ah)||(ie(this,M0).call(this),!i))return;const f=Ui(Ui({},{color:"#4668F2"}),typeof this.marker=="object"&&this.marker);Vn(this,Jp,new this.mapboxgl.Marker(f)),i.geometry&&i.geometry.type&&i.geometry.type==="Point"&&i.geometry.coordinates&&ie(this,Jp).setLngLat(i.geometry.coordinates).addTo(ie(this,Ah))}),this.interceptSearch=null,$t(this,O_,i=>{this.dispatchEvent(new Zo("input",i.detail.inputText));const{lastInput:l,inputText:f}=i.detail;if(!f){ie(this,R0).call(this);return}const _=this.interceptSearch&&this.interceptSearch(f),b=this.interceptSearch?_:f;if(this.interceptSearch&&!_){ie(this,is).hideResults();return}ie(this,jc).suggest(b,this.options),ie(this,lg).input(b,l,bu(Ui({},this.options),{sessionToken:ie(this,jc).sessionToken,accessToken:this.accessToken}),ie(this,Ah),ie(this,ap).responseHeaders),ie(this,lp).call(this,!0)}),$t(this,I0,i=>{const{suggestion:l,selectedIndex:f}=i.detail;ie(this,jc).retrieve(l,this.options),ie(this,lg).select(this.value,f,ie(this,is).suggestions,bu(Ui({},this.options),{sessionToken:ie(this,jc).sessionToken,accessToken:this.accessToken}),ie(this,Ah),ie(this,ap).responseHeaders),ie(this,lp).call(this,!0)}),$t(this,P0,()=>{ie(this,jc).abort()}),$t(this,lp,(i=!1)=>{i?(ie(this,bd).ClearBtn.style.display="none",ie(this,bd).LoadingIcon.style.display="block"):(ie(this,bd).LoadingIcon.style.display="none",ie(this,bd).ClearBtn.style.display=this.value?"block":"none")}),$t(this,R0,()=>{this.value="",ie(this,lp).call(this),ie(this,A0).call(this,null),ie(this,is).handleSuggest(null),ie(this,lg).clear(),ie(this,jc).incrementSession(),this.dispatchEvent(new Zo("clear"))}),this.marker=!0,$t(this,k0,()=>{const i=ie(this,Ah),l=Ui({},this.options);if(i.getZoom()<=MV){delete l.proximity,this.options=l;return}const f=i.getCenter();this.options=bu(Ui({},l),{proximity:f})})}get accessToken(){return ie(this,ap).accessToken}set accessToken(i){ie(this,ap).accessToken=i}get value(){return ie(this,wd).value}set value(i){ie(this,wd).value=i||""}get input(){return ie(this,wd)}get template(){return w$}get templateStyle(){return dm}get templateUserStyle(){return Vc(".Geocoder",ie(this,is).theme)}get theme(){return ie(this,is).theme}set theme(i){if(ie(this,is).theme=i,!ie(this,bd)||!i)return;this.updateTemplateUserStyle(Vc(".Geocoder",i)),ie(this,is).updatePopover();const{SearchIcon:l}=ie(this,bd);l.innerHTML=Gu("search",i)}get popoverOptions(){return ie(this,is).popoverOptions}set popoverOptions(i){ie(this,is).popoverOptions=i}get placeholder(){return ie(this,cg)||H_(this,dS,YR).call(this)}set placeholder(i){Vn(this,cg,i),ie(this,wd)&&(ie(this,wd).placeholder=this.placeholder,ie(this,wd).setAttribute("aria-label",this.placeholder))}connectedCallback(){super.connectedCallback(),Vn(this,bd,hm(this,{Geocoder:".Geocoder",SearchIcon:".SearchIcon",Input:".Input",ClearBtn:".ClearBtn",LoadingIcon:".LoadingIcon"})),this.theme=Ui({},this.theme);const{Input:i,ClearBtn:l}=ie(this,bd);Vn(this,wd,i),ie(this,is).input=i,ie(this,is).searchService=1,ie(this,is).addEventListener("input",ie(this,O_)),ie(this,is).addEventListener("select",ie(this,I0)),ie(this,is).addEventListener("blur",ie(this,P0)),ie(this,jc).addEventListener("suggest",ie(this,E0)),ie(this,jc).addEventListener("suggesterror",ie(this,T0)),ie(this,jc).addEventListener("retrieve",ie(this,C0)),l.addEventListener("click",ie(this,R0)),this.placeholder=ie(this,cg),this.parentElement.appendChild(ie(this,is)),i&&(i.previousElementSibling.hasAttribute("aria-live")&&i.previousElementSibling.remove(),i.insertAdjacentElement("beforebegin",h2(ie(this,is).dataSeed)))}disconnectedCallback(){ie(this,is).remove(),ie(this,is).input=null,ie(this,is).removeEventListener("input",ie(this,O_)),ie(this,is).removeEventListener("select",ie(this,I0)),ie(this,is).removeEventListener("blur",ie(this,P0)),ie(this,jc).removeEventListener("suggest",ie(this,E0)),ie(this,jc).removeEventListener("suggesterror",ie(this,T0)),ie(this,jc).removeEventListener("retrieve",ie(this,C0)),ie(this,lg).remove()}attributeChangedCallback(i,l,f){if(i==="access-token"){ie(this,ap).accessToken=f;return}if(i==="theme"){this.theme=Mg(f);return}if(i==="popover-options"){this.popoverOptions=Mg(f);return}if(i==="placeholder"){this.placeholder=f;return}const _=i.split("-").join("_");f||delete this.options[_],this.options[_]=f,_==="language"&&(this.placeholder=ie(this,cg))}focus(){ie(this,is).focus()}search(i){this.value=i;const l={lastInput:i,inputText:i};ie(this,O_).call(this,new Zo("input",l))}bindMap(i){ie(this,Ah)&&ie(this,Ah).off("moveend",ie(this,k0)),i&&i.on("moveend",ie(this,k0)),Vn(this,Ah,i)}unbindMap(){this.bindMap(null)}onAdd(i){this.bindMap(i),this.remove();const l=document.createElement("div");return l.className="mapboxgl-ctrl",l.style.width="300px",l.appendChild(this),l}onRemove(){this.remove(),this.unbindMap(),ie(this,M0).call(this)}getDefaultPosition(){return"top-right"}};bd=new WeakMap;ap=new WeakMap;jc=new WeakMap;Ah=new WeakMap;wd=new WeakMap;is=new WeakMap;lg=new WeakMap;dS=new WeakSet;YR=function(){if(this.options.language){const i=this.options.language.split(",")[0],l=AR.language(i),f=ZR.placeholder[l];if(f)return f}return"Search"};cg=new WeakMap;E0=new WeakMap;T0=new WeakMap;C0=new WeakMap;Jp=new WeakMap;M0=new WeakMap;A0=new WeakMap;O_=new WeakMap;I0=new WeakMap;P0=new WeakMap;lp=new WeakMap;R0=new WeakMap;k0=new WeakMap;y2.observedAttributes=["access-token","theme","popover-options","placeholder","autocomplete","language","country","bbox","limit","proximity","types","worldview","permanent"];window.MapboxGeocoder=y2;window.customElements.get("mapbox-geocoder")||customElements.define("mapbox-geocoder",y2);var OA=new r$({size:512,antimeridian:!0}),Ym=1280;function DA(i,l){const{width:f,height:_}=IR(i,!0);switch(l){case"center":return[0,0];case"top":return[0,_/2];case"bottom":return[0,-1*_/2];case"left":return[f/2,0];case"right":return[-1*f/2,0];case"top-left":return[f/2,_/2];case"top-right":return[-1*f/2,_/2];case"bottom-left":return[f/2,-1*_/2];case"bottom-right":return[-1*f/2,-1*_/2]}}var z0,fS,ug,L0,O0,pS,D0,F0,mS,B0,N0,hg,gS,j0,AV=class{constructor(i,l,f,_,b,z){$t(this,z0,void 0),$t(this,fS,()=>{[this.anchorOffsetX,this.anchorOffsetY]=DA(this.markerElement,this.anchor),this.markerTransform={anchorX:this.anchorOffsetX,anchorY:this.anchorOffsetY}}),$t(this,ug,{anchorX:0,anchorY:0,globalX:0,globalY:0,correctionX:0,correctionY:0}),$t(this,L0,!1),$t(this,O0,void 0),$t(this,pS,r=>{this.isActive&&(r.preventDefault(),r.stopPropagation(),ie(this,hg).call(this,r),window.addEventListener("pointermove",ie(this,F0)),window.addEventListener("pointerup",ie(this,D0)))}),$t(this,D0,()=>{window.removeEventListener("pointermove",ie(this,F0)),window.removeEventListener("pointerup",ie(this,D0))}),$t(this,F0,r=>{r.preventDefault(),r.stopPropagation();const H=this.curPointerXPos-r.pageX,Z=this.curPointerYPos-r.pageY;this.markerDeltaX+=H,this.markerDeltaY-=Z,this.markerDeltaX=Math.max(Math.min(this.imgElement.width/2,this.markerDeltaX),this.imgElement.width/2*-1),this.markerDeltaY=Math.max(Math.min(this.imgElement.height/2,this.markerDeltaY),this.imgElement.height/2*-1);const K=this.imgCenterPx[0]-this.imgCenterAdjustedPx[0],te=this.imgCenterPx[1]-this.imgCenterAdjustedPx[1],le=this.markerDeltaX-K,Te=this.markerDeltaY+te;this.markerTransform={globalX:le,globalY:Te},ie(this,hg).call(this,r)}),$t(this,mS,r=>{this.isActive&&(r.preventDefault(),r.stopPropagation(),ie(this,hg).call(this,r),window.addEventListener("pointermove",ie(this,N0)),window.addEventListener("pointerup",ie(this,B0)))}),$t(this,B0,()=>{window.removeEventListener("pointermove",ie(this,N0)),window.removeEventListener("pointerup",ie(this,B0))}),$t(this,N0,r=>{r.preventDefault();let H=Math.round(this.imgContainerElement.scrollTop+(this.curPointerYPos-r.pageY));H=Math.max(Math.min(this.imgElement.height-this.imgContainerElement.clientHeight,H),0);let Z=Math.round(this.imgContainerElement.scrollLeft+(this.curPointerXPos-r.pageX));Z=Math.max(Math.min(this.imgElement.width-this.imgContainerElement.clientWidth,Z),0),this.imgContainerElement.scrollTop=H,this.imgContainerElement.scrollLeft=Z;const K=Math.round(Z-(this.imgElement.width-this.imgContainerElement.clientWidth)/2),te=Math.round((this.imgElement.height-this.imgContainerElement.clientHeight)/2-H);if(this.imgCenterAdjustedPx=[this.imgCenterPx[0]+K,this.imgCenterPx[1]-te],!this.keepMarkerCentered){const le=this.markerDeltaX+K,Te=this.markerDeltaY+te;this.markerTransform={globalX:le,globalY:Te}}ie(this,j0).call(this,Z,H),ie(this,hg).call(this,r)}),$t(this,hg,r=>{this.curPointerXPos=r.pageX,this.curPointerYPos=r.pageY}),$t(this,gS,()=>{const{anchorX:r,anchorY:H,globalX:Z,globalY:K,correctionX:te,correctionY:le}=ie(this,ug),Te=r-Z+te,pe=H+K+le;this.markerElement.style.transform=`translate(calc(-50% + ${Te}px), calc(-50% + ${pe}px))`}),this.reCenter=()=>{const r=(this.imgElement.height-this.imgContainerElement.clientHeight)/2,H=(this.imgElement.width-this.imgContainerElement.clientWidth)/2;this.imgContainerElement.scrollTop=r,this.imgContainerElement.scrollLeft=H,this.imgCenterAdjustedPx=this.imgCenterPx,this.markerDeltaX=this.markerDeltaY=0,this.markerTransform={globalX:0,globalY:0,correctionX:0,correctionY:0}},this.handleMinimapResize=()=>{if(!this.imgElement.height||!this.imgElement.width)return;const r=this.imgCenterOffset.x,H=this.imgCenterOffset.y,Z=this.imgElement.width/2-r-this.imgContainerElement.clientWidth/2,K=this.imgElement.height/2-H-this.imgContainerElement.clientHeight/2;this.imgContainerElement.scrollLeft=Z,this.imgContainerElement.scrollTop=K,ie(this,j0).call(this,Z,K)},$t(this,j0,(r,H)=>{const Z=this.imgCenterOffset.x,K=this.imgCenterOffset.y,{correctionX:te,correctionY:le}=this.markerTransform,Te={};if(r/2<Z*-1){const pe=Z*-1-r/2;Te.correctionX=pe*2}else r<0?Te.correctionX=r:te!==0&&(Te.correctionX=0);if(H/2<K*-1){const pe=K*-1-H/2;Te.correctionY=pe*2}else H<0?Te.correctionY=H:le!==0&&(Te.correctionY=0);this.markerTransform=Te}),this.markerElement=f,this.imgContainerElement=i,this.imgElement=l,this.keepMarkerCentered=_,this.zoom=b,this.anchor=z,this.curPointerXPos=0,this.curPointerYPos=0,this.markerDeltaX=0,this.markerDeltaY=0,this.imgContainerElement.addEventListener("pointerdown",ie(this,mS)),this.keepMarkerCentered||this.markerElement.addEventListener("pointerdown",ie(this,pS)),new ResizeObserver(ie(this,fS)).observe(this.markerElement)}get anchor(){return ie(this,z0)}set anchor(i){Vn(this,z0,i),[this.anchorOffsetX,this.anchorOffsetY]=DA(this.markerElement,i),this.markerTransform={anchorX:this.anchorOffsetX,anchorY:this.anchorOffsetY}}get markerTransform(){return ie(this,ug)}set markerTransform(i){Vn(this,ug,Ui(Ui({},ie(this,ug)),i)),ie(this,gS).call(this)}get isActive(){return ie(this,L0)}set isActive(i){this.imgContainerElement.style.touchAction=i?"none":"",Vn(this,L0,i)}get coordinate(){const i=this.keepMarkerCentered?this.imgCenterAdjustedPx:[this.imgCenterPx[0]-this.markerDeltaX,this.imgCenterPx[1]+this.markerDeltaY];if(c2(i,this.imgCenterPx))return ie(this,O0);{const l=OA.ll(i,this.zoom);return[RA(l[0],6),RA(l[1],6)]}}set coordinate(i){Vn(this,O0,i),this.imgCenterPx=this.imgCenterAdjustedPx=OA.px(i,this.zoom)}get imgCenterOffset(){return{x:this.imgCenterPx[0]-this.imgCenterAdjustedPx[0],y:this.imgCenterPx[1]-this.imgCenterAdjustedPx[1]}}};z0=new WeakMap;fS=new WeakMap;ug=new WeakMap;L0=new WeakMap;O0=new WeakMap;pS=new WeakMap;D0=new WeakMap;F0=new WeakMap;mS=new WeakMap;B0=new WeakMap;N0=new WeakMap;hg=new WeakMap;gS=new WeakMap;j0=new WeakMap;var IV='<svg width="88" height="23" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" fill-rule="evenodd"><defs><path id="g" d="M11.5 2.25a9.25 9.25 0 1 1 0 18.5 9.25 9.25 0 0 1 0-18.5zM7 15.98c-.05-.33-.83-5.8 2.23-8.87a4.4 4.4 0 0 1 3.13-1.28c1.27 0 2.49.51 3.39 1.42.91.9 1.42 2.12 1.42 3.39a4.4 4.4 0 0 1-1.28 3.13C12.72 16.93 7 16 7 16v-.02zm8.3-5.48-2 .8-.8 2-.8-2-2-.8 2-.8.8-2 .8 2 2 .8z"/><path id="b" d="M50.63 8c.13 0 .23.1.23.23V9c.7-.76 1.7-1.18 2.73-1.18 2.17 0 3.95 1.85 3.95 4.17s-1.77 4.19-3.94 4.19A3.77 3.77 0 0 1 50.86 15v3.77c0 .13-.1.23-.23.23h-1.4a.23.23 0 0 1-.23-.23V8.23c0-.12.1-.23.23-.23h1.4zm-3.86.01.01-.01c.13 0 .22.1.22.22v7.55c0 .12-.1.23-.23.23h-1.4a.23.23 0 0 1-.23-.23V15a3.7 3.7 0 0 1-2.73 1.19c-2.17 0-3.94-1.87-3.94-4.19 0-2.32 1.77-4.19 3.94-4.19 1.03 0 2.02.43 2.73 1.18v-.75c0-.12.1-.23.23-.23h1.4zm26.38-.19a4.24 4.24 0 0 0-4.16 3.29 4.07 4.07 0 0 0 0 1.77 4.23 4.23 0 0 0 4.17 3.3 4.22 4.22 0 0 0 4.26-4.19 4.2 4.2 0 0 0-4.27-4.17zM60.63 5c.13 0 .23.1.23.23v3.76c.7-.76 1.7-1.18 2.73-1.18a4 4 0 0 1 3.84 3.28c.13.59.13 1.2 0 1.8a4 4 0 0 1-3.84 3.29A3.77 3.77 0 0 1 60.86 15v.77c0 .12-.1.23-.23.23h-1.4a.23.23 0 0 1-.23-.23V5.23c0-.12.1-.23.23-.23h1.4zm-34 11h-1.4a.23.23 0 0 1-.23-.23V8.22c.01-.13.1-.22.23-.22h1.4c.13 0 .22.11.23.22v.68c.5-.68 1.3-1.09 2.16-1.1h.03c1.09 0 2.09.6 2.6 1.55a2.73 2.73 0 0 1 2.44-1.56c1.62 0 2.93 1.25 2.9 2.78l.03 5.2c0 .13-.1.23-.23.23h-1.41a.23.23 0 0 1-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.8 0-1.46.7-1.59 1.62l.01 4.68c0 .13-.11.23-.23.23h-1.41a.23.23 0 0 1-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.85 0-1.54.79-1.6 1.8v4.5c0 .13-.1.23-.23.23zm53.62 0h-1.61a.27.27 0 0 1-.12-.03c-.1-.06-.13-.19-.06-.28l2.43-3.71-2.4-3.65a.21.21 0 0 1-.02-.12.2.2 0 0 1 .2-.21h1.61c.13 0 .24.06.3.17L82 10.54l1.4-2.37a.34.34 0 0 1 .3-.17h1.6l.12.03c.1.06.13.19.06.28l-2.37 3.65 2.43 3.7.01.13a.2.2 0 0 1-.2.21h-1.61a.33.33 0 0 1-.3-.17l-1.44-2.42-1.44 2.42a.34.34 0 0 1-.3.17zm-7.12-1.49A2.47 2.47 0 0 1 70.7 12a2.47 2.47 0 0 1 2.42-2.52 2.47 2.47 0 0 1 2.42 2.51 2.48 2.48 0 0 1-2.42 2.52zm-19.87 0a2.48 2.48 0 0 1-2.42-2.48v-.07a2.47 2.47 0 0 1 2.4-2.49 2.47 2.47 0 0 1 2.41 2.51 2.47 2.47 0 0 1-2.39 2.53zm-8.11-2.48c-.01 1.37-1.09 2.47-2.41 2.47s-2.42-1.12-2.42-2.51a2.47 2.47 0 0 1 2.4-2.52 2.46 2.46 0 0 1 2.41 2.48l.02.08zm18.12 2.47a2.47 2.47 0 0 1-2.41-2.48v-.06c.02-1.38 1.09-2.48 2.41-2.48s2.42 1.12 2.42 2.51a2.47 2.47 0 0 1-2.42 2.51z"/></defs><mask id="c"><rect width="100%" height="100%" fill="#fff"/><use xlink:href="#g"/><use xlink:href="#b"/></mask><g opacity=".3" stroke="#000" stroke-width="3"><circle mask="url(#c)" cx="11.5" cy="11.5" r="9.25"/><use xlink:href="#b" mask="url(#c)"/></g><g opacity=".9" fill="#fff"><use xlink:href="#g"/><use xlink:href="#b"/></g></svg>',FA=16,PV=Su(`
<template>
  <div class="MapboxAddressMinimap" aria-hidden="true">
    <div class="MinimapImageContainer">
      <img class="MinimapImage" draggable="false"></img>
      <div class="MinimapInnerFrame">
        <div class="MinimapMarker"></div>
        <div class="MinimapAttribution">
          <div class="MinimapAttributionLogo">
            <a target="_blank" rel="noopener nofollow" href="https://www.mapbox.com/" aria-label="Mapbox logo">
              ${IV}
            </a>
          </div>
          <div class="MinimapAttributionText">
            <a target="_blank" href='https://www.mapbox.com/about/maps/'> Mapbox</a><a target="_blank" href='http://www.openstreetmap.org/copyright'> OpenStreetMap</a>
          </div>
        </div>
      </div>
    </div>
  </div>
</template>
`),RV=Su(`
<template>
  <button type="button" class="MinimapStyleToggle"></button>
</template>
`),kV=Su(`
<template>
  <div class="MinimapFooter">Adjust the marker on the map if it doesn't precisely match your location. This helps improve address data quality.</div>
</template>
`),_S="Adjust pin",yS="Save",vS="Cancel",zV=Su(`
<template>
  <div class="MinimapEditButtons">
    <div class="Button ButtonPrimary MinimapButtonAdjust">${_S}</div>
    <div class="Button ButtonPrimary MinimapButtonSave" aria-hidden="true">${yS}</div>
    <div class="Button MinimapButtonCancel" aria-hidden="true">${vS}</div>
  </div>
</template>
`),$0,dg,D_,pf,Qp,Sd,Ed,os,Ya,V0,U0,H0,fg,W0,G0,q0,Z0,X0,Y0,F_,K0,J0,Q0,ex,xS,bS,tx,B_,N_,nx,rx,wS,ix,SS,v2=class extends wp{constructor(){super(...arguments),$t(this,$0,!1),this.keepMarkerCentered=!1,this.markerAnchor="bottom",$t(this,dg,!1),$t(this,D_,!1),$t(this,pf,void 0),$t(this,Qp,""),$t(this,Sd,void 0),$t(this,Ed,void 0),$t(this,os,void 0),$t(this,Ya,void 0),$t(this,V0,void 0),$t(this,U0,{}),$t(this,H0,!1),$t(this,fg,"default"),$t(this,W0,void 0),$t(this,G0,void 0),$t(this,q0,void 0),$t(this,Z0,["mapbox","streets-v11"]),$t(this,X0,void 0),$t(this,Y0,void 0),$t(this,F_,()=>{const{ImageContainer:i,ButtonAdjust:l,ButtonSave:f,ButtonCancel:_}=ie(this,os);ie(this,dg)?(i.classList.add(`${this.dataset.seed}--draggable`),ie(this,Ya).isActive=!0,l.setAttribute("aria-hidden","true"),f.removeAttribute("aria-hidden"),_.removeAttribute("aria-hidden")):(i.classList.remove(`${this.dataset.seed}--draggable`),ie(this,Ya).isActive=!1,l.removeAttribute("aria-hidden"),f.setAttribute("aria-hidden","true"),_.setAttribute("aria-hidden","true"))}),$t(this,K0,()=>{Vn(this,dg,!0),ie(this,F_).call(this)}),$t(this,J0,()=>{if(this.feature.properties.full_address&&!c2(this.feature.geometry.coordinates,ie(this,Ya).coordinate)){const[i,l]=ie(this,Ya).coordinate;UR(this.accessToken,{originalCoordinate:this.feature.geometry.coordinates,originalAddress:this.feature.properties.full_address,changes:{location:{longitude:i,latitude:l}}})}this.onSaveMarkerLocation&&this.onSaveMarkerLocation(ie(this,Ya).coordinate),Vn(this,dg,!1),ie(this,F_).call(this)}),$t(this,Q0,()=>{ie(this,Ya).reCenter(),Vn(this,dg,!1),ie(this,F_).call(this)}),$t(this,ex,()=>{this.mapStyleMode=this.mapStyleMode==="default"?"satellite":"default"}),$t(this,xS,()=>{ie(this,D_)||ie(this,Ya).reCenter(),Vn(this,D_,!0),ie(this,Ya)&&ie(this,Ya).handleMinimapResize()}),$t(this,bS,()=>{Vn(this,D_,!1)}),$t(this,tx,i=>{if(ie(this,Sd)===0||ie(this,Ed)===0)return"";const[l,f]=this.defaultMapStyle,_=zR(l,f),b=this.mapStyleMode==="default"?_:g$,z=_$+Lh.autofillSessionToken.toString();let O=b+Zs.convert(i).toArray().join(",")+","+FA+",0/"+Math.min(ie(this,Sd)*2,Ym)+"x"+Math.min(ie(this,Ed)*2,Ym)+"?access_token="+this.accessToken+"&attribution=false&logo=false";return Lh.autofillSessionEnabled&&(O+=`&sku=${z}`),O}),$t(this,B_,()=>{if(ie(this,pf)){const i=ie(this,pf).geometry.coordinates;Vn(this,Qp,ie(this,tx).call(this,i));const{Image:l}=ie(this,os);l.src=ie(this,Qp)}}),$t(this,N_,i=>`url("${O$(i==="default"?"styleToggleDefault":"styleToggleSatellite",this.theme)}")`),$t(this,nx,()=>{const{MapboxAddressMinimap:i,ImageContainer:l,Image:f}=ie(this,os),{width:_,height:b}=IR(this.container),[z,O]=[ie(this,Sd),ie(this,Ed)];Vn(this,Sd,Math.min(_,Ym)),Vn(this,Ed,Math.min(b,Ym)),i.style.setProperty("width",`${ie(this,Sd)}px`),i.style.setProperty("height",`${ie(this,Ed)}px`),l.style.setProperty("height",`${ie(this,Ed)}px`),l.style.setProperty("width",`${ie(this,Sd)}px`);const[r,H]=[f.width,f.height];ie(this,Sd)>z&&ie(this,Sd)>r/2&&r<Ym||ie(this,Ed)>O&&ie(this,Ed)>H/2&&H<Ym?ie(this,B_).call(this):ie(this,Ya)&&ie(this,Ya).handleMinimapResize()}),$t(this,rx,()=>{if(this.querySelector(".MinimapFooter"))return;const l=this.prepareTemplate(kV),f=this.querySelector(".MapboxAddressMinimap");if(!f||(f.appendChild(l),this.querySelector(".MinimapEditButtons")))return;const b=this.prepareTemplate(zV);this.querySelector(".MinimapInnerFrame").appendChild(b),Vn(this,os,bu(Ui({},ie(this,os)),{EditButtons:this.querySelector(".MinimapEditButtons"),ButtonAdjust:this.querySelector(".MinimapButtonAdjust"),ButtonSave:this.querySelector(".MinimapButtonSave"),ButtonCancel:this.querySelector(".MinimapButtonCancel")}));const{ButtonAdjust:O,ButtonSave:r,ButtonCancel:H}=ie(this,os);O.addEventListener("click",ie(this,K0)),r.addEventListener("click",ie(this,J0)),H.addEventListener("click",ie(this,Q0))}),$t(this,wS,()=>{if(!ie(this,os))return;const{EditButtons:i,ButtonAdjust:l,ButtonSave:f,ButtonCancel:_}=ie(this,os),b=this.querySelector(".MinimapFooter");b==null||b.remove(),i==null||i.remove(),l&&(l.remove(),l.removeEventListener("click",ie(this,K0))),f&&(f.remove(),f.removeEventListener("click",ie(this,J0))),_&&(_.remove(),_.removeEventListener("click",ie(this,Q0))),delete ie(this,os).EditButtons,delete ie(this,os).ButtonAdjust,delete ie(this,os).ButtonSave,delete ie(this,os).ButtonCancel}),$t(this,ix,()=>{if(this.querySelector(".MinimapStyleToggle"))return;const l=this.prepareTemplate(RV),f=this.querySelector(".MinimapInnerFrame");f&&(f.appendChild(l),ie(this,os).MapStyleToggle=l,l.addEventListener("click",ie(this,ex)),l.style.backgroundImage=ie(this,N_).call(this,this.mapStyleMode==="default"?"satellite":"default"),l.setAttribute("title",`Switch to ${this.mapStyleMode==="default"?"Satellite":"Default"}`))}),$t(this,SS,()=>{if(!ie(this,os))return;const{MapStyleToggle:i}=ie(this,os);i&&(i.remove(),i.removeEventListener("click",ie(this,ex)),delete ie(this,os).MapStyleToggle)})}get canAdjustMarker(){return ie(this,$0)}set canAdjustMarker(i){Vn(this,$0,i),i?ie(this,rx).call(this):ie(this,wS).call(this)}get accessToken(){return ie(this,V0)||Lh.accessToken}set accessToken(i){Vn(this,V0,i)}get feature(){return ie(this,pf)}set feature(i){Vn(this,pf,i),i?this.show():this.hide()}get template(){return PV}get templateStyle(){return dm}get templateUserStyle(){return Vc(".MapboxAddressMinimap",this.theme)}get satelliteToggle(){return ie(this,H0)}set satelliteToggle(i){Vn(this,H0,i),i?ie(this,ix).call(this):ie(this,SS).call(this)}get theme(){return ie(this,U0)}set theme(i){if(Vn(this,U0,i),!ie(this,os)||!i)return;this.updateTemplateUserStyle(Vc(".MapboxAddressMinimap",i));const{Marker:l,MapStyleToggle:f}=ie(this,os);l.innerHTML=Gu("marker",i),f&&(f.style.backgroundImage=ie(this,N_).call(this,this.mapStyleMode==="default"?"satellite":"default"))}get adjustBtnText(){return ie(this,W0)||_S}set adjustBtnText(i){Vn(this,W0,i);const l=this.querySelector(".MinimapButtonAdjust");l.textContent=i||_S}get saveBtnText(){return ie(this,G0)||yS}set saveBtnText(i){Vn(this,G0,i);const l=this.querySelector(".MinimapButtonSave");l.textContent=i||yS}get cancelBtnText(){return ie(this,q0)||vS}set cancelBtnText(i){Vn(this,q0,i);const l=this.querySelector(".MinimapButtonCancel");l.textContent=i||vS}get mapStyleMode(){return ie(this,fg)}set mapStyleMode(i){const l=ie(this,fg);if(l===i||(Vn(this,fg,i),!ie(this,os)))return;const{MapStyleToggle:f}=ie(this,os);f&&(f.style.backgroundImage=ie(this,N_).call(this,l),f.setAttribute("title",`Switch to ${l==="satellite"?"Satellite":"Default"}`),ie(this,B_).call(this))}get defaultMapStyle(){return ie(this,Z0)}set defaultMapStyle(i){Vn(this,Z0,i),ie(this,B_).call(this)}get footer(){return ie(this,X0)}set footer(i){Vn(this,X0,i);const l=this.querySelector(".MinimapFooter");l&&(typeof i=="string"?(l.textContent=i,l.removeAttribute("aria-hidden")):i?l.removeAttribute("aria-hidden"):l.setAttribute("aria-hidden","true"))}get container(){return ie(this,Y0)}set container(i){i&&(i.style.position="relative",Vn(this,Y0,i))}show(){if(!ie(this,pf))return;const i=ie(this,pf).geometry.coordinates;ie(this,Ya).coordinate=i,Vn(this,Qp,ie(this,tx).call(this,i));const{MapboxAddressMinimap:l,Image:f}=ie(this,os);f.src=ie(this,Qp),l.removeAttribute("aria-hidden")}hide(){const{MapboxAddressMinimap:i}=ie(this,os);i.setAttribute("aria-hidden","true")}connectedCallback(){super.connectedCallback(),Vn(this,os,hm(this,{MapboxAddressMinimap:".MapboxAddressMinimap",ImageContainer:".MinimapImageContainer",Image:".MinimapImage",Marker:".MinimapMarker",MapStyleToggle:".MinimapStyleToggle",EditButtons:".MinimapEditButtons",ButtonAdjust:".MinimapButtonAdjust",ButtonSave:".MinimapButtonSave",ButtonCancel:".MinimapButtonCancel"})),this.mapStyleMode=ie(this,fg),this.theme=Ui({},this.theme),this.canAdjustMarker&&ie(this,rx).call(this),this.satelliteToggle&&ie(this,ix).call(this),this.container=this.parentElement,new ResizeObserver(ie(this,nx)).observe(this.container),ie(this,nx).call(this);const{MapboxAddressMinimap:l,ImageContainer:f,Image:_,Marker:b}=ie(this,os);Vn(this,Ya,new AV(f,_,b,this.keepMarkerCentered,FA,this.markerAnchor)),ie(this,Ya).reCenter(),_.onload=ie(this,xS),_.onerror=ie(this,bS),_.src=ie(this,Qp),ie(this,pf)?l.removeAttribute("aria-hidden"):l.setAttribute("aria-hidden","true")}attributeChangedCallback(i,l,f){if(i==="access-token")this.accessToken=f;else if(i==="can-adjust-marker")this.canAdjustMarker=f==="true";else if(i==="keep-marker-centered")this.keepMarkerCentered=f==="true";else if(i==="marker-anchor"){const _=f;this.markerAnchor=_,ie(this,Ya)&&(ie(this,Ya).anchor=_)}else i==="satellite-toggle"&&(this.satelliteToggle=f==="true")}};$0=new WeakMap;dg=new WeakMap;D_=new WeakMap;pf=new WeakMap;Qp=new WeakMap;Sd=new WeakMap;Ed=new WeakMap;os=new WeakMap;Ya=new WeakMap;V0=new WeakMap;U0=new WeakMap;H0=new WeakMap;fg=new WeakMap;W0=new WeakMap;G0=new WeakMap;q0=new WeakMap;Z0=new WeakMap;X0=new WeakMap;Y0=new WeakMap;F_=new WeakMap;K0=new WeakMap;J0=new WeakMap;Q0=new WeakMap;ex=new WeakMap;xS=new WeakMap;bS=new WeakMap;tx=new WeakMap;B_=new WeakMap;N_=new WeakMap;nx=new WeakMap;rx=new WeakMap;wS=new WeakMap;ix=new WeakMap;SS=new WeakMap;v2.observedAttributes=["access-token","can-adjust-marker","keep-marker-centered","marker-anchor","satellite-toggle"];window.MapboxAddressMinimap=v2;window.customElements.get("mapbox-address-minimap")||customElements.define("mapbox-address-minimap",v2);Nn.forwardRef((i,l)=>{const{accessToken:f,options:_,theme:b,popoverOptions:z,confirmOnBrowserAutofill:O,browserAutofillEnabled:r,children:H,onChange:Z,onSuggest:K,onSuggestError:te,onRetrieve:le,interceptSearch:Te}=i,pe=se.useRef();return se.useImperativeHandle(l,()=>({focus:()=>{if(pe.current)return pe.current.focus();throw new Error("AddressAutofill is not mounted")}})),se.useEffect(()=>{pe.current&&(pe.current.options=_)},[pe.current,_]),se.useEffect(()=>{pe.current&&(pe.current.interceptSearch=Te)},[pe.current,_]),se.useEffect(()=>{pe.current&&(pe.current.theme=b)},[pe.current,b]),se.useEffect(()=>{pe.current&&(pe.current.popoverOptions=z)},[pe.current,z]),se.useEffect(()=>{pe.current&&(pe.current.confirmOnBrowserAutofill=O)},[pe.current,O]),se.useEffect(()=>{pe.current&&(pe.current.browserAutofillEnabled=r)},[pe.current,r]),se.useEffect(()=>{const ge=pe.current;if(!ge||!K)return;const fe=me=>K(me.detail);return ge.addEventListener("suggest",fe),()=>{ge.removeEventListener("suggest",fe)}},[pe.current,K]),se.useEffect(()=>{const ge=pe.current;if(!ge||!te)return;const fe=me=>te(me.detail);return ge.addEventListener("suggesterror",fe),()=>{ge.removeEventListener("suggesterror",fe)}},[pe.current,te]),se.useEffect(()=>{const ge=pe.current;if(!ge||!le)return;const fe=me=>le(me.detail);return ge.addEventListener("retrieve",fe),()=>{ge.removeEventListener("retrieve",fe)}},[pe.current,le]),se.useEffect(()=>{const ge=pe.current;if(!ge||!Z)return;const fe=me=>{me.target===me.currentTarget&&Z(me.detail)};return ge.addEventListener("input",fe),()=>{ge.removeEventListener("input",fe)}},[pe.current,Z]),se.useEffect(()=>{pe.current&&(pe.current.accessToken=f)},[pe.current,f]),Nn.createElement("mapbox-address-autofill",{ref:pe},H)});var LV=Nn.forwardRef((i,l)=>{const{accessToken:f,options:_,theme:b,popoverOptions:z,placeholder:O,map:r,marker:H,mapboxgl:Z,value:K,onChange:te,onSuggest:le,onSuggestError:Te,onRetrieve:pe,onClear:ge,interceptSearch:fe}=i,me=se.useRef();return se.useImperativeHandle(l,()=>({focus:()=>{if(me.current)return me.current.focus();throw new Error("SearchBox is not mounted")},search:_e=>{if(me.current)return me.current.search(_e);throw new Error("SearchBox is not mounted")}})),se.useEffect(()=>{me.current&&(me.current.options=_||{})},[me.current,_]),se.useEffect(()=>{me.current&&(me.current.interceptSearch=fe)},[me.current,fe]),se.useEffect(()=>{me.current&&(me.current.theme=b)},[me.current,b]),se.useEffect(()=>{me.current&&(me.current.popoverOptions=z)},[me.current,z]),se.useEffect(()=>{me.current&&(me.current.placeholder=O)},[me.current,O]),se.useEffect(()=>{me.current&&(me.current.value=K||"")},[me.current,K]),se.useEffect(()=>{const _e=me.current;if(_e)return _e.bindMap(r),()=>{_e.unbindMap()}},[me.current,r]),se.useEffect(()=>{me.current&&(me.current.marker=H)},[me.current,H]),se.useEffect(()=>{me.current&&(me.current.mapboxgl=Z)},[me.current,Z]),se.useEffect(()=>{const _e=me.current;if(!_e||!le)return;const Ie=Ne=>le(Ne.detail);return _e.addEventListener("suggest",Ie),()=>{_e.removeEventListener("suggest",Ie)}},[me.current,le]),se.useEffect(()=>{const _e=me.current;if(!_e||!Te)return;const Ie=Ne=>Te(Ne.detail);return _e.addEventListener("suggesterror",Ie),()=>{_e.removeEventListener("suggesterror",Ie)}},[me.current,Te]),se.useEffect(()=>{const _e=me.current;if(!_e||!pe)return;const Ie=Ne=>pe(Ne.detail);return _e.addEventListener("retrieve",Ie),()=>{_e.removeEventListener("retrieve",Ie)}},[me.current,pe]),se.useEffect(()=>{const _e=me.current;if(!_e||!te)return;const Ie=Ne=>{Ne.target===Ne.currentTarget&&te(Ne.detail)};return _e.addEventListener("input",Ie),()=>{_e.removeEventListener("input",Ie)}},[me.current,te]),se.useEffect(()=>{const _e=me.current;if(!_e||!ge)return;const Ie=()=>{ge()};return _e.addEventListener("clear",Ie),()=>{_e.removeEventListener("clear",Ie)}},[me.current,ge]),se.useEffect(()=>{me.current&&(me.current.accessToken=f)},[me.current,f]),Nn.createElement("mapbox-search-box",{ref:me})});Nn.forwardRef((i,l)=>{const{accessToken:f,options:_,theme:b,popoverOptions:z,placeholder:O,map:r,marker:H,mapboxgl:Z,value:K,onChange:te,onSuggest:le,onSuggestError:Te,onRetrieve:pe,onClear:ge,interceptSearch:fe}=i,me=se.useRef();return se.useImperativeHandle(l,()=>({focus:()=>{if(me.current)return me.current.focus();throw new Error("Geocoder is not mounted")},search:_e=>{if(me.current)return me.current.search(_e);throw new Error("Geocoder is not mounted")}})),se.useEffect(()=>{me.current&&(me.current.options=_||{})},[me.current,_]),se.useEffect(()=>{me.current&&(me.current.interceptSearch=fe)},[me.current,fe]),se.useEffect(()=>{me.current&&(me.current.theme=b)},[me.current,b]),se.useEffect(()=>{me.current&&(me.current.popoverOptions=z)},[me.current,z]),se.useEffect(()=>{me.current&&(me.current.placeholder=O)},[me.current,O]),se.useEffect(()=>{me.current&&(me.current.value=K||"")},[me.current,K]),se.useEffect(()=>{const _e=me.current;if(_e)return _e.bindMap(r),()=>{_e.unbindMap()}},[me.current,r]),se.useEffect(()=>{me.current&&(me.current.marker=H)},[me.current,H]),se.useEffect(()=>{me.current&&(me.current.mapboxgl=Z)},[me.current,Z]),se.useEffect(()=>{const _e=me.current;if(!_e||!le)return;const Ie=Ne=>le(Ne.detail);return _e.addEventListener("suggest",Ie),()=>{_e.removeEventListener("suggest",Ie)}},[me.current,le]),se.useEffect(()=>{const _e=me.current;if(!_e||!Te)return;const Ie=Ne=>Te(Ne.detail);return _e.addEventListener("suggesterror",Ie),()=>{_e.removeEventListener("suggesterror",Ie)}},[me.current,Te]),se.useEffect(()=>{const _e=me.current;if(!_e||!pe)return;const Ie=Ne=>pe(Ne.detail);return _e.addEventListener("retrieve",Ie),()=>{_e.removeEventListener("retrieve",Ie)}},[me.current,pe]),se.useEffect(()=>{const _e=me.current;if(!_e||!te)return;const Ie=Ne=>{Ne.target===Ne.currentTarget&&te(Ne.detail)};return _e.addEventListener("input",Ie),()=>{_e.removeEventListener("input",Ie)}},[me.current,te]),se.useEffect(()=>{const _e=me.current;if(!_e||!ge)return;const Ie=()=>{ge()};return _e.addEventListener("clear",Ie),()=>{_e.removeEventListener("clear",Ie)}},[me.current,ge]),se.useEffect(()=>{me.current&&(me.current.accessToken=f)},[me.current,f]),Nn.createElement("mapbox-geocoder",{ref:me})});const KR={accessToken:"pk.eyJ1IjoibGV2bGFkaWsiLCJhIjoiY2ttbmtreXpsMDJuczJvbGZjbWk5a2N2diJ9.w50051-ckXCDXPYqgy-t1w"},OV=()=>{const[i,l]=se.useState(""),{mapRef:f}=jx(),{setCity:_,setCountry:b,setCoordinates:z}=oy(),O=r=>{var H,Z;_(r.features[0].properties.name),b(((Z=(H=r.features[0].properties.context)==null?void 0:H.country)==null?void 0:Z.name)||""),z(r.features[0].geometry.coordinates)};return fi.jsx(LV,{accessToken:KR.accessToken,map:f||void 0,mapboxgl:Rv,options:{types:"place"},placeholder:"Seacr your city",value:i,onChange:r=>{l(r)},onRetrieve:O})},DV=()=>{const{isLabels:i,setIsLabels:l,city:f,setCity:_,country:b,setCountry:z,coordinates:O,setCoordinates:r}=oy();return fi.jsxs(fi.Fragment,{children:[fi.jsx(QS,{orientation:"left",children:"Labels"}),fi.jsx(fp,{maxLength:16,placeholder:"Title",value:f,onChange:H=>_==null?void 0:_(H.target.value)}),fi.jsx(fp,{maxLength:26,placeholder:"Subtitle",value:b,onChange:H=>z==null?void 0:z(H.target.value)}),fi.jsx(fp,{maxLength:42,placeholder:"Tagline",value:`${O[0]} ${O[1]}`,onChange:H=>r==null?void 0:r(H.target.value)}),fi.jsxs("div",{className:"text-end",children:[fi.jsx("p",{className:"d-inline me-2",children:"Labels:"}),fi.jsx(QP,{checked:i,onChange:H=>l(H)})]})]})},FV="/pinpixel/assets/piter-DlxJoD2w.jpg",BV="/pinpixel/assets/newyork-BZ6_YEuo.jpg",NV="/pinpixel/assets/paris-C0v_ZXjl.jpg",jV="/pinpixel/assets/tokyo-xNjLGMh-.jpg",$V="/pinpixel/assets/barcelona-O-Jr_ipk.jpg",VV="/pinpixel/assets/lisbon-D_eVp1sD.jpg",UV=[{name:"piter",style:"mapbox://styles/levladik/ckwas7w420a0h15s8xanbvf8j",image:FV},{name:"newyork",style:"mapbox://styles/levladik/ckwaqs32n6iax15p1xy9twrc4",image:BV},{name:"paris",style:"mapbox://styles/levladik/ckn5wwkxc0zfk17oqooi5o2bp",image:NV},{name:"tokyo",style:"mapbox://styles/levladik/ckw3oabba2evs14k6chimh5vr",image:jV},{name:"barcelona",style:"mapbox://styles/levladik/ckn5xz5420qrw17s6q2agidvw",image:$V},{name:"lisbon",style:"mapbox://styles/levladik/ckw3o3cmm2nyz14nyhwj428nf",image:VV}],HV=()=>{const{setMapStyle:i,mapRef:l}=jx(),f=_=>{i(_),l==null||l.setStyle(_)};return fi.jsxs(fi.Fragment,{children:[fi.jsx(QS,{orientation:"left",children:"Styles"}),fi.jsx("div",{className:"styles-icons__container d-flex justify-content-start flex-wrap gap-3",children:UV.map(({name:_,style:b,image:z})=>fi.jsx(DP,{size:64,src:z,onClick:()=>f(b)},_))})]})},WV=()=>fi.jsxs("div",{className:"customisation-panel__wrapper col-12 col-md-4 order-2 order-md-1 p-3 d-grid gap-1",children:[fi.jsx(OV,{}),fi.jsx(DV,{}),fi.jsx(HV,{}),fi.jsx(Fj,{})]}),GV=()=>{const{setMapRef:i,mapStyle:l,mapCenter:f,setMapCenter:_,mapZoom:b,setMapZoom:z}=jx(),O=se.useRef(null);return se.useEffect(()=>{var H;if(Rv.accessToken=KR.accessToken,!O.current)return;const r=new Rv.Map({container:O.current,style:l,center:f,zoom:b});return i(r),r.addControl(new Rv.NavigationControl({visualizePitch:!1})),r.on("move",()=>{const{lng:Z,lat:K}=r.getCenter();_([Z,K]),z(r.getZoom())}),r.dragRotate.disable(),(H=O.current)==null||H.addEventListener("contextmenu",Z=>{Z.preventDefault()}),()=>{r.remove()}},[]),fi.jsx("div",{ref:O,id:"map-container",className:"map-container"})},qV=()=>{const i=_=>_>768?30:_>576?40:80,[l,f]=se.useState(()=>i(window.innerWidth));return se.useEffect(()=>{const _=()=>{f(i(window.innerWidth))};return window.addEventListener("resize",_),()=>{window.removeEventListener("resize",_)}},[]),l},ZV=({mapContainerWidth:i})=>{const{isLabels:l,city:f,country:_,coordinates:b}=oy();return fi.jsx(fi.Fragment,{children:l&&fi.jsxs("div",{className:"labels",children:[fi.jsx("p",{className:"labels__title mb-0",style:{fontSize:`${i/20}vw`},children:f}),fi.jsx("p",{className:"labels__subtitle mb-0",style:{fontSize:`${i/25}vw`},children:_}),fi.jsx("p",{className:"labels__tagline mb-0",style:{fontSize:`${i/40}vw`},children:`${b[0]}  ${b[1]}`})]})})},XV=()=>{const{posterSize:i}=oy(),[l,f]=i.split("*"),_=qV(),b=Number(_)*(Number(f)/Number(l));return fi.jsxs("div",{className:"map__wrapper p-3 col-12 col-md-5 order-1 order-md-2 flex-shrink-0",style:{width:`${_}vw`,height:`${b}vw`},children:[fi.jsx(GV,{}),fi.jsx(ZV,{mapContainerWidth:_})]})};function YV(){return fi.jsx("div",{className:"content__wrapper",children:fi.jsxs("div",{className:"row d-flex justify-content-center gx-5",children:[fi.jsx(WV,{}),fi.jsx(XV,{})]})})}zz.createRoot(document.getElementById("root")).render(fi.jsx(se.StrictMode,{children:fi.jsx(YV,{})}));
